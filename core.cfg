[buildout]
index = https://pypi.org/simple/
extends =
    sources.cfg
    checkouts.cfg
    versions.cfg
    tests.cfg

parts +=
    wsgi.py
    uwsgi_ini
    nginx_uwsgi_conf
    waitress_ini
    wsgi
    zconsole
    zopepy
    packages
    releaser
    z3c_checkversions
    dependencies

allow-hosts =
    *.python.org
    *.plone.org
    *.zope.org
    pypi.org
    files.pythonhosted.org
    launchpad.net
    code.google.com
    robotframework.googlecode.com

find-links += http://dist.plone.org/thirdparty/

extensions +=
# Keep mr.developer as last one, because some jenkins scripts look for
# this and add a git-clone-depth after it.
    mr.developer

show-picked-versions = true

# define a template directory here in order to override it later in custom
template-directory = ${buildout:directory}/templates

# non-immersive development helpers commonly needed for Plone Core Development
devtool-eggs =
    pdbpp

# the default plone user and password for local development
plone-user =
    admin:admin


[wsgi.py]
recipe = plone.recipe.zope2instance
user = ${buildout:plone-user}
wsgi = on
control-script = wsgi.py
eggs =
    Plone
    ${buildout:eggs}
    ${buildout:devtool-eggs}
# zeo-client = on
# zeo-address = 8100
# shared-blob = on
environment-vars =
    zope_i18n_compile_mo_files true


[uwsgi_ini]
recipe = collective.recipe.template[genshi]:genshi
input = ${buildout:template-directory}/uwsgi.ini
output = ${buildout:directory}/etc/uwsgi.ini
num-threads = 2
http-socket = 0.0.0.0:8080
socket = 127.0.0.1:8081


[nginx_uwsgi_conf]
recipe = collective.recipe.template[genshi]:genshi
input = ${buildout:template-directory}/nginx-uwsgi.conf
output = ${buildout:directory}/etc/nginx-uwsgi.conf


[waitress_ini]
recipe = collective.recipe.template[genshi]:genshi
input = ${buildout:template-directory}/waitress.ini
output = ${buildout:directory}/etc/waitress.ini
listen = 0.0.0.0:6543


[wsgi]
recipe = collective.recipe.template[genshi]:genshi
inline =
    #!/bin/sh
    ${buildout:directory}/bin/wsgi.py ${buildout:directory}/etc/waitress.ini
output = ${buildout:directory}/bin/wsgi
mode = 755


[zconsole]
recipe = collective.recipe.template[genshi]:genshi
inline =
    #!/bin/sh
    MODE=$$1
    shift
    ${buildout:directory}/bin/zopepy -m Zope2.utilities.zconsole $$MODE ${buildout:parts-directory}/wsgi.py/etc/zope.conf $$*
output = ${buildout:directory}/bin/zconsole
mode = 755


[zopepy]
recipe = zc.recipe.egg
eggs =
    ${test:eggs}
interpreter = zopepy
scripts =
    zopepy
    plone-compile-resources


[packages]
recipe = collective.recipe.omelette
ignore-develop = False
eggs =
    ${test:eggs}
ignores =
    roman


[releaser]
recipe = zc.recipe.egg
dependent-scripts = true
eggs =
    plone.releaser
    zest.releaser[recommended]
    zest.pocompile


[z3c_checkversions]
# run this via bin/checkversions -l 2 versions.cfg
recipe = zc.recipe.egg
eggs = z3c.checkversions [buildout]


[dependencies]
recipe = zc.recipe.egg
eggs = z3c.dependencychecker
