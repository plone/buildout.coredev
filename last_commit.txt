Repository: plone.app.event


Branch: refs/heads/master
Date: 2020-11-16T16:57:28+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.event/commit/3b13da070e5ccf2c577a4fef6b2ac51de35f8a0b

Give validation error in ical importer when a file:// URL is used.

This could be a line of attack for a hacker.
But the hacker would already need to have Manager rights to see the resulting error, before getting some useful information from this.
See https://github.com/plone/Products.CMFPlone/issues/3209

Files changed:
A news/3209.bugfix
M plone/app/event/ical/importer.py

b'diff --git a/news/3209.bugfix b/news/3209.bugfix\nnew file mode 100644\nindex 00000000..137f0ca1\n--- /dev/null\n+++ b/news/3209.bugfix\n@@ -0,0 +1,3 @@\n+Give validation error in ical importer when a ``file://`` URL is used.\n+This could be a line of attack for a hacker.\n+[maurits]\ndiff --git a/plone/app/event/ical/importer.py b/plone/app/event/ical/importer.py\nindex b976f39b..e5520b3e 100644\n--- a/plone/app/event/ical/importer.py\n+++ b/plone/app/event/ical/importer.py\n@@ -26,6 +26,7 @@\n from zope.interface import alsoProvides\n from zope.interface import implementer\n from zope.interface import Interface\n+from zope.interface import Invalid\n from zope.interface import noLongerProvides\n from zope.lifecycleevent import ObjectModifiedEvent\n \n@@ -223,6 +224,16 @@ def _from_list(ical, prop):\n     return {\'count\': count}\n \n \n+def no_file_protocol_url(value):\n+    """Validator for ical_url: we do not want file:// urls.\n+\n+    This opens up security issues.\n+    """\n+    if value and value.startswith("file://"):\n+        raise Invalid(_(u"URLs with file:// are not allowed."))\n+    return True\n+\n+\n class IIcalendarImportSettings(Interface):\n \n     event_type = schema.Choice(\n@@ -240,6 +251,7 @@ class IIcalendarImportSettings(Interface):\n         description=_(\n             \'ical_import_url_desc\',\n             default=u"URL to an external icalendar resource file."),\n+        constraint=no_file_protocol_url,\n         required=False\n     )\n \n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2020-11-16T21:18:04+01:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.app.event/commit/9240012b16c92e2df577ed631911c20dd4c74fca

Merge pull request #322 from plone/maurits/cmfplone-issue-3209-event

Give validation error in ical importer when a file:// URL is used.

Files changed:
A news/3209.bugfix
M plone/app/event/ical/importer.py

b'diff --git a/news/3209.bugfix b/news/3209.bugfix\nnew file mode 100644\nindex 00000000..137f0ca1\n--- /dev/null\n+++ b/news/3209.bugfix\n@@ -0,0 +1,3 @@\n+Give validation error in ical importer when a ``file://`` URL is used.\n+This could be a line of attack for a hacker.\n+[maurits]\ndiff --git a/plone/app/event/ical/importer.py b/plone/app/event/ical/importer.py\nindex b976f39b..e5520b3e 100644\n--- a/plone/app/event/ical/importer.py\n+++ b/plone/app/event/ical/importer.py\n@@ -26,6 +26,7 @@\n from zope.interface import alsoProvides\n from zope.interface import implementer\n from zope.interface import Interface\n+from zope.interface import Invalid\n from zope.interface import noLongerProvides\n from zope.lifecycleevent import ObjectModifiedEvent\n \n@@ -223,6 +224,16 @@ def _from_list(ical, prop):\n     return {\'count\': count}\n \n \n+def no_file_protocol_url(value):\n+    """Validator for ical_url: we do not want file:// urls.\n+\n+    This opens up security issues.\n+    """\n+    if value and value.startswith("file://"):\n+        raise Invalid(_(u"URLs with file:// are not allowed."))\n+    return True\n+\n+\n class IIcalendarImportSettings(Interface):\n \n     event_type = schema.Choice(\n@@ -240,6 +251,7 @@ class IIcalendarImportSettings(Interface):\n         description=_(\n             \'ical_import_url_desc\',\n             default=u"URL to an external icalendar resource file."),\n+        constraint=no_file_protocol_url,\n         required=False\n     )\n \n'

