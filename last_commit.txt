Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-01-26T16:54:52+01:00
Author: Víctor Fernández de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/0827c28b0b88498cd7a20b256af500c26d63a0ec

Unify nav_title and title in navs (#1052)

* Unify nav_title and title in navs

* nav_title in contextnavigation too

* Fix breadcrumbs tests

* Fix even more tests

* Update test_documentation

Co-authored-by: Timo Stollenwerk &lt;stollenwerk@kitconcept.com&gt;

Files changed:
A news/1051.feature
M src/plone/restapi/services/breadcrumbs/get.py
M src/plone/restapi/services/contextnavigation/get.py
M src/plone/restapi/services/navigation/get.py
M src/plone/restapi/tests/http-examples/breadcrumbs.resp
M src/plone/restapi/tests/http-examples/expansion_expanded.resp
M src/plone/restapi/tests/http-examples/expansion_expanded_full.resp
M src/plone/restapi/tests/http-examples/navigation_tree.resp
M src/plone/restapi/tests/test_expansion.py
M src/plone/restapi/tests/test_services_breadcrumbs.py

b'diff --git a/news/1051.feature b/news/1051.feature\nnew file mode 100644\nindex 000000000..373bf5e35\n--- /dev/null\n+++ b/news/1051.feature\n@@ -0,0 +1,2 @@\n+- Unify nav_title and title in navs\n+  [sneridagh]\ndiff --git a/src/plone/restapi/services/breadcrumbs/get.py b/src/plone/restapi/services/breadcrumbs/get.py\nindex b14b4ab40..c295d54bd 100644\n--- a/src/plone/restapi/services/breadcrumbs/get.py\n+++ b/src/plone/restapi/services/breadcrumbs/get.py\n@@ -28,14 +28,14 @@ def __call__(self, expand=False):\n         )\n         items = []\n         for crumb in breadcrumbs_view.breadcrumbs():\n+            item = {\n+                "title": crumb["Title"],\n+                "@id": crumb["absolute_url"],\n+            }\n+            if crumb.get("nav_title", False):\n+                item.update({"title": crumb["nav_title"]})\n \n-            items.append(\n-                {\n-                    "title": crumb["Title"],\n-                    "@id": crumb["absolute_url"],\n-                    "nav_title": crumb.get("nav_title", None),\n-                }\n-            )\n+            items.append(item)\n \n         result["breadcrumbs"]["items"] = items\n         return result\ndiff --git a/src/plone/restapi/services/contextnavigation/get.py b/src/plone/restapi/services/contextnavigation/get.py\nindex f53753b12..e90ea8007 100644\n--- a/src/plone/restapi/services/contextnavigation/get.py\n+++ b/src/plone/restapi/services/contextnavigation/get.py\n@@ -486,6 +486,9 @@ def recurse(self, children, level, bottomLevel):\n                 "type": node["normalized_portal_type"],\n             }\n \n+            if node.get("nav_title", False):\n+                item.update({"title": node["nav_title"]})\n+\n             nodechildren = node["children"]\n \n             if (\ndiff --git a/src/plone/restapi/services/navigation/get.py b/src/plone/restapi/services/navigation/get.py\nindex 54729c47d..4eba1e2fc 100644\n--- a/src/plone/restapi/services/navigation/get.py\n+++ b/src/plone/restapi/services/navigation/get.py\n@@ -182,9 +182,7 @@ def navtree(self):\n             }\n \n             if brain.get("nav_title", False):\n-                entry.update({"nav_title": brain["nav_title"]})\n-            else:\n-                entry.update({"nav_title": None})\n+                entry.update({"title": brain["nav_title"]})\n \n             self.customize_entry(entry, brain)\n             ret[brain_parent_path].append(entry)\ndiff --git a/src/plone/restapi/tests/http-examples/breadcrumbs.resp b/src/plone/restapi/tests/http-examples/breadcrumbs.resp\nindex 0c7a43274..78aebf256 100644\n--- a/src/plone/restapi/tests/http-examples/breadcrumbs.resp\n+++ b/src/plone/restapi/tests/http-examples/breadcrumbs.resp\n@@ -6,7 +6,6 @@ Content-Type: application/json\n   "items": [\n     {\n       "@id": "http://localhost:55001/plone/front-page", \n-      "nav_title": null, \n       "title": "Welcome to Plone"\n     }\n   ]\ndiff --git a/src/plone/restapi/tests/http-examples/expansion_expanded.resp b/src/plone/restapi/tests/http-examples/expansion_expanded.resp\nindex f033dbb51..f9599d91b 100644\n--- a/src/plone/restapi/tests/http-examples/expansion_expanded.resp\n+++ b/src/plone/restapi/tests/http-examples/expansion_expanded.resp\n@@ -11,7 +11,6 @@ Content-Type: application/json\n       "items": [\n         {\n           "@id": "http://localhost:55001/plone/front-page", \n-          "nav_title": null, \n           "title": "Welcome to Plone"\n         }\n       ]\ndiff --git a/src/plone/restapi/tests/http-examples/expansion_expanded_full.resp b/src/plone/restapi/tests/http-examples/expansion_expanded_full.resp\nindex d2ff5a28d..8541bf56a 100644\n--- a/src/plone/restapi/tests/http-examples/expansion_expanded_full.resp\n+++ b/src/plone/restapi/tests/http-examples/expansion_expanded_full.resp\n@@ -111,7 +111,6 @@ Content-Type: application/json\n       "items": [\n         {\n           "@id": "http://localhost:55001/plone/front-page", \n-          "nav_title": null, \n           "title": "Welcome to Plone"\n         }\n       ]\ndiff --git a/src/plone/restapi/tests/http-examples/navigation_tree.resp b/src/plone/restapi/tests/http-examples/navigation_tree.resp\nindex ac39c453a..ef5586df3 100644\n--- a/src/plone/restapi/tests/http-examples/navigation_tree.resp\n+++ b/src/plone/restapi/tests/http-examples/navigation_tree.resp\n@@ -34,19 +34,16 @@ Content-Type: application/json\n                   "@id": "http://localhost:55001/plone/folder/subfolder1/thirdlevelfolder/fourthlevelfolder", \n                   "description": "", \n                   "items": [], \n-                  "nav_title": null, \n                   "review_state": "private", \n                   "title": "Fourth Level Folder", \n                   "use_view_action_in_listings": false\n                 }\n               ], \n-              "nav_title": null, \n               "review_state": "private", \n               "title": "Third Level Folder", \n               "use_view_action_in_listings": false\n             }\n           ], \n-          "nav_title": null, \n           "review_state": "private", \n           "title": "SubFolder 1", \n           "use_view_action_in_listings": false\n@@ -55,7 +52,6 @@ Content-Type: application/json\n           "@id": "http://localhost:55001/plone/folder/subfolder2", \n           "description": "", \n           "items": [], \n-          "nav_title": null, \n           "review_state": "private", \n           "title": "SubFolder 2", \n           "use_view_action_in_listings": false\n@@ -64,7 +60,6 @@ Content-Type: application/json\n           "@id": "http://localhost:55001/plone/folder/doc1", \n           "description": "", \n           "items": [], \n-          "nav_title": null, \n           "review_state": "private", \n           "title": "A document", \n           "use_view_action_in_listings": false\ndiff --git a/src/plone/restapi/tests/test_expansion.py b/src/plone/restapi/tests/test_expansion.py\nindex 6926d533c..eba6c85ab 100644\n--- a/src/plone/restapi/tests/test_expansion.py\n+++ b/src/plone/restapi/tests/test_expansion.py\n@@ -237,7 +237,6 @@ def test_breadcrumbs_expanded(self):\n                 {\n                     u"title": u"Some Folder",\n                     u"@id": self.portal_url + u"/folder",\n-                    u"nav_title": None,\n                 }\n             ],\n             response.json()["@components"]["breadcrumbs"]["items"],\ndiff --git a/src/plone/restapi/tests/test_services_breadcrumbs.py b/src/plone/restapi/tests/test_services_breadcrumbs.py\nindex b41339d50..962f75586 100644\n--- a/src/plone/restapi/tests/test_services_breadcrumbs.py\n+++ b/src/plone/restapi/tests/test_services_breadcrumbs.py\n@@ -48,12 +48,10 @@ def test_breadcrumbs(self):\n                     {\n                         u"@id": self.portal_url + u"/folder",\n                         u"title": u"Some Folder",\n-                        u"nav_title": None,\n                     },\n                     {\n                         u"@id": self.portal_url + u"/folder/doc1",\n                         u"title": u"A document",\n-                        u"nav_title": None,\n                     },\n                 ],\n             },\n'

