Repository: plone.app.content


Branch: refs/heads/master
Date: 2020-06-29T13:32:42+02:00
Author: Vincent Fretin (vincentfretin) <vincent.fretin@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/0b14690e56f386d3ccd8bb8737f0e0d7e3ba6fbc

Fix i18n of Save and Cancel buttons and the constrain types select values in the folder_constraintypes_form view

Files changed:
A news/202.bugfix
M plone/app/content/browser/constraintypes.py

b'diff --git a/news/202.bugfix b/news/202.bugfix\nnew file mode 100644\nindex 0000000..2b4f15c\n--- /dev/null\n+++ b/news/202.bugfix\n@@ -0,0 +1,3 @@\n+Fix i18n of Save and Cancel buttons and the constrain types select values in the folder_constraintypes_form view.\n+This closes https://github.com/plone/Products.CMFPlone/issues/3127\n+[vincentfretin]\ndiff --git a/plone/app/content/browser/constraintypes.py b/plone/app/content/browser/constraintypes.py\nindex 50e9b7b..1daa8c6 100644\n--- a/plone/app/content/browser/constraintypes.py\n+++ b/plone/app/content/browser/constraintypes.py\n@@ -6,6 +6,7 @@\n from z3c.form import button\n from z3c.form import form\n from z3c.form.browser.checkbox import CheckBoxFieldWidget\n+from zope.i18nmessageid import MessageFactory\n from zope.interface import implementer\n from zope.interface import Interface\n from zope.interface import invariant\n@@ -28,19 +29,21 @@\n ENABLED = 1\n \n \n-ST = lambda key, txt, default: SimpleTerm(value=key,\n-                                          title=_(txt, default=default))\n+ST = lambda key, title: SimpleTerm(value=key, title=title)\n+\n+# reuse the translations that we had in atcontenttypes\n+AMF = MessageFactory(\'atcontenttypes\')\n \n possible_constrain_types = SimpleVocabulary([\n     ST(ACQUIRE,\n-       u\'constraintypes_mode_acquire\',\n-       u\'Use parent folder settings\'),\n+       AMF(u\'constraintypes_acquire_label\',\n+         default=u\'Use parent folder settings\')),\n     ST(DISABLED,\n-       \'label_constraintypes_allow_standard\',\n-       u\'Use portal default\'),\n+       AMF(u\'constraintypes_disable_label\',\n+         default=u\'Use portal default\')),\n     ST(ENABLED,\n-       u\'label_constraintypes_specify_manually\',\n-       u\'Select manually\')\n+       AMF(u\'constraintypes_enable_label\',\n+         default=u\'Select manually\'))\n ])\n \n \n@@ -155,7 +158,7 @@ def updateActions(self):\n         super(ConstrainsFormView, self).updateActions()\n         self.actions[\'save\'].addClass(\'context\')\n \n-    @button.buttonAndHandler(u\'Save\')\n+    @button.buttonAndHandler(_(\'label_save\', default=u"Save"), name=\'save\')\n     def handleSave(self, action):\n         data, errors = self.extractData()\n         if errors:\n@@ -174,7 +177,7 @@ def handleSave(self, action):\n         contextURL = self.context.absolute_url()\n         self.request.response.redirect(contextURL)\n \n-    @button.buttonAndHandler(u\'Cancel\')\n+    @button.buttonAndHandler(_(\'label_cancel\', default=u"Cancel"), name=\'cancel\')\n     def handleCancel(self, action):\n         contextURL = self.context.absolute_url()\n         self.request.response.redirect(contextURL)\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2020-06-29T15:08:49+02:00
Author: Vincent Fretin (vincentfretin) <vincent.fretin@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/486d1f1993328048d4041bdf16e1c3a161269a34

Merge pull request #202 from plone/fix-i18n-issues

Fix i18n of Save and Cancel buttons and the constrain types select values

Files changed:
A news/202.bugfix
M plone/app/content/browser/constraintypes.py

b'diff --git a/news/202.bugfix b/news/202.bugfix\nnew file mode 100644\nindex 0000000..2b4f15c\n--- /dev/null\n+++ b/news/202.bugfix\n@@ -0,0 +1,3 @@\n+Fix i18n of Save and Cancel buttons and the constrain types select values in the folder_constraintypes_form view.\n+This closes https://github.com/plone/Products.CMFPlone/issues/3127\n+[vincentfretin]\ndiff --git a/plone/app/content/browser/constraintypes.py b/plone/app/content/browser/constraintypes.py\nindex 50e9b7b..1daa8c6 100644\n--- a/plone/app/content/browser/constraintypes.py\n+++ b/plone/app/content/browser/constraintypes.py\n@@ -6,6 +6,7 @@\n from z3c.form import button\n from z3c.form import form\n from z3c.form.browser.checkbox import CheckBoxFieldWidget\n+from zope.i18nmessageid import MessageFactory\n from zope.interface import implementer\n from zope.interface import Interface\n from zope.interface import invariant\n@@ -28,19 +29,21 @@\n ENABLED = 1\n \n \n-ST = lambda key, txt, default: SimpleTerm(value=key,\n-                                          title=_(txt, default=default))\n+ST = lambda key, title: SimpleTerm(value=key, title=title)\n+\n+# reuse the translations that we had in atcontenttypes\n+AMF = MessageFactory(\'atcontenttypes\')\n \n possible_constrain_types = SimpleVocabulary([\n     ST(ACQUIRE,\n-       u\'constraintypes_mode_acquire\',\n-       u\'Use parent folder settings\'),\n+       AMF(u\'constraintypes_acquire_label\',\n+         default=u\'Use parent folder settings\')),\n     ST(DISABLED,\n-       \'label_constraintypes_allow_standard\',\n-       u\'Use portal default\'),\n+       AMF(u\'constraintypes_disable_label\',\n+         default=u\'Use portal default\')),\n     ST(ENABLED,\n-       u\'label_constraintypes_specify_manually\',\n-       u\'Select manually\')\n+       AMF(u\'constraintypes_enable_label\',\n+         default=u\'Select manually\'))\n ])\n \n \n@@ -155,7 +158,7 @@ def updateActions(self):\n         super(ConstrainsFormView, self).updateActions()\n         self.actions[\'save\'].addClass(\'context\')\n \n-    @button.buttonAndHandler(u\'Save\')\n+    @button.buttonAndHandler(_(\'label_save\', default=u"Save"), name=\'save\')\n     def handleSave(self, action):\n         data, errors = self.extractData()\n         if errors:\n@@ -174,7 +177,7 @@ def handleSave(self, action):\n         contextURL = self.context.absolute_url()\n         self.request.response.redirect(contextURL)\n \n-    @button.buttonAndHandler(u\'Cancel\')\n+    @button.buttonAndHandler(_(\'label_cancel\', default=u"Cancel"), name=\'cancel\')\n     def handleCancel(self, action):\n         contextURL = self.context.absolute_url()\n         self.request.response.redirect(contextURL)\n'

