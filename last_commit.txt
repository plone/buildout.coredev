Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2020-08-28T11:36:10+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/e90420c05f5ded9cfb787033db3a8fb8afc1b797

Catch deprecation warnings for webdav.LockItem and CMFPlone ILanguageSchema.

The first has been moved to `OFS.LockItem`, the second to `plone.i18n.interfaces`.
In older upgrade code, we should still try the old import first.
I think you should be able to upgrade to Plone 5.0.10 using a more recent `plone.app.upgrade`.

Files changed:
A news/3130.bugfix
M plone/app/upgrade/__init__.py
M plone/app/upgrade/v50/betas.py

b'diff --git a/news/3130.bugfix b/news/3130.bugfix\nnew file mode 100644\nindex 00000000..d119c0d0\n--- /dev/null\n+++ b/news/3130.bugfix\n@@ -0,0 +1,4 @@\n+Catch deprecation warnings for ``webdav.LockItem.LockItem`` and ``CMFPlone.interfaces.ILanguageSchema``.\n+The first has been moved to ``OFS.LockItem``, the second to ``plone.i18n.interfaces``.\n+In older upgrade code, we should still try the old import first.\n+[maurits]\ndiff --git a/plone/app/upgrade/__init__.py b/plone/app/upgrade/__init__.py\nindex d8087937..fc8ced05 100644\n--- a/plone/app/upgrade/__init__.py\n+++ b/plone/app/upgrade/__init__.py\n@@ -5,6 +5,7 @@\n from . import bbbd\n import pkg_resources\n import sys\n+import warnings\n \n \n try:\n@@ -163,9 +164,16 @@\n     sys.modules[\'Products.ResourceRegistries.tools.CSSRegistry\'] = bbb\n     sys.modules[\'Products.ResourceRegistries.tools.JSRegistry\'] = bbb\n \n+\n try:\n-    from webdav.LockItem import LockItem\n-    LockItem  # pyflakes\n+    with warnings.catch_warnings():\n+        # Catch DeprecationWarning:\n+        # "LockItem is deprecated. Please import from OFS.LockItem."\n+        # Depending on which Plone/Zope version we have, webdav may be gone or re-added.\n+        # Anyway, if the import fails, we want to create an alias module.\n+        warnings.simplefilter("ignore")\n+        from webdav.LockItem import LockItem\n+        LockItem  # pyflakes\n except ImportError:\n     from OFS.LockItem import LockItem\n     alias_module(\'webdav.LockItem.LockItem\', LockItem)\ndiff --git a/plone/app/upgrade/v50/betas.py b/plone/app/upgrade/v50/betas.py\nindex 87ae1cb5..435ef4c1 100644\n--- a/plone/app/upgrade/v50/betas.py\n+++ b/plone/app/upgrade/v50/betas.py\n@@ -5,7 +5,6 @@\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.interfaces import ISiteRoot\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces import ILanguageSchema\n from Products.CMFPlone.interfaces import IMailSchema\n from Products.CMFPlone.interfaces import IMarkupSchema\n from Products.CMFPlone.interfaces import INavigationSchema\n@@ -21,6 +20,18 @@\n \n import logging\n import pkg_resources\n+import warnings\n+\n+\n+try:\n+    with warnings.catch_warnings():\n+        # Catch DeprecationWarning:\n+        # "ILanguageSchema is deprecated. It has been moved to plone.i18n.interfaces, import from there instead."\n+        warnings.simplefilter("ignore")\n+        from Products.CMFPlone.interfaces import ILanguageSchema\n+except ImportError:\n+    # Plone 5.2+\n+    from plone.i18n.interfaces import ILanguageSchema\n \n \n logger = logging.getLogger(\'plone.app.upgrade\')\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2020-08-28T14:18:23+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.app.upgrade/commit/98e1f5d16c9212d573b9bdc7f01e5e145edf742a

Merge pull request #237 from plone/maurits/fix-warnings

Catch deprecation warnings for LockItem and ILanguageSchema

Files changed:
A news/3130.bugfix
M plone/app/upgrade/__init__.py
M plone/app/upgrade/v50/betas.py

b'diff --git a/news/3130.bugfix b/news/3130.bugfix\nnew file mode 100644\nindex 00000000..d119c0d0\n--- /dev/null\n+++ b/news/3130.bugfix\n@@ -0,0 +1,4 @@\n+Catch deprecation warnings for ``webdav.LockItem.LockItem`` and ``CMFPlone.interfaces.ILanguageSchema``.\n+The first has been moved to ``OFS.LockItem``, the second to ``plone.i18n.interfaces``.\n+In older upgrade code, we should still try the old import first.\n+[maurits]\ndiff --git a/plone/app/upgrade/__init__.py b/plone/app/upgrade/__init__.py\nindex d8087937..fc8ced05 100644\n--- a/plone/app/upgrade/__init__.py\n+++ b/plone/app/upgrade/__init__.py\n@@ -5,6 +5,7 @@\n from . import bbbd\n import pkg_resources\n import sys\n+import warnings\n \n \n try:\n@@ -163,9 +164,16 @@\n     sys.modules[\'Products.ResourceRegistries.tools.CSSRegistry\'] = bbb\n     sys.modules[\'Products.ResourceRegistries.tools.JSRegistry\'] = bbb\n \n+\n try:\n-    from webdav.LockItem import LockItem\n-    LockItem  # pyflakes\n+    with warnings.catch_warnings():\n+        # Catch DeprecationWarning:\n+        # "LockItem is deprecated. Please import from OFS.LockItem."\n+        # Depending on which Plone/Zope version we have, webdav may be gone or re-added.\n+        # Anyway, if the import fails, we want to create an alias module.\n+        warnings.simplefilter("ignore")\n+        from webdav.LockItem import LockItem\n+        LockItem  # pyflakes\n except ImportError:\n     from OFS.LockItem import LockItem\n     alias_module(\'webdav.LockItem.LockItem\', LockItem)\ndiff --git a/plone/app/upgrade/v50/betas.py b/plone/app/upgrade/v50/betas.py\nindex 87ae1cb5..435ef4c1 100644\n--- a/plone/app/upgrade/v50/betas.py\n+++ b/plone/app/upgrade/v50/betas.py\n@@ -5,7 +5,6 @@\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.interfaces import ISiteRoot\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.interfaces import ILanguageSchema\n from Products.CMFPlone.interfaces import IMailSchema\n from Products.CMFPlone.interfaces import IMarkupSchema\n from Products.CMFPlone.interfaces import INavigationSchema\n@@ -21,6 +20,18 @@\n \n import logging\n import pkg_resources\n+import warnings\n+\n+\n+try:\n+    with warnings.catch_warnings():\n+        # Catch DeprecationWarning:\n+        # "ILanguageSchema is deprecated. It has been moved to plone.i18n.interfaces, import from there instead."\n+        warnings.simplefilter("ignore")\n+        from Products.CMFPlone.interfaces import ILanguageSchema\n+except ImportError:\n+    # Plone 5.2+\n+    from plone.i18n.interfaces import ILanguageSchema\n \n \n logger = logging.getLogger(\'plone.app.upgrade\')\n'

