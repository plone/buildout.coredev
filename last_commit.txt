Repository: plone.app.content


Branch: refs/heads/master
Date: 2024-05-16T22:33:56+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.content/commit/140f32abba2f867962d1facae1f22a43ce098de2

Remove usage of skins script

Files changed:
A news/281.bugfix
M plone/app/content/browser/selection.py

b'diff --git a/news/281.bugfix b/news/281.bugfix\nnew file mode 100644\nindex 00000000..d2de3d9f\n--- /dev/null\n+++ b/news/281.bugfix\n@@ -0,0 +1 @@\n+Remove usage of CMFPlone skins script [@jensens]\ndiff --git a/plone/app/content/browser/selection.py b/plone/app/content/browser/selection.py\nindex aaf5c566..006f7822 100644\n--- a/plone/app/content/browser/selection.py\n+++ b/plone/app/content/browser/selection.py\n@@ -100,9 +100,12 @@ def get_selectable_items(self):\n         view_types = registry.get("plone.types_use_view_action_in_listings", [])\n         default_page_types = registry.get("plone.default_page_types", [])\n         portal_types = getToolByName(self.context, "portal_types")\n+        portal_catalog = getToolByName(self.context, "portal_catalog")\n \n         results = []\n-        for brain in context.getFolderContents():\n+        for brain in portal_catalog(\n+            path={"query": "/".join(context.getPhysicalPath()), "depth": 1}\n+        ):\n             portal_type = brain.portal_type\n             if portal_type in view_types:\n                 # Skip files and images\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2024-05-16T23:20:05+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.content/commit/0b08a9b3b3192b717a8370901e19102df95e140d

rm usage of folder.getFolderContents in test

Files changed:
M plone/app/content/browser/selection.py
M plone/app/content/tests/test_actions.py

b'diff --git a/plone/app/content/browser/selection.py b/plone/app/content/browser/selection.py\nindex 006f782..480010d 100644\n--- a/plone/app/content/browser/selection.py\n+++ b/plone/app/content/browser/selection.py\n@@ -104,7 +104,8 @@ def get_selectable_items(self):\n \n         results = []\n         for brain in portal_catalog(\n-            path={"query": "/".join(context.getPhysicalPath()), "depth": 1}\n+            path={"query": context.absolute_url_path(), "depth": 1},\n+            sort_on="getObjPositionInParent",\n         ):\n             portal_type = brain.portal_type\n             if portal_type in view_types:\ndiff --git a/plone/app/content/tests/test_actions.py b/plone/app/content/tests/test_actions.py\nindex 121b9e3..6962b7c 100644\n--- a/plone/app/content/tests/test_actions.py\n+++ b/plone/app/content/tests/test_actions.py\n@@ -234,7 +234,7 @@ def test_default_page_updated_on_rename(self):\n         self.browser.getControl(name="form.widgets.new_id").value = " ?renamed"\n         self.browser.getControl(name="form.widgets.new_title").value = "Doc"\n         self.browser.getControl(name="form.buttons.Rename").click()\n-        self.assertEqual(folder.getFolderContents()[0].id, "renamed")\n+        self.assertEqual(folder.contentIds()[0], "renamed")\n         self.assertEqual(folder.getDefaultPage(), "renamed")\n \n     def test_rename_form_cancel(self):\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2024-05-17T00:19:45-04:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.content/commit/190e7f6695cb023129f5090dbca078c53b4a990d

Merge pull request #281 from plone/rm-skins-scrip-usage

Remove usage of skins script

Files changed:
A news/281.bugfix
M plone/app/content/browser/selection.py
M plone/app/content/tests/test_actions.py

b'diff --git a/news/281.bugfix b/news/281.bugfix\nnew file mode 100644\nindex 00000000..d2de3d9f\n--- /dev/null\n+++ b/news/281.bugfix\n@@ -0,0 +1 @@\n+Remove usage of CMFPlone skins script [@jensens]\ndiff --git a/plone/app/content/browser/selection.py b/plone/app/content/browser/selection.py\nindex aaf5c566..480010d2 100644\n--- a/plone/app/content/browser/selection.py\n+++ b/plone/app/content/browser/selection.py\n@@ -100,9 +100,13 @@ def get_selectable_items(self):\n         view_types = registry.get("plone.types_use_view_action_in_listings", [])\n         default_page_types = registry.get("plone.default_page_types", [])\n         portal_types = getToolByName(self.context, "portal_types")\n+        portal_catalog = getToolByName(self.context, "portal_catalog")\n \n         results = []\n-        for brain in context.getFolderContents():\n+        for brain in portal_catalog(\n+            path={"query": context.absolute_url_path(), "depth": 1},\n+            sort_on="getObjPositionInParent",\n+        ):\n             portal_type = brain.portal_type\n             if portal_type in view_types:\n                 # Skip files and images\ndiff --git a/plone/app/content/tests/test_actions.py b/plone/app/content/tests/test_actions.py\nindex 121b9e33..6962b7c5 100644\n--- a/plone/app/content/tests/test_actions.py\n+++ b/plone/app/content/tests/test_actions.py\n@@ -234,7 +234,7 @@ def test_default_page_updated_on_rename(self):\n         self.browser.getControl(name="form.widgets.new_id").value = " ?renamed"\n         self.browser.getControl(name="form.widgets.new_title").value = "Doc"\n         self.browser.getControl(name="form.buttons.Rename").click()\n-        self.assertEqual(folder.getFolderContents()[0].id, "renamed")\n+        self.assertEqual(folder.contentIds()[0], "renamed")\n         self.assertEqual(folder.getDefaultPage(), "renamed")\n \n     def test_rename_form_cancel(self):\n'

