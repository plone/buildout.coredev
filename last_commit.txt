Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2021-03-12T11:51:31+01:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/c3ce536b7e5ffa205b6ab84594070fb41311deb9

Make any ctl script python-env aware

Files changed:
A news/162.feature
M setup.py
M src/plone/recipe/zope2instance/ctl.py

b'diff --git a/news/162.feature b/news/162.feature\nnew file mode 100644\nindex 0000000..59c858e\n--- /dev/null\n+++ b/news/162.feature\n@@ -0,0 +1,2 @@\n+Make any ctl script python-env aware\n+[sneridagh]\ndiff --git a/setup.py b/setup.py\nindex 206ffe9..6dbc7ab 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -50,6 +50,7 @@\n         \'ZEO\',\n         \'waitress >= 1.2.0\',\n         \'Paste\',\n+        \'python-dotenv\'\n     ],\n     extras_require={\n         \'test\': [\ndiff --git a/src/plone/recipe/zope2instance/ctl.py b/src/plone/recipe/zope2instance/ctl.py\nindex 2dea043..d36af26 100644\n--- a/src/plone/recipe/zope2instance/ctl.py\n+++ b/src/plone/recipe/zope2instance/ctl.py\n@@ -27,6 +27,7 @@\n available actions.\n """\n \n+from dotenv import load_dotenv\n from pkg_resources import iter_entry_points\n from time import sleep\n from waitress.wasyncore import dispatcher\n@@ -942,6 +943,8 @@ def main(args=None):\n         options = WSGICtlOptions()\n     else:\n         options = ZServerCtlOptions()\n+\n+\n     options.add(name="no_request", short="R", long="no-request", flag=1)\n     options.add(name="no_login", short="L", long="no-login", flag=1)\n     options.add(name="object_path", short="O:", long="object-path=")\n@@ -949,6 +952,12 @@ def main(args=None):\n     # Realize arguments and set documentation which is used in the -h option\n     options.realize(args, doc=__doc__)\n \n+    load_dotenv(os.path.join(options.directory, \'..\', \'..\', \'.env\'))\n+\n+    if (os.environ.get(\'PLONE_ENV\')):\n+        PLONE_ENV = os.environ.get(\'PLONE_ENV\')\n+        load_dotenv(os.path.join(options.directory, \'..\', \'..\', \'.env.{}\'.format(PLONE_ENV)))\n+\n     # Run the right command depending on whether we have ZServer\n     options.interpreter = os.path.join(options.directory, \'bin\', \'interpreter\')\n     if sys.platform == \'win32\':\n'

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2021-03-12T11:51:31+01:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/0dbca3aa7d61aed0eeda997314e70d2d382cae23

Remove line

Files changed:
M src/plone/recipe/zope2instance/ctl.py

b'diff --git a/src/plone/recipe/zope2instance/ctl.py b/src/plone/recipe/zope2instance/ctl.py\nindex d36af26..35ecd90 100644\n--- a/src/plone/recipe/zope2instance/ctl.py\n+++ b/src/plone/recipe/zope2instance/ctl.py\n@@ -944,7 +944,6 @@ def main(args=None):\n     else:\n         options = ZServerCtlOptions()\n \n-\n     options.add(name="no_request", short="R", long="no-request", flag=1)\n     options.add(name="no_login", short="L", long="no-login", flag=1)\n     options.add(name="object_path", short="O:", long="object-path=")\n'

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2021-03-12T12:32:00+01:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/9b2052b08b6d1a3947c7d5988dd22bf0468e7745

Merge pull request #163 from plone/python-dotenv

Make any ctl script python-dotenv (.env files) aware

Files changed:
A news/162.feature
M setup.py
M src/plone/recipe/zope2instance/ctl.py

b'diff --git a/news/162.feature b/news/162.feature\nnew file mode 100644\nindex 0000000..59c858e\n--- /dev/null\n+++ b/news/162.feature\n@@ -0,0 +1,2 @@\n+Make any ctl script python-env aware\n+[sneridagh]\ndiff --git a/setup.py b/setup.py\nindex 206ffe9..6dbc7ab 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -50,6 +50,7 @@\n         \'ZEO\',\n         \'waitress >= 1.2.0\',\n         \'Paste\',\n+        \'python-dotenv\'\n     ],\n     extras_require={\n         \'test\': [\ndiff --git a/src/plone/recipe/zope2instance/ctl.py b/src/plone/recipe/zope2instance/ctl.py\nindex 2dea043..35ecd90 100644\n--- a/src/plone/recipe/zope2instance/ctl.py\n+++ b/src/plone/recipe/zope2instance/ctl.py\n@@ -27,6 +27,7 @@\n available actions.\n """\n \n+from dotenv import load_dotenv\n from pkg_resources import iter_entry_points\n from time import sleep\n from waitress.wasyncore import dispatcher\n@@ -942,6 +943,7 @@ def main(args=None):\n         options = WSGICtlOptions()\n     else:\n         options = ZServerCtlOptions()\n+\n     options.add(name="no_request", short="R", long="no-request", flag=1)\n     options.add(name="no_login", short="L", long="no-login", flag=1)\n     options.add(name="object_path", short="O:", long="object-path=")\n@@ -949,6 +951,12 @@ def main(args=None):\n     # Realize arguments and set documentation which is used in the -h option\n     options.realize(args, doc=__doc__)\n \n+    load_dotenv(os.path.join(options.directory, \'..\', \'..\', \'.env\'))\n+\n+    if (os.environ.get(\'PLONE_ENV\')):\n+        PLONE_ENV = os.environ.get(\'PLONE_ENV\')\n+        load_dotenv(os.path.join(options.directory, \'..\', \'..\', \'.env.{}\'.format(PLONE_ENV)))\n+\n     # Run the right command depending on whether we have ZServer\n     options.interpreter = os.path.join(options.directory, \'bin\', \'interpreter\')\n     if sys.platform == \'win32\':\n'

