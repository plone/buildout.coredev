Repository: plone.app.content


Branch: refs/heads/master
Date: 2020-07-06T12:21:18+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.content/commit/60ec0b0b2004fe9502e86548a19a4b9c07d7dabc

expose pickadate pattern options in property editing template

Files changed:
M plone/app/content/browser/contents/properties.py
M plone/app/content/browser/contents/templates/properties.pt

b'diff --git a/plone/app/content/browser/contents/properties.py b/plone/app/content/browser/contents/properties.py\nindex a017f51..bb9d91e 100644\n--- a/plone/app/content/browser/contents/properties.py\n+++ b/plone/app/content/browser/contents/properties.py\n@@ -3,6 +3,7 @@\n from plone.app.content.browser.contents import ContentsBaseAction\n from plone.app.content.interfaces import IStructureAction\n from plone.app.dexterity.behaviors.metadata import ICategorization\n+from plone.app.widgets.utils import get_datetime_options\n from plone.dexterity.interfaces import IDexterityContent\n from Products.CMFCore.interfaces._content import IFolderish\n from Products.CMFCore.utils import getToolByName\n@@ -14,6 +15,8 @@\n from zope.interface import implementer\n from zope.schema.interfaces import IVocabularyFactory\n \n+import json\n+\n \n @implementer(IStructureAction)\n class PropertiesAction(object):\n@@ -36,13 +39,13 @@ def get_options(self):\n                 \'title\': translate(_(\'Modify properties on items\'), context=self.request),\n                 \'template\': self.template(\n                     vocabulary_url=\'%splone.app.vocabularies.Users\' % (\n-                        base_vocabulary)\n+                        base_vocabulary),\n+                    pattern_options=json.dumps(get_datetime_options(self.request))\n                 ),\n                 \'dataUrl\': self.context.absolute_url() + \'/@@fc-properties\',\n             }\n         }\n \n-\n class PropertiesActionView(ContentsBaseAction):\n     success_msg = _(u\'Successfully updated metadata\')\n     failure_msg = _(u\'Failure updating metadata\')\ndiff --git a/plone/app/content/browser/contents/templates/properties.pt b/plone/app/content/browser/contents/templates/properties.pt\nindex 09c86ef..618e7c6 100644\n--- a/plone/app/content/browser/contents/templates/properties.pt\n+++ b/plone/app/content/browser/contents/templates/properties.pt\n@@ -2,12 +2,12 @@\n \n   <div class="form-group">\n     <label i18n:translate="publiciation_date">Publication Date</label>\n-    <input class="form-control pat-pickadate" name="effectiveDate" />\n+    <input class="form-control pat-pickadate" name="effectiveDate" tal:attributes="data-pat-pickadate options/pattern_options"/>\n   </div>\n \n   <div class="form-group">\n     <label i18n:translate="expiration_date">Expiration Date</label>\n-    <input class="form-control pat-pickadate" name="expirationDate" />\n+    <input class="form-control pat-pickadate" name="expirationDate" tal:attributes="data-pat-pickadate options/pattern_options"/>\n   </div>\n \n   <div class="form-group">\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2020-07-06T12:35:24+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.content/commit/48ccd00cbda35e490711d8a0cbe3c746b784d794

changelog

Files changed:
A news/206.bugfix

b'diff --git a/news/206.bugfix b/news/206.bugfix\nnew file mode 100644\nindex 0000000..a23a782\n--- /dev/null\n+++ b/news/206.bugfix\n@@ -0,0 +1,2 @@\n+Expose pickadate configuration in folder_contents properties dialog to properly localize the date. This fixes https://github.com/plone/Products.CMFPlone/issues/850\n+[erral]\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2020-07-06T17:46:11+02:00
Author: Vincent Fretin (vincentfretin) <vincent.fretin@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/a3a62d005e26397e2a04763eb56a350047a7dde1

Merge pull request #206 from plone/erral-datepicker-fc

Expose pickadate configuration in folder_contents properties dialog to properly localize the date.

Files changed:
A news/206.bugfix
M plone/app/content/browser/contents/properties.py
M plone/app/content/browser/contents/templates/properties.pt

b'diff --git a/news/206.bugfix b/news/206.bugfix\nnew file mode 100644\nindex 0000000..a23a782\n--- /dev/null\n+++ b/news/206.bugfix\n@@ -0,0 +1,2 @@\n+Expose pickadate configuration in folder_contents properties dialog to properly localize the date. This fixes https://github.com/plone/Products.CMFPlone/issues/850\n+[erral]\ndiff --git a/plone/app/content/browser/contents/properties.py b/plone/app/content/browser/contents/properties.py\nindex a017f51..bb9d91e 100644\n--- a/plone/app/content/browser/contents/properties.py\n+++ b/plone/app/content/browser/contents/properties.py\n@@ -3,6 +3,7 @@\n from plone.app.content.browser.contents import ContentsBaseAction\n from plone.app.content.interfaces import IStructureAction\n from plone.app.dexterity.behaviors.metadata import ICategorization\n+from plone.app.widgets.utils import get_datetime_options\n from plone.dexterity.interfaces import IDexterityContent\n from Products.CMFCore.interfaces._content import IFolderish\n from Products.CMFCore.utils import getToolByName\n@@ -14,6 +15,8 @@\n from zope.interface import implementer\n from zope.schema.interfaces import IVocabularyFactory\n \n+import json\n+\n \n @implementer(IStructureAction)\n class PropertiesAction(object):\n@@ -36,13 +39,13 @@ def get_options(self):\n                 \'title\': translate(_(\'Modify properties on items\'), context=self.request),\n                 \'template\': self.template(\n                     vocabulary_url=\'%splone.app.vocabularies.Users\' % (\n-                        base_vocabulary)\n+                        base_vocabulary),\n+                    pattern_options=json.dumps(get_datetime_options(self.request))\n                 ),\n                 \'dataUrl\': self.context.absolute_url() + \'/@@fc-properties\',\n             }\n         }\n \n-\n class PropertiesActionView(ContentsBaseAction):\n     success_msg = _(u\'Successfully updated metadata\')\n     failure_msg = _(u\'Failure updating metadata\')\ndiff --git a/plone/app/content/browser/contents/templates/properties.pt b/plone/app/content/browser/contents/templates/properties.pt\nindex 09c86ef..618e7c6 100644\n--- a/plone/app/content/browser/contents/templates/properties.pt\n+++ b/plone/app/content/browser/contents/templates/properties.pt\n@@ -2,12 +2,12 @@\n \n   <div class="form-group">\n     <label i18n:translate="publiciation_date">Publication Date</label>\n-    <input class="form-control pat-pickadate" name="effectiveDate" />\n+    <input class="form-control pat-pickadate" name="effectiveDate" tal:attributes="data-pat-pickadate options/pattern_options"/>\n   </div>\n \n   <div class="form-group">\n     <label i18n:translate="expiration_date">Expiration Date</label>\n-    <input class="form-control pat-pickadate" name="expirationDate" />\n+    <input class="form-control pat-pickadate" name="expirationDate" tal:attributes="data-pat-pickadate options/pattern_options"/>\n   </div>\n \n   <div class="form-group">\n'

