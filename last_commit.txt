Repository: plone.dexterity


Branch: refs/heads/master
Date: 2021-11-16T12:31:27+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.dexterity/commit/41e9ae84923bc8e5aaec911107148c2ccde7cff0

fix: avoid setting a default value on methods

If a Schema Interface has a method in it, i.e. to be used as a
constraint for another field, etc. the  function
would trip over it while trying to get a default value for it.

picked from https://github.com/plone/plone.dexterity/commit/80735b5563bed96f67557b328eb31db6acf6c283

Files changed:
A news/158.bugfix
M plone/dexterity/content.py

b'diff --git a/news/158.bugfix b/news/158.bugfix\nnew file mode 100644\nindex 0000000..bd65468\n--- /dev/null\n+++ b/news/158.bugfix\n@@ -0,0 +1,5 @@\n+Avoid setting a default value on methods.\n+If a Schema Interface has a method in it, i.e. to be used as a\n+constraint for another field, etc. the `default_from_schema` function\n+would trip over it while trying to get a default value for it.\n+[gforcada, jensens]\ndiff --git a/plone/dexterity/content.py b/plone/dexterity/content.py\nindex e3b3b1a..3e5fd72 100644\n--- a/plone/dexterity/content.py\n+++ b/plone/dexterity/content.py\n@@ -46,6 +46,7 @@\n from zope.interface.declarations import implementedBy\n from zope.interface.declarations import Implements\n from zope.interface.declarations import ObjectSpecificationDescriptor\n+from zope.interface.interface import Method\n from zope.schema.interfaces import IContextAwareDefaultFactory\n from zope.security.interfaces import IPermission\n \n@@ -82,7 +83,7 @@ def _default_from_schema(context, schema, fieldname):\n     if schema is None:\n         return _marker\n     field = schema.get(fieldname, None)\n-    if field is None:\n+    if field is None or isinstance(field, Method):\n         return _marker\n     default_factory = getattr(field, "defaultFactory", None)\n     if (\n'

Repository: plone.dexterity


Branch: refs/heads/master
Date: 2021-11-18T22:37:11+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.dexterity/commit/94bfd7031ee5bb5b6add372495934ef4d3cd3b37

Merge pull request #158 from plone/fix-default-on-methods

fix: avoid setting a default value on methods

Files changed:
A news/158.bugfix
M plone/dexterity/content.py

b'diff --git a/news/158.bugfix b/news/158.bugfix\nnew file mode 100644\nindex 0000000..bd65468\n--- /dev/null\n+++ b/news/158.bugfix\n@@ -0,0 +1,5 @@\n+Avoid setting a default value on methods.\n+If a Schema Interface has a method in it, i.e. to be used as a\n+constraint for another field, etc. the `default_from_schema` function\n+would trip over it while trying to get a default value for it.\n+[gforcada, jensens]\ndiff --git a/plone/dexterity/content.py b/plone/dexterity/content.py\nindex e3b3b1a..3e5fd72 100644\n--- a/plone/dexterity/content.py\n+++ b/plone/dexterity/content.py\n@@ -46,6 +46,7 @@\n from zope.interface.declarations import implementedBy\n from zope.interface.declarations import Implements\n from zope.interface.declarations import ObjectSpecificationDescriptor\n+from zope.interface.interface import Method\n from zope.schema.interfaces import IContextAwareDefaultFactory\n from zope.security.interfaces import IPermission\n \n@@ -82,7 +83,7 @@ def _default_from_schema(context, schema, fieldname):\n     if schema is None:\n         return _marker\n     field = schema.get(fieldname, None)\n-    if field is None:\n+    if field is None or isinstance(field, Method):\n         return _marker\n     default_factory = getattr(field, "defaultFactory", None)\n     if (\n'

