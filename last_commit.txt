Repository: Products.PlonePAS


Branch: refs/heads/6.x
Date: 2021-07-01T16:27:01+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.PlonePAS/commit/54cef6698f2b7a7e6c256573c30bf7bbb3ff835f

Fixed tests for cookie auth to also work with zope.interface 5.3.0.

This uses simpler representations for interfaces.
Tests now pass with earlier and later versions.

Original error from [Jenkins](https://jenkins.plone.org/job/pull-request-5.2-3.6/1938/testReport/junit/Products.PlonePAS/tests/cookie_auth_rst/):

```
File "/home/jenkins/.buildout/eggs/cp36m/Products.PlonePAS-6.0.7-py3.6.egg/Products/PlonePAS/tests/cookie_auth.rst", line 55, in cookie_auth.rst
Failed example:
    for active, iface in actives:
        print(iface)
        for id, plugin in active:
            if id == 'credentials_cookie_auth':
               print(True)
Expected:
    &lt;...IExtraction...&gt;...True
    &lt;...IChallenge...&gt;...True
    &lt;...ICredentialsUpdate...&gt;...&lt;...ICredentialsReset...&gt;
Got:
    Products.PluggableAuthService.interfaces.plugins.IExtractionPlugin
    True
    Products.PluggableAuthService.interfaces.plugins.IChallengePlugin
    True
    Products.PluggableAuthService.interfaces.plugins.ICredentialsUpdatePlugin
    Products.PluggableAuthService.interfaces.plugins.ICredentialsResetPlugin
```

The fix is to print `iface.__name__`, which looks the same in all versions.

Files changed:
A news/237.bugfix
M src/Products/PlonePAS/tests/cookie_auth.rst

b"diff --git a/news/237.bugfix b/news/237.bugfix\nnew file mode 100644\nindex 00000000..41512c2e\n--- /dev/null\n+++ b/news/237.bugfix\n@@ -0,0 +1,4 @@\n+Fixed tests for cookie auth to also work with `zope.interface` 5.3.0.\n+This uses simpler representations for interfaces.\n+Tests now pass with earlier and later versions.\n+[maurits]\ndiff --git a/src/Products/PlonePAS/tests/cookie_auth.rst b/src/Products/PlonePAS/tests/cookie_auth.rst\nindex fb92ceee..21b3b2f6 100644\n--- a/src/Products/PlonePAS/tests/cookie_auth.rst\n+++ b/src/Products/PlonePAS/tests/cookie_auth.rst\n@@ -53,13 +53,16 @@ Make sure cookie plugin is installed and activated.\n   ...       pass\n \n   >>> for active, iface in actives:\n-  ...     print(iface)\n+  ...     print(iface.__name__)\n   ...     for id, plugin in active:\n   ...         if id == 'credentials_cookie_auth':\n   ...            print(True)\n-  <...IExtraction...>...True\n-  <...IChallenge...>...True\n-  <...ICredentialsUpdate...>...<...ICredentialsReset...>\n+  IExtractionPlugin\n+  True\n+  IChallengePlugin\n+  True\n+  ICredentialsUpdatePlugin\n+  ICredentialsResetPlugin\n \n User in parent folder\n ---------------------\n"

Repository: Products.PlonePAS


Branch: refs/heads/6.x
Date: 2021-07-02T08:50:12+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.PlonePAS/commit/a2ed9fbaa17d48937d4ca0967fff9443bf24ef7e

Merge pull request #62 from plone/maurits/fix-interface-repr-tests

Fixed tests for cookie auth to also work with zope.interface 5.3.0. [6.x]

Files changed:
A news/237.bugfix
M src/Products/PlonePAS/tests/cookie_auth.rst

b"diff --git a/news/237.bugfix b/news/237.bugfix\nnew file mode 100644\nindex 00000000..41512c2e\n--- /dev/null\n+++ b/news/237.bugfix\n@@ -0,0 +1,4 @@\n+Fixed tests for cookie auth to also work with `zope.interface` 5.3.0.\n+This uses simpler representations for interfaces.\n+Tests now pass with earlier and later versions.\n+[maurits]\ndiff --git a/src/Products/PlonePAS/tests/cookie_auth.rst b/src/Products/PlonePAS/tests/cookie_auth.rst\nindex fb92ceee..21b3b2f6 100644\n--- a/src/Products/PlonePAS/tests/cookie_auth.rst\n+++ b/src/Products/PlonePAS/tests/cookie_auth.rst\n@@ -53,13 +53,16 @@ Make sure cookie plugin is installed and activated.\n   ...       pass\n \n   >>> for active, iface in actives:\n-  ...     print(iface)\n+  ...     print(iface.__name__)\n   ...     for id, plugin in active:\n   ...         if id == 'credentials_cookie_auth':\n   ...            print(True)\n-  <...IExtraction...>...True\n-  <...IChallenge...>...True\n-  <...ICredentialsUpdate...>...<...ICredentialsReset...>\n+  IExtractionPlugin\n+  True\n+  IChallengePlugin\n+  True\n+  ICredentialsUpdatePlugin\n+  ICredentialsResetPlugin\n \n User in parent folder\n ---------------------\n"

