Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-11-09T16:07:51+01:00
Author: Wesley Barroso Lopes (wesleybl) <wesleybl@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/ebef527a95cba82af777f1dba45a7bd4c482eda3

Fix tests in Travis (#1013)

* gitignore

* Pin virtualenv = 20.0.35

Fix:

    Error: The requirement ('virtualenv&gt;=20.0.35') is not allowed by
your [versions] constraint (20.0.26)
virtualenv = 20.0.35

See:

https://travis-ci.org/github/plone/plone.restapi/jobs/742090297#L251

* Pinn pep517 = 0.9.1

Fix:

    Error: The requirement ('pep517&gt;=0.9') is not allowed by your
[versions] constraint (0.8.2)

See:

https://travis-ci.org/github/plone/plone.restapi/jobs/742090298#L250

* Use virtualenv in Travis tests

After the requirement virtualenv&gt;=20.0.35, the version of virtualenv
installed in Python 2 of Travis  started to conflict with the version
required in the buildout.

Fix:

    ContextualVersionConflict: (virtualenv 16.1.0
(/home/travis/virtualenv/python2.7.15/lib/python2.7/site-packages),
Requirement.parse('virtualenv&gt;=20.0.35'), set(['build']))

See:

https://travis-ci.org/github/plone/plone.restapi/jobs/742109179#L270

* Pinn importlib-metadata = 2.0.0

Fix:

    Error: The requirement ('importlib-metadata&gt;=1') is not allowed by
your [versions] constraint (0.23)

See:

https://travis-ci.org/github/plone/plone.restapi/jobs/742116716

Files changed:
A news/1012.bugfix
M .gitignore
M .travis.yml
M plone-5.2.x.cfg

b'diff --git a/.gitignore b/.gitignore\nindex f90d5882f..670eb3e9d 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -37,3 +37,4 @@ pip-selfcheck.json\n /.vscode\n /.ipython\n /.mypy_cache/\n+.*project\ndiff --git a/.travis.yml b/.travis.yml\nindex 503adfbcb..575208640 100644\n--- a/.travis.yml\n+++ b/.travis.yml\n@@ -47,10 +47,11 @@ before_install:\n   - echo "[buildout]" > $HOME/.buildout/default.cfg\n   - echo "download-cache = $HOME/buildout-cache/downloads" >> $HOME/.buildout/default.cfg\n   - echo "eggs-directory = $HOME/buildout-cache/eggs" >> $HOME/.buildout/default.cfg\n-  - pip install -r requirements.txt\n+  - virtualenv -p `which python` .\n+  - bin/pip install -r requirements.txt\n install:\n   - sed -ie "s#plone-x.x.x.cfg#plone-$PLONE_VERSION.cfg#" travis.cfg\n-  - buildout -t 10 -c travis.cfg\n+  - bin/buildout -t 10 -c travis.cfg\n script:\n   - if [ "$PLONE_VERSION" == "5.2.x" ] && [ $TRAVIS_PYTHON_VERSION == \'3.7\' ]; then pip install black && black src/ --check; fi\n   - bin/code-analysis\ndiff --git a/news/1012.bugfix b/news/1012.bugfix\nnew file mode 100644\nindex 000000000..7dcf5a097\n--- /dev/null\n+++ b/news/1012.bugfix\n@@ -0,0 +1,2 @@\n+- Fix tests in Travis.\n+  [wesleybl]\ndiff --git a/plone-5.2.x.cfg b/plone-5.2.x.cfg\nindex 9ba3532db..3ece3b833 100644\n--- a/plone-5.2.x.cfg\n+++ b/plone-5.2.x.cfg\n@@ -16,4 +16,13 @@ plone.schema = 1.2.1\n # requirement for the @types endpoint enhancements\n # https://github.com/plone/plone.restapi/pull/951\n # https://github.com/plone/plone.schemaeditor/pull/77\n-plone.schemaeditor = 3.0.1\n\\ No newline at end of file\n+plone.schemaeditor = 3.0.1\n+\n+# Error: The requirement (\'importlib-metadata>=1\') is not allowed by your [versions] constraint (0.23)\n+importlib-metadata = 2.0.0\n+\n+# Error: The requirement (\'pep517>=0.9\') is not allowed by your [versions] constraint (0.8.2)\n+pep517 = 0.9.1\n+\n+# Error: The requirement (\'virtualenv>=20.0.35\') is not allowed by your [versions] constraint (20.0.26)\n+virtualenv = 20.0.35\n'

