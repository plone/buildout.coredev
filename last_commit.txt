Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2024-02-06T10:40:34+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.z3cform/commit/8edc52acf1b1551f82169ff7859f89f189dccf44

Fix `SelectFieldWidget` factory call from `plone.autoform`

Files changed:
M plone/app/z3cform/tests/test_widgets.py
M plone/app/z3cform/widgets/select.py

b'diff --git a/plone/app/z3cform/tests/test_widgets.py b/plone/app/z3cform/tests/test_widgets.py\nindex c063a3d..4cb6ebf 100644\n--- a/plone/app/z3cform/tests/test_widgets.py\n+++ b/plone/app/z3cform/tests/test_widgets.py\n@@ -571,17 +571,19 @@ def setUp(self):\n         self.request = self.layer["request"]\n \n     def test_select_widget(self):\n+        from plone.app.z3cform.widgets.select import SelectFieldWidget\n         from plone.app.z3cform.widgets.select import SelectWidget\n \n-        widget = SelectWidget(self.request)\n-        widget.id = "test-widget"\n-        widget.name = "selectfield-widget"\n-        widget.field = Choice(\n+        field = Choice(\n             __name__="selectfield",\n             values=["one", "two", "three"],\n+            required=True,\n         )\n-        widget.terms = widget.field.vocabulary\n-        widget.field.required = True\n+        widget = SelectFieldWidget(field, self.request)\n+        widget.id = "test-widget"\n+        widget.name = "selectfield-widget"\n+        widget.terms = field.vocabulary\n+        self.assertTrue(isinstance(widget, SelectWidget))\n         self.assertEqual(\n             {\n                 "pattern_options": {},\ndiff --git a/plone/app/z3cform/widgets/select.py b/plone/app/z3cform/widgets/select.py\nindex 4fbd055..5f4604f 100644\n--- a/plone/app/z3cform/widgets/select.py\n+++ b/plone/app/z3cform/widgets/select.py\n@@ -34,14 +34,16 @@ class SelectWidget(HTMLSelectWidget, SelectWidgetBase):\n \n \n @implementer(IFieldWidget)\n-def SelectFieldWidget(field, source, request):\n+def SelectFieldWidget(field, request, extra=None):\n+    if extra is not None:\n+        request = extra\n     return FieldWidget(field, SelectWidget(request))\n \n \n @implementer(IFieldWidget)\n def CollectionChoiceSelectFieldWidget(field, value_type, request):\n     """IFieldWidget factory for SelectWidget."""\n-    return SelectFieldWidget(field, None, request)\n+    return SelectFieldWidget(field, request)\n \n \n @implementer_only(ISelect2Widget)\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2024-02-06T10:42:56+01:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.z3cform/commit/e6f1e92dc7e917fb6ca0d5aaf8e8de9ae9479622

changenote

Files changed:
A news/192.bugfix

b'diff --git a/news/192.bugfix b/news/192.bugfix\nnew file mode 100644\nindex 0000000..bbfe8c6\n--- /dev/null\n+++ b/news/192.bugfix\n@@ -0,0 +1,2 @@\n+Fix `SelectFieldWidget` factory call.\n+[petschki]\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2024-03-14T07:35:04+01:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/7a80bc4c827db326ee298755ad879e991a8b19d3

Merge pull request #192 from plone/autoform-widget-factory

Fix `SelectFieldWidget` factory call from `plone.autoform`

Files changed:
A news/192.bugfix
M plone/app/z3cform/tests/test_widgets.py
M plone/app/z3cform/widgets/select.py

b'diff --git a/news/192.bugfix b/news/192.bugfix\nnew file mode 100644\nindex 00000000..bbfe8c67\n--- /dev/null\n+++ b/news/192.bugfix\n@@ -0,0 +1,2 @@\n+Fix `SelectFieldWidget` factory call.\n+[petschki]\ndiff --git a/plone/app/z3cform/tests/test_widgets.py b/plone/app/z3cform/tests/test_widgets.py\nindex c063a3d2..4cb6ebf1 100644\n--- a/plone/app/z3cform/tests/test_widgets.py\n+++ b/plone/app/z3cform/tests/test_widgets.py\n@@ -571,17 +571,19 @@ def setUp(self):\n         self.request = self.layer["request"]\n \n     def test_select_widget(self):\n+        from plone.app.z3cform.widgets.select import SelectFieldWidget\n         from plone.app.z3cform.widgets.select import SelectWidget\n \n-        widget = SelectWidget(self.request)\n-        widget.id = "test-widget"\n-        widget.name = "selectfield-widget"\n-        widget.field = Choice(\n+        field = Choice(\n             __name__="selectfield",\n             values=["one", "two", "three"],\n+            required=True,\n         )\n-        widget.terms = widget.field.vocabulary\n-        widget.field.required = True\n+        widget = SelectFieldWidget(field, self.request)\n+        widget.id = "test-widget"\n+        widget.name = "selectfield-widget"\n+        widget.terms = field.vocabulary\n+        self.assertTrue(isinstance(widget, SelectWidget))\n         self.assertEqual(\n             {\n                 "pattern_options": {},\ndiff --git a/plone/app/z3cform/widgets/select.py b/plone/app/z3cform/widgets/select.py\nindex 4fbd0559..5f4604fc 100644\n--- a/plone/app/z3cform/widgets/select.py\n+++ b/plone/app/z3cform/widgets/select.py\n@@ -34,14 +34,16 @@ class SelectWidget(HTMLSelectWidget, SelectWidgetBase):\n \n \n @implementer(IFieldWidget)\n-def SelectFieldWidget(field, source, request):\n+def SelectFieldWidget(field, request, extra=None):\n+    if extra is not None:\n+        request = extra\n     return FieldWidget(field, SelectWidget(request))\n \n \n @implementer(IFieldWidget)\n def CollectionChoiceSelectFieldWidget(field, value_type, request):\n     """IFieldWidget factory for SelectWidget."""\n-    return SelectFieldWidget(field, None, request)\n+    return SelectFieldWidget(field, request)\n \n \n @implementer_only(ISelect2Widget)\n'

