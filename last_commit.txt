Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2020-11-16T11:44:23+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.dexterity/commit/b11b514fb7b79301a5562a6b63150553bf6ece2d

For increased security, in the modeleditor do not resolve entities, and remove processing instructions.

See https://github.com/plone/Products.CMFPlone/issues/3209

Files changed:
A news/3209.bugfix
M plone/app/dexterity/browser/modeleditor.py

b"diff --git a/news/3209.bugfix b/news/3209.bugfix\nnew file mode 100644\nindex 0000000..848c253\n--- /dev/null\n+++ b/news/3209.bugfix\n@@ -0,0 +1,2 @@\n+For increased security, in the modeleditor do not resolve entities, and remove processing instructions.\n+[maurits]\ndiff --git a/plone/app/dexterity/browser/modeleditor.py b/plone/app/dexterity/browser/modeleditor.py\nindex 21ecc39..c132a7a 100644\n--- a/plone/app/dexterity/browser/modeleditor.py\n+++ b/plone/app/dexterity/browser/modeleditor.py\n@@ -42,8 +42,12 @@ def __call__(self):\n         source = self.request.form.get('source')\n         if source:\n             # Is it valid XML?\n+            # Some safety measures.\n+            # We do not want to load entities, especially file:/// entities.\n+            # Also discard processing instructions.\n+            parser = etree.XMLParser(resolve_entities=False, remove_pis=True)\n             try:\n-                root = etree.fromstring(source)\n+                root = etree.fromstring(source, parser=parser)\n             except etree.XMLSyntaxError as e:\n                 return json.dumps({\n                     'success': False,\n"

Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2020-11-16T21:17:35+01:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.app.dexterity/commit/69b9c3121e1740fc0082f3537bf9b564372551f4

Merge pull request #317 from plone/maurits/cmfplone-issue-3209-lxml

Modeleditor: do not resolve entities, to avoid xml vulnerabilities

Files changed:
A news/3209.bugfix
M plone/app/dexterity/browser/modeleditor.py

b"diff --git a/news/3209.bugfix b/news/3209.bugfix\nnew file mode 100644\nindex 0000000..848c253\n--- /dev/null\n+++ b/news/3209.bugfix\n@@ -0,0 +1,2 @@\n+For increased security, in the modeleditor do not resolve entities, and remove processing instructions.\n+[maurits]\ndiff --git a/plone/app/dexterity/browser/modeleditor.py b/plone/app/dexterity/browser/modeleditor.py\nindex 21ecc39..c132a7a 100644\n--- a/plone/app/dexterity/browser/modeleditor.py\n+++ b/plone/app/dexterity/browser/modeleditor.py\n@@ -42,8 +42,12 @@ def __call__(self):\n         source = self.request.form.get('source')\n         if source:\n             # Is it valid XML?\n+            # Some safety measures.\n+            # We do not want to load entities, especially file:/// entities.\n+            # Also discard processing instructions.\n+            parser = etree.XMLParser(resolve_entities=False, remove_pis=True)\n             try:\n-                root = etree.fromstring(source)\n+                root = etree.fromstring(source, parser=parser)\n             except etree.XMLSyntaxError as e:\n                 return json.dumps({\n                     'success': False,\n"

