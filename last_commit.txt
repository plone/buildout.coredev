Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2024-07-26T00:31:15+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/2d9384b76a581e1b30ece516a583cb5d488286d6

6.1: Remove the portal_properties tool completely.

This tool is deprecated, and we said we would remove it in 6.1.

Files changed:
A news/125.bugfix
A plone/app/upgrade/v61/final.py
M plone/app/upgrade/v61/configure.zcml

b'diff --git a/news/125.bugfix b/news/125.bugfix\nnew file mode 100644\nindex 00000000..9296abf6\n--- /dev/null\n+++ b/news/125.bugfix\n@@ -0,0 +1,3 @@\n+6.1: Remove the portal_properties tool completely.\n+This tool is deprecated, and we said we would remove it in 6.1.\n+[maurits]\ndiff --git a/plone/app/upgrade/v61/configure.zcml b/plone/app/upgrade/v61/configure.zcml\nindex 2512c3f2..7708f4c1 100644\n--- a/plone/app/upgrade/v61/configure.zcml\n+++ b/plone/app/upgrade/v61/configure.zcml\n@@ -54,15 +54,14 @@\n       destination="6103"\n       >\n     <!-- Plone 6.1.0a4 -->\n-    <gs:upgradeStep\n-        title="Miscellaneous"\n-        handler="..utils.null_upgrade_step"\n-        />\n-\n     <gs:upgradeDepends\n       title="Run to6103 upgrade profile."\n       import_profile="plone.app.upgrade.v61:to6103"\n       />\n+    <gs:upgradeStep\n+        title="Remove the portal_properties tool."\n+        handler=".final.remove_portal_properties_tool"\n+        />\n   </gs:upgradeSteps>\n \n </configure>\ndiff --git a/plone/app/upgrade/v61/final.py b/plone/app/upgrade/v61/final.py\nnew file mode 100644\nindex 00000000..f3fa8ef2\n--- /dev/null\n+++ b/plone/app/upgrade/v61/final.py\n@@ -0,0 +1,23 @@\n+from Products.CMFCore.utils import getToolByName\n+\n+import logging\n+\n+\n+logger = logging.getLogger(__name__)\n+\n+\n+def remove_portal_properties_tool(context):\n+    """Remove the portal_properties tool.\n+\n+    Core Plone has moved to the configuration registry in Plone 5.0.\n+    Add-ons may have still used it, but we announced we would remove\n+    it in Plone 6.1.\n+    """\n+    portal = getToolByName(context, "portal_url").getPortalObject()\n+    tool = getattr(portal, "portal_properties", None)\n+    if tool is None:\n+        return\n+    # portal._delObject("portal_properties") would give:\n+    # AttributeError: \'PropertiesTool\' object has no attribute \'__of__\'\n+    portal._delOb("portal_properties")\n+    logger.info("Removed portal_properties tool.")\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2024-07-31T23:23:56+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@py76.be>
Commit: https://github.com/plone/plone.app.upgrade/commit/406225f05b8b29f1ccf0995f578c8c0b4e1a6085

Merge pull request #329 from plone/remove-propertiestool-completely

6.1: Remove the portal_properties tool completely.

Files changed:
A news/125.bugfix
A plone/app/upgrade/v61/final.py
M plone/app/upgrade/v61/configure.zcml

b'diff --git a/news/125.bugfix b/news/125.bugfix\nnew file mode 100644\nindex 00000000..9296abf6\n--- /dev/null\n+++ b/news/125.bugfix\n@@ -0,0 +1,3 @@\n+6.1: Remove the portal_properties tool completely.\n+This tool is deprecated, and we said we would remove it in 6.1.\n+[maurits]\ndiff --git a/plone/app/upgrade/v61/configure.zcml b/plone/app/upgrade/v61/configure.zcml\nindex 2512c3f2..7708f4c1 100644\n--- a/plone/app/upgrade/v61/configure.zcml\n+++ b/plone/app/upgrade/v61/configure.zcml\n@@ -54,15 +54,14 @@\n       destination="6103"\n       >\n     <!-- Plone 6.1.0a4 -->\n-    <gs:upgradeStep\n-        title="Miscellaneous"\n-        handler="..utils.null_upgrade_step"\n-        />\n-\n     <gs:upgradeDepends\n       title="Run to6103 upgrade profile."\n       import_profile="plone.app.upgrade.v61:to6103"\n       />\n+    <gs:upgradeStep\n+        title="Remove the portal_properties tool."\n+        handler=".final.remove_portal_properties_tool"\n+        />\n   </gs:upgradeSteps>\n \n </configure>\ndiff --git a/plone/app/upgrade/v61/final.py b/plone/app/upgrade/v61/final.py\nnew file mode 100644\nindex 00000000..f3fa8ef2\n--- /dev/null\n+++ b/plone/app/upgrade/v61/final.py\n@@ -0,0 +1,23 @@\n+from Products.CMFCore.utils import getToolByName\n+\n+import logging\n+\n+\n+logger = logging.getLogger(__name__)\n+\n+\n+def remove_portal_properties_tool(context):\n+    """Remove the portal_properties tool.\n+\n+    Core Plone has moved to the configuration registry in Plone 5.0.\n+    Add-ons may have still used it, but we announced we would remove\n+    it in Plone 6.1.\n+    """\n+    portal = getToolByName(context, "portal_url").getPortalObject()\n+    tool = getattr(portal, "portal_properties", None)\n+    if tool is None:\n+        return\n+    # portal._delObject("portal_properties") would give:\n+    # AttributeError: \'PropertiesTool\' object has no attribute \'__of__\'\n+    portal._delOb("portal_properties")\n+    logger.info("Removed portal_properties tool.")\n'

