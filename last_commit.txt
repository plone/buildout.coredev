Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-24T23:50:50+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/881e3669b5475d24d625c527f88142e9fa6daba6

Fix false positive missing_packages for profiles from submodules

Files changed:
A news/4015.bugfix
M Products/CMFPlone/browser/admin.py

b'diff --git a/Products/CMFPlone/browser/admin.py b/Products/CMFPlone/browser/admin.py\nindex e6273a812a..0e1df304b4 100644\n--- a/Products/CMFPlone/browser/admin.py\n+++ b/Products/CMFPlone/browser/admin.py\n@@ -2,6 +2,7 @@\n from AccessControl.Permissions import view as View\n from collections import OrderedDict\n from functools import cached_property\n+from importlib import import_module\n from importlib.metadata import distribution\n from importlib.metadata import PackageNotFoundError\n from OFS.interfaces import IApplication\n@@ -354,7 +355,12 @@ def missing_packages(self):\n             try:\n                 distribution(package)\n             except PackageNotFoundError:\n-                missing.append(package)\n+                try:\n+                    # profiles can live in submodules of packages.\n+                    # check if we can import the module namespace\n+                    import_module(package)\n+                except ModuleNotFoundError:\n+                    missing.append(package)\n         return missing\n \n     def versions(self):\ndiff --git a/news/4015.bugfix b/news/4015.bugfix\nnew file mode 100644\nindex 0000000000..1c13769dd1\n--- /dev/null\n+++ b/news/4015.bugfix\n@@ -0,0 +1,2 @@\n+Do not warn about missing profiles when they are registered in submodules of packages.\n+[petschki]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-25T12:11:12+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@py76.be>
Commit: https://github.com/plone/Products.CMFPlone/commit/840f075613c764036b773a4a93b11b036623130b

Merge pull request #4016 from plone/plone-upgrade-missing-package-fix

Fix false positive `missing_packages` in `@@plone-upgrade`

Files changed:
A news/4015.bugfix
M Products/CMFPlone/browser/admin.py

b'diff --git a/Products/CMFPlone/browser/admin.py b/Products/CMFPlone/browser/admin.py\nindex e6273a812a..0e1df304b4 100644\n--- a/Products/CMFPlone/browser/admin.py\n+++ b/Products/CMFPlone/browser/admin.py\n@@ -2,6 +2,7 @@\n from AccessControl.Permissions import view as View\n from collections import OrderedDict\n from functools import cached_property\n+from importlib import import_module\n from importlib.metadata import distribution\n from importlib.metadata import PackageNotFoundError\n from OFS.interfaces import IApplication\n@@ -354,7 +355,12 @@ def missing_packages(self):\n             try:\n                 distribution(package)\n             except PackageNotFoundError:\n-                missing.append(package)\n+                try:\n+                    # profiles can live in submodules of packages.\n+                    # check if we can import the module namespace\n+                    import_module(package)\n+                except ModuleNotFoundError:\n+                    missing.append(package)\n         return missing\n \n     def versions(self):\ndiff --git a/news/4015.bugfix b/news/4015.bugfix\nnew file mode 100644\nindex 0000000000..1c13769dd1\n--- /dev/null\n+++ b/news/4015.bugfix\n@@ -0,0 +1,2 @@\n+Do not warn about missing profiles when they are registered in submodules of packages.\n+[petschki]\n'

