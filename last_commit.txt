Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2022-01-21T01:09:14+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.ATContentTypes/commit/fc793f88f35a15a68b52e4abed77af0da5fdbab8

Security fix: prevent cache poisoning with the Referer header.

See [security advisory](https://github.com/plone/Products.ATContentTypes/security/advisories/GHSA-g4c2-ghfg-g5rh).

Files changed:
A news/1.bugfix
M Products/ATContentTypes/skins/ATContentTypes/image_view_fullscreen.pt

b'diff --git a/Products/ATContentTypes/skins/ATContentTypes/image_view_fullscreen.pt b/Products/ATContentTypes/skins/ATContentTypes/image_view_fullscreen.pt\nindex a22af266..e21f8500 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/image_view_fullscreen.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/image_view_fullscreen.pt\n@@ -46,15 +46,19 @@\n <body>\n \n <div id="content-core">\n+  <tal:block define="referer request/HTTP_REFERER;\n+                     url_tool nocall:context/portal_url;\n+                     referer python:referer if referer and url_tool.isURLInPortal(referer) else \'\';">\n     <a href=""\n-       tal:attributes="href request/HTTP_REFERER"\n-       tal:condition="request/HTTP_REFERER"\n+       tal:attributes="href referer"\n+       tal:condition="referer"\n        ><span i18n:translate="label_back_to_site">Back to site</span><br /><tal:block replace="structure context/tag" /></a>\n \n     <a href=""\n-       tal:attributes="href context/portal_url"\n-       tal:condition="not: request/HTTP_REFERER"\n+       tal:attributes="href python:url_tool()"\n+       tal:condition="not: referer"\n        ><span i18n:translate="label_home">Home</span><br /><tal:block replace="structure context/tag" /></a>\n+      </tal:block>\n </div>\n \n </body>\ndiff --git a/news/1.bugfix b/news/1.bugfix\nnew file mode 100644\nindex 00000000..0f70abe9\n--- /dev/null\n+++ b/news/1.bugfix\n@@ -0,0 +1,3 @@\n+Security fix: prevent cache poisoning with the Referer header.\n+See `security advisory <https://github.com/plone/Products.ATContentTypes/security/advisories/GHSA-g4c2-ghfg-g5rh>`.\n+[maurits]\n'

