Repository: plone.releaser


Branch: refs/heads/master
Date: 2024-08-29T21:10:34+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.releaser/commit/47c4da206b9f99fd94b371cec52135c90818f336

Fix checking/adding/removing checkouts: search in mxsources.ini.

Files changed:
A news/945.bugfix
M plone/releaser/manage.py
M plone/releaser/pip.py

b'diff --git a/news/945.bugfix b/news/945.bugfix\nnew file mode 100644\nindex 0000000..f237dd6\n--- /dev/null\n+++ b/news/945.bugfix\n@@ -0,0 +1,2 @@\n+Fix checking/adding/removing checkouts: search in `mxsources.ini`.\n+[maurits]\ndiff --git a/plone/releaser/manage.py b/plone/releaser/manage.py\nindex b235d28..25b036f 100644\n--- a/plone/releaser/manage.py\n+++ b/plone/releaser/manage.py\n@@ -137,12 +137,12 @@ def _get_checkouts(path=None):\n     """Get the parsed checkouts file at the given path.\n \n     If no path is given, we use several paths:\n-    both checkouts.cfg and mxdev.ini.\n+    both checkouts.cfg and mxcheckouts.ini.\n     """\n     if path:\n         paths = [path]\n     else:\n-        paths = glob.glob("mxdev.ini") + glob.glob("checkouts.cfg")\n+        paths = glob.glob("mxcheckouts.ini") + glob.glob("checkouts.cfg")\n     for path in paths:\n         if path.endswith(".ini"):\n             checkouts = MxCheckoutsFile(path)\n@@ -155,7 +155,7 @@ def check_checkout(package_name, *, path=None):\n     """Check if package is in the checkouts.\n \n     If no path is given, we try several paths:\n-    both checkouts.cfg and mxdev.ini.\n+    both checkouts.cfg and mxcheckouts.ini.\n     """\n     for checkouts in _get_checkouts(path=path):\n         loc = checkouts.file_location\n@@ -169,7 +169,7 @@ def remove_checkout(package_name, *, path=None):\n     """Remove package from auto checkouts.\n \n     If no path is given, we try several paths:\n-    both checkouts.cfg and mxdev.ini.\n+    both checkouts.cfg and mxcheckouts.ini.\n     """\n     for checkouts in _get_checkouts(path=path):\n         checkouts.remove(package_name)\n@@ -179,7 +179,7 @@ def add_checkout(package_name, *, path=None):\n     """Add package to auto checkouts.\n \n     If no path is given, we try several paths:\n-    both checkouts.cfg and mxdev.ini.\n+    both checkouts.cfg and mxcheckouts.ini.\n     """\n     for checkouts in _get_checkouts(path=path):\n         checkouts.add(package_name)\ndiff --git a/plone/releaser/pip.py b/plone/releaser/pip.py\nindex d791fa9..fb1ded9 100644\n--- a/plone/releaser/pip.py\n+++ b/plone/releaser/pip.py\n@@ -254,6 +254,7 @@ def append_package(self, package_name, enabled=True):\n         use = "true" if enabled else "false"\n         contents += f"\\n[{package_name}]\\nuse = {use}\\n"\n         self.path.write_text(contents)\n+        print(f"{self.file_location}: {package_name} added to checkouts.")\n \n     def __setitem__(self, package_name, enabled=True):\n         """Enable or disable a checkout.\n'

Repository: plone.releaser


Branch: refs/heads/master
Date: 2024-08-31T22:44:05+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.releaser/commit/b5ae17e8f336fd06bfe907baa62f97d01bd313e8

Merge pull request #74 from plone/maurits-mxcheckouts-ini

Fix checking/adding/removing checkouts: search in mxsources.ini.

Files changed:
A news/945.bugfix
M plone/releaser/manage.py
M plone/releaser/pip.py

b'diff --git a/news/945.bugfix b/news/945.bugfix\nnew file mode 100644\nindex 0000000..f237dd6\n--- /dev/null\n+++ b/news/945.bugfix\n@@ -0,0 +1,2 @@\n+Fix checking/adding/removing checkouts: search in `mxsources.ini`.\n+[maurits]\ndiff --git a/plone/releaser/manage.py b/plone/releaser/manage.py\nindex b235d28..25b036f 100644\n--- a/plone/releaser/manage.py\n+++ b/plone/releaser/manage.py\n@@ -137,12 +137,12 @@ def _get_checkouts(path=None):\n     """Get the parsed checkouts file at the given path.\n \n     If no path is given, we use several paths:\n-    both checkouts.cfg and mxdev.ini.\n+    both checkouts.cfg and mxcheckouts.ini.\n     """\n     if path:\n         paths = [path]\n     else:\n-        paths = glob.glob("mxdev.ini") + glob.glob("checkouts.cfg")\n+        paths = glob.glob("mxcheckouts.ini") + glob.glob("checkouts.cfg")\n     for path in paths:\n         if path.endswith(".ini"):\n             checkouts = MxCheckoutsFile(path)\n@@ -155,7 +155,7 @@ def check_checkout(package_name, *, path=None):\n     """Check if package is in the checkouts.\n \n     If no path is given, we try several paths:\n-    both checkouts.cfg and mxdev.ini.\n+    both checkouts.cfg and mxcheckouts.ini.\n     """\n     for checkouts in _get_checkouts(path=path):\n         loc = checkouts.file_location\n@@ -169,7 +169,7 @@ def remove_checkout(package_name, *, path=None):\n     """Remove package from auto checkouts.\n \n     If no path is given, we try several paths:\n-    both checkouts.cfg and mxdev.ini.\n+    both checkouts.cfg and mxcheckouts.ini.\n     """\n     for checkouts in _get_checkouts(path=path):\n         checkouts.remove(package_name)\n@@ -179,7 +179,7 @@ def add_checkout(package_name, *, path=None):\n     """Add package to auto checkouts.\n \n     If no path is given, we try several paths:\n-    both checkouts.cfg and mxdev.ini.\n+    both checkouts.cfg and mxcheckouts.ini.\n     """\n     for checkouts in _get_checkouts(path=path):\n         checkouts.add(package_name)\ndiff --git a/plone/releaser/pip.py b/plone/releaser/pip.py\nindex d791fa9..fb1ded9 100644\n--- a/plone/releaser/pip.py\n+++ b/plone/releaser/pip.py\n@@ -254,6 +254,7 @@ def append_package(self, package_name, enabled=True):\n         use = "true" if enabled else "false"\n         contents += f"\\n[{package_name}]\\nuse = {use}\\n"\n         self.path.write_text(contents)\n+        print(f"{self.file_location}: {package_name} added to checkouts.")\n \n     def __setitem__(self, package_name, enabled=True):\n         """Enable or disable a checkout.\n'

