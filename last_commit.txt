Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2024-08-13T18:51:41+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/100cf0e4c061c8c22130f06e523150f39a2f9563

6.1: Cleanup plone.app.discussion settings when the package is not available.

If the site contains comments, we throw an error and stop the upgrade.
The advice then is to add the `plone.app.discussion` package.

Files changed:
A news/211.bugfix
A plone/app/upgrade/v61/profiles/uninstall-discussion/actions.xml
A plone/app/upgrade/v61/profiles/uninstall-discussion/browserlayer.xml
A plone/app/upgrade/v61/profiles/uninstall-discussion/catalog.xml
A plone/app/upgrade/v61/profiles/uninstall-discussion/controlpanel.xml
A plone/app/upgrade/v61/profiles/uninstall-discussion/registry.xml
A plone/app/upgrade/v61/profiles/uninstall-discussion/types.xml
A plone/app/upgrade/v61/profiles/uninstall-discussion/workflows.xml
M plone/app/upgrade/v61/configure.zcml
M plone/app/upgrade/v61/final.py
M plone/app/upgrade/v61/profiles.zcml

b'diff --git a/news/211.bugfix b/news/211.bugfix\nnew file mode 100644\nindex 00000000..f0d647ee\n--- /dev/null\n+++ b/news/211.bugfix\n@@ -0,0 +1,4 @@\n+6.1: Cleanup ``plone.app.discussion`` settings when the package is not available.\n+If the site contains comments, we throw an error and stop the upgrade.\n+The advice then is to add the ``plone.app.discussion`` package.\n+[maurits]\ndiff --git a/plone/app/upgrade/v61/configure.zcml b/plone/app/upgrade/v61/configure.zcml\nindex c20e0358..b941668c 100644\n--- a/plone/app/upgrade/v61/configure.zcml\n+++ b/plone/app/upgrade/v61/configure.zcml\n@@ -71,8 +71,8 @@\n       >\n     <!-- Plone 6.1.0a5 -->\n     <gs:upgradeStep\n-        title="Miscellaneous"\n-        handler="..utils.null_upgrade_step"\n+        title="Maybe get rid of plone.app.discussion"\n+        handler=".final.maybe_cleanup_discussion"\n         />\n   </gs:upgradeSteps>\n \ndiff --git a/plone/app/upgrade/v61/final.py b/plone/app/upgrade/v61/final.py\nindex f3fa8ef2..38e5446f 100644\n--- a/plone/app/upgrade/v61/final.py\n+++ b/plone/app/upgrade/v61/final.py\n@@ -1,4 +1,12 @@\n+from plone.registry.interfaces import IRegistry\n+from zope.component import getUtility\n+from Acquisition import aq_parent\n+from importlib.metadata import distribution\n+from importlib.metadata import PackageNotFoundError\n+from plone.app.upgrade.utils import loadMigrationProfile\n+from plone.browserlayer.utils import unregister_layer\n from Products.CMFCore.utils import getToolByName\n+from zope.component import getSiteManager\n \n import logging\n \n@@ -21,3 +29,77 @@ def remove_portal_properties_tool(context):\n     # AttributeError: \'PropertiesTool\' object has no attribute \'__of__\'\n     portal._delOb("portal_properties")\n     logger.info("Removed portal_properties tool.")\n+\n+\n+def maybe_cleanup_discussion(context):\n+    """Cleanup some left-overs from plone.app.discussion.\n+\n+    But only do this when the package is not available.\n+    In Plone 6.1, the package was made into a core add-on.\n+    Meaning: it no longer gets pulled in by Products.CMFPlone,\n+    but only by the Plone package.\n+    """\n+    # First check if the GS profile was installed.\n+    profile_id = "plone.app.discussion:default"\n+    if context.getLastVersionForProfile(profile_id) == "unknown":\n+        logger.info("%s was not installed, nothing to do.", profile_id)\n+        return\n+    try:\n+        distribution("plone.app.discussion")\n+        logger.info("The plone.app.discussion package is available, so we do nothing.")\n+        return\n+    except PackageNotFoundError:\n+        logger.info("plone.app.discussion package not found, will cleanup.")\n+\n+    # First check if there are any actual discussion items in the site.\n+    catalog = getToolByName(context, "portal_catalog")\n+    brains = catalog.unrestrictedSearchResults(portal_type="Discussion Item")\n+    total = len(brains)\n+    if total:\n+        raise ValueError(\n+            f"{total} Discussion Items (comments) were found in the site, but "\n+            "plone.app.discussion is missing.\\nThis package is optional since "\n+            "Plone 6.1.\\nPlease add plone.app.discussion to your Plone installation "\n+            "if you want to keep using them."\n+        )\n+\n+    # First apply a profile.  This is mostly a copy of the uninstall profile\n+    # of plone.app.discussion.\n+    loadMigrationProfile(context, "profile-plone.app.upgrade.v61:uninstall-discussion")\n+\n+    # The registry keys were registered via the IDiscussionSettings interface\n+    # which no longer exists, so we remove them one by one.\n+    registry = getUtility(IRegistry)\n+    records = registry.records\n+    to_remove = [\n+        key\n+        for key in records.keys()\n+        if "plone.app.discussion.interfaces.IDiscussionSettings" in key\n+    ]\n+    for key in to_remove:\n+        del records[key]\n+    logger.info("Removed all IDiscussionSettings registry records.")\n+\n+    # Gather the FTIs that have the plone.allowdiscussion behavior.\n+    # It can appear with the name or the interface identifier.\n+    portal_types = getToolByName(context, "portal_types")\n+    old_behaviors = {\n+        "plone.allowdiscussion",\n+        "plone.app.dexterity.behaviors.discussion.IAllowDiscussion",\n+    }\n+    ftis_to_fix = (\n+        fti\n+        for fti in portal_types.objectValues("Dexterity FTI")\n+        if set(fti.behaviors) & old_behaviors\n+    )\n+    for fti in ftis_to_fix:\n+        # Remove the behavior.  Remember this is a tuple.\n+        behaviors = [\n+            behavior for behavior in fti.behaviors if behavior not in old_behaviors\n+        ]\n+        # Set the updated behaviors\n+        fti.behaviors = tuple(behaviors)\n+        logger.info("Removed plone.allowdiscussion behavior from %s", fti)\n+\n+    # Mark GS profile as not installed/activated.\n+    context.unsetLastVersionForProfile(profile_id)\ndiff --git a/plone/app/upgrade/v61/profiles.zcml b/plone/app/upgrade/v61/profiles.zcml\nindex 1dd84f37..74cac9b2 100644\n--- a/plone/app/upgrade/v61/profiles.zcml\n+++ b/plone/app/upgrade/v61/profiles.zcml\n@@ -11,4 +11,13 @@\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       />\n \n+  <!-- This is a copy of plone.app.discussion/profiles/uninstall. -->\n+  <genericsetup:registerProfile\n+      name="uninstall-discussion"\n+      title="Uninstall plone.app.discussion"\n+      directory="profiles/uninstall-discussion"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      />\n+\n </configure>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/actions.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/actions.xml\nnew file mode 100644\nindex 00000000..680e5e96\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/actions.xml\n@@ -0,0 +1,13 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        name="portal_actions"\n+>\n+  <object meta_type="CMF Action Category"\n+          name="user"\n+  >\n+    <object meta_type="CMF Action"\n+            name="review-comments"\n+            remove="true"\n+    />\n+  </object>\n+</object>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/browserlayer.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/browserlayer.xml\nnew file mode 100644\nindex 00000000..078a4cbb\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/browserlayer.xml\n@@ -0,0 +1,6 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<layers>\n+  <layer name="plone.app.discussion"\n+         remove="true"\n+  />\n+</layers>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/catalog.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/catalog.xml\nnew file mode 100644\nindex 00000000..e4584ca6\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/catalog.xml\n@@ -0,0 +1,28 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<object name="portal_catalog">\n+\n+  <index meta_type="FieldIndex"\n+         name="total_comments"\n+         remove="true"\n+  />\n+  <index meta_type="KeywordIndex"\n+         name="commentators"\n+         remove="true"\n+  />\n+  <column remove="true"\n+          value="total_comments"\n+  />\n+  <column remove="true"\n+          value="last_comment_date"\n+  />\n+  <column remove="true"\n+          value="commentators"\n+  />\n+  <column remove="true"\n+          value="in_response_to"\n+  />\n+  <column remove="true"\n+          value="author_name"\n+  />\n+\n+</object>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/controlpanel.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/controlpanel.xml\nnew file mode 100644\nindex 00000000..f76f5d75\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/controlpanel.xml\n@@ -0,0 +1,14 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        name="portal_controlpanel"\n+        purge="False"\n+        i18n:domain="plone"\n+>\n+\n+  <configlet action_id="discussion"\n+             appId="plone.app.discussion"\n+             category="plone-content"\n+             remove="true"\n+  />\n+\n+</object>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/registry.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/registry.xml\nnew file mode 100644\nindex 00000000..b5109eae\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/registry.xml\n@@ -0,0 +1,8 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<registry>\n+  <!-- This would give ModuleNotFoundError: No module named \'plone.app.discussion\'\n+       So we do this in Python code in maybe_cleanup_discussion. -->\n+  <!-- <records interface="plone.app.discussion.interfaces.IDiscussionSettings"\n+           remove="true"\n+  /> -->\n+</registry>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/types.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/types.xml\nnew file mode 100644\nindex 00000000..e854062b\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/types.xml\n@@ -0,0 +1,9 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="CMF Types Tool"\n+        name="portal_types"\n+>\n+  <object meta_type="Factory-based Type Information"\n+          name="Discussion Item"\n+\t  remove="True"\n+  />\n+</object>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/workflows.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/workflows.xml\nnew file mode 100644\nindex 00000000..b7269a77\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/workflows.xml\n@@ -0,0 +1,13 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Workflow Tool"\n+        name="portal_workflow"\n+>\n+  <object meta_type="Workflow"\n+          name="comment_review_workflow"\n+          remove="True"\n+  />\n+  <object meta_type="Workflow"\n+          name="comment_one_state_workflow"\n+          remove="True"\n+  />\n+</object>\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2024-09-02T16:35:17+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@py76.be>
Commit: https://github.com/plone/plone.app.upgrade/commit/97c18165d6a88e813cf1682db1f8b3c2a7d3c4a2

Merge pull request #330 from plone/pa-discussion-core-addon

6.1: Cleanup plone.app.discussion settings when package is missing

Files changed:
A news/211.bugfix
A plone/app/upgrade/v61/profiles/uninstall-discussion/actions.xml
A plone/app/upgrade/v61/profiles/uninstall-discussion/browserlayer.xml
A plone/app/upgrade/v61/profiles/uninstall-discussion/catalog.xml
A plone/app/upgrade/v61/profiles/uninstall-discussion/controlpanel.xml
A plone/app/upgrade/v61/profiles/uninstall-discussion/registry.xml
A plone/app/upgrade/v61/profiles/uninstall-discussion/types.xml
A plone/app/upgrade/v61/profiles/uninstall-discussion/workflows.xml
M plone/app/upgrade/v61/configure.zcml
M plone/app/upgrade/v61/final.py
M plone/app/upgrade/v61/profiles.zcml

b'diff --git a/news/211.bugfix b/news/211.bugfix\nnew file mode 100644\nindex 00000000..f0d647ee\n--- /dev/null\n+++ b/news/211.bugfix\n@@ -0,0 +1,4 @@\n+6.1: Cleanup ``plone.app.discussion`` settings when the package is not available.\n+If the site contains comments, we throw an error and stop the upgrade.\n+The advice then is to add the ``plone.app.discussion`` package.\n+[maurits]\ndiff --git a/plone/app/upgrade/v61/configure.zcml b/plone/app/upgrade/v61/configure.zcml\nindex c20e0358..b941668c 100644\n--- a/plone/app/upgrade/v61/configure.zcml\n+++ b/plone/app/upgrade/v61/configure.zcml\n@@ -71,8 +71,8 @@\n       >\n     <!-- Plone 6.1.0a5 -->\n     <gs:upgradeStep\n-        title="Miscellaneous"\n-        handler="..utils.null_upgrade_step"\n+        title="Maybe get rid of plone.app.discussion"\n+        handler=".final.maybe_cleanup_discussion"\n         />\n   </gs:upgradeSteps>\n \ndiff --git a/plone/app/upgrade/v61/final.py b/plone/app/upgrade/v61/final.py\nindex f3fa8ef2..38e5446f 100644\n--- a/plone/app/upgrade/v61/final.py\n+++ b/plone/app/upgrade/v61/final.py\n@@ -1,4 +1,12 @@\n+from plone.registry.interfaces import IRegistry\n+from zope.component import getUtility\n+from Acquisition import aq_parent\n+from importlib.metadata import distribution\n+from importlib.metadata import PackageNotFoundError\n+from plone.app.upgrade.utils import loadMigrationProfile\n+from plone.browserlayer.utils import unregister_layer\n from Products.CMFCore.utils import getToolByName\n+from zope.component import getSiteManager\n \n import logging\n \n@@ -21,3 +29,77 @@ def remove_portal_properties_tool(context):\n     # AttributeError: \'PropertiesTool\' object has no attribute \'__of__\'\n     portal._delOb("portal_properties")\n     logger.info("Removed portal_properties tool.")\n+\n+\n+def maybe_cleanup_discussion(context):\n+    """Cleanup some left-overs from plone.app.discussion.\n+\n+    But only do this when the package is not available.\n+    In Plone 6.1, the package was made into a core add-on.\n+    Meaning: it no longer gets pulled in by Products.CMFPlone,\n+    but only by the Plone package.\n+    """\n+    # First check if the GS profile was installed.\n+    profile_id = "plone.app.discussion:default"\n+    if context.getLastVersionForProfile(profile_id) == "unknown":\n+        logger.info("%s was not installed, nothing to do.", profile_id)\n+        return\n+    try:\n+        distribution("plone.app.discussion")\n+        logger.info("The plone.app.discussion package is available, so we do nothing.")\n+        return\n+    except PackageNotFoundError:\n+        logger.info("plone.app.discussion package not found, will cleanup.")\n+\n+    # First check if there are any actual discussion items in the site.\n+    catalog = getToolByName(context, "portal_catalog")\n+    brains = catalog.unrestrictedSearchResults(portal_type="Discussion Item")\n+    total = len(brains)\n+    if total:\n+        raise ValueError(\n+            f"{total} Discussion Items (comments) were found in the site, but "\n+            "plone.app.discussion is missing.\\nThis package is optional since "\n+            "Plone 6.1.\\nPlease add plone.app.discussion to your Plone installation "\n+            "if you want to keep using them."\n+        )\n+\n+    # First apply a profile.  This is mostly a copy of the uninstall profile\n+    # of plone.app.discussion.\n+    loadMigrationProfile(context, "profile-plone.app.upgrade.v61:uninstall-discussion")\n+\n+    # The registry keys were registered via the IDiscussionSettings interface\n+    # which no longer exists, so we remove them one by one.\n+    registry = getUtility(IRegistry)\n+    records = registry.records\n+    to_remove = [\n+        key\n+        for key in records.keys()\n+        if "plone.app.discussion.interfaces.IDiscussionSettings" in key\n+    ]\n+    for key in to_remove:\n+        del records[key]\n+    logger.info("Removed all IDiscussionSettings registry records.")\n+\n+    # Gather the FTIs that have the plone.allowdiscussion behavior.\n+    # It can appear with the name or the interface identifier.\n+    portal_types = getToolByName(context, "portal_types")\n+    old_behaviors = {\n+        "plone.allowdiscussion",\n+        "plone.app.dexterity.behaviors.discussion.IAllowDiscussion",\n+    }\n+    ftis_to_fix = (\n+        fti\n+        for fti in portal_types.objectValues("Dexterity FTI")\n+        if set(fti.behaviors) & old_behaviors\n+    )\n+    for fti in ftis_to_fix:\n+        # Remove the behavior.  Remember this is a tuple.\n+        behaviors = [\n+            behavior for behavior in fti.behaviors if behavior not in old_behaviors\n+        ]\n+        # Set the updated behaviors\n+        fti.behaviors = tuple(behaviors)\n+        logger.info("Removed plone.allowdiscussion behavior from %s", fti)\n+\n+    # Mark GS profile as not installed/activated.\n+    context.unsetLastVersionForProfile(profile_id)\ndiff --git a/plone/app/upgrade/v61/profiles.zcml b/plone/app/upgrade/v61/profiles.zcml\nindex 1dd84f37..74cac9b2 100644\n--- a/plone/app/upgrade/v61/profiles.zcml\n+++ b/plone/app/upgrade/v61/profiles.zcml\n@@ -11,4 +11,13 @@\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       />\n \n+  <!-- This is a copy of plone.app.discussion/profiles/uninstall. -->\n+  <genericsetup:registerProfile\n+      name="uninstall-discussion"\n+      title="Uninstall plone.app.discussion"\n+      directory="profiles/uninstall-discussion"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      />\n+\n </configure>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/actions.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/actions.xml\nnew file mode 100644\nindex 00000000..680e5e96\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/actions.xml\n@@ -0,0 +1,13 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        name="portal_actions"\n+>\n+  <object meta_type="CMF Action Category"\n+          name="user"\n+  >\n+    <object meta_type="CMF Action"\n+            name="review-comments"\n+            remove="true"\n+    />\n+  </object>\n+</object>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/browserlayer.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/browserlayer.xml\nnew file mode 100644\nindex 00000000..078a4cbb\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/browserlayer.xml\n@@ -0,0 +1,6 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<layers>\n+  <layer name="plone.app.discussion"\n+         remove="true"\n+  />\n+</layers>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/catalog.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/catalog.xml\nnew file mode 100644\nindex 00000000..e4584ca6\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/catalog.xml\n@@ -0,0 +1,28 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<object name="portal_catalog">\n+\n+  <index meta_type="FieldIndex"\n+         name="total_comments"\n+         remove="true"\n+  />\n+  <index meta_type="KeywordIndex"\n+         name="commentators"\n+         remove="true"\n+  />\n+  <column remove="true"\n+          value="total_comments"\n+  />\n+  <column remove="true"\n+          value="last_comment_date"\n+  />\n+  <column remove="true"\n+          value="commentators"\n+  />\n+  <column remove="true"\n+          value="in_response_to"\n+  />\n+  <column remove="true"\n+          value="author_name"\n+  />\n+\n+</object>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/controlpanel.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/controlpanel.xml\nnew file mode 100644\nindex 00000000..f76f5d75\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/controlpanel.xml\n@@ -0,0 +1,14 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        name="portal_controlpanel"\n+        purge="False"\n+        i18n:domain="plone"\n+>\n+\n+  <configlet action_id="discussion"\n+             appId="plone.app.discussion"\n+             category="plone-content"\n+             remove="true"\n+  />\n+\n+</object>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/registry.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/registry.xml\nnew file mode 100644\nindex 00000000..b5109eae\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/registry.xml\n@@ -0,0 +1,8 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<registry>\n+  <!-- This would give ModuleNotFoundError: No module named \'plone.app.discussion\'\n+       So we do this in Python code in maybe_cleanup_discussion. -->\n+  <!-- <records interface="plone.app.discussion.interfaces.IDiscussionSettings"\n+           remove="true"\n+  /> -->\n+</registry>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/types.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/types.xml\nnew file mode 100644\nindex 00000000..e854062b\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/types.xml\n@@ -0,0 +1,9 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="CMF Types Tool"\n+        name="portal_types"\n+>\n+  <object meta_type="Factory-based Type Information"\n+          name="Discussion Item"\n+\t  remove="True"\n+  />\n+</object>\ndiff --git a/plone/app/upgrade/v61/profiles/uninstall-discussion/workflows.xml b/plone/app/upgrade/v61/profiles/uninstall-discussion/workflows.xml\nnew file mode 100644\nindex 00000000..b7269a77\n--- /dev/null\n+++ b/plone/app/upgrade/v61/profiles/uninstall-discussion/workflows.xml\n@@ -0,0 +1,13 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Workflow Tool"\n+        name="portal_workflow"\n+>\n+  <object meta_type="Workflow"\n+          name="comment_review_workflow"\n+          remove="True"\n+  />\n+  <object meta_type="Workflow"\n+          name="comment_one_state_workflow"\n+          remove="True"\n+  />\n+</object>\n'

