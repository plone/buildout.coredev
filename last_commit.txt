Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-18T11:30:23+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/5c52022143bd6da9697dc8f6ce3f23bfd1922aee

Configuring with plone/meta

Files changed:
A .editorconfig
A .flake8
A .github/workflows/meta.yml
A .meta.toml
A .pre-commit-config.yaml
A news/5cdbd962.internal
A tox.ini
M .gitignore
M pyproject.toml
D setup.cfg

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 0000000..8ae05aa\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,54 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss,html}]  # Frontend development\n+# 2 space indentation\n+indent_size = 2\n+max_line_length = 80\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [editorconfig]\n+#  extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\ndiff --git a/.flake8 b/.flake8\nnew file mode 100644\nindex 0000000..7ef4f64\n--- /dev/null\n+++ b/.flake8\n@@ -0,0 +1,22 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [flake8]\n+#  extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\ndiff --git a/.github/workflows/meta.yml b/.github/workflows/meta.yml\nnew file mode 100644\nindex 0000000..aa2345c\n--- /dev/null\n+++ b/.github/workflows/meta.yml\n@@ -0,0 +1,70 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+name: Meta\n+on:\n+  push:\n+    branches:\n+      - master\n+      - main\n+  pull_request:\n+    branches:\n+      - master\n+      - main\n+  workflow_dispatch:\n+\n+##\n+# To set environment variables for all jobs, add in .meta.toml:\n+# [github]\n+# env = """\n+#     debug: 1\n+#     image-name: \'org/image\'\n+#     image-tag: \'latest\'\n+# """\n+##\n+\n+jobs:\n+  qa:\n+    uses: plone/meta/.github/workflows/qa.yml@main\n+  test:\n+    uses: plone/meta/.github/workflows/test.yml@main\n+  coverage:\n+    uses: plone/meta/.github/workflows/coverage.yml@main\n+  dependencies:\n+    uses: plone/meta/.github/workflows/dependencies.yml@main\n+  release_ready:\n+    uses: plone/meta/.github/workflows/release_ready.yml@main\n+\n+# TODO: enable the circular dependencies check once the circular\n+# dependency with plone.app.dexterity is fixed.\n+# See https://github.com/plone/Products.CMFPlone/issues/3858\n+\n+##\n+# To modify the list of default jobs being created add in .meta.toml:\n+# [github]\n+# jobs = [\n+#    "qa",\n+#    "test",\n+#    "coverage",\n+#    "dependencies",\n+#    "release_ready",\n+#    "circular",\n+#    ]\n+##\n+\n+##\n+# To request that some OS level dependencies get installed\n+# when running tests/coverage jobs, add in .meta.toml:\n+# [github]\n+# os_dependencies = "git libxml2 libxslt"\n+##\n+\n+\n+##\n+# Specify additional jobs in .meta.toml:\n+#  [github]\n+#  extra_lines = """\n+#  another:\n+#    uses: org/repo/.github/workflows/file.yml@main\n+#  """\n+##\ndiff --git a/.gitignore b/.gitignore\nindex d12b524..503e47c 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -1,23 +1,55 @@\n-/develop-eggs\n-/eggs\n-/fake-eggs\n-/bin\n-/parts\n-/downloads\n-/var\n-/build\n-/dist\n-/local.cfg\n-/*.egg-info\n-/.installed.cfg\n-/.mr.developer.cfg\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+# python related\n+*.egg-info\n *.pyc\n-/.Python\n-/include\n-/lib\n-/src/*\n+*.pyo\n+\n+# translation related\n *.mo\n-/.coverage\n+\n+# tools related\n+build/\n+.coverage\n+.*project\n coverage.xml\n-zptlint.log\n-.DS_Store\n+dist/\n+docs/_build\n+__pycache__/\n+.tox\n+.vscode/\n+node_modules/\n+\n+# venv / buildout related\n+bin/\n+develop-eggs/\n+eggs/\n+.eggs/\n+etc/\n+.installed.cfg\n+include/\n+lib/\n+lib64\n+.mr.developer.cfg\n+parts/\n+pyvenv.cfg\n+var/\n+\n+# mxdev\n+/instance/\n+/.make-sentinels/\n+/*-mxdev.txt\n+/reports/\n+/sources/\n+/venv/\n+.installed.txt\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [gitignore]\n+#  extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 0000000..d5d5bc4\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,26 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+[meta]\n+template = "default"\n+commit-id = "68cda6e4"\n+\n+[github]\n+jobs = [\n+    "qa",\n+    "test",\n+    "coverage",\n+    "dependencies",\n+    "release_ready",\n+    ]\n+\n+[pre_commit]\n+zpretty_extra_lines = """\n+        exclude: plone/app/content/browser/contents/templates\n+"""\n+i18ndude_extra_lines = """\n+        exclude: plone/app/content/browser/contents\n+"""\n+\n+[pyproject]\n+dependencies_ignores = "[\'tus\', ]"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 0000000..fac5190\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,96 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.14.0\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.9.1\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.1.0\n+    hooks:\n+    -   id: zpretty\n+        exclude: plone/app/content/browser/contents/templates\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pre_commit]\n+#  zpretty_extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.1.0\n+    hooks:\n+    -   id: flake8\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pre_commit]\n+#  flake8_extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.6\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pre_commit]\n+#  codespell_extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\n+-   repo: https://github.com/mgedmin/check-python-versions\n+    rev: "0.21.3"\n+    hooks:\n+    -   id: check-python-versions\n+        args: [\'--only\', \'setup.py,pyproject.toml\']\n+-   repo: https://github.com/collective/i18ndude\n+    rev: "6.1.0"\n+    hooks:\n+    -   id: i18ndude\n+        exclude: plone/app/content/browser/contents\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pre_commit]\n+#  i18ndude_extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pre_commit]\n+#  extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\ndiff --git a/news/5cdbd962.internal b/news/5cdbd962.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/5cdbd962.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615d..0e84fbc 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,6 +1,9 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n [tool.towncrier]\n-filename = "CHANGES.rst"\n directory = "news/"\n+filename = "CHANGES.rst"\n title_format = "{version} ({project_date})"\n underlines = ["-", ""]\n \n@@ -18,3 +21,137 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  towncrier_extra_lines = """\n+#  extra_configuration\n+#  """\n+##\n+\n+[tool.isort]\n+profile = "plone"\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  isort_extra_lines = """\n+#  extra_configuration\n+#  """\n+##\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  black_extra_lines = """\n+#  extra_configuration\n+#  """\n+##\n+\n+[tool.codespell]\n+ignore-words-list = "discreet,"\n+skip = "*.po,"\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  codespell_ignores = "foo,bar"\n+#  codespell_skip = "*.po,*.map,package-lock.json"\n+##\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # ExtensionClass own provided namespaces\n+  \'ExtensionClass\', \'ComputedAttribute\', \'MethodObject\',\n+  # Zope dependencies\n+  \'AccessControl\', \'Acquisition\', \'AuthEncoding\', \'beautifulsoup4\', \'BTrees\',\n+  \'cffi\', \'Chameleon\', \'DateTime\', \'DocumentTemplate\',\n+  \'MultiMapping\', \'multipart\', \'PasteDeploy\', \'Persistence\', \'persistent\',\n+  \'pycparser\', \'python-gettext\', \'pytz\', \'RestrictedPython\', \'roman\',\n+  \'soupsieve\', \'transaction\', \'waitress\', \'WebOb\', \'WebTest\', \'WSGIProxy2\',\n+  \'z3c.pt\', \'zc.lockfile\', \'ZConfig\', \'zExceptions\', \'ZODB\', \'zodbpickle\',\n+  \'zope.annotation\', \'zope.browser\', \'zope.browsermenu\', \'zope.browserpage\',\n+  \'zope.browserresource\', \'zope.cachedescriptors\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.contentprovider\',\n+  \'zope.contenttype\', \'zope.datetime\', \'zope.deferredimport\',\n+  \'zope.deprecation\', \'zope.dottedname\', \'zope.event\', \'zope.exceptions\',\n+  \'zope.filerepresentation\', \'zope.globalrequest\', \'zope.hookable\',\n+  \'zope.i18n\', \'zope.i18nmessageid\', \'zope.interface\', \'zope.lifecycleevent\',\n+  \'zope.location\', \'zope.pagetemplate\', \'zope.processlifetime\', \'zope.proxy\',\n+  \'zope.ptresource\', \'zope.publisher\', \'zope.schema\', \'zope.security\',\n+  \'zope.sequencesort\', \'zope.site\', \'zope.size\', \'zope.structuredtext\',\n+  \'zope.tal\', \'zope.tales\', \'zope.testbrowser\', \'zope.testing\',\n+  \'zope.traversing\', \'zope.viewlet\'\n+]\n+\'Products.CMFCore\' = [\n+  \'docutils\', \'five.localsitemanager\', \'Missing\', \'Products.BTreeFolder2\',\n+  \'Products.GenericSetup\', \'Products.MailHost\', \'Products.PythonScripts\',\n+  \'Products.StandardCacheManagers\', \'Products.ZCatalog\', \'Record\',\n+  \'zope.sendmail\', \'Zope\'\n+]\n+\'plone.base\' = [\n+  \'plone.batching\', \'plone.registry\', \'plone.schema\',\'plone.z3cform\',\n+  \'Products.CMFCore\', \'Products.CMFDynamicViewFTI\',\n+]\n+python-dateutil = [\'dateutil\']\n+ignore-packages = [\'tus\', ]\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  dependencies_ignores = "[\'zestreleaser.towncrier\']"\n+#  dependencies_mappings = [\n+#    "gitpython = [\'git\']",\n+#    "pygithub = [\'github\']",\n+#  ]\n+##\n+\n+[tool.check-manifest]\n+ignore = [\n+    ".editorconfig",\n+    ".meta.toml",\n+    ".pre-commit-config.yaml",\n+    "tox.ini",\n+    ".flake8",\n+    "mx.ini",\n+\n+]\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  check_manifest_ignores = """\n+#      "*.map.js",\n+#      "*.pyc",\n+#  """\n+##\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\ndiff --git a/setup.cfg b/setup.cfg\ndeleted file mode 100644\nindex 3e076fd..0000000\n--- a/setup.cfg\n+++ /dev/null\n@@ -1,9 +0,0 @@\n-[bdist_wheel]\n-universal = 0\n-\n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 0000000..cbb3425\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,208 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    lint\n+    test\n+    dependencies\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [tox]\n+#  envlist_lines = """\n+#      my_other_environment\n+#  """\n+#  config_lines = """\n+#  my_extra_top_level_tox_configuration_lines\n+#  """\n+##\n+\n+[testenv]\n+skip_install = true\n+allowlist_externals =\n+    echo\n+    false\n+# Make sure typos like `tox -e formaat` are caught instead of silently doing nothing.\n+# See https://github.com/tox-dev/tox/issues/2858.\n+commands =\n+    echo "Unrecognized environment name {envname}"\n+    false\n+\n+[testenv:init]\n+description = Prepare environment\n+skip_install = true\n+commands =\n+    echo "Initial setup complete"\n+\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies\n+skip_install = true\n+deps =\n+    build\n+    z3c.dependencychecker==2.11\n+commands =\n+    python -m build --sdist --no-isolation\n+    dependencychecker\n+\n+[testenv:dependencies-graph]\n+description = generate a graph out of the dependencies of the package\n+skip_install = false\n+allowlist_externals =\n+    sh\n+deps =\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+description = run the distribution tests\n+use_develop = true\n+skip_install = false\n+constrain_package_deps = true\n+set_env =\n+    ROBOT_BROWSER=headlesschrome\n+\n+##\n+# Specify extra test environment variables in .meta.toml:\n+#  [tox]\n+#  test_environment_variables = """\n+#      PIP_EXTRA_INDEX_URL=https://my-pypi.my-server.com/\n+#  """\n+#\n+# Set constrain_package_deps .meta.toml:\n+#  [tox]\n+#  constrain_package_deps = "false"\n+##\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+    \n+##\n+# Specify additional deps in .meta.toml:\n+#  [tox]\n+#  test_deps_additional = "-esources/plonegovbr.portal_base[test]"\n+#\n+# Specify a custom constraints file in .meta.toml:\n+#  [tox]\n+#  constraints_file = "https://my-server.com/constraints.txt"\n+##\n+commands =\n+    zope-testrunner --all --test-path={toxinidir} -s plone.app.content {posargs}\n+extras =\n+    test\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [tox]\n+#  test_extras = """\n+#      tests\n+#      widgets\n+#  """\n+##\n+\n+[testenv:coverage]\n+description = get a test coverage report\n+use_develop = true\n+skip_install = false\n+constrain_package_deps = true\n+set_env =\n+    ROBOT_BROWSER=headlesschrome\n+\n+##\n+# Specify extra test environment variables in .meta.toml:\n+#  [tox]\n+#  test_environment_variables = """\n+#      PIP_EXTRA_INDEX_URL=https://my-pypi.my-server.com/\n+#  """\n+##\n+deps =\n+    coverage\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+    \n+commands =\n+    coverage run --branch --source plone.app.content {envbindir}/zope-testrunner --quiet --all --test-path={toxinidir} -s plone.app.content {posargs}\n+    coverage report -m --format markdown\n+    coverage xml\n+extras =\n+    test\n+\n+\n+[testenv:release-check]\n+description = ensure that the distribution is ready to release\n+skip_install = true\n+deps =\n+    twine\n+    build\n+    towncrier\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+    \n+commands =\n+    # fake version to not have to install the package\n+    # we build the change log as news entries might break\n+    # the README that is displayed on PyPI\n+    towncrier build --version=100.0.0 --yes\n+    python -m build --sdist --no-isolation\n+    twine check dist/*\n+\n+[testenv:circular]\n+description = ensure there are no cyclic dependencies\n+use_develop = true\n+skip_install = false\n+set_env =\n+\n+##\n+# Specify extra test environment variables in .meta.toml:\n+#  [tox]\n+#  test_environment_variables = """\n+#      PIP_EXTRA_INDEX_URL=https://my-pypi.my-server.com/\n+#  """\n+##\n+allowlist_externals =\n+    sh\n+deps =\n+    pipdeptree\n+    pipforester\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+    \n+commands =\n+    # Generate the full dependency tree\n+    sh -c \'pipdeptree -j > forest.json\'\n+    # Generate a DOT graph with the circular dependencies, if any\n+    pipforester -i forest.json -o forest.dot --cycles\n+    # Report if there are any circular dependencies, i.e. error if there are any\n+    pipforester -i forest.json --check-cycles -o /dev/null\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [tox]\n+#  extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-18T11:30:23+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/5038b5390dcf346691b8b1149e55ba156ac34b6e

chore: pyupgrade

Files changed:
M plone/app/content/tests/test_actions.py

b'diff --git a/plone/app/content/tests/test_actions.py b/plone/app/content/tests/test_actions.py\nindex 62108fd..a9bd5b3 100644\n--- a/plone/app/content/tests/test_actions.py\n+++ b/plone/app/content/tests/test_actions.py\n@@ -37,7 +37,7 @@ def setUp(self):\n         self.browser = Browser(self.layer["app"])\n         self.browser.handleErrors = False\n         self.browser.addHeader(\n-            "Authorization", "Basic {}:{}".format(TEST_USER_NAME, TEST_USER_PASSWORD)\n+            "Authorization", f"Basic {TEST_USER_NAME}:{TEST_USER_PASSWORD}"\n         )\n \n     def tearDown(self):\n@@ -124,7 +124,7 @@ def prepare_for_acquisition_tests(self):\n         browser_2 = Browser(self.layer["app"])\n         browser_2.handleErrors = False\n         browser_2.addHeader(\n-            "Authorization", "Basic {}:{}".format(TEST_USER_NAME, TEST_USER_PASSWORD)\n+            "Authorization", f"Basic {TEST_USER_NAME}:{TEST_USER_PASSWORD}"\n         )\n \n         # return the id of the root page, the nested page itself, and the\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-18T11:30:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/feb7a04953c4ee3d6df05484a15ec8d21c260a2d

chore: isort

Files changed:
M plone/app/content/tests/test_actions.py
M plone/app/content/utils.py

b"diff --git a/plone/app/content/tests/test_actions.py b/plone/app/content/tests/test_actions.py\nindex a9bd5b3..121b9e3 100644\n--- a/plone/app/content/tests/test_actions.py\n+++ b/plone/app/content/tests/test_actions.py\n@@ -8,7 +8,8 @@\n from plone.locking.interfaces import ILockable\n from plone.testing.zope import Browser\n from z3c.form.interfaces import IFormLayer\n-from zExceptions import Unauthorized, NotFound\n+from zExceptions import NotFound\n+from zExceptions import Unauthorized\n from zope.component import getMultiAdapter\n from zope.interface import alsoProvides\n \ndiff --git a/plone/app/content/utils.py b/plone/app/content/utils.py\nindex d61cf02..a6131bb 100644\n--- a/plone/app/content/utils.py\n+++ b/plone/app/content/utils.py\n@@ -8,6 +8,7 @@\n # use simplejson because it's ahead of stdlib and supports more types\n import simplejson\n \n+\n try:\n     from z3c.relationfield.relation import RelationValue\n except ImportError:\n"

Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-18T11:30:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/a61a7d2335b0d24b15cae9d9422b376a948177e6

chore: black

Files changed:
M plone/app/content/browser/actions.py
M plone/app/content/browser/constraintypes.py
M plone/app/content/browser/content_status_history.py
M plone/app/content/browser/contents/__init__.py
M plone/app/content/browser/contents/copy.py
M plone/app/content/browser/contents/cut.py
M plone/app/content/browser/contents/delete.py
M plone/app/content/browser/contents/paste.py
M plone/app/content/browser/contents/properties.py
M plone/app/content/browser/contents/rename.py
M plone/app/content/browser/contents/tags.py
M plone/app/content/browser/contents/workflow.py
M plone/app/content/browser/i18n.py
M plone/app/content/browser/selection.py
M plone/app/content/testing.py
M plone/app/content/tests/test_adding.py
M plone/app/content/tests/test_content_status_modify.py
M plone/app/content/tests/test_folder.py
M plone/app/content/tests/test_namechooser_unit.py
M plone/app/content/tests/test_non_ascii_characters_in_workflow_state.py
M plone/app/content/tests/test_selectdefaultpage.py
M plone/app/content/tests/test_widgets.py

b'diff --git a/plone/app/content/browser/actions.py b/plone/app/content/browser/actions.py\nindex b939b34..6f16e53 100644\n--- a/plone/app/content/browser/actions.py\n+++ b/plone/app/content/browser/actions.py\n@@ -38,7 +38,6 @@ def is_locked(self):\n \n \n class DeleteConfirmationForm(form.Form, LockingBase):\n-\n     fields = field.Fields()\n     template = ViewPageTemplateFile("templates/delete_confirmation.pt")\n     enableCSRFProtection = True\n@@ -140,7 +139,6 @@ class IRenameForm(Interface):\n \n \n class RenameForm(form.Form):\n-\n     fields = field.Fields(IRenameForm)\n     template = ViewPageTemplateFile("templates/object_rename.pt")\n     enableCSRFProtection = True\ndiff --git a/plone/app/content/browser/constraintypes.py b/plone/app/content/browser/constraintypes.py\nindex 6d8fd04..1074660 100644\n--- a/plone/app/content/browser/constraintypes.py\n+++ b/plone/app/content/browser/constraintypes.py\n@@ -61,7 +61,6 @@ def __call__(self, context):\n \n \n class IConstrainForm(Interface):\n-\n     constrain_types_mode = Choice(\n         title=_("label_type_restrictions", default="Type restrictions"),\n         description=_(\n@@ -140,7 +139,6 @@ def secondary_types(self):\n \n \n class ConstrainsFormView(AutoExtensibleForm, form.EditForm):\n-\n     schema = IConstrainForm\n     label = _(\n         "heading_set_content_type_restrictions",\ndiff --git a/plone/app/content/browser/content_status_history.py b/plone/app/content/browser/content_status_history.py\nindex b2882b9..d181077 100644\n--- a/plone/app/content/browser/content_status_history.py\n+++ b/plone/app/content/browser/content_status_history.py\n@@ -48,7 +48,6 @@ class ContentStatusHistoryDatesForm(form.Form):\n \n \n class ContentStatusHistoryView(BrowserView):\n-\n     template = ViewPageTemplateFile("templates/content_status_history.pt")\n \n     def __init__(self, context, request):\n@@ -66,9 +65,8 @@ def __call__(\n         effective_date=None,\n         expiration_date=None,\n         include_children=False,\n-        *args\n+        *args,\n     ):\n-\n         data = self.dates_form.extractData()\n         if self.request.get("form.widgets.effective_date-calendar", None) and data:\n             effective_date = data[0]["effective_date"].strftime("%Y-%m-%d %H:%M")\ndiff --git a/plone/app/content/browser/contents/__init__.py b/plone/app/content/browser/contents/__init__.py\nindex eaafd1c..d122c6f 100644\n--- a/plone/app/content/browser/contents/__init__.py\n+++ b/plone/app/content/browser/contents/__init__.py\n@@ -26,7 +26,6 @@\n \n \n class ContentsBaseAction(BrowserView):\n-\n     success_msg = _("Success")\n     failure_msg = _("Failure")\n     required_obj_permission = None\n@@ -293,7 +292,6 @@ def __call__(self):\n \n \n class ContextInfo(BrowserView):\n-\n     attributes = [\n         "CreationDate",\n         "Creator",\ndiff --git a/plone/app/content/browser/contents/copy.py b/plone/app/content/browser/contents/copy.py\nindex 015b995..4259bd7 100644\n--- a/plone/app/content/browser/contents/copy.py\n+++ b/plone/app/content/browser/contents/copy.py\n@@ -10,7 +10,6 @@\n \n @implementer(IStructureAction)\n class CopyAction:\n-\n     order = 2\n \n     def __init__(self, context, request):\ndiff --git a/plone/app/content/browser/contents/cut.py b/plone/app/content/browser/contents/cut.py\nindex e785931..d723330 100644\n--- a/plone/app/content/browser/contents/cut.py\n+++ b/plone/app/content/browser/contents/cut.py\n@@ -11,7 +11,6 @@\n \n @implementer(IStructureAction)\n class CutAction:\n-\n     order = 1\n \n     def __init__(self, context, request):\ndiff --git a/plone/app/content/browser/contents/delete.py b/plone/app/content/browser/contents/delete.py\nindex 5adac14..8eb6018 100644\n--- a/plone/app/content/browser/contents/delete.py\n+++ b/plone/app/content/browser/contents/delete.py\n@@ -16,7 +16,6 @@\n \n @implementer(IStructureAction)\n class DeleteAction:\n-\n     template = ViewPageTemplateFile("templates/delete.pt")\n     order = 4\n \ndiff --git a/plone/app/content/browser/contents/paste.py b/plone/app/content/browser/contents/paste.py\nindex 0250760..52c0965 100644\n--- a/plone/app/content/browser/contents/paste.py\n+++ b/plone/app/content/browser/contents/paste.py\n@@ -9,7 +9,6 @@\n \n @implementer(IStructureAction)\n class PasteAction:\n-\n     order = 3\n \n     def __init__(self, context, request):\ndiff --git a/plone/app/content/browser/contents/properties.py b/plone/app/content/browser/contents/properties.py\nindex aba4725..2395825 100644\n--- a/plone/app/content/browser/contents/properties.py\n+++ b/plone/app/content/browser/contents/properties.py\n@@ -20,7 +20,6 @@\n \n @implementer(IStructureAction)\n class PropertiesAction:\n-\n     template = ViewPageTemplateFile("templates/properties.pt")\n     order = 8\n \n@@ -54,7 +53,6 @@ class PropertiesActionView(ContentsBaseAction):\n     required_obj_permission = "Modify portal content"\n \n     def __call__(self):\n-\n         if self.request.form.get("render") == "yes":\n             lang_factory = getUtility(\n                 IVocabularyFactory, "plone.app.vocabularies.SupportedContentLanguages"\n@@ -95,7 +93,6 @@ def __call__(self):\n         return super().__call__()\n \n     def action(self, obj, bypass_recurse=False):\n-\n         if check_default_page_via_view(obj, self.request):\n             self.action(obj.aq_parent, bypass_recurse=True)\n         recurse = self.recurse and not bypass_recurse\ndiff --git a/plone/app/content/browser/contents/rename.py b/plone/app/content/browser/contents/rename.py\nindex 25ad37f..eb2a9d4 100644\n--- a/plone/app/content/browser/contents/rename.py\n+++ b/plone/app/content/browser/contents/rename.py\n@@ -23,7 +23,6 @@\n \n @implementer(IStructureAction)\n class RenameAction:\n-\n     template = ViewPageTemplateFile("templates/rename.pt")\n     order = 5\n \ndiff --git a/plone/app/content/browser/contents/tags.py b/plone/app/content/browser/contents/tags.py\nindex 01e8f14..fe18d20 100644\n--- a/plone/app/content/browser/contents/tags.py\n+++ b/plone/app/content/browser/contents/tags.py\n@@ -9,7 +9,6 @@\n \n @implementer(IStructureAction)\n class TagsAction:\n-\n     template = ViewPageTemplateFile("templates/tags.pt")\n     order = 6\n \ndiff --git a/plone/app/content/browser/contents/workflow.py b/plone/app/content/browser/contents/workflow.py\nindex a2a90a0..8b5a5bb 100644\n--- a/plone/app/content/browser/contents/workflow.py\n+++ b/plone/app/content/browser/contents/workflow.py\n@@ -14,7 +14,6 @@\n \n @implementer(IStructureAction)\n class WorkflowAction:\n-\n     template = ViewPageTemplateFile("templates/workflow.pt")\n     order = 7\n \ndiff --git a/plone/app/content/browser/i18n.py b/plone/app/content/browser/i18n.py\nindex 415508a..ebabfc1 100644\n--- a/plone/app/content/browser/i18n.py\n+++ b/plone/app/content/browser/i18n.py\n@@ -35,7 +35,6 @@ def _gettext_catalog(self, domain, language):\n         return _catalog\n \n     def __call__(self, domain=None, language=None):\n-\n         if domain is None:\n             catalog = {}\n         else:\ndiff --git a/plone/app/content/browser/selection.py b/plone/app/content/browser/selection.py\nindex 1d5a732..aaf5c56 100644\n--- a/plone/app/content/browser/selection.py\n+++ b/plone/app/content/browser/selection.py\n@@ -49,7 +49,9 @@ def __call__(self):\n             self.request.response.redirect(context_view_url)\n \n         if self.request.form.get("form.button.Save") and not template_id:\n-            IStatusMessage(self.request).add("Please select a template.", type="warning")\n+            IStatusMessage(self.request).add(\n+                "Please select a template.", type="warning"\n+            )\n \n         if self.request.form.get("form.button.Save") and template_id:\n             # Make sure this is a valid template\ndiff --git a/plone/app/content/testing.py b/plone/app/content/testing.py\nindex b5a85ce..20d1670 100644\n--- a/plone/app/content/testing.py\n+++ b/plone/app/content/testing.py\n@@ -45,7 +45,6 @@ def ExampleFunctionVocabulary(context, query=None):\n \n \n class PloneAppContent(PloneSandboxLayer):\n-\n     defaultBases = (PLONE_FIXTURE,)\n \n     USER_NAME = "johndoe"\ndiff --git a/plone/app/content/tests/test_adding.py b/plone/app/content/tests/test_adding.py\nindex b5b9bfb..b813c5e 100644\n--- a/plone/app/content/tests/test_adding.py\n+++ b/plone/app/content/tests/test_adding.py\n@@ -5,7 +5,6 @@\n \n \n class AddingTests(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/content/tests/test_content_status_modify.py b/plone/app/content/tests/test_content_status_modify.py\nindex e1e782e..7b53a48 100644\n--- a/plone/app/content/tests/test_content_status_modify.py\n+++ b/plone/app/content/tests/test_content_status_modify.py\n@@ -124,7 +124,6 @@ def testEditorCanSubmitButNotPublish(self):\n \n \n class TestContentStatusModifyFunctional(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_DX_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/content/tests/test_folder.py b/plone/app/content/tests/test_folder.py\nindex 01d2764..eef41bf 100644\n--- a/plone/app/content/tests/test_folder.py\n+++ b/plone/app/content/tests/test_folder.py\n@@ -51,7 +51,6 @@ def setUp(self):\n \n \n class DXBaseTest(BaseTest):\n-\n     layer = PLONE_APP_CONTENT_DX_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -126,7 +125,6 @@ def testCreators(self):\n \n \n class WorkflowTest(BaseTest):\n-\n     layer = PLONE_APP_CONTENT_DX_FUNCTIONAL_TESTING\n \n     def convertDateTimeToIndexRepr(self, date):\n@@ -166,7 +164,6 @@ def testStateChange(self):\n \n \n class RenameTest(BaseTest):\n-\n     layer = PLONE_APP_CONTENT_DX_INTEGRATION_TESTING\n \n     def test_folder_rename_objects(self):\n@@ -204,7 +201,6 @@ def test_default_page_updated_on_rename_objects(self):\n \n \n class ContextInfoTest(BaseTest):\n-\n     layer = PLONE_APP_CONTENT_DX_INTEGRATION_TESTING\n \n     def testStateChange(self):\ndiff --git a/plone/app/content/tests/test_namechooser_unit.py b/plone/app/content/tests/test_namechooser_unit.py\nindex ec3df75..d9d3f66 100644\n--- a/plone/app/content/tests/test_namechooser_unit.py\n+++ b/plone/app/content/tests/test_namechooser_unit.py\n@@ -13,7 +13,6 @@\n \n \n class NameChooserTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/content/tests/test_non_ascii_characters_in_workflow_state.py b/plone/app/content/tests/test_non_ascii_characters_in_workflow_state.py\nindex 386e069..cef6398 100644\n--- a/plone/app/content/tests/test_non_ascii_characters_in_workflow_state.py\n+++ b/plone/app/content/tests/test_non_ascii_characters_in_workflow_state.py\n@@ -11,7 +11,6 @@\n \n \n class TestNonAsciiCharactersWorkflow(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_NON_ASCII_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/content/tests/test_selectdefaultpage.py b/plone/app/content/tests/test_selectdefaultpage.py\nindex 3af4f1c..ff3a285 100644\n--- a/plone/app/content/tests/test_selectdefaultpage.py\n+++ b/plone/app/content/tests/test_selectdefaultpage.py\n@@ -28,12 +28,13 @@\n \n \n class SelectDefaultPageDXTestCase(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_DX_FUNCTIONAL_TESTING\n \n     def setUp(self):\n         self.portal = self.layer["portal"]\n-        self.portal.acl_users.userFolderAddUser("editor", TEST_USER_PASSWORD, ["Editor"], [])\n+        self.portal.acl_users.userFolderAddUser(\n+            "editor", TEST_USER_PASSWORD, ["Editor"], []\n+        )\n \n         self._create_structure()\n         transaction.commit()\ndiff --git a/plone/app/content/tests/test_widgets.py b/plone/app/content/tests/test_widgets.py\nindex c357713..d87b619 100644\n--- a/plone/app/content/tests/test_widgets.py\n+++ b/plone/app/content/tests/test_widgets.py\n@@ -69,7 +69,6 @@ def _disable_permission_checker(context):\n \n \n class BrowserTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_DX_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -664,7 +663,6 @@ def testGetMimeIcon(self):\n \n \n class FunctionalBrowserTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_DX_FUNCTIONAL_TESTING\n \n     def setUp(self):\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-18T11:30:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/7b413b1b64d969e54f40d956c185864cda7cff16

feat: pyroma

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex fc1f142..9a43d8b 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -38,6 +38,7 @@\n     namespace_packages=["plone", "plone.app"],\n     include_package_data=True,\n     zip_safe=False,\n+    python_requires=">=3.8",\n     extras_require=dict(\n         test=[\n             "plone.app.contenttypes",\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-18T11:30:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/8485180a1e08004ac7463e9dd8e7063417798086

feat: flake8

Files changed:
M plone/app/content/browser/constraintypes.py
M plone/app/content/browser/contents/properties.py

b'diff --git a/plone/app/content/browser/constraintypes.py b/plone/app/content/browser/constraintypes.py\nindex 1074660..1b83a09 100644\n--- a/plone/app/content/browser/constraintypes.py\n+++ b/plone/app/content/browser/constraintypes.py\n@@ -1,5 +1,4 @@\n from plone.autoform.form import AutoExtensibleForm\n-from plone.base import PloneMessageFactory as _\n from plone.base.interfaces import ISelectableConstrainTypes\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from z3c.form import button\ndiff --git a/plone/app/content/browser/contents/properties.py b/plone/app/content/browser/contents/properties.py\nindex 2395825..c51e8a7 100644\n--- a/plone/app/content/browser/contents/properties.py\n+++ b/plone/app/content/browser/contents/properties.py\n@@ -5,9 +5,7 @@\n from plone.app.widgets.utils import get_datetime_options\n from plone.base import PloneMessageFactory as _\n from plone.base.defaultpage import check_default_page_via_view\n-from plone.dexterity.interfaces import IDexterityContent\n from Products.CMFCore.interfaces._content import IFolderish\n-from Products.CMFCore.utils import getToolByName\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.component import getUtility\n from zope.component.hooks import getSite\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-18T11:30:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/97fcfbf3f42e0742c4c2fa0803a30321ccfab7d9

feat: codespell

Files changed:
M CHANGES.rst
M plone/app/content/browser/constraintypes.pt
M plone/app/content/browser/contents/__init__.py
M plone/app/content/browser/interfaces.py
M plone/app/content/browser/table.txt
M plone/app/content/browser/vocabulary.py
M plone/app/content/namechooser.py
M plone/app/content/tests/test_contents.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 531f0ce..ac89afd 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -210,7 +210,7 @@ Bug fixes:\n Bug fixes:\n \n \n-- Call fileUpload view explict with @@ to avoid possible plone.rest clashes.\n+- Call fileUpload view explicit with @@ to avoid possible plone.rest clashes.\n   [jensens] (#225)\n \n \n@@ -552,7 +552,7 @@ Bug fixes:\n   [thet]\n \n - Fix issue where some actions (copy, delete, paste) on contents view did not\n-  work if there were any private (innaccessible for the current user) levels the\n+  work if there were any private (inaccessible for the current user) levels the\n   current path\n   [datakurre]\n \n@@ -908,7 +908,7 @@ Fixes:\n - When clicking cancel on the delete_confirmation got to the view_url.\n   [ale-rt]\n \n-- Fix deletion of objects with unicode charaters in the title.\n+- Fix deletion of objects with unicode characters in the title.\n   [cillianderoiste]\n \n \n@@ -988,7 +988,7 @@ Fixes:\n - Translate folder contents add menu\n   [vangheem]\n \n-- use same columns title in results and in displayed colums configuration\n+- use same columns title in results and in displayed columns configuration\n   [vincent]\n \n \ndiff --git a/plone/app/content/browser/constraintypes.pt b/plone/app/content/browser/constraintypes.pt\nindex ead1a96..d2d50c1 100644\n--- a/plone/app/content/browser/constraintypes.pt\n+++ b/plone/app/content/browser/constraintypes.pt\n@@ -11,10 +11,10 @@\n               (function($){\n                 // Custom form constraints for constrain form\n                 $(document).ready(function(){\n-                  var prefered = $(".current_prefer_form"),\n+                  var preferred = $(".current_prefer_form"),\n                       allowed = $(".current_allow_form"),\n                       constrain_mode = $(".constrain_types_mode_form"),\n-                      prefered_field = prefered.parents(\'.field\'),\n+                      preferred_field = preferred.parents(\'.field\'),\n                       allowed_field = allowed.parents(\'.field\'),\n                       ACQUIRE = -1,\n                       DISABLED = 0,\n@@ -22,15 +22,15 @@\n                   function updateVisibility(){\n                     var mode = constrain_mode.val();\n                     if(mode == ENABLED){\n-                      prefered_field.show();\n+                      preferred_field.show();\n                       allowed_field.show();\n                     }else{\n-                      prefered_field.hide();\n+                      preferred_field.hide();\n                       allowed_field.hide();\n                     }\n                   }\n                   function updateSelectable(){\n-                    prefered.each(function(){\n+                    preferred.each(function(){\n                       var allowed_id = this.id.replace(\'allowed\', \'secondary\'),\n                           allowed_item = allowed_field.find("#" + allowed_id);\n                       if (this.checked){\n@@ -43,7 +43,7 @@\n                   }\n                   constrain_mode.change(updateVisibility);\n                   updateVisibility();\n-                  prefered_field.change(updateSelectable);\n+                  preferred_field.change(updateSelectable);\n                   updateSelectable();\n                 })\n               }(jQuery));\ndiff --git a/plone/app/content/browser/contents/__init__.py b/plone/app/content/browser/contents/__init__.py\nindex d122c6f..66b8f22 100644\n--- a/plone/app/content/browser/contents/__init__.py\n+++ b/plone/app/content/browser/contents/__init__.py\n@@ -182,7 +182,7 @@ def get_thumb_scale(self):\n         registry = getUtility(IRegistry)\n         settings = registry.forInterface(ISiteSchema, prefix="plone", check=False)\n         if settings.no_thumbs_tables:\n-            # thumbs to be supressed\n+            # thumbs to be suppressed\n             return None\n         thumb_scale_table = settings.thumb_scale_table\n         return thumb_scale_table\ndiff --git a/plone/app/content/browser/interfaces.py b/plone/app/content/browser/interfaces.py\nindex 4cdfc35..5f300c3 100644\n--- a/plone/app/content/browser/interfaces.py\n+++ b/plone/app/content/browser/interfaces.py\n@@ -2,7 +2,7 @@\n \n \n class IFolderContentsView(Interface):\n-    """Interface, which provides methods for folder contens"""\n+    """Interface, which provides methods for folder contents"""\n \n     def test(a, b, c):\n         """A simple replacement of python\'s test."""\ndiff --git a/plone/app/content/browser/table.txt b/plone/app/content/browser/table.txt\nindex f333787..ae906a2 100644\n--- a/plone/app/content/browser/table.txt\n+++ b/plone/app/content/browser/table.txt\n@@ -3,7 +3,7 @@ Table\n =====\n \n The table class can render a table like used in the folder contents view. It is\n-abstracted into a seperate class for reuse with other views like the review\n+abstracted into a separate class for reuse with other views like the review\n list.\n \n A table can be parameterized at creation time.\n@@ -31,11 +31,11 @@ One of the table\'s main virtues is that it batches. A template can use the\n   True\n \n The table automatically adds keys for making layout easier. One of these is\n-indication wheter an item is `checked`.\n+indication whether an item is `checked`.\n \n   >>> list(table.batch)[0][\'checked\']\n \n-Wheter or not an item is checked depends on request variables. If either the\n+Whether or not an item is checked depends on request variables. If either the\n whole batch or the current screen is selected the item we be marked as checked.\n Below we will demonstrate this by selecting the items on screen.\n \n@@ -129,8 +129,8 @@ The same goes for selecting the screen and the whole batch.\n   \'http://plone/view?pagenumber=1&pagesize=20&select=all\'\n \n A template may want to display only one of these urls at the same time.\n-Therefore the table has a boolean property to query wheter or not to show the\n-select all option. The display of this depends on wheter the whole batch is\n+Therefore the table has a boolean property to query whether or not to show the\n+select all option. The display of this depends on whether the whole batch is\n selected (don\'t show) or the screen has not been selected (don\'t show then).\n \n   >>> table = Table({}, base_url, view_url, items=items)\ndiff --git a/plone/app/content/browser/vocabulary.py b/plone/app/content/browser/vocabulary.py\nindex f7693cd..822eb60 100644\n--- a/plone/app/content/browser/vocabulary.py\n+++ b/plone/app/content/browser/vocabulary.py\n@@ -139,7 +139,7 @@ def __call__(self):\n                     sort_on: index,\n                     sort_order: (asc|reversed)\n                 }\n-        attributes: comma seperated, or json object list\n+        attributes: comma separated, or json object list\n         batch: {\n             page: 1-based page of results,\n             size: size of paged results\n@@ -183,7 +183,7 @@ def __call__(self):\n         if batch and ("size" not in batch or "page" not in batch):\n             batch = None  # batching not providing correct options\n         if batch:\n-            # must be slicable for batching support\n+            # must be sliceable for batching support\n             page = int(batch["page"])\n             size = int(batch["size"])\n             if size > MAX_BATCH_SIZE:\ndiff --git a/plone/app/content/namechooser.py b/plone/app/content/namechooser.py\nindex c16633b..0d9fe5e 100644\n--- a/plone/app/content/namechooser.py\n+++ b/plone/app/content/namechooser.py\n@@ -83,7 +83,7 @@ def _findUniqueName(self, name, obj):\n             return new_name\n \n         raise ValueError(\n-            "Cannot find a unique name based on %s after %d attemps."\n+            "Cannot find a unique name based on %s after %d attempts."\n             % (\n                 name,\n                 ATTEMPTS,\ndiff --git a/plone/app/content/tests/test_contents.py b/plone/app/content/tests/test_contents.py\nindex f7402fa..80ba2ec 100644\n--- a/plone/app/content/tests/test_contents.py\n+++ b/plone/app/content/tests/test_contents.py\n@@ -90,8 +90,8 @@ def setUp(self):\n     @mock.patch(\n         "plone.app.content.browser.contents.ContentsBaseAction.protect", lambda x: True\n     )  # noqa\n-    def test_delete_success_with_private_anchestor(self):\n-        """Delete content item from a folder with private anchestor"""\n+    def test_delete_success_with_private_ancestor(self):\n+        """Delete content item from a folder with private ancestor"""\n         # Create test content /it1/it2/it3\n         self.portal.invokeFactory("type1", id="it1", title="Item 1")\n         self.portal.it1.invokeFactory("type1", id="it2", title="Item 2")\n@@ -222,8 +222,8 @@ def test_paste_fail_constraint(self):\n     @mock.patch(\n         "plone.app.content.browser.contents.ContentsBaseAction.protect", lambda x: True\n     )  # noqa\n-    def test_paste_success_with_private_anchestor(self):\n-        """Copy content item and paste into a folder with private anchestor"""\n+    def test_paste_success_with_private_ancestor(self):\n+        """Copy content item and paste into a folder with private ancestor"""\n         # Create test content /it2/it3\n         self.portal.invokeFactory("type1", id="it2", title="Item 2")\n         self.portal.it2.invokeFactory("type1", id="it3", title="Item 3")\n@@ -274,8 +274,8 @@ def setUp(self):\n     @mock.patch(\n         "plone.app.content.browser.contents.ContentsBaseAction.protect", lambda x: True\n     )  # noqa\n-    def test_rename_success_with_private_anchestor(self):\n-        """Rename content item from a folder with private anchestor"""\n+    def test_rename_success_with_private_ancestor(self):\n+        """Rename content item from a folder with private ancestor"""\n         # Create test content /it1/it2/it3\n         self.portal.invokeFactory("type1", id="it1", title="Item 1")\n         self.portal.it1.invokeFactory("type1", id="it2", title="Item 2")\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-18T11:30:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/b40b27fc33a140fe292da1aba5e73a9f2fcffd99

feat: declare dependencies

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex 9a43d8b..5936c5b 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -41,21 +41,39 @@\n     python_requires=">=3.8",\n     extras_require=dict(\n         test=[\n-            "plone.app.contenttypes",\n+            "plone.app.contenttypes[test]",\n             "plone.app.testing",\n+            "plone.dexterity",\n+            "plone.namedfile",\n+            "plone.testing",\n+            "zope.annotation",\n+            "Products.GenericSetup",\n         ]\n     ),\n     install_requires=[\n+        "plone.app.dexterity",\n+        "plone.app.layout",\n+        "plone.app.querystring",\n+        "plone.app.uuid",\n+        "plone.app.vocabularies>4.1.2",\n         "plone.app.widgets",\n+        "plone.app.z3cform",\n+        "plone.autoform",\n         "plone.base",\n         "plone.i18n",\n+        "plone.folder",\n+        "plone.locking",\n         "plone.memoize",\n         "plone.protect",\n+        "plone.supermodel",\n+        "plone.uuid",\n+        "Missing",\n+        "Products.MimetypesRegistry",\n+        "Products.PortalTransforms",\n         "Products.statusmessages",\n-        "Products.CMFDynamicViewFTI",  # required for cmf.ModifyViewTemplate\n-        "plone.app.vocabularies>4.1.2",\n-        "setuptools",\n         "simplejson",\n+        "z3c.relationfield",\n         "z3c.form",\n+        "zope.browsermenu",\n     ],\n )\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-18T11:30:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/90fa015eb39abae377a53bd953f49de06fccdc30

feat: i18ndude

Files changed:
M plone/app/content/browser/templates/content_status_history.pt

b'diff --git a/plone/app/content/browser/templates/content_status_history.pt b/plone/app/content/browser/templates/content_status_history.pt\nindex 6edd7a9..05dbd29 100644\n--- a/plone/app/content/browser/templates/content_status_history.pt\n+++ b/plone/app/content/browser/templates/content_status_history.pt\n@@ -25,8 +25,8 @@\n \n     <tal:comment tal:condition="nothing">\n       <div class="portalMessage info" role="status">\n-        <strong>Note</strong>\n-        <span>This form is used in two different ways - from folder_contents,\n+        <strong i18n:translate="">Note</strong>\n+        <span i18n:translate="">This form is used in two different ways - from folder_contents,\n         allowing you to publish several things at once, and from the state\n         drop-down. In the first case, the \'paths\' request parameter is set;\n         in the second case, giving the relative paths to the content object\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-18T11:30:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/b676160c3017d7bfd6afaa1826069ba685eb8046

fix: break circular dependency

With `plone.app.layout`

Files changed:
M plone/app/content/browser/configure.zcml
M plone/app/content/browser/vocabulary.py
M setup.py

b'diff --git a/plone/app/content/browser/configure.zcml b/plone/app/content/browser/configure.zcml\nindex b69207b..8c9ce6e 100644\n--- a/plone/app/content/browser/configure.zcml\n+++ b/plone/app/content/browser/configure.zcml\n@@ -182,13 +182,13 @@\n \n     <browser:page\n         name="qsOptions"\n-        for="plone.app.layout.navigation.interfaces.INavigationRoot"\n+        for="plone.base.interfaces.siteroot.INavigationRoot"\n         class=".query.QueryStringIndexOptions"\n         permission="zope2.View"\n         />\n \n     <browser:view\n-        for="plone.app.layout.navigation.interfaces.INavigationRoot"\n+        for="plone.base.interfaces.siteroot.INavigationRoot"\n         name="plonejsi18n"\n         class=".i18n.i18njs"\n         permission="zope2.View"\ndiff --git a/plone/app/content/browser/vocabulary.py b/plone/app/content/browser/vocabulary.py\nindex 822eb60..9464947 100644\n--- a/plone/app/content/browser/vocabulary.py\n+++ b/plone/app/content/browser/vocabulary.py\n@@ -3,12 +3,12 @@\n from logging import getLogger\n from plone.app.content.utils import json_dumps\n from plone.app.content.utils import json_loads\n-from plone.app.layout.navigation.interfaces import INavigationRoot\n-from plone.app.layout.navigation.root import getNavigationRoot\n from plone.app.querystring import queryparser\n from plone.app.z3cform.interfaces import IFieldPermissionChecker\n from plone.autoform.interfaces import WRITE_PERMISSIONS_KEY\n from plone.base import PloneMessageFactory as _\n+from plone.base.interfaces.siteroot import INavigationRoot\n+from plone.base.navigationroot import get_navigation_root\n from plone.base.utils import safe_text\n from plone.memoize.view import memoize\n from plone.supermodel.utils import mergedTaggedValueDict\n@@ -125,7 +125,7 @@ def get_translated_ignored(self):\n         return TRANSLATED_IGNORED\n \n     def get_base_path(self, context):\n-        return getNavigationRoot(context)\n+        return get_navigation_root(context)\n \n     def __call__(self):\n         """\ndiff --git a/setup.py b/setup.py\nindex 5936c5b..60acf6d 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -52,7 +52,6 @@\n     ),\n     install_requires=[\n         "plone.app.dexterity",\n-        "plone.app.layout",\n         "plone.app.querystring",\n         "plone.app.uuid",\n         "plone.app.vocabularies>4.1.2",\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-18T11:30:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/1fb49faceb9a0c8e6a445aac82f94ed6b5e9be01

chore: zpretty XML/ZCML

Files changed:
M plone/app/content/browser/configure.zcml
M plone/app/content/browser/contents/configure.zcml
M plone/app/content/configure.zcml
M plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows.xml
M plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows/non-ascii-workflow/definition.xml
M plone/app/content/tests/profiles/non-ascii-workflow.zcml

b'diff --git a/plone/app/content/browser/configure.zcml b/plone/app/content/browser/configure.zcml\nindex 8c9ce6e6..f2762e98 100644\n--- a/plone/app/content/browser/configure.zcml\n+++ b/plone/app/content/browser/configure.zcml\n@@ -1,204 +1,213 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n-    xmlns:five="http://namespaces.zope.org/five">\n-\n-    <!-- Adding view -->\n-    <browser:view\n-        for="Products.CMFCore.interfaces.IFolderish"\n-        name="+"\n-        class=".adding.CMFAdding"\n-        permission="cmf.AddPortalContent"\n-        />\n-\n-    <!-- Folder contents -->\n-    <include package=".contents" />\n-\n-    <!-- Review list -->\n-    <browser:page\n-        for="*"\n-        class=".reviewlist.FullReviewListView"\n-        name="full_review_list"\n-        template="full_review_list.pt"\n-        permission="cmf.ReviewPortalContent" />\n-\n-    <browser:page\n-         for="*"\n-         class=".reviewlist.ReviewListBrowserView"\n-         attribute="update_table"\n-         name="reviewlist_get_table"\n-         permission="cmf.ReviewPortalContent" />\n-\n-    <!-- Content status history -->\n-    <browser:page\n-        for="*"\n-        name="content_status_history"\n-        class=".content_status_history.ContentStatusHistoryView"\n-        permission="cmf.ModifyPortalContent"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="folder_publish"\n-        class=".folder_publish.FolderPublishView"\n-        permission="cmf.ModifyPortalContent"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="content_status_modify"\n-        class=".content_status_modify.ContentStatusModifyView"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Folder factories -->\n-    <browser:page\n-        for="*"\n-        name="folder_factories"\n-        class=".folderfactories.FolderFactoriesView"\n-        template="folderfactories.pt"\n-        permission="cmf.AddPortalContent"\n-        />\n-\n-    <!-- Constrain container allowed content types -->\n-    <permission\n-        id="plone.ModifyConstrainTypes"\n-        title="Modify constrain types"\n-        />\n-    <browser:page\n-        name="folder_constraintypes_form"\n-        for="Products.CMFCore.interfaces.IFolderish"\n-        permission="plone.ModifyConstrainTypes"\n-        class=".constraintypes.ConstrainsFormView"\n-        />\n-    <utility\n-        component=".constraintypes.ValidTypesFactory"\n-        name="plone.app.content.ValidAddableTypes"\n-        />\n-\n-    <!-- Required for cmf.ModifyViewTemplate -->\n-    <include package="Products.CMFDynamicViewFTI" />\n-\n-    <!-- Select default view -->\n-    <browser:page\n-        for="*"\n-        name="select_default_view"\n-        class=".selection.DefaultViewSelectionView"\n-        template="templates/select_default_view.pt"\n-        permission="cmf.ModifyViewTemplate"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="selectViewTemplate"\n-        class=".selection.DefaultViewSelectionView"\n-        attribute="selectViewTemplate"\n-        permission="cmf.ModifyViewTemplate"\n-        />\n-\n-    <!-- Select default page view -->\n-    <browser:page\n-        for="*"\n-        name="select_default_page"\n-        class=".selection.DefaultPageSelectionView"\n-        template="templates/select_default_page.pt"\n-        permission="cmf.ModifyViewTemplate"\n-        />\n-\n-    <!-- Actions -->\n-    <browser:page\n-        for="*"\n-        name="delete_confirmation"\n-        class=".actions.DeleteConfirmationForm"\n-        permission="zope2.DeleteObjects"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="folder_rename"\n-        class=".actions.RenameForm"\n-        permission="cmf.ModifyPortalContent"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="object_rename"\n-        class=".actions.RenameForm"\n-        permission="cmf.ModifyPortalContent"\n-        />\n-\n-    <adapter factory=".actions.default_new_id" name="default" />\n-    <adapter factory=".actions.default_new_title" name="default" />\n-\n-    <browser:page\n-        for="*"\n-        name="object_cut"\n-        class=".actions.ObjectCutView"\n-        permission="zope2.DeleteObjects"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="object_copy"\n-        class=".actions.ObjectCopyView"\n-        permission="zope2.CopyOrMove"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="object_paste"\n-        class=".actions.ObjectPasteView"\n-        permission="cmf.AddPortalContent"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="object_delete"\n-        class=".actions.ObjectDeleteView"\n-        permission="zope2.DeleteObjects"\n-        />\n-\n-\n-    <browser:page\n-        name="getVocabulary"\n-        for="*"\n-        class=".vocabulary.VocabularyView"\n-        permission="zope2.View"\n-        />\n-\n-    <browser:page\n-        name="getSource"\n-        for="z3c.form.interfaces.IWidget"\n-        class=".vocabulary.SourceView"\n-        permission="zope.Public"\n-        />\n-\n-    <browser:page\n-        name="fileUpload"\n-        for="Products.CMFCore.interfaces._content.IFolderish"\n-        class=".file.FileUploadView"\n-        permission="zope2.View"\n-        />\n-\n-    <browser:page\n-        name="qsOptions"\n-        for="plone.base.interfaces.siteroot.INavigationRoot"\n-        class=".query.QueryStringIndexOptions"\n-        permission="zope2.View"\n-        />\n-\n-    <browser:view\n-        for="plone.base.interfaces.siteroot.INavigationRoot"\n-        name="plonejsi18n"\n-        class=".i18n.i18njs"\n-        permission="zope2.View"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="allow_upload"\n-        class=".file.AllowUploadView"\n-        permission="cmf.AddPortalContent"\n-        />\n+    xmlns:five="http://namespaces.zope.org/five"\n+    >\n+\n+  <!-- Adding view -->\n+  <browser:view\n+      name="+"\n+      for="Products.CMFCore.interfaces.IFolderish"\n+      class=".adding.CMFAdding"\n+      permission="cmf.AddPortalContent"\n+      />\n+\n+  <!-- Folder contents -->\n+  <include package=".contents" />\n+\n+  <!-- Review list -->\n+  <browser:page\n+      name="full_review_list"\n+      for="*"\n+      class=".reviewlist.FullReviewListView"\n+      template="full_review_list.pt"\n+      permission="cmf.ReviewPortalContent"\n+      />\n+\n+  <browser:page\n+      name="reviewlist_get_table"\n+      for="*"\n+      class=".reviewlist.ReviewListBrowserView"\n+      attribute="update_table"\n+      permission="cmf.ReviewPortalContent"\n+      />\n+\n+  <!-- Content status history -->\n+  <browser:page\n+      name="content_status_history"\n+      for="*"\n+      class=".content_status_history.ContentStatusHistoryView"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n+  <browser:page\n+      name="folder_publish"\n+      for="*"\n+      class=".folder_publish.FolderPublishView"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n+  <browser:page\n+      name="content_status_modify"\n+      for="*"\n+      class=".content_status_modify.ContentStatusModifyView"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Folder factories -->\n+  <browser:page\n+      name="folder_factories"\n+      for="*"\n+      class=".folderfactories.FolderFactoriesView"\n+      template="folderfactories.pt"\n+      permission="cmf.AddPortalContent"\n+      />\n+\n+  <!-- Constrain container allowed content types -->\n+  <permission\n+      id="plone.ModifyConstrainTypes"\n+      title="Modify constrain types"\n+      />\n+  <browser:page\n+      name="folder_constraintypes_form"\n+      for="Products.CMFCore.interfaces.IFolderish"\n+      class=".constraintypes.ConstrainsFormView"\n+      permission="plone.ModifyConstrainTypes"\n+      />\n+  <utility\n+      name="plone.app.content.ValidAddableTypes"\n+      component=".constraintypes.ValidTypesFactory"\n+      />\n+\n+  <!-- Required for cmf.ModifyViewTemplate -->\n+  <include package="Products.CMFDynamicViewFTI" />\n+\n+  <!-- Select default view -->\n+  <browser:page\n+      name="select_default_view"\n+      for="*"\n+      class=".selection.DefaultViewSelectionView"\n+      template="templates/select_default_view.pt"\n+      permission="cmf.ModifyViewTemplate"\n+      />\n+\n+  <browser:page\n+      name="selectViewTemplate"\n+      for="*"\n+      class=".selection.DefaultViewSelectionView"\n+      attribute="selectViewTemplate"\n+      permission="cmf.ModifyViewTemplate"\n+      />\n+\n+  <!-- Select default page view -->\n+  <browser:page\n+      name="select_default_page"\n+      for="*"\n+      class=".selection.DefaultPageSelectionView"\n+      template="templates/select_default_page.pt"\n+      permission="cmf.ModifyViewTemplate"\n+      />\n+\n+  <!-- Actions -->\n+  <browser:page\n+      name="delete_confirmation"\n+      for="*"\n+      class=".actions.DeleteConfirmationForm"\n+      permission="zope2.DeleteObjects"\n+      />\n+\n+  <browser:page\n+      name="folder_rename"\n+      for="*"\n+      class=".actions.RenameForm"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n+  <browser:page\n+      name="object_rename"\n+      for="*"\n+      class=".actions.RenameForm"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n+  <adapter\n+      factory=".actions.default_new_id"\n+      name="default"\n+      />\n+  <adapter\n+      factory=".actions.default_new_title"\n+      name="default"\n+      />\n+\n+  <browser:page\n+      name="object_cut"\n+      for="*"\n+      class=".actions.ObjectCutView"\n+      permission="zope2.DeleteObjects"\n+      />\n+\n+  <browser:page\n+      name="object_copy"\n+      for="*"\n+      class=".actions.ObjectCopyView"\n+      permission="zope2.CopyOrMove"\n+      />\n+\n+  <browser:page\n+      name="object_paste"\n+      for="*"\n+      class=".actions.ObjectPasteView"\n+      permission="cmf.AddPortalContent"\n+      />\n+\n+  <browser:page\n+      name="object_delete"\n+      for="*"\n+      class=".actions.ObjectDeleteView"\n+      permission="zope2.DeleteObjects"\n+      />\n+\n+\n+  <browser:page\n+      name="getVocabulary"\n+      for="*"\n+      class=".vocabulary.VocabularyView"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:page\n+      name="getSource"\n+      for="z3c.form.interfaces.IWidget"\n+      class=".vocabulary.SourceView"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:page\n+      name="fileUpload"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".file.FileUploadView"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:page\n+      name="qsOptions"\n+      for="plone.base.interfaces.siteroot.INavigationRoot"\n+      class=".query.QueryStringIndexOptions"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:view\n+      name="plonejsi18n"\n+      for="plone.base.interfaces.siteroot.INavigationRoot"\n+      class=".i18n.i18njs"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:page\n+      name="allow_upload"\n+      for="*"\n+      class=".file.AllowUploadView"\n+      permission="cmf.AddPortalContent"\n+      />\n \n </configure>\ndiff --git a/plone/app/content/browser/contents/configure.zcml b/plone/app/content/browser/contents/configure.zcml\nindex d6773cb5..931d4b90 100644\n--- a/plone/app/content/browser/contents/configure.zcml\n+++ b/plone/app/content/browser/contents/configure.zcml\n@@ -1,123 +1,140 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n+    xmlns:i18n="http://namespaces.zope.org/i18n"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:i18n="http://namespaces.zope.org/i18n">\n+    >\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    class=".FolderContentsView"\n-    name="folder_contents"\n-    template="templates/folder_contents.pt"\n-    permission="cmf.ListFolderContents"\n-    />\n+      name="folder_contents"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".FolderContentsView"\n+      template="templates/folder_contents.pt"\n+      permission="cmf.ListFolderContents"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-contextInfo"\n-    class=".ContextInfo"\n-    permission="cmf.ListFolderContents"\n-    />\n+      name="fc-contextInfo"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".ContextInfo"\n+      permission="cmf.ListFolderContents"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-setDefaultPage"\n-    class=".defaultpage.SetDefaultPageActionView"\n-    permission="cmf.ModifyPortalContent"\n-    />\n+      name="fc-setDefaultPage"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".defaultpage.SetDefaultPageActionView"\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-itemOrder"\n-    class=".rearrange.ItemOrderActionView"\n-    permission="cmf.ModifyPortalContent"\n-    />\n+      name="fc-itemOrder"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".rearrange.ItemOrderActionView"\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-rearrange"\n-    class=".rearrange.RearrangeActionView"\n-    permission="cmf.ModifyPortalContent"\n-    />\n+      name="fc-rearrange"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".rearrange.RearrangeActionView"\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n   <!-- buttons -->\n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-rename"\n-    class=".rename.RenameActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".rename.RenameAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="rename" />\n+      name="fc-rename"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".rename.RenameActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="rename"\n+      component=".rename.RenameAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-tags"\n-    class=".tags.TagsActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".tags.TagsAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="tags" />\n+      name="fc-tags"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".tags.TagsActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="tags"\n+      component=".tags.TagsAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-delete"\n-    class=".delete.DeleteActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".delete.DeleteAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="delete" />\n+      name="fc-delete"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".delete.DeleteActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="delete"\n+      component=".delete.DeleteAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-workflow"\n-    class=".workflow.WorkflowActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".workflow.WorkflowAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="workflow" />\n+      name="fc-workflow"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".workflow.WorkflowActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="workflow"\n+      component=".workflow.WorkflowAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-properties"\n-    class=".properties.PropertiesActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".properties.PropertiesAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="properties" />\n+      name="fc-properties"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".properties.PropertiesActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="properties"\n+      component=".properties.PropertiesAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-copy"\n-    class=".copy.CopyActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".copy.CopyAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="copy" />\n+      name="fc-copy"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".copy.CopyActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="copy"\n+      component=".copy.CopyAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-cut"\n-    class=".cut.CutActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".cut.CutAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="cut" />\n+      name="fc-cut"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".cut.CutActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="cut"\n+      component=".cut.CutAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-paste"\n-    class=".paste.PasteActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".paste.PasteAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="paste" />\n+      name="fc-paste"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".paste.PasteActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="paste"\n+      component=".paste.PasteAction"\n+      />\n </configure>\ndiff --git a/plone/app/content/configure.zcml b/plone/app/content/configure.zcml\nindex 60466f64..615fd613 100644\n--- a/plone/app/content/configure.zcml\n+++ b/plone/app/content/configure.zcml\n@@ -1,23 +1,24 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:five="http://namespaces.zope.org/five"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n-    <include package="plone.app.vocabularies" />\n-    <include package=".browser" />\n+  <include package="plone.app.vocabularies" />\n+  <include package=".browser" />\n \n-    <!-- Register a name chooser that chooses plone-like normalized names -->\n-    <adapter\n-      for="Products.CMFCore.interfaces.IFolderish"\n+  <!-- Register a name chooser that chooses plone-like normalized names -->\n+  <adapter\n       factory=".namechooser.NormalizingNameChooser"\n       provides="zope.container.interfaces.INameChooser"\n+      for="Products.CMFCore.interfaces.IFolderish"\n       />\n \n-    <!-- Re-index content when it\'s modified -->\n-    <subscriber\n-        for=".interfaces.IReindexOnModify\n-             zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n-        handler=".catalog.reindexOnModify"\n-        />\n+  <!-- Re-index content when it\'s modified -->\n+  <subscriber\n+      for=".interfaces.IReindexOnModify\n+           zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n+      handler=".catalog.reindexOnModify"\n+      />\n \n </configure>\ndiff --git a/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows.xml b/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows.xml\nindex 12fd9c2e..8f49355d 100644\n--- a/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows.xml\n+++ b/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows.xml\n@@ -1,6 +1,10 @@\n-<?xml version="1.0"?>\n-<object name="portal_workflow" meta_type="Plone Workflow Tool">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Workflow Tool"\n+        name="portal_workflow"\n+>\n \n-    <object name="non-ascii-workflow" meta_type="Workflow" />\n+  <object meta_type="Workflow"\n+          name="non-ascii-workflow"\n+  />\n \n </object>\ndiff --git a/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows/non-ascii-workflow/definition.xml b/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows/non-ascii-workflow/definition.xml\nindex 308dc6a3..cbd432e7 100644\n--- a/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows/non-ascii-workflow/definition.xml\n+++ b/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows/non-ascii-workflow/definition.xml\n@@ -1,55 +1,72 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <dc-workflow xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-             i18n:domain="plone.app.content.tests"\n-             workflow_id="non-ascii-workflow"\n-             title="Workflow for non-ascii characters"\n              description=""\n-             state_variable="review_state"\n              initial_state="initial"\n-             i18n:attributes="title">\n+             state_variable="review_state"\n+             title="Workflow for non-ascii characters"\n+             workflow_id="non-ascii-workflow"\n+             i18n:attributes="title"\n+             i18n:domain="plone.app.content.tests"\n+>\n \n- <permission>View</permission>\n+  <permission>View</permission>\n \n- <state state_id="initial" title="\xc3\x8fnitial" i18n:attributes="title">\n-  <exit-transition transition_id="to_after"/>\n-  <permission-map name="View permission for testing non-ascii title"\n-                  acquired="False">\n-   <permission-role>Manager</permission-role>\n-  </permission-map>\n- </state>\n+  <state state_id="initial"\n+         title="\xc3\x8fnitial"\n+         i18n:attributes="title"\n+  >\n+    <exit-transition transition_id="to_after" />\n+    <permission-map acquired="False"\n+                    name="View permission for testing non-ascii title"\n+    >\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+  </state>\n \n- <state state_id="after" title="\xc3\x84fter" i18n:attributes="title">\n-  <exit-transition transition_id="to_initial"/>\n-  <permission-map name="View permission for testing non-ascii title"\n-                  acquired="False">\n-   <permission-role>Manager</permission-role>\n-  </permission-map>\n- </state>\n+  <state state_id="after"\n+         title="\xc3\x84fter"\n+         i18n:attributes="title"\n+  >\n+    <exit-transition transition_id="to_initial" />\n+    <permission-map acquired="False"\n+                    name="View permission for testing non-ascii title"\n+    >\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+  </state>\n \n- <transition transition_id="to_after" new_state="after"\n-             title="To \xc3\x84fter!"\n-             trigger="USER"\n-             before_script="" after_script=""\n-             i18n:attributes="title">\n-  <action url="%(content_url)s/content_status_modify?workflow_action=to_after"\n-          category="workflow"\n-          i18n:translate="">To \xc3\x84fter!</action>\n-  <guard>\n-   <guard-permission>Modify portal content</guard-permission>\n-  </guard>\n- </transition>\n+  <transition after_script=""\n+              before_script=""\n+              new_state="after"\n+              title="To \xc3\x84fter!"\n+              transition_id="to_after"\n+              trigger="USER"\n+              i18n:attributes="title"\n+  >\n+    <action category="workflow"\n+            url="%(content_url)s/content_status_modify?workflow_action=to_after"\n+            i18n:translate=""\n+    >To \xc3\x84fter!</action>\n+    <guard>\n+      <guard-permission>Modify portal content</guard-permission>\n+    </guard>\n+  </transition>\n \n- <transition transition_id="to_initial" new_state="initial"\n-             title="To \xc3\x8fnitial!"\n-             trigger="USER"\n-             before_script="" after_script=""\n-             i18n:attributes="title">\n-  <action url="%(content_url)s/content_status_modify?workflow_action=to_initial"\n-          category="workflow"\n-          i18n:translate="">To \xc3\x8fnitial!</action>\n-  <guard>\n-   <guard-permission>Modify portal content</guard-permission>\n-  </guard>\n- </transition>\n+  <transition after_script=""\n+              before_script=""\n+              new_state="initial"\n+              title="To \xc3\x8fnitial!"\n+              transition_id="to_initial"\n+              trigger="USER"\n+              i18n:attributes="title"\n+  >\n+    <action category="workflow"\n+            url="%(content_url)s/content_status_modify?workflow_action=to_initial"\n+            i18n:translate=""\n+    >To \xc3\x8fnitial!</action>\n+    <guard>\n+      <guard-permission>Modify portal content</guard-permission>\n+    </guard>\n+  </transition>\n \n </dc-workflow>\ndiff --git a/plone/app/content/tests/profiles/non-ascii-workflow.zcml b/plone/app/content/tests/profiles/non-ascii-workflow.zcml\nindex 1f2ac79a..5b84eb18 100644\n--- a/plone/app/content/tests/profiles/non-ascii-workflow.zcml\n+++ b/plone/app/content/tests/profiles/non-ascii-workflow.zcml\n@@ -1,14 +1,15 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    i18n_domain="plone.app.content.tests">\n+    i18n_domain="plone.app.content.tests"\n+    >\n \n-    <genericsetup:registerProfile\n-        name="non-ascii-workflow"\n-        title="plone.app.content.tests: non-ascii-workflow"\n-        directory="non-ascii-workflow-profile"\n-        description=""\n-        provides="Products.GenericSetup.interfaces.EXTENSION"\n-        />\n+  <genericsetup:registerProfile\n+      name="non-ascii-workflow"\n+      title="plone.app.content.tests: non-ascii-workflow"\n+      description=""\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="non-ascii-workflow-profile"\n+      />\n \n </configure>\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-18T11:30:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/e0d3862965b1510b22f90fac5932108e8bbb58ec

chore: zpretty PT

Files changed:
M plone/app/content/browser/constraintypes.pt
M plone/app/content/browser/folderfactories.pt
M plone/app/content/browser/full_review_list.pt
M plone/app/content/browser/table.pt

b'diff --git a/plone/app/content/browser/constraintypes.pt b/plone/app/content/browser/constraintypes.pt\nindex d2d50c1..2cb548d 100644\n--- a/plone/app/content/browser/constraintypes.pt\n+++ b/plone/app/content/browser/constraintypes.pt\n@@ -1,13 +1,17 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="here/main_template/macros/master"\n-      i18n:domain="plone.app.dexterity">\n-      <head>\n-        <div metal:fill-slot="javascript_head_slot" tal:omit-tag="">\n-          <script type="text/javascript">\n+      xml:lang="en"\n+      i18n:domain="plone.app.dexterity"\n+>\n+  <head>\n+    <div metal:fill-slot="javascript_head_slot"\n+         tal:omit-tag=""\n+    >\n+      <script type="text/javascript">\n               (function($){\n                 // Custom form constraints for constrain form\n                 $(document).ready(function(){\n@@ -47,16 +51,18 @@\n                   updateSelectable();\n                 })\n               }(jQuery));\n-          </script>\n-        </div>\n+      </script>\n+    </div>\n \n-      </head>\n+  </head>\n   <body>\n \n     <metal:main fill-slot="main">\n       <tal:main-macro metal:define-macro="main">\n \n-        <h1 class="documentFirstHeading" tal:content="view/label">Title</h1>\n+        <h1 class="documentFirstHeading"\n+            tal:content="view/label"\n+        >Title</h1>\n \n \n         <metal:block use-macro="context/@@ploneform-macros/titlelessform" />\n@@ -64,4 +70,3 @@\n     </metal:main>\n   </body>\n </html>\n-\ndiff --git a/plone/app/content/browser/folderfactories.pt b/plone/app/content/browser/folderfactories.pt\nindex 7767a65..c2305f5 100644\n--- a/plone/app/content/browser/folderfactories.pt\n+++ b/plone/app/content/browser/folderfactories.pt\n@@ -1,74 +1,104 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<head>\n+  <head>\n     <metal:block fill-slot="top_slot"\n-                 tal:define="dummy python:request.set(\'disable_border\',1);\n-                             disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n-                             disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);" />\n-</head>\n+                 tal:define="\n+                   dummy python:request.set(\'disable_border\',1);\n+                   disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                   disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);\n+                 "\n+    />\n+  </head>\n \n-<body>\n+  <body>\n \n-<metal:main metal:fill-slot="main">\n+    <metal:main metal:fill-slot="main">\n \n-    <h1 class="documentFirstHeading" i18n:translate="heading_add_new_item">Add new item</h1>\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="heading_add_new_item"\n+      >Add new item</h1>\n \n-    <div class="documentDescription"\n-       i18n:translate="description_add_new_item">\n+      <div class="documentDescription"\n+           i18n:translate="description_add_new_item"\n+      >\n         Select the type of item you want to add to your folder.\n-    </div>\n+      </div>\n \n-    <div id="content-core">\n+      <div id="content-core">\n         <p tal:condition="view/can_constrain_types">\n-            <a href="#" title="Configure which content types can be added here"\n-                        i18n:attributes="title title_configure_addable_content_types;"\n-                        tal:define="add_context view/add_context"\n-                        tal:attributes="href string:${add_context/absolute_url}/folder_constraintypes_form;"\n-                        i18n:translate="folder_add_settings_long">\n+          <a href="#"\n+             title="Configure which content types can be added here"\n+             tal:define="\n+               add_context view/add_context;\n+             "\n+             tal:attributes="\n+               href string:${add_context/absolute_url}/folder_constraintypes_form;\n+             "\n+             i18n:attributes="title title_configure_addable_content_types;"\n+             i18n:translate="folder_add_settings_long"\n+          >\n                 Click to configure what type of items can be added here&hellip;\n-            </a>\n+          </a>\n         </p>\n \n         <metal:addlist define-macro="addlist">\n \n-            <form name="quickAdd" method="post"\n-                tal:attributes="action string:${context/absolute_url}/@@folder_factories">\n+          <form method="post"\n+                name="quickAdd"\n+                tal:attributes="\n+                  action string:${context/absolute_url}/@@folder_factories;\n+                "\n+          >\n \n-                <ul class="folder-factories">\n-                    <tal:typelist repeat="item view/addable_types">\n-                        <li>\n-                            <input type="radio" name="url"\n-                                   tal:attributes="value item/action;\n-                                                   id string:form-field-${item/extra/id}" />\n-                            <label tal:attributes="class string:contenttype-${item/extra/id};\n-                                                   for string:form-field-${item/extra/id};">\n-                                <img tal:attributes="src item/icon" alt="" />\n-                                <span tal:replace="item/title">Type title</span>\n-                            </label>\n-                            <span class="discreet" tal:content="item/description">Type description</span>\n-                        </li>\n-                    </tal:typelist>\n-                </ul>\n+            <ul class="folder-factories">\n+              <tal:typelist repeat="item view/addable_types">\n+                <li>\n+                  <input name="url"\n+                         type="radio"\n+                         tal:attributes="\n+                           value item/action;\n+                           id string:form-field-${item/extra/id};\n+                         "\n+                  />\n+                  <label tal:attributes="\n+                           class string:contenttype-${item/extra/id};\n+                           for string:form-field-${item/extra/id};\n+                         ">\n+                    <img alt=""\n+                         tal:attributes="\n+                           src item/icon;\n+                         "\n+                    />\n+                    <span tal:replace="item/title">Type title</span>\n+                  </label>\n+                  <span class="discreet"\n+                        tal:content="item/description"\n+                  >Type description</span>\n+                </li>\n+              </tal:typelist>\n+            </ul>\n \n-                <div class="formControls">\n-                    <input class="btn btn-primary"\n-                          type="submit"\n-                          value="Add"\n-                          name="form.button.Add"\n-                          i18n:attributes="value label_add"\n-                          />\n-                </div>\n-            </form>\n+            <div class="formControls">\n+              <input class="btn btn-primary"\n+                     name="form.button.Add"\n+                     type="submit"\n+                     value="Add"\n+                     i18n:attributes="value label_add"\n+              />\n+            </div>\n+          </form>\n         </metal:addlist>\n-    </div>\n+      </div>\n \n-</metal:main>\n+    </metal:main>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/content/browser/full_review_list.pt b/plone/app/content/browser/full_review_list.pt\nindex 25549e7..8fd2c8e 100644\n--- a/plone/app/content/browser/full_review_list.pt\n+++ b/plone/app/content/browser/full_review_list.pt\n@@ -1,31 +1,40 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="here/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<metal:block fill-slot="top_slot"\n-             tal:define="dummy python:request.set(\'disable_border\',1)" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+               "\n+  />\n \n-<body>\n-  <metal:main fill-slot="main">\n-    <h1 class="documentFirstHeading"\n-        i18n:translate="heading_full_review_list">Full review list:</h1>\n+  <body>\n+    <metal:main fill-slot="main">\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="heading_full_review_list"\n+      >Full review list:</h1>\n \n-    <div id="content-core">\n-        <form name="worklistForm"\n-                method="post"\n-                action="folder_object"\n-                tal:attributes="action context/absolute_url"\n-                tal:condition="view/revlist"\n-                class="kssattr-serveraction-reviewlist_update_table">\n-              <div tal:replace="structure view/review_table"></div>\n-              <input tal:replace="structure context/@@authenticator/authenticator" />\n+      <div id="content-core">\n+        <form class="kssattr-serveraction-reviewlist_update_table"\n+              action="folder_object"\n+              method="post"\n+              name="worklistForm"\n+              tal:condition="view/revlist"\n+              tal:attributes="\n+                action context/absolute_url;\n+              "\n+        >\n+          <div tal:replace="structure view/review_table"></div>\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n         </form>\n-    </div>\n+      </div>\n \n-  </metal:main>\n-</body>\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/plone/app/content/browser/table.pt b/plone/app/content/browser/table.pt\nindex 5a79f19..939d107 100644\n--- a/plone/app/content/browser/table.pt\n+++ b/plone/app/content/browser/table.pt\n@@ -1,175 +1,303 @@\n <div id="folderlisting-main-table"\n-     i18n:domain="plone">\n-  <input type="hidden" name="sort_on"\n-         tal:attributes="value request/sort_on|string:getObjPositionInParent"\n-         />\n-  <input type="hidden" name="pagenumber" tal:attributes="value view/batch/pagenumber"/>\n-  <input type="hidden" name="pagesize" tal:attributes="value view/batch/pagesize"/>\n-  <input type="hidden" name="show_all" tal:attributes="value view/show_all"/>\n-  <input type="hidden" name="orig_template" tal:attributes="value view/viewname"/>\n+     i18n:domain="plone"\n+>\n+  <input name="sort_on"\n+         type="hidden"\n+         tal:attributes="\n+           value request/sort_on|string:getObjPositionInParent;\n+         "\n+  />\n+  <input name="pagenumber"\n+         type="hidden"\n+         tal:attributes="\n+           value view/batch/pagenumber;\n+         "\n+  />\n+  <input name="pagesize"\n+         type="hidden"\n+         tal:attributes="\n+           value view/batch/pagesize;\n+         "\n+  />\n+  <input name="show_all"\n+         type="hidden"\n+         tal:attributes="\n+           value view/show_all;\n+         "\n+  />\n+  <input name="orig_template"\n+         type="hidden"\n+         tal:attributes="\n+           value view/viewname;\n+         "\n+  />\n   <tal:block condition="view/selectall">\n-    <input type="hidden" name="paths:list"\n+    <input name="paths:list"\n+           type="hidden"\n            tal:repeat="item view/batch/items_not_on_page"\n-           tal:attributes="value item/path|item/id|item/getId"/>\n+           tal:attributes="\n+             value item/path|item/id|item/getId;\n+           "\n+    />\n   </tal:block>\n \n   <p class="discreet"\n      tal:condition="not: view/batch"\n-     i18n:translate="description_no_visible_items_add_paste">\n+     i18n:translate="description_no_visible_items_add_paste"\n+  >\n     This folder has no visible items. To add content, press the\n     add button, or paste content from another location.\n   </p>\n \n   <metal:listing define-macro="folder_listing"\n-                 tal:define="nosortclass view/get_nosort_class">\n+                 tal:define="\n+                   nosortclass view/get_nosort_class;\n+                 "\n+  >\n \n-    <div class="visualClear" id="clear-space-before-navigation"><!-- --></div>\n+    <div class="visualClear"\n+         id="clear-space-before-navigation"\n+    ><!-- --></div>\n \n-    <div tal:replace="structure view/batching" tal:condition="not:view/show_all"/>\n+    <div tal:condition="not:view/show_all"\n+         tal:replace="structure view/batching"\n+    ></div>\n     <table class="table"\n            id="listing-table"\n            summary="Content listing"\n+           tal:condition="view/items"\n            i18n:attributes="summary summary_content_listing;"\n-           tal:condition="view/items">\n+    >\n       <thead>\n         <tr tal:condition="python:view.show_select_column and not view.selectcurrentbatch">\n-          <th colspan="6" class="nosort"><span i18n:translate="label_select" tal:omit-tag="">Select:</span> <a i18n:translate="label_all" tal:attributes="href view/selectscreen_url" id="foldercontents-selectall">All</a></th>\n+          <th class="nosort"\n+              colspan="6"\n+          ><span tal:omit-tag=""\n+                  i18n:translate="label_select"\n+            >Select:</span>\n+            <a id="foldercontents-selectall"\n+               tal:attributes="\n+                 href view/selectscreen_url;\n+               "\n+               i18n:translate="label_all"\n+            >All</a></th>\n         </tr>\n         <tr tal:condition="view/show_select_all_items">\n-          <th colspan="6" class="nosort">\n-            <span tal:omit-tag="" i18n:translate="tableheading_all_items_selected">\n-            All <tal:block replace="view/batch/items_on_page" i18n:name="count"/> items on this\n+          <th class="nosort"\n+              colspan="6"\n+          >\n+            <span tal:omit-tag=""\n+                  i18n:translate="tableheading_all_items_selected"\n+            >\n+            All\n+              <tal:block replace="view/batch/items_on_page"\n+                         i18n:name="count"\n+              />\n+               items on this\n             page are selected.\n             </span>\n-            <a tal:attributes="href view/selectall_url"\n-               id="foldercontents-selectall-completebatch"\n-               i18n:translate="tableheading_select_all_items">Select all\n-            <tal:block replace="view/batch/sequence_length" i18n:name="count"/> items in this folder.</a>\n+            <a id="foldercontents-selectall-completebatch"\n+               tal:attributes="\n+                 href view/selectall_url;\n+               "\n+               i18n:translate="tableheading_select_all_items"\n+            >Select all\n+              <tal:block replace="view/batch/sequence_length"\n+                         i18n:name="count"\n+              />\n+              items in this folder.</a>\n           </th>\n         </tr>\n         <tr tal:condition="view/selectall">\n-          <th colspan="6" class="nosort">\n-            <span tal:omit-tag="" i18n:translate="tableheading_all_items_selected_in_folder">\n-            All <tal:block replace="view/batch/sequence_length" i18n:name="count"/> items in this folder\n+          <th class="nosort"\n+              colspan="6"\n+          >\n+            <span tal:omit-tag=""\n+                  i18n:translate="tableheading_all_items_selected_in_folder"\n+            >\n+            All\n+              <tal:block replace="view/batch/sequence_length"\n+                         i18n:name="count"\n+              />\n+               items in this folder\n             are selected.\n             </span>\n-            <a tal:attributes="href view/selectnone_url"  i18n:translate="tableheading_clear_selection"\n-               id="foldercontents-clearselection">Clear selection</a>\n+            <a id="foldercontents-clearselection"\n+               tal:attributes="\n+                 href view/selectnone_url;\n+               "\n+               i18n:translate="tableheading_clear_selection"\n+            >Clear selection</a>\n           </th>\n         </tr>\n \n         <tr>\n           <th class="nosort column"\n               id="foldercontents-order-column"\n-              tal:condition="view/show_sort_column">\n+              tal:condition="view/show_sort_column"\n+          >\n           </th>\n           <th class="nosort"\n               id="foldercontents-select-column"\n-              tal:condition="view/show_select_column">&nbsp;</th>\n+              tal:condition="view/show_select_column"\n+          >&nbsp;</th>\n           <th class="nosort column"\n-              id="foldercontents-title-column">&nbsp;<tal:title i18n:translate="listingheader_title"\n-              >Title</tal:title>&nbsp;</th>\n+              id="foldercontents-title-column"\n+          >&nbsp;<tal:title i18n:translate="listingheader_title">Title</tal:title>&nbsp;</th>\n           <th class="nosort column"\n               id="foldercontents-size-column"\n-              tal:condition="view/show_size_column">&nbsp;<tal:size i18n:translate="listingheader_size"\n-              >Size</tal:size>&nbsp;</th>\n+              tal:condition="view/show_size_column"\n+          >&nbsp;<tal:size i18n:translate="listingheader_size">Size</tal:size>&nbsp;</th>\n           <th class="nosort column"\n               id="foldercontents-modified-column"\n-              tal:condition="view/show_modified_column">&nbsp;<tal:modified i18n:translate="listingheader_modified"\n-              >Modified</tal:modified>&nbsp;</th>\n+              tal:condition="view/show_modified_column"\n+          >&nbsp;<tal:modified i18n:translate="listingheader_modified">Modified</tal:modified>&nbsp;</th>\n           <th class="nosort column"\n               id="foldercontents-status-column"\n-              tal:condition="view/show_status_column">&nbsp;<tal:state i18n:translate="listingheader_status"\n-              >State</tal:state>&nbsp;</th>\n+              tal:condition="view/show_status_column"\n+          >&nbsp;<tal:state i18n:translate="listingheader_status">State</tal:state>&nbsp;</th>\n         </tr>\n       </thead>\n \n       <metal:block tal:condition="view/batch">\n         <tbody>\n           <tal:items tal:repeat="item view/batch">\n-            <tr  tal:define="id item/id|item/getId;\n-                             title item/title|item/Title|item/title_or_id;\n-                             title_or_id python:title or id;"\n-                 tal:attributes="class item/table_row_class;\n-                                id string:folder-contents-item-${id};">\n+            <tr tal:define="\n+                  id item/id|item/getId;\n+                  title item/title|item/Title|item/title_or_id;\n+                  title_or_id python:title or id;\n+                "\n+                tal:attributes="\n+                  class item/table_row_class;\n+                  id string:folder-contents-item-${id};\n+                "\n+            >\n \n-              <td tal:condition="view/show_sort_column" class="draggable">\n-               <tal:block tal:define="quoted_id python:view.quote_plus(id);\n-                                      quoted_id item/quoted_id|quoted_id;">\n-                <a href=""\n-                   title="Move item up"\n-                   i18n:attributes="title title_move_item_up;"\n-                   tal:attributes="href string:${view/base_url}/folder_position?position=up&amp;id=${quoted_id}">\n+              <td class="draggable"\n+                  tal:condition="view/show_sort_column"\n+              >\n+                <tal:block tal:define="\n+                             quoted_id python:view.quote_plus(id);\n+                             quoted_id item/quoted_id|quoted_id;\n+                           ">\n+                  <a href=""\n+                     title="Move item up"\n+                     tal:attributes="\n+                       href string:${view/base_url}/folder_position?position=up&amp;id=${quoted_id};\n+                     "\n+                     i18n:attributes="title title_move_item_up;"\n+                  >\n                   &#9650;\n-                </a>\n+                  </a>\n                 &nbsp;\n-                <a href=""\n-                   title="Move item down"\n-                   i18n:attributes="title title_move_item_down;"\n-                   tal:attributes="href string:${view/base_url}/folder_position?position=down&amp;id=${quoted_id}">\n+                  <a href=""\n+                     title="Move item down"\n+                     tal:attributes="\n+                       href string:${view/base_url}/folder_position?position=down&amp;id=${quoted_id};\n+                     "\n+                     i18n:attributes="title title_move_item_down;"\n+                  >\n                   &#9660;\n-                </a>\n-               </tal:block>\n+                  </a>\n+                </tal:block>\n               </td>\n-              <td tal:condition="view/show_select_column" class="notDraggable">\n-                <input type="checkbox"\n-                       class="noborder"\n-                       name="paths:list" id="#"\n+              <td class="notDraggable"\n+                  tal:condition="view/show_select_column"\n+              >\n+                <input class="noborder"\n+                       id="#"\n+                       name="paths:list"\n+                       type="checkbox"\n+                       value="#"\n+                       tal:attributes="\n+                         value   item/path|id;\n+                         id      string:cb_${id};\n+                         checked item/checked;\n+                         alt     python:view.msg_select_item(item);\n+                         title   python:view.msg_select_item(item);\n+                       "\n+                />\n+                <input name="selected_obj_paths:list"\n+                       type="hidden"\n                        value="#"\n-                       tal:attributes="value   item/path|id;\n-                                       id      string:cb_${id};\n-                                       checked item/checked;\n-                                       alt     python:view.msg_select_item(item);\n-                                       title   python:view.msg_select_item(item)" />\n-                <input type="hidden" name="selected_obj_paths:list" value="#"\n-                       tal:attributes="value item/path|id" />\n-                <label tal:content="title_or_id"\n-                       tal:attributes="for string:cb_${id}"\n-                       class="hiddenStructure">\n+                       tal:attributes="\n+                         value item/path|id;\n+                       "\n+                />\n+                <label class="hiddenStructure"\n+                       tal:content="title_or_id"\n+                       tal:attributes="\n+                         for string:cb_${id};\n+                       "\n+                >\n                   Item Title\n                 </label>\n               </td>\n               <td>\n-                  <img tal:replace="structure item/icon|nothing" />\n-                  <a href="#" tal:define="state_class item/state_class|string:;\n-                                          type_class item/type_class|string:;"\n-                              tal:attributes="href  item/view_url|string:${view/base_url}/${id};\n-                                              title item/url_href_title|nothing;\n-                                              class string: ${state_class} ${type_class};">\n-                    <strong tal:omit-tag="not: item/is_browser_default|nothing"\n-                            tal:content="title_or_id"/>\n-                    <span class="defaultView"\n-                          tal:condition="item/is_browser_default|nothing"\n-                          title="Default view for this folder"\n-                          i18n:attributes="title title_default_view_for_this_folder;"\n-                          style="color: #f00;">\n+                <img tal:replace="structure item/icon|nothing" />\n+                <a href="#"\n+                   tal:define="\n+                     state_class item/state_class|string:;\n+                     type_class item/type_class|string:;\n+                   "\n+                   tal:attributes="\n+                     href  item/view_url|string:${view/base_url}/${id};\n+                     title item/url_href_title|nothing;\n+                     class string: ${state_class} ${type_class};\n+                   "\n+                >\n+                  <strong tal:content="title_or_id"\n+                          tal:omit-tag="not: item/is_browser_default|nothing"\n+                  ></strong>\n+                  <span class="defaultView"\n+                        style="color: #f00;"\n+                        title="Default view for this folder"\n+                        tal:condition="item/is_browser_default|nothing"\n+                        i18n:attributes="title title_default_view_for_this_folder;"\n+                  >\n                       &#x25a0;\n-                    </span>\n-                  </a>\n+                  </span>\n+                </a>\n \n                 <span class="state-expired"\n                       tal:condition="item/is_expired|nothing"\n-                      i18n:translate="time_expired">expired</span>\n+                      i18n:translate="time_expired"\n+                >expired</span>\n               </td>\n \n               <td tal:condition="view/show_size_column">\n-                <span tal:condition="not: item/size"> &nbsp; </span>\n+                <span tal:condition="not: item/size">\n+                  &nbsp;\n+                </span>\n                 <span tal:condition="item/size"\n                       tal:content="item/size"\n-                      tal:attributes="class item/state_class|nothing"> size </span>\n+                      tal:attributes="\n+                        class item/state_class|nothing;\n+                      "\n+                >\n+                  size\n+                </span>\n               </td>\n-              <td tal:condition="view/show_modified_column"\n+              <td tal:define="\n+                    state_class item/state_class|string:;\n+                    modified_sortable item/modified_sortable|string:;\n+                  "\n+                  tal:condition="view/show_modified_column"\n                   tal:content="item/modified"\n-                  tal:define="state_class item/state_class|string:;\n-                              modified_sortable item/modified_sortable|string:;"\n-                  tal:attributes="class string:${state_class} ${modified_sortable}">\n+                  tal:attributes="\n+                    class string:${state_class} ${modified_sortable};\n+                  "\n+              >\n                 08/19/2001 03:01 AM\n               </td>\n               <td tal:condition="view/show_status_column">\n-                <span i18n:translate=""\n-                      tal:condition="item/state_title|nothing"\n+                <span tal:condition="item/state_title|nothing"\n                       tal:content="item/state_title"\n-                      tal:attributes="class item/state_class|nothing" />\n+                      tal:attributes="\n+                        class item/state_class|nothing;\n+                      "\n+                      i18n:translate=""\n+                ></span>\n                 <span tal:condition="not: item/state_title|nothing">&nbsp;</span>\n               </td>\n             </tr>\n@@ -177,30 +305,47 @@\n         </tbody>\n         <tfoot tal:condition="not:view/within_batch_size">\n           <tr tal:condition="not:view/show_all">\n-            <th colspan="6" class="nosort">\n-              <a tal:attributes="href view/show_all_url"\n+            <th class="nosort"\n+                colspan="6"\n+            >\n+              <a id="foldercontents-show-all"\n+                 tal:attributes="\n+                   href view/show_all_url;\n+                 "\n                  i18n:translate="label_show_all"\n-                 id="foldercontents-show-all">Show all items</a>\n+              >Show all items</a>\n             </th>\n           </tr>\n           <tr tal:condition="view/show_all">\n-            <th colspan="6" class="nosort">\n-              <a tal:attributes="href view/view_url"\n+            <th class="nosort"\n+                colspan="6"\n+            >\n+              <a id="foldercontents-show-batched"\n+                 tal:attributes="\n+                   href view/view_url;\n+                 "\n                  i18n:translate="label_show_batched"\n-                 id="foldercontents-show-batched">Show batched</a>\n+              >Show batched</a>\n             </th>\n           </tr>\n         </tfoot>\n       </metal:block>\n     </table>\n-    <div tal:replace="structure view/batching" tal:condition="not:view/show_all"/>\n+    <div tal:condition="not:view/show_all"\n+         tal:replace="structure view/batching"\n+    ></div>\n     <tal:buttons tal:repeat="button view/buttons">\n       <input class="btn btn-primary"\n-             type="submit"\n              name=""\n+             type="submit"\n              value=""\n+             tal:attributes="\n+               value button/title;\n+               name button/url;\n+               class button/cssclass|nothing;\n+             "\n              i18n:attributes="value"\n-             tal:attributes="value button/title; name button/url; class button/cssclass|nothing" />\n+      />\n     </tal:buttons>\n   </metal:listing>\n </div>\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-18T11:30:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/756ade3e4a6e1baed6e4dfaa4b7c45a1baac75e5

chore: zpretty PT

Files changed:
M plone/app/content/browser/templates/content_status_history.pt
M plone/app/content/browser/templates/delete_confirmation.pt
M plone/app/content/browser/templates/object_rename.pt
M plone/app/content/browser/templates/select_default_page.pt
M plone/app/content/browser/templates/select_default_view.pt

b'diff --git a/plone/app/content/browser/templates/content_status_history.pt b/plone/app/content/browser/templates/content_status_history.pt\nindex 05dbd29..ed967dd 100644\n--- a/plone/app/content/browser/templates/content_status_history.pt\n+++ b/plone/app/content/browser/templates/content_status_history.pt\n@@ -1,384 +1,529 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n   <metal:block fill-slot="top_slot">\n-    <metal:block tal:define="dummy python:request.RESPONSE.setHeader(\'Cache-Control\', \'no-cache, no-store, must-revalidate, post-check=0, pre-check=0\');\n-                             dummy python:request.set(\'enable_border\', 1);" />\n+    <metal:block tal:define="\n+                   dummy python:request.RESPONSE.setHeader(\'Cache-Control\', \'no-cache, no-store, must-revalidate, post-check=0, pre-check=0\');\n+                   dummy python:request.set(\'enable_border\', 1);\n+                 " />\n   </metal:block>\n \n   <metal:calendar fill-slot="javascript_head_slot">\n-    <style type="text/css" media="all"\n-            tal:content="string:@import url(${portal_url}/jscalendar/calendar-system.css);"></style>\n+    <style media="all"\n+           type="text/css"\n+           tal:content="string:@import url(${portal_url}/jscalendar/calendar-system.css);"\n+    ></style>\n     <script type="text/javascript"\n-            tal:attributes="src string:${portal_url}/jscalendar/calendar_stripped.js"></script>\n-    <script type="text/javascript" charset="iso-8859-1"\n+            tal:attributes="\n+              src string:${portal_url}/jscalendar/calendar_stripped.js;\n+            "\n+    ></script>\n+    <script charset="iso-8859-1"\n+            type="text/javascript"\n             tal:condition="exists: context/jscalendar/calendar-en.js"\n-            tal:attributes="src string:${portal_url}/jscalendar/calendar-en.js"></script>\n+            tal:attributes="\n+              src string:${portal_url}/jscalendar/calendar-en.js;\n+            "\n+    ></script>\n   </metal:calendar>\n \n   <body>\n \n     <tal:comment tal:condition="nothing">\n-      <div class="portalMessage info" role="status">\n+      <div class="portalMessage info"\n+           role="status"\n+      >\n         <strong i18n:translate="">Note</strong>\n         <span i18n:translate="">This form is used in two different ways - from folder_contents,\n         allowing you to publish several things at once, and from the state\n         drop-down. In the first case, the \'paths\' request parameter is set;\n         in the second case, giving the relative paths to the content object\n         to manipulate; in the second case, this parameter is omitted and the\n-        path of the context is used.</span>\n+          path of the context is used.</span>\n       </div>\n     </tal:comment>\n \n-      <metal:main fill-slot="main"\n-           tal:define="errors view/errors;\n-                       review_state context_state/workflow_state;\n-                       paths python:request.get(\'paths\', [\'/\'.join(context.getPhysicalPath())]);\n-                       batch python:view.get_objects_from_path_list(paths);\n-                       folders_in_publishing python:[o.getId for o in batch if o.isPrincipiaFolderish];\n-                       came_from python:request.get(\'HTTP_REFERER\', context.absolute_url()).split(\'?\')[0];\n-                       dummy python:request.set(\'orig_template\', came_from);\n-                     ">\n+    <metal:main fill-slot="main"\n+                tal:define="\n+                  errors view/errors;\n+                  review_state context_state/workflow_state;\n+                  paths python:request.get(\'paths\', [\'/\'.join(context.getPhysicalPath())]);\n+                  batch python:view.get_objects_from_path_list(paths);\n+                  folders_in_publishing python:[o.getId for o in batch if o.isPrincipiaFolderish];\n+                  came_from python:request.get(\'HTTP_REFERER\', context.absolute_url()).split(\'?\')[0];\n+                  dummy python:request.set(\'orig_template\', came_from);\n+                "\n+    >\n       <metal:block tal:condition="python: paths and not batch"\n-                   tal:replace="view/redirect_to_referrer"/>\n+                   tal:replace="view/redirect_to_referrer"\n+      />\n \n       <h1 class="documentFirstHeading"\n-          i18n:translate="heading_publishing_process">Publishing process</h1>\n+          i18n:translate="heading_publishing_process"\n+      >Publishing process</h1>\n \n-      <div class="documentDescription" i18n:translate="description_publishing_process_short">\n+      <div class="documentDescription"\n+           i18n:translate="description_publishing_process_short"\n+      >\n         An item\'s status (also called its review state) determines who\n         can see it. Another way to control the visibility of an item is\n-        with its <em class="discreet">Publishing Date</em>. An item is not publicly\n+        with its\n+        <em class="discreet">Publishing Date</em>. An item is not publicly\n         searchable before its publishing date. This will prevent the item\n         from showing up in portlets and folder listings, although the item\n         will still be available if accessed directly via its URL.\n       </div>\n \n       <div id="content-core">\n-          <form id="edit_form"\n-                class="enableAutoFocus"\n-                name="edit_form"\n-                method="post"\n-                action="content_status_modify"\n-                tal:attributes="action string:${context_state/object_url}/${view/__name__}"\n-                tal:condition="not:python:paths and not batch">\n-\n-              <div class="field" tal:condition="batch"\n-                   tal:define="error errors/paths | nothing;"\n-                   tal:attributes="class python:error and \'field error\' or \'field\'">\n-                <label i18n:translate="label_affected_content">Affected content</label>\n-                <div tal:content="error">Validation error output</div>\n-                <div tal:define="dummy python:request.set(\'ids_checked\', 1);\n-                                 use_view_action python:context.portal_registry.get(\'plone.types_use_view_action_in_listings\', ());">\n-                  <table id="sortable"\n-                         class="listing"\n-                         summary="Affected content"\n-                         i18n:attributes="summary summary_affected_content;">\n-                    <thead>\n-                      <metal:block tal:condition="batch|nothing">\n-                        <tr>\n-                          <th class="nosort">\n-                              <input class="noborder"\n-                                     type="checkbox"\n-                                     name="selectButton"\n-                                     title="Select all items"\n-                                     onClick="toggleSelect(this,\'paths:list\');"\n-                                     alt="Select all items"\n-                                     i18n:attributes="title label_select_all_items; alt label_select_all_items;"\n-                          />\n-                          </th>\n-                          <th class="nosort" i18n:translate="listingheader_title">\n+        <form class="enableAutoFocus"\n+              id="edit_form"\n+              action="content_status_modify"\n+              method="post"\n+              name="edit_form"\n+              tal:condition="not:python:paths and not batch"\n+              tal:attributes="\n+                action string:${context_state/object_url}/${view/__name__};\n+              "\n+        >\n+\n+          <div class="field"\n+               tal:define="\n+                 error errors/paths | nothing;\n+               "\n+               tal:condition="batch"\n+               tal:attributes="\n+                 class python:error and \'field error\' or \'field\';\n+               "\n+          >\n+            <label i18n:translate="label_affected_content">Affected content</label>\n+            <div tal:content="error">Validation error output</div>\n+            <div tal:define="\n+                   dummy python:request.set(\'ids_checked\', 1);\n+                   use_view_action python:context.portal_registry.get(\'plone.types_use_view_action_in_listings\', ());\n+                 ">\n+              <table class="listing"\n+                     id="sortable"\n+                     summary="Affected content"\n+                     i18n:attributes="summary summary_affected_content;"\n+              >\n+                <thead>\n+                  <metal:block tal:condition="batch|nothing">\n+                    <tr>\n+                      <th class="nosort">\n+                        <input class="noborder"\n+                               alt="Select all items"\n+                               name="selectButton"\n+                               onclick="toggleSelect(this,\'paths:list\');"\n+                               title="Select all items"\n+                               type="checkbox"\n+                               i18n:attributes="title label_select_all_items; alt label_select_all_items;"\n+                        />\n+                      </th>\n+                      <th class="nosort"\n+                          i18n:translate="listingheader_title"\n+                      >\n                             Title\n-                          </th>\n-                          <th class="nosort" i18n:translate="listingheader_size">\n+                      </th>\n+                      <th class="nosort"\n+                          i18n:translate="listingheader_size"\n+                      >\n                               Size\n-                          </th>\n-                          <th class="nosort" i18n:translate="listingheader_modified">\n+                      </th>\n+                      <th class="nosort"\n+                          i18n:translate="listingheader_modified"\n+                      >\n                               Modified\n-                          </th>\n-                          <th class="nosort" i18n:translate="listingheader_status">\n+                      </th>\n+                      <th class="nosort"\n+                          i18n:translate="listingheader_status"\n+                      >\n                               State\n-                          </th>\n-                        </tr>\n-                      </metal:block>\n-                    </thead>\n-\n-                    <metal:block tal:condition="batch|nothing">\n-                    <tbody tal:define="portal portal_state/portal;\n-                                       url_tool context/@@plone_tools/url;\n-                                       getRelativeContentURL nocall:url_tool/getRelativeContentURL;\n-                                       normalizeString nocall:plone_view/normalizeString;\n-                                       wtool portal/portal_workflow;\n-                                       ">\n-                        <tal:items tal:repeat="item batch">\n-                           <tr tal:define="oddrow               repeat/item/odd;\n-                                           item_url             item/getURL|item/absolute_url;\n-                                           item_id              item/getId;\n-                                           item_path            item/getPath|python:\'/\'.join(item.getPhysicalPath());\n-                                           item_title_or_id     item/pretty_title_or_id;\n-                                           item_description     item/Description;\n-                                           item_type            item/portal_type;\n-                                           item_size            python:plone_view.human_readable_size(item.get_size());\n-                                           item_modified        item/ModificationDate;\n-                                           item_type_class      python:\'contenttype-\' + normalizeString(item_type);\n-                                           item_wf_state        item/review_state|python: wtool.getInfoFor(item, \'review_state\', \'\');\n-                                           item_state_title     python:wtool.getTitleForStateOnType(item_wf_state, item_type);\n-                                           item_wf_state_class  python:\'state-\' + normalizeString(item_wf_state);\n-                                           item_use_view        python:item_type in use_view_action;\n-                                           hasGetUrl            python:hasattr(item.aq_explicit, \'getURL\');\n-                                           item_rel_url         python:hasGetUrl and item.getURL(relative=1) or getRelativeContentURL(item);\n-                                           browserDefaultResult context/browserDefault;\n-                                           isBrowserDefault     python:len(browserDefaultResult[1]) == 1 and item.id == context.browserDefault()[1][0];\n-                                           item_folderish       item/is_folderish|nothing;\n-                                           item_has_image       python:item.getIcon"\n-                               tal:attributes="class python:oddrow and \'draggable even\' or \'draggable odd\';\n-                                               id string:folder-contents-item-${item_id};" >\n-\n-                               <td class="notDraggable">\n-                                   <input type="checkbox"\n-                                          class="noborder"\n-                                          name="paths:list" id="#"\n-                                          value="#"\n-                                          tal:attributes="value   item_path;\n-                                                          id      string:cb_$item_id;\n-                                                          checked python:request.get(\'ids_checked\', False) and \'checked\' or None;\n-                                                          alt     string:Select $item_title_or_id;\n-                                                          title   string:Select $item_title_or_id" />\n-                              <input type="hidden" name="obj_paths:list" value="#"\n-                                     tal:attributes="value item_rel_url" />\n-                              <input type="hidden" name="orig_paths:list" value="#"\n-                                     tal:attributes="value item_path" />\n-\n-                            </td>\n-                            <td tal:define="url python:item_use_view and item_url+\'/view\' or\n-                                            (item_folderish and item_url+\'/folder_contents\'or item_url+\'/\');">\n-                                <img class="thumb-tile"\n-                                     tal:define="getIcon string:$item_url/@@images/image/tile\'"\n-                                     tal:condition="item_has_image"\n-                                     tal:attributes="src  string:$getIcon">\n-                                    <a href="#" tal:attributes="href  url;\n-                                                              title string:$item_type: $item_description;\n-                                                              class string:$item_wf_state_class $item_type_class;">\n-                                        <strong tal:omit-tag="python:not isBrowserDefault">\n-                                        <label tal:content="item_title_or_id"\n-                                               tal:attributes="for string:cb_$item_id">\n+                      </th>\n+                    </tr>\n+                  </metal:block>\n+                </thead>\n+\n+                <metal:block tal:condition="batch|nothing">\n+                  <tbody tal:define="\n+                           portal portal_state/portal;\n+                           url_tool context/@@plone_tools/url;\n+                           getRelativeContentURL nocall:url_tool/getRelativeContentURL;\n+                           normalizeString nocall:plone_view/normalizeString;\n+                           wtool portal/portal_workflow;\n+                         ">\n+                    <tal:items tal:repeat="item batch">\n+                      <tr tal:define="\n+                            oddrow               repeat/item/odd;\n+                            item_url             item/getURL|item/absolute_url;\n+                            item_id              item/getId;\n+                            item_path            item/getPath|python:\'/\'.join(item.getPhysicalPath());\n+                            item_title_or_id     item/pretty_title_or_id;\n+                            item_description     item/Description;\n+                            item_type            item/portal_type;\n+                            item_size            python:plone_view.human_readable_size(item.get_size());\n+                            item_modified        item/ModificationDate;\n+                            item_type_class      python:\'contenttype-\' + normalizeString(item_type);\n+                            item_wf_state        item/review_state|python: wtool.getInfoFor(item, \'review_state\', \'\');\n+                            item_state_title     python:wtool.getTitleForStateOnType(item_wf_state, item_type);\n+                            item_wf_state_class  python:\'state-\' + normalizeString(item_wf_state);\n+                            item_use_view        python:item_type in use_view_action;\n+                            hasGetUrl            python:hasattr(item.aq_explicit, \'getURL\');\n+                            item_rel_url         python:hasGetUrl and item.getURL(relative=1) or getRelativeContentURL(item);\n+                            browserDefaultResult context/browserDefault;\n+                            isBrowserDefault     python:len(browserDefaultResult[1]) == 1 and item.id == context.browserDefault()[1][0];\n+                            item_folderish       item/is_folderish|nothing;\n+                            item_has_image       python:item.getIcon;\n+                          "\n+                          tal:attributes="\n+                            class python:oddrow and \'draggable even\' or \'draggable odd\';\n+                            id string:folder-contents-item-${item_id};\n+                          "\n+                      >\n+\n+                        <td class="notDraggable">\n+                          <input class="noborder"\n+                                 id="#"\n+                                 name="paths:list"\n+                                 type="checkbox"\n+                                 value="#"\n+                                 tal:attributes="\n+                                   value   item_path;\n+                                   id      string:cb_$item_id;\n+                                   checked python:request.get(\'ids_checked\', False) and \'checked\' or None;\n+                                   alt     string:Select $item_title_or_id;\n+                                   title   string:Select $item_title_or_id;\n+                                 "\n+                          />\n+                          <input name="obj_paths:list"\n+                                 type="hidden"\n+                                 value="#"\n+                                 tal:attributes="\n+                                   value item_rel_url;\n+                                 "\n+                          />\n+                          <input name="orig_paths:list"\n+                                 type="hidden"\n+                                 value="#"\n+                                 tal:attributes="\n+                                   value item_path;\n+                                 "\n+                          />\n+\n+                        </td>\n+                        <td tal:define="\n+                              url python:item_use_view and item_url+\'/view\' or\n+                                            (item_folderish and item_url+\'/folder_contents\'or item_url+\'/\');\n+                            ">\n+                          <img class="thumb-tile"\n+                               tal:define="\n+                                 getIcon string:$item_url/@@images/image/tile\';\n+                               "\n+                               tal:condition="item_has_image"\n+                               tal:attributes="\n+                                 src  string:$getIcon;\n+                               "\n+                          />\n+                          <a href="#"\n+                             tal:attributes="\n+                               href  url;\n+                               title string:$item_type: $item_description;\n+                               class string:$item_wf_state_class $item_type_class;\n+                             "\n+                          >\n+                            <strong tal:omit-tag="python:not isBrowserDefault">\n+                              <label tal:content="item_title_or_id"\n+                                     tal:attributes="\n+                                       for string:cb_$item_id;\n+                                     "\n+                              >\n                                           Item Title\n-                                        </label>\n-                                        </strong>\n-                                    </a>\n-\n-                                <span class="state-expired"\n-                                      tal:condition="python:view.isExpired(item)"\n-                                      i18n:translate="time_expired">expired</span>\n-                            </td>\n-\n-                            <td>\n-                              <span tal:condition="not: item_size"> &nbsp; </span>\n-                              <span tal:condition="python:item_size"\n-                                    tal:content="item_size"\n-                                    tal:attributes="class item_wf_state_class"> size </span>\n-                            </td>\n-                            <td tal:define="toLocalizedTime nocall:plone_view/toLocalizedTime;"\n-                                tal:content="python:toLocalizedTime(item_modified, long_format=1)"\n-                                tal:attributes="class item_wf_state_class">\n+                              </label>\n+                            </strong>\n+                          </a>\n+\n+                          <span class="state-expired"\n+                                tal:condition="python:view.isExpired(item)"\n+                                i18n:translate="time_expired"\n+                          >expired</span>\n+                        </td>\n+\n+                        <td>\n+                          <span tal:condition="not: item_size">\n+                            &nbsp;\n+                          </span>\n+                          <span tal:condition="python:item_size"\n+                                tal:content="item_size"\n+                                tal:attributes="\n+                                  class item_wf_state_class;\n+                                "\n+                          >\n+                            size\n+                          </span>\n+                        </td>\n+                        <td tal:define="\n+                              toLocalizedTime nocall:plone_view/toLocalizedTime;\n+                            "\n+                            tal:content="python:toLocalizedTime(item_modified, long_format=1)"\n+                            tal:attributes="\n+                              class item_wf_state_class;\n+                            "\n+                        >\n                                 08/19/2001 03:01 AM\n-                            </td>\n-                            <td>\n-                                <span i18n:translate=""\n-                                      tal:condition="item_state_title"\n-                                      tal:content="item_state_title"\n-                                      tal:attributes="class item_wf_state_class" />\n-                                <span tal:condition="not: item_state_title">&nbsp;</span>\n-                            </td>\n-                           </tr>\n-                        </tal:items>\n-                    </tbody>\n-                    </metal:block>\n-\n-                  </table>\n-                </div>\n-              </div>\n-\n-              <div class="field formSingleCheckbox"\n-                   tal:condition="folders_in_publishing|nothing">\n-\n-                <input type="checkbox"\n-                       class="formElement"\n-                       id="include_children"\n-                       name="include_children"\n-                       />\n-                <label for="include_children" i18n:translate="label_include_contained_objects">\n+                        </td>\n+                        <td>\n+                          <span tal:condition="item_state_title"\n+                                tal:content="item_state_title"\n+                                tal:attributes="\n+                                  class item_wf_state_class;\n+                                "\n+                                i18n:translate=""\n+                          ></span>\n+                          <span tal:condition="not: item_state_title">&nbsp;</span>\n+                        </td>\n+                      </tr>\n+                    </tal:items>\n+                  </tbody>\n+                </metal:block>\n+\n+              </table>\n+            </div>\n+          </div>\n+\n+          <div class="field formSingleCheckbox"\n+               tal:condition="folders_in_publishing|nothing"\n+          >\n+\n+            <input class="formElement"\n+                   id="include_children"\n+                   name="include_children"\n+                   type="checkbox"\n+            />\n+            <label for="include_children"\n+                   i18n:translate="label_include_contained_objects"\n+            >\n                   Include contained items\n-                </label>\n+            </label>\n \n-                <div class="formHelp"\n-                     i18n:translate="help_include_contained_objects">\n+            <div class="formHelp"\n+                 i18n:translate="help_include_contained_objects"\n+            >\n                   If checked, this will attempt to modify the status of all content\n                   in any selected folders and their subfolders.\n-                </div>\n-\n-              </div>\n-\n-              <div class="field" tal:define="error errors/effective_date | nothing;">\n-                <label i18n:translate="label_effective_date">Publishing Date</label>\n-                <div class="formHelp"\n-                     i18n:translate="help_effective_date_content_status_history">\n+            </div>\n+\n+          </div>\n+\n+          <div class="field"\n+               tal:define="\n+                 error errors/effective_date | nothing;\n+               "\n+          >\n+            <label i18n:translate="label_effective_date">Publishing Date</label>\n+            <div class="formHelp"\n+                 i18n:translate="help_effective_date_content_status_history"\n+            >\n                   The date when the item will be published. If no date is selected the\n                   item will be published immediately.\n-                </div>\n-\n-                <div tal:content="error">Validation error output</div>\n-\n-                <div tal:define="inputname  string:effective_date;\n-                                 formname   string:edit_form;\n-                                 effective python:request.get(\'paths\') and None or context.EffectiveDate() ;\n-                                 inputvalue python:(effective and effective!=\'None\') and effective or request.get(\'effective_date\', \'\');"\n-                     tal:attributes="class python:error and \'field error\' or \'field\'">\n-\n-                    <div tal:replace="structure python: view.dates_form.widgets[\'effective_date\'].render()">\n+            </div>\n+\n+            <div tal:content="error">Validation error output</div>\n+\n+            <div tal:define="\n+                   inputname  string:effective_date;\n+                   formname   string:edit_form;\n+                   effective python:request.get(\'paths\') and None or context.EffectiveDate();\n+                   inputvalue python:(effective and effective!=\'None\') and effective or request.get(\'effective_date\', \'\');\n+                 "\n+                 tal:attributes="\n+                   class python:error and \'field error\' or \'field\';\n+                 "\n+            >\n+\n+              <div tal:replace="structure python: view.dates_form.widgets[\'effective_date\'].render()">\n                       calendar pop-up\n-                    </div>\n-\n-                </div>\n               </div>\n \n-              <div class="field"\n-                   tal:define="error errors/expiration_date | nothing;">\n-                <label i18n:translate="label_expiration_date">Expiration Date</label>\n-                <div class="formHelp"\n-                     i18n:translate="help_expiration_date_content_status_history">\n+            </div>\n+          </div>\n+\n+          <div class="field"\n+               tal:define="\n+                 error errors/expiration_date | nothing;\n+               "\n+          >\n+            <label i18n:translate="label_expiration_date">Expiration Date</label>\n+            <div class="formHelp"\n+                 i18n:translate="help_expiration_date_content_status_history"\n+            >\n                   The date when the item expires. This will automatically\n                   make the item invisible for others at the given date.\n                   If no date is chosen, it will never expire.\n-                </div>\n-\n-                <div tal:content="error">Validation error output</div>\n-\n-                <div class="field">\n-                  <div tal:define="inputname  string:expiration_date;\n-                                   formname   string:edit_form;\n-                                   expiration context/ExpirationDate;\n-                                   inputvalue python:(expiration and expiration!=\'None\') and expiration or request.get(\'expiration_date\', \'\');"\n-                       tal:attributes="class python:error and \'field error\' or \'field\'">\n-\n-                    <div tal:replace="structure python: view.dates_form.widgets[\'expiration_date\'].render()">\n+            </div>\n+\n+            <div tal:content="error">Validation error output</div>\n+\n+            <div class="field">\n+              <div tal:define="\n+                     inputname  string:expiration_date;\n+                     formname   string:edit_form;\n+                     expiration context/ExpirationDate;\n+                     inputvalue python:(expiration and expiration!=\'None\') and expiration or request.get(\'expiration_date\', \'\');\n+                   "\n+                   tal:attributes="\n+                     class python:error and \'field error\' or \'field\';\n+                   "\n+              >\n+\n+                <div tal:replace="structure python: view.dates_form.widgets[\'expiration_date\'].render()">\n                       calendar pop-up\n-                    </div>\n-                  </div>\n                 </div>\n               </div>\n+            </div>\n+          </div>\n \n-              <div class="field">\n-                <label for="comment"\n-                       i18n:translate="label_comments">Comments</label>\n+          <div class="field">\n+            <label for="comment"\n+                   i18n:translate="label_comments"\n+            >Comments</label>\n \n-                <div class="formHelp"\n-                     i18n:translate="help_publishing_comments">\n+            <div class="formHelp"\n+                 i18n:translate="help_publishing_comments"\n+            >\n                   Will be added to the publishing history. If multiple\n                   items are selected, this comment will be attached to all\n                   of them.\n-                </div>\n-                <textarea id="comment"\n-                          name="comment"\n-                          cols="60"\n-                          rows="5"\n-                          tal:content="request/comment|nothing"\n-                          ></textarea>\n-              </div>\n-\n-              <div class="field">\n-                <label i18n:translate="label_change_status">Change State</label>\n-                <div class="formHelp"\n-                     i18n:translate="help_change_status_action">\n+            </div>\n+            <textarea id="comment"\n+                      cols="60"\n+                      name="comment"\n+                      rows="5"\n+                      tal:content="request/comment|nothing"\n+            ></textarea>\n+          </div>\n+\n+          <div class="field">\n+            <label i18n:translate="label_change_status">Change State</label>\n+            <div class="formHelp"\n+                 i18n:translate="help_change_status_action"\n+            >\n                   Select the transition to be used for modifying the items state.\n-                </div>\n-\n-                <div tal:define="error_workflow_action errors/workflow_action|nothing;\n-                                 objs request/paths|nothing;\n-                                 target python:objs and objs or context;"\n-                     tal:attributes="class python:error_workflow_action and \'field error\' or \'field\'">\n-\n-                  <div tal:condition="error_workflow_action">\n-                    <tal:block content="error_workflow_action">Error</tal:block>\n-                    <br />\n-                  </div>\n+            </div>\n+\n+            <div tal:define="\n+                   error_workflow_action errors/workflow_action|nothing;\n+                   objs request/paths|nothing;\n+                   target python:objs and objs or context;\n+                 "\n+                 tal:attributes="\n+                   class python:error_workflow_action and \'field error\' or \'field\';\n+                 "\n+            >\n+\n+              <div tal:condition="error_workflow_action">\n+                <tal:block content="error_workflow_action">Error</tal:block>\n+                <br />\n+              </div>\n \n-                  <span tal:replace="nothing">\n+              <span tal:replace="nothing">\n                     For usability we will want to signify what state we are\n                     currently in. DCWorkflow only returns what transitions are\n                     available. But we want to visually represent what *state* we\n                     are currently in along with possible transitions.\n-                  </span>\n-\n-                  <input class="noborder"\n-                         id="workflow_action"\n-                         type="radio"\n-                         name="workflow_action"\n-                         title=""\n-                         value=""\n-                         tal:attributes="value review_state;\n-                                         title review_state;\n-                                         checked python:request.get(\'workflow_action\', review_state)==review_state and 1 or 0;" />\n-                  <label for="workflow_action"\n-                         i18n:translate="label_no_change">No change</label>\n-                  <br />\n-\n-                  <tal:block define="transitions python:context.portal_workflow.getTransitionsFor(target, context)"\n-                             repeat="transition transitions">\n-                      <input class="noborder"\n-                             id=""\n-                             type="radio"\n-                             name="workflow_action"\n-                             title=""\n-                             value=""\n-                             i18n:attributes="title"\n-                             tal:attributes="value transition/id;\n-                                             id    transition/id;\n-                                             title transition/name;\n-                                             checked python:transition.get(\'id\') == request.get(\'workflow_action\', \'\') and \'checked\' or None" />\n-                      <label for=""\n-                             i18n:translate=""\n-                             tal:attributes="for transition/id;"\n-                             tal:content="transition/name"\n-                             >Transition Name</label>\n-                             <br />\n-                  </tal:block>\n-\n-                </div>\n-\n-              </div>\n-\n-              <div class="formControls">\n-                <input class="btn btn-primary"\n-                       type="submit"\n-                       name="form.button.Publish"\n-                       value="Save"\n-                       i18n:attributes="value label_save;"\n-                       tal:condition="not:request/paths|folders_in_publishing|nothing"/>\n-                <input class="btn btn-primary"\n-                       type="submit"\n-                       name="form.button.FolderPublish"\n-                       value="Save"\n-                       i18n:attributes="value label_save;"\n-                       tal:condition="request/paths|folders_in_publishing|nothing"/>\n-                <input class="btn btn-secondary"\n-                       type="submit"\n-                       name="form.button.Cancel"\n-                       value="Cancel"\n-                       i18n:attributes="value label_cancel;" />\n-              </div>\n-\n-              <input type="hidden" name="form.submitted" value="1" />\n-              <input type="hidden" name="orig_template"\n-                     tal:condition="request/orig_template|nothing"\n-                     tal:attributes="value request/orig_template"/>\n-              <input tal:replace="structure context/@@authenticator/authenticator" />\n-          </form>\n+              </span>\n+\n+              <input class="noborder"\n+                     id="workflow_action"\n+                     name="workflow_action"\n+                     title=""\n+                     type="radio"\n+                     value=""\n+                     tal:attributes="\n+                       value review_state;\n+                       title review_state;\n+                       checked python:request.get(\'workflow_action\', review_state)==review_state and 1 or 0;\n+                     "\n+              />\n+              <label for="workflow_action"\n+                     i18n:translate="label_no_change"\n+              >No change</label>\n+              <br />\n+\n+              <tal:block define="\n+                           transitions python:context.portal_workflow.getTransitionsFor(target, context);\n+                         "\n+                         repeat="transition transitions"\n+              >\n+                <input class="noborder"\n+                       id=""\n+                       name="workflow_action"\n+                       title=""\n+                       type="radio"\n+                       value=""\n+                       tal:attributes="\n+                         value transition/id;\n+                         id    transition/id;\n+                         title transition/name;\n+                         checked python:transition.get(\'id\') == request.get(\'workflow_action\', \'\') and \'checked\' or None;\n+                       "\n+                       i18n:attributes="title"\n+                />\n+                <label for=""\n+                       tal:content="transition/name"\n+                       tal:attributes="\n+                         for transition/id;\n+                       "\n+                       i18n:translate=""\n+                >Transition Name</label>\n+                <br />\n+              </tal:block>\n+\n+            </div>\n+\n+          </div>\n+\n+          <div class="formControls">\n+            <input class="btn btn-primary"\n+                   name="form.button.Publish"\n+                   type="submit"\n+                   value="Save"\n+                   tal:condition="not:request/paths|folders_in_publishing|nothing"\n+                   i18n:attributes="value label_save;"\n+            />\n+            <input class="btn btn-primary"\n+                   name="form.button.FolderPublish"\n+                   type="submit"\n+                   value="Save"\n+                   tal:condition="request/paths|folders_in_publishing|nothing"\n+                   i18n:attributes="value label_save;"\n+            />\n+            <input class="btn btn-secondary"\n+                   name="form.button.Cancel"\n+                   type="submit"\n+                   value="Cancel"\n+                   i18n:attributes="value label_cancel;"\n+            />\n+          </div>\n+\n+          <input name="form.submitted"\n+                 type="hidden"\n+                 value="1"\n+          />\n+          <input name="orig_template"\n+                 type="hidden"\n+                 tal:condition="request/orig_template|nothing"\n+                 tal:attributes="\n+                   value request/orig_template;\n+                 "\n+          />\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n+        </form>\n       </div>\n     </metal:main>\n \ndiff --git a/plone/app/content/browser/templates/delete_confirmation.pt b/plone/app/content/browser/templates/delete_confirmation.pt\nindex f9348d6..29241d5 100644\n--- a/plone/app/content/browser/templates/delete_confirmation.pt\n+++ b/plone/app/content/browser/templates/delete_confirmation.pt\n@@ -1,55 +1,73 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-    <metal:block fill-slot="top_slot"\n-                 tal:define="dummy python:request.set(\'disable_border\',1)" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+               "\n+  />\n \n-    <body>\n+  <body>\n \n-        <metal:main fill-slot="main"\n-            tal:define="useSelf python:context_state.is_structural_folder() and not context_state.is_default_page();\n-                        folder_warning python:useSelf and context.portal_type != \'Topic\';\n-                        number_of_objects_to_delete python:folder_warning and view.items_to_delete">\n+    <metal:main fill-slot="main"\n+                tal:define="\n+                  useSelf python:context_state.is_structural_folder() and not context_state.is_default_page();\n+                  folder_warning python:useSelf and context.portal_type != \'Topic\';\n+                  number_of_objects_to_delete python:folder_warning and view.items_to_delete;\n+                "\n+    >\n \n-        <h1 class="documentFirstHeading"\n-            i18n:translate="alert_deleting_locked_item"\n-            tal:condition="view/is_locked">\n+      <h1 class="documentFirstHeading"\n+          tal:condition="view/is_locked"\n+          i18n:translate="alert_deleting_locked_item"\n+      >\n             This item can not be deleted because it is currently locked by another user.\n-        </h1>\n+      </h1>\n \n-        <tal:block condition="not:view/is_locked">\n-            <h1 class="documentFirstHeading"\n-                tal:condition="folder_warning">\n-                <span i18n:translate="alert_really_delete_folder">\n+      <tal:block condition="not:view/is_locked">\n+        <h1 class="documentFirstHeading"\n+            tal:condition="folder_warning"\n+        >\n+          <span i18n:translate="alert_really_delete_folder">\n                     Do you really want to delete this folder and all its contents?\n-                </span>\n-                <span i18n:translate="alert_deleting_x_number_of_items" tal:condition="python:number_of_objects_to_delete>1">\n-                    (This will delete a total of <span i18n:name="number_of_items_to_delete" tal:content="python:number_of_objects_to_delete">22</span> items.)\n-                </span>\n-            </h1>\n-\n-            <h1 class="documentFirstHeading"\n-                i18n:translate="alert_really_delete"\n-                tal:condition="not:folder_warning">\n+          </span>\n+          <span tal:condition="python:number_of_objects_to_delete>1"\n+                i18n:translate="alert_deleting_x_number_of_items"\n+          >\n+                    (This will delete a total of\n+            <span tal:content="python:number_of_objects_to_delete"\n+                  i18n:name="number_of_items_to_delete"\n+            >22</span>\n+             items.)\n+          </span>\n+        </h1>\n+\n+        <h1 class="documentFirstHeading"\n+            tal:condition="not:folder_warning"\n+            i18n:translate="alert_really_delete"\n+        >\n                 Do you really want to delete this item?\n-            </h1>\n-        </tal:block>\n+        </h1>\n+      </tal:block>\n \n-        <div id="content-core">\n-            <tal:block replace="structure view/more_info">\n-            </tal:block>\n+      <div id="content-core">\n+        <tal:block replace="structure view/more_info">\n+        </tal:block>\n \n-            <ul>\n-                <li tal:content="context/@@plone_context_state/object_title">The item title (ID)</li>\n-            </ul>\n+        <ul>\n+          <li tal:content="context/@@plone_context_state/object_title">The item title (ID)</li>\n+        </ul>\n \n-            <form metal:use-macro="context/@@ploneform-macros/titlelessform" />\n-        </div>\n+        <form metal:use-macro="context/@@ploneform-macros/titlelessform"></form>\n+      </div>\n \n-        </metal:main>\n-    </body>\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/plone/app/content/browser/templates/object_rename.pt b/plone/app/content/browser/templates/object_rename.pt\nindex 9c95d7b..e951e4f 100644\n--- a/plone/app/content/browser/templates/object_rename.pt\n+++ b/plone/app/content/browser/templates/object_rename.pt\n@@ -1,28 +1,35 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-    <metal:block fill-slot="top_slot"\n-               tal:define="dummy python:request.set(\'disable_border\',1)" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+               "\n+  />\n \n-    <body>\n+  <body>\n \n-        <metal:main fill-slot="main">\n+    <metal:main fill-slot="main">\n \n-            <div id="content-core">\n+      <div id="content-core">\n \n-                <h1 class="documentFirstHeading"\n-                    tal:content="view/label">Rename item</h1>\n+        <h1 class="documentFirstHeading"\n+            tal:content="view/label"\n+        >Rename item</h1>\n \n-                <div id="content-core">\n-                    <form metal:use-macro="context/@@ploneform-macros/titlelessform" />\n-                </div>\n+        <div id="content-core">\n+          <form metal:use-macro="context/@@ploneform-macros/titlelessform"></form>\n+        </div>\n \n-            </div>\n-        </metal:main>\n+      </div>\n+    </metal:main>\n \n-    </body>\n+  </body>\n </html>\ndiff --git a/plone/app/content/browser/templates/select_default_page.pt b/plone/app/content/browser/templates/select_default_page.pt\nindex 6686c39..302fbd1 100644\n--- a/plone/app/content/browser/templates/select_default_page.pt\n+++ b/plone/app/content/browser/templates/select_default_page.pt\n@@ -1,91 +1,124 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<metal:block fill-slot="top_slot"\n-             tal:define="dummy python:request.set(\'disable_border\',1)" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+               "\n+  />\n \n   <body>\n \n     <metal:main fill-slot="main">\n       <h1 class="documentFirstHeading"\n-          i18n:translate="heading_select_default_page">Select default page</h1>\n+          i18n:translate="heading_select_default_page"\n+      >Select default page</h1>\n \n-      <div class="documentDescription" i18n:translate="description_select_default_page">\n+      <div class="documentDescription"\n+           i18n:translate="description_select_default_page"\n+      >\n         Please select item which will be displayed as the default page of the\n         folder.\n       </div>\n       <div id="content-core">\n-          <form name="default_page_form"\n-                method="post"\n-                tal:attributes="action string:${context/absolute_url}/select_default_page">\n+        <form method="post"\n+              name="default_page_form"\n+              tal:attributes="\n+                action string:${context/absolute_url}/select_default_page;\n+              "\n+        >\n \n-            <input type="hidden" name="form.submitted" value="1"/>\n+          <input name="form.submitted"\n+                 type="hidden"\n+                 value="1"\n+          />\n \n-            <tal:items define="items view/get_selectable_items;\n-                               cur_page context/getDefaultPage|nothing;">\n-            <tal:hasItems condition="items"\n-                          define="n_items python:len(items);\n-                          member portal_state/member;\n-                          portal_visible_ids context/portal_properties/site_properties/visible_ids|nothing;\n-                          member_visible_ids python:member.getProperty(\'visible_ids\', context.portal_memberdata.getProperty(\'visible_ids\'))">\n-                <dl>\n-                    <tal:item repeat="item items">\n-                        <dt tal:define="normalized_type python:plone_view.normalizeString(item.portal_type);\n-                                        item_id python:\'(%s)\' % item.getId if (portal_visible_ids and member_visible_ids) else \'\'">\n-                            <input type="radio" name="objectId" value=""\n-                                tal:attributes="value item/getId;\n-                                                id item/getId;\n-                                                checked python: (n_items==1 or item.getId==cur_page) and \'checked\' or None;"/>\n-                            <label tal:attributes="for item/getId;\n-                                                   class string:contenttype-${normalized_type}"\n-                                   tal:content="string:${item/pretty_title_or_id} $item_id">\n+          <tal:items define="\n+                       items view/get_selectable_items;\n+                       cur_page context/getDefaultPage|nothing;\n+                     ">\n+            <tal:hasitems define="\n+                            n_items python:len(items);\n+                            member portal_state/member;\n+                            portal_visible_ids context/portal_properties/site_properties/visible_ids|nothing;\n+                            member_visible_ids python:member.getProperty(\'visible_ids\', context.portal_memberdata.getProperty(\'visible_ids\'));\n+                          "\n+                          condition="items"\n+            >\n+              <dl>\n+                <tal:item repeat="item items">\n+                  <dt tal:define="\n+                        normalized_type python:plone_view.normalizeString(item.portal_type);\n+                        item_id python:\'(%s)\' % item.getId if (portal_visible_ids and member_visible_ids) else \'\';\n+                      ">\n+                    <input name="objectId"\n+                           type="radio"\n+                           value=""\n+                           tal:attributes="\n+                             value item/getId;\n+                             id item/getId;\n+                             checked python: (n_items==1 or item.getId==cur_page) and \'checked\' or None;\n+                           "\n+                    />\n+                    <label tal:content="string:${item/pretty_title_or_id} $item_id"\n+                           tal:attributes="\n+                             for item/getId;\n+                             class string:contenttype-${normalized_type};\n+                           "\n+                    >\n                                 Item title\n-                            </label>\n-                        </dt>\n-                        <dd tal:content="item/Description">\n+                    </label>\n+                  </dt>\n+                  <dd tal:content="item/Description">\n                             Item Description\n-                        </dd>\n-                    </tal:item>\n+                  </dd>\n+                </tal:item>\n \n-                </dl>\n+              </dl>\n \n               <div class="formControls mb-3">\n                 <button class="context btn btn-primary"\n-                       type="submit"\n-                       name="form.buttons.Save"\n-                       value="Save"\n-                       i18n:attributes="value label_save;"\n-                       i18n:translate="label_save">Save</button>\n+                        name="form.buttons.Save"\n+                        type="submit"\n+                        value="Save"\n+                        i18n:attributes="value label_save;"\n+                        i18n:translate="label_save"\n+                >Save</button>\n                 <button class="btn btn-secondary"\n-                       type="submit"\n-                       name="form.buttons.Cancel"\n-                       value="Cancel"\n-                       i18n:attributes="value label_cancel;"\n-                       i18n:translate="label_cancel">Cancel</button>\n+                        name="form.buttons.Cancel"\n+                        type="submit"\n+                        value="Cancel"\n+                        i18n:attributes="value label_cancel;"\n+                        i18n:translate="label_cancel"\n+                >Cancel</button>\n               </div>\n \n-            </tal:hasItems>\n+            </tal:hasitems>\n             <tal:noitems condition="not:nocall:items">\n               <div i18n:translate="help_no_selectable_default_pages">\n                  There are no items in this folder that can be selected as\n                  a default view page.\n               </div>\n               <div class="formControls mb-3">\n-                    <button class="context btn btn-primary"\n-                       type="submit"\n-                       name="form.button.Cancel"\n-                       value="Ok"\n-                       i18n:attributes="value label_ok;"\n-                       i18n:translate="label_ok">Ok</button>\n+                <button class="context btn btn-primary"\n+                        name="form.button.Cancel"\n+                        type="submit"\n+                        value="Ok"\n+                        i18n:attributes="value label_ok;"\n+                        i18n:translate="label_ok"\n+                >Ok</button>\n               </div>\n             </tal:noitems>\n-            </tal:items>\n+          </tal:items>\n \n-          </form>\n+        </form>\n       </div>\n \n     </metal:main>\ndiff --git a/plone/app/content/browser/templates/select_default_view.pt b/plone/app/content/browser/templates/select_default_view.pt\nindex 6776969..b7ccdbb 100644\n--- a/plone/app/content/browser/templates/select_default_view.pt\n+++ b/plone/app/content/browser/templates/select_default_view.pt\n@@ -1,89 +1,131 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<metal:block fill-slot="top_slot"\n-             tal:define="dummy python:request.set(\'disable_border\',1)" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+               "\n+  />\n \n   <body>\n \n     <metal:main fill-slot="main">\n \n       <h1 class="documentFirstHeading"\n-          i18n:translate="heading_select_default_view">Select default view</h1>\n+          i18n:translate="heading_select_default_view"\n+      >Select default view</h1>\n \n-      <div class="documentDescription" i18n:translate="description_select_default_view">\n+      <div class="documentDescription"\n+           i18n:translate="description_select_default_view"\n+      >\n         Please select which template should be used as the default view of the\n         folder.\n       </div>\n \n       <div id="content-core">\n-          <form name="default_view_form"\n-                action="."\n-                method="post"\n-                tal:attributes="action view/action_url">\n+        <form action="."\n+              method="post"\n+              name="default_view_form"\n+              tal:attributes="\n+                action view/action_url;\n+              "\n+        >\n \n-            <input type="hidden" name="form.submitted" value="1"/>\n+          <input name="form.submitted"\n+                 type="hidden"\n+                 value="1"\n+          />\n \n-                <div tal:define="selectedLayout view/selectedLayout;">\n-                    <tal:item repeat="layout view/vocab">\n-                        <tal:vars define="value python:layout[0];\n-                                          display python:layout[1];">\n-                            <input type="radio" class="noborder" name="templateId" value=""\n-                                   tal:attributes="value value;\n-                                                   id value;\n-                                                   disabled python:value==selectedLayout"/>\n-                            <label for="" tal:content="display"\n-                                   i18n:translate=""\n-                                   tal:attributes="for value">\n+          <div tal:define="\n+                 selectedLayout view/selectedLayout;\n+               ">\n+            <tal:item repeat="layout view/vocab">\n+              <tal:vars define="\n+                          value python:layout[0];\n+                          display python:layout[1];\n+                        ">\n+                <input class="noborder"\n+                       name="templateId"\n+                       type="radio"\n+                       value=""\n+                       tal:attributes="\n+                         value value;\n+                         id value;\n+                         disabled python:value==selectedLayout;\n+                       "\n+                />\n+                <label for=""\n+                       tal:content="display"\n+                       tal:attributes="\n+                         for value;\n+                       "\n+                       i18n:translate=""\n+                >\n                                 Layout name\n-                            </label>\n-                            <span class="discreet"\n-                                  tal:condition="python:value==selectedLayout"\n-                                  i18n:translate="label_current">(current)</span><br />\n-                        </tal:vars>\n-                    </tal:item>\n-                    <p tal:condition="view/canSelectDefaultPage">\n-                        <tal:selected condition="python:selectedLayout != \'\'">\n-                            <span i18n:translate="label_or">or</span>\n-                            <a title="Select an item to be used as default view in this folder" href="#" class="selected"\n-                               tal:attributes="href string:${context/absolute_url}/select_default_page;"\n-                               i18n:attributes="title title_select_default_page;"\n-                               i18n:translate="label_choose_content_item">\n+                </label>\n+                <span class="discreet"\n+                      tal:condition="python:value==selectedLayout"\n+                      i18n:translate="label_current"\n+                >(current)</span><br />\n+              </tal:vars>\n+            </tal:item>\n+            <p tal:condition="view/canSelectDefaultPage">\n+              <tal:selected condition="python:selectedLayout != \'\'">\n+                <span i18n:translate="label_or">or</span>\n+                <a class="selected"\n+                   href="#"\n+                   title="Select an item to be used as default view in this folder"\n+                   tal:attributes="\n+                     href string:${context/absolute_url}/select_default_page;\n+                   "\n+                   i18n:attributes="title title_select_default_page;"\n+                   i18n:translate="label_choose_content_item"\n+                >\n                                  Choose a content item&hellip;\n-                            </a>\n-                        </tal:selected>\n-                        <tal:selected condition="python:selectedLayout == \'\'">\n-                            <span i18n:translate="label_or">or</span>\n-                            <a title="Change the item used as default view in this folder" href="#" class="selected"\n-                               tal:attributes="href string:${context/absolute_url}/select_default_page;"\n-                               i18n:attributes="title title_change_default_view_item;"\n-                               i18n:translate="label_select_content_item">\n+                </a>\n+              </tal:selected>\n+              <tal:selected condition="python:selectedLayout == \'\'">\n+                <span i18n:translate="label_or">or</span>\n+                <a class="selected"\n+                   href="#"\n+                   title="Change the item used as default view in this folder"\n+                   tal:attributes="\n+                     href string:${context/absolute_url}/select_default_page;\n+                   "\n+                   i18n:attributes="title title_change_default_view_item;"\n+                   i18n:translate="label_select_content_item"\n+                >\n                                  Select a content item&hellip;\n-                            </a>\n-                        </tal:selected>\n-                    </p>\n-                </div>\n+                </a>\n+              </tal:selected>\n+            </p>\n+          </div>\n \n-              <div class="formControls mb-3">\n-                <button class="context btn btn-primary"\n-                       type="submit"\n-                       name="form.button.Save"\n-                       value="Save"\n-                       i18n:attributes="value label_save;"\n-                       i18n:translate="label_save">Save</button>\n-                <button class="standalone btn btn-secondary"\n-                       type="submit"\n-                       name="form.button.Cancel"\n-                       value="Cancel"\n-                       i18n:attributes="value label_cancel;"\n-                       i18n:translate="label_cancel">Cancel</button>\n-              </div>\n+          <div class="formControls mb-3">\n+            <button class="context btn btn-primary"\n+                    name="form.button.Save"\n+                    type="submit"\n+                    value="Save"\n+                    i18n:attributes="value label_save;"\n+                    i18n:translate="label_save"\n+            >Save</button>\n+            <button class="standalone btn btn-secondary"\n+                    name="form.button.Cancel"\n+                    type="submit"\n+                    value="Cancel"\n+                    i18n:attributes="value label_cancel;"\n+                    i18n:translate="label_cancel"\n+            >Cancel</button>\n+          </div>\n \n-          </form>\n+        </form>\n       </div>\n \n     </metal:main>\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2023-10-19T10:06:11+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/11bb056dc8d7d9a045be6f2fba8fa8f383dce812

Merge pull request #262 from plone/config-with-default-template-7150e786

Config with default template

Files changed:
A .editorconfig
A .flake8
A .github/workflows/meta.yml
A .meta.toml
A .pre-commit-config.yaml
A news/5cdbd962.internal
A tox.ini
M .gitignore
M CHANGES.rst
M plone/app/content/browser/actions.py
M plone/app/content/browser/configure.zcml
M plone/app/content/browser/constraintypes.pt
M plone/app/content/browser/constraintypes.py
M plone/app/content/browser/content_status_history.py
M plone/app/content/browser/contents/__init__.py
M plone/app/content/browser/contents/configure.zcml
M plone/app/content/browser/contents/copy.py
M plone/app/content/browser/contents/cut.py
M plone/app/content/browser/contents/delete.py
M plone/app/content/browser/contents/paste.py
M plone/app/content/browser/contents/properties.py
M plone/app/content/browser/contents/rename.py
M plone/app/content/browser/contents/tags.py
M plone/app/content/browser/contents/workflow.py
M plone/app/content/browser/folderfactories.pt
M plone/app/content/browser/full_review_list.pt
M plone/app/content/browser/i18n.py
M plone/app/content/browser/interfaces.py
M plone/app/content/browser/selection.py
M plone/app/content/browser/table.pt
M plone/app/content/browser/table.txt
M plone/app/content/browser/templates/content_status_history.pt
M plone/app/content/browser/templates/delete_confirmation.pt
M plone/app/content/browser/templates/object_rename.pt
M plone/app/content/browser/templates/select_default_page.pt
M plone/app/content/browser/templates/select_default_view.pt
M plone/app/content/browser/vocabulary.py
M plone/app/content/configure.zcml
M plone/app/content/namechooser.py
M plone/app/content/testing.py
M plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows.xml
M plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows/non-ascii-workflow/definition.xml
M plone/app/content/tests/profiles/non-ascii-workflow.zcml
M plone/app/content/tests/test_actions.py
M plone/app/content/tests/test_adding.py
M plone/app/content/tests/test_content_status_modify.py
M plone/app/content/tests/test_contents.py
M plone/app/content/tests/test_folder.py
M plone/app/content/tests/test_namechooser_unit.py
M plone/app/content/tests/test_non_ascii_characters_in_workflow_state.py
M plone/app/content/tests/test_selectdefaultpage.py
M plone/app/content/tests/test_widgets.py
M plone/app/content/utils.py
M pyproject.toml
M setup.py
D setup.cfg

b'diff --git a/.editorconfig b/.editorconfig\nnew file mode 100644\nindex 00000000..8ae05aaa\n--- /dev/null\n+++ b/.editorconfig\n@@ -0,0 +1,54 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+#\n+# EditorConfig Configuration file, for more details see:\n+# http://EditorConfig.org\n+# EditorConfig is a convention description, that could be interpreted\n+# by multiple editors to enforce common coding conventions for specific\n+# file types\n+\n+# top-most EditorConfig file:\n+# Will ignore other EditorConfig files in Home directory or upper tree level.\n+root = true\n+\n+\n+[*]  # For All Files\n+# Unix-style newlines with a newline ending every file\n+end_of_line = lf\n+insert_final_newline = true\n+trim_trailing_whitespace = true\n+# Set default charset\n+charset = utf-8\n+# Indent style default\n+indent_style = space\n+# Max Line Length - a hard line wrap, should be disabled\n+max_line_length = off\n+\n+[*.{py,cfg,ini}]\n+# 4 space indentation\n+indent_size = 4\n+\n+[*.{yml,zpt,pt,dtml,zcml}]\n+# 2 space indentation\n+indent_size = 2\n+\n+[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss,html}]  # Frontend development\n+# 2 space indentation\n+indent_size = 2\n+max_line_length = 80\n+\n+[{Makefile,.gitmodules}]\n+# Tab indentation (no size specified, but view as 4 spaces)\n+indent_style = tab\n+indent_size = unset\n+tab_width = unset\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [editorconfig]\n+#  extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\ndiff --git a/.flake8 b/.flake8\nnew file mode 100644\nindex 00000000..7ef4f64d\n--- /dev/null\n+++ b/.flake8\n@@ -0,0 +1,22 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+[flake8]\n+doctests = 1\n+ignore =\n+    # black takes care of line length\n+    E501,\n+    # black takes care of where to break lines\n+    W503,\n+    # black takes care of spaces within slicing (list[:])\n+    E203,\n+    # black takes care of spaces after commas\n+    E231,\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [flake8]\n+#  extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\ndiff --git a/.github/workflows/meta.yml b/.github/workflows/meta.yml\nnew file mode 100644\nindex 00000000..aa2345cf\n--- /dev/null\n+++ b/.github/workflows/meta.yml\n@@ -0,0 +1,70 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+name: Meta\n+on:\n+  push:\n+    branches:\n+      - master\n+      - main\n+  pull_request:\n+    branches:\n+      - master\n+      - main\n+  workflow_dispatch:\n+\n+##\n+# To set environment variables for all jobs, add in .meta.toml:\n+# [github]\n+# env = """\n+#     debug: 1\n+#     image-name: \'org/image\'\n+#     image-tag: \'latest\'\n+# """\n+##\n+\n+jobs:\n+  qa:\n+    uses: plone/meta/.github/workflows/qa.yml@main\n+  test:\n+    uses: plone/meta/.github/workflows/test.yml@main\n+  coverage:\n+    uses: plone/meta/.github/workflows/coverage.yml@main\n+  dependencies:\n+    uses: plone/meta/.github/workflows/dependencies.yml@main\n+  release_ready:\n+    uses: plone/meta/.github/workflows/release_ready.yml@main\n+\n+# TODO: enable the circular dependencies check once the circular\n+# dependency with plone.app.dexterity is fixed.\n+# See https://github.com/plone/Products.CMFPlone/issues/3858\n+\n+##\n+# To modify the list of default jobs being created add in .meta.toml:\n+# [github]\n+# jobs = [\n+#    "qa",\n+#    "test",\n+#    "coverage",\n+#    "dependencies",\n+#    "release_ready",\n+#    "circular",\n+#    ]\n+##\n+\n+##\n+# To request that some OS level dependencies get installed\n+# when running tests/coverage jobs, add in .meta.toml:\n+# [github]\n+# os_dependencies = "git libxml2 libxslt"\n+##\n+\n+\n+##\n+# Specify additional jobs in .meta.toml:\n+#  [github]\n+#  extra_lines = """\n+#  another:\n+#    uses: org/repo/.github/workflows/file.yml@main\n+#  """\n+##\ndiff --git a/.gitignore b/.gitignore\nindex d12b524c..503e47c5 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -1,23 +1,55 @@\n-/develop-eggs\n-/eggs\n-/fake-eggs\n-/bin\n-/parts\n-/downloads\n-/var\n-/build\n-/dist\n-/local.cfg\n-/*.egg-info\n-/.installed.cfg\n-/.mr.developer.cfg\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+# python related\n+*.egg-info\n *.pyc\n-/.Python\n-/include\n-/lib\n-/src/*\n+*.pyo\n+\n+# translation related\n *.mo\n-/.coverage\n+\n+# tools related\n+build/\n+.coverage\n+.*project\n coverage.xml\n-zptlint.log\n-.DS_Store\n+dist/\n+docs/_build\n+__pycache__/\n+.tox\n+.vscode/\n+node_modules/\n+\n+# venv / buildout related\n+bin/\n+develop-eggs/\n+eggs/\n+.eggs/\n+etc/\n+.installed.cfg\n+include/\n+lib/\n+lib64\n+.mr.developer.cfg\n+parts/\n+pyvenv.cfg\n+var/\n+\n+# mxdev\n+/instance/\n+/.make-sentinels/\n+/*-mxdev.txt\n+/reports/\n+/sources/\n+/venv/\n+.installed.txt\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [gitignore]\n+#  extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\ndiff --git a/.meta.toml b/.meta.toml\nnew file mode 100644\nindex 00000000..d5d5bc47\n--- /dev/null\n+++ b/.meta.toml\n@@ -0,0 +1,26 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+[meta]\n+template = "default"\n+commit-id = "68cda6e4"\n+\n+[github]\n+jobs = [\n+    "qa",\n+    "test",\n+    "coverage",\n+    "dependencies",\n+    "release_ready",\n+    ]\n+\n+[pre_commit]\n+zpretty_extra_lines = """\n+        exclude: plone/app/content/browser/contents/templates\n+"""\n+i18ndude_extra_lines = """\n+        exclude: plone/app/content/browser/contents\n+"""\n+\n+[pyproject]\n+dependencies_ignores = "[\'tus\', ]"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nnew file mode 100644\nindex 00000000..fac51902\n--- /dev/null\n+++ b/.pre-commit-config.yaml\n@@ -0,0 +1,96 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+ci:\n+    autofix_prs: false\n+    autoupdate_schedule: monthly\n+\n+repos:\n+-   repo: https://github.com/asottile/pyupgrade\n+    rev: v3.14.0\n+    hooks:\n+    -   id: pyupgrade\n+        args: [--py38-plus]\n+-   repo: https://github.com/pycqa/isort\n+    rev: 5.12.0\n+    hooks:\n+    -   id: isort\n+-   repo: https://github.com/psf/black\n+    rev: 23.9.1\n+    hooks:\n+    -   id: black\n+-   repo: https://github.com/collective/zpretty\n+    rev: 3.1.0\n+    hooks:\n+    -   id: zpretty\n+        exclude: plone/app/content/browser/contents/templates\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pre_commit]\n+#  zpretty_extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\n+-   repo: https://github.com/PyCQA/flake8\n+    rev: 6.1.0\n+    hooks:\n+    -   id: flake8\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pre_commit]\n+#  flake8_extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\n+-   repo: https://github.com/codespell-project/codespell\n+    rev: v2.2.6\n+    hooks:\n+    -   id: codespell\n+        additional_dependencies:\n+          - tomli\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pre_commit]\n+#  codespell_extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\n+-   repo: https://github.com/mgedmin/check-manifest\n+    rev: "0.49"\n+    hooks:\n+    -   id: check-manifest\n+-   repo: https://github.com/regebro/pyroma\n+    rev: "4.2"\n+    hooks:\n+    -   id: pyroma\n+-   repo: https://github.com/mgedmin/check-python-versions\n+    rev: "0.21.3"\n+    hooks:\n+    -   id: check-python-versions\n+        args: [\'--only\', \'setup.py,pyproject.toml\']\n+-   repo: https://github.com/collective/i18ndude\n+    rev: "6.1.0"\n+    hooks:\n+    -   id: i18ndude\n+        exclude: plone/app/content/browser/contents\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pre_commit]\n+#  i18ndude_extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pre_commit]\n+#  extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\ndiff --git a/CHANGES.rst b/CHANGES.rst\nindex 531f0cee..ac89afd5 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -210,7 +210,7 @@ Bug fixes:\n Bug fixes:\n \n \n-- Call fileUpload view explict with @@ to avoid possible plone.rest clashes.\n+- Call fileUpload view explicit with @@ to avoid possible plone.rest clashes.\n   [jensens] (#225)\n \n \n@@ -552,7 +552,7 @@ Bug fixes:\n   [thet]\n \n - Fix issue where some actions (copy, delete, paste) on contents view did not\n-  work if there were any private (innaccessible for the current user) levels the\n+  work if there were any private (inaccessible for the current user) levels the\n   current path\n   [datakurre]\n \n@@ -908,7 +908,7 @@ Fixes:\n - When clicking cancel on the delete_confirmation got to the view_url.\n   [ale-rt]\n \n-- Fix deletion of objects with unicode charaters in the title.\n+- Fix deletion of objects with unicode characters in the title.\n   [cillianderoiste]\n \n \n@@ -988,7 +988,7 @@ Fixes:\n - Translate folder contents add menu\n   [vangheem]\n \n-- use same columns title in results and in displayed colums configuration\n+- use same columns title in results and in displayed columns configuration\n   [vincent]\n \n \ndiff --git a/news/5cdbd962.internal b/news/5cdbd962.internal\nnew file mode 100644\nindex 00000000..c08f5399\n--- /dev/null\n+++ b/news/5cdbd962.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/plone/app/content/browser/actions.py b/plone/app/content/browser/actions.py\nindex b939b341..6f16e535 100644\n--- a/plone/app/content/browser/actions.py\n+++ b/plone/app/content/browser/actions.py\n@@ -38,7 +38,6 @@ def is_locked(self):\n \n \n class DeleteConfirmationForm(form.Form, LockingBase):\n-\n     fields = field.Fields()\n     template = ViewPageTemplateFile("templates/delete_confirmation.pt")\n     enableCSRFProtection = True\n@@ -140,7 +139,6 @@ class IRenameForm(Interface):\n \n \n class RenameForm(form.Form):\n-\n     fields = field.Fields(IRenameForm)\n     template = ViewPageTemplateFile("templates/object_rename.pt")\n     enableCSRFProtection = True\ndiff --git a/plone/app/content/browser/configure.zcml b/plone/app/content/browser/configure.zcml\nindex b69207b9..f2762e98 100644\n--- a/plone/app/content/browser/configure.zcml\n+++ b/plone/app/content/browser/configure.zcml\n@@ -1,204 +1,213 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n-    xmlns:five="http://namespaces.zope.org/five">\n-\n-    <!-- Adding view -->\n-    <browser:view\n-        for="Products.CMFCore.interfaces.IFolderish"\n-        name="+"\n-        class=".adding.CMFAdding"\n-        permission="cmf.AddPortalContent"\n-        />\n-\n-    <!-- Folder contents -->\n-    <include package=".contents" />\n-\n-    <!-- Review list -->\n-    <browser:page\n-        for="*"\n-        class=".reviewlist.FullReviewListView"\n-        name="full_review_list"\n-        template="full_review_list.pt"\n-        permission="cmf.ReviewPortalContent" />\n-\n-    <browser:page\n-         for="*"\n-         class=".reviewlist.ReviewListBrowserView"\n-         attribute="update_table"\n-         name="reviewlist_get_table"\n-         permission="cmf.ReviewPortalContent" />\n-\n-    <!-- Content status history -->\n-    <browser:page\n-        for="*"\n-        name="content_status_history"\n-        class=".content_status_history.ContentStatusHistoryView"\n-        permission="cmf.ModifyPortalContent"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="folder_publish"\n-        class=".folder_publish.FolderPublishView"\n-        permission="cmf.ModifyPortalContent"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="content_status_modify"\n-        class=".content_status_modify.ContentStatusModifyView"\n-        permission="zope2.View"\n-        />\n-\n-    <!-- Folder factories -->\n-    <browser:page\n-        for="*"\n-        name="folder_factories"\n-        class=".folderfactories.FolderFactoriesView"\n-        template="folderfactories.pt"\n-        permission="cmf.AddPortalContent"\n-        />\n-\n-    <!-- Constrain container allowed content types -->\n-    <permission\n-        id="plone.ModifyConstrainTypes"\n-        title="Modify constrain types"\n-        />\n-    <browser:page\n-        name="folder_constraintypes_form"\n-        for="Products.CMFCore.interfaces.IFolderish"\n-        permission="plone.ModifyConstrainTypes"\n-        class=".constraintypes.ConstrainsFormView"\n-        />\n-    <utility\n-        component=".constraintypes.ValidTypesFactory"\n-        name="plone.app.content.ValidAddableTypes"\n-        />\n-\n-    <!-- Required for cmf.ModifyViewTemplate -->\n-    <include package="Products.CMFDynamicViewFTI" />\n-\n-    <!-- Select default view -->\n-    <browser:page\n-        for="*"\n-        name="select_default_view"\n-        class=".selection.DefaultViewSelectionView"\n-        template="templates/select_default_view.pt"\n-        permission="cmf.ModifyViewTemplate"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="selectViewTemplate"\n-        class=".selection.DefaultViewSelectionView"\n-        attribute="selectViewTemplate"\n-        permission="cmf.ModifyViewTemplate"\n-        />\n-\n-    <!-- Select default page view -->\n-    <browser:page\n-        for="*"\n-        name="select_default_page"\n-        class=".selection.DefaultPageSelectionView"\n-        template="templates/select_default_page.pt"\n-        permission="cmf.ModifyViewTemplate"\n-        />\n-\n-    <!-- Actions -->\n-    <browser:page\n-        for="*"\n-        name="delete_confirmation"\n-        class=".actions.DeleteConfirmationForm"\n-        permission="zope2.DeleteObjects"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="folder_rename"\n-        class=".actions.RenameForm"\n-        permission="cmf.ModifyPortalContent"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="object_rename"\n-        class=".actions.RenameForm"\n-        permission="cmf.ModifyPortalContent"\n-        />\n-\n-    <adapter factory=".actions.default_new_id" name="default" />\n-    <adapter factory=".actions.default_new_title" name="default" />\n-\n-    <browser:page\n-        for="*"\n-        name="object_cut"\n-        class=".actions.ObjectCutView"\n-        permission="zope2.DeleteObjects"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="object_copy"\n-        class=".actions.ObjectCopyView"\n-        permission="zope2.CopyOrMove"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="object_paste"\n-        class=".actions.ObjectPasteView"\n-        permission="cmf.AddPortalContent"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="object_delete"\n-        class=".actions.ObjectDeleteView"\n-        permission="zope2.DeleteObjects"\n-        />\n-\n-\n-    <browser:page\n-        name="getVocabulary"\n-        for="*"\n-        class=".vocabulary.VocabularyView"\n-        permission="zope2.View"\n-        />\n-\n-    <browser:page\n-        name="getSource"\n-        for="z3c.form.interfaces.IWidget"\n-        class=".vocabulary.SourceView"\n-        permission="zope.Public"\n-        />\n-\n-    <browser:page\n-        name="fileUpload"\n-        for="Products.CMFCore.interfaces._content.IFolderish"\n-        class=".file.FileUploadView"\n-        permission="zope2.View"\n-        />\n-\n-    <browser:page\n-        name="qsOptions"\n-        for="plone.app.layout.navigation.interfaces.INavigationRoot"\n-        class=".query.QueryStringIndexOptions"\n-        permission="zope2.View"\n-        />\n-\n-    <browser:view\n-        for="plone.app.layout.navigation.interfaces.INavigationRoot"\n-        name="plonejsi18n"\n-        class=".i18n.i18njs"\n-        permission="zope2.View"\n-        />\n-\n-    <browser:page\n-        for="*"\n-        name="allow_upload"\n-        class=".file.AllowUploadView"\n-        permission="cmf.AddPortalContent"\n-        />\n+    xmlns:five="http://namespaces.zope.org/five"\n+    >\n+\n+  <!-- Adding view -->\n+  <browser:view\n+      name="+"\n+      for="Products.CMFCore.interfaces.IFolderish"\n+      class=".adding.CMFAdding"\n+      permission="cmf.AddPortalContent"\n+      />\n+\n+  <!-- Folder contents -->\n+  <include package=".contents" />\n+\n+  <!-- Review list -->\n+  <browser:page\n+      name="full_review_list"\n+      for="*"\n+      class=".reviewlist.FullReviewListView"\n+      template="full_review_list.pt"\n+      permission="cmf.ReviewPortalContent"\n+      />\n+\n+  <browser:page\n+      name="reviewlist_get_table"\n+      for="*"\n+      class=".reviewlist.ReviewListBrowserView"\n+      attribute="update_table"\n+      permission="cmf.ReviewPortalContent"\n+      />\n+\n+  <!-- Content status history -->\n+  <browser:page\n+      name="content_status_history"\n+      for="*"\n+      class=".content_status_history.ContentStatusHistoryView"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n+  <browser:page\n+      name="folder_publish"\n+      for="*"\n+      class=".folder_publish.FolderPublishView"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n+  <browser:page\n+      name="content_status_modify"\n+      for="*"\n+      class=".content_status_modify.ContentStatusModifyView"\n+      permission="zope2.View"\n+      />\n+\n+  <!-- Folder factories -->\n+  <browser:page\n+      name="folder_factories"\n+      for="*"\n+      class=".folderfactories.FolderFactoriesView"\n+      template="folderfactories.pt"\n+      permission="cmf.AddPortalContent"\n+      />\n+\n+  <!-- Constrain container allowed content types -->\n+  <permission\n+      id="plone.ModifyConstrainTypes"\n+      title="Modify constrain types"\n+      />\n+  <browser:page\n+      name="folder_constraintypes_form"\n+      for="Products.CMFCore.interfaces.IFolderish"\n+      class=".constraintypes.ConstrainsFormView"\n+      permission="plone.ModifyConstrainTypes"\n+      />\n+  <utility\n+      name="plone.app.content.ValidAddableTypes"\n+      component=".constraintypes.ValidTypesFactory"\n+      />\n+\n+  <!-- Required for cmf.ModifyViewTemplate -->\n+  <include package="Products.CMFDynamicViewFTI" />\n+\n+  <!-- Select default view -->\n+  <browser:page\n+      name="select_default_view"\n+      for="*"\n+      class=".selection.DefaultViewSelectionView"\n+      template="templates/select_default_view.pt"\n+      permission="cmf.ModifyViewTemplate"\n+      />\n+\n+  <browser:page\n+      name="selectViewTemplate"\n+      for="*"\n+      class=".selection.DefaultViewSelectionView"\n+      attribute="selectViewTemplate"\n+      permission="cmf.ModifyViewTemplate"\n+      />\n+\n+  <!-- Select default page view -->\n+  <browser:page\n+      name="select_default_page"\n+      for="*"\n+      class=".selection.DefaultPageSelectionView"\n+      template="templates/select_default_page.pt"\n+      permission="cmf.ModifyViewTemplate"\n+      />\n+\n+  <!-- Actions -->\n+  <browser:page\n+      name="delete_confirmation"\n+      for="*"\n+      class=".actions.DeleteConfirmationForm"\n+      permission="zope2.DeleteObjects"\n+      />\n+\n+  <browser:page\n+      name="folder_rename"\n+      for="*"\n+      class=".actions.RenameForm"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n+  <browser:page\n+      name="object_rename"\n+      for="*"\n+      class=".actions.RenameForm"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n+  <adapter\n+      factory=".actions.default_new_id"\n+      name="default"\n+      />\n+  <adapter\n+      factory=".actions.default_new_title"\n+      name="default"\n+      />\n+\n+  <browser:page\n+      name="object_cut"\n+      for="*"\n+      class=".actions.ObjectCutView"\n+      permission="zope2.DeleteObjects"\n+      />\n+\n+  <browser:page\n+      name="object_copy"\n+      for="*"\n+      class=".actions.ObjectCopyView"\n+      permission="zope2.CopyOrMove"\n+      />\n+\n+  <browser:page\n+      name="object_paste"\n+      for="*"\n+      class=".actions.ObjectPasteView"\n+      permission="cmf.AddPortalContent"\n+      />\n+\n+  <browser:page\n+      name="object_delete"\n+      for="*"\n+      class=".actions.ObjectDeleteView"\n+      permission="zope2.DeleteObjects"\n+      />\n+\n+\n+  <browser:page\n+      name="getVocabulary"\n+      for="*"\n+      class=".vocabulary.VocabularyView"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:page\n+      name="getSource"\n+      for="z3c.form.interfaces.IWidget"\n+      class=".vocabulary.SourceView"\n+      permission="zope.Public"\n+      />\n+\n+  <browser:page\n+      name="fileUpload"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".file.FileUploadView"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:page\n+      name="qsOptions"\n+      for="plone.base.interfaces.siteroot.INavigationRoot"\n+      class=".query.QueryStringIndexOptions"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:view\n+      name="plonejsi18n"\n+      for="plone.base.interfaces.siteroot.INavigationRoot"\n+      class=".i18n.i18njs"\n+      permission="zope2.View"\n+      />\n+\n+  <browser:page\n+      name="allow_upload"\n+      for="*"\n+      class=".file.AllowUploadView"\n+      permission="cmf.AddPortalContent"\n+      />\n \n </configure>\ndiff --git a/plone/app/content/browser/constraintypes.pt b/plone/app/content/browser/constraintypes.pt\nindex ead1a965..2cb548d3 100644\n--- a/plone/app/content/browser/constraintypes.pt\n+++ b/plone/app/content/browser/constraintypes.pt\n@@ -1,20 +1,24 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="here/main_template/macros/master"\n-      i18n:domain="plone.app.dexterity">\n-      <head>\n-        <div metal:fill-slot="javascript_head_slot" tal:omit-tag="">\n-          <script type="text/javascript">\n+      xml:lang="en"\n+      i18n:domain="plone.app.dexterity"\n+>\n+  <head>\n+    <div metal:fill-slot="javascript_head_slot"\n+         tal:omit-tag=""\n+    >\n+      <script type="text/javascript">\n               (function($){\n                 // Custom form constraints for constrain form\n                 $(document).ready(function(){\n-                  var prefered = $(".current_prefer_form"),\n+                  var preferred = $(".current_prefer_form"),\n                       allowed = $(".current_allow_form"),\n                       constrain_mode = $(".constrain_types_mode_form"),\n-                      prefered_field = prefered.parents(\'.field\'),\n+                      preferred_field = preferred.parents(\'.field\'),\n                       allowed_field = allowed.parents(\'.field\'),\n                       ACQUIRE = -1,\n                       DISABLED = 0,\n@@ -22,15 +26,15 @@\n                   function updateVisibility(){\n                     var mode = constrain_mode.val();\n                     if(mode == ENABLED){\n-                      prefered_field.show();\n+                      preferred_field.show();\n                       allowed_field.show();\n                     }else{\n-                      prefered_field.hide();\n+                      preferred_field.hide();\n                       allowed_field.hide();\n                     }\n                   }\n                   function updateSelectable(){\n-                    prefered.each(function(){\n+                    preferred.each(function(){\n                       var allowed_id = this.id.replace(\'allowed\', \'secondary\'),\n                           allowed_item = allowed_field.find("#" + allowed_id);\n                       if (this.checked){\n@@ -43,20 +47,22 @@\n                   }\n                   constrain_mode.change(updateVisibility);\n                   updateVisibility();\n-                  prefered_field.change(updateSelectable);\n+                  preferred_field.change(updateSelectable);\n                   updateSelectable();\n                 })\n               }(jQuery));\n-          </script>\n-        </div>\n+      </script>\n+    </div>\n \n-      </head>\n+  </head>\n   <body>\n \n     <metal:main fill-slot="main">\n       <tal:main-macro metal:define-macro="main">\n \n-        <h1 class="documentFirstHeading" tal:content="view/label">Title</h1>\n+        <h1 class="documentFirstHeading"\n+            tal:content="view/label"\n+        >Title</h1>\n \n \n         <metal:block use-macro="context/@@ploneform-macros/titlelessform" />\n@@ -64,4 +70,3 @@\n     </metal:main>\n   </body>\n </html>\n-\ndiff --git a/plone/app/content/browser/constraintypes.py b/plone/app/content/browser/constraintypes.py\nindex 6d8fd04d..1b83a091 100644\n--- a/plone/app/content/browser/constraintypes.py\n+++ b/plone/app/content/browser/constraintypes.py\n@@ -1,5 +1,4 @@\n from plone.autoform.form import AutoExtensibleForm\n-from plone.base import PloneMessageFactory as _\n from plone.base.interfaces import ISelectableConstrainTypes\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from z3c.form import button\n@@ -61,7 +60,6 @@ def __call__(self, context):\n \n \n class IConstrainForm(Interface):\n-\n     constrain_types_mode = Choice(\n         title=_("label_type_restrictions", default="Type restrictions"),\n         description=_(\n@@ -140,7 +138,6 @@ def secondary_types(self):\n \n \n class ConstrainsFormView(AutoExtensibleForm, form.EditForm):\n-\n     schema = IConstrainForm\n     label = _(\n         "heading_set_content_type_restrictions",\ndiff --git a/plone/app/content/browser/content_status_history.py b/plone/app/content/browser/content_status_history.py\nindex b2882b97..d1810771 100644\n--- a/plone/app/content/browser/content_status_history.py\n+++ b/plone/app/content/browser/content_status_history.py\n@@ -48,7 +48,6 @@ class ContentStatusHistoryDatesForm(form.Form):\n \n \n class ContentStatusHistoryView(BrowserView):\n-\n     template = ViewPageTemplateFile("templates/content_status_history.pt")\n \n     def __init__(self, context, request):\n@@ -66,9 +65,8 @@ def __call__(\n         effective_date=None,\n         expiration_date=None,\n         include_children=False,\n-        *args\n+        *args,\n     ):\n-\n         data = self.dates_form.extractData()\n         if self.request.get("form.widgets.effective_date-calendar", None) and data:\n             effective_date = data[0]["effective_date"].strftime("%Y-%m-%d %H:%M")\ndiff --git a/plone/app/content/browser/contents/__init__.py b/plone/app/content/browser/contents/__init__.py\nindex eaafd1c1..66b8f221 100644\n--- a/plone/app/content/browser/contents/__init__.py\n+++ b/plone/app/content/browser/contents/__init__.py\n@@ -26,7 +26,6 @@\n \n \n class ContentsBaseAction(BrowserView):\n-\n     success_msg = _("Success")\n     failure_msg = _("Failure")\n     required_obj_permission = None\n@@ -183,7 +182,7 @@ def get_thumb_scale(self):\n         registry = getUtility(IRegistry)\n         settings = registry.forInterface(ISiteSchema, prefix="plone", check=False)\n         if settings.no_thumbs_tables:\n-            # thumbs to be supressed\n+            # thumbs to be suppressed\n             return None\n         thumb_scale_table = settings.thumb_scale_table\n         return thumb_scale_table\n@@ -293,7 +292,6 @@ def __call__(self):\n \n \n class ContextInfo(BrowserView):\n-\n     attributes = [\n         "CreationDate",\n         "Creator",\ndiff --git a/plone/app/content/browser/contents/configure.zcml b/plone/app/content/browser/contents/configure.zcml\nindex d6773cb5..931d4b90 100644\n--- a/plone/app/content/browser/contents/configure.zcml\n+++ b/plone/app/content/browser/contents/configure.zcml\n@@ -1,123 +1,140 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n+    xmlns:i18n="http://namespaces.zope.org/i18n"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:i18n="http://namespaces.zope.org/i18n">\n+    >\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    class=".FolderContentsView"\n-    name="folder_contents"\n-    template="templates/folder_contents.pt"\n-    permission="cmf.ListFolderContents"\n-    />\n+      name="folder_contents"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".FolderContentsView"\n+      template="templates/folder_contents.pt"\n+      permission="cmf.ListFolderContents"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-contextInfo"\n-    class=".ContextInfo"\n-    permission="cmf.ListFolderContents"\n-    />\n+      name="fc-contextInfo"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".ContextInfo"\n+      permission="cmf.ListFolderContents"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-setDefaultPage"\n-    class=".defaultpage.SetDefaultPageActionView"\n-    permission="cmf.ModifyPortalContent"\n-    />\n+      name="fc-setDefaultPage"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".defaultpage.SetDefaultPageActionView"\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-itemOrder"\n-    class=".rearrange.ItemOrderActionView"\n-    permission="cmf.ModifyPortalContent"\n-    />\n+      name="fc-itemOrder"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".rearrange.ItemOrderActionView"\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-rearrange"\n-    class=".rearrange.RearrangeActionView"\n-    permission="cmf.ModifyPortalContent"\n-    />\n+      name="fc-rearrange"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".rearrange.RearrangeActionView"\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n   <!-- buttons -->\n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-rename"\n-    class=".rename.RenameActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".rename.RenameAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="rename" />\n+      name="fc-rename"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".rename.RenameActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="rename"\n+      component=".rename.RenameAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-tags"\n-    class=".tags.TagsActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".tags.TagsAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="tags" />\n+      name="fc-tags"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".tags.TagsActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="tags"\n+      component=".tags.TagsAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-delete"\n-    class=".delete.DeleteActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".delete.DeleteAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="delete" />\n+      name="fc-delete"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".delete.DeleteActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="delete"\n+      component=".delete.DeleteAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-workflow"\n-    class=".workflow.WorkflowActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".workflow.WorkflowAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="workflow" />\n+      name="fc-workflow"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".workflow.WorkflowActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="workflow"\n+      component=".workflow.WorkflowAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-properties"\n-    class=".properties.PropertiesActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".properties.PropertiesAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="properties" />\n+      name="fc-properties"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".properties.PropertiesActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="properties"\n+      component=".properties.PropertiesAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-copy"\n-    class=".copy.CopyActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".copy.CopyAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="copy" />\n+      name="fc-copy"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".copy.CopyActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="copy"\n+      component=".copy.CopyAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-cut"\n-    class=".cut.CutActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".cut.CutAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="cut" />\n+      name="fc-cut"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".cut.CutActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="cut"\n+      component=".cut.CutAction"\n+      />\n \n   <browser:page\n-    for="Products.CMFCore.interfaces._content.IFolderish"\n-    name="fc-paste"\n-    class=".paste.PasteActionView"\n-    permission="cmf.ListFolderContents"\n-    />\n-  <utility component=".paste.PasteAction"\n-           provides="plone.app.content.interfaces.IStructureAction"\n-           name="paste" />\n+      name="fc-paste"\n+      for="Products.CMFCore.interfaces._content.IFolderish"\n+      class=".paste.PasteActionView"\n+      permission="cmf.ListFolderContents"\n+      />\n+  <utility\n+      provides="plone.app.content.interfaces.IStructureAction"\n+      name="paste"\n+      component=".paste.PasteAction"\n+      />\n </configure>\ndiff --git a/plone/app/content/browser/contents/copy.py b/plone/app/content/browser/contents/copy.py\nindex 015b995d..4259bd7b 100644\n--- a/plone/app/content/browser/contents/copy.py\n+++ b/plone/app/content/browser/contents/copy.py\n@@ -10,7 +10,6 @@\n \n @implementer(IStructureAction)\n class CopyAction:\n-\n     order = 2\n \n     def __init__(self, context, request):\ndiff --git a/plone/app/content/browser/contents/cut.py b/plone/app/content/browser/contents/cut.py\nindex e785931f..d7233305 100644\n--- a/plone/app/content/browser/contents/cut.py\n+++ b/plone/app/content/browser/contents/cut.py\n@@ -11,7 +11,6 @@\n \n @implementer(IStructureAction)\n class CutAction:\n-\n     order = 1\n \n     def __init__(self, context, request):\ndiff --git a/plone/app/content/browser/contents/delete.py b/plone/app/content/browser/contents/delete.py\nindex 5adac14a..8eb6018e 100644\n--- a/plone/app/content/browser/contents/delete.py\n+++ b/plone/app/content/browser/contents/delete.py\n@@ -16,7 +16,6 @@\n \n @implementer(IStructureAction)\n class DeleteAction:\n-\n     template = ViewPageTemplateFile("templates/delete.pt")\n     order = 4\n \ndiff --git a/plone/app/content/browser/contents/paste.py b/plone/app/content/browser/contents/paste.py\nindex 0250760d..52c09653 100644\n--- a/plone/app/content/browser/contents/paste.py\n+++ b/plone/app/content/browser/contents/paste.py\n@@ -9,7 +9,6 @@\n \n @implementer(IStructureAction)\n class PasteAction:\n-\n     order = 3\n \n     def __init__(self, context, request):\ndiff --git a/plone/app/content/browser/contents/properties.py b/plone/app/content/browser/contents/properties.py\nindex aba47250..c51e8a70 100644\n--- a/plone/app/content/browser/contents/properties.py\n+++ b/plone/app/content/browser/contents/properties.py\n@@ -5,9 +5,7 @@\n from plone.app.widgets.utils import get_datetime_options\n from plone.base import PloneMessageFactory as _\n from plone.base.defaultpage import check_default_page_via_view\n-from plone.dexterity.interfaces import IDexterityContent\n from Products.CMFCore.interfaces._content import IFolderish\n-from Products.CMFCore.utils import getToolByName\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope.component import getUtility\n from zope.component.hooks import getSite\n@@ -20,7 +18,6 @@\n \n @implementer(IStructureAction)\n class PropertiesAction:\n-\n     template = ViewPageTemplateFile("templates/properties.pt")\n     order = 8\n \n@@ -54,7 +51,6 @@ class PropertiesActionView(ContentsBaseAction):\n     required_obj_permission = "Modify portal content"\n \n     def __call__(self):\n-\n         if self.request.form.get("render") == "yes":\n             lang_factory = getUtility(\n                 IVocabularyFactory, "plone.app.vocabularies.SupportedContentLanguages"\n@@ -95,7 +91,6 @@ def __call__(self):\n         return super().__call__()\n \n     def action(self, obj, bypass_recurse=False):\n-\n         if check_default_page_via_view(obj, self.request):\n             self.action(obj.aq_parent, bypass_recurse=True)\n         recurse = self.recurse and not bypass_recurse\ndiff --git a/plone/app/content/browser/contents/rename.py b/plone/app/content/browser/contents/rename.py\nindex 25ad37f0..eb2a9d45 100644\n--- a/plone/app/content/browser/contents/rename.py\n+++ b/plone/app/content/browser/contents/rename.py\n@@ -23,7 +23,6 @@\n \n @implementer(IStructureAction)\n class RenameAction:\n-\n     template = ViewPageTemplateFile("templates/rename.pt")\n     order = 5\n \ndiff --git a/plone/app/content/browser/contents/tags.py b/plone/app/content/browser/contents/tags.py\nindex 01e8f141..fe18d205 100644\n--- a/plone/app/content/browser/contents/tags.py\n+++ b/plone/app/content/browser/contents/tags.py\n@@ -9,7 +9,6 @@\n \n @implementer(IStructureAction)\n class TagsAction:\n-\n     template = ViewPageTemplateFile("templates/tags.pt")\n     order = 6\n \ndiff --git a/plone/app/content/browser/contents/workflow.py b/plone/app/content/browser/contents/workflow.py\nindex a2a90a0b..8b5a5bb3 100644\n--- a/plone/app/content/browser/contents/workflow.py\n+++ b/plone/app/content/browser/contents/workflow.py\n@@ -14,7 +14,6 @@\n \n @implementer(IStructureAction)\n class WorkflowAction:\n-\n     template = ViewPageTemplateFile("templates/workflow.pt")\n     order = 7\n \ndiff --git a/plone/app/content/browser/folderfactories.pt b/plone/app/content/browser/folderfactories.pt\nindex 7767a653..c2305f58 100644\n--- a/plone/app/content/browser/folderfactories.pt\n+++ b/plone/app/content/browser/folderfactories.pt\n@@ -1,74 +1,104 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<head>\n+  <head>\n     <metal:block fill-slot="top_slot"\n-                 tal:define="dummy python:request.set(\'disable_border\',1);\n-                             disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n-                             disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);" />\n-</head>\n+                 tal:define="\n+                   dummy python:request.set(\'disable_border\',1);\n+                   disable_column_one python:request.set(\'disable_plone.leftcolumn\',1);\n+                   disable_column_two python:request.set(\'disable_plone.rightcolumn\',1);\n+                 "\n+    />\n+  </head>\n \n-<body>\n+  <body>\n \n-<metal:main metal:fill-slot="main">\n+    <metal:main metal:fill-slot="main">\n \n-    <h1 class="documentFirstHeading" i18n:translate="heading_add_new_item">Add new item</h1>\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="heading_add_new_item"\n+      >Add new item</h1>\n \n-    <div class="documentDescription"\n-       i18n:translate="description_add_new_item">\n+      <div class="documentDescription"\n+           i18n:translate="description_add_new_item"\n+      >\n         Select the type of item you want to add to your folder.\n-    </div>\n+      </div>\n \n-    <div id="content-core">\n+      <div id="content-core">\n         <p tal:condition="view/can_constrain_types">\n-            <a href="#" title="Configure which content types can be added here"\n-                        i18n:attributes="title title_configure_addable_content_types;"\n-                        tal:define="add_context view/add_context"\n-                        tal:attributes="href string:${add_context/absolute_url}/folder_constraintypes_form;"\n-                        i18n:translate="folder_add_settings_long">\n+          <a href="#"\n+             title="Configure which content types can be added here"\n+             tal:define="\n+               add_context view/add_context;\n+             "\n+             tal:attributes="\n+               href string:${add_context/absolute_url}/folder_constraintypes_form;\n+             "\n+             i18n:attributes="title title_configure_addable_content_types;"\n+             i18n:translate="folder_add_settings_long"\n+          >\n                 Click to configure what type of items can be added here&hellip;\n-            </a>\n+          </a>\n         </p>\n \n         <metal:addlist define-macro="addlist">\n \n-            <form name="quickAdd" method="post"\n-                tal:attributes="action string:${context/absolute_url}/@@folder_factories">\n+          <form method="post"\n+                name="quickAdd"\n+                tal:attributes="\n+                  action string:${context/absolute_url}/@@folder_factories;\n+                "\n+          >\n \n-                <ul class="folder-factories">\n-                    <tal:typelist repeat="item view/addable_types">\n-                        <li>\n-                            <input type="radio" name="url"\n-                                   tal:attributes="value item/action;\n-                                                   id string:form-field-${item/extra/id}" />\n-                            <label tal:attributes="class string:contenttype-${item/extra/id};\n-                                                   for string:form-field-${item/extra/id};">\n-                                <img tal:attributes="src item/icon" alt="" />\n-                                <span tal:replace="item/title">Type title</span>\n-                            </label>\n-                            <span class="discreet" tal:content="item/description">Type description</span>\n-                        </li>\n-                    </tal:typelist>\n-                </ul>\n+            <ul class="folder-factories">\n+              <tal:typelist repeat="item view/addable_types">\n+                <li>\n+                  <input name="url"\n+                         type="radio"\n+                         tal:attributes="\n+                           value item/action;\n+                           id string:form-field-${item/extra/id};\n+                         "\n+                  />\n+                  <label tal:attributes="\n+                           class string:contenttype-${item/extra/id};\n+                           for string:form-field-${item/extra/id};\n+                         ">\n+                    <img alt=""\n+                         tal:attributes="\n+                           src item/icon;\n+                         "\n+                    />\n+                    <span tal:replace="item/title">Type title</span>\n+                  </label>\n+                  <span class="discreet"\n+                        tal:content="item/description"\n+                  >Type description</span>\n+                </li>\n+              </tal:typelist>\n+            </ul>\n \n-                <div class="formControls">\n-                    <input class="btn btn-primary"\n-                          type="submit"\n-                          value="Add"\n-                          name="form.button.Add"\n-                          i18n:attributes="value label_add"\n-                          />\n-                </div>\n-            </form>\n+            <div class="formControls">\n+              <input class="btn btn-primary"\n+                     name="form.button.Add"\n+                     type="submit"\n+                     value="Add"\n+                     i18n:attributes="value label_add"\n+              />\n+            </div>\n+          </form>\n         </metal:addlist>\n-    </div>\n+      </div>\n \n-</metal:main>\n+    </metal:main>\n \n-</body>\n+  </body>\n </html>\ndiff --git a/plone/app/content/browser/full_review_list.pt b/plone/app/content/browser/full_review_list.pt\nindex 25549e75..8fd2c8ec 100644\n--- a/plone/app/content/browser/full_review_list.pt\n+++ b/plone/app/content/browser/full_review_list.pt\n@@ -1,31 +1,40 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="here/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<metal:block fill-slot="top_slot"\n-             tal:define="dummy python:request.set(\'disable_border\',1)" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+               "\n+  />\n \n-<body>\n-  <metal:main fill-slot="main">\n-    <h1 class="documentFirstHeading"\n-        i18n:translate="heading_full_review_list">Full review list:</h1>\n+  <body>\n+    <metal:main fill-slot="main">\n+      <h1 class="documentFirstHeading"\n+          i18n:translate="heading_full_review_list"\n+      >Full review list:</h1>\n \n-    <div id="content-core">\n-        <form name="worklistForm"\n-                method="post"\n-                action="folder_object"\n-                tal:attributes="action context/absolute_url"\n-                tal:condition="view/revlist"\n-                class="kssattr-serveraction-reviewlist_update_table">\n-              <div tal:replace="structure view/review_table"></div>\n-              <input tal:replace="structure context/@@authenticator/authenticator" />\n+      <div id="content-core">\n+        <form class="kssattr-serveraction-reviewlist_update_table"\n+              action="folder_object"\n+              method="post"\n+              name="worklistForm"\n+              tal:condition="view/revlist"\n+              tal:attributes="\n+                action context/absolute_url;\n+              "\n+        >\n+          <div tal:replace="structure view/review_table"></div>\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n         </form>\n-    </div>\n+      </div>\n \n-  </metal:main>\n-</body>\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/plone/app/content/browser/i18n.py b/plone/app/content/browser/i18n.py\nindex 415508af..ebabfc1a 100644\n--- a/plone/app/content/browser/i18n.py\n+++ b/plone/app/content/browser/i18n.py\n@@ -35,7 +35,6 @@ def _gettext_catalog(self, domain, language):\n         return _catalog\n \n     def __call__(self, domain=None, language=None):\n-\n         if domain is None:\n             catalog = {}\n         else:\ndiff --git a/plone/app/content/browser/interfaces.py b/plone/app/content/browser/interfaces.py\nindex 4cdfc356..5f300c3e 100644\n--- a/plone/app/content/browser/interfaces.py\n+++ b/plone/app/content/browser/interfaces.py\n@@ -2,7 +2,7 @@\n \n \n class IFolderContentsView(Interface):\n-    """Interface, which provides methods for folder contens"""\n+    """Interface, which provides methods for folder contents"""\n \n     def test(a, b, c):\n         """A simple replacement of python\'s test."""\ndiff --git a/plone/app/content/browser/selection.py b/plone/app/content/browser/selection.py\nindex 1d5a7327..aaf5c566 100644\n--- a/plone/app/content/browser/selection.py\n+++ b/plone/app/content/browser/selection.py\n@@ -49,7 +49,9 @@ def __call__(self):\n             self.request.response.redirect(context_view_url)\n \n         if self.request.form.get("form.button.Save") and not template_id:\n-            IStatusMessage(self.request).add("Please select a template.", type="warning")\n+            IStatusMessage(self.request).add(\n+                "Please select a template.", type="warning"\n+            )\n \n         if self.request.form.get("form.button.Save") and template_id:\n             # Make sure this is a valid template\ndiff --git a/plone/app/content/browser/table.pt b/plone/app/content/browser/table.pt\nindex 5a79f199..939d107e 100644\n--- a/plone/app/content/browser/table.pt\n+++ b/plone/app/content/browser/table.pt\n@@ -1,175 +1,303 @@\n <div id="folderlisting-main-table"\n-     i18n:domain="plone">\n-  <input type="hidden" name="sort_on"\n-         tal:attributes="value request/sort_on|string:getObjPositionInParent"\n-         />\n-  <input type="hidden" name="pagenumber" tal:attributes="value view/batch/pagenumber"/>\n-  <input type="hidden" name="pagesize" tal:attributes="value view/batch/pagesize"/>\n-  <input type="hidden" name="show_all" tal:attributes="value view/show_all"/>\n-  <input type="hidden" name="orig_template" tal:attributes="value view/viewname"/>\n+     i18n:domain="plone"\n+>\n+  <input name="sort_on"\n+         type="hidden"\n+         tal:attributes="\n+           value request/sort_on|string:getObjPositionInParent;\n+         "\n+  />\n+  <input name="pagenumber"\n+         type="hidden"\n+         tal:attributes="\n+           value view/batch/pagenumber;\n+         "\n+  />\n+  <input name="pagesize"\n+         type="hidden"\n+         tal:attributes="\n+           value view/batch/pagesize;\n+         "\n+  />\n+  <input name="show_all"\n+         type="hidden"\n+         tal:attributes="\n+           value view/show_all;\n+         "\n+  />\n+  <input name="orig_template"\n+         type="hidden"\n+         tal:attributes="\n+           value view/viewname;\n+         "\n+  />\n   <tal:block condition="view/selectall">\n-    <input type="hidden" name="paths:list"\n+    <input name="paths:list"\n+           type="hidden"\n            tal:repeat="item view/batch/items_not_on_page"\n-           tal:attributes="value item/path|item/id|item/getId"/>\n+           tal:attributes="\n+             value item/path|item/id|item/getId;\n+           "\n+    />\n   </tal:block>\n \n   <p class="discreet"\n      tal:condition="not: view/batch"\n-     i18n:translate="description_no_visible_items_add_paste">\n+     i18n:translate="description_no_visible_items_add_paste"\n+  >\n     This folder has no visible items. To add content, press the\n     add button, or paste content from another location.\n   </p>\n \n   <metal:listing define-macro="folder_listing"\n-                 tal:define="nosortclass view/get_nosort_class">\n+                 tal:define="\n+                   nosortclass view/get_nosort_class;\n+                 "\n+  >\n \n-    <div class="visualClear" id="clear-space-before-navigation"><!-- --></div>\n+    <div class="visualClear"\n+         id="clear-space-before-navigation"\n+    ><!-- --></div>\n \n-    <div tal:replace="structure view/batching" tal:condition="not:view/show_all"/>\n+    <div tal:condition="not:view/show_all"\n+         tal:replace="structure view/batching"\n+    ></div>\n     <table class="table"\n            id="listing-table"\n            summary="Content listing"\n+           tal:condition="view/items"\n            i18n:attributes="summary summary_content_listing;"\n-           tal:condition="view/items">\n+    >\n       <thead>\n         <tr tal:condition="python:view.show_select_column and not view.selectcurrentbatch">\n-          <th colspan="6" class="nosort"><span i18n:translate="label_select" tal:omit-tag="">Select:</span> <a i18n:translate="label_all" tal:attributes="href view/selectscreen_url" id="foldercontents-selectall">All</a></th>\n+          <th class="nosort"\n+              colspan="6"\n+          ><span tal:omit-tag=""\n+                  i18n:translate="label_select"\n+            >Select:</span>\n+            <a id="foldercontents-selectall"\n+               tal:attributes="\n+                 href view/selectscreen_url;\n+               "\n+               i18n:translate="label_all"\n+            >All</a></th>\n         </tr>\n         <tr tal:condition="view/show_select_all_items">\n-          <th colspan="6" class="nosort">\n-            <span tal:omit-tag="" i18n:translate="tableheading_all_items_selected">\n-            All <tal:block replace="view/batch/items_on_page" i18n:name="count"/> items on this\n+          <th class="nosort"\n+              colspan="6"\n+          >\n+            <span tal:omit-tag=""\n+                  i18n:translate="tableheading_all_items_selected"\n+            >\n+            All\n+              <tal:block replace="view/batch/items_on_page"\n+                         i18n:name="count"\n+              />\n+               items on this\n             page are selected.\n             </span>\n-            <a tal:attributes="href view/selectall_url"\n-               id="foldercontents-selectall-completebatch"\n-               i18n:translate="tableheading_select_all_items">Select all\n-            <tal:block replace="view/batch/sequence_length" i18n:name="count"/> items in this folder.</a>\n+            <a id="foldercontents-selectall-completebatch"\n+               tal:attributes="\n+                 href view/selectall_url;\n+               "\n+               i18n:translate="tableheading_select_all_items"\n+            >Select all\n+              <tal:block replace="view/batch/sequence_length"\n+                         i18n:name="count"\n+              />\n+              items in this folder.</a>\n           </th>\n         </tr>\n         <tr tal:condition="view/selectall">\n-          <th colspan="6" class="nosort">\n-            <span tal:omit-tag="" i18n:translate="tableheading_all_items_selected_in_folder">\n-            All <tal:block replace="view/batch/sequence_length" i18n:name="count"/> items in this folder\n+          <th class="nosort"\n+              colspan="6"\n+          >\n+            <span tal:omit-tag=""\n+                  i18n:translate="tableheading_all_items_selected_in_folder"\n+            >\n+            All\n+              <tal:block replace="view/batch/sequence_length"\n+                         i18n:name="count"\n+              />\n+               items in this folder\n             are selected.\n             </span>\n-            <a tal:attributes="href view/selectnone_url"  i18n:translate="tableheading_clear_selection"\n-               id="foldercontents-clearselection">Clear selection</a>\n+            <a id="foldercontents-clearselection"\n+               tal:attributes="\n+                 href view/selectnone_url;\n+               "\n+               i18n:translate="tableheading_clear_selection"\n+            >Clear selection</a>\n           </th>\n         </tr>\n \n         <tr>\n           <th class="nosort column"\n               id="foldercontents-order-column"\n-              tal:condition="view/show_sort_column">\n+              tal:condition="view/show_sort_column"\n+          >\n           </th>\n           <th class="nosort"\n               id="foldercontents-select-column"\n-              tal:condition="view/show_select_column">&nbsp;</th>\n+              tal:condition="view/show_select_column"\n+          >&nbsp;</th>\n           <th class="nosort column"\n-              id="foldercontents-title-column">&nbsp;<tal:title i18n:translate="listingheader_title"\n-              >Title</tal:title>&nbsp;</th>\n+              id="foldercontents-title-column"\n+          >&nbsp;<tal:title i18n:translate="listingheader_title">Title</tal:title>&nbsp;</th>\n           <th class="nosort column"\n               id="foldercontents-size-column"\n-              tal:condition="view/show_size_column">&nbsp;<tal:size i18n:translate="listingheader_size"\n-              >Size</tal:size>&nbsp;</th>\n+              tal:condition="view/show_size_column"\n+          >&nbsp;<tal:size i18n:translate="listingheader_size">Size</tal:size>&nbsp;</th>\n           <th class="nosort column"\n               id="foldercontents-modified-column"\n-              tal:condition="view/show_modified_column">&nbsp;<tal:modified i18n:translate="listingheader_modified"\n-              >Modified</tal:modified>&nbsp;</th>\n+              tal:condition="view/show_modified_column"\n+          >&nbsp;<tal:modified i18n:translate="listingheader_modified">Modified</tal:modified>&nbsp;</th>\n           <th class="nosort column"\n               id="foldercontents-status-column"\n-              tal:condition="view/show_status_column">&nbsp;<tal:state i18n:translate="listingheader_status"\n-              >State</tal:state>&nbsp;</th>\n+              tal:condition="view/show_status_column"\n+          >&nbsp;<tal:state i18n:translate="listingheader_status">State</tal:state>&nbsp;</th>\n         </tr>\n       </thead>\n \n       <metal:block tal:condition="view/batch">\n         <tbody>\n           <tal:items tal:repeat="item view/batch">\n-            <tr  tal:define="id item/id|item/getId;\n-                             title item/title|item/Title|item/title_or_id;\n-                             title_or_id python:title or id;"\n-                 tal:attributes="class item/table_row_class;\n-                                id string:folder-contents-item-${id};">\n+            <tr tal:define="\n+                  id item/id|item/getId;\n+                  title item/title|item/Title|item/title_or_id;\n+                  title_or_id python:title or id;\n+                "\n+                tal:attributes="\n+                  class item/table_row_class;\n+                  id string:folder-contents-item-${id};\n+                "\n+            >\n \n-              <td tal:condition="view/show_sort_column" class="draggable">\n-               <tal:block tal:define="quoted_id python:view.quote_plus(id);\n-                                      quoted_id item/quoted_id|quoted_id;">\n-                <a href=""\n-                   title="Move item up"\n-                   i18n:attributes="title title_move_item_up;"\n-                   tal:attributes="href string:${view/base_url}/folder_position?position=up&amp;id=${quoted_id}">\n+              <td class="draggable"\n+                  tal:condition="view/show_sort_column"\n+              >\n+                <tal:block tal:define="\n+                             quoted_id python:view.quote_plus(id);\n+                             quoted_id item/quoted_id|quoted_id;\n+                           ">\n+                  <a href=""\n+                     title="Move item up"\n+                     tal:attributes="\n+                       href string:${view/base_url}/folder_position?position=up&amp;id=${quoted_id};\n+                     "\n+                     i18n:attributes="title title_move_item_up;"\n+                  >\n                   &#9650;\n-                </a>\n+                  </a>\n                 &nbsp;\n-                <a href=""\n-                   title="Move item down"\n-                   i18n:attributes="title title_move_item_down;"\n-                   tal:attributes="href string:${view/base_url}/folder_position?position=down&amp;id=${quoted_id}">\n+                  <a href=""\n+                     title="Move item down"\n+                     tal:attributes="\n+                       href string:${view/base_url}/folder_position?position=down&amp;id=${quoted_id};\n+                     "\n+                     i18n:attributes="title title_move_item_down;"\n+                  >\n                   &#9660;\n-                </a>\n-               </tal:block>\n+                  </a>\n+                </tal:block>\n               </td>\n-              <td tal:condition="view/show_select_column" class="notDraggable">\n-                <input type="checkbox"\n-                       class="noborder"\n-                       name="paths:list" id="#"\n+              <td class="notDraggable"\n+                  tal:condition="view/show_select_column"\n+              >\n+                <input class="noborder"\n+                       id="#"\n+                       name="paths:list"\n+                       type="checkbox"\n+                       value="#"\n+                       tal:attributes="\n+                         value   item/path|id;\n+                         id      string:cb_${id};\n+                         checked item/checked;\n+                         alt     python:view.msg_select_item(item);\n+                         title   python:view.msg_select_item(item);\n+                       "\n+                />\n+                <input name="selected_obj_paths:list"\n+                       type="hidden"\n                        value="#"\n-                       tal:attributes="value   item/path|id;\n-                                       id      string:cb_${id};\n-                                       checked item/checked;\n-                                       alt     python:view.msg_select_item(item);\n-                                       title   python:view.msg_select_item(item)" />\n-                <input type="hidden" name="selected_obj_paths:list" value="#"\n-                       tal:attributes="value item/path|id" />\n-                <label tal:content="title_or_id"\n-                       tal:attributes="for string:cb_${id}"\n-                       class="hiddenStructure">\n+                       tal:attributes="\n+                         value item/path|id;\n+                       "\n+                />\n+                <label class="hiddenStructure"\n+                       tal:content="title_or_id"\n+                       tal:attributes="\n+                         for string:cb_${id};\n+                       "\n+                >\n                   Item Title\n                 </label>\n               </td>\n               <td>\n-                  <img tal:replace="structure item/icon|nothing" />\n-                  <a href="#" tal:define="state_class item/state_class|string:;\n-                                          type_class item/type_class|string:;"\n-                              tal:attributes="href  item/view_url|string:${view/base_url}/${id};\n-                                              title item/url_href_title|nothing;\n-                                              class string: ${state_class} ${type_class};">\n-                    <strong tal:omit-tag="not: item/is_browser_default|nothing"\n-                            tal:content="title_or_id"/>\n-                    <span class="defaultView"\n-                          tal:condition="item/is_browser_default|nothing"\n-                          title="Default view for this folder"\n-                          i18n:attributes="title title_default_view_for_this_folder;"\n-                          style="color: #f00;">\n+                <img tal:replace="structure item/icon|nothing" />\n+                <a href="#"\n+                   tal:define="\n+                     state_class item/state_class|string:;\n+                     type_class item/type_class|string:;\n+                   "\n+                   tal:attributes="\n+                     href  item/view_url|string:${view/base_url}/${id};\n+                     title item/url_href_title|nothing;\n+                     class string: ${state_class} ${type_class};\n+                   "\n+                >\n+                  <strong tal:content="title_or_id"\n+                          tal:omit-tag="not: item/is_browser_default|nothing"\n+                  ></strong>\n+                  <span class="defaultView"\n+                        style="color: #f00;"\n+                        title="Default view for this folder"\n+                        tal:condition="item/is_browser_default|nothing"\n+                        i18n:attributes="title title_default_view_for_this_folder;"\n+                  >\n                       &#x25a0;\n-                    </span>\n-                  </a>\n+                  </span>\n+                </a>\n \n                 <span class="state-expired"\n                       tal:condition="item/is_expired|nothing"\n-                      i18n:translate="time_expired">expired</span>\n+                      i18n:translate="time_expired"\n+                >expired</span>\n               </td>\n \n               <td tal:condition="view/show_size_column">\n-                <span tal:condition="not: item/size"> &nbsp; </span>\n+                <span tal:condition="not: item/size">\n+                  &nbsp;\n+                </span>\n                 <span tal:condition="item/size"\n                       tal:content="item/size"\n-                      tal:attributes="class item/state_class|nothing"> size </span>\n+                      tal:attributes="\n+                        class item/state_class|nothing;\n+                      "\n+                >\n+                  size\n+                </span>\n               </td>\n-              <td tal:condition="view/show_modified_column"\n+              <td tal:define="\n+                    state_class item/state_class|string:;\n+                    modified_sortable item/modified_sortable|string:;\n+                  "\n+                  tal:condition="view/show_modified_column"\n                   tal:content="item/modified"\n-                  tal:define="state_class item/state_class|string:;\n-                              modified_sortable item/modified_sortable|string:;"\n-                  tal:attributes="class string:${state_class} ${modified_sortable}">\n+                  tal:attributes="\n+                    class string:${state_class} ${modified_sortable};\n+                  "\n+              >\n                 08/19/2001 03:01 AM\n               </td>\n               <td tal:condition="view/show_status_column">\n-                <span i18n:translate=""\n-                      tal:condition="item/state_title|nothing"\n+                <span tal:condition="item/state_title|nothing"\n                       tal:content="item/state_title"\n-                      tal:attributes="class item/state_class|nothing" />\n+                      tal:attributes="\n+                        class item/state_class|nothing;\n+                      "\n+                      i18n:translate=""\n+                ></span>\n                 <span tal:condition="not: item/state_title|nothing">&nbsp;</span>\n               </td>\n             </tr>\n@@ -177,30 +305,47 @@\n         </tbody>\n         <tfoot tal:condition="not:view/within_batch_size">\n           <tr tal:condition="not:view/show_all">\n-            <th colspan="6" class="nosort">\n-              <a tal:attributes="href view/show_all_url"\n+            <th class="nosort"\n+                colspan="6"\n+            >\n+              <a id="foldercontents-show-all"\n+                 tal:attributes="\n+                   href view/show_all_url;\n+                 "\n                  i18n:translate="label_show_all"\n-                 id="foldercontents-show-all">Show all items</a>\n+              >Show all items</a>\n             </th>\n           </tr>\n           <tr tal:condition="view/show_all">\n-            <th colspan="6" class="nosort">\n-              <a tal:attributes="href view/view_url"\n+            <th class="nosort"\n+                colspan="6"\n+            >\n+              <a id="foldercontents-show-batched"\n+                 tal:attributes="\n+                   href view/view_url;\n+                 "\n                  i18n:translate="label_show_batched"\n-                 id="foldercontents-show-batched">Show batched</a>\n+              >Show batched</a>\n             </th>\n           </tr>\n         </tfoot>\n       </metal:block>\n     </table>\n-    <div tal:replace="structure view/batching" tal:condition="not:view/show_all"/>\n+    <div tal:condition="not:view/show_all"\n+         tal:replace="structure view/batching"\n+    ></div>\n     <tal:buttons tal:repeat="button view/buttons">\n       <input class="btn btn-primary"\n-             type="submit"\n              name=""\n+             type="submit"\n              value=""\n+             tal:attributes="\n+               value button/title;\n+               name button/url;\n+               class button/cssclass|nothing;\n+             "\n              i18n:attributes="value"\n-             tal:attributes="value button/title; name button/url; class button/cssclass|nothing" />\n+      />\n     </tal:buttons>\n   </metal:listing>\n </div>\ndiff --git a/plone/app/content/browser/table.txt b/plone/app/content/browser/table.txt\nindex f3337872..ae906a27 100644\n--- a/plone/app/content/browser/table.txt\n+++ b/plone/app/content/browser/table.txt\n@@ -3,7 +3,7 @@ Table\n =====\n \n The table class can render a table like used in the folder contents view. It is\n-abstracted into a seperate class for reuse with other views like the review\n+abstracted into a separate class for reuse with other views like the review\n list.\n \n A table can be parameterized at creation time.\n@@ -31,11 +31,11 @@ One of the table\'s main virtues is that it batches. A template can use the\n   True\n \n The table automatically adds keys for making layout easier. One of these is\n-indication wheter an item is `checked`.\n+indication whether an item is `checked`.\n \n   >>> list(table.batch)[0][\'checked\']\n \n-Wheter or not an item is checked depends on request variables. If either the\n+Whether or not an item is checked depends on request variables. If either the\n whole batch or the current screen is selected the item we be marked as checked.\n Below we will demonstrate this by selecting the items on screen.\n \n@@ -129,8 +129,8 @@ The same goes for selecting the screen and the whole batch.\n   \'http://plone/view?pagenumber=1&pagesize=20&select=all\'\n \n A template may want to display only one of these urls at the same time.\n-Therefore the table has a boolean property to query wheter or not to show the\n-select all option. The display of this depends on wheter the whole batch is\n+Therefore the table has a boolean property to query whether or not to show the\n+select all option. The display of this depends on whether the whole batch is\n selected (don\'t show) or the screen has not been selected (don\'t show then).\n \n   >>> table = Table({}, base_url, view_url, items=items)\ndiff --git a/plone/app/content/browser/templates/content_status_history.pt b/plone/app/content/browser/templates/content_status_history.pt\nindex 6edd7a9d..ed967ddf 100644\n--- a/plone/app/content/browser/templates/content_status_history.pt\n+++ b/plone/app/content/browser/templates/content_status_history.pt\n@@ -1,384 +1,529 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n       lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n   <metal:block fill-slot="top_slot">\n-    <metal:block tal:define="dummy python:request.RESPONSE.setHeader(\'Cache-Control\', \'no-cache, no-store, must-revalidate, post-check=0, pre-check=0\');\n-                             dummy python:request.set(\'enable_border\', 1);" />\n+    <metal:block tal:define="\n+                   dummy python:request.RESPONSE.setHeader(\'Cache-Control\', \'no-cache, no-store, must-revalidate, post-check=0, pre-check=0\');\n+                   dummy python:request.set(\'enable_border\', 1);\n+                 " />\n   </metal:block>\n \n   <metal:calendar fill-slot="javascript_head_slot">\n-    <style type="text/css" media="all"\n-            tal:content="string:@import url(${portal_url}/jscalendar/calendar-system.css);"></style>\n+    <style media="all"\n+           type="text/css"\n+           tal:content="string:@import url(${portal_url}/jscalendar/calendar-system.css);"\n+    ></style>\n     <script type="text/javascript"\n-            tal:attributes="src string:${portal_url}/jscalendar/calendar_stripped.js"></script>\n-    <script type="text/javascript" charset="iso-8859-1"\n+            tal:attributes="\n+              src string:${portal_url}/jscalendar/calendar_stripped.js;\n+            "\n+    ></script>\n+    <script charset="iso-8859-1"\n+            type="text/javascript"\n             tal:condition="exists: context/jscalendar/calendar-en.js"\n-            tal:attributes="src string:${portal_url}/jscalendar/calendar-en.js"></script>\n+            tal:attributes="\n+              src string:${portal_url}/jscalendar/calendar-en.js;\n+            "\n+    ></script>\n   </metal:calendar>\n \n   <body>\n \n     <tal:comment tal:condition="nothing">\n-      <div class="portalMessage info" role="status">\n-        <strong>Note</strong>\n-        <span>This form is used in two different ways - from folder_contents,\n+      <div class="portalMessage info"\n+           role="status"\n+      >\n+        <strong i18n:translate="">Note</strong>\n+        <span i18n:translate="">This form is used in two different ways - from folder_contents,\n         allowing you to publish several things at once, and from the state\n         drop-down. In the first case, the \'paths\' request parameter is set;\n         in the second case, giving the relative paths to the content object\n         to manipulate; in the second case, this parameter is omitted and the\n-        path of the context is used.</span>\n+          path of the context is used.</span>\n       </div>\n     </tal:comment>\n \n-      <metal:main fill-slot="main"\n-           tal:define="errors view/errors;\n-                       review_state context_state/workflow_state;\n-                       paths python:request.get(\'paths\', [\'/\'.join(context.getPhysicalPath())]);\n-                       batch python:view.get_objects_from_path_list(paths);\n-                       folders_in_publishing python:[o.getId for o in batch if o.isPrincipiaFolderish];\n-                       came_from python:request.get(\'HTTP_REFERER\', context.absolute_url()).split(\'?\')[0];\n-                       dummy python:request.set(\'orig_template\', came_from);\n-                     ">\n+    <metal:main fill-slot="main"\n+                tal:define="\n+                  errors view/errors;\n+                  review_state context_state/workflow_state;\n+                  paths python:request.get(\'paths\', [\'/\'.join(context.getPhysicalPath())]);\n+                  batch python:view.get_objects_from_path_list(paths);\n+                  folders_in_publishing python:[o.getId for o in batch if o.isPrincipiaFolderish];\n+                  came_from python:request.get(\'HTTP_REFERER\', context.absolute_url()).split(\'?\')[0];\n+                  dummy python:request.set(\'orig_template\', came_from);\n+                "\n+    >\n       <metal:block tal:condition="python: paths and not batch"\n-                   tal:replace="view/redirect_to_referrer"/>\n+                   tal:replace="view/redirect_to_referrer"\n+      />\n \n       <h1 class="documentFirstHeading"\n-          i18n:translate="heading_publishing_process">Publishing process</h1>\n+          i18n:translate="heading_publishing_process"\n+      >Publishing process</h1>\n \n-      <div class="documentDescription" i18n:translate="description_publishing_process_short">\n+      <div class="documentDescription"\n+           i18n:translate="description_publishing_process_short"\n+      >\n         An item\'s status (also called its review state) determines who\n         can see it. Another way to control the visibility of an item is\n-        with its <em class="discreet">Publishing Date</em>. An item is not publicly\n+        with its\n+        <em class="discreet">Publishing Date</em>. An item is not publicly\n         searchable before its publishing date. This will prevent the item\n         from showing up in portlets and folder listings, although the item\n         will still be available if accessed directly via its URL.\n       </div>\n \n       <div id="content-core">\n-          <form id="edit_form"\n-                class="enableAutoFocus"\n-                name="edit_form"\n-                method="post"\n-                action="content_status_modify"\n-                tal:attributes="action string:${context_state/object_url}/${view/__name__}"\n-                tal:condition="not:python:paths and not batch">\n-\n-              <div class="field" tal:condition="batch"\n-                   tal:define="error errors/paths | nothing;"\n-                   tal:attributes="class python:error and \'field error\' or \'field\'">\n-                <label i18n:translate="label_affected_content">Affected content</label>\n-                <div tal:content="error">Validation error output</div>\n-                <div tal:define="dummy python:request.set(\'ids_checked\', 1);\n-                                 use_view_action python:context.portal_registry.get(\'plone.types_use_view_action_in_listings\', ());">\n-                  <table id="sortable"\n-                         class="listing"\n-                         summary="Affected content"\n-                         i18n:attributes="summary summary_affected_content;">\n-                    <thead>\n-                      <metal:block tal:condition="batch|nothing">\n-                        <tr>\n-                          <th class="nosort">\n-                              <input class="noborder"\n-                                     type="checkbox"\n-                                     name="selectButton"\n-                                     title="Select all items"\n-                                     onClick="toggleSelect(this,\'paths:list\');"\n-                                     alt="Select all items"\n-                                     i18n:attributes="title label_select_all_items; alt label_select_all_items;"\n-                          />\n-                          </th>\n-                          <th class="nosort" i18n:translate="listingheader_title">\n+        <form class="enableAutoFocus"\n+              id="edit_form"\n+              action="content_status_modify"\n+              method="post"\n+              name="edit_form"\n+              tal:condition="not:python:paths and not batch"\n+              tal:attributes="\n+                action string:${context_state/object_url}/${view/__name__};\n+              "\n+        >\n+\n+          <div class="field"\n+               tal:define="\n+                 error errors/paths | nothing;\n+               "\n+               tal:condition="batch"\n+               tal:attributes="\n+                 class python:error and \'field error\' or \'field\';\n+               "\n+          >\n+            <label i18n:translate="label_affected_content">Affected content</label>\n+            <div tal:content="error">Validation error output</div>\n+            <div tal:define="\n+                   dummy python:request.set(\'ids_checked\', 1);\n+                   use_view_action python:context.portal_registry.get(\'plone.types_use_view_action_in_listings\', ());\n+                 ">\n+              <table class="listing"\n+                     id="sortable"\n+                     summary="Affected content"\n+                     i18n:attributes="summary summary_affected_content;"\n+              >\n+                <thead>\n+                  <metal:block tal:condition="batch|nothing">\n+                    <tr>\n+                      <th class="nosort">\n+                        <input class="noborder"\n+                               alt="Select all items"\n+                               name="selectButton"\n+                               onclick="toggleSelect(this,\'paths:list\');"\n+                               title="Select all items"\n+                               type="checkbox"\n+                               i18n:attributes="title label_select_all_items; alt label_select_all_items;"\n+                        />\n+                      </th>\n+                      <th class="nosort"\n+                          i18n:translate="listingheader_title"\n+                      >\n                             Title\n-                          </th>\n-                          <th class="nosort" i18n:translate="listingheader_size">\n+                      </th>\n+                      <th class="nosort"\n+                          i18n:translate="listingheader_size"\n+                      >\n                               Size\n-                          </th>\n-                          <th class="nosort" i18n:translate="listingheader_modified">\n+                      </th>\n+                      <th class="nosort"\n+                          i18n:translate="listingheader_modified"\n+                      >\n                               Modified\n-                          </th>\n-                          <th class="nosort" i18n:translate="listingheader_status">\n+                      </th>\n+                      <th class="nosort"\n+                          i18n:translate="listingheader_status"\n+                      >\n                               State\n-                          </th>\n-                        </tr>\n-                      </metal:block>\n-                    </thead>\n-\n-                    <metal:block tal:condition="batch|nothing">\n-                    <tbody tal:define="portal portal_state/portal;\n-                                       url_tool context/@@plone_tools/url;\n-                                       getRelativeContentURL nocall:url_tool/getRelativeContentURL;\n-                                       normalizeString nocall:plone_view/normalizeString;\n-                                       wtool portal/portal_workflow;\n-                                       ">\n-                        <tal:items tal:repeat="item batch">\n-                           <tr tal:define="oddrow               repeat/item/odd;\n-                                           item_url             item/getURL|item/absolute_url;\n-                                           item_id              item/getId;\n-                                           item_path            item/getPath|python:\'/\'.join(item.getPhysicalPath());\n-                                           item_title_or_id     item/pretty_title_or_id;\n-                                           item_description     item/Description;\n-                                           item_type            item/portal_type;\n-                                           item_size            python:plone_view.human_readable_size(item.get_size());\n-                                           item_modified        item/ModificationDate;\n-                                           item_type_class      python:\'contenttype-\' + normalizeString(item_type);\n-                                           item_wf_state        item/review_state|python: wtool.getInfoFor(item, \'review_state\', \'\');\n-                                           item_state_title     python:wtool.getTitleForStateOnType(item_wf_state, item_type);\n-                                           item_wf_state_class  python:\'state-\' + normalizeString(item_wf_state);\n-                                           item_use_view        python:item_type in use_view_action;\n-                                           hasGetUrl            python:hasattr(item.aq_explicit, \'getURL\');\n-                                           item_rel_url         python:hasGetUrl and item.getURL(relative=1) or getRelativeContentURL(item);\n-                                           browserDefaultResult context/browserDefault;\n-                                           isBrowserDefault     python:len(browserDefaultResult[1]) == 1 and item.id == context.browserDefault()[1][0];\n-                                           item_folderish       item/is_folderish|nothing;\n-                                           item_has_image       python:item.getIcon"\n-                               tal:attributes="class python:oddrow and \'draggable even\' or \'draggable odd\';\n-                                               id string:folder-contents-item-${item_id};" >\n-\n-                               <td class="notDraggable">\n-                                   <input type="checkbox"\n-                                          class="noborder"\n-                                          name="paths:list" id="#"\n-                                          value="#"\n-                                          tal:attributes="value   item_path;\n-                                                          id      string:cb_$item_id;\n-                                                          checked python:request.get(\'ids_checked\', False) and \'checked\' or None;\n-                                                          alt     string:Select $item_title_or_id;\n-                                                          title   string:Select $item_title_or_id" />\n-                              <input type="hidden" name="obj_paths:list" value="#"\n-                                     tal:attributes="value item_rel_url" />\n-                              <input type="hidden" name="orig_paths:list" value="#"\n-                                     tal:attributes="value item_path" />\n-\n-                            </td>\n-                            <td tal:define="url python:item_use_view and item_url+\'/view\' or\n-                                            (item_folderish and item_url+\'/folder_contents\'or item_url+\'/\');">\n-                                <img class="thumb-tile"\n-                                     tal:define="getIcon string:$item_url/@@images/image/tile\'"\n-                                     tal:condition="item_has_image"\n-                                     tal:attributes="src  string:$getIcon">\n-                                    <a href="#" tal:attributes="href  url;\n-                                                              title string:$item_type: $item_description;\n-                                                              class string:$item_wf_state_class $item_type_class;">\n-                                        <strong tal:omit-tag="python:not isBrowserDefault">\n-                                        <label tal:content="item_title_or_id"\n-                                               tal:attributes="for string:cb_$item_id">\n+                      </th>\n+                    </tr>\n+                  </metal:block>\n+                </thead>\n+\n+                <metal:block tal:condition="batch|nothing">\n+                  <tbody tal:define="\n+                           portal portal_state/portal;\n+                           url_tool context/@@plone_tools/url;\n+                           getRelativeContentURL nocall:url_tool/getRelativeContentURL;\n+                           normalizeString nocall:plone_view/normalizeString;\n+                           wtool portal/portal_workflow;\n+                         ">\n+                    <tal:items tal:repeat="item batch">\n+                      <tr tal:define="\n+                            oddrow               repeat/item/odd;\n+                            item_url             item/getURL|item/absolute_url;\n+                            item_id              item/getId;\n+                            item_path            item/getPath|python:\'/\'.join(item.getPhysicalPath());\n+                            item_title_or_id     item/pretty_title_or_id;\n+                            item_description     item/Description;\n+                            item_type            item/portal_type;\n+                            item_size            python:plone_view.human_readable_size(item.get_size());\n+                            item_modified        item/ModificationDate;\n+                            item_type_class      python:\'contenttype-\' + normalizeString(item_type);\n+                            item_wf_state        item/review_state|python: wtool.getInfoFor(item, \'review_state\', \'\');\n+                            item_state_title     python:wtool.getTitleForStateOnType(item_wf_state, item_type);\n+                            item_wf_state_class  python:\'state-\' + normalizeString(item_wf_state);\n+                            item_use_view        python:item_type in use_view_action;\n+                            hasGetUrl            python:hasattr(item.aq_explicit, \'getURL\');\n+                            item_rel_url         python:hasGetUrl and item.getURL(relative=1) or getRelativeContentURL(item);\n+                            browserDefaultResult context/browserDefault;\n+                            isBrowserDefault     python:len(browserDefaultResult[1]) == 1 and item.id == context.browserDefault()[1][0];\n+                            item_folderish       item/is_folderish|nothing;\n+                            item_has_image       python:item.getIcon;\n+                          "\n+                          tal:attributes="\n+                            class python:oddrow and \'draggable even\' or \'draggable odd\';\n+                            id string:folder-contents-item-${item_id};\n+                          "\n+                      >\n+\n+                        <td class="notDraggable">\n+                          <input class="noborder"\n+                                 id="#"\n+                                 name="paths:list"\n+                                 type="checkbox"\n+                                 value="#"\n+                                 tal:attributes="\n+                                   value   item_path;\n+                                   id      string:cb_$item_id;\n+                                   checked python:request.get(\'ids_checked\', False) and \'checked\' or None;\n+                                   alt     string:Select $item_title_or_id;\n+                                   title   string:Select $item_title_or_id;\n+                                 "\n+                          />\n+                          <input name="obj_paths:list"\n+                                 type="hidden"\n+                                 value="#"\n+                                 tal:attributes="\n+                                   value item_rel_url;\n+                                 "\n+                          />\n+                          <input name="orig_paths:list"\n+                                 type="hidden"\n+                                 value="#"\n+                                 tal:attributes="\n+                                   value item_path;\n+                                 "\n+                          />\n+\n+                        </td>\n+                        <td tal:define="\n+                              url python:item_use_view and item_url+\'/view\' or\n+                                            (item_folderish and item_url+\'/folder_contents\'or item_url+\'/\');\n+                            ">\n+                          <img class="thumb-tile"\n+                               tal:define="\n+                                 getIcon string:$item_url/@@images/image/tile\';\n+                               "\n+                               tal:condition="item_has_image"\n+                               tal:attributes="\n+                                 src  string:$getIcon;\n+                               "\n+                          />\n+                          <a href="#"\n+                             tal:attributes="\n+                               href  url;\n+                               title string:$item_type: $item_description;\n+                               class string:$item_wf_state_class $item_type_class;\n+                             "\n+                          >\n+                            <strong tal:omit-tag="python:not isBrowserDefault">\n+                              <label tal:content="item_title_or_id"\n+                                     tal:attributes="\n+                                       for string:cb_$item_id;\n+                                     "\n+                              >\n                                           Item Title\n-                                        </label>\n-                                        </strong>\n-                                    </a>\n-\n-                                <span class="state-expired"\n-                                      tal:condition="python:view.isExpired(item)"\n-                                      i18n:translate="time_expired">expired</span>\n-                            </td>\n-\n-                            <td>\n-                              <span tal:condition="not: item_size"> &nbsp; </span>\n-                              <span tal:condition="python:item_size"\n-                                    tal:content="item_size"\n-                                    tal:attributes="class item_wf_state_class"> size </span>\n-                            </td>\n-                            <td tal:define="toLocalizedTime nocall:plone_view/toLocalizedTime;"\n-                                tal:content="python:toLocalizedTime(item_modified, long_format=1)"\n-                                tal:attributes="class item_wf_state_class">\n+                              </label>\n+                            </strong>\n+                          </a>\n+\n+                          <span class="state-expired"\n+                                tal:condition="python:view.isExpired(item)"\n+                                i18n:translate="time_expired"\n+                          >expired</span>\n+                        </td>\n+\n+                        <td>\n+                          <span tal:condition="not: item_size">\n+                            &nbsp;\n+                          </span>\n+                          <span tal:condition="python:item_size"\n+                                tal:content="item_size"\n+                                tal:attributes="\n+                                  class item_wf_state_class;\n+                                "\n+                          >\n+                            size\n+                          </span>\n+                        </td>\n+                        <td tal:define="\n+                              toLocalizedTime nocall:plone_view/toLocalizedTime;\n+                            "\n+                            tal:content="python:toLocalizedTime(item_modified, long_format=1)"\n+                            tal:attributes="\n+                              class item_wf_state_class;\n+                            "\n+                        >\n                                 08/19/2001 03:01 AM\n-                            </td>\n-                            <td>\n-                                <span i18n:translate=""\n-                                      tal:condition="item_state_title"\n-                                      tal:content="item_state_title"\n-                                      tal:attributes="class item_wf_state_class" />\n-                                <span tal:condition="not: item_state_title">&nbsp;</span>\n-                            </td>\n-                           </tr>\n-                        </tal:items>\n-                    </tbody>\n-                    </metal:block>\n-\n-                  </table>\n-                </div>\n-              </div>\n-\n-              <div class="field formSingleCheckbox"\n-                   tal:condition="folders_in_publishing|nothing">\n-\n-                <input type="checkbox"\n-                       class="formElement"\n-                       id="include_children"\n-                       name="include_children"\n-                       />\n-                <label for="include_children" i18n:translate="label_include_contained_objects">\n+                        </td>\n+                        <td>\n+                          <span tal:condition="item_state_title"\n+                                tal:content="item_state_title"\n+                                tal:attributes="\n+                                  class item_wf_state_class;\n+                                "\n+                                i18n:translate=""\n+                          ></span>\n+                          <span tal:condition="not: item_state_title">&nbsp;</span>\n+                        </td>\n+                      </tr>\n+                    </tal:items>\n+                  </tbody>\n+                </metal:block>\n+\n+              </table>\n+            </div>\n+          </div>\n+\n+          <div class="field formSingleCheckbox"\n+               tal:condition="folders_in_publishing|nothing"\n+          >\n+\n+            <input class="formElement"\n+                   id="include_children"\n+                   name="include_children"\n+                   type="checkbox"\n+            />\n+            <label for="include_children"\n+                   i18n:translate="label_include_contained_objects"\n+            >\n                   Include contained items\n-                </label>\n+            </label>\n \n-                <div class="formHelp"\n-                     i18n:translate="help_include_contained_objects">\n+            <div class="formHelp"\n+                 i18n:translate="help_include_contained_objects"\n+            >\n                   If checked, this will attempt to modify the status of all content\n                   in any selected folders and their subfolders.\n-                </div>\n-\n-              </div>\n-\n-              <div class="field" tal:define="error errors/effective_date | nothing;">\n-                <label i18n:translate="label_effective_date">Publishing Date</label>\n-                <div class="formHelp"\n-                     i18n:translate="help_effective_date_content_status_history">\n+            </div>\n+\n+          </div>\n+\n+          <div class="field"\n+               tal:define="\n+                 error errors/effective_date | nothing;\n+               "\n+          >\n+            <label i18n:translate="label_effective_date">Publishing Date</label>\n+            <div class="formHelp"\n+                 i18n:translate="help_effective_date_content_status_history"\n+            >\n                   The date when the item will be published. If no date is selected the\n                   item will be published immediately.\n-                </div>\n-\n-                <div tal:content="error">Validation error output</div>\n-\n-                <div tal:define="inputname  string:effective_date;\n-                                 formname   string:edit_form;\n-                                 effective python:request.get(\'paths\') and None or context.EffectiveDate() ;\n-                                 inputvalue python:(effective and effective!=\'None\') and effective or request.get(\'effective_date\', \'\');"\n-                     tal:attributes="class python:error and \'field error\' or \'field\'">\n-\n-                    <div tal:replace="structure python: view.dates_form.widgets[\'effective_date\'].render()">\n+            </div>\n+\n+            <div tal:content="error">Validation error output</div>\n+\n+            <div tal:define="\n+                   inputname  string:effective_date;\n+                   formname   string:edit_form;\n+                   effective python:request.get(\'paths\') and None or context.EffectiveDate();\n+                   inputvalue python:(effective and effective!=\'None\') and effective or request.get(\'effective_date\', \'\');\n+                 "\n+                 tal:attributes="\n+                   class python:error and \'field error\' or \'field\';\n+                 "\n+            >\n+\n+              <div tal:replace="structure python: view.dates_form.widgets[\'effective_date\'].render()">\n                       calendar pop-up\n-                    </div>\n-\n-                </div>\n               </div>\n \n-              <div class="field"\n-                   tal:define="error errors/expiration_date | nothing;">\n-                <label i18n:translate="label_expiration_date">Expiration Date</label>\n-                <div class="formHelp"\n-                     i18n:translate="help_expiration_date_content_status_history">\n+            </div>\n+          </div>\n+\n+          <div class="field"\n+               tal:define="\n+                 error errors/expiration_date | nothing;\n+               "\n+          >\n+            <label i18n:translate="label_expiration_date">Expiration Date</label>\n+            <div class="formHelp"\n+                 i18n:translate="help_expiration_date_content_status_history"\n+            >\n                   The date when the item expires. This will automatically\n                   make the item invisible for others at the given date.\n                   If no date is chosen, it will never expire.\n-                </div>\n-\n-                <div tal:content="error">Validation error output</div>\n-\n-                <div class="field">\n-                  <div tal:define="inputname  string:expiration_date;\n-                                   formname   string:edit_form;\n-                                   expiration context/ExpirationDate;\n-                                   inputvalue python:(expiration and expiration!=\'None\') and expiration or request.get(\'expiration_date\', \'\');"\n-                       tal:attributes="class python:error and \'field error\' or \'field\'">\n-\n-                    <div tal:replace="structure python: view.dates_form.widgets[\'expiration_date\'].render()">\n+            </div>\n+\n+            <div tal:content="error">Validation error output</div>\n+\n+            <div class="field">\n+              <div tal:define="\n+                     inputname  string:expiration_date;\n+                     formname   string:edit_form;\n+                     expiration context/ExpirationDate;\n+                     inputvalue python:(expiration and expiration!=\'None\') and expiration or request.get(\'expiration_date\', \'\');\n+                   "\n+                   tal:attributes="\n+                     class python:error and \'field error\' or \'field\';\n+                   "\n+              >\n+\n+                <div tal:replace="structure python: view.dates_form.widgets[\'expiration_date\'].render()">\n                       calendar pop-up\n-                    </div>\n-                  </div>\n                 </div>\n               </div>\n+            </div>\n+          </div>\n \n-              <div class="field">\n-                <label for="comment"\n-                       i18n:translate="label_comments">Comments</label>\n+          <div class="field">\n+            <label for="comment"\n+                   i18n:translate="label_comments"\n+            >Comments</label>\n \n-                <div class="formHelp"\n-                     i18n:translate="help_publishing_comments">\n+            <div class="formHelp"\n+                 i18n:translate="help_publishing_comments"\n+            >\n                   Will be added to the publishing history. If multiple\n                   items are selected, this comment will be attached to all\n                   of them.\n-                </div>\n-                <textarea id="comment"\n-                          name="comment"\n-                          cols="60"\n-                          rows="5"\n-                          tal:content="request/comment|nothing"\n-                          ></textarea>\n-              </div>\n-\n-              <div class="field">\n-                <label i18n:translate="label_change_status">Change State</label>\n-                <div class="formHelp"\n-                     i18n:translate="help_change_status_action">\n+            </div>\n+            <textarea id="comment"\n+                      cols="60"\n+                      name="comment"\n+                      rows="5"\n+                      tal:content="request/comment|nothing"\n+            ></textarea>\n+          </div>\n+\n+          <div class="field">\n+            <label i18n:translate="label_change_status">Change State</label>\n+            <div class="formHelp"\n+                 i18n:translate="help_change_status_action"\n+            >\n                   Select the transition to be used for modifying the items state.\n-                </div>\n-\n-                <div tal:define="error_workflow_action errors/workflow_action|nothing;\n-                                 objs request/paths|nothing;\n-                                 target python:objs and objs or context;"\n-                     tal:attributes="class python:error_workflow_action and \'field error\' or \'field\'">\n-\n-                  <div tal:condition="error_workflow_action">\n-                    <tal:block content="error_workflow_action">Error</tal:block>\n-                    <br />\n-                  </div>\n+            </div>\n+\n+            <div tal:define="\n+                   error_workflow_action errors/workflow_action|nothing;\n+                   objs request/paths|nothing;\n+                   target python:objs and objs or context;\n+                 "\n+                 tal:attributes="\n+                   class python:error_workflow_action and \'field error\' or \'field\';\n+                 "\n+            >\n+\n+              <div tal:condition="error_workflow_action">\n+                <tal:block content="error_workflow_action">Error</tal:block>\n+                <br />\n+              </div>\n \n-                  <span tal:replace="nothing">\n+              <span tal:replace="nothing">\n                     For usability we will want to signify what state we are\n                     currently in. DCWorkflow only returns what transitions are\n                     available. But we want to visually represent what *state* we\n                     are currently in along with possible transitions.\n-                  </span>\n-\n-                  <input class="noborder"\n-                         id="workflow_action"\n-                         type="radio"\n-                         name="workflow_action"\n-                         title=""\n-                         value=""\n-                         tal:attributes="value review_state;\n-                                         title review_state;\n-                                         checked python:request.get(\'workflow_action\', review_state)==review_state and 1 or 0;" />\n-                  <label for="workflow_action"\n-                         i18n:translate="label_no_change">No change</label>\n-                  <br />\n-\n-                  <tal:block define="transitions python:context.portal_workflow.getTransitionsFor(target, context)"\n-                             repeat="transition transitions">\n-                      <input class="noborder"\n-                             id=""\n-                             type="radio"\n-                             name="workflow_action"\n-                             title=""\n-                             value=""\n-                             i18n:attributes="title"\n-                             tal:attributes="value transition/id;\n-                                             id    transition/id;\n-                                             title transition/name;\n-                                             checked python:transition.get(\'id\') == request.get(\'workflow_action\', \'\') and \'checked\' or None" />\n-                      <label for=""\n-                             i18n:translate=""\n-                             tal:attributes="for transition/id;"\n-                             tal:content="transition/name"\n-                             >Transition Name</label>\n-                             <br />\n-                  </tal:block>\n-\n-                </div>\n-\n-              </div>\n-\n-              <div class="formControls">\n-                <input class="btn btn-primary"\n-                       type="submit"\n-                       name="form.button.Publish"\n-                       value="Save"\n-                       i18n:attributes="value label_save;"\n-                       tal:condition="not:request/paths|folders_in_publishing|nothing"/>\n-                <input class="btn btn-primary"\n-                       type="submit"\n-                       name="form.button.FolderPublish"\n-                       value="Save"\n-                       i18n:attributes="value label_save;"\n-                       tal:condition="request/paths|folders_in_publishing|nothing"/>\n-                <input class="btn btn-secondary"\n-                       type="submit"\n-                       name="form.button.Cancel"\n-                       value="Cancel"\n-                       i18n:attributes="value label_cancel;" />\n-              </div>\n-\n-              <input type="hidden" name="form.submitted" value="1" />\n-              <input type="hidden" name="orig_template"\n-                     tal:condition="request/orig_template|nothing"\n-                     tal:attributes="value request/orig_template"/>\n-              <input tal:replace="structure context/@@authenticator/authenticator" />\n-          </form>\n+              </span>\n+\n+              <input class="noborder"\n+                     id="workflow_action"\n+                     name="workflow_action"\n+                     title=""\n+                     type="radio"\n+                     value=""\n+                     tal:attributes="\n+                       value review_state;\n+                       title review_state;\n+                       checked python:request.get(\'workflow_action\', review_state)==review_state and 1 or 0;\n+                     "\n+              />\n+              <label for="workflow_action"\n+                     i18n:translate="label_no_change"\n+              >No change</label>\n+              <br />\n+\n+              <tal:block define="\n+                           transitions python:context.portal_workflow.getTransitionsFor(target, context);\n+                         "\n+                         repeat="transition transitions"\n+              >\n+                <input class="noborder"\n+                       id=""\n+                       name="workflow_action"\n+                       title=""\n+                       type="radio"\n+                       value=""\n+                       tal:attributes="\n+                         value transition/id;\n+                         id    transition/id;\n+                         title transition/name;\n+                         checked python:transition.get(\'id\') == request.get(\'workflow_action\', \'\') and \'checked\' or None;\n+                       "\n+                       i18n:attributes="title"\n+                />\n+                <label for=""\n+                       tal:content="transition/name"\n+                       tal:attributes="\n+                         for transition/id;\n+                       "\n+                       i18n:translate=""\n+                >Transition Name</label>\n+                <br />\n+              </tal:block>\n+\n+            </div>\n+\n+          </div>\n+\n+          <div class="formControls">\n+            <input class="btn btn-primary"\n+                   name="form.button.Publish"\n+                   type="submit"\n+                   value="Save"\n+                   tal:condition="not:request/paths|folders_in_publishing|nothing"\n+                   i18n:attributes="value label_save;"\n+            />\n+            <input class="btn btn-primary"\n+                   name="form.button.FolderPublish"\n+                   type="submit"\n+                   value="Save"\n+                   tal:condition="request/paths|folders_in_publishing|nothing"\n+                   i18n:attributes="value label_save;"\n+            />\n+            <input class="btn btn-secondary"\n+                   name="form.button.Cancel"\n+                   type="submit"\n+                   value="Cancel"\n+                   i18n:attributes="value label_cancel;"\n+            />\n+          </div>\n+\n+          <input name="form.submitted"\n+                 type="hidden"\n+                 value="1"\n+          />\n+          <input name="orig_template"\n+                 type="hidden"\n+                 tal:condition="request/orig_template|nothing"\n+                 tal:attributes="\n+                   value request/orig_template;\n+                 "\n+          />\n+          <input tal:replace="structure context/@@authenticator/authenticator" />\n+        </form>\n       </div>\n     </metal:main>\n \ndiff --git a/plone/app/content/browser/templates/delete_confirmation.pt b/plone/app/content/browser/templates/delete_confirmation.pt\nindex f9348d69..29241d53 100644\n--- a/plone/app/content/browser/templates/delete_confirmation.pt\n+++ b/plone/app/content/browser/templates/delete_confirmation.pt\n@@ -1,55 +1,73 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-    <metal:block fill-slot="top_slot"\n-                 tal:define="dummy python:request.set(\'disable_border\',1)" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+               "\n+  />\n \n-    <body>\n+  <body>\n \n-        <metal:main fill-slot="main"\n-            tal:define="useSelf python:context_state.is_structural_folder() and not context_state.is_default_page();\n-                        folder_warning python:useSelf and context.portal_type != \'Topic\';\n-                        number_of_objects_to_delete python:folder_warning and view.items_to_delete">\n+    <metal:main fill-slot="main"\n+                tal:define="\n+                  useSelf python:context_state.is_structural_folder() and not context_state.is_default_page();\n+                  folder_warning python:useSelf and context.portal_type != \'Topic\';\n+                  number_of_objects_to_delete python:folder_warning and view.items_to_delete;\n+                "\n+    >\n \n-        <h1 class="documentFirstHeading"\n-            i18n:translate="alert_deleting_locked_item"\n-            tal:condition="view/is_locked">\n+      <h1 class="documentFirstHeading"\n+          tal:condition="view/is_locked"\n+          i18n:translate="alert_deleting_locked_item"\n+      >\n             This item can not be deleted because it is currently locked by another user.\n-        </h1>\n+      </h1>\n \n-        <tal:block condition="not:view/is_locked">\n-            <h1 class="documentFirstHeading"\n-                tal:condition="folder_warning">\n-                <span i18n:translate="alert_really_delete_folder">\n+      <tal:block condition="not:view/is_locked">\n+        <h1 class="documentFirstHeading"\n+            tal:condition="folder_warning"\n+        >\n+          <span i18n:translate="alert_really_delete_folder">\n                     Do you really want to delete this folder and all its contents?\n-                </span>\n-                <span i18n:translate="alert_deleting_x_number_of_items" tal:condition="python:number_of_objects_to_delete>1">\n-                    (This will delete a total of <span i18n:name="number_of_items_to_delete" tal:content="python:number_of_objects_to_delete">22</span> items.)\n-                </span>\n-            </h1>\n-\n-            <h1 class="documentFirstHeading"\n-                i18n:translate="alert_really_delete"\n-                tal:condition="not:folder_warning">\n+          </span>\n+          <span tal:condition="python:number_of_objects_to_delete>1"\n+                i18n:translate="alert_deleting_x_number_of_items"\n+          >\n+                    (This will delete a total of\n+            <span tal:content="python:number_of_objects_to_delete"\n+                  i18n:name="number_of_items_to_delete"\n+            >22</span>\n+             items.)\n+          </span>\n+        </h1>\n+\n+        <h1 class="documentFirstHeading"\n+            tal:condition="not:folder_warning"\n+            i18n:translate="alert_really_delete"\n+        >\n                 Do you really want to delete this item?\n-            </h1>\n-        </tal:block>\n+        </h1>\n+      </tal:block>\n \n-        <div id="content-core">\n-            <tal:block replace="structure view/more_info">\n-            </tal:block>\n+      <div id="content-core">\n+        <tal:block replace="structure view/more_info">\n+        </tal:block>\n \n-            <ul>\n-                <li tal:content="context/@@plone_context_state/object_title">The item title (ID)</li>\n-            </ul>\n+        <ul>\n+          <li tal:content="context/@@plone_context_state/object_title">The item title (ID)</li>\n+        </ul>\n \n-            <form metal:use-macro="context/@@ploneform-macros/titlelessform" />\n-        </div>\n+        <form metal:use-macro="context/@@ploneform-macros/titlelessform"></form>\n+      </div>\n \n-        </metal:main>\n-    </body>\n+    </metal:main>\n+  </body>\n </html>\ndiff --git a/plone/app/content/browser/templates/object_rename.pt b/plone/app/content/browser/templates/object_rename.pt\nindex 9c95d7b8..e951e4f3 100644\n--- a/plone/app/content/browser/templates/object_rename.pt\n+++ b/plone/app/content/browser/templates/object_rename.pt\n@@ -1,28 +1,35 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-    <metal:block fill-slot="top_slot"\n-               tal:define="dummy python:request.set(\'disable_border\',1)" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+               "\n+  />\n \n-    <body>\n+  <body>\n \n-        <metal:main fill-slot="main">\n+    <metal:main fill-slot="main">\n \n-            <div id="content-core">\n+      <div id="content-core">\n \n-                <h1 class="documentFirstHeading"\n-                    tal:content="view/label">Rename item</h1>\n+        <h1 class="documentFirstHeading"\n+            tal:content="view/label"\n+        >Rename item</h1>\n \n-                <div id="content-core">\n-                    <form metal:use-macro="context/@@ploneform-macros/titlelessform" />\n-                </div>\n+        <div id="content-core">\n+          <form metal:use-macro="context/@@ploneform-macros/titlelessform"></form>\n+        </div>\n \n-            </div>\n-        </metal:main>\n+      </div>\n+    </metal:main>\n \n-    </body>\n+  </body>\n </html>\ndiff --git a/plone/app/content/browser/templates/select_default_page.pt b/plone/app/content/browser/templates/select_default_page.pt\nindex 6686c398..302fbd13 100644\n--- a/plone/app/content/browser/templates/select_default_page.pt\n+++ b/plone/app/content/browser/templates/select_default_page.pt\n@@ -1,91 +1,124 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<metal:block fill-slot="top_slot"\n-             tal:define="dummy python:request.set(\'disable_border\',1)" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+               "\n+  />\n \n   <body>\n \n     <metal:main fill-slot="main">\n       <h1 class="documentFirstHeading"\n-          i18n:translate="heading_select_default_page">Select default page</h1>\n+          i18n:translate="heading_select_default_page"\n+      >Select default page</h1>\n \n-      <div class="documentDescription" i18n:translate="description_select_default_page">\n+      <div class="documentDescription"\n+           i18n:translate="description_select_default_page"\n+      >\n         Please select item which will be displayed as the default page of the\n         folder.\n       </div>\n       <div id="content-core">\n-          <form name="default_page_form"\n-                method="post"\n-                tal:attributes="action string:${context/absolute_url}/select_default_page">\n+        <form method="post"\n+              name="default_page_form"\n+              tal:attributes="\n+                action string:${context/absolute_url}/select_default_page;\n+              "\n+        >\n \n-            <input type="hidden" name="form.submitted" value="1"/>\n+          <input name="form.submitted"\n+                 type="hidden"\n+                 value="1"\n+          />\n \n-            <tal:items define="items view/get_selectable_items;\n-                               cur_page context/getDefaultPage|nothing;">\n-            <tal:hasItems condition="items"\n-                          define="n_items python:len(items);\n-                          member portal_state/member;\n-                          portal_visible_ids context/portal_properties/site_properties/visible_ids|nothing;\n-                          member_visible_ids python:member.getProperty(\'visible_ids\', context.portal_memberdata.getProperty(\'visible_ids\'))">\n-                <dl>\n-                    <tal:item repeat="item items">\n-                        <dt tal:define="normalized_type python:plone_view.normalizeString(item.portal_type);\n-                                        item_id python:\'(%s)\' % item.getId if (portal_visible_ids and member_visible_ids) else \'\'">\n-                            <input type="radio" name="objectId" value=""\n-                                tal:attributes="value item/getId;\n-                                                id item/getId;\n-                                                checked python: (n_items==1 or item.getId==cur_page) and \'checked\' or None;"/>\n-                            <label tal:attributes="for item/getId;\n-                                                   class string:contenttype-${normalized_type}"\n-                                   tal:content="string:${item/pretty_title_or_id} $item_id">\n+          <tal:items define="\n+                       items view/get_selectable_items;\n+                       cur_page context/getDefaultPage|nothing;\n+                     ">\n+            <tal:hasitems define="\n+                            n_items python:len(items);\n+                            member portal_state/member;\n+                            portal_visible_ids context/portal_properties/site_properties/visible_ids|nothing;\n+                            member_visible_ids python:member.getProperty(\'visible_ids\', context.portal_memberdata.getProperty(\'visible_ids\'));\n+                          "\n+                          condition="items"\n+            >\n+              <dl>\n+                <tal:item repeat="item items">\n+                  <dt tal:define="\n+                        normalized_type python:plone_view.normalizeString(item.portal_type);\n+                        item_id python:\'(%s)\' % item.getId if (portal_visible_ids and member_visible_ids) else \'\';\n+                      ">\n+                    <input name="objectId"\n+                           type="radio"\n+                           value=""\n+                           tal:attributes="\n+                             value item/getId;\n+                             id item/getId;\n+                             checked python: (n_items==1 or item.getId==cur_page) and \'checked\' or None;\n+                           "\n+                    />\n+                    <label tal:content="string:${item/pretty_title_or_id} $item_id"\n+                           tal:attributes="\n+                             for item/getId;\n+                             class string:contenttype-${normalized_type};\n+                           "\n+                    >\n                                 Item title\n-                            </label>\n-                        </dt>\n-                        <dd tal:content="item/Description">\n+                    </label>\n+                  </dt>\n+                  <dd tal:content="item/Description">\n                             Item Description\n-                        </dd>\n-                    </tal:item>\n+                  </dd>\n+                </tal:item>\n \n-                </dl>\n+              </dl>\n \n               <div class="formControls mb-3">\n                 <button class="context btn btn-primary"\n-                       type="submit"\n-                       name="form.buttons.Save"\n-                       value="Save"\n-                       i18n:attributes="value label_save;"\n-                       i18n:translate="label_save">Save</button>\n+                        name="form.buttons.Save"\n+                        type="submit"\n+                        value="Save"\n+                        i18n:attributes="value label_save;"\n+                        i18n:translate="label_save"\n+                >Save</button>\n                 <button class="btn btn-secondary"\n-                       type="submit"\n-                       name="form.buttons.Cancel"\n-                       value="Cancel"\n-                       i18n:attributes="value label_cancel;"\n-                       i18n:translate="label_cancel">Cancel</button>\n+                        name="form.buttons.Cancel"\n+                        type="submit"\n+                        value="Cancel"\n+                        i18n:attributes="value label_cancel;"\n+                        i18n:translate="label_cancel"\n+                >Cancel</button>\n               </div>\n \n-            </tal:hasItems>\n+            </tal:hasitems>\n             <tal:noitems condition="not:nocall:items">\n               <div i18n:translate="help_no_selectable_default_pages">\n                  There are no items in this folder that can be selected as\n                  a default view page.\n               </div>\n               <div class="formControls mb-3">\n-                    <button class="context btn btn-primary"\n-                       type="submit"\n-                       name="form.button.Cancel"\n-                       value="Ok"\n-                       i18n:attributes="value label_ok;"\n-                       i18n:translate="label_ok">Ok</button>\n+                <button class="context btn btn-primary"\n+                        name="form.button.Cancel"\n+                        type="submit"\n+                        value="Ok"\n+                        i18n:attributes="value label_ok;"\n+                        i18n:translate="label_ok"\n+                >Ok</button>\n               </div>\n             </tal:noitems>\n-            </tal:items>\n+          </tal:items>\n \n-          </form>\n+        </form>\n       </div>\n \n     </metal:main>\ndiff --git a/plone/app/content/browser/templates/select_default_view.pt b/plone/app/content/browser/templates/select_default_view.pt\nindex 6776969c..b7ccdbb9 100644\n--- a/plone/app/content/browser/templates/select_default_view.pt\n+++ b/plone/app/content/browser/templates/select_default_view.pt\n@@ -1,89 +1,131 @@\n-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"\n-      xmlns:tal="http://xml.zope.org/namespaces/tal"\n-      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+<html xmlns="http://www.w3.org/1999/xhtml"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      xmlns:metal="http://xml.zope.org/namespaces/metal"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      lang="en"\n       metal:use-macro="context/main_template/macros/master"\n-      i18n:domain="plone">\n+      xml:lang="en"\n+      i18n:domain="plone"\n+>\n \n-<metal:block fill-slot="top_slot"\n-             tal:define="dummy python:request.set(\'disable_border\',1)" />\n+  <metal:block fill-slot="top_slot"\n+               tal:define="\n+                 dummy python:request.set(\'disable_border\',1);\n+               "\n+  />\n \n   <body>\n \n     <metal:main fill-slot="main">\n \n       <h1 class="documentFirstHeading"\n-          i18n:translate="heading_select_default_view">Select default view</h1>\n+          i18n:translate="heading_select_default_view"\n+      >Select default view</h1>\n \n-      <div class="documentDescription" i18n:translate="description_select_default_view">\n+      <div class="documentDescription"\n+           i18n:translate="description_select_default_view"\n+      >\n         Please select which template should be used as the default view of the\n         folder.\n       </div>\n \n       <div id="content-core">\n-          <form name="default_view_form"\n-                action="."\n-                method="post"\n-                tal:attributes="action view/action_url">\n+        <form action="."\n+              method="post"\n+              name="default_view_form"\n+              tal:attributes="\n+                action view/action_url;\n+              "\n+        >\n \n-            <input type="hidden" name="form.submitted" value="1"/>\n+          <input name="form.submitted"\n+                 type="hidden"\n+                 value="1"\n+          />\n \n-                <div tal:define="selectedLayout view/selectedLayout;">\n-                    <tal:item repeat="layout view/vocab">\n-                        <tal:vars define="value python:layout[0];\n-                                          display python:layout[1];">\n-                            <input type="radio" class="noborder" name="templateId" value=""\n-                                   tal:attributes="value value;\n-                                                   id value;\n-                                                   disabled python:value==selectedLayout"/>\n-                            <label for="" tal:content="display"\n-                                   i18n:translate=""\n-                                   tal:attributes="for value">\n+          <div tal:define="\n+                 selectedLayout view/selectedLayout;\n+               ">\n+            <tal:item repeat="layout view/vocab">\n+              <tal:vars define="\n+                          value python:layout[0];\n+                          display python:layout[1];\n+                        ">\n+                <input class="noborder"\n+                       name="templateId"\n+                       type="radio"\n+                       value=""\n+                       tal:attributes="\n+                         value value;\n+                         id value;\n+                         disabled python:value==selectedLayout;\n+                       "\n+                />\n+                <label for=""\n+                       tal:content="display"\n+                       tal:attributes="\n+                         for value;\n+                       "\n+                       i18n:translate=""\n+                >\n                                 Layout name\n-                            </label>\n-                            <span class="discreet"\n-                                  tal:condition="python:value==selectedLayout"\n-                                  i18n:translate="label_current">(current)</span><br />\n-                        </tal:vars>\n-                    </tal:item>\n-                    <p tal:condition="view/canSelectDefaultPage">\n-                        <tal:selected condition="python:selectedLayout != \'\'">\n-                            <span i18n:translate="label_or">or</span>\n-                            <a title="Select an item to be used as default view in this folder" href="#" class="selected"\n-                               tal:attributes="href string:${context/absolute_url}/select_default_page;"\n-                               i18n:attributes="title title_select_default_page;"\n-                               i18n:translate="label_choose_content_item">\n+                </label>\n+                <span class="discreet"\n+                      tal:condition="python:value==selectedLayout"\n+                      i18n:translate="label_current"\n+                >(current)</span><br />\n+              </tal:vars>\n+            </tal:item>\n+            <p tal:condition="view/canSelectDefaultPage">\n+              <tal:selected condition="python:selectedLayout != \'\'">\n+                <span i18n:translate="label_or">or</span>\n+                <a class="selected"\n+                   href="#"\n+                   title="Select an item to be used as default view in this folder"\n+                   tal:attributes="\n+                     href string:${context/absolute_url}/select_default_page;\n+                   "\n+                   i18n:attributes="title title_select_default_page;"\n+                   i18n:translate="label_choose_content_item"\n+                >\n                                  Choose a content item&hellip;\n-                            </a>\n-                        </tal:selected>\n-                        <tal:selected condition="python:selectedLayout == \'\'">\n-                            <span i18n:translate="label_or">or</span>\n-                            <a title="Change the item used as default view in this folder" href="#" class="selected"\n-                               tal:attributes="href string:${context/absolute_url}/select_default_page;"\n-                               i18n:attributes="title title_change_default_view_item;"\n-                               i18n:translate="label_select_content_item">\n+                </a>\n+              </tal:selected>\n+              <tal:selected condition="python:selectedLayout == \'\'">\n+                <span i18n:translate="label_or">or</span>\n+                <a class="selected"\n+                   href="#"\n+                   title="Change the item used as default view in this folder"\n+                   tal:attributes="\n+                     href string:${context/absolute_url}/select_default_page;\n+                   "\n+                   i18n:attributes="title title_change_default_view_item;"\n+                   i18n:translate="label_select_content_item"\n+                >\n                                  Select a content item&hellip;\n-                            </a>\n-                        </tal:selected>\n-                    </p>\n-                </div>\n+                </a>\n+              </tal:selected>\n+            </p>\n+          </div>\n \n-              <div class="formControls mb-3">\n-                <button class="context btn btn-primary"\n-                       type="submit"\n-                       name="form.button.Save"\n-                       value="Save"\n-                       i18n:attributes="value label_save;"\n-                       i18n:translate="label_save">Save</button>\n-                <button class="standalone btn btn-secondary"\n-                       type="submit"\n-                       name="form.button.Cancel"\n-                       value="Cancel"\n-                       i18n:attributes="value label_cancel;"\n-                       i18n:translate="label_cancel">Cancel</button>\n-              </div>\n+          <div class="formControls mb-3">\n+            <button class="context btn btn-primary"\n+                    name="form.button.Save"\n+                    type="submit"\n+                    value="Save"\n+                    i18n:attributes="value label_save;"\n+                    i18n:translate="label_save"\n+            >Save</button>\n+            <button class="standalone btn btn-secondary"\n+                    name="form.button.Cancel"\n+                    type="submit"\n+                    value="Cancel"\n+                    i18n:attributes="value label_cancel;"\n+                    i18n:translate="label_cancel"\n+            >Cancel</button>\n+          </div>\n \n-          </form>\n+        </form>\n       </div>\n \n     </metal:main>\ndiff --git a/plone/app/content/browser/vocabulary.py b/plone/app/content/browser/vocabulary.py\nindex f7693cd7..9464947e 100644\n--- a/plone/app/content/browser/vocabulary.py\n+++ b/plone/app/content/browser/vocabulary.py\n@@ -3,12 +3,12 @@\n from logging import getLogger\n from plone.app.content.utils import json_dumps\n from plone.app.content.utils import json_loads\n-from plone.app.layout.navigation.interfaces import INavigationRoot\n-from plone.app.layout.navigation.root import getNavigationRoot\n from plone.app.querystring import queryparser\n from plone.app.z3cform.interfaces import IFieldPermissionChecker\n from plone.autoform.interfaces import WRITE_PERMISSIONS_KEY\n from plone.base import PloneMessageFactory as _\n+from plone.base.interfaces.siteroot import INavigationRoot\n+from plone.base.navigationroot import get_navigation_root\n from plone.base.utils import safe_text\n from plone.memoize.view import memoize\n from plone.supermodel.utils import mergedTaggedValueDict\n@@ -125,7 +125,7 @@ def get_translated_ignored(self):\n         return TRANSLATED_IGNORED\n \n     def get_base_path(self, context):\n-        return getNavigationRoot(context)\n+        return get_navigation_root(context)\n \n     def __call__(self):\n         """\n@@ -139,7 +139,7 @@ def __call__(self):\n                     sort_on: index,\n                     sort_order: (asc|reversed)\n                 }\n-        attributes: comma seperated, or json object list\n+        attributes: comma separated, or json object list\n         batch: {\n             page: 1-based page of results,\n             size: size of paged results\n@@ -183,7 +183,7 @@ def __call__(self):\n         if batch and ("size" not in batch or "page" not in batch):\n             batch = None  # batching not providing correct options\n         if batch:\n-            # must be slicable for batching support\n+            # must be sliceable for batching support\n             page = int(batch["page"])\n             size = int(batch["size"])\n             if size > MAX_BATCH_SIZE:\ndiff --git a/plone/app/content/configure.zcml b/plone/app/content/configure.zcml\nindex 60466f64..615fd613 100644\n--- a/plone/app/content/configure.zcml\n+++ b/plone/app/content/configure.zcml\n@@ -1,23 +1,24 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:five="http://namespaces.zope.org/five"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n-    <include package="plone.app.vocabularies" />\n-    <include package=".browser" />\n+  <include package="plone.app.vocabularies" />\n+  <include package=".browser" />\n \n-    <!-- Register a name chooser that chooses plone-like normalized names -->\n-    <adapter\n-      for="Products.CMFCore.interfaces.IFolderish"\n+  <!-- Register a name chooser that chooses plone-like normalized names -->\n+  <adapter\n       factory=".namechooser.NormalizingNameChooser"\n       provides="zope.container.interfaces.INameChooser"\n+      for="Products.CMFCore.interfaces.IFolderish"\n       />\n \n-    <!-- Re-index content when it\'s modified -->\n-    <subscriber\n-        for=".interfaces.IReindexOnModify\n-             zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n-        handler=".catalog.reindexOnModify"\n-        />\n+  <!-- Re-index content when it\'s modified -->\n+  <subscriber\n+      for=".interfaces.IReindexOnModify\n+           zope.lifecycleevent.interfaces.IObjectModifiedEvent"\n+      handler=".catalog.reindexOnModify"\n+      />\n \n </configure>\ndiff --git a/plone/app/content/namechooser.py b/plone/app/content/namechooser.py\nindex c16633b1..0d9fe5ed 100644\n--- a/plone/app/content/namechooser.py\n+++ b/plone/app/content/namechooser.py\n@@ -83,7 +83,7 @@ def _findUniqueName(self, name, obj):\n             return new_name\n \n         raise ValueError(\n-            "Cannot find a unique name based on %s after %d attemps."\n+            "Cannot find a unique name based on %s after %d attempts."\n             % (\n                 name,\n                 ATTEMPTS,\ndiff --git a/plone/app/content/testing.py b/plone/app/content/testing.py\nindex b5a85ce1..20d1670b 100644\n--- a/plone/app/content/testing.py\n+++ b/plone/app/content/testing.py\n@@ -45,7 +45,6 @@ def ExampleFunctionVocabulary(context, query=None):\n \n \n class PloneAppContent(PloneSandboxLayer):\n-\n     defaultBases = (PLONE_FIXTURE,)\n \n     USER_NAME = "johndoe"\ndiff --git a/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows.xml b/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows.xml\nindex 12fd9c2e..8f49355d 100644\n--- a/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows.xml\n+++ b/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows.xml\n@@ -1,6 +1,10 @@\n-<?xml version="1.0"?>\n-<object name="portal_workflow" meta_type="Plone Workflow Tool">\n+<?xml version="1.0" encoding="utf-8"?>\n+<object meta_type="Plone Workflow Tool"\n+        name="portal_workflow"\n+>\n \n-    <object name="non-ascii-workflow" meta_type="Workflow" />\n+  <object meta_type="Workflow"\n+          name="non-ascii-workflow"\n+  />\n \n </object>\ndiff --git a/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows/non-ascii-workflow/definition.xml b/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows/non-ascii-workflow/definition.xml\nindex 308dc6a3..cbd432e7 100644\n--- a/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows/non-ascii-workflow/definition.xml\n+++ b/plone/app/content/tests/profiles/non-ascii-workflow-profile/workflows/non-ascii-workflow/definition.xml\n@@ -1,55 +1,72 @@\n-<?xml version="1.0"?>\n+<?xml version="1.0" encoding="utf-8"?>\n <dc-workflow xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-             i18n:domain="plone.app.content.tests"\n-             workflow_id="non-ascii-workflow"\n-             title="Workflow for non-ascii characters"\n              description=""\n-             state_variable="review_state"\n              initial_state="initial"\n-             i18n:attributes="title">\n+             state_variable="review_state"\n+             title="Workflow for non-ascii characters"\n+             workflow_id="non-ascii-workflow"\n+             i18n:attributes="title"\n+             i18n:domain="plone.app.content.tests"\n+>\n \n- <permission>View</permission>\n+  <permission>View</permission>\n \n- <state state_id="initial" title="\xc3\x8fnitial" i18n:attributes="title">\n-  <exit-transition transition_id="to_after"/>\n-  <permission-map name="View permission for testing non-ascii title"\n-                  acquired="False">\n-   <permission-role>Manager</permission-role>\n-  </permission-map>\n- </state>\n+  <state state_id="initial"\n+         title="\xc3\x8fnitial"\n+         i18n:attributes="title"\n+  >\n+    <exit-transition transition_id="to_after" />\n+    <permission-map acquired="False"\n+                    name="View permission for testing non-ascii title"\n+    >\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+  </state>\n \n- <state state_id="after" title="\xc3\x84fter" i18n:attributes="title">\n-  <exit-transition transition_id="to_initial"/>\n-  <permission-map name="View permission for testing non-ascii title"\n-                  acquired="False">\n-   <permission-role>Manager</permission-role>\n-  </permission-map>\n- </state>\n+  <state state_id="after"\n+         title="\xc3\x84fter"\n+         i18n:attributes="title"\n+  >\n+    <exit-transition transition_id="to_initial" />\n+    <permission-map acquired="False"\n+                    name="View permission for testing non-ascii title"\n+    >\n+      <permission-role>Manager</permission-role>\n+    </permission-map>\n+  </state>\n \n- <transition transition_id="to_after" new_state="after"\n-             title="To \xc3\x84fter!"\n-             trigger="USER"\n-             before_script="" after_script=""\n-             i18n:attributes="title">\n-  <action url="%(content_url)s/content_status_modify?workflow_action=to_after"\n-          category="workflow"\n-          i18n:translate="">To \xc3\x84fter!</action>\n-  <guard>\n-   <guard-permission>Modify portal content</guard-permission>\n-  </guard>\n- </transition>\n+  <transition after_script=""\n+              before_script=""\n+              new_state="after"\n+              title="To \xc3\x84fter!"\n+              transition_id="to_after"\n+              trigger="USER"\n+              i18n:attributes="title"\n+  >\n+    <action category="workflow"\n+            url="%(content_url)s/content_status_modify?workflow_action=to_after"\n+            i18n:translate=""\n+    >To \xc3\x84fter!</action>\n+    <guard>\n+      <guard-permission>Modify portal content</guard-permission>\n+    </guard>\n+  </transition>\n \n- <transition transition_id="to_initial" new_state="initial"\n-             title="To \xc3\x8fnitial!"\n-             trigger="USER"\n-             before_script="" after_script=""\n-             i18n:attributes="title">\n-  <action url="%(content_url)s/content_status_modify?workflow_action=to_initial"\n-          category="workflow"\n-          i18n:translate="">To \xc3\x8fnitial!</action>\n-  <guard>\n-   <guard-permission>Modify portal content</guard-permission>\n-  </guard>\n- </transition>\n+  <transition after_script=""\n+              before_script=""\n+              new_state="initial"\n+              title="To \xc3\x8fnitial!"\n+              transition_id="to_initial"\n+              trigger="USER"\n+              i18n:attributes="title"\n+  >\n+    <action category="workflow"\n+            url="%(content_url)s/content_status_modify?workflow_action=to_initial"\n+            i18n:translate=""\n+    >To \xc3\x8fnitial!</action>\n+    <guard>\n+      <guard-permission>Modify portal content</guard-permission>\n+    </guard>\n+  </transition>\n \n </dc-workflow>\ndiff --git a/plone/app/content/tests/profiles/non-ascii-workflow.zcml b/plone/app/content/tests/profiles/non-ascii-workflow.zcml\nindex 1f2ac79a..5b84eb18 100644\n--- a/plone/app/content/tests/profiles/non-ascii-workflow.zcml\n+++ b/plone/app/content/tests/profiles/non-ascii-workflow.zcml\n@@ -1,14 +1,15 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    i18n_domain="plone.app.content.tests">\n+    i18n_domain="plone.app.content.tests"\n+    >\n \n-    <genericsetup:registerProfile\n-        name="non-ascii-workflow"\n-        title="plone.app.content.tests: non-ascii-workflow"\n-        directory="non-ascii-workflow-profile"\n-        description=""\n-        provides="Products.GenericSetup.interfaces.EXTENSION"\n-        />\n+  <genericsetup:registerProfile\n+      name="non-ascii-workflow"\n+      title="plone.app.content.tests: non-ascii-workflow"\n+      description=""\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="non-ascii-workflow-profile"\n+      />\n \n </configure>\ndiff --git a/plone/app/content/tests/test_actions.py b/plone/app/content/tests/test_actions.py\nindex 62108fda..121b9e33 100644\n--- a/plone/app/content/tests/test_actions.py\n+++ b/plone/app/content/tests/test_actions.py\n@@ -8,7 +8,8 @@\n from plone.locking.interfaces import ILockable\n from plone.testing.zope import Browser\n from z3c.form.interfaces import IFormLayer\n-from zExceptions import Unauthorized, NotFound\n+from zExceptions import NotFound\n+from zExceptions import Unauthorized\n from zope.component import getMultiAdapter\n from zope.interface import alsoProvides\n \n@@ -37,7 +38,7 @@ def setUp(self):\n         self.browser = Browser(self.layer["app"])\n         self.browser.handleErrors = False\n         self.browser.addHeader(\n-            "Authorization", "Basic {}:{}".format(TEST_USER_NAME, TEST_USER_PASSWORD)\n+            "Authorization", f"Basic {TEST_USER_NAME}:{TEST_USER_PASSWORD}"\n         )\n \n     def tearDown(self):\n@@ -124,7 +125,7 @@ def prepare_for_acquisition_tests(self):\n         browser_2 = Browser(self.layer["app"])\n         browser_2.handleErrors = False\n         browser_2.addHeader(\n-            "Authorization", "Basic {}:{}".format(TEST_USER_NAME, TEST_USER_PASSWORD)\n+            "Authorization", f"Basic {TEST_USER_NAME}:{TEST_USER_PASSWORD}"\n         )\n \n         # return the id of the root page, the nested page itself, and the\ndiff --git a/plone/app/content/tests/test_adding.py b/plone/app/content/tests/test_adding.py\nindex b5b9bfb4..b813c5e8 100644\n--- a/plone/app/content/tests/test_adding.py\n+++ b/plone/app/content/tests/test_adding.py\n@@ -5,7 +5,6 @@\n \n \n class AddingTests(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/content/tests/test_content_status_modify.py b/plone/app/content/tests/test_content_status_modify.py\nindex e1e782e0..7b53a48c 100644\n--- a/plone/app/content/tests/test_content_status_modify.py\n+++ b/plone/app/content/tests/test_content_status_modify.py\n@@ -124,7 +124,6 @@ def testEditorCanSubmitButNotPublish(self):\n \n \n class TestContentStatusModifyFunctional(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_DX_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/content/tests/test_contents.py b/plone/app/content/tests/test_contents.py\nindex f7402fac..80ba2ecd 100644\n--- a/plone/app/content/tests/test_contents.py\n+++ b/plone/app/content/tests/test_contents.py\n@@ -90,8 +90,8 @@ def setUp(self):\n     @mock.patch(\n         "plone.app.content.browser.contents.ContentsBaseAction.protect", lambda x: True\n     )  # noqa\n-    def test_delete_success_with_private_anchestor(self):\n-        """Delete content item from a folder with private anchestor"""\n+    def test_delete_success_with_private_ancestor(self):\n+        """Delete content item from a folder with private ancestor"""\n         # Create test content /it1/it2/it3\n         self.portal.invokeFactory("type1", id="it1", title="Item 1")\n         self.portal.it1.invokeFactory("type1", id="it2", title="Item 2")\n@@ -222,8 +222,8 @@ def test_paste_fail_constraint(self):\n     @mock.patch(\n         "plone.app.content.browser.contents.ContentsBaseAction.protect", lambda x: True\n     )  # noqa\n-    def test_paste_success_with_private_anchestor(self):\n-        """Copy content item and paste into a folder with private anchestor"""\n+    def test_paste_success_with_private_ancestor(self):\n+        """Copy content item and paste into a folder with private ancestor"""\n         # Create test content /it2/it3\n         self.portal.invokeFactory("type1", id="it2", title="Item 2")\n         self.portal.it2.invokeFactory("type1", id="it3", title="Item 3")\n@@ -274,8 +274,8 @@ def setUp(self):\n     @mock.patch(\n         "plone.app.content.browser.contents.ContentsBaseAction.protect", lambda x: True\n     )  # noqa\n-    def test_rename_success_with_private_anchestor(self):\n-        """Rename content item from a folder with private anchestor"""\n+    def test_rename_success_with_private_ancestor(self):\n+        """Rename content item from a folder with private ancestor"""\n         # Create test content /it1/it2/it3\n         self.portal.invokeFactory("type1", id="it1", title="Item 1")\n         self.portal.it1.invokeFactory("type1", id="it2", title="Item 2")\ndiff --git a/plone/app/content/tests/test_folder.py b/plone/app/content/tests/test_folder.py\nindex 01d2764f..eef41bfe 100644\n--- a/plone/app/content/tests/test_folder.py\n+++ b/plone/app/content/tests/test_folder.py\n@@ -51,7 +51,6 @@ def setUp(self):\n \n \n class DXBaseTest(BaseTest):\n-\n     layer = PLONE_APP_CONTENT_DX_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -126,7 +125,6 @@ def testCreators(self):\n \n \n class WorkflowTest(BaseTest):\n-\n     layer = PLONE_APP_CONTENT_DX_FUNCTIONAL_TESTING\n \n     def convertDateTimeToIndexRepr(self, date):\n@@ -166,7 +164,6 @@ def testStateChange(self):\n \n \n class RenameTest(BaseTest):\n-\n     layer = PLONE_APP_CONTENT_DX_INTEGRATION_TESTING\n \n     def test_folder_rename_objects(self):\n@@ -204,7 +201,6 @@ def test_default_page_updated_on_rename_objects(self):\n \n \n class ContextInfoTest(BaseTest):\n-\n     layer = PLONE_APP_CONTENT_DX_INTEGRATION_TESTING\n \n     def testStateChange(self):\ndiff --git a/plone/app/content/tests/test_namechooser_unit.py b/plone/app/content/tests/test_namechooser_unit.py\nindex ec3df752..d9d3f660 100644\n--- a/plone/app/content/tests/test_namechooser_unit.py\n+++ b/plone/app/content/tests/test_namechooser_unit.py\n@@ -13,7 +13,6 @@\n \n \n class NameChooserTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/content/tests/test_non_ascii_characters_in_workflow_state.py b/plone/app/content/tests/test_non_ascii_characters_in_workflow_state.py\nindex 386e0697..cef6398e 100644\n--- a/plone/app/content/tests/test_non_ascii_characters_in_workflow_state.py\n+++ b/plone/app/content/tests/test_non_ascii_characters_in_workflow_state.py\n@@ -11,7 +11,6 @@\n \n \n class TestNonAsciiCharactersWorkflow(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_NON_ASCII_INTEGRATION_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/content/tests/test_selectdefaultpage.py b/plone/app/content/tests/test_selectdefaultpage.py\nindex 3af4f1ce..ff3a2857 100644\n--- a/plone/app/content/tests/test_selectdefaultpage.py\n+++ b/plone/app/content/tests/test_selectdefaultpage.py\n@@ -28,12 +28,13 @@\n \n \n class SelectDefaultPageDXTestCase(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_DX_FUNCTIONAL_TESTING\n \n     def setUp(self):\n         self.portal = self.layer["portal"]\n-        self.portal.acl_users.userFolderAddUser("editor", TEST_USER_PASSWORD, ["Editor"], [])\n+        self.portal.acl_users.userFolderAddUser(\n+            "editor", TEST_USER_PASSWORD, ["Editor"], []\n+        )\n \n         self._create_structure()\n         transaction.commit()\ndiff --git a/plone/app/content/tests/test_widgets.py b/plone/app/content/tests/test_widgets.py\nindex c3577139..d87b6193 100644\n--- a/plone/app/content/tests/test_widgets.py\n+++ b/plone/app/content/tests/test_widgets.py\n@@ -69,7 +69,6 @@ def _disable_permission_checker(context):\n \n \n class BrowserTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_DX_INTEGRATION_TESTING\n \n     def setUp(self):\n@@ -664,7 +663,6 @@ def testGetMimeIcon(self):\n \n \n class FunctionalBrowserTest(unittest.TestCase):\n-\n     layer = PLONE_APP_CONTENT_DX_FUNCTIONAL_TESTING\n \n     def setUp(self):\ndiff --git a/plone/app/content/utils.py b/plone/app/content/utils.py\nindex d61cf028..a6131bba 100644\n--- a/plone/app/content/utils.py\n+++ b/plone/app/content/utils.py\n@@ -8,6 +8,7 @@\n # use simplejson because it\'s ahead of stdlib and supports more types\n import simplejson\n \n+\n try:\n     from z3c.relationfield.relation import RelationValue\n except ImportError:\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 05b615de..0e84fbc5 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,6 +1,9 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n [tool.towncrier]\n-filename = "CHANGES.rst"\n directory = "news/"\n+filename = "CHANGES.rst"\n title_format = "{version} ({project_date})"\n underlines = ["-", ""]\n \n@@ -18,3 +21,137 @@ showcontent = true\n directory = "bugfix"\n name = "Bug fixes:"\n showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "internal"\n+name = "Internal:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "documentation"\n+name = "Documentation:"\n+showcontent = true\n+\n+[[tool.towncrier.type]]\n+directory = "tests"\n+name = "Tests"\n+showcontent = true\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  towncrier_extra_lines = """\n+#  extra_configuration\n+#  """\n+##\n+\n+[tool.isort]\n+profile = "plone"\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  isort_extra_lines = """\n+#  extra_configuration\n+#  """\n+##\n+\n+[tool.black]\n+target-version = ["py38"]\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  black_extra_lines = """\n+#  extra_configuration\n+#  """\n+##\n+\n+[tool.codespell]\n+ignore-words-list = "discreet,"\n+skip = "*.po,"\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  codespell_ignores = "foo,bar"\n+#  codespell_skip = "*.po,*.map,package-lock.json"\n+##\n+\n+[tool.dependencychecker]\n+Zope = [\n+  # Zope own provided namespaces\n+  \'App\', \'OFS\', \'Products.Five\', \'Products.OFSP\', \'Products.PageTemplates\',\n+  \'Products.SiteAccess\', \'Shared\', \'Testing\', \'ZPublisher\', \'ZTUtils\',\n+  \'Zope2\', \'webdav\', \'zmi\',\n+  # ExtensionClass own provided namespaces\n+  \'ExtensionClass\', \'ComputedAttribute\', \'MethodObject\',\n+  # Zope dependencies\n+  \'AccessControl\', \'Acquisition\', \'AuthEncoding\', \'beautifulsoup4\', \'BTrees\',\n+  \'cffi\', \'Chameleon\', \'DateTime\', \'DocumentTemplate\',\n+  \'MultiMapping\', \'multipart\', \'PasteDeploy\', \'Persistence\', \'persistent\',\n+  \'pycparser\', \'python-gettext\', \'pytz\', \'RestrictedPython\', \'roman\',\n+  \'soupsieve\', \'transaction\', \'waitress\', \'WebOb\', \'WebTest\', \'WSGIProxy2\',\n+  \'z3c.pt\', \'zc.lockfile\', \'ZConfig\', \'zExceptions\', \'ZODB\', \'zodbpickle\',\n+  \'zope.annotation\', \'zope.browser\', \'zope.browsermenu\', \'zope.browserpage\',\n+  \'zope.browserresource\', \'zope.cachedescriptors\', \'zope.component\',\n+  \'zope.configuration\', \'zope.container\', \'zope.contentprovider\',\n+  \'zope.contenttype\', \'zope.datetime\', \'zope.deferredimport\',\n+  \'zope.deprecation\', \'zope.dottedname\', \'zope.event\', \'zope.exceptions\',\n+  \'zope.filerepresentation\', \'zope.globalrequest\', \'zope.hookable\',\n+  \'zope.i18n\', \'zope.i18nmessageid\', \'zope.interface\', \'zope.lifecycleevent\',\n+  \'zope.location\', \'zope.pagetemplate\', \'zope.processlifetime\', \'zope.proxy\',\n+  \'zope.ptresource\', \'zope.publisher\', \'zope.schema\', \'zope.security\',\n+  \'zope.sequencesort\', \'zope.site\', \'zope.size\', \'zope.structuredtext\',\n+  \'zope.tal\', \'zope.tales\', \'zope.testbrowser\', \'zope.testing\',\n+  \'zope.traversing\', \'zope.viewlet\'\n+]\n+\'Products.CMFCore\' = [\n+  \'docutils\', \'five.localsitemanager\', \'Missing\', \'Products.BTreeFolder2\',\n+  \'Products.GenericSetup\', \'Products.MailHost\', \'Products.PythonScripts\',\n+  \'Products.StandardCacheManagers\', \'Products.ZCatalog\', \'Record\',\n+  \'zope.sendmail\', \'Zope\'\n+]\n+\'plone.base\' = [\n+  \'plone.batching\', \'plone.registry\', \'plone.schema\',\'plone.z3cform\',\n+  \'Products.CMFCore\', \'Products.CMFDynamicViewFTI\',\n+]\n+python-dateutil = [\'dateutil\']\n+ignore-packages = [\'tus\', ]\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  dependencies_ignores = "[\'zestreleaser.towncrier\']"\n+#  dependencies_mappings = [\n+#    "gitpython = [\'git\']",\n+#    "pygithub = [\'github\']",\n+#  ]\n+##\n+\n+[tool.check-manifest]\n+ignore = [\n+    ".editorconfig",\n+    ".meta.toml",\n+    ".pre-commit-config.yaml",\n+    "tox.ini",\n+    ".flake8",\n+    "mx.ini",\n+\n+]\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  check_manifest_ignores = """\n+#      "*.map.js",\n+#      "*.pyc",\n+#  """\n+##\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pyproject]\n+#  extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\ndiff --git a/setup.cfg b/setup.cfg\ndeleted file mode 100644\nindex 3e076fd9..00000000\n--- a/setup.cfg\n+++ /dev/null\n@@ -1,9 +0,0 @@\n-[bdist_wheel]\n-universal = 0\n-\n-[isort]\n-# black compatible Plone isort rules:\n-profile = black\n-force_alphabetical_sort = True\n-force_single_line = True\n-lines_after_imports = 2\ndiff --git a/setup.py b/setup.py\nindex fc1f1425..60acf6d7 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -38,23 +38,41 @@\n     namespace_packages=["plone", "plone.app"],\n     include_package_data=True,\n     zip_safe=False,\n+    python_requires=">=3.8",\n     extras_require=dict(\n         test=[\n-            "plone.app.contenttypes",\n+            "plone.app.contenttypes[test]",\n             "plone.app.testing",\n+            "plone.dexterity",\n+            "plone.namedfile",\n+            "plone.testing",\n+            "zope.annotation",\n+            "Products.GenericSetup",\n         ]\n     ),\n     install_requires=[\n+        "plone.app.dexterity",\n+        "plone.app.querystring",\n+        "plone.app.uuid",\n+        "plone.app.vocabularies>4.1.2",\n         "plone.app.widgets",\n+        "plone.app.z3cform",\n+        "plone.autoform",\n         "plone.base",\n         "plone.i18n",\n+        "plone.folder",\n+        "plone.locking",\n         "plone.memoize",\n         "plone.protect",\n+        "plone.supermodel",\n+        "plone.uuid",\n+        "Missing",\n+        "Products.MimetypesRegistry",\n+        "Products.PortalTransforms",\n         "Products.statusmessages",\n-        "Products.CMFDynamicViewFTI",  # required for cmf.ModifyViewTemplate\n-        "plone.app.vocabularies>4.1.2",\n-        "setuptools",\n         "simplejson",\n+        "z3c.relationfield",\n         "z3c.form",\n+        "zope.browsermenu",\n     ],\n )\ndiff --git a/tox.ini b/tox.ini\nnew file mode 100644\nindex 00000000..cbb3425e\n--- /dev/null\n+++ b/tox.ini\n@@ -0,0 +1,208 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/master/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+[tox]\n+# We need 4.4.0 for constrain_package_deps.\n+min_version = 4.4.0\n+envlist =\n+    lint\n+    test\n+    dependencies\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [tox]\n+#  envlist_lines = """\n+#      my_other_environment\n+#  """\n+#  config_lines = """\n+#  my_extra_top_level_tox_configuration_lines\n+#  """\n+##\n+\n+[testenv]\n+skip_install = true\n+allowlist_externals =\n+    echo\n+    false\n+# Make sure typos like `tox -e formaat` are caught instead of silently doing nothing.\n+# See https://github.com/tox-dev/tox/issues/2858.\n+commands =\n+    echo "Unrecognized environment name {envname}"\n+    false\n+\n+[testenv:init]\n+description = Prepare environment\n+skip_install = true\n+commands =\n+    echo "Initial setup complete"\n+\n+\n+[testenv:format]\n+description = automatically reformat code\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a pyupgrade\n+    pre-commit run -a isort\n+    pre-commit run -a black\n+    pre-commit run -a zpretty\n+\n+[testenv:lint]\n+description = run linters that will help improve the code style\n+skip_install = true\n+deps =\n+    pre-commit\n+commands =\n+    pre-commit run -a\n+\n+[testenv:dependencies]\n+description = check if the package defines all its dependencies\n+skip_install = true\n+deps =\n+    build\n+    z3c.dependencychecker==2.11\n+commands =\n+    python -m build --sdist --no-isolation\n+    dependencychecker\n+\n+[testenv:dependencies-graph]\n+description = generate a graph out of the dependencies of the package\n+skip_install = false\n+allowlist_externals =\n+    sh\n+deps =\n+    pipdeptree==2.5.1\n+    graphviz  # optional dependency of pipdeptree\n+commands =\n+    sh -c \'pipdeptree --exclude setuptools,wheel,pipdeptree,zope.interface,zope.component --graph-output svg > dependencies.svg\'\n+\n+[testenv:test]\n+description = run the distribution tests\n+use_develop = true\n+skip_install = false\n+constrain_package_deps = true\n+set_env =\n+    ROBOT_BROWSER=headlesschrome\n+\n+##\n+# Specify extra test environment variables in .meta.toml:\n+#  [tox]\n+#  test_environment_variables = """\n+#      PIP_EXTRA_INDEX_URL=https://my-pypi.my-server.com/\n+#  """\n+#\n+# Set constrain_package_deps .meta.toml:\n+#  [tox]\n+#  constrain_package_deps = "false"\n+##\n+deps =\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+    \n+##\n+# Specify additional deps in .meta.toml:\n+#  [tox]\n+#  test_deps_additional = "-esources/plonegovbr.portal_base[test]"\n+#\n+# Specify a custom constraints file in .meta.toml:\n+#  [tox]\n+#  constraints_file = "https://my-server.com/constraints.txt"\n+##\n+commands =\n+    zope-testrunner --all --test-path={toxinidir} -s plone.app.content {posargs}\n+extras =\n+    test\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [tox]\n+#  test_extras = """\n+#      tests\n+#      widgets\n+#  """\n+##\n+\n+[testenv:coverage]\n+description = get a test coverage report\n+use_develop = true\n+skip_install = false\n+constrain_package_deps = true\n+set_env =\n+    ROBOT_BROWSER=headlesschrome\n+\n+##\n+# Specify extra test environment variables in .meta.toml:\n+#  [tox]\n+#  test_environment_variables = """\n+#      PIP_EXTRA_INDEX_URL=https://my-pypi.my-server.com/\n+#  """\n+##\n+deps =\n+    coverage\n+    zope.testrunner\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+    \n+commands =\n+    coverage run --branch --source plone.app.content {envbindir}/zope-testrunner --quiet --all --test-path={toxinidir} -s plone.app.content {posargs}\n+    coverage report -m --format markdown\n+    coverage xml\n+extras =\n+    test\n+\n+\n+[testenv:release-check]\n+description = ensure that the distribution is ready to release\n+skip_install = true\n+deps =\n+    twine\n+    build\n+    towncrier\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+    \n+commands =\n+    # fake version to not have to install the package\n+    # we build the change log as news entries might break\n+    # the README that is displayed on PyPI\n+    towncrier build --version=100.0.0 --yes\n+    python -m build --sdist --no-isolation\n+    twine check dist/*\n+\n+[testenv:circular]\n+description = ensure there are no cyclic dependencies\n+use_develop = true\n+skip_install = false\n+set_env =\n+\n+##\n+# Specify extra test environment variables in .meta.toml:\n+#  [tox]\n+#  test_environment_variables = """\n+#      PIP_EXTRA_INDEX_URL=https://my-pypi.my-server.com/\n+#  """\n+##\n+allowlist_externals =\n+    sh\n+deps =\n+    pipdeptree\n+    pipforester\n+    -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+    \n+commands =\n+    # Generate the full dependency tree\n+    sh -c \'pipdeptree -j > forest.json\'\n+    # Generate a DOT graph with the circular dependencies, if any\n+    pipforester -i forest.json -o forest.dot --cycles\n+    # Report if there are any circular dependencies, i.e. error if there are any\n+    pipforester -i forest.json --check-cycles -o /dev/null\n+\n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [tox]\n+#  extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\n'

