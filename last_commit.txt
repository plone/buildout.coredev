Repository: Products.PlonePAS


Branch: refs/heads/master
Date: 2023-05-23T07:47:45+02:00
Author: Thomas Schorr (tschorr) <t_schorr@gmx.de>
Commit: https://github.com/plone/Products.PlonePAS/commit/d6d1490976570748cef552b520bf38609675004f

simplify error handling + translate message

Files changed:
M src/Products/PlonePAS/plugins/passwordpolicy.py

b'diff --git a/src/Products/PlonePAS/plugins/passwordpolicy.py b/src/Products/PlonePAS/plugins/passwordpolicy.py\nindex 5162b2c4..50661696 100644\n--- a/src/Products/PlonePAS/plugins/passwordpolicy.py\n+++ b/src/Products/PlonePAS/plugins/passwordpolicy.py\n@@ -7,6 +7,7 @@\n from Products.PageTemplates.PageTemplateFile import PageTemplateFile\n from Products.PluggableAuthService.interfaces.plugins import IValidationPlugin\n from Products.PluggableAuthService.plugins.BasePlugin import BasePlugin\n+from zope.i18n import translate\n from zope.i18nmessageid import MessageFactory\n from zope.interface import implementer\n \n@@ -57,24 +58,14 @@ def validateUserInfo(self, user, set_id, set_info):\n         password = set_info.get("password", None)\n         if password is None:\n             return []\n-        elif password == "":\n-            return [\n-                {\n-                    "id": "password",\n-                    "error": _(\n-                        "Minimum ${min_chars} characters.",\n-                        mapping={"min_chars": str(self.min_chars)},\n-                    ),\n-                }\n-            ]\n         elif len(password) < self.min_chars:\n             return [\n                 {\n                     "id": "password",\n-                    "error": _(\n+                    "error": translate(_(\n                         "Your password must contain at least ${min_chars} characters.",\n                         mapping={"min_chars": str(self.min_chars)},\n-                    ),\n+                    )),\n                 }\n             ]\n         else:\n'

Repository: Products.PlonePAS


Branch: refs/heads/master
Date: 2023-05-23T08:07:58+02:00
Author: Thomas Schorr (tschorr) <t_schorr@gmx.de>
Commit: https://github.com/plone/Products.PlonePAS/commit/d61f69599133e07fae9f46814b5d4c2c1b4cf78d

update changelog, black

Files changed:
A news/75.bugfix
M src/Products/PlonePAS/plugins/passwordpolicy.py

b'diff --git a/news/75.bugfix b/news/75.bugfix\nnew file mode 100644\nindex 00000000..20cfcf01\n--- /dev/null\n+++ b/news/75.bugfix\n@@ -0,0 +1 @@\n+Translate error message, simplify error handling. [tschorr]\ndiff --git a/src/Products/PlonePAS/plugins/passwordpolicy.py b/src/Products/PlonePAS/plugins/passwordpolicy.py\nindex 50661696..48fec282 100644\n--- a/src/Products/PlonePAS/plugins/passwordpolicy.py\n+++ b/src/Products/PlonePAS/plugins/passwordpolicy.py\n@@ -62,10 +62,12 @@ def validateUserInfo(self, user, set_id, set_info):\n             return [\n                 {\n                     "id": "password",\n-                    "error": translate(_(\n-                        "Your password must contain at least ${min_chars} characters.",\n-                        mapping={"min_chars": str(self.min_chars)},\n-                    )),\n+                    "error": translate(\n+                        _(\n+                            "Your password must contain at least ${min_chars} characters.",\n+                            mapping={"min_chars": str(self.min_chars)},\n+                        )\n+                    ),\n                 }\n             ]\n         else:\n'

Repository: Products.PlonePAS


Branch: refs/heads/master
Date: 2023-05-24T08:28:53+02:00
Author: Thomas Schorr (tschorr) <t_schorr@gmx.de>
Commit: https://github.com/plone/Products.PlonePAS/commit/2643099714095f971f70fe61a76d879c02756646

context

Files changed:
M src/Products/PlonePAS/plugins/passwordpolicy.py

b'diff --git a/src/Products/PlonePAS/plugins/passwordpolicy.py b/src/Products/PlonePAS/plugins/passwordpolicy.py\nindex 48fec282..9d84d1d8 100644\n--- a/src/Products/PlonePAS/plugins/passwordpolicy.py\n+++ b/src/Products/PlonePAS/plugins/passwordpolicy.py\n@@ -7,6 +7,7 @@\n from Products.PageTemplates.PageTemplateFile import PageTemplateFile\n from Products.PluggableAuthService.interfaces.plugins import IValidationPlugin\n from Products.PluggableAuthService.plugins.BasePlugin import BasePlugin\n+from zope.globalrequest import getRequest\n from zope.i18n import translate\n from zope.i18nmessageid import MessageFactory\n from zope.interface import implementer\n@@ -66,7 +67,8 @@ def validateUserInfo(self, user, set_id, set_info):\n                         _(\n                             "Your password must contain at least ${min_chars} characters.",\n                             mapping={"min_chars": str(self.min_chars)},\n-                        )\n+                        ),\n+                        context=getRequest(),\n                     ),\n                 }\n             ]\n'

Repository: Products.PlonePAS


Branch: refs/heads/master
Date: 2023-05-24T12:35:20+02:00
Author: Thomas Schorr (tschorr) <t_schorr@gmx.de>
Commit: https://github.com/plone/Products.PlonePAS/commit/3aed660e557291400e69ba53ba0b1a2cdf0b44b0

Merge pull request #75 from plone/tschorr_fix_error_msg

Translate error message, simplify error handling

Files changed:
A news/75.bugfix
M src/Products/PlonePAS/plugins/passwordpolicy.py

b'diff --git a/news/75.bugfix b/news/75.bugfix\nnew file mode 100644\nindex 00000000..20cfcf01\n--- /dev/null\n+++ b/news/75.bugfix\n@@ -0,0 +1 @@\n+Translate error message, simplify error handling. [tschorr]\ndiff --git a/src/Products/PlonePAS/plugins/passwordpolicy.py b/src/Products/PlonePAS/plugins/passwordpolicy.py\nindex 5162b2c4..9d84d1d8 100644\n--- a/src/Products/PlonePAS/plugins/passwordpolicy.py\n+++ b/src/Products/PlonePAS/plugins/passwordpolicy.py\n@@ -7,6 +7,8 @@\n from Products.PageTemplates.PageTemplateFile import PageTemplateFile\n from Products.PluggableAuthService.interfaces.plugins import IValidationPlugin\n from Products.PluggableAuthService.plugins.BasePlugin import BasePlugin\n+from zope.globalrequest import getRequest\n+from zope.i18n import translate\n from zope.i18nmessageid import MessageFactory\n from zope.interface import implementer\n \n@@ -57,23 +59,16 @@ def validateUserInfo(self, user, set_id, set_info):\n         password = set_info.get("password", None)\n         if password is None:\n             return []\n-        elif password == "":\n-            return [\n-                {\n-                    "id": "password",\n-                    "error": _(\n-                        "Minimum ${min_chars} characters.",\n-                        mapping={"min_chars": str(self.min_chars)},\n-                    ),\n-                }\n-            ]\n         elif len(password) < self.min_chars:\n             return [\n                 {\n                     "id": "password",\n-                    "error": _(\n-                        "Your password must contain at least ${min_chars} characters.",\n-                        mapping={"min_chars": str(self.min_chars)},\n+                    "error": translate(\n+                        _(\n+                            "Your password must contain at least ${min_chars} characters.",\n+                            mapping={"min_chars": str(self.min_chars)},\n+                        ),\n+                        context=getRequest(),\n                     ),\n                 }\n             ]\n'

