Repository: plone.restapi


Branch: refs/heads/main
Date: 2023-08-25T21:55:19+02:00
Author: Alin Voinea (avoinea) <contact@avoinea.com>
Commit: https://github.com/plone/plone.restapi/commit/a132711dcf3fef744dc3229827c413c91d82b9b3

[9.x.x] - Remove deprecated @unlock, @refresh-lock endpoints (#1235)

* Remove deprecated @unlock, @refresh-lock endpoints

* CHANGELOG entry

* Remove warnings from locking docs

* #1235 is a breaking change

* Add information about locking to upgrade guide

---------

Co-authored-by: Timo Stollenwerk &lt;stollenwerk@kitconcept.com&gt;
Co-authored-by: Timo Stollenwerk &lt;tisto@users.noreply.github.com&gt;

Files changed:
A news/1235.breaking
M docs/source/endpoints/locking.md
M docs/source/upgrade-guide.md
M src/plone/restapi/services/locking/configure.zcml
D src/plone/restapi/services/locking/locking.py

b'diff --git a/docs/source/endpoints/locking.md b/docs/source/endpoints/locking.md\nindex 0895168d75..8c864c7fa0 100644\n--- a/docs/source/endpoints/locking.md\n+++ b/docs/source/endpoints/locking.md\n@@ -23,7 +23,6 @@ The API consumer can create, read, update, and delete a content-type lock.\n | `PATCH`  | `/@lock` | Refresh existing lock                  |\n | `DELETE` | `/@lock` | Unlock an object                       |\n \n-\n ## Locking an object\n \n To lock an object, send a `POST` request to the `/@lock` endpoint that is available on any content object in Plone:\n@@ -59,7 +58,6 @@ The server responds with status {term}`200 OK` and returns the lock information:\n :language: http\n ```\n \n-\n ## Unlocking an object\n \n To unlock an object, send a `DELETE` request to the `/@lock` endpoint:\n@@ -88,11 +86,6 @@ The server responds with status {term}`200 OK` and returns the lock information:\n :language: http\n ```\n \n-```{warning}\n-The `@unlock` endpoint is deprecated and will be removed in `plone.restapi` 9.0.\n-```\n-\n-\n ## Refreshing a lock\n \n An existing lock can be refreshed by sending a `PATCH` request to the `@lock` endpoint:\n@@ -108,11 +101,6 @@ The server responds with status {term}`200 OK` and returns the lock information\n :language: http\n ```\n \n-```{warning}\n-The `@refresh-lock` endpoint is deprecated and will be removed in `plone.restapi` 9.0.\n-```\n-\n-\n ## Getting lock information\n \n To find out if an object is locked or to get information about the current lock, you can send a `GET` request to the `@lock` endpoint:\n@@ -128,7 +116,6 @@ The server responds with status {term}`200 OK` and returns the information about\n :language: http\n ```\n \n-\n ## Updating a locked object\n \n To update a locked object with a `PATCH` request, you have to provide the lock token with the `Lock-Token` header:\ndiff --git a/docs/source/upgrade-guide.md b/docs/source/upgrade-guide.md\nindex ec2a26e50f..546b31cc9c 100644\n--- a/docs/source/upgrade-guide.md\n+++ b/docs/source/upgrade-guide.md\n@@ -39,6 +39,19 @@ In `plone.restapi` 9.0.0, the following response would be returned with a `breac\n \n Pull Request: https://github.com/plone/plone.restapi/pull/1636\n \n+### Remove deprecated @unlock, @refresh-lock endpoints\n+\n+The deprecated @unlock and @refresh-unlock endpoints were removed in `plone.restapi` 9.\n+\n+Send a DELETE request to the @lock endpoint to release a lock (replaces the @unlock endpoint).\n+\n+Send a PATCH request to the @lock endpoint to refresh a lock (replaces the @refresh-unlock endpoint).\n+\n+See the documentation of the `@lock`endpoint for more information: https://plonerestapi.readthedocs.io/en/latest/endpoints/locking.html\n+\n+Pull Request: https://github.com/plone/plone.restapi/pull/1235\n+\n+\n ### Remove plone.tiles and the @tiles endpoint\n \n `plone.restapi` 9 removed the @tiles endpoint and removed the dependency to plone.tiles. The @tiles endpoint was deprecated since `plone.restapi` 8.\ndiff --git a/news/1235.breaking b/news/1235.breaking\nnew file mode 100644\nindex 0000000000..c2bb9cdec1\n--- /dev/null\n+++ b/news/1235.breaking\n@@ -0,0 +1 @@\n+Remove deprecated @unlock, @refresh-lock endpoints [@avoinea]\ndiff --git a/src/plone/restapi/services/locking/configure.zcml b/src/plone/restapi/services/locking/configure.zcml\nindex 2af53b1f2a..abfd584a77 100644\n--- a/src/plone/restapi/services/locking/configure.zcml\n+++ b/src/plone/restapi/services/locking/configure.zcml\n@@ -67,21 +67,4 @@\n       name="@lock"\n       />\n \n-  <!-- DEPRECATED -->\n-  <plone:service\n-      method="POST"\n-      factory=".locking.Unlock"\n-      for="Products.CMFCore.interfaces.IContentish"\n-      permission="cmf.ModifyPortalContent"\n-      name="@unlock"\n-      />\n-\n-  <plone:service\n-      method="POST"\n-      factory=".locking.RefreshLock"\n-      for="Products.CMFCore.interfaces.IContentish"\n-      permission="cmf.ModifyPortalContent"\n-      name="@refresh-lock"\n-      />\n-\n </configure>\ndiff --git a/src/plone/restapi/services/locking/locking.py b/src/plone/restapi/services/locking/locking.py\ndeleted file mode 100644\nindex b8019eaef8..0000000000\n--- a/src/plone/restapi/services/locking/locking.py\n+++ /dev/null\n@@ -1,68 +0,0 @@\n-from plone.restapi.services.locking import is_locked\n-from plone.restapi.services.locking import lock_info\n-from plone.restapi.services.locking import webdav_lock\n-from plone.restapi.services.locking.add import Lock as AddLock\n-from plone.restapi.services.locking.delete import Lock as DeleteLock\n-from plone.restapi.services.locking.get import Lock as GetLock\n-from plone.restapi.services.locking.update import Lock as UpdateLock\n-from zope.deprecation import deprecated\n-\n-import warnings\n-\n-\n-lock_info = deprecated(\n-    lock_info,\n-    "``plone.restapi.services.locking.locking.lock_info`` is deprecated and will be removed in plone.restapi 9.0. Use it from ``plone.restapi.services.locking`` instead.",\n-)\n-webdav_lock = deprecated(\n-    webdav_lock,\n-    "``plone.restapi.services.locking.locking.webdav_lock`` is deprecated and will be removed in plone.restapi 9.0. Use it from ``plone.restapi.services.locking`` instead.",\n-)\n-is_locked = deprecated(\n-    is_locked,\n-    "``plone.restapi.services.locking.locking.is_locked`` is deprecated and will be removed in plone.restapi 9.0. Use it from ``plone.restapi.services.locking`` instead.",\n-)\n-\n-\n-class Lock(AddLock):\n-    """Lock an object"""\n-\n-    def reply(self):\n-        warnings.warn(\n-            "``plone.restapi.services.locking.Lock`` is deprecated and will be removed in plone.restapi 9.0. Use it from ``plone.restapi.services.locking.update`` instead.",\n-            DeprecationWarning,\n-        )\n-        return super(Lock, self).reply()\n-\n-\n-class Unlock(DeleteLock):\n-    """Unlock an object"""\n-\n-    def reply(self):\n-        warnings.warn(\n-            "``POST @unlock`` endpoint is deprecated and will be removed in plone.restapi 9.0. Use ``DELETE @lock`` instead.",\n-            DeprecationWarning,\n-        )\n-        return super(Unlock, self).reply()\n-\n-\n-class RefreshLock(UpdateLock):\n-    """Refresh the lock of an object"""\n-\n-    def reply(self):\n-        warnings.warn(\n-            "``POST @refresh-lock`` endpoint is deprecated and will be removed in plone.restapi 9.0. Use ``PATCH @lock`` instead.",\n-            DeprecationWarning,\n-        )\n-        return super(RefreshLock, self).reply()\n-\n-\n-class LockInfo(GetLock):\n-    """Lock information about the current lock"""\n-\n-    def reply(self):\n-        warnings.warn(\n-            "``plone.restapi.services.locking.LockInfo`` is deprecated and will be removed in plone.restapi 9.0. Use it from ``plone.restapi.services.locking.get`` instead.",\n-            DeprecationWarning,\n-        )\n-        return super(LockInfo, self).reply()\n'

