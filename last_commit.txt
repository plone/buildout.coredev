Repository: plone.app.caching


Branch: refs/heads/2.x
Date: 2023-07-13T17:19:55+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/eb9afb8386651b2d782e22c988c24cfe19f668f1

chore: plone.testing.z2 -&gt; zope

Files changed:
M plone/app/caching/tests/test_integration.py
M plone/app/caching/tests/test_operation_default.py
M plone/app/caching/tests/test_operation_parameters.py
M plone/app/caching/tests/test_profile_with_caching_proxy.py
M plone/app/caching/tests/test_profile_without_caching_proxy.py

b'diff --git a/plone/app/caching/tests/test_integration.py b/plone/app/caching/tests/test_integration.py\nindex f861f65..60aff14 100644\n--- a/plone/app/caching/tests/test_integration.py\n+++ b/plone/app/caching/tests/test_integration.py\n@@ -15,7 +15,7 @@\n from plone.caching.interfaces import ICacheSettings\n from plone.namedfile.file import NamedImage\n from plone.registry.interfaces import IRegistry\n-from plone.testing.z2 import Browser\n+from plone.testing.zope import Browser\n from zope.component import getUtility\n from zope.globalrequest import setRequest\n \ndiff --git a/plone/app/caching/tests/test_operation_default.py b/plone/app/caching/tests/test_operation_default.py\nindex 51d2344..ddf3f26 100644\n--- a/plone/app/caching/tests/test_operation_default.py\n+++ b/plone/app/caching/tests/test_operation_default.py\n@@ -7,7 +7,7 @@\n from plone.app.testing import TEST_USER_PASSWORD\n from plone.caching.interfaces import ICacheSettings\n from plone.registry.interfaces import IRegistry\n-from plone.testing.z2 import Browser\n+from plone.testing.zope import Browser\n from zope.component import getUtility\n from zope.globalrequest import setRequest\n \ndiff --git a/plone/app/caching/tests/test_operation_parameters.py b/plone/app/caching/tests/test_operation_parameters.py\nindex 5bbb5f4..8148e63 100644\n--- a/plone/app/caching/tests/test_operation_parameters.py\n+++ b/plone/app/caching/tests/test_operation_parameters.py\n@@ -7,7 +7,7 @@\n from plone.app.textfield.value import RichTextValue\n from plone.caching.interfaces import ICacheSettings\n from plone.registry.interfaces import IRegistry\n-from plone.testing.z2 import Browser\n+from plone.testing.zope import Browser\n from zope.component import getUtility\n from zope.globalrequest import setRequest\n \ndiff --git a/plone/app/caching/tests/test_profile_with_caching_proxy.py b/plone/app/caching/tests/test_profile_with_caching_proxy.py\nindex 7ba7833..881e514 100644\n--- a/plone/app/caching/tests/test_profile_with_caching_proxy.py\n+++ b/plone/app/caching/tests/test_profile_with_caching_proxy.py\n@@ -16,7 +16,7 @@\n from plone.cachepurging.interfaces import IPurger\n from plone.caching.interfaces import ICacheSettings\n from plone.registry.interfaces import IRegistry\n-from plone.testing.z2 import Browser\n+from plone.testing.zope import Browser\n from Products.CMFCore.FSFile import FSFile\n from Products.CMFCore.utils import getToolByName\n from zope.component import getUtility\ndiff --git a/plone/app/caching/tests/test_profile_without_caching_proxy.py b/plone/app/caching/tests/test_profile_without_caching_proxy.py\nindex 260baca..91c3cf6 100644\n--- a/plone/app/caching/tests/test_profile_without_caching_proxy.py\n+++ b/plone/app/caching/tests/test_profile_without_caching_proxy.py\n@@ -13,7 +13,7 @@\n from plone.cachepurging.interfaces import ICachePurgingSettings\n from plone.caching.interfaces import ICacheSettings\n from plone.registry.interfaces import IRegistry\n-from plone.testing.z2 import Browser\n+from plone.testing.zope import Browser\n from Products.CMFCore.utils import getToolByName\n from zope.component import getUtility\n from zope.globalrequest import setRequest\n'

Repository: plone.app.caching


Branch: refs/heads/2.x
Date: 2023-07-13T17:20:02+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/4164ded5b196895f7dc6111903eadb08f68fa243

Removed 'xx' from end of test method.

Files changed:
M plone/app/caching/tests/test_profile_with_caching_proxy.py

b"diff --git a/plone/app/caching/tests/test_profile_with_caching_proxy.py b/plone/app/caching/tests/test_profile_with_caching_proxy.py\nindex 881e514..48b4937 100644\n--- a/plone/app/caching/tests/test_profile_with_caching_proxy.py\n+++ b/plone/app/caching/tests/test_profile_with_caching_proxy.py\n@@ -69,7 +69,7 @@ def setUp(self):\n     def tearDown(self):\n         setRequest(None)\n \n-    def test_composite_viewsxx(self):\n+    def test_composite_views(self):\n         # This is a clone of the same test for 'without-caching-proxy'\n         # Can we just call that test from this context?\n \n"

Repository: plone.app.caching


Branch: refs/heads/2.x
Date: 2023-07-13T17:24:21+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/463c5a023dcde1d011ed75ffad08566864f806e4

Fixed tests that compared a stable time with a ten year old Expires handler.

Fixes https://github.com/plone/plone.app.caching/issues/127

Files changed:
A news/127.bugfix
M plone/app/caching/tests/test_utils.py
D news/127.tests

b'diff --git a/news/127.bugfix b/news/127.bugfix\nnew file mode 100644\nindex 0000000..11982de\n--- /dev/null\n+++ b/news/127.bugfix\n@@ -0,0 +1,2 @@\n+Fixed tests that compared a stable time with a ten year old Expires handler.\n+[maurits]\ndiff --git a/news/127.tests b/news/127.tests\ndeleted file mode 100644\nindex dd7ae0a..0000000\n--- a/news/127.tests\n+++ /dev/null\n@@ -1,4 +0,0 @@\n-Changed hardcoded test date to June instead of May to temporarily fix a testing error.\n-See `issue 127 <https://github.com/plone/plone.app.caching/issues/127>`_.\n-Needs a proper fix within a month.\n-[maurits]\ndiff --git a/plone/app/caching/tests/test_utils.py b/plone/app/caching/tests/test_utils.py\nindex 9b7d320..c4a9830 100644\n--- a/plone/app/caching/tests/test_utils.py\n+++ b/plone/app/caching/tests/test_utils.py\n@@ -2,6 +2,7 @@\n from Acquisition import Explicit\n from datetime import date\n from datetime import datetime\n+from datetime import timedelta\n from plone.app.caching.interfaces import IPloneCacheSettings\n from plone.app.caching.utils import getObjectDefaultView\n from plone.app.caching.utils import isPurged\n@@ -28,9 +29,13 @@\n \n def stable_now():\n     """Patch localized_now to allow stable results in tests.\n+\n+    Note that a fixed date is not good enough:\n+    several tests compare this date with an Expires header,\n+    and this header may be set to ten years ago.\n     """\n     tzinfo = pytz.timezone(TEST_TIMEZONE)\n-    now = datetime(2013, 6, 5, 10, 0, 0).replace(microsecond=0)\n+    now = datetime.now() - timedelta(days=1000)\n     now = tzinfo.localize(now)  # set tzinfo with correct DST offset\n     return now\n \n'

Repository: plone.app.caching


Branch: refs/heads/2.x
Date: 2023-07-13T18:13:28+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/98ca498694fa3003dcdc460dde1112683764df35

Merge pull request #135 from plone/maurits-fix-test-plone-52

Fixed tests that compared a stable time with a ten year old Expires handler. [5.2]

Files changed:
A news/127.bugfix
M plone/app/caching/tests/test_integration.py
M plone/app/caching/tests/test_operation_default.py
M plone/app/caching/tests/test_operation_parameters.py
M plone/app/caching/tests/test_profile_with_caching_proxy.py
M plone/app/caching/tests/test_profile_without_caching_proxy.py
M plone/app/caching/tests/test_utils.py
D news/127.tests

b'diff --git a/news/127.bugfix b/news/127.bugfix\nnew file mode 100644\nindex 0000000..11982de\n--- /dev/null\n+++ b/news/127.bugfix\n@@ -0,0 +1,2 @@\n+Fixed tests that compared a stable time with a ten year old Expires handler.\n+[maurits]\ndiff --git a/news/127.tests b/news/127.tests\ndeleted file mode 100644\nindex dd7ae0a..0000000\n--- a/news/127.tests\n+++ /dev/null\n@@ -1,4 +0,0 @@\n-Changed hardcoded test date to June instead of May to temporarily fix a testing error.\n-See `issue 127 <https://github.com/plone/plone.app.caching/issues/127>`_.\n-Needs a proper fix within a month.\n-[maurits]\ndiff --git a/plone/app/caching/tests/test_integration.py b/plone/app/caching/tests/test_integration.py\nindex f861f65..60aff14 100644\n--- a/plone/app/caching/tests/test_integration.py\n+++ b/plone/app/caching/tests/test_integration.py\n@@ -15,7 +15,7 @@\n from plone.caching.interfaces import ICacheSettings\n from plone.namedfile.file import NamedImage\n from plone.registry.interfaces import IRegistry\n-from plone.testing.z2 import Browser\n+from plone.testing.zope import Browser\n from zope.component import getUtility\n from zope.globalrequest import setRequest\n \ndiff --git a/plone/app/caching/tests/test_operation_default.py b/plone/app/caching/tests/test_operation_default.py\nindex 51d2344..ddf3f26 100644\n--- a/plone/app/caching/tests/test_operation_default.py\n+++ b/plone/app/caching/tests/test_operation_default.py\n@@ -7,7 +7,7 @@\n from plone.app.testing import TEST_USER_PASSWORD\n from plone.caching.interfaces import ICacheSettings\n from plone.registry.interfaces import IRegistry\n-from plone.testing.z2 import Browser\n+from plone.testing.zope import Browser\n from zope.component import getUtility\n from zope.globalrequest import setRequest\n \ndiff --git a/plone/app/caching/tests/test_operation_parameters.py b/plone/app/caching/tests/test_operation_parameters.py\nindex 5bbb5f4..8148e63 100644\n--- a/plone/app/caching/tests/test_operation_parameters.py\n+++ b/plone/app/caching/tests/test_operation_parameters.py\n@@ -7,7 +7,7 @@\n from plone.app.textfield.value import RichTextValue\n from plone.caching.interfaces import ICacheSettings\n from plone.registry.interfaces import IRegistry\n-from plone.testing.z2 import Browser\n+from plone.testing.zope import Browser\n from zope.component import getUtility\n from zope.globalrequest import setRequest\n \ndiff --git a/plone/app/caching/tests/test_profile_with_caching_proxy.py b/plone/app/caching/tests/test_profile_with_caching_proxy.py\nindex 7ba7833..48b4937 100644\n--- a/plone/app/caching/tests/test_profile_with_caching_proxy.py\n+++ b/plone/app/caching/tests/test_profile_with_caching_proxy.py\n@@ -16,7 +16,7 @@\n from plone.cachepurging.interfaces import IPurger\n from plone.caching.interfaces import ICacheSettings\n from plone.registry.interfaces import IRegistry\n-from plone.testing.z2 import Browser\n+from plone.testing.zope import Browser\n from Products.CMFCore.FSFile import FSFile\n from Products.CMFCore.utils import getToolByName\n from zope.component import getUtility\n@@ -69,7 +69,7 @@ def setUp(self):\n     def tearDown(self):\n         setRequest(None)\n \n-    def test_composite_viewsxx(self):\n+    def test_composite_views(self):\n         # This is a clone of the same test for \'without-caching-proxy\'\n         # Can we just call that test from this context?\n \ndiff --git a/plone/app/caching/tests/test_profile_without_caching_proxy.py b/plone/app/caching/tests/test_profile_without_caching_proxy.py\nindex 260baca..91c3cf6 100644\n--- a/plone/app/caching/tests/test_profile_without_caching_proxy.py\n+++ b/plone/app/caching/tests/test_profile_without_caching_proxy.py\n@@ -13,7 +13,7 @@\n from plone.cachepurging.interfaces import ICachePurgingSettings\n from plone.caching.interfaces import ICacheSettings\n from plone.registry.interfaces import IRegistry\n-from plone.testing.z2 import Browser\n+from plone.testing.zope import Browser\n from Products.CMFCore.utils import getToolByName\n from zope.component import getUtility\n from zope.globalrequest import setRequest\ndiff --git a/plone/app/caching/tests/test_utils.py b/plone/app/caching/tests/test_utils.py\nindex 9b7d320..c4a9830 100644\n--- a/plone/app/caching/tests/test_utils.py\n+++ b/plone/app/caching/tests/test_utils.py\n@@ -2,6 +2,7 @@\n from Acquisition import Explicit\n from datetime import date\n from datetime import datetime\n+from datetime import timedelta\n from plone.app.caching.interfaces import IPloneCacheSettings\n from plone.app.caching.utils import getObjectDefaultView\n from plone.app.caching.utils import isPurged\n@@ -28,9 +29,13 @@\n \n def stable_now():\n     """Patch localized_now to allow stable results in tests.\n+\n+    Note that a fixed date is not good enough:\n+    several tests compare this date with an Expires header,\n+    and this header may be set to ten years ago.\n     """\n     tzinfo = pytz.timezone(TEST_TIMEZONE)\n-    now = datetime(2013, 6, 5, 10, 0, 0).replace(microsecond=0)\n+    now = datetime.now() - timedelta(days=1000)\n     now = tzinfo.localize(now)  # set tzinfo with correct DST offset\n     return now\n \n'

