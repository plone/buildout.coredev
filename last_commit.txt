Repository: plone.portlet.static


Branch: refs/heads/master
Date: 2020-09-09T23:30:45+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.portlet.static/commit/1d0aea1937000607c28196486bd92b83485de8f2

Removed Plone 4 compatibility code.

Files changed:
A news/19.bugfix
M plone/portlet/static/static.py

b'diff --git a/news/19.bugfix b/news/19.bugfix\nnew file mode 100644\nindex 0000000..eb61532\n--- /dev/null\n+++ b/news/19.bugfix\n@@ -0,0 +1,2 @@\n+Removed Plone 4 compatibility code.\n+[maurits]\ndiff --git a/plone/portlet/static/static.py b/plone/portlet/static/static.py\nindex 35ca86d..30d5101 100644\n--- a/plone/portlet/static/static.py\n+++ b/plone/portlet/static/static.py\n@@ -3,13 +3,12 @@\n from plone.app.portlets.portlets import base\n from plone.app.textfield import RichText\n from plone.app.textfield.value import RichTextValue\n+from plone.app.z3cform.widget import RichTextFieldWidget\n from plone.autoform import directives\n-from plone.autoform.form import AutoExtensibleForm\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.portlet.static import PloneMessageFactory as _\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.utils import getFSVersionTuple\n from Products.CMFPlone.utils import safe_unicode\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\n@@ -22,35 +21,6 @@\n \n \n logger = logging.getLogger(\'plone.portlet.static\')\n-WIDGETS_1X = False\n-PLONE5 = getFSVersionTuple()[0] >= 5\n-\n-if PLONE5:\n-    from plone.app.z3cform.widget import RichTextFieldWidget\n-    base_AddForm = base.AddForm\n-    base_EditForm = base.EditForm\n-else:\n-    # PLONE 4 Support:\n-    # Either Plone 4 plus compatible plone.app.widgets, or Plone 4.x without:\n-    from plone.app.portlets.browser import z3cformhelper\n-    from z3c.form import field\n-    try:\n-        from plone.app.widgets.dx import RichTextFieldWidget  # req >= 1.9.1+\n-\n-        class base_AddForm(AutoExtensibleForm, z3cformhelper.AddForm):\n-            pass\n-\n-        class base_EditForm(AutoExtensibleForm, z3cformhelper.EditForm):\n-            pass\n-\n-        WIDGETS_1X = True\n-    except ImportError:\n-        WIDGETS_1X = False\n-        base_AddForm = z3cformhelper.AddForm\n-        base_EditForm = z3cformhelper.EditForm\n-\n-\n-USE_AUTOFORM = PLONE5 or WIDGETS_1X\n \n \n class IStaticPortlet(IPortletDataProvider):\n@@ -192,16 +162,13 @@ def transformed(self, mt=\'text/x-html-safe\'):\n         return None\n \n \n-class AddForm(base_AddForm):\n+class AddForm(base.AddForm):\n     """Portlet add form.\n \n     This is registered in configure.zcml. The create() method actually\n     constructs the assignment that is being added.\n     """\n-    if USE_AUTOFORM:\n-        schema = IStaticPortlet\n-    else:\n-        fields = field.Fields(IStaticPortlet)\n+    schema = IStaticPortlet\n \n     label = _(u"title_add_static_portlet", default=u"Add static text portlet")\n     description = _(\n@@ -213,15 +180,12 @@ def create(self, data):\n         return Assignment(**data)\n \n \n-class EditForm(base_EditForm):\n+class EditForm(base.EditForm):\n     """Portlet edit form\n \n     This is registered in configure.zcml.\n     """\n-    if USE_AUTOFORM:\n-        schema = IStaticPortlet\n-    else:\n-        fields = field.Fields(IStaticPortlet)\n+    schema = IStaticPortlet\n \n     label = _(\n         u"title_edit_static_portlet",\n'

Repository: plone.portlet.static


Branch: refs/heads/master
Date: 2020-09-10T12:49:01+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.portlet.static/commit/816be3cac982af516bb4c0fde87210dceeed4860

Merge pull request #19 from plone/maurits/remove-plone4-compat-code

Removed Plone 4 compatibility code.

Files changed:
A news/19.bugfix
M plone/portlet/static/static.py

b'diff --git a/news/19.bugfix b/news/19.bugfix\nnew file mode 100644\nindex 0000000..eb61532\n--- /dev/null\n+++ b/news/19.bugfix\n@@ -0,0 +1,2 @@\n+Removed Plone 4 compatibility code.\n+[maurits]\ndiff --git a/plone/portlet/static/static.py b/plone/portlet/static/static.py\nindex 95127d3..ad5da71 100644\n--- a/plone/portlet/static/static.py\n+++ b/plone/portlet/static/static.py\n@@ -3,13 +3,12 @@\n from plone.app.portlets.portlets import base\n from plone.app.textfield import RichText\n from plone.app.textfield.value import RichTextValue\n+from plone.app.z3cform.widget import RichTextFieldWidget\n from plone.autoform import directives\n-from plone.autoform.form import AutoExtensibleForm\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.portlet.static import PloneMessageFactory as _\n from plone.portlets.interfaces import IPortletDataProvider\n from Products.CMFCore.utils import getToolByName\n-from Products.CMFPlone.utils import getFSVersionTuple\n from Products.CMFPlone.utils import safe_unicode\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from zope import schema\n@@ -22,35 +21,6 @@\n \n \n logger = logging.getLogger(\'plone.portlet.static\')\n-WIDGETS_1X = False\n-PLONE5 = getFSVersionTuple()[0] >= 5\n-\n-if PLONE5:\n-    from plone.app.z3cform.widget import RichTextFieldWidget\n-    base_AddForm = base.AddForm\n-    base_EditForm = base.EditForm\n-else:\n-    # PLONE 4 Support:\n-    # Either Plone 4 plus compatible plone.app.widgets, or Plone 4.x without:\n-    from plone.app.portlets.browser import z3cformhelper\n-    from z3c.form import field\n-    try:\n-        from plone.app.widgets.dx import RichTextFieldWidget  # req >= 1.9.1+\n-\n-        class base_AddForm(AutoExtensibleForm, z3cformhelper.AddForm):\n-            pass\n-\n-        class base_EditForm(AutoExtensibleForm, z3cformhelper.EditForm):\n-            pass\n-\n-        WIDGETS_1X = True\n-    except ImportError:\n-        WIDGETS_1X = False\n-        base_AddForm = z3cformhelper.AddForm\n-        base_EditForm = z3cformhelper.EditForm\n-\n-\n-USE_AUTOFORM = PLONE5 or WIDGETS_1X\n \n \n class IStaticPortlet(IPortletDataProvider):\n@@ -192,16 +162,13 @@ def transformed(self, mt=\'text/x-html-safe\'):\n         return None\n \n \n-class AddForm(base_AddForm):\n+class AddForm(base.AddForm):\n     """Portlet add form.\n \n     This is registered in configure.zcml. The create() method actually\n     constructs the assignment that is being added.\n     """\n-    if USE_AUTOFORM:\n-        schema = IStaticPortlet\n-    else:\n-        fields = field.Fields(IStaticPortlet)\n+    schema = IStaticPortlet\n \n     label = _(u"title_add_static_portlet", default=u"Add static text portlet")\n     description = _(\n@@ -213,15 +180,12 @@ def create(self, data):\n         return Assignment(**data)\n \n \n-class EditForm(base_EditForm):\n+class EditForm(base.EditForm):\n     """Portlet edit form\n \n     This is registered in configure.zcml.\n     """\n-    if USE_AUTOFORM:\n-        schema = IStaticPortlet\n-    else:\n-        fields = field.Fields(IStaticPortlet)\n+    schema = IStaticPortlet\n \n     label = _(\n         u"title_edit_static_portlet",\n'

