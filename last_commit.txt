Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-06-29T09:13:12+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.restapi/commit/f0dc94d85036729b8adc7e312a59f60877a3210e

remove the use of plone.api in upgrade code (#973)

Files changed:
A news/917.bugfix
M src/plone/restapi/upgrades/ordering.py

b'diff --git a/news/917.bugfix b/news/917.bugfix\nnew file mode 100644\nindex 000000000..ef50ca1a0\n--- /dev/null\n+++ b/news/917.bugfix\n@@ -0,0 +1,2 @@\n+Remove the use of plone.api in upgrade code\n+[erral]\n\\ No newline at end of file\ndiff --git a/src/plone/restapi/upgrades/ordering.py b/src/plone/restapi/upgrades/ordering.py\nindex 916e57dc7..db7692a54 100644\n--- a/src/plone/restapi/upgrades/ordering.py\n+++ b/src/plone/restapi/upgrades/ordering.py\n@@ -1,7 +1,7 @@\n # -*- coding: utf-8 -*-\n from persistent.list import PersistentList\n-from plone import api\n from plone.folder.default import DefaultOrdering\n+from Products.CMFCore.utils import getToolByName\n from Products.Five.browser import BrowserView\n from zope.annotation.interfaces import IAnnotatable\n from zope.annotation.interfaces import IAnnotations\n@@ -64,7 +64,7 @@ def __call__(self):\n         if six.PY3:\n             return "Aborted, fixing ordering is only necessary on python 2."\n \n-        catalog = api.portal.get_tool("portal_catalog")\n+        catalog = getToolByName(self.context, "portal_catalog")\n         for brain in catalog.unrestrictedSearchResults(QUERY):\n             folderish = brain.getObject()\n             ensure_child_ordering_object_ids_are_native_strings(folderish)\n'

