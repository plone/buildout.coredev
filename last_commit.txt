Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2021-01-12T15:02:25+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.contenttypes/commit/bdd7bf1ca7a9e89bcfddcab274a2aeecee8869ba

migrate_datetimefield: do nothing when old value is None.

This fixes `AttributeError: 'NoneType' object has no attribute 'asdatetime'`.

Files changed:
A news/584.bugfix
M plone/app/contenttypes/migration/field_migrators.py

b'diff --git a/news/584.bugfix b/news/584.bugfix\nnew file mode 100644\nindex 00000000..45024b81\n--- /dev/null\n+++ b/news/584.bugfix\n@@ -0,0 +1,3 @@\n+migrate_datetimefield: do nothing when old value is None.\n+This fixes ``AttributeError: \'NoneType\' object has no attribute \'asdatetime\'``.\n+[maurits]\ndiff --git a/plone/app/contenttypes/migration/field_migrators.py b/plone/app/contenttypes/migration/field_migrators.py\nindex fad4c1dd..d4be41ab 100644\n--- a/plone/app/contenttypes/migration/field_migrators.py\n+++ b/plone/app/contenttypes/migration/field_migrators.py\n@@ -148,7 +148,7 @@ def migrate_filefield(src_obj, dst_obj, src_fieldname, dst_fieldname):\n def migrate_datetimefield(src_obj, dst_obj, src_fieldname, dst_fieldname):\n     """Migrate a datefield."""\n     old_value = src_obj.getField(src_fieldname).get(src_obj)\n-    if old_value == \'\':\n+    if old_value == \'\' or old_value is None:\n         return\n     if src_obj.getField(\'timezone\', None) is not None:\n         old_timezone = src_obj.getField(\'timezone\').get(src_obj)\n'

