Repository: plone.app.discussion


Branch: refs/heads/main
Date: 2024-10-17T09:36:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.discussion/commit/bd7bd170db8d52693396b7cf4676ccd755db230b

feat(robot): use playwright

Files changed:
A plone/app/discussion/tests/robot/keywords.robot
M plone/app/discussion/tests/robot/test_discussion.robot
M plone/app/discussion/tests/robot/test_moderation.robot

b'diff --git a/plone/app/discussion/tests/robot/keywords.robot b/plone/app/discussion/tests/robot/keywords.robot\nnew file mode 100644\nindex 00000000..dbbe3164\n--- /dev/null\n+++ b/plone/app/discussion/tests/robot/keywords.robot\n@@ -0,0 +1,16 @@\n+*** Keywords ***\n+\n+I enable discussion on the document\n+  Go To  ${PLONE_URL}/my-document/edit\n+  Get Text  body  contains  Settings\n+  Click  .autotoc-nav >> "Settings"\n+  Select Options By  id=formfield-form-widgets-IAllowDiscussion-allow_discussion >> select  text  Yes\n+  Click  "Save"\n+\n+I add a comment\n+  Fill Text  id=form-widgets-comment-text  This is a comment\n+  Click  css=button[name="form.buttons.comment"]\n+\n+I can see that the comment is gone\n+  Go To  ${PLONE_URL}/my-document/view\n+  Get Element Count  css=.comment-body  ==  0\ndiff --git a/plone/app/discussion/tests/robot/test_discussion.robot b/plone/app/discussion/tests/robot/test_discussion.robot\nindex 54b8f4a1..28160575 100644\n--- a/plone/app/discussion/tests/robot/test_discussion.robot\n+++ b/plone/app/discussion/tests/robot/test_discussion.robot\n@@ -1,23 +1,13 @@\n-# ============================================================================\n-# Test basic discussion features (adding, replying, deleting)\n-# ============================================================================\n-#\n-# $ bin/robot-server plone.app.discussion.testing.PLONE_APP_DISCUSSION_ROBOT_TESTING\n-# $ bin/robot src/plone.app.discussion/src/plone/app/discussion/tests/robot/test_discussion.robot\n-#\n-# ============================================================================\n-\n *** Settings ***\n \n-Resource  plone/app/robotframework/saucelabs.robot\n-Resource  plone/app/robotframework/selenium.robot\n+Resource  plone/app/robotframework/browser.robot\n+Resource  keywords.robot\n \n Library  Remote  ${PLONE_URL}/RobotRemote\n \n Test Setup  Run Keywords  Plone test setup\n Test Teardown  Run keywords  Plone test teardown\n \n-\n *** Test Cases ***\n \n Enable Discussion on a Document\n@@ -35,11 +25,16 @@ Add Comment to a Document\n Reply to a comment on a Document\n   Given a logged-in Site Administrator\n     and a document with discussion enabled\n+    and I add a comment\n+   When I reply to a comment\n+   Then I can see the reply\n \n Delete Comment from a Document\n   Given a logged-in Site Administrator\n     and a document with discussion enabled\n-\n+    and I add a comment\n+   When I delete the comment\n+   Then I can see that the comment is gone\n \n *** Keywords ***\n \n@@ -58,28 +53,26 @@ a document with discussion enabled\n \n # When\n \n-I enable discussion on the document\n-  Go To  ${PLONE_URL}/my-document/edit\n-  Wait until page contains  Settings\n-  Click Link  Settings\n-  Wait until element is visible  name=form.widgets.IAllowDiscussion.allow_discussion:list\n-  Select From List By Value  name=form.widgets.IAllowDiscussion.allow_discussion:list  True\n-  Click Button  Save\n-\n-I add a comment\n-  Wait until page contains element  id=form-widgets-comment-text\n-  Input Text  id=form-widgets-comment-text  This is a comment\n-  Click Button  Comment\n+I reply to a comment\n+  Click  "Reply"\n+  Fill Text  css=div[id^=formfield-form-widgets-new] > textarea  My reply text\n+  Click  css=.discussion button[name="form.buttons.comment"]\n \n+I delete the comment\n+  Click  css=button[name="form.button.DeleteComment"]\n \n # Then\n \n I can see a comment form on the document\n   Go To  ${PLONE_URL}/my-document/view\n-  Wait until page contains  My Document\n-  Page should contain  Add comment\n-  Page should contain element  id=form-widgets-comment-text\n+  Get Text  h1  ==  My Document\n+  Get Text  legend  ==  Add comment\n+  Get Element  id=form-widgets-comment-text\n \n I can see the comment below the document\n   Go To  ${PLONE_URL}/my-document/view\n-  Page should contain  This is a comment\n+  Get Text  css=.comment-body > p  ==  This is a comment\n+\n+I can see the reply\n+  Go To  ${PLONE_URL}/my-document/view\n+  Get Text  css=.level-1 .comment-body > p  ==  My reply text\ndiff --git a/plone/app/discussion/tests/robot/test_moderation.robot b/plone/app/discussion/tests/robot/test_moderation.robot\nindex ce231e39..4401bf08 100644\n--- a/plone/app/discussion/tests/robot/test_moderation.robot\n+++ b/plone/app/discussion/tests/robot/test_moderation.robot\n@@ -1,7 +1,7 @@\n *** Settings ***\n \n-Resource  plone/app/robotframework/saucelabs.robot\n-Resource  plone/app/robotframework/selenium.robot\n+Resource  plone/app/robotframework/browser.robot\n+Resource  keywords.robot\n \n Library  Remote  ${PLONE_URL}/RobotRemote\n \n@@ -16,7 +16,7 @@ Add a Comment to a Document and bulk delete it\n     and workflow multiple enabled\n     and a document with discussion enabled\n   When I add a comment and delete it\n-  Then I can not see the comment below the document\n+  Then I can see that the comment is gone\n \n Last history entry is shown\n   Given a logged-in Site Administrator\n@@ -49,49 +49,28 @@ a document with discussion enabled\n \n # When\n \n-I enable discussion on the document\n-  Go To  ${PLONE_URL}/my-document/edit\n-  Wait until page contains  Settings\n-  Click Link  Settings\n-  Wait until element is visible  name=form.widgets.IAllowDiscussion.allow_discussion:list\n-  Select From List By Value  name=form.widgets.IAllowDiscussion.allow_discussion:list  True\n-  Click Button  Save\n-\n-I add a comment\n-  Wait until page contains element  id=form-widgets-comment-text\n-  Input Text  id=form-widgets-comment-text  This is a comment\n-  Click Button  Comment\n-\n I add a comment and delete it\n-  Wait until page contains element  id=form-widgets-comment-text\n-  Input Text  id=form-widgets-comment-text  This is a comment\n-  Click Button  Comment\n+  Fill Text  id=form-widgets-comment-text  This is a comment\n+  Click  css=button[name="form.buttons.comment"]\n   Go To  ${PLONE_URL}/@@moderate-comments?review_state=all\n-  Wait Until Element Is Visible  css=option[value=delete]\n-  Wait Until Keyword Succeeds  5x  1s  Select And Check  xpath://select[@name=\'form.select.BulkAction\']  delete\n-  Wait Until Element Is Visible  css=[name=check_all]\n-  Wait Until Element Is Enabled  css=[name=check_all]\n-  Wait Until Element Is Visible  css=[name="paths:list"]\n-  Wait Until Element Is Enabled  css=[name="paths:list"]\n-  Wait for Condition   return jQuery._data( jQuery(\'[name=check_all]\')[0], "events" )?.click?.length == 2\n-  Select Checkbox  name=check_all\n-  Wait Until Element Is Visible  css=[name="paths:list"]:checked\n-  Wait For Then Click Element  css=button[name="form.button.BulkAction"]\n-  Wait Until Page Does Not Contain  This is a comment\n+  Get Text  body  contains  Bulk Actions\n+  Select Options By  select[name="form.select.BulkAction"]  text  Delete\n+  Check Checkbox  input[name="check_all"]\n+  Click  "Apply"\n+  Get Element Count  table > tbody > tr  ==  0.0\n \n workflow multiple enabled\n   Go To  ${PLONE_URL}/@@content-controlpanel?type_id=Discussion%20Item&new_workflow=comment_review_workflow\n-  Execute Javascript  window.scroll(0, 2000)\n-  Click Button  Save\n+  Click  "Save"\n \n # Then\n \n I can not see the comment below the document\n   Go To  ${PLONE_URL}/my-document/view\n-  Wait until page contains  My Document\n+  Get Text  body  contains My Document\n   Page should not contain  This is a comment\n \n I can see the last history entry in moderation view\n   Go To  ${PLONE_URL}/@@moderate-comments?review_state=all\n-  Wait until page contains element  name=form.select.BulkAction\n-  Page should contain  Create\n+  Get Text  body  contains  Bulk Actions\n+  Get Text  table  contains  Create\n'

Repository: plone.app.discussion


Branch: refs/heads/main
Date: 2024-10-17T09:36:24+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.discussion/commit/6d12637d05d1c3fa23476fe85992edbfe973ee30

Add news entry

Files changed:
A news/3813.feature

b'diff --git a/news/3813.feature b/news/3813.feature\nnew file mode 100644\nindex 00000000..539757b0\n--- /dev/null\n+++ b/news/3813.feature\n@@ -0,0 +1,3 @@\n+Update robot framework tests to use\n+`robotframework-browser` (`playwright` integration on robotframework).\n+[gforcada]\n'

Repository: plone.app.discussion


Branch: refs/heads/main
Date: 2024-10-17T09:39:47+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/plone.app.discussion/commit/dc7dc60f96895b380d4ca630946a178c76436c1b

update robot tests

Files changed:
M plone/app/discussion/tests/robot/keywords.robot
M plone/app/discussion/tests/robot/test_allow_discussion.robot

b'diff --git a/plone/app/discussion/tests/robot/keywords.robot b/plone/app/discussion/tests/robot/keywords.robot\nindex dbbe3164..331bae6d 100644\n--- a/plone/app/discussion/tests/robot/keywords.robot\n+++ b/plone/app/discussion/tests/robot/keywords.robot\n@@ -8,7 +8,7 @@ I enable discussion on the document\n   Click  "Save"\n \n I add a comment\n-  Fill Text  id=form-widgets-comment-text  This is a comment\n+  Type Text  id=form-widgets-comment-text  This is a comment\n   Click  css=button[name="form.buttons.comment"]\n \n I can see that the comment is gone\ndiff --git a/plone/app/discussion/tests/robot/test_allow_discussion.robot b/plone/app/discussion/tests/robot/test_allow_discussion.robot\nindex d2ed6117..e9c7389e 100644\n--- a/plone/app/discussion/tests/robot/test_allow_discussion.robot\n+++ b/plone/app/discussion/tests/robot/test_allow_discussion.robot\n@@ -1,16 +1,14 @@\n-*** Settings *****************************************************************\n+*** Settings ***\n \n-Resource  plone/app/robotframework/keywords.robot\n-Resource  plone/app/robotframework/saucelabs.robot\n-Resource  plone/app/robotframework/selenium.robot\n+Resource  plone/app/robotframework/browser.robot\n+Resource  keywords.robot\n \n Library  Remote  ${PLONE_URL}/RobotRemote\n \n-Test Setup  Run keywords  Plone Test Setup\n-Test Teardown  Run keywords  Plone Test Teardown\n+Test Setup  Run Keywords  Plone test setup\n+Test Teardown  Run keywords  Plone test teardown\n \n-\n-*** Test Cases ***************************************************************\n+*** Test Cases ***\n \n Scenario: Allow comments for Link Type\n   Given a logged-in manager\n@@ -18,49 +16,62 @@ Scenario: Allow comments for Link Type\n     and the types control panel\n    When I select \'Link\' in types dropdown\n     and Allow discussion\n-   Then Wait until page contains  Content Settings\n+   Then Wait For Condition    Text    //body   contains    Content Settings\n+\n    When I add new Link \'my_link\'\n-    Then Link \'my_link\' should have comments enabled\n+   Then Link \'my_link\' should have comments enabled\n \n \n-*** Keywords *****************************************************************\n+*** Keywords ***\n \n-# --- GIVEN ------------------------------------------------------------------\n+# GIVEN\n \n a logged-in manager\n-  Enable autologin as  Manager\n+    Enable autologin as    Manager\n \n the types control panel\n-  Go to  ${PLONE_URL}/@@content-controlpanel\n-  Wait until page contains  Content Settings\n+    Go to    ${PLONE_URL}/@@content-controlpanel\n+    Wait For Condition    Text    //body   contains    Content Settings\n \n Globally enabled comments\n-  Go to  ${PLONE_URL}/@@discussion-settings\n-  Wait until page contains  Discussion settings\n-  Select checkbox  name=form.widgets.globally_enabled:list\n-  Click button  Save\n-\n+    Go to    ${PLONE_URL}/@@discussion-settings\n+    Wait For Condition    Text    //body   contains    Discussion settings\n+    Check Checkbox    //input[@name="form.widgets.globally_enabled:list"]\n+    Click    //button[@name="form.buttons.save"]\n \n \n-# --- WHEN -------------------------------------------------------------------\n+# WHEN\n \n I select \'${content_type}\' in types dropdown\n-  Select from list by label  name=type_id  ${content_type}\n-  Wait until page contains  Globally addable\n+    Select Options By    //select[@name="type_id"]    label    ${content_type}\n+    Wait For Condition    Text    //body   contains    Globally addable\n \n Allow discussion\n-  Select checkbox  name=allow_discussion:boolean\n-  Click Button  Save\n+    Check Checkbox    //input[@name="allow_discussion:boolean"]\n+    Click    //button[@name="form.button.Save"]\n \n I add new Link \'${id}\'\n-  Go to  ${PLONE_URL}\n-  Wait until page contains  Plone site\n-  Create content  type=Link  id=${id}  title=${id}  remoteUrl=http://www.starzel.de\n+    Go to  ${PLONE_URL}\n+    Wait For Condition    Text    //body   contains    Plone site\n+    Create content\n+    ...    type=Link\n+    ...    id=${id}\n+    ...    title=${id}\n+    ...    remoteUrl=http://www.starzel.de\n \n \n-# --- THEN -------------------------------------------------------------------\n+# THEN\n \n Link \'${id}\' should have comments enabled\n-  Go to  ${PLONE_URL}/${id}\n-  Wait until page contains  ${id}\n-  Page should contain element  xpath=//div[@id="commenting"]\n+    Go to    ${PLONE_URL}/${id}\n+    Wait For Condition    Text    //body   contains    ${id}\n+    Get Element Count    //div[@id="commenting"]    should be    1\n+\n+# Misc\n+\n+Pause\n+    [Documentation]  Visually pause test execution with interactive dialog by\n+    ...              importing **Dialogs**-library and calling its\n+    ...              **Pause Execution**-keyword.\n+    Import library  Dialogs\n+    Pause execution\n\\ No newline at end of file\n'

Repository: plone.app.discussion


Branch: refs/heads/main
Date: 2024-10-18T15:49:52+02:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.discussion/commit/60f3167aba595f0381c1936b3b7abb988461b790

Merge pull request #214 from plone/playwright-based-robot-test

Playwright based robot test

Files changed:
A news/3813.feature
A plone/app/discussion/tests/robot/keywords.robot
M plone/app/discussion/tests/robot/test_allow_discussion.robot
M plone/app/discussion/tests/robot/test_discussion.robot
M plone/app/discussion/tests/robot/test_moderation.robot

b'diff --git a/news/3813.feature b/news/3813.feature\nnew file mode 100644\nindex 00000000..539757b0\n--- /dev/null\n+++ b/news/3813.feature\n@@ -0,0 +1,3 @@\n+Update robot framework tests to use\n+`robotframework-browser` (`playwright` integration on robotframework).\n+[gforcada]\ndiff --git a/plone/app/discussion/tests/robot/keywords.robot b/plone/app/discussion/tests/robot/keywords.robot\nnew file mode 100644\nindex 00000000..331bae6d\n--- /dev/null\n+++ b/plone/app/discussion/tests/robot/keywords.robot\n@@ -0,0 +1,16 @@\n+*** Keywords ***\n+\n+I enable discussion on the document\n+  Go To  ${PLONE_URL}/my-document/edit\n+  Get Text  body  contains  Settings\n+  Click  .autotoc-nav >> "Settings"\n+  Select Options By  id=formfield-form-widgets-IAllowDiscussion-allow_discussion >> select  text  Yes\n+  Click  "Save"\n+\n+I add a comment\n+  Type Text  id=form-widgets-comment-text  This is a comment\n+  Click  css=button[name="form.buttons.comment"]\n+\n+I can see that the comment is gone\n+  Go To  ${PLONE_URL}/my-document/view\n+  Get Element Count  css=.comment-body  ==  0\ndiff --git a/plone/app/discussion/tests/robot/test_allow_discussion.robot b/plone/app/discussion/tests/robot/test_allow_discussion.robot\nindex d2ed6117..e9c7389e 100644\n--- a/plone/app/discussion/tests/robot/test_allow_discussion.robot\n+++ b/plone/app/discussion/tests/robot/test_allow_discussion.robot\n@@ -1,16 +1,14 @@\n-*** Settings *****************************************************************\n+*** Settings ***\n \n-Resource  plone/app/robotframework/keywords.robot\n-Resource  plone/app/robotframework/saucelabs.robot\n-Resource  plone/app/robotframework/selenium.robot\n+Resource  plone/app/robotframework/browser.robot\n+Resource  keywords.robot\n \n Library  Remote  ${PLONE_URL}/RobotRemote\n \n-Test Setup  Run keywords  Plone Test Setup\n-Test Teardown  Run keywords  Plone Test Teardown\n+Test Setup  Run Keywords  Plone test setup\n+Test Teardown  Run keywords  Plone test teardown\n \n-\n-*** Test Cases ***************************************************************\n+*** Test Cases ***\n \n Scenario: Allow comments for Link Type\n   Given a logged-in manager\n@@ -18,49 +16,62 @@ Scenario: Allow comments for Link Type\n     and the types control panel\n    When I select \'Link\' in types dropdown\n     and Allow discussion\n-   Then Wait until page contains  Content Settings\n+   Then Wait For Condition    Text    //body   contains    Content Settings\n+\n    When I add new Link \'my_link\'\n-    Then Link \'my_link\' should have comments enabled\n+   Then Link \'my_link\' should have comments enabled\n \n \n-*** Keywords *****************************************************************\n+*** Keywords ***\n \n-# --- GIVEN ------------------------------------------------------------------\n+# GIVEN\n \n a logged-in manager\n-  Enable autologin as  Manager\n+    Enable autologin as    Manager\n \n the types control panel\n-  Go to  ${PLONE_URL}/@@content-controlpanel\n-  Wait until page contains  Content Settings\n+    Go to    ${PLONE_URL}/@@content-controlpanel\n+    Wait For Condition    Text    //body   contains    Content Settings\n \n Globally enabled comments\n-  Go to  ${PLONE_URL}/@@discussion-settings\n-  Wait until page contains  Discussion settings\n-  Select checkbox  name=form.widgets.globally_enabled:list\n-  Click button  Save\n-\n+    Go to    ${PLONE_URL}/@@discussion-settings\n+    Wait For Condition    Text    //body   contains    Discussion settings\n+    Check Checkbox    //input[@name="form.widgets.globally_enabled:list"]\n+    Click    //button[@name="form.buttons.save"]\n \n \n-# --- WHEN -------------------------------------------------------------------\n+# WHEN\n \n I select \'${content_type}\' in types dropdown\n-  Select from list by label  name=type_id  ${content_type}\n-  Wait until page contains  Globally addable\n+    Select Options By    //select[@name="type_id"]    label    ${content_type}\n+    Wait For Condition    Text    //body   contains    Globally addable\n \n Allow discussion\n-  Select checkbox  name=allow_discussion:boolean\n-  Click Button  Save\n+    Check Checkbox    //input[@name="allow_discussion:boolean"]\n+    Click    //button[@name="form.button.Save"]\n \n I add new Link \'${id}\'\n-  Go to  ${PLONE_URL}\n-  Wait until page contains  Plone site\n-  Create content  type=Link  id=${id}  title=${id}  remoteUrl=http://www.starzel.de\n+    Go to  ${PLONE_URL}\n+    Wait For Condition    Text    //body   contains    Plone site\n+    Create content\n+    ...    type=Link\n+    ...    id=${id}\n+    ...    title=${id}\n+    ...    remoteUrl=http://www.starzel.de\n \n \n-# --- THEN -------------------------------------------------------------------\n+# THEN\n \n Link \'${id}\' should have comments enabled\n-  Go to  ${PLONE_URL}/${id}\n-  Wait until page contains  ${id}\n-  Page should contain element  xpath=//div[@id="commenting"]\n+    Go to    ${PLONE_URL}/${id}\n+    Wait For Condition    Text    //body   contains    ${id}\n+    Get Element Count    //div[@id="commenting"]    should be    1\n+\n+# Misc\n+\n+Pause\n+    [Documentation]  Visually pause test execution with interactive dialog by\n+    ...              importing **Dialogs**-library and calling its\n+    ...              **Pause Execution**-keyword.\n+    Import library  Dialogs\n+    Pause execution\n\\ No newline at end of file\ndiff --git a/plone/app/discussion/tests/robot/test_discussion.robot b/plone/app/discussion/tests/robot/test_discussion.robot\nindex 54b8f4a1..28160575 100644\n--- a/plone/app/discussion/tests/robot/test_discussion.robot\n+++ b/plone/app/discussion/tests/robot/test_discussion.robot\n@@ -1,23 +1,13 @@\n-# ============================================================================\n-# Test basic discussion features (adding, replying, deleting)\n-# ============================================================================\n-#\n-# $ bin/robot-server plone.app.discussion.testing.PLONE_APP_DISCUSSION_ROBOT_TESTING\n-# $ bin/robot src/plone.app.discussion/src/plone/app/discussion/tests/robot/test_discussion.robot\n-#\n-# ============================================================================\n-\n *** Settings ***\n \n-Resource  plone/app/robotframework/saucelabs.robot\n-Resource  plone/app/robotframework/selenium.robot\n+Resource  plone/app/robotframework/browser.robot\n+Resource  keywords.robot\n \n Library  Remote  ${PLONE_URL}/RobotRemote\n \n Test Setup  Run Keywords  Plone test setup\n Test Teardown  Run keywords  Plone test teardown\n \n-\n *** Test Cases ***\n \n Enable Discussion on a Document\n@@ -35,11 +25,16 @@ Add Comment to a Document\n Reply to a comment on a Document\n   Given a logged-in Site Administrator\n     and a document with discussion enabled\n+    and I add a comment\n+   When I reply to a comment\n+   Then I can see the reply\n \n Delete Comment from a Document\n   Given a logged-in Site Administrator\n     and a document with discussion enabled\n-\n+    and I add a comment\n+   When I delete the comment\n+   Then I can see that the comment is gone\n \n *** Keywords ***\n \n@@ -58,28 +53,26 @@ a document with discussion enabled\n \n # When\n \n-I enable discussion on the document\n-  Go To  ${PLONE_URL}/my-document/edit\n-  Wait until page contains  Settings\n-  Click Link  Settings\n-  Wait until element is visible  name=form.widgets.IAllowDiscussion.allow_discussion:list\n-  Select From List By Value  name=form.widgets.IAllowDiscussion.allow_discussion:list  True\n-  Click Button  Save\n-\n-I add a comment\n-  Wait until page contains element  id=form-widgets-comment-text\n-  Input Text  id=form-widgets-comment-text  This is a comment\n-  Click Button  Comment\n+I reply to a comment\n+  Click  "Reply"\n+  Fill Text  css=div[id^=formfield-form-widgets-new] > textarea  My reply text\n+  Click  css=.discussion button[name="form.buttons.comment"]\n \n+I delete the comment\n+  Click  css=button[name="form.button.DeleteComment"]\n \n # Then\n \n I can see a comment form on the document\n   Go To  ${PLONE_URL}/my-document/view\n-  Wait until page contains  My Document\n-  Page should contain  Add comment\n-  Page should contain element  id=form-widgets-comment-text\n+  Get Text  h1  ==  My Document\n+  Get Text  legend  ==  Add comment\n+  Get Element  id=form-widgets-comment-text\n \n I can see the comment below the document\n   Go To  ${PLONE_URL}/my-document/view\n-  Page should contain  This is a comment\n+  Get Text  css=.comment-body > p  ==  This is a comment\n+\n+I can see the reply\n+  Go To  ${PLONE_URL}/my-document/view\n+  Get Text  css=.level-1 .comment-body > p  ==  My reply text\ndiff --git a/plone/app/discussion/tests/robot/test_moderation.robot b/plone/app/discussion/tests/robot/test_moderation.robot\nindex ce231e39..4401bf08 100644\n--- a/plone/app/discussion/tests/robot/test_moderation.robot\n+++ b/plone/app/discussion/tests/robot/test_moderation.robot\n@@ -1,7 +1,7 @@\n *** Settings ***\n \n-Resource  plone/app/robotframework/saucelabs.robot\n-Resource  plone/app/robotframework/selenium.robot\n+Resource  plone/app/robotframework/browser.robot\n+Resource  keywords.robot\n \n Library  Remote  ${PLONE_URL}/RobotRemote\n \n@@ -16,7 +16,7 @@ Add a Comment to a Document and bulk delete it\n     and workflow multiple enabled\n     and a document with discussion enabled\n   When I add a comment and delete it\n-  Then I can not see the comment below the document\n+  Then I can see that the comment is gone\n \n Last history entry is shown\n   Given a logged-in Site Administrator\n@@ -49,49 +49,28 @@ a document with discussion enabled\n \n # When\n \n-I enable discussion on the document\n-  Go To  ${PLONE_URL}/my-document/edit\n-  Wait until page contains  Settings\n-  Click Link  Settings\n-  Wait until element is visible  name=form.widgets.IAllowDiscussion.allow_discussion:list\n-  Select From List By Value  name=form.widgets.IAllowDiscussion.allow_discussion:list  True\n-  Click Button  Save\n-\n-I add a comment\n-  Wait until page contains element  id=form-widgets-comment-text\n-  Input Text  id=form-widgets-comment-text  This is a comment\n-  Click Button  Comment\n-\n I add a comment and delete it\n-  Wait until page contains element  id=form-widgets-comment-text\n-  Input Text  id=form-widgets-comment-text  This is a comment\n-  Click Button  Comment\n+  Fill Text  id=form-widgets-comment-text  This is a comment\n+  Click  css=button[name="form.buttons.comment"]\n   Go To  ${PLONE_URL}/@@moderate-comments?review_state=all\n-  Wait Until Element Is Visible  css=option[value=delete]\n-  Wait Until Keyword Succeeds  5x  1s  Select And Check  xpath://select[@name=\'form.select.BulkAction\']  delete\n-  Wait Until Element Is Visible  css=[name=check_all]\n-  Wait Until Element Is Enabled  css=[name=check_all]\n-  Wait Until Element Is Visible  css=[name="paths:list"]\n-  Wait Until Element Is Enabled  css=[name="paths:list"]\n-  Wait for Condition   return jQuery._data( jQuery(\'[name=check_all]\')[0], "events" )?.click?.length == 2\n-  Select Checkbox  name=check_all\n-  Wait Until Element Is Visible  css=[name="paths:list"]:checked\n-  Wait For Then Click Element  css=button[name="form.button.BulkAction"]\n-  Wait Until Page Does Not Contain  This is a comment\n+  Get Text  body  contains  Bulk Actions\n+  Select Options By  select[name="form.select.BulkAction"]  text  Delete\n+  Check Checkbox  input[name="check_all"]\n+  Click  "Apply"\n+  Get Element Count  table > tbody > tr  ==  0.0\n \n workflow multiple enabled\n   Go To  ${PLONE_URL}/@@content-controlpanel?type_id=Discussion%20Item&new_workflow=comment_review_workflow\n-  Execute Javascript  window.scroll(0, 2000)\n-  Click Button  Save\n+  Click  "Save"\n \n # Then\n \n I can not see the comment below the document\n   Go To  ${PLONE_URL}/my-document/view\n-  Wait until page contains  My Document\n+  Get Text  body  contains My Document\n   Page should not contain  This is a comment\n \n I can see the last history entry in moderation view\n   Go To  ${PLONE_URL}/@@moderate-comments?review_state=all\n-  Wait until page contains element  name=form.select.BulkAction\n-  Page should contain  Create\n+  Get Text  body  contains  Bulk Actions\n+  Get Text  table  contains  Create\n'

