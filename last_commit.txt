Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-04-23T22:50:32+02:00
Author: Timo Stollenwerk (tisto) <stollenwerk@kitconcept.com>
Commit: https://github.com/plone/plone.restapi/commit/09ce1b87d7ffb9bf2069347593f24871c38ef988

Add basic locust load test for images

Files changed:
A performance/images.py
A src/plone/restapi/tests/images/image-10mb.jpg
A src/plone/restapi/tests/images/image-1mb.jpg
A src/plone/restapi/tests/images/image-2mb.jpg
A src/plone/restapi/tests/images/image-3mb.jpg
M Jenkinsfile

b'diff --git a/Jenkinsfile b/Jenkinsfile\nindex 8b225286..bde970df 100644\n--- a/Jenkinsfile\n+++ b/Jenkinsfile\n@@ -29,8 +29,11 @@ pipeline {\n         sh "bin/buildout -c plone-5.2.x-performance.cfg"\n         sh "bin/instance start"\n         sh "sleep 20"\n-        sh "jmeter -n -t performance.jmx -l jmeter.csv"\n-        // sh "cat jmeter.csv"\n+\n+        // sh "jmeter -n -t performance.jmx -l jmeter.csv"\n+        sh "bin/pip install locust"\n+        sh "bin/locust -f performance/images.py --no-web -c 100 -r 10 --run-time 1m --host http://localhost:12345/Plone"\n+\n         sh "bin/instance stop"\n       }\n       post {\ndiff --git a/performance/images.py b/performance/images.py\nnew file mode 100644\nindex 00000000..76dd39ed\n--- /dev/null\n+++ b/performance/images.py\n@@ -0,0 +1,75 @@\n+from locust import HttpLocust, TaskSet, between\n+\n+\n+def image_01mb_get(self):\n+    headers = {\n+        "Accept": "application/json",\n+        "Authorization": "Basic YWRtaW46YWRtaW4=",\n+        "Content-Type": "application/json",\n+    }\n+    self.client.get(\n+        "/testfolder-read/image-1mb/@@images/image.jpeg",\n+        headers=headers,\n+        name="Image 1 MB GET",\n+    )\n+\n+\n+def image_02mb_get(self):\n+    headers = {\n+        "Accept": "application/json",\n+        "Authorization": "Basic YWRtaW46YWRtaW4=",\n+        "Content-Type": "application/json",\n+    }\n+    self.client.get(\n+        "/testfolder-read/image-2mb/@@images/image.jpeg",\n+        headers=headers,\n+        name="Image 2 MB GET",\n+    )\n+\n+\n+def image_03mb_get(self):\n+    headers = {\n+        "Accept": "application/json",\n+        "Authorization": "Basic YWRtaW46YWRtaW4=",\n+        "Content-Type": "application/json",\n+    }\n+    self.client.get(\n+        "/testfolder-read/image-3mb/@@images/image.jpeg",\n+        headers=headers,\n+        name="Image 3 MB GET",\n+    )\n+\n+\n+def image_10mb_get(self):\n+    headers = {\n+        "Accept": "application/json",\n+        "Authorization": "Basic YWRtaW46YWRtaW4=",\n+        "Content-Type": "application/json",\n+    }\n+    self.client.get(\n+        "/testfolder-read/image-10mb/@@images/image.jpeg",\n+        headers=headers,\n+        name="Image 10 MB GET",\n+    )\n+\n+\n+class UserBehavior(TaskSet):\n+    tasks = {\n+        image_01mb_get: 10,\n+        image_02mb_get: 10,\n+        image_03mb_get: 10,\n+        image_10mb_get: 5,\n+    }\n+\n+    def on_start(self):\n+        # login(self)\n+        pass\n+\n+    def on_stop(self):\n+        # logout(self)\n+        pass\n+\n+\n+class WebsiteUser(HttpLocust):\n+    task_set = UserBehavior\n+    wait_time = between(5.0, 9.0)\ndiff --git a/src/plone/restapi/tests/images/image-10mb.jpg b/src/plone/restapi/tests/images/image-10mb.jpg\nnew file mode 100644\nindex 00000000..b1be1000\nBinary files /dev/null and b/src/plone/restapi/tests/images/image-10mb.jpg differ\ndiff --git a/src/plone/restapi/tests/images/image-1mb.jpg b/src/plone/restapi/tests/images/image-1mb.jpg\nnew file mode 100644\nindex 00000000..abb01938\nBinary files /dev/null and b/src/plone/restapi/tests/images/image-1mb.jpg differ\ndiff --git a/src/plone/restapi/tests/images/image-2mb.jpg b/src/plone/restapi/tests/images/image-2mb.jpg\nnew file mode 100644\nindex 00000000..9c11eb9a\nBinary files /dev/null and b/src/plone/restapi/tests/images/image-2mb.jpg differ\ndiff --git a/src/plone/restapi/tests/images/image-3mb.jpg b/src/plone/restapi/tests/images/image-3mb.jpg\nnew file mode 100644\nindex 00000000..7c5da75a\nBinary files /dev/null and b/src/plone/restapi/tests/images/image-3mb.jpg differ\n'

