Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-28T19:18:25+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/c32411ae9714c8b1cd6b478da8d2d210dc43a91b

fix circular dep -&gt; move INextPreviousProvider to plone.app.layout

Files changed:
M plone/app/layout/nextprevious/interfaces.py

b'diff --git a/plone/app/layout/nextprevious/interfaces.py b/plone/app/layout/nextprevious/interfaces.py\nindex b20de44d..7747a1b8 100644\n--- a/plone/app/layout/nextprevious/interfaces.py\n+++ b/plone/app/layout/nextprevious/interfaces.py\n@@ -1,28 +1,7 @@\n-from zope.interface import Interface\n-from zope.schema import Bool\n+from zope.deferredimport import deprecated\n \n \n-class INextPreviousProvider(Interface):\n-    """A folderish component capable of describing the next and previous\n-    item relative to a particular id.\n-    """\n-\n-    enabled = Bool(title="True if next/previous behaviour is enabled")\n-\n-    def getNextItem(obj):\n-        """Returns information about next item in the container relative to\n-        the given object.\n-\n-        This is a dict with the following keys:\n-\n-            - id, the id of the object\n-            - url, the url of the object\n-            - title, the title of the object\n-            - description, a description of the object\n-            - portal_type, the object\'s portal type\n-        """\n-\n-    def getPreviousItem(obj):\n-        """Returns the previous item in the container relative to the given\n-        object\n-        """\n+deprecated(\n+    "Import INextPreviousProvider from plone.app.dexterity.behaviors.nextprevious instead (will be removed in Plone 7)",\n+    INextPreviousProvider="plone.app.dexterity.behaviors.nextprevious:INextPreviousProvider",\n+)\n\\ No newline at end of file\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-28T19:18:56+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/af2998ab0ba3dae01209e35db6f93b2b51d5906b

move default page warning from plone.app.dexterity to here

Files changed:
A plone/app/layout/viewlets/default_page_warning.pt
M plone/app/layout/viewlets/configure.zcml

b'diff --git a/plone/app/layout/viewlets/configure.zcml b/plone/app/layout/viewlets/configure.zcml\nindex 9b82456e..2bb5d60f 100644\n--- a/plone/app/layout/viewlets/configure.zcml\n+++ b/plone/app/layout/viewlets/configure.zcml\n@@ -358,4 +358,13 @@\n       permission="zope.Public"\n       />\n \n+  <!-- Warning when editing default pages -->\n+  <browser:viewlet\n+      name="plone.app.dexterity.defaultpagewarning"\n+      view="plone.dexterity.interfaces.IDexterityEditForm"\n+      manager=".interfaces.IGlobalStatusMessage"\n+      template="default_page_warning.pt"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n </configure>\ndiff --git a/plone/app/layout/viewlets/default_page_warning.pt b/plone/app/layout/viewlets/default_page_warning.pt\nnew file mode 100644\nindex 00000000..0abe135a\n--- /dev/null\n+++ b/plone/app/layout/viewlets/default_page_warning.pt\n@@ -0,0 +1,19 @@\n+<tal:info xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+          i18n:domain="plone"\n+>\n+  <div class="alert alert-info"\n+       role="alert"\n+       tal:condition="context/@@plone_context_state/is_default_page|nothing"\n+  >\n+    <span i18n:translate="label_edit_default_view_container">\n+      You are editing the default view of a container. If you wanted to edit the container itself,\n+      <a href=""\n+         tal:attributes="\n+           href string:${context/aq_inner/aq_parent/absolute_url}/edit;\n+         "\n+         i18n:name="go_here"\n+         i18n:translate="label_edit_default_view_container_go_here"\n+      >go here</a>.\n+    </span>\n+  </div>\n+</tal:info>\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-28T19:24:37+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/2d1312b0478388fd7f25046ec20f3759c88468da

document changes

Files changed:
A news/fix-circular-dep-padexterity.bugfix

b"diff --git a/news/fix-circular-dep-padexterity.bugfix b/news/fix-circular-dep-padexterity.bugfix\nnew file mode 100644\nindex 00000000..57987328\n--- /dev/null\n+++ b/news/fix-circular-dep-padexterity.bugfix\n@@ -0,0 +1,4 @@\n+Fix transitive circular dependencies in `plone.app.layout`.\n+Move `.nextprevious.INextPreviousProvider` to `plone.app.dexterity.behaviors.nextprevious` and put BBB import into place.\n+Move the default page warning viewlet from `plone.app.dexterity.browser:default_page_warning.pt` with it's ZCML to `plone.app.layout.viewlets`.\n+[@jensens]\n\\ No newline at end of file\n"

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-04-28T17:28:59Z
Author: pre-commit-ci[bot] (pre-commit-ci[bot]) <66853113+pre-commit-ci[bot]@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.layout/commit/25a8f2cfcf79b7328266fe47a36c3e4ccd74dd1a

[pre-commit.ci] auto fixes from pre-commit.com hooks

for more information, see https://pre-commit.ci

Files changed:
M plone/app/layout/nextprevious/interfaces.py

b'diff --git a/plone/app/layout/nextprevious/interfaces.py b/plone/app/layout/nextprevious/interfaces.py\nindex 7747a1b8..9c1cb66e 100644\n--- a/plone/app/layout/nextprevious/interfaces.py\n+++ b/plone/app/layout/nextprevious/interfaces.py\n@@ -4,4 +4,4 @@\n deprecated(\n     "Import INextPreviousProvider from plone.app.dexterity.behaviors.nextprevious instead (will be removed in Plone 7)",\n     INextPreviousProvider="plone.app.dexterity.behaviors.nextprevious:INextPreviousProvider",\n-)\n\\ No newline at end of file\n+)\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-05-17T16:36:15+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/cf9afd82f62ba27a46ec50d57d04c16061769929

Merge branch 'master' into fix-circular-dep-padexterity

Files changed:
A news/340.bugfix
M .pre-commit-config.yaml
M plone/app/layout/viewlets/toolbar.pt

b'diff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex fdafec1c..f9cdf5cd 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -6,7 +6,7 @@ ci:\n \n repos:\n -   repo: https://github.com/asottile/pyupgrade\n-    rev: v3.3.1\n+    rev: v3.3.2\n     hooks:\n     -   id: pyupgrade\n         args: [--py38-plus]\n@@ -19,7 +19,7 @@ repos:\n     hooks:\n     -   id: black\n -   repo: https://github.com/collective/zpretty\n-    rev: 3.0.3\n+    rev: 3.0.4\n     hooks:\n     -   id: zpretty\n -   repo: https://github.com/PyCQA/flake8\ndiff --git a/news/340.bugfix b/news/340.bugfix\nnew file mode 100644\nindex 00000000..e2028807\n--- /dev/null\n+++ b/news/340.bugfix\n@@ -0,0 +1,2 @@\n+Bring back all HTML attributes for actions.\n+[gforcada]\ndiff --git a/plone/app/layout/viewlets/toolbar.pt b/plone/app/layout/viewlets/toolbar.pt\nindex eb743149..7ec8ded9 100644\n--- a/plone/app/layout/viewlets/toolbar.pt\n+++ b/plone/app/layout/viewlets/toolbar.pt\n@@ -70,7 +70,9 @@\n         </li>\n         <li tal:repeat="action personal_bar/user_actions">\n           <a class="nav-link dropdown-item"\n-             href="${action/href}"\n+             tal:attributes="\n+               action;\n+             "\n           >\n             <tal:icon replace="structure python:icons.tag(action.get(\'icon\', \'dot\'), tag_class=\'\')" />\n             <tal:actionname tal:content="action/title">\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2023-05-18T10:23:01+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/bdb293be3aa372ff8784221606124e726aaa4ced

Merge pull request #338 from plone/fix-circular-dep-padexterity

Fix circular dependency on plone.app.dexterity

Files changed:
A news/fix-circular-dep-padexterity.bugfix
A plone/app/layout/viewlets/default_page_warning.pt
M plone/app/layout/nextprevious/interfaces.py
M plone/app/layout/viewlets/configure.zcml

b'diff --git a/news/fix-circular-dep-padexterity.bugfix b/news/fix-circular-dep-padexterity.bugfix\nnew file mode 100644\nindex 00000000..57987328\n--- /dev/null\n+++ b/news/fix-circular-dep-padexterity.bugfix\n@@ -0,0 +1,4 @@\n+Fix transitive circular dependencies in `plone.app.layout`.\n+Move `.nextprevious.INextPreviousProvider` to `plone.app.dexterity.behaviors.nextprevious` and put BBB import into place.\n+Move the default page warning viewlet from `plone.app.dexterity.browser:default_page_warning.pt` with it\'s ZCML to `plone.app.layout.viewlets`.\n+[@jensens]\n\\ No newline at end of file\ndiff --git a/plone/app/layout/nextprevious/interfaces.py b/plone/app/layout/nextprevious/interfaces.py\nindex b20de44d..9c1cb66e 100644\n--- a/plone/app/layout/nextprevious/interfaces.py\n+++ b/plone/app/layout/nextprevious/interfaces.py\n@@ -1,28 +1,7 @@\n-from zope.interface import Interface\n-from zope.schema import Bool\n+from zope.deferredimport import deprecated\n \n \n-class INextPreviousProvider(Interface):\n-    """A folderish component capable of describing the next and previous\n-    item relative to a particular id.\n-    """\n-\n-    enabled = Bool(title="True if next/previous behaviour is enabled")\n-\n-    def getNextItem(obj):\n-        """Returns information about next item in the container relative to\n-        the given object.\n-\n-        This is a dict with the following keys:\n-\n-            - id, the id of the object\n-            - url, the url of the object\n-            - title, the title of the object\n-            - description, a description of the object\n-            - portal_type, the object\'s portal type\n-        """\n-\n-    def getPreviousItem(obj):\n-        """Returns the previous item in the container relative to the given\n-        object\n-        """\n+deprecated(\n+    "Import INextPreviousProvider from plone.app.dexterity.behaviors.nextprevious instead (will be removed in Plone 7)",\n+    INextPreviousProvider="plone.app.dexterity.behaviors.nextprevious:INextPreviousProvider",\n+)\ndiff --git a/plone/app/layout/viewlets/configure.zcml b/plone/app/layout/viewlets/configure.zcml\nindex 9b82456e..2bb5d60f 100644\n--- a/plone/app/layout/viewlets/configure.zcml\n+++ b/plone/app/layout/viewlets/configure.zcml\n@@ -358,4 +358,13 @@\n       permission="zope.Public"\n       />\n \n+  <!-- Warning when editing default pages -->\n+  <browser:viewlet\n+      name="plone.app.dexterity.defaultpagewarning"\n+      view="plone.dexterity.interfaces.IDexterityEditForm"\n+      manager=".interfaces.IGlobalStatusMessage"\n+      template="default_page_warning.pt"\n+      permission="cmf.ModifyPortalContent"\n+      />\n+\n </configure>\ndiff --git a/plone/app/layout/viewlets/default_page_warning.pt b/plone/app/layout/viewlets/default_page_warning.pt\nnew file mode 100644\nindex 00000000..0abe135a\n--- /dev/null\n+++ b/plone/app/layout/viewlets/default_page_warning.pt\n@@ -0,0 +1,19 @@\n+<tal:info xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+          i18n:domain="plone"\n+>\n+  <div class="alert alert-info"\n+       role="alert"\n+       tal:condition="context/@@plone_context_state/is_default_page|nothing"\n+  >\n+    <span i18n:translate="label_edit_default_view_container">\n+      You are editing the default view of a container. If you wanted to edit the container itself,\n+      <a href=""\n+         tal:attributes="\n+           href string:${context/aq_inner/aq_parent/absolute_url}/edit;\n+         "\n+         i18n:name="go_here"\n+         i18n:translate="label_edit_default_view_container_go_here"\n+      >go here</a>.\n+    </span>\n+  </div>\n+</tal:info>\n'

