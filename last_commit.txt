Repository: plone.app.event


Branch: refs/heads/master
Date: 2016-08-12T10:48:39-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.event/commit/4b06ec1d5f02a56985f00559949fc31c3c55d342

Fix bug when creating indexes on install. It was not detecting existing
  indexes correctly.

Files changed:
M CHANGES.rst
M plone/app/event/setuphandlers.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a99b1ad..68e0383 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -43,6 +43,10 @@ Bug fixes:
   This can happen on non-required, default empty start or end fields during editing.
   [thet]
 
+- Fix bug when creating indexes on install. It was not detecting existing
+  indexes correctly.
+  [vangheem]
+
 
 2.0.9 (2016-05-15)
 ------------------
diff --git a/plone/app/event/setuphandlers.py b/plone/app/event/setuphandlers.py
index 612f4d8..57ef96c 100644
--- a/plone/app/event/setuphandlers.py
+++ b/plone/app/event/setuphandlers.py
@@ -45,14 +45,14 @@ class extra(object):
         recurdef = 'recurrence'
         until = ''
 
-    idxobj = catalog.Indexes
+    _catalog = catalog._catalog
     for name in idxs:
-        if name in idxobj:
-            if idxobj[name].meta_type == 'DateIndex':
+        if name in catalog.indexes():
+            if _catalog.getIndex(name).meta_type == 'DateIndex':
                 # delete old standard DateIndex
                 catalog.delIndex(name)
                 logger.info('Old catalog DateIndex %s deleted.' % name)
-        if name not in idxobj:
+        if name not in catalog.indexes():
             if name in date_idxs:
                 # create new DateRecurringIndex
                 catalog.addIndex(name, 'DateRecurringIndex', extra=extra())


Repository: plone.app.event


Branch: refs/heads/master
Date: 2016-09-27T23:41:07-05:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.event/commit/cc5606e33417e1ef8b5b9685c599a1814076a825

Merge pull request #236 from plone/fix-index-install

Fix bug when creating indexes on install

Files changed:
M CHANGES.rst
M plone/app/event/setuphandlers.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 57da5d2..a79d9fd 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -67,6 +67,10 @@ Bug fixes:
   This can happen on non-required, default empty start or end fields during editing.
   [thet]
 
+- Fix bug when creating indexes on install. It was not detecting existing
+  indexes correctly.
+  [vangheem]
+
 
 2.0.9 (2016-05-15)
 ------------------
diff --git a/plone/app/event/setuphandlers.py b/plone/app/event/setuphandlers.py
index 612f4d8..57ef96c 100644
--- a/plone/app/event/setuphandlers.py
+++ b/plone/app/event/setuphandlers.py
@@ -45,14 +45,14 @@ class extra(object):
         recurdef = 'recurrence'
         until = ''
 
-    idxobj = catalog.Indexes
+    _catalog = catalog._catalog
     for name in idxs:
-        if name in idxobj:
-            if idxobj[name].meta_type == 'DateIndex':
+        if name in catalog.indexes():
+            if _catalog.getIndex(name).meta_type == 'DateIndex':
                 # delete old standard DateIndex
                 catalog.delIndex(name)
                 logger.info('Old catalog DateIndex %s deleted.' % name)
-        if name not in idxobj:
+        if name not in catalog.indexes():
             if name in date_idxs:
                 # create new DateRecurringIndex
                 catalog.addIndex(name, 'DateRecurringIndex', extra=extra())


