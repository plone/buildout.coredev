Repository: plone.restapi


Branch: refs/heads/master
Date: 2023-08-23T11:05:39-07:00
Author: Akshat Jain (Akshat2Jain) <101265586+Akshat2Jain@users.noreply.github.com>
Commit: https://github.com/plone/plone.restapi/commit/1b1e55461cbaeabe5bcf552dd498a56427731d8a

added translation expansion code (#1676)

* added translation expansion code

* added files in example

* minor change

* minor change

* added log file

* changed document

* changed docs

* changed translation doc

* changed the docs

* added code

* formatted using black

* added some request

* Add translation in test to see in documentation how an example response would look like

* MyST syntax correction

Co-authored-by: Steve Piercy &lt;web@stevepiercy.com&gt;

---------

Co-authored-by: Katja SÃ¼ss &lt;k.suess@rohberg.ch&gt;
Co-authored-by: Steve Piercy &lt;web@stevepiercy.com&gt;

Files changed:
A news/1374.documentation
A src/plone/restapi/tests/http-examples/translations_expand_get.req
A src/plone/restapi/tests/http-examples/translations_expand_get.resp
A src/plone/restapi/tests/http-examples/translations_unexpanded_get.req
A src/plone/restapi/tests/http-examples/translations_unexpanded_get.resp
M docs/source/endpoints/translations.md
M src/plone/restapi/tests/test_documentation.py

b'diff --git a/docs/source/endpoints/translations.md b/docs/source/endpoints/translations.md\nindex 767efe880d..da145a805a 100644\n--- a/docs/source/endpoints/translations.md\n+++ b/docs/source/endpoints/translations.md\n@@ -96,7 +96,7 @@ To unlink the content, issue a `DELETE` request on the `@translations` endpoint\n ## Creating a translation from an existing content\n \n The `POST` content endpoint to a folder is also capable of linking this new content with an\n-exising translation using two parameters: `translationOf` and `language`.\n+existing translation using two parameters: `translationOf` and `language`.\n \n ```{eval-rst}\n ..  http:example:: curl httpie python-requests\n@@ -125,6 +125,32 @@ This endpoint returns the proper placement for the newly created translation:\n \n ## Expansion\n \n-This endpoint can be used with the {doc}`../usage/expansion` mechanism which allows getting additional information about a content item in one query, avoiding unnecessary requests.\n+This service can be used with the {doc}`../usage/expansion` mechanism which allows getting additional information about a content item in one query, avoiding additional requests.\n+\n+Translation information can be provided by the API expansion for translatable content items.\n+A content type is translatable if it has the `plone.translatable` behavior enabled. \n+`plone.app.multilingual` enables this behavior for all content types at the time that it is installed.\n+For other content types added later, it would be necessary to enable the behavior for them also.\n \n If a simple `GET` request is done on the content item, a new entry will be shown on the `@components` entry, with the URL of the `@translations` endpoint:\n+\n+```{eval-rst}\n+..  http:example:: curl httpie python-requests\n+    :request: ../../../src/plone/restapi/tests/http-examples/translations_unexpanded_get.req\n+```\n+\n+```{literalinclude} ../../../src/plone/restapi/tests/http-examples/translations_unexpanded_get.resp\n+:language: http\n+```\n+\n+In order to expand and embed the translations component, use the GET parameter `expand` with the value `translations`.\n+\n+```{eval-rst}\n+..  http:example:: curl httpie python-requests\n+    :request: ../../../src/plone/restapi/tests/http-examples/translations_expand_get.req\n+```\n+\n+```{literalinclude} ../../../src/plone/restapi/tests/http-examples/translations_expand_get.resp\n+:language: http\n+```\n+\ndiff --git a/news/1374.documentation b/news/1374.documentation\nnew file mode 100644\nindex 0000000000..2d4bcd0a05\n--- /dev/null\n+++ b/news/1374.documentation\n@@ -0,0 +1 @@\n+Added translation code through expansion. @Akshat2Jain\n\\ No newline at end of file\ndiff --git a/src/plone/restapi/tests/http-examples/translations_expand_get.req b/src/plone/restapi/tests/http-examples/translations_expand_get.req\nnew file mode 100644\nindex 0000000000..d92b4f23c6\n--- /dev/null\n+++ b/src/plone/restapi/tests/http-examples/translations_expand_get.req\n@@ -0,0 +1,3 @@\n+GET /plone/en/test-document?expand=translations HTTP/1.1\n+Accept: application/json\n+Authorization: Basic YWRtaW46c2VjcmV0\ndiff --git a/src/plone/restapi/tests/http-examples/translations_expand_get.resp b/src/plone/restapi/tests/http-examples/translations_expand_get.resp\nnew file mode 100644\nindex 0000000000..010dce733e\n--- /dev/null\n+++ b/src/plone/restapi/tests/http-examples/translations_expand_get.resp\n@@ -0,0 +1,100 @@\n+HTTP/1.1 200 OK\n+Content-Type: application/json\n+\n+{\n+    "@components": {\n+        "actions": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@actions"\n+        },\n+        "aliases": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@aliases"\n+        },\n+        "breadcrumbs": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@breadcrumbs"\n+        },\n+        "contextnavigation": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@contextnavigation"\n+        },\n+        "navigation": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@navigation"\n+        },\n+        "navroot": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@navroot"\n+        },\n+        "translations": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@translations",\n+            "items": [\n+                {\n+                    "@id": "http://localhost:55001/plone/es/test-document",\n+                    "language": "es"\n+                }\n+            ],\n+            "root": {\n+                "de": "http://localhost:55001/plone/de",\n+                "en": "http://localhost:55001/plone/en",\n+                "es": "http://localhost:55001/plone/es",\n+                "fr": "http://localhost:55001/plone/fr"\n+            }\n+        },\n+        "types": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@types"\n+        },\n+        "workflow": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@workflow"\n+        }\n+    },\n+    "@id": "http://localhost:55001/plone/en/test-document",\n+    "@type": "Document",\n+    "UID": "SomeUUID000000000000000000000001",\n+    "allow_discussion": false,\n+    "changeNote": "",\n+    "contributors": [],\n+    "created": "1995-07-31T13:45:00+00:00",\n+    "creators": [\n+        "test_user_1_"\n+    ],\n+    "description": "",\n+    "effective": null,\n+    "exclude_from_nav": false,\n+    "expires": null,\n+    "id": "test-document",\n+    "is_folderish": false,\n+    "language": {\n+        "title": "English",\n+        "token": "en"\n+    },\n+    "layout": "document_view",\n+    "lock": {\n+        "locked": false,\n+        "stealable": true\n+    },\n+    "modified": "1995-07-31T17:30:00+00:00",\n+    "next_item": {},\n+    "parent": {\n+        "@id": "http://localhost:55001/plone/en",\n+        "@type": "LRF",\n+        "description": "",\n+        "review_state": "published",\n+        "title": "English",\n+        "type_title": "Language Root Folder"\n+    },\n+    "previous_item": {\n+        "@id": "http://localhost:55001/plone/en/assets",\n+        "@type": "LIF",\n+        "description": "",\n+        "title": "Assets",\n+        "type_title": "Language Independent Folder"\n+    },\n+    "relatedItems": [],\n+    "review_state": "private",\n+    "rights": "",\n+    "subjects": [],\n+    "table_of_contents": null,\n+    "text": null,\n+    "title": "Test document",\n+    "type_title": "Page",\n+    "version": "current",\n+    "versioning_enabled": true,\n+    "working_copy": null,\n+    "working_copy_of": null\n+}\ndiff --git a/src/plone/restapi/tests/http-examples/translations_unexpanded_get.req b/src/plone/restapi/tests/http-examples/translations_unexpanded_get.req\nnew file mode 100644\nindex 0000000000..fea765b3d3\n--- /dev/null\n+++ b/src/plone/restapi/tests/http-examples/translations_unexpanded_get.req\n@@ -0,0 +1,3 @@\n+GET /plone/en/test-document HTTP/1.1\n+Accept: application/json\n+Authorization: Basic YWRtaW46c2VjcmV0\ndiff --git a/src/plone/restapi/tests/http-examples/translations_unexpanded_get.resp b/src/plone/restapi/tests/http-examples/translations_unexpanded_get.resp\nnew file mode 100644\nindex 0000000000..7b0e674242\n--- /dev/null\n+++ b/src/plone/restapi/tests/http-examples/translations_unexpanded_get.resp\n@@ -0,0 +1,88 @@\n+HTTP/1.1 200 OK\n+Content-Type: application/json\n+\n+{\n+    "@components": {\n+        "actions": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@actions"\n+        },\n+        "aliases": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@aliases"\n+        },\n+        "breadcrumbs": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@breadcrumbs"\n+        },\n+        "contextnavigation": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@contextnavigation"\n+        },\n+        "navigation": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@navigation"\n+        },\n+        "navroot": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@navroot"\n+        },\n+        "translations": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@translations"\n+        },\n+        "types": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@types"\n+        },\n+        "workflow": {\n+            "@id": "http://localhost:55001/plone/en/test-document/@workflow"\n+        }\n+    },\n+    "@id": "http://localhost:55001/plone/en/test-document",\n+    "@type": "Document",\n+    "UID": "SomeUUID000000000000000000000001",\n+    "allow_discussion": false,\n+    "changeNote": "",\n+    "contributors": [],\n+    "created": "1995-07-31T13:45:00+00:00",\n+    "creators": [\n+        "test_user_1_"\n+    ],\n+    "description": "",\n+    "effective": null,\n+    "exclude_from_nav": false,\n+    "expires": null,\n+    "id": "test-document",\n+    "is_folderish": false,\n+    "language": {\n+        "title": "English",\n+        "token": "en"\n+    },\n+    "layout": "document_view",\n+    "lock": {\n+        "locked": false,\n+        "stealable": true\n+    },\n+    "modified": "1995-07-31T17:30:00+00:00",\n+    "next_item": {},\n+    "parent": {\n+        "@id": "http://localhost:55001/plone/en",\n+        "@type": "LRF",\n+        "description": "",\n+        "review_state": "published",\n+        "title": "English",\n+        "type_title": "Language Root Folder"\n+    },\n+    "previous_item": {\n+        "@id": "http://localhost:55001/plone/en/assets",\n+        "@type": "LIF",\n+        "description": "",\n+        "title": "Assets",\n+        "type_title": "Language Independent Folder"\n+    },\n+    "relatedItems": [],\n+    "review_state": "private",\n+    "rights": "",\n+    "subjects": [],\n+    "table_of_contents": null,\n+    "text": null,\n+    "title": "Test document",\n+    "type_title": "Page",\n+    "version": "current",\n+    "versioning_enabled": true,\n+    "working_copy": null,\n+    "working_copy_of": null\n+}\ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex df5f8aef5b..6f4a62329d 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -2267,6 +2267,22 @@ def test_documentation_translation_locator(self):\n         )\n         save_request_and_response_for_docs("translation_locator", response)\n \n+    def test_documentation_translations_unexpanded_get(self):\n+        response = self.api_session.get(\n+            f"{self.en_content.absolute_url()}",\n+        )\n+        save_request_and_response_for_docs("translations_unexpanded_get", response)\n+\n+    def test_documentation_translations_expand_get(self):\n+        self.api_session.post(\n+            f"{self.en_content.absolute_url()}/@translations",\n+            json={"id": self.es_content.absolute_url()},\n+        )\n+        response = self.api_session.get(\n+            f"{self.en_content.absolute_url()}?expand=translations",\n+        )\n+        save_request_and_response_for_docs("translations_expand_get", response)\n+\n     def test_site_navroot_get(self):\n         response = self.api_session.get("/@navroot")\n         save_request_and_response_for_docs("navroot_site_get", response)\n'

