Repository: plone.app.z3cform


Branch: refs/heads/4.3.x
Date: 2024-03-14T21:26:02+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/dada24f9c26ededa3d965edab8decd3c4a9d2837

Add support for the "accept" attribute on file inputs.

If the widget's field - if there is one - has the "accept" attribute set (the
`NamedImage` field has `image/*` set by default) then this is rendered as an
`accept` attribute on the file input.

This would restrict the allowed file types before uploading while still being
checked on the server side.

Fixes: https://github.com/plone/plone.formwidget.namedfile/issues/66
Depends on:
- https://github.com/plone/plone.namedfile/pull/158
- https://github.com/plone/plone.formwidget.namedfile/pull/67

Files changed:
A news/198.feature
M plone/app/z3cform/templates/file_input.pt
M plone/app/z3cform/templates/image_input.pt
M setup.py

b'diff --git a/news/198.feature b/news/198.feature\nnew file mode 100644\nindex 00000000..1d722dc4\n--- /dev/null\n+++ b/news/198.feature\n@@ -0,0 +1,14 @@\n+Add support for the "accept" attribute on file inputs.\n+\n+If the widget\'s field - if there is one - has the "accept" attribute set (the\n+`NamedImage` field has `image/*` set by default) then this is rendered as an\n+`accept` attribute on the file input.\n+\n+This would restrict the allowed file types before uploading while still being\n+checked on the server side.\n+\n+Fixes: https://github.com/plone/plone.formwidget.namedfile/issues/66\n+Depends on:\n+- https://github.com/plone/plone.namedfile/pull/158\n+- https://github.com/plone/plone.formwidget.namedfile/pull/67\n+[thet]\ndiff --git a/plone/app/z3cform/templates/file_input.pt b/plone/app/z3cform/templates/file_input.pt\nindex 58c57443..5a2a1f78 100644\n--- a/plone/app/z3cform/templates/file_input.pt\n+++ b/plone/app/z3cform/templates/file_input.pt\n@@ -133,6 +133,7 @@\n   </tal:block>\n \n   <input class="form-control"\n+         accept="${view/accept}"\n          type="file"\n          tal:define="\n            is_invalid python:view.error and \'is-invalid\' or \'\';\ndiff --git a/plone/app/z3cform/templates/image_input.pt b/plone/app/z3cform/templates/image_input.pt\nindex b1ebb4f4..b490cd12 100644\n--- a/plone/app/z3cform/templates/image_input.pt\n+++ b/plone/app/z3cform/templates/image_input.pt\n@@ -139,6 +139,7 @@\n   </tal:block>\n \n   <input class="form-control"\n+         accept="${view/accept}"\n          type="file"\n          tal:attributes="\n            id string:${view/id}-input;\ndiff --git a/setup.py b/setup.py\nindex 80f5b247..05f74851 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -63,6 +63,7 @@\n         "plone.base",\n         "plone.app.contentlisting",\n         "plone.dexterity",\n+        "plone.formwidget.namedfile>3.0.3",\n         "plone.i18n",\n         "plone.protect",\n         "plone.registry",\n'

Repository: plone.app.z3cform


Branch: refs/heads/4.3.x
Date: 2024-03-14T23:01:38+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/623e4131144a3ed71936c5a7c0058c14088b6d60

file input: Show accepted media types.

Files changed:
M plone/app/z3cform/templates/file_input.pt
M plone/app/z3cform/templates/image_input.pt

b'diff --git a/plone/app/z3cform/templates/file_input.pt b/plone/app/z3cform/templates/file_input.pt\nindex 5a2a1f7..7c4d4d6 100644\n--- a/plone/app/z3cform/templates/file_input.pt\n+++ b/plone/app/z3cform/templates/file_input.pt\n@@ -148,6 +148,13 @@\n            class string:form-control $is_invalid;\n          "\n   />\n+  <div class="form-text"\n+       tal:condition="view/accept"\n+       i18n:translate="namedfile_accepted_types"\n+  >\n+    Allowed types:\n+    <tal:i18n i18n:name="accepted_types">${view/accept}</tal:i18n>.\n+  </div>\n \n   <script type="text/javascript"\n           tal:condition="python:allow_nochange and action != \'replace\'"\ndiff --git a/plone/app/z3cform/templates/image_input.pt b/plone/app/z3cform/templates/image_input.pt\nindex b490cd1..7772f26 100644\n--- a/plone/app/z3cform/templates/image_input.pt\n+++ b/plone/app/z3cform/templates/image_input.pt\n@@ -150,6 +150,13 @@\n            maxlength view/maxlength;\n          "\n   />\n+  <div class="form-text"\n+       tal:condition="view/accept"\n+       i18n:translate="namedfile_accepted_types"\n+  >\n+    Allowed types:\n+    <tal:i18n i18n:name="accepted_types">${view/accept}</tal:i18n>.\n+  </div>\n \n   <script type="text/javascript"\n           tal:condition="python:allow_nochange and action != \'replace\'"\n'

Repository: plone.app.z3cform


Branch: refs/heads/4.3.x
Date: 2024-03-15T12:40:14+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/e58d8431ad5002cd7d659d165976c227202ca510

Update plone/app/z3cform/templates/image_input.pt

Co-authored-by: Maurits van Rees &lt;maurits@vanrees.org&gt;

Files changed:
M plone/app/z3cform/templates/image_input.pt

b'diff --git a/plone/app/z3cform/templates/image_input.pt b/plone/app/z3cform/templates/image_input.pt\nindex 7772f26..674ba41 100644\n--- a/plone/app/z3cform/templates/image_input.pt\n+++ b/plone/app/z3cform/templates/image_input.pt\n@@ -139,7 +139,7 @@\n   </tal:block>\n \n   <input class="form-control"\n-         accept="${view/accept}"\n+         accept="${view/accept|nothing}"\n          type="file"\n          tal:attributes="\n            id string:${view/id}-input;\n'

Repository: plone.app.z3cform


Branch: refs/heads/4.3.x
Date: 2024-03-15T12:40:23+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/cd8690a812b81b0174580bd1d70685954d7115d1

Update plone/app/z3cform/templates/image_input.pt

Co-authored-by: Maurits van Rees &lt;maurits@vanrees.org&gt;

Files changed:
M plone/app/z3cform/templates/image_input.pt

b'diff --git a/plone/app/z3cform/templates/image_input.pt b/plone/app/z3cform/templates/image_input.pt\nindex 674ba41..a6ddbfc 100644\n--- a/plone/app/z3cform/templates/image_input.pt\n+++ b/plone/app/z3cform/templates/image_input.pt\n@@ -151,7 +151,7 @@\n          "\n   />\n   <div class="form-text"\n-       tal:condition="view/accept"\n+       tal:condition="view/accept|nothing"\n        i18n:translate="namedfile_accepted_types"\n   >\n     Allowed types:\n'

Repository: plone.app.z3cform


Branch: refs/heads/4.3.x
Date: 2024-03-15T12:40:38+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/be471831d8f997d951d69226cae48f65a2d32355

Update plone/app/z3cform/templates/file_input.pt

Co-authored-by: Maurits van Rees &lt;maurits@vanrees.org&gt;

Files changed:
M plone/app/z3cform/templates/file_input.pt

b'diff --git a/plone/app/z3cform/templates/file_input.pt b/plone/app/z3cform/templates/file_input.pt\nindex 7c4d4d6..3a11329 100644\n--- a/plone/app/z3cform/templates/file_input.pt\n+++ b/plone/app/z3cform/templates/file_input.pt\n@@ -133,7 +133,7 @@\n   </tal:block>\n \n   <input class="form-control"\n-         accept="${view/accept}"\n+         accept="${view/accept|nothing}"\n          type="file"\n          tal:define="\n            is_invalid python:view.error and \'is-invalid\' or \'\';\n'

Repository: plone.app.z3cform


Branch: refs/heads/4.3.x
Date: 2024-03-15T12:40:49+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/2071ff4961f55ff8558ab2f5ace9cb4294d9f7be

Update plone/app/z3cform/templates/file_input.pt

Co-authored-by: Maurits van Rees &lt;maurits@vanrees.org&gt;

Files changed:
M plone/app/z3cform/templates/file_input.pt

b'diff --git a/plone/app/z3cform/templates/file_input.pt b/plone/app/z3cform/templates/file_input.pt\nindex 3a11329..eff6399 100644\n--- a/plone/app/z3cform/templates/file_input.pt\n+++ b/plone/app/z3cform/templates/file_input.pt\n@@ -149,7 +149,7 @@\n          "\n   />\n   <div class="form-text"\n-       tal:condition="view/accept"\n+       tal:condition="view/accept|nothing"\n        i18n:translate="namedfile_accepted_types"\n   >\n     Allowed types:\n'

Repository: plone.app.z3cform


Branch: refs/heads/4.3.x
Date: 2024-03-15T14:40:15+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.z3cform/commit/f327f336eb284fa2baf789fd22583665c2b882fd

Depend on the just released plone.formwidget.namedfile 3.1.0.

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex 05f7485..91db977 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -63,7 +63,7 @@\n         "plone.base",\n         "plone.app.contentlisting",\n         "plone.dexterity",\n-        "plone.formwidget.namedfile>3.0.3",\n+        "plone.formwidget.namedfile>=3.1.0",\n         "plone.i18n",\n         "plone.protect",\n         "plone.registry",\n'

Repository: plone.app.z3cform


Branch: refs/heads/4.3.x
Date: 2024-03-15T16:35:05+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/dc9ccae7ce34d0dd18e540c562f3da07ead31814

Merge pull request #199 from plone/allowed_content_types--4.3.x

Add support for accept attribute on file input (4.3.x branch)

Files changed:
A news/198.feature
M plone/app/z3cform/templates/file_input.pt
M plone/app/z3cform/templates/image_input.pt
M setup.py

b'diff --git a/news/198.feature b/news/198.feature\nnew file mode 100644\nindex 00000000..1d722dc4\n--- /dev/null\n+++ b/news/198.feature\n@@ -0,0 +1,14 @@\n+Add support for the "accept" attribute on file inputs.\n+\n+If the widget\'s field - if there is one - has the "accept" attribute set (the\n+`NamedImage` field has `image/*` set by default) then this is rendered as an\n+`accept` attribute on the file input.\n+\n+This would restrict the allowed file types before uploading while still being\n+checked on the server side.\n+\n+Fixes: https://github.com/plone/plone.formwidget.namedfile/issues/66\n+Depends on:\n+- https://github.com/plone/plone.namedfile/pull/158\n+- https://github.com/plone/plone.formwidget.namedfile/pull/67\n+[thet]\ndiff --git a/plone/app/z3cform/templates/file_input.pt b/plone/app/z3cform/templates/file_input.pt\nindex 58c57443..eff63996 100644\n--- a/plone/app/z3cform/templates/file_input.pt\n+++ b/plone/app/z3cform/templates/file_input.pt\n@@ -133,6 +133,7 @@\n   </tal:block>\n \n   <input class="form-control"\n+         accept="${view/accept|nothing}"\n          type="file"\n          tal:define="\n            is_invalid python:view.error and \'is-invalid\' or \'\';\n@@ -147,6 +148,13 @@\n            class string:form-control $is_invalid;\n          "\n   />\n+  <div class="form-text"\n+       tal:condition="view/accept|nothing"\n+       i18n:translate="namedfile_accepted_types"\n+  >\n+    Allowed types:\n+    <tal:i18n i18n:name="accepted_types">${view/accept}</tal:i18n>.\n+  </div>\n \n   <script type="text/javascript"\n           tal:condition="python:allow_nochange and action != \'replace\'"\ndiff --git a/plone/app/z3cform/templates/image_input.pt b/plone/app/z3cform/templates/image_input.pt\nindex b1ebb4f4..a6ddbfc2 100644\n--- a/plone/app/z3cform/templates/image_input.pt\n+++ b/plone/app/z3cform/templates/image_input.pt\n@@ -139,6 +139,7 @@\n   </tal:block>\n \n   <input class="form-control"\n+         accept="${view/accept|nothing}"\n          type="file"\n          tal:attributes="\n            id string:${view/id}-input;\n@@ -149,6 +150,13 @@\n            maxlength view/maxlength;\n          "\n   />\n+  <div class="form-text"\n+       tal:condition="view/accept|nothing"\n+       i18n:translate="namedfile_accepted_types"\n+  >\n+    Allowed types:\n+    <tal:i18n i18n:name="accepted_types">${view/accept}</tal:i18n>.\n+  </div>\n \n   <script type="text/javascript"\n           tal:condition="python:allow_nochange and action != \'replace\'"\ndiff --git a/setup.py b/setup.py\nindex 80f5b247..91db9773 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -63,6 +63,7 @@\n         "plone.base",\n         "plone.app.contentlisting",\n         "plone.dexterity",\n+        "plone.formwidget.namedfile>=3.1.0",\n         "plone.i18n",\n         "plone.protect",\n         "plone.registry",\n'

