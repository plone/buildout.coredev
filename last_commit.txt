Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2019-04-29T07:46:54+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/5f54253811b7bf7391690772ee8a3925cd4f8713

force view_methods to be a tuple on setup and uninstall. Fixes #337

Files changed:
M src/plone/app/multilingual/browser/setup.py
M src/plone/app/multilingual/setuphandlers.py

b"diff --git a/src/plone/app/multilingual/browser/setup.py b/src/plone/app/multilingual/browser/setup.py\nindex 558c4ea7..842b13ad 100644\n--- a/src/plone/app/multilingual/browser/setup.py\n+++ b/src/plone/app/multilingual/browser/setup.py\n@@ -265,7 +265,7 @@ def setupLanguageSwitcher(self):\n         site = tt['Plone Site']\n \n         if 'language-switcher' not in site.view_methods:\n-            methods = site.view_methods\n+            methods = tuple(site.view_methods)\n             site.view_methods = methods + ('language-switcher', )\n             site.default_view = 'language-switcher'\n             self.context.reindexObject()\ndiff --git a/src/plone/app/multilingual/setuphandlers.py b/src/plone/app/multilingual/setuphandlers.py\nindex 56406645..20a91835 100644\n--- a/src/plone/app/multilingual/setuphandlers.py\n+++ b/src/plone/app/multilingual/setuphandlers.py\n@@ -91,7 +91,7 @@ def disable_language_switcher(portal):\n     tt = getToolByName(portal, 'portal_types')\n     site = tt['Plone Site']\n     methods = site.view_methods\n-    site.view_methods = [m for m in methods if m != 'language-switcher']\n+    site.view_methods = tuple([m for m in methods if m != 'language-switcher'])\n     if site.default_view == 'language-switcher':\n         site.default_view = 'listing_view'\n \n"

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2019-04-29T07:49:18+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/841b485377e06fd200b6d482c6b13f06836a2605

changelog

Files changed:
A news/337.bugfix

b'diff --git a/news/337.bugfix b/news/337.bugfix\nnew file mode 100644\nindex 00000000..59cb544c\n--- /dev/null\n+++ b/news/337.bugfix\n@@ -0,0 +1 @@\n+Force view_methods to be a tuple on setup and uninstall\n'

Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2021-02-10T13:59:43+01:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/c92175c5fafd5696ebbc523693903d047685ba4c

Merge pull request #341 from plone/erral-uninstall

force view_methods to be a tuple on setup and uninstall

Files changed:
A news/337.bugfix
M src/plone/app/multilingual/browser/setup.py
M src/plone/app/multilingual/setuphandlers.py

b"diff --git a/news/337.bugfix b/news/337.bugfix\nnew file mode 100644\nindex 00000000..59cb544c\n--- /dev/null\n+++ b/news/337.bugfix\n@@ -0,0 +1 @@\n+Force view_methods to be a tuple on setup and uninstall\ndiff --git a/src/plone/app/multilingual/browser/setup.py b/src/plone/app/multilingual/browser/setup.py\nindex 76808f13..9fc3c027 100644\n--- a/src/plone/app/multilingual/browser/setup.py\n+++ b/src/plone/app/multilingual/browser/setup.py\n@@ -265,7 +265,7 @@ def setupLanguageSwitcher(self):\n         site = tt['Plone Site']\n \n         if 'language-switcher' not in site.view_methods:\n-            methods = site.view_methods\n+            methods = tuple(site.view_methods)\n             site.view_methods = methods + ('language-switcher', )\n             site.default_view = 'language-switcher'\n             self.context.reindexObject()\ndiff --git a/src/plone/app/multilingual/setuphandlers.py b/src/plone/app/multilingual/setuphandlers.py\nindex 2b559632..1145a44e 100644\n--- a/src/plone/app/multilingual/setuphandlers.py\n+++ b/src/plone/app/multilingual/setuphandlers.py\n@@ -91,7 +91,7 @@ def disable_language_switcher(portal):\n     tt = getToolByName(portal, 'portal_types')\n     site = tt['Plone Site']\n     methods = site.view_methods\n-    site.view_methods = [m for m in methods if m != 'language-switcher']\n+    site.view_methods = tuple([m for m in methods if m != 'language-switcher'])\n     if site.default_view == 'language-switcher':\n         site.default_view = 'listing_view'\n \n"

