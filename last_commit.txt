Repository: plone.restapi


Branch: refs/heads/main
Date: 2023-11-26T17:17:43-08:00
Author: Víctor Fernández de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/d5b83a67b5a894b7985c67e6c2ae0c9eb1034fd6

Remove wrong `preview_image_link` addition from blocks (de)serializers (#1737)

* Remove wrong `preview_image_link` addition from blocks (de)serializers

* Changelog

* Remove last one

Files changed:
A news/1737.bugfix
M src/plone/restapi/blocks_linkintegrity.py
M src/plone/restapi/deserializer/blocks.py
M src/plone/restapi/serializer/blocks.py

b'diff --git a/news/1737.bugfix b/news/1737.bugfix\nnew file mode 100644\nindex 0000000000..a4953486ab\n--- /dev/null\n+++ b/news/1737.bugfix\n@@ -0,0 +1,2 @@\n+Remove wrong `preview_image_link` addition from blocks (de)serializers\n+[sneridagh]\ndiff --git a/src/plone/restapi/blocks_linkintegrity.py b/src/plone/restapi/blocks_linkintegrity.py\nindex 5a907baa67..754f5c256b 100644\n--- a/src/plone/restapi/blocks_linkintegrity.py\n+++ b/src/plone/restapi/blocks_linkintegrity.py\n@@ -110,7 +110,7 @@ def __call__(self, block):\n         Returns a list of internal links\n         """\n         links = []\n-        for field in ["url", "href", "preview_image", "preview_image_link"]:\n+        for field in ["url", "href", "preview_image"]:\n             value = block.get(field, "")\n             for url in get_urls_from_value(value):\n                 links.append(url)\ndiff --git a/src/plone/restapi/deserializer/blocks.py b/src/plone/restapi/deserializer/blocks.py\nindex 655805903f..59e26a807c 100644\n--- a/src/plone/restapi/deserializer/blocks.py\n+++ b/src/plone/restapi/deserializer/blocks.py\n@@ -55,7 +55,7 @@ class ResolveUIDDeserializerBase:\n \n     order = 1\n     block_type = None\n-    fields = ["url", "href", "preview_image", "preview_image_link"]\n+    fields = ["url", "href", "preview_image"]\n     disabled = os.environ.get("disable_transform_resolveuid", False)\n \n     def __init__(self, context, request):\ndiff --git a/src/plone/restapi/serializer/blocks.py b/src/plone/restapi/serializer/blocks.py\nindex 76669b7092..e255ff7449 100644\n--- a/src/plone/restapi/serializer/blocks.py\n+++ b/src/plone/restapi/serializer/blocks.py\n@@ -40,7 +40,7 @@ def __call__(self):\n class ResolveUIDSerializerBase:\n     order = 1\n     block_type = None\n-    fields = ["url", "href", "preview_image", "preview_image_link"]\n+    fields = ["url", "href", "preview_image"]\n     disabled = os.environ.get("disable_transform_resolveuid", False)\n \n     def __init__(self, context, request):\n'

