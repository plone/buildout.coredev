Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2024-02-19T15:18:03+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.iterate/commit/1541fffa4508e48d2f208de5781e5cdc8bf32fb7

Use package permissions to protect views instead of more general ones.

Files changed:
M plone/app/iterate/browser/configure.zcml
M plone/app/iterate/configure.zcml

b'diff --git a/plone/app/iterate/browser/configure.zcml b/plone/app/iterate/browser/configure.zcml\nindex 81e18d6..58d8d75 100644\n--- a/plone/app/iterate/browser/configure.zcml\n+++ b/plone/app/iterate/browser/configure.zcml\n@@ -20,7 +20,7 @@\n       for="..interfaces.IIterateAware"\n       class=".checkout.Checkout"\n       template="checkout.pt"\n-      permission="zope2.View"\n+      permission="plone.app.iterate.CheckOutContent"\n       />\n \n   <browser:page\n@@ -28,7 +28,7 @@\n       for="..interfaces.IIterateAware"\n       class=".checkin.Checkin"\n       template="checkin.pt"\n-      permission="cmf.ModifyPortalContent"\n+      permission="plone.app.iterate.CheckInContent"\n       />\n \n   <browser:page\n@@ -46,7 +46,7 @@\n       for="..interfaces.IIterateManagedContent"\n       class=".diff.DiffView"\n       template="diff.pt"\n-      permission="zope2.View"\n+      permission="cmf.ModifyPortalContent"\n       />\n \n   <browser:viewlet\ndiff --git a/plone/app/iterate/configure.zcml b/plone/app/iterate/configure.zcml\nindex e3bd469..2c7d165 100644\n--- a/plone/app/iterate/configure.zcml\n+++ b/plone/app/iterate/configure.zcml\n@@ -23,6 +23,16 @@\n       file="meta.zcml"\n       />\n \n+  <permission\n+      id="plone.app.iterate.CheckInContent"\n+      title="iterate : Check in content"\n+      />\n+\n+  <permission\n+      id="plone.app.iterate.CheckOutContent"\n+      title="iterate : Check out content"\n+      />\n+\n   <include package="plone.locking" />\n   <include package="plone.memoize" />\n   <include package="Products.CMFCore" />\n@@ -127,15 +137,4 @@\n       handler=".event.handleDeletion"\n       />\n \n-  <permission\n-      id="plone.app.iterate.CheckInContent"\n-      title="iterate : Check in content"\n-      />\n-\n-  <permission\n-      id="plone.app.iterate.CheckOutContent"\n-      title="iterate : Check out content"\n-      />\n-\n-\n </configure>\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2024-02-19T15:30:31+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.iterate/commit/1908aa1f4e9c95c37143fae88655469b72ea451a

use permissions to control buttons

Files changed:
M plone/app/iterate/browser/control.py

b'diff --git a/plone/app/iterate/browser/control.py b/plone/app/iterate/browser/control.py\nindex 8dc11de..6b8ae7d 100644\n--- a/plone/app/iterate/browser/control.py\n+++ b/plone/app/iterate/browser/control.py\n@@ -25,6 +25,8 @@\n from plone.app.iterate import interfaces\n from plone.app.iterate.interfaces import ICheckinCheckoutPolicy\n from plone.app.iterate.interfaces import IWorkingCopy\n+from plone.app.iterate.permissions import CheckinPermission\n+from plone.app.iterate.permissions import CheckoutPermission\n from plone.memoize.view import memoize\n from Products.Five.browser import BrowserView\n \n@@ -67,6 +69,13 @@ def checkin_allowed(self):\n         if not can_modify:\n             return False\n \n+        can_checkin = checkPermission(\n+            CheckinPermission,\n+            original,\n+        )\n+        if not can_checkin:\n+            return False\n+\n         return True\n \n     def checkout_allowed(self):\n@@ -91,6 +100,14 @@ def checkout_allowed(self):\n         if policy.getBaseline() is not None:\n             return False\n \n+        checkPermission = getSecurityManager().checkPermission\n+        can_checkout = checkPermission(\n+            CheckoutPermission,\n+            context,\n+        )\n+        if not can_checkout:\n+            return False\n+\n         return True\n \n     @memoize\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2024-02-19T15:32:35+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.iterate/commit/8cca38207a3228b375102a116328811f7205c121

add changenote

Files changed:
A news/120.news

b'diff --git a/news/120.news b/news/120.news\nnew file mode 100644\nindex 0000000..cfc64e6\n--- /dev/null\n+++ b/news/120.news\n@@ -0,0 +1,2 @@\n+Use the package-permissions to protect views and toolbar-actions.\n+[pbauer]\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2024-02-20T21:02:52+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.iterate/commit/4dc4c0fdbdb5c8ebbdc1a2fb8ff32bd4a9df4f8d

Use rolemap.xml to manage permission

Files changed:
A plone/app/iterate/profiles/default/rolemap.xml
A plone/app/iterate/profiles/to1001/rolemap.xml
M plone/app/iterate/__init__.py
M plone/app/iterate/configure.zcml
M plone/app/iterate/permissions.py
M plone/app/iterate/profiles/default/metadata.xml

b'diff --git a/plone/app/iterate/__init__.py b/plone/app/iterate/__init__.py\nindex 0ac0aed..4ca32f5 100644\n--- a/plone/app/iterate/__init__.py\n+++ b/plone/app/iterate/__init__.py\n@@ -1,25 +1,3 @@\n-##################################################################\n-#\n-# (C) Copyright 2006 ObjectRealms, LLC\n-# All Rights Reserved\n-#\n-# This file is part of iterate.\n-#\n-# iterate is free software; you can redistribute it and/or modify\n-# it under the terms of the GNU General Public License as published by\n-# the Free Software Foundation; either version 2 of the License, or\n-# (at your option) any later version.\n-#\n-# iterate is distributed in the hope that it will be useful,\n-# but WITHOUT ANY WARRANTY; without even the implied warranty of\n-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-# GNU General Public License for more details.\n-#\n-# You should have received a copy of the GNU General Public License\n-# along with iterate; if not, write to the Free Software\n-# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n-##################################################################\n-from plone.app.iterate import permissions  # noqa: F401\n from zope.i18nmessageid import MessageFactory\n \n import logging\ndiff --git a/plone/app/iterate/configure.zcml b/plone/app/iterate/configure.zcml\nindex 2c7d165..9ef470b 100644\n--- a/plone/app/iterate/configure.zcml\n+++ b/plone/app/iterate/configure.zcml\n@@ -104,6 +104,13 @@\n       directory="profiles/to1000"\n       />\n \n+  <genericsetup:registerProfile\n+      name="to1001"\n+      title="Load rolemap"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/to1001"\n+      />\n+\n   <genericsetup:upgradeDepends\n       title="Use new icons"\n       profile="plone.app.iterate:default"\ndiff --git a/plone/app/iterate/permissions.py b/plone/app/iterate/permissions.py\nindex 1dcf0ce..c56b8b7 100644\n--- a/plone/app/iterate/permissions.py\n+++ b/plone/app/iterate/permissions.py\n@@ -1,31 +1,2 @@\n-##################################################################\n-#\n-# (C) Copyright 2006 ObjectRealms, LLC\n-# All Rights Reserved\n-#\n-# This file is part of iterate.\n-#\n-# iterate is free software; you can redistribute it and/or modify\n-# it under the terms of the GNU General Public License as published by\n-# the Free Software Foundation; either version 2 of the License, or\n-# (at your option) any later version.\n-#\n-# iterate is distributed in the hope that it will be useful,\n-# but WITHOUT ANY WARRANTY; without even the implied warranty of\n-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-# GNU General Public License for more details.\n-#\n-# You should have received a copy of the GNU General Public License\n-# along with CMFDeployment; if not, write to the Free Software\n-# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n-##################################################################\n-\n-from AccessControl.Permission import addPermission\n-\n-\n CheckinPermission = "iterate : Check in content"\n CheckoutPermission = "iterate : Check out content"\n-\n-DEFAULT_ROLES = ("Manager", "Owner", "Site Administrator", "Editor")\n-addPermission(CheckinPermission, default_roles=DEFAULT_ROLES)\n-addPermission(CheckoutPermission, default_roles=DEFAULT_ROLES)\ndiff --git a/plone/app/iterate/profiles/default/metadata.xml b/plone/app/iterate/profiles/default/metadata.xml\nindex f768b5a..9820946 100644\n--- a/plone/app/iterate/profiles/default/metadata.xml\n+++ b/plone/app/iterate/profiles/default/metadata.xml\n@@ -1,4 +1,4 @@\n <?xml version="1.0" encoding="utf-8"?>\n <metadata>\n-  <version>1000</version>\n+  <version>1001</version>\n </metadata>\ndiff --git a/plone/app/iterate/profiles/default/rolemap.xml b/plone/app/iterate/profiles/default/rolemap.xml\nnew file mode 100644\nindex 0000000..1220645\n--- /dev/null\n+++ b/plone/app/iterate/profiles/default/rolemap.xml\n@@ -0,0 +1,21 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<rolemap>\n+  <permissions>\n+    <permission acquire="True"\n+                name="iterate : Check out content"\n+    >\n+      <role name="Manager" />\n+      <role name="Site Administrator" />\n+      <role name="Editor" />\n+      <role name="Owner" />\n+    </permission>\n+    <permission acquire="True"\n+                name="iterate : Check in content"\n+    >\n+      <role name="Manager" />\n+      <role name="Site Administrator" />\n+      <role name="Editor" />\n+      <role name="Owner" />\n+    </permission>\n+  </permissions>\n+</rolemap>\ndiff --git a/plone/app/iterate/profiles/to1001/rolemap.xml b/plone/app/iterate/profiles/to1001/rolemap.xml\nnew file mode 100644\nindex 0000000..1220645\n--- /dev/null\n+++ b/plone/app/iterate/profiles/to1001/rolemap.xml\n@@ -0,0 +1,21 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<rolemap>\n+  <permissions>\n+    <permission acquire="True"\n+                name="iterate : Check out content"\n+    >\n+      <role name="Manager" />\n+      <role name="Site Administrator" />\n+      <role name="Editor" />\n+      <role name="Owner" />\n+    </permission>\n+    <permission acquire="True"\n+                name="iterate : Check in content"\n+    >\n+      <role name="Manager" />\n+      <role name="Site Administrator" />\n+      <role name="Editor" />\n+      <role name="Owner" />\n+    </permission>\n+  </permissions>\n+</rolemap>\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2024-02-21T06:59:26+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.iterate/commit/48cfdbbe109c86f24a432f556b05c49633d8b1f8

make upgrade to 1001 load rolemap

Files changed:
M plone/app/iterate/configure.zcml
D plone/app/iterate/profiles/to1001/rolemap.xml

b'diff --git a/plone/app/iterate/configure.zcml b/plone/app/iterate/configure.zcml\nindex 9ef470b..daabc2a 100644\n--- a/plone/app/iterate/configure.zcml\n+++ b/plone/app/iterate/configure.zcml\n@@ -104,13 +104,6 @@\n       directory="profiles/to1000"\n       />\n \n-  <genericsetup:registerProfile\n-      name="to1001"\n-      title="Load rolemap"\n-      provides="Products.GenericSetup.interfaces.EXTENSION"\n-      directory="profiles/to1001"\n-      />\n-\n   <genericsetup:upgradeDepends\n       title="Use new icons"\n       profile="plone.app.iterate:default"\n@@ -119,6 +112,17 @@\n       import_profile="plone.app.iterate:to1000"\n       />\n \n+  <genericsetup:upgradeSteps\n+      profile="plone.app.iterate:default"\n+      source="1000"\n+      destination="1001"\n+      >\n+    <genericsetup:upgradeDepends\n+        title="Load rolemap"\n+        import_steps="rolemap"\n+        />\n+  </genericsetup:upgradeSteps>\n+\n   <utility\n       factory=".setuphandlers.HiddenProfiles"\n       name="plone.app.iterate"\ndiff --git a/plone/app/iterate/profiles/to1001/rolemap.xml b/plone/app/iterate/profiles/to1001/rolemap.xml\ndeleted file mode 100644\nindex 1220645..0000000\n--- a/plone/app/iterate/profiles/to1001/rolemap.xml\n+++ /dev/null\n@@ -1,21 +0,0 @@\n-<?xml version="1.0" encoding="utf-8"?>\n-<rolemap>\n-  <permissions>\n-    <permission acquire="True"\n-                name="iterate : Check out content"\n-    >\n-      <role name="Manager" />\n-      <role name="Site Administrator" />\n-      <role name="Editor" />\n-      <role name="Owner" />\n-    </permission>\n-    <permission acquire="True"\n-                name="iterate : Check in content"\n-    >\n-      <role name="Manager" />\n-      <role name="Site Administrator" />\n-      <role name="Editor" />\n-      <role name="Owner" />\n-    </permission>\n-  </permissions>\n-</rolemap>\n'

Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2024-02-21T15:05:05+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.iterate/commit/44d83226fdd7233478c02958985fe446193e5498

Merge pull request #120 from plone/use_package_permissions

Use package permissions to protect views instead of more general ones

Files changed:
A news/120.news
A plone/app/iterate/profiles/default/rolemap.xml
M plone/app/iterate/__init__.py
M plone/app/iterate/browser/configure.zcml
M plone/app/iterate/browser/control.py
M plone/app/iterate/configure.zcml
M plone/app/iterate/permissions.py
M plone/app/iterate/profiles/default/metadata.xml

b'diff --git a/news/120.news b/news/120.news\nnew file mode 100644\nindex 0000000..cfc64e6\n--- /dev/null\n+++ b/news/120.news\n@@ -0,0 +1,2 @@\n+Use the package-permissions to protect views and toolbar-actions.\n+[pbauer]\ndiff --git a/plone/app/iterate/__init__.py b/plone/app/iterate/__init__.py\nindex 0ac0aed..4ca32f5 100644\n--- a/plone/app/iterate/__init__.py\n+++ b/plone/app/iterate/__init__.py\n@@ -1,25 +1,3 @@\n-##################################################################\n-#\n-# (C) Copyright 2006 ObjectRealms, LLC\n-# All Rights Reserved\n-#\n-# This file is part of iterate.\n-#\n-# iterate is free software; you can redistribute it and/or modify\n-# it under the terms of the GNU General Public License as published by\n-# the Free Software Foundation; either version 2 of the License, or\n-# (at your option) any later version.\n-#\n-# iterate is distributed in the hope that it will be useful,\n-# but WITHOUT ANY WARRANTY; without even the implied warranty of\n-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-# GNU General Public License for more details.\n-#\n-# You should have received a copy of the GNU General Public License\n-# along with iterate; if not, write to the Free Software\n-# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n-##################################################################\n-from plone.app.iterate import permissions  # noqa: F401\n from zope.i18nmessageid import MessageFactory\n \n import logging\ndiff --git a/plone/app/iterate/browser/configure.zcml b/plone/app/iterate/browser/configure.zcml\nindex 81e18d6..58d8d75 100644\n--- a/plone/app/iterate/browser/configure.zcml\n+++ b/plone/app/iterate/browser/configure.zcml\n@@ -20,7 +20,7 @@\n       for="..interfaces.IIterateAware"\n       class=".checkout.Checkout"\n       template="checkout.pt"\n-      permission="zope2.View"\n+      permission="plone.app.iterate.CheckOutContent"\n       />\n \n   <browser:page\n@@ -28,7 +28,7 @@\n       for="..interfaces.IIterateAware"\n       class=".checkin.Checkin"\n       template="checkin.pt"\n-      permission="cmf.ModifyPortalContent"\n+      permission="plone.app.iterate.CheckInContent"\n       />\n \n   <browser:page\n@@ -46,7 +46,7 @@\n       for="..interfaces.IIterateManagedContent"\n       class=".diff.DiffView"\n       template="diff.pt"\n-      permission="zope2.View"\n+      permission="cmf.ModifyPortalContent"\n       />\n \n   <browser:viewlet\ndiff --git a/plone/app/iterate/browser/control.py b/plone/app/iterate/browser/control.py\nindex 8dc11de..6b8ae7d 100644\n--- a/plone/app/iterate/browser/control.py\n+++ b/plone/app/iterate/browser/control.py\n@@ -25,6 +25,8 @@\n from plone.app.iterate import interfaces\n from plone.app.iterate.interfaces import ICheckinCheckoutPolicy\n from plone.app.iterate.interfaces import IWorkingCopy\n+from plone.app.iterate.permissions import CheckinPermission\n+from plone.app.iterate.permissions import CheckoutPermission\n from plone.memoize.view import memoize\n from Products.Five.browser import BrowserView\n \n@@ -67,6 +69,13 @@ def checkin_allowed(self):\n         if not can_modify:\n             return False\n \n+        can_checkin = checkPermission(\n+            CheckinPermission,\n+            original,\n+        )\n+        if not can_checkin:\n+            return False\n+\n         return True\n \n     def checkout_allowed(self):\n@@ -91,6 +100,14 @@ def checkout_allowed(self):\n         if policy.getBaseline() is not None:\n             return False\n \n+        checkPermission = getSecurityManager().checkPermission\n+        can_checkout = checkPermission(\n+            CheckoutPermission,\n+            context,\n+        )\n+        if not can_checkout:\n+            return False\n+\n         return True\n \n     @memoize\ndiff --git a/plone/app/iterate/configure.zcml b/plone/app/iterate/configure.zcml\nindex e3bd469..daabc2a 100644\n--- a/plone/app/iterate/configure.zcml\n+++ b/plone/app/iterate/configure.zcml\n@@ -23,6 +23,16 @@\n       file="meta.zcml"\n       />\n \n+  <permission\n+      id="plone.app.iterate.CheckInContent"\n+      title="iterate : Check in content"\n+      />\n+\n+  <permission\n+      id="plone.app.iterate.CheckOutContent"\n+      title="iterate : Check out content"\n+      />\n+\n   <include package="plone.locking" />\n   <include package="plone.memoize" />\n   <include package="Products.CMFCore" />\n@@ -102,6 +112,17 @@\n       import_profile="plone.app.iterate:to1000"\n       />\n \n+  <genericsetup:upgradeSteps\n+      profile="plone.app.iterate:default"\n+      source="1000"\n+      destination="1001"\n+      >\n+    <genericsetup:upgradeDepends\n+        title="Load rolemap"\n+        import_steps="rolemap"\n+        />\n+  </genericsetup:upgradeSteps>\n+\n   <utility\n       factory=".setuphandlers.HiddenProfiles"\n       name="plone.app.iterate"\n@@ -127,15 +148,4 @@\n       handler=".event.handleDeletion"\n       />\n \n-  <permission\n-      id="plone.app.iterate.CheckInContent"\n-      title="iterate : Check in content"\n-      />\n-\n-  <permission\n-      id="plone.app.iterate.CheckOutContent"\n-      title="iterate : Check out content"\n-      />\n-\n-\n </configure>\ndiff --git a/plone/app/iterate/permissions.py b/plone/app/iterate/permissions.py\nindex 1dcf0ce..c56b8b7 100644\n--- a/plone/app/iterate/permissions.py\n+++ b/plone/app/iterate/permissions.py\n@@ -1,31 +1,2 @@\n-##################################################################\n-#\n-# (C) Copyright 2006 ObjectRealms, LLC\n-# All Rights Reserved\n-#\n-# This file is part of iterate.\n-#\n-# iterate is free software; you can redistribute it and/or modify\n-# it under the terms of the GNU General Public License as published by\n-# the Free Software Foundation; either version 2 of the License, or\n-# (at your option) any later version.\n-#\n-# iterate is distributed in the hope that it will be useful,\n-# but WITHOUT ANY WARRANTY; without even the implied warranty of\n-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-# GNU General Public License for more details.\n-#\n-# You should have received a copy of the GNU General Public License\n-# along with CMFDeployment; if not, write to the Free Software\n-# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n-##################################################################\n-\n-from AccessControl.Permission import addPermission\n-\n-\n CheckinPermission = "iterate : Check in content"\n CheckoutPermission = "iterate : Check out content"\n-\n-DEFAULT_ROLES = ("Manager", "Owner", "Site Administrator", "Editor")\n-addPermission(CheckinPermission, default_roles=DEFAULT_ROLES)\n-addPermission(CheckoutPermission, default_roles=DEFAULT_ROLES)\ndiff --git a/plone/app/iterate/profiles/default/metadata.xml b/plone/app/iterate/profiles/default/metadata.xml\nindex f768b5a..9820946 100644\n--- a/plone/app/iterate/profiles/default/metadata.xml\n+++ b/plone/app/iterate/profiles/default/metadata.xml\n@@ -1,4 +1,4 @@\n <?xml version="1.0" encoding="utf-8"?>\n <metadata>\n-  <version>1000</version>\n+  <version>1001</version>\n </metadata>\ndiff --git a/plone/app/iterate/profiles/default/rolemap.xml b/plone/app/iterate/profiles/default/rolemap.xml\nnew file mode 100644\nindex 0000000..1220645\n--- /dev/null\n+++ b/plone/app/iterate/profiles/default/rolemap.xml\n@@ -0,0 +1,21 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<rolemap>\n+  <permissions>\n+    <permission acquire="True"\n+                name="iterate : Check out content"\n+    >\n+      <role name="Manager" />\n+      <role name="Site Administrator" />\n+      <role name="Editor" />\n+      <role name="Owner" />\n+    </permission>\n+    <permission acquire="True"\n+                name="iterate : Check in content"\n+    >\n+      <role name="Manager" />\n+      <role name="Site Administrator" />\n+      <role name="Editor" />\n+      <role name="Owner" />\n+    </permission>\n+  </permissions>\n+</rolemap>\n'

