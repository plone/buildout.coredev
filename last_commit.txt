Repository: mockup


Branch: refs/heads/master
Date: 2020-04-29T09:43:03+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/mockup/commit/0e13a14611d99848e98730f355631177dd3da682

add Bootstrap4 selectors and inlinevalidation fix

Files changed:
M mockup/patterns/inlinevalidation/pattern.js
M mockup/patterns/modal/pattern.js

b'diff --git a/mockup/patterns/inlinevalidation/pattern.js b/mockup/patterns/inlinevalidation/pattern.js\nindex ff0eec283..e8278d97e 100644\n--- a/mockup/patterns/inlinevalidation/pattern.js\n+++ b/mockup/patterns/inlinevalidation/pattern.js\n@@ -40,6 +40,23 @@ define([\n        }\n     },\n \n+    render_error_bootstrap: function ($field, errmsg) {\n+        var $input = $(\'input\', $field), $errbox = $(\'.invalid-feedback\', $field);\n+        if (errmsg !== \'\') {\n+            $input.addClass(\'is-invalid\');\n+            if($errbox.length) {\n+                $errbox.html(errmsg);\n+            } else {\n+                $(\'<div class="invalid-feedback">\' + errmsg + \'</div>\').insertAfter($input);\n+            }\n+        } else {\n+            $input.removeClass(\'is-invalid\');\n+            if($errbox.length) {\n+                $errbox.remove();\n+            }\n+        }\n+    },\n+\n     append_url_path: function (url, extra) {\n         // Add \'/extra\' on to the end of the URL, respecting querystring\n         var i, ret, urlParts = url.split(/\\?/);\n@@ -126,12 +143,6 @@ define([\n             fset = $input.closest(\'fieldset\').attr(\'data-fieldset\'),\n             fname = $field.attr(\'data-fieldname\');\n \n-        // XXX: When cloning a form, values from \'select\' elements are not kept\n-        //      so we copy them from the original form here.\n-        $.each( $("select", $form), function ( k, v ) {\n-          $(\'select[name="\'+v.name+\'"]\', $cloned_form).val($(v).val());\n-        } );\n-\n         // XXX: Remove binary files so they are not uploaded to server\n         $cloned_form.find("input[type=file]").remove();\n         if (fname) {\n@@ -141,7 +152,11 @@ define([\n                   data: {fname: fname, fset: fset},\n                   iframe: false,\n                   success: $.proxy(function (data) {\n-                      this.render_error($field, data.errmsg);\n+                      if($field.hasClass(\'form-group\')) {\n+                          this.render_error_bootstrap($field, data.errmsg);\n+                      } else {\n+                          this.render_error($field, data.errmsg);\n+                      }\n                       next();\n                   }, this),\n                   error: function () { next(); },\ndiff --git a/mockup/patterns/modal/pattern.js b/mockup/patterns/modal/pattern.js\nindex c00bf80d1..1a4353253 100644\n--- a/mockup/patterns/modal/pattern.js\n+++ b/mockup/patterns/modal/pattern.js\n@@ -106,7 +106,7 @@ define([\n       },\n       title: null,\n       titleSelector: \'h1:first\',\n-      buttons: \'.formControls > input[type="submit"]\',\n+      buttons: \'.formControls > input[type="submit"], .formControls > button\',\n       content: \'#content\',\n       automaticallyAddButtonActions: true,\n       loadLinksWithinModal: true,\n'

Repository: mockup


Branch: refs/heads/master
Date: 2020-04-29T09:43:03+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/mockup/commit/17f9b2323d296d54931016dceb711e881d27e933

add changelog

Files changed:
A news/975.feature

b'diff --git a/news/975.feature b/news/975.feature\nnew file mode 100644\nindex 000000000..fae9eb9e5\n--- /dev/null\n+++ b/news/975.feature\n@@ -0,0 +1,2 @@\n+Barceloneta-LTS support\n+[petschki]\n'

Repository: mockup


Branch: refs/heads/master
Date: 2020-04-29T09:43:03+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/mockup/commit/eedaf5152bc8a9cbc6f38b5129b7ae12ce095743

reapply fix

Files changed:
M mockup/patterns/inlinevalidation/pattern.js

b'diff --git a/mockup/patterns/inlinevalidation/pattern.js b/mockup/patterns/inlinevalidation/pattern.js\nindex e8278d97e..42abf5cba 100644\n--- a/mockup/patterns/inlinevalidation/pattern.js\n+++ b/mockup/patterns/inlinevalidation/pattern.js\n@@ -143,6 +143,12 @@ define([\n             fset = $input.closest(\'fieldset\').attr(\'data-fieldset\'),\n             fname = $field.attr(\'data-fieldname\');\n \n+        // XXX: When cloning a form, values from \'select\' elements are not kept\n+        //      so we copy them from the original form here.\n+        $.each( $("select", $form), function ( k, v ) {\n+          $(\'select[name="\'+v.name+\'"]\', $cloned_form).val($(v).val());\n+        } );\n+\n         // XXX: Remove binary files so they are not uploaded to server\n         $cloned_form.find("input[type=file]").remove();\n         if (fname) {\n'

