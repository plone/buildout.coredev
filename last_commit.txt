Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-12-15T22:22:10+01:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.restapi/commit/4a3ad2bc1db7ee2084a18eeabe9272a8239c38c0

check that we are in Plone 5 (#1030)

Files changed:
A news/1029.bugfix
M src/plone/restapi/services/content/add.py

b'diff --git a/news/1029.bugfix b/news/1029.bugfix\nnew file mode 100644\nindex 000000000..230889fa4\n--- /dev/null\n+++ b/news/1029.bugfix\n@@ -0,0 +1 @@\n+Check for Plone 5 in content-adding endpoint if plone.app.multilingual is installed [erral]\n\\ No newline at end of file\ndiff --git a/src/plone/restapi/services/content/add.py b/src/plone/restapi/services/content/add.py\nindex a2a9718fd..d20f68fb2 100644\n--- a/src/plone/restapi/services/content/add.py\n+++ b/src/plone/restapi/services/content/add.py\n@@ -8,6 +8,7 @@\n from plone.restapi.services import Service\n from plone.restapi.services.content.utils import add\n from plone.restapi.services.content.utils import create\n+from Products.CMFPlone.utils import getFSVersionTuple\n from Products.CMFPlone.utils import safe_hasattr\n from zExceptions import BadRequest\n from zExceptions import Unauthorized\n@@ -29,6 +30,8 @@\n except pkg_resources.DistributionNotFound:\n     PAM_INSTALLED = False\n \n+PLONE5 = getFSVersionTuple()[0] >= 5\n+\n \n class FolderPost(Service):\n     """Creates a new content object."""\n@@ -88,7 +91,7 @@ def reply(self):\n         obj = add(self.context, obj, rename=not bool(id_))\n \n         # Link translation given the translation_of property\n-        if PAM_INSTALLED:\n+        if PAM_INSTALLED and PLONE5:\n             from plone.app.multilingual.interfaces import (\n                 IPloneAppMultilingualInstalled,\n             )  # noqa\n'

