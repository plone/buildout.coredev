Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2022-02-25T20:32:43+02:00
Author: MrTango (MrTango) <md@derico.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/a72b481536b7789d032a8c311d8f214d67eb34b4

Fix detection of initial login time

Files changed:
A news/3447.bugfix
M Products/CMFPlone/browser/login/password_reset.py

b"diff --git a/Products/CMFPlone/browser/login/password_reset.py b/Products/CMFPlone/browser/login/password_reset.py\nindex 54610c2f28..9b75c02695 100644\n--- a/Products/CMFPlone/browser/login/password_reset.py\n+++ b/Products/CMFPlone/browser/login/password_reset.py\n@@ -1,5 +1,6 @@\n # -*- coding: utf-8 -*-\n from AccessControl.SecurityManagement import getSecurityManager\n+from DateTime import DateTime\n from email.header import Header\n from plone.app.layout.navigation.interfaces import INavigationRoot\n from plone.memoize import view\n@@ -109,8 +110,9 @@ def _auto_login(self, userid, password):\n             # with the given userid\n             user = getSecurityManager().getUser()\n \n-        login_time = user.getProperty('login_time', None)\n-        if login_time is None:\n+        default = DateTime('2000/01/01')\n+        login_time = user.getProperty('login_time', default)\n+        if login_time == default:\n             notify(UserInitialLoginInEvent(user))\n         else:\n             notify(UserLoggedInEvent(user))\ndiff --git a/news/3447.bugfix b/news/3447.bugfix\nnew file mode 100644\nindex 0000000000..ab80f61905\n--- /dev/null\n+++ b/news/3447.bugfix\n@@ -0,0 +1 @@\n+Fix detection of initial login time [MrTango]\n\\ No newline at end of file\n"

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2022-03-04T18:13:37+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/09bee7d5cee88b4f548237ce062548298d5c9e0f

Merge pull request #3447 from plone/mrtango-fix-initial-login-detection

fix initial login detection

Files changed:
A news/3447.bugfix
M Products/CMFPlone/browser/login/password_reset.py

b"diff --git a/Products/CMFPlone/browser/login/password_reset.py b/Products/CMFPlone/browser/login/password_reset.py\nindex 54610c2f28..9b75c02695 100644\n--- a/Products/CMFPlone/browser/login/password_reset.py\n+++ b/Products/CMFPlone/browser/login/password_reset.py\n@@ -1,5 +1,6 @@\n # -*- coding: utf-8 -*-\n from AccessControl.SecurityManagement import getSecurityManager\n+from DateTime import DateTime\n from email.header import Header\n from plone.app.layout.navigation.interfaces import INavigationRoot\n from plone.memoize import view\n@@ -109,8 +110,9 @@ def _auto_login(self, userid, password):\n             # with the given userid\n             user = getSecurityManager().getUser()\n \n-        login_time = user.getProperty('login_time', None)\n-        if login_time is None:\n+        default = DateTime('2000/01/01')\n+        login_time = user.getProperty('login_time', default)\n+        if login_time == default:\n             notify(UserInitialLoginInEvent(user))\n         else:\n             notify(UserLoggedInEvent(user))\ndiff --git a/news/3447.bugfix b/news/3447.bugfix\nnew file mode 100644\nindex 0000000000..ab80f61905\n--- /dev/null\n+++ b/news/3447.bugfix\n@@ -0,0 +1 @@\n+Fix detection of initial login time [MrTango]\n\\ No newline at end of file\n"

