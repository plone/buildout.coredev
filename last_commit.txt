Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2024-02-21T15:16:09+01:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/ddf3db89e5150a2cbec96f83f1418b6678232ea9

Fix tinymce format icon names (#321)

Files changed:
A news/3095.bugfix
M plone/app/upgrade/v60/configure.zcml
M plone/app/upgrade/v60/final.py

b'diff --git a/news/3095.bugfix b/news/3095.bugfix\nnew file mode 100644\nindex 00000000..d78152cd\n--- /dev/null\n+++ b/news/3095.bugfix\n@@ -0,0 +1,2 @@\n+Update TinyMCE format icon names.\n+[petschki]\ndiff --git a/plone/app/upgrade/v60/configure.zcml b/plone/app/upgrade/v60/configure.zcml\nindex 01b3009f..ac7261a2 100644\n--- a/plone/app/upgrade/v60/configure.zcml\n+++ b/plone/app/upgrade/v60/configure.zcml\n@@ -358,8 +358,8 @@\n         <!-- Plone 6.0.10 -->\n \n         <gs:upgradeStep\n-            title="Miscellaneous"\n-            handler="..utils.null_upgrade_step"\n+            title="Fix TinyMCE format icon names"\n+            handler=".final.fix_tinymce_format_iconnames"\n             />\n \n     </gs:upgradeSteps>\ndiff --git a/plone/app/upgrade/v60/final.py b/plone/app/upgrade/v60/final.py\nindex 4b6479d2..512544c5 100644\n--- a/plone/app/upgrade/v60/final.py\n+++ b/plone/app/upgrade/v60/final.py\n@@ -206,3 +206,23 @@ def fix_syndication_settings(context):\n         key = f"{old_iface}.{fieldname}"\n         if key in record_keys:\n             del registry.records[key]\n+\n+\n+def fix_tinymce_format_iconnames(context):\n+    """Fix \'strike-through\' and \'sourcecode\'.\n+\n+    See https://github.com/plone/Products.CMFPlone/issues/3905\n+    """\n+    registry = getUtility(IRegistry)\n+    record = registry.records.get("plone.inline_styles")\n+    if record is None:\n+        return\n+    values = record.value\n+    replacements = [\n+        ("Strikethrough|strikethrough|strikethrough", "Strikethrough|strikethrough|strike-through"),\n+        ("Code|code|code", "Code|code|sourcecode")\n+    ]\n+    for _old, _new in replacements:\n+        if _old in values:\n+            values[values.index(_old)] = _new\n+    record.value = values\n'

