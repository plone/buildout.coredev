Repository: plone.testing


Branch: refs/heads/master
Date: 2020-07-31T14:41:52+02:00
Author: JÃ¼rgen Gmach (jugmac00) <juergen.gmach@googlemail.com>
Commit: https://github.com/plone/plone.testing/commit/c047edca543b5f99eac590fe63af697225510131

update `isort` configuration for version 5 of `isort` (#76)

* Remove broken `flake8-isort` plugin

With the release of isort 5, the API has changed, which caused
`flake8-isort` to break.

Also, `isort` is run anyway with a separate command, so there should be
no need for `flake8` plugin anyway.

modified:   tox.ini

* Remove deprecated and obsolete options

Both
- not_skip
- recursive
are absolete with isort version 5.

modified:   setup.cfg
modified:   tox.ini

* Apply isort

modified:   src/plone/testing/_z2_testbrowser.py
modified:   src/plone/testing/publisher.py
modified:   src/plone/testing/security.py
modified:   src/plone/testing/tests.py
modified:   src/plone/testing/z2.py
modified:   src/plone/testing/zca.py
modified:   src/plone/testing/zodb.py
modified:   src/plone/testing/zope.py
modified:   src/plone/testing/zserver.py

* Remove deprecated command line option "apply"

With the new `isort` version 5, `apply` is deprecated.

modified:   tox.ini

* Add changelog entry for `75`

new file:   news/75.bugfix

Files changed:
A news/75.bugfix
M setup.cfg
M src/plone/testing/_z2_testbrowser.py
M src/plone/testing/publisher.py
M src/plone/testing/security.py
M src/plone/testing/tests.py
M src/plone/testing/z2.py
M src/plone/testing/zca.py
M src/plone/testing/zodb.py
M src/plone/testing/zope.py
M src/plone/testing/zserver.py
M tox.ini

b'diff --git a/news/75.bugfix b/news/75.bugfix\nnew file mode 100644\nindex 0000000..dcc7f26\n--- /dev/null\n+++ b/news/75.bugfix\n@@ -0,0 +1 @@\n+update `isort` configuration for version 5 of `isort`\ndiff --git a/setup.cfg b/setup.cfg\nindex 8100630..f408c8d 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -35,7 +35,6 @@ force_alphabetical_sort = True\n force_single_line = True\n lines_after_imports = 2\n line_length = 200\n-not_skip = __init__.py\n \n [flake8]\n exclude =\ndiff --git a/src/plone/testing/_z2_testbrowser.py b/src/plone/testing/_z2_testbrowser.py\nindex 7eba318..2486f60 100644\n--- a/src/plone/testing/_z2_testbrowser.py\n+++ b/src/plone/testing/_z2_testbrowser.py\n@@ -1,5 +1,6 @@\n # -*- coding: utf-8 -*-\n from __future__ import absolute_import\n+\n from zope.testbrowser import browser\n from ZPublisher.httpexceptions import HTTPExceptionHandler\n from ZPublisher.utils import basic_auth_encode\ndiff --git a/src/plone/testing/publisher.py b/src/plone/testing/publisher.py\nindex eb1ca4d..d20f648 100644\n--- a/src/plone/testing/publisher.py\n+++ b/src/plone/testing/publisher.py\n@@ -2,6 +2,7 @@\n """Helpers for working with common Zope publisher operations\n """\n from __future__ import absolute_import\n+\n from plone.testing import Layer\n from plone.testing import security\n from plone.testing import zca\ndiff --git a/src/plone/testing/security.py b/src/plone/testing/security.py\nindex b4ba7e3..a349456 100644\n--- a/src/plone/testing/security.py\n+++ b/src/plone/testing/security.py\n@@ -2,6 +2,7 @@\n """Security helpers and layers\n """\n from __future__ import absolute_import\n+\n from plone.testing import Layer\n \n \ndiff --git a/src/plone/testing/tests.py b/src/plone/testing/tests.py\nindex 1a4e27c..b177be2 100644\n--- a/src/plone/testing/tests.py\n+++ b/src/plone/testing/tests.py\n@@ -1,5 +1,6 @@\n # -*- coding: utf-8 -*-\n from __future__ import absolute_import\n+\n from OFS.SimpleItem import SimpleItem\n from pkg_resources import get_distribution\n from zope.testing import renormalizing\ndiff --git a/src/plone/testing/z2.py b/src/plone/testing/z2.py\nindex 0cc7c42..5852b5b 100644\n--- a/src/plone/testing/z2.py\n+++ b/src/plone/testing/z2.py\n@@ -1,5 +1,6 @@\n # -*- coding: utf-8 -*-\n from __future__ import absolute_import\n+\n from zope.deferredimport import deprecated\n \n import plone.testing\ndiff --git a/src/plone/testing/zca.py b/src/plone/testing/zca.py\nindex 8bf10c3..dc0cd9e 100644\n--- a/src/plone/testing/zca.py\n+++ b/src/plone/testing/zca.py\n@@ -2,6 +2,7 @@\n """Core Zope Component Architecture helpers and layers\n """\n from __future__ import absolute_import\n+\n from plone.testing import Layer\n from zope.configuration.config import ConfigurationMachine\n \n@@ -100,7 +101,8 @@ def pushGlobalRegistry(new=None):\n     getSiteManager.reset()\n \n     try:\n-        from zope.component.hooks import setSite, setHooks\n+        from zope.component.hooks import setHooks\n+        from zope.component.hooks import setSite\n     except ImportError:\n         pass\n     else:\n@@ -141,7 +143,8 @@ def popGlobalRegistry():\n     getSiteManager.reset()\n \n     try:\n-        from zope.component.hooks import setSite, setHooks\n+        from zope.component.hooks import setHooks\n+        from zope.component.hooks import setSite\n     except ImportError:\n         pass\n     else:\n@@ -177,12 +180,10 @@ def stackConfigurationContext(context=None, name=\'not named\'):\n     """\n \n     from copy import deepcopy\n-\n+    from zope.configuration.xmlconfig import registerCommonDirectives\n     from zope.interface import Interface\n     from zope.interface.adapter import AdapterRegistry\n \n-    from zope.configuration.xmlconfig import registerCommonDirectives\n-\n     clone = NamedConfigurationMachine(name)\n \n     # Prime this so that the <meta:redefinePermission /> directive won\'t lose\n@@ -301,6 +302,7 @@ class ZCMLDirectives(Layer):\n     def setUp(self):\n \n         from zope.configuration import xmlconfig\n+\n         import zope.component\n \n         self[\'configurationContext\'] = context = stackConfigurationContext(\ndiff --git a/src/plone/testing/zodb.py b/src/plone/testing/zodb.py\nindex 43f2259..1316291 100644\n--- a/src/plone/testing/zodb.py\n+++ b/src/plone/testing/zodb.py\n@@ -19,8 +19,8 @@ def tearDown(self):\n             del self[\'zodbDB\']\n     """\n \n-    from ZODB.DemoStorage import DemoStorage\n     from ZODB.DB import DB\n+    from ZODB.DemoStorage import DemoStorage\n \n     if db is not None:\n         storage = DemoStorage(name=name, base=db.storage)\ndiff --git a/src/plone/testing/zope.py b/src/plone/testing/zope.py\nindex 20613c4..01ac3bb 100644\n--- a/src/plone/testing/zope.py\n+++ b/src/plone/testing/zope.py\n@@ -2,6 +2,7 @@\n """Zope-specific helpers and layers using WSGI\n """\n from __future__ import absolute_import\n+\n from OFS.metaconfigure import get_packages_to_initialize\n from plone.testing import Layer\n from plone.testing import zca\n@@ -47,6 +48,7 @@ def installProduct(app, productName, quiet=False, multiinit=False):\n     from OFS.Application import install_package\n     from OFS.Application import install_product\n     from OFS.Folder import Folder\n+\n     import sys\n \n     found = False\n@@ -99,14 +101,15 @@ def uninstallProduct(app, productName, quiet=False):\n     ``installProduct()`` above.\n     """\n \n+    from OFS.Application import Application\n+    from OFS.Application import get_products\n+\n     import sys\n \n     # from OFS.Folder import Folder\n     # from OFS.Application import get_folder_permissions\n     # from AccessControl.class_init import InitializeClass\n \n-    from OFS.Application import Application, get_products\n-\n     global _INSTALLED_PRODUCTS\n     found = False\n \n@@ -181,7 +184,8 @@ def setRoles(userFolder, userId, roles):\n \n def makeTestRequest(environ=None):\n     """Return an HTTPRequest object suitable for testing views."""\n-    from sys import stdin, stdout\n+    from sys import stdin\n+    from sys import stdout\n     from zope.publisher.browser import setDefaultSkin\n     from ZPublisher.HTTPRequest import HTTPRequest\n     from ZPublisher.HTTPResponse import HTTPResponse\n@@ -461,8 +465,8 @@ def setUpDatabase(self):\n         the resource stack.\n         """\n \n-        import Zope2.Startup.datatypes\n         import App.config\n+        import Zope2.Startup.datatypes\n \n         # Layer a new storage for Zope 2 on top of the one from the base\n         # layer, if there is one.\ndiff --git a/src/plone/testing/zserver.py b/src/plone/testing/zserver.py\nindex a9879e2..756ff06 100644\n--- a/src/plone/testing/zserver.py\n+++ b/src/plone/testing/zserver.py\n@@ -2,6 +2,7 @@\n """Zope2-specific helpers and layers using ZServer\n """\n from __future__ import absolute_import\n+\n from plone.testing import Layer\n from plone.testing import zodb\n from plone.testing import zope\n@@ -386,9 +387,10 @@ class ZServer(Layer):\n \n     def setUp(self):\n \n-        import time\n         from threading import Thread\n \n+        import time\n+\n         self[\'host\'] = self.host\n         self[\'port\'] = self.port\n \n@@ -419,8 +421,10 @@ def tearDown(self):\n     def setUpServer(self):\n         """Create a ZServer server instance and save it in self.zserver\n         """\n-        from ZServer import zhttp_server, zhttp_handler, logger\n         from StringIO import StringIO\n+        from ZServer import logger\n+        from ZServer import zhttp_handler\n+        from ZServer import zhttp_server\n \n         log = self.log\n         if log is None:\n@@ -506,9 +510,9 @@ def setUpServer(self):\n         """Create an FTP server instance and save it in self.ftpServer\n         """\n \n+        from StringIO import StringIO\n         from ZServer import logger\n         from ZServer.FTPServer import FTPServer\n-        from StringIO import StringIO\n \n         log = self.log\n         if log is None:\ndiff --git a/tox.ini b/tox.ini\nindex b9dd600..1c1dbb6 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -69,7 +69,6 @@ deps =\n     flake8-print\n     # flake8-pytest\n     # flake8-todo\n-    flake8-isort\n     mccabe\n     # Potential flake8 plugins that should be used:  # TBD\n     #flake8-blind-except\n@@ -87,7 +86,7 @@ commands =\n     mkdir -p {toxinidir}/_build/reports/flake8\n     - flake8 --format=html --htmldir={toxinidir}/_build/reports/flake8 --doctests src setup.py\n     flake8 --doctests --ignore=W503 src setup.py\n-    isort --check-only --recursive {toxinidir}/src\n+    isort --check-only {toxinidir}/src\n \n whitelist_externals =\n     mkdir\n@@ -99,7 +98,7 @@ deps =\n     isort\n \n commands =\n-    isort --apply --recursive {toxinidir}/src\n+    isort {toxinidir}/src\n \n [testenv:lint-py27]\n basepython = python2.7\n'

