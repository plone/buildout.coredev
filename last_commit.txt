Repository: plone.app.linkintegrity


Branch: refs/heads/master
Date: 2022-04-21T21:39:10+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.linkintegrity/commit/f15709a48afdb23e6204de1629705451133b90b5

Test fix: only load plone.app.contenttypes migration layer on Python 2.

This is needed to fix our failing test setup in combination with https://github.com/plone/plone.app.contenttypes/pull/641
That PR for Plone 6 removes the migration test layer.

Files changed:
A news/641.bugfix
M plone/app/linkintegrity/testing.py

b'diff --git a/news/641.bugfix b/news/641.bugfix\nnew file mode 100644\nindex 0000000..c221ae6\n--- /dev/null\n+++ b/news/641.bugfix\n@@ -0,0 +1,2 @@\n+Test fix: only load plone.app.contenttypes migration layer on Python 2.\n+[maurits]\ndiff --git a/plone/app/linkintegrity/testing.py b/plone/app/linkintegrity/testing.py\nindex bc7ae30..7391708 100644\n--- a/plone/app/linkintegrity/testing.py\n+++ b/plone/app/linkintegrity/testing.py\n@@ -1,6 +1,5 @@\n # -*- coding: utf-8 -*-\n from plone.app.contenttypes.testing import PLONE_APP_CONTENTTYPES_FIXTURE\n-from plone.app.contenttypes.testing import PLONE_APP_CONTENTTYPES_MIGRATION_FIXTURE  # noqa\n from plone.app.testing import layers\n from plone.app.testing import login\n from plone.app.testing import PLONE_FIXTURE\n@@ -95,29 +94,6 @@ def tearDown(self):\n PLONE_APP_LINKINTEGRITY_FIXTURE = LinkIntegrityLayer()\n \n \n-class LinkIntegrityATLayer(LinkIntegrityLayer):\n-    """Layer which targets testing with Archetypes and ATContentTypes.\n-    """\n-\n-    directory = \'at\'\n-    defaultBases = (\n-        PLONE_APP_CONTENTTYPES_MIGRATION_FIXTURE,\n-        PLONE_APP_LINKINTEGRITY_FIXTURE,\n-    )\n-\n-    def setUp(self):\n-        self.setUpContent()\n-\n-    def setUpContent(self):\n-        super(LinkIntegrityATLayer, self).setUpContent()\n-\n-        with ploneSite() as portal:\n-            create(portal, \'Image\', id=\'image1\', title=\'Image 1\', image=GIF)\n-\n-\n-PLONE_APP_LINKINTEGRITY_AT_FIXTURE = LinkIntegrityATLayer()\n-\n-\n class LinkIntegrityDXLayer(LinkIntegrityLayer):\n     """Layer which targets testing with Dexterity.\n     """\n@@ -157,6 +133,31 @@ def setUpContent(self):\n )\n \n if six.PY2:\n+    from plone.app.contenttypes.testing import (\n+        PLONE_APP_CONTENTTYPES_MIGRATION_FIXTURE,\n+    )\n+\n+    class LinkIntegrityATLayer(LinkIntegrityLayer):\n+        """Layer which targets testing with Archetypes and ATContentTypes.\n+        """\n+\n+        directory = \'at\'\n+        defaultBases = (\n+            PLONE_APP_CONTENTTYPES_MIGRATION_FIXTURE,\n+            PLONE_APP_LINKINTEGRITY_FIXTURE,\n+        )\n+\n+        def setUp(self):\n+            self.setUpContent()\n+\n+        def setUpContent(self):\n+            super(LinkIntegrityATLayer, self).setUpContent()\n+\n+            with ploneSite() as portal:\n+                create(portal, \'Image\', id=\'image1\', title=\'Image 1\', image=GIF)\n+\n+    PLONE_APP_LINKINTEGRITY_AT_FIXTURE = LinkIntegrityATLayer()\n+\n     PLONE_APP_LINKINTEGRITY_AT_INTEGRATION_TESTING = layers.IntegrationTesting(\n         bases=(PLONE_APP_LINKINTEGRITY_AT_FIXTURE, ),\n         name=\'plone.app.linkintegrity:AT:Integration\'\n'

Repository: plone.app.linkintegrity


Branch: refs/heads/master
Date: 2022-04-26T17:35:05+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.linkintegrity/commit/9e5caa7494f0482fe52ddbcc6ce886ac49178d77

Merge pull request #86 from plone/maurits-pac-at-migration-layer

Test fix: only load plone.app.contenttypes migration layer on Python 2.

Files changed:
A news/641.bugfix
M plone/app/linkintegrity/testing.py

b'diff --git a/news/641.bugfix b/news/641.bugfix\nnew file mode 100644\nindex 0000000..c221ae6\n--- /dev/null\n+++ b/news/641.bugfix\n@@ -0,0 +1,2 @@\n+Test fix: only load plone.app.contenttypes migration layer on Python 2.\n+[maurits]\ndiff --git a/plone/app/linkintegrity/testing.py b/plone/app/linkintegrity/testing.py\nindex bc7ae30..7391708 100644\n--- a/plone/app/linkintegrity/testing.py\n+++ b/plone/app/linkintegrity/testing.py\n@@ -1,6 +1,5 @@\n # -*- coding: utf-8 -*-\n from plone.app.contenttypes.testing import PLONE_APP_CONTENTTYPES_FIXTURE\n-from plone.app.contenttypes.testing import PLONE_APP_CONTENTTYPES_MIGRATION_FIXTURE  # noqa\n from plone.app.testing import layers\n from plone.app.testing import login\n from plone.app.testing import PLONE_FIXTURE\n@@ -95,29 +94,6 @@ def tearDown(self):\n PLONE_APP_LINKINTEGRITY_FIXTURE = LinkIntegrityLayer()\n \n \n-class LinkIntegrityATLayer(LinkIntegrityLayer):\n-    """Layer which targets testing with Archetypes and ATContentTypes.\n-    """\n-\n-    directory = \'at\'\n-    defaultBases = (\n-        PLONE_APP_CONTENTTYPES_MIGRATION_FIXTURE,\n-        PLONE_APP_LINKINTEGRITY_FIXTURE,\n-    )\n-\n-    def setUp(self):\n-        self.setUpContent()\n-\n-    def setUpContent(self):\n-        super(LinkIntegrityATLayer, self).setUpContent()\n-\n-        with ploneSite() as portal:\n-            create(portal, \'Image\', id=\'image1\', title=\'Image 1\', image=GIF)\n-\n-\n-PLONE_APP_LINKINTEGRITY_AT_FIXTURE = LinkIntegrityATLayer()\n-\n-\n class LinkIntegrityDXLayer(LinkIntegrityLayer):\n     """Layer which targets testing with Dexterity.\n     """\n@@ -157,6 +133,31 @@ def setUpContent(self):\n )\n \n if six.PY2:\n+    from plone.app.contenttypes.testing import (\n+        PLONE_APP_CONTENTTYPES_MIGRATION_FIXTURE,\n+    )\n+\n+    class LinkIntegrityATLayer(LinkIntegrityLayer):\n+        """Layer which targets testing with Archetypes and ATContentTypes.\n+        """\n+\n+        directory = \'at\'\n+        defaultBases = (\n+            PLONE_APP_CONTENTTYPES_MIGRATION_FIXTURE,\n+            PLONE_APP_LINKINTEGRITY_FIXTURE,\n+        )\n+\n+        def setUp(self):\n+            self.setUpContent()\n+\n+        def setUpContent(self):\n+            super(LinkIntegrityATLayer, self).setUpContent()\n+\n+            with ploneSite() as portal:\n+                create(portal, \'Image\', id=\'image1\', title=\'Image 1\', image=GIF)\n+\n+    PLONE_APP_LINKINTEGRITY_AT_FIXTURE = LinkIntegrityATLayer()\n+\n     PLONE_APP_LINKINTEGRITY_AT_INTEGRATION_TESTING = layers.IntegrationTesting(\n         bases=(PLONE_APP_LINKINTEGRITY_AT_FIXTURE, ),\n         name=\'plone.app.linkintegrity:AT:Integration\'\n'

