Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2020-06-26T16:01:51+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/47f2b445b613e1ddc77ff5f1b7ea111f633c7857

Fix flake8
Fixes #139

Files changed:
A news/139.bugfix
M src/plone/recipe/zope2instance/recipe.py

b'diff --git a/news/139.bugfix b/news/139.bugfix\nnew file mode 100644\nindex 0000000..6e39e64\n--- /dev/null\n+++ b/news/139.bugfix\n@@ -0,0 +1 @@\n+Fix flake8 [ale-rt]\ndiff --git a/src/plone/recipe/zope2instance/recipe.py b/src/plone/recipe/zope2instance/recipe.py\nindex 446b337..9ced5c9 100644\n--- a/src/plone/recipe/zope2instance/recipe.py\n+++ b/src/plone/recipe/zope2instance/recipe.py\n@@ -296,7 +296,7 @@ def build_zope_conf(self):\n             chameleon_cache = \'CHAMELEON_CACHE {}\'.format(chameleon_cache)\n             if environment_vars and \'\\n\' in environment_vars:\n                 # default case\n-                environment_vars += \'\\n\'.format(chameleon_cache)\n+                environment_vars += \'\\n\'\n             elif environment_vars:\n                 # handle case of all vars in one line\n                 environment_vars += \' {}\'.format(chameleon_cache)\n@@ -717,9 +717,9 @@ def is_rs_option(name):\n             enable_products=enable_products,\n             zope_conf_additional=zope_conf_additional,)\n \n-        zope_conf = \'\\n\'.join([l\n-                               for l in zope_conf.splitlines()\n-                               if l.rstrip()])\n+        zope_conf = "\\n".join(\n+            [line for line in zope_conf.splitlines() if line.rstrip()]\n+        )\n         zope_conf_path = os.path.join(location, \'etc\', \'zope.conf\')\n         with open(zope_conf_path, \'w\') as f:\n             f.write(zope_conf)\n'

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2020-06-27T09:28:27+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/44a4f844638f2290cdfe935a0eb6a24e9723cc4e

Fixup

Files changed:
M src/plone/recipe/zope2instance/recipe.py

b"diff --git a/src/plone/recipe/zope2instance/recipe.py b/src/plone/recipe/zope2instance/recipe.py\nindex 9ced5c9..47774be 100644\n--- a/src/plone/recipe/zope2instance/recipe.py\n+++ b/src/plone/recipe/zope2instance/recipe.py\n@@ -296,7 +296,7 @@ def build_zope_conf(self):\n             chameleon_cache = 'CHAMELEON_CACHE {}'.format(chameleon_cache)\n             if environment_vars and '\\n' in environment_vars:\n                 # default case\n-                environment_vars += '\\n'\n+                environment_vars += '\\n{}'.format(chameleon_cache)\n             elif environment_vars:\n                 # handle case of all vars in one line\n                 environment_vars += ' {}'.format(chameleon_cache)\n"

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2020-06-27T10:53:58+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/d573d76350ee9d7e485533f867b02400c92ec6dc

Adapt tests

Files changed:
M src/plone/recipe/zope2instance/tests/zope2instance.txt
M src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt

b'diff --git a/src/plone/recipe/zope2instance/tests/zope2instance.txt b/src/plone/recipe/zope2instance/tests/zope2instance.txt\nindex 891049c..bbcf308 100644\n--- a/src/plone/recipe/zope2instance/tests/zope2instance.txt\n+++ b/src/plone/recipe/zope2instance/tests/zope2instance.txt\n@@ -1445,8 +1445,11 @@ Our environment variables should be set now::\n     >>> zope_conf = zope_conf.replace(\'\\\\\', \'/\')\n     >>> import re\n     >>> env_vars = re.compile(r"<environment>\\n\\s*(?P<vars>.*)\\n</environment>", re.M | re.S)\n-    >>> re.search(env_vars, zope_conf).group(\'vars\')\n-    \'TZ US/Eastern\\nTMP /var/tmp\\nDISABLE_PTS True\'\n+    >>> print(re.search(env_vars, zope_conf).group(\'vars\'))\n+    TZ US/Eastern\n+    TMP /var/tmp\n+    DISABLE_PTS True\n+    CHAMELEON_CACHE .../var/cache\n \n Several all on one line::\n \ndiff --git a/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt b/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt\nindex 51921db..c12321b 100644\n--- a/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt\n+++ b/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt\n@@ -1737,8 +1737,10 @@ Our environment variables should be set now::\n     >>> zope_conf = zope_conf.replace(\'\\\\\', \'/\')\n     >>> import re\n     >>> env_vars = re.compile(r"<environment>\\n\\s*(?P<vars>.*)\\n</environment>", re.M | re.S)\n-    >>> re.search(env_vars, zope_conf).group(\'vars\')\n-    \'TZ US/Eastern\\nTMP /var/tmp\\nDISABLE_PTS True\'\n+    >>> print(re.search(env_vars, zope_conf).group(\'vars\'))\n+    TZ US/Eastern\n+    TMP /var/tmp\n+    DISABLE_PTS True\n \n Several all on one line::\n \n@@ -1770,8 +1772,10 @@ Our environment variables should be set now::\n     >>> instance = os.path.join(sample_buildout, \'parts\', \'instance\')\n     >>> zope_conf = open(os.path.join(instance, \'etc\', \'zope.conf\')).read()\n     >>> zope_conf = zope_conf.replace(\'\\\\\', \'/\')\n-    >>> re.search(env_vars, zope_conf).group(\'vars\')\n-    \'TZ US/Eastern\\nTMP /var/tmp\\nDISABLE_PTS True\'\n+    >>> print(re.search(env_vars, zope_conf).group(\'vars\'))\n+    TZ US/Eastern\n+    TMP /var/tmp\n+    DISABLE_PTS True\n \n \n HTTP server\n'

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2020-06-27T11:46:39+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/d9b4c2e6aad904b46dda1779c46f3054ca6f903e

Merge pull request #140 from plone/139.bugfix

Fix flake8

Files changed:
A news/139.bugfix
M src/plone/recipe/zope2instance/recipe.py
M src/plone/recipe/zope2instance/tests/zope2instance.txt
M src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt

b'diff --git a/news/139.bugfix b/news/139.bugfix\nnew file mode 100644\nindex 0000000..6e39e64\n--- /dev/null\n+++ b/news/139.bugfix\n@@ -0,0 +1 @@\n+Fix flake8 [ale-rt]\ndiff --git a/src/plone/recipe/zope2instance/recipe.py b/src/plone/recipe/zope2instance/recipe.py\nindex 446b337..47774be 100644\n--- a/src/plone/recipe/zope2instance/recipe.py\n+++ b/src/plone/recipe/zope2instance/recipe.py\n@@ -296,7 +296,7 @@ def build_zope_conf(self):\n             chameleon_cache = \'CHAMELEON_CACHE {}\'.format(chameleon_cache)\n             if environment_vars and \'\\n\' in environment_vars:\n                 # default case\n-                environment_vars += \'\\n\'.format(chameleon_cache)\n+                environment_vars += \'\\n{}\'.format(chameleon_cache)\n             elif environment_vars:\n                 # handle case of all vars in one line\n                 environment_vars += \' {}\'.format(chameleon_cache)\n@@ -717,9 +717,9 @@ def is_rs_option(name):\n             enable_products=enable_products,\n             zope_conf_additional=zope_conf_additional,)\n \n-        zope_conf = \'\\n\'.join([l\n-                               for l in zope_conf.splitlines()\n-                               if l.rstrip()])\n+        zope_conf = "\\n".join(\n+            [line for line in zope_conf.splitlines() if line.rstrip()]\n+        )\n         zope_conf_path = os.path.join(location, \'etc\', \'zope.conf\')\n         with open(zope_conf_path, \'w\') as f:\n             f.write(zope_conf)\ndiff --git a/src/plone/recipe/zope2instance/tests/zope2instance.txt b/src/plone/recipe/zope2instance/tests/zope2instance.txt\nindex 891049c..bbcf308 100644\n--- a/src/plone/recipe/zope2instance/tests/zope2instance.txt\n+++ b/src/plone/recipe/zope2instance/tests/zope2instance.txt\n@@ -1445,8 +1445,11 @@ Our environment variables should be set now::\n     >>> zope_conf = zope_conf.replace(\'\\\\\', \'/\')\n     >>> import re\n     >>> env_vars = re.compile(r"<environment>\\n\\s*(?P<vars>.*)\\n</environment>", re.M | re.S)\n-    >>> re.search(env_vars, zope_conf).group(\'vars\')\n-    \'TZ US/Eastern\\nTMP /var/tmp\\nDISABLE_PTS True\'\n+    >>> print(re.search(env_vars, zope_conf).group(\'vars\'))\n+    TZ US/Eastern\n+    TMP /var/tmp\n+    DISABLE_PTS True\n+    CHAMELEON_CACHE .../var/cache\n \n Several all on one line::\n \ndiff --git a/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt b/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt\nindex 51921db..c12321b 100644\n--- a/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt\n+++ b/src/plone/recipe/zope2instance/tests/zope2instance_zserver.txt\n@@ -1737,8 +1737,10 @@ Our environment variables should be set now::\n     >>> zope_conf = zope_conf.replace(\'\\\\\', \'/\')\n     >>> import re\n     >>> env_vars = re.compile(r"<environment>\\n\\s*(?P<vars>.*)\\n</environment>", re.M | re.S)\n-    >>> re.search(env_vars, zope_conf).group(\'vars\')\n-    \'TZ US/Eastern\\nTMP /var/tmp\\nDISABLE_PTS True\'\n+    >>> print(re.search(env_vars, zope_conf).group(\'vars\'))\n+    TZ US/Eastern\n+    TMP /var/tmp\n+    DISABLE_PTS True\n \n Several all on one line::\n \n@@ -1770,8 +1772,10 @@ Our environment variables should be set now::\n     >>> instance = os.path.join(sample_buildout, \'parts\', \'instance\')\n     >>> zope_conf = open(os.path.join(instance, \'etc\', \'zope.conf\')).read()\n     >>> zope_conf = zope_conf.replace(\'\\\\\', \'/\')\n-    >>> re.search(env_vars, zope_conf).group(\'vars\')\n-    \'TZ US/Eastern\\nTMP /var/tmp\\nDISABLE_PTS True\'\n+    >>> print(re.search(env_vars, zope_conf).group(\'vars\'))\n+    TZ US/Eastern\n+    TMP /var/tmp\n+    DISABLE_PTS True\n \n \n HTTP server\n'

