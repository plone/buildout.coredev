Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2023-05-15T10:26:41+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/8e0e80173999cce9caa30274d4204639a371e390

cleanup: add a deprecation warning

Files changed:
M plone/app/z3cform/configure.zcml
M plone/app/z3cform/factories.py

b'diff --git a/plone/app/z3cform/configure.zcml b/plone/app/z3cform/configure.zcml\nindex e440117..771b289 100644\n--- a/plone/app/z3cform/configure.zcml\n+++ b/plone/app/z3cform/configure.zcml\n@@ -91,10 +91,4 @@\n            .interfaces.IPloneFormLayer"\n       />\n \n-  <utility\n-      factory=".factories.Zope2FileUploadStorable"\n-      provides="plone.namedfile.interfaces.IStorage"\n-      name="ZPublisher.HTTPRequest.FileUpload"\n-      />\n-\n </configure>\ndiff --git a/plone/app/z3cform/factories.py b/plone/app/z3cform/factories.py\nindex 85022a3..b2c5913 100644\n--- a/plone/app/z3cform/factories.py\n+++ b/plone/app/z3cform/factories.py\n@@ -1,14 +1,4 @@\n-from plone.namedfile.interfaces import IStorage\n-from plone.namedfile.storages import MAXCHUNKSIZE\n-from zope.interface import implementer\n+from zope.deprecation import moved\n \n \n-@implementer(IStorage)\n-class Zope2FileUploadStorable:\n-    def store(self, data, blob):\n-        data.seek(0)\n-        with blob.open("w") as fp:\n-            block = data.read(MAXCHUNKSIZE)\n-            while block:\n-                fp.write(block)\n-                block = data.read(MAXCHUNKSIZE)\n+moved("plone.namedfile.storages.Zope2FileUploadStorable", "Version 7.0")\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2023-05-15T10:30:19+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/354d2a02f18b5d5fa44b1d122028315ae7f7bced

Add news entry

Files changed:
A news/3764.feature

b'diff --git a/news/3764.feature b/news/3764.feature\nnew file mode 100644\nindex 00000000..3d4667af\n--- /dev/null\n+++ b/news/3764.feature\n@@ -0,0 +1,3 @@\n+Move storage utility to plone.namedfile\n+to break a dependency cycle between the two.\n+[gforcada]\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2023-05-20T13:36:34+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/344c96fba86cfd34cf9caf9ca017d187a8b698cf

Merge pull request #166 from plone/deprecate-storage

Deprecate storage

Files changed:
A news/3764.feature
M plone/app/z3cform/configure.zcml
M plone/app/z3cform/factories.py

b'diff --git a/news/3764.feature b/news/3764.feature\nnew file mode 100644\nindex 00000000..3d4667af\n--- /dev/null\n+++ b/news/3764.feature\n@@ -0,0 +1,3 @@\n+Move storage utility to plone.namedfile\n+to break a dependency cycle between the two.\n+[gforcada]\ndiff --git a/plone/app/z3cform/configure.zcml b/plone/app/z3cform/configure.zcml\nindex e4401171..771b2898 100644\n--- a/plone/app/z3cform/configure.zcml\n+++ b/plone/app/z3cform/configure.zcml\n@@ -91,10 +91,4 @@\n            .interfaces.IPloneFormLayer"\n       />\n \n-  <utility\n-      factory=".factories.Zope2FileUploadStorable"\n-      provides="plone.namedfile.interfaces.IStorage"\n-      name="ZPublisher.HTTPRequest.FileUpload"\n-      />\n-\n </configure>\ndiff --git a/plone/app/z3cform/factories.py b/plone/app/z3cform/factories.py\nindex 85022a30..b2c59138 100644\n--- a/plone/app/z3cform/factories.py\n+++ b/plone/app/z3cform/factories.py\n@@ -1,14 +1,4 @@\n-from plone.namedfile.interfaces import IStorage\n-from plone.namedfile.storages import MAXCHUNKSIZE\n-from zope.interface import implementer\n+from zope.deprecation import moved\n \n \n-@implementer(IStorage)\n-class Zope2FileUploadStorable:\n-    def store(self, data, blob):\n-        data.seek(0)\n-        with blob.open("w") as fp:\n-            block = data.read(MAXCHUNKSIZE)\n-            while block:\n-                fp.write(block)\n-                block = data.read(MAXCHUNKSIZE)\n+moved("plone.namedfile.storages.Zope2FileUploadStorable", "Version 7.0")\n'

