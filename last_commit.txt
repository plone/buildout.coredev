Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-02-15T11:08:25+01:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/786e4c9456d9184d552972f8343715df8d4efa0b

Add a couple of tests for reassurance, regarding sending (local) objects relative (no server part), are transformed into resolveuids

Files changed:
M src/plone/restapi/tests/test_blocks_deserializer.py

b'diff --git a/src/plone/restapi/tests/test_blocks_deserializer.py b/src/plone/restapi/tests/test_blocks_deserializer.py\nindex c18b8923e..b0ac5499f 100644\n--- a/src/plone/restapi/tests/test_blocks_deserializer.py\n+++ b/src/plone/restapi/tests/test_blocks_deserializer.py\n@@ -189,6 +189,22 @@ def test_blocks_image_href(self):\n             self.portal.doc1.blocks["123"]["url"], "http://example.com/1.jpg"\n         )\n \n+    def test_blocks_doc_relative(self):\n+        doc_uid = IUUID(self.portal.doc1)\n+        self.deserialize(blocks={"123": {"@type": "foo", "url": "/doc1"}})\n+\n+        self.assertEqual(\n+            self.portal.doc1.blocks["123"]["url"], "../resolveuid/{}".format(doc_uid)\n+        )\n+\n+    def test_blocks_image_relative(self):\n+        image_uid = IUUID(self.image)\n+        self.deserialize(blocks={"123": {"@type": "image", "url": "/image-1"}})\n+\n+        self.assertEqual(\n+            self.portal.doc1.blocks["123"]["url"], "../resolveuid/{}".format(image_uid)\n+        )\n+\n     def test_blocks_custom_block_resolve_standard_fields(self):\n         self.deserialize(\n             blocks={"123": {"@type": "foo", "url": self.portal.doc1.absolute_url()}}\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-02-15T11:10:53+01:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/e60b6056cbebf25d0547d60b81ecde19f8c89e52

Introduce zcml feature flag to mark it as p.restapi 7

Files changed:
M src/plone/restapi/configure.zcml

b'diff --git a/src/plone/restapi/configure.zcml b/src/plone/restapi/configure.zcml\nindex ae4a931da..b864f6648 100644\n--- a/src/plone/restapi/configure.zcml\n+++ b/src/plone/restapi/configure.zcml\n@@ -5,10 +5,13 @@\n     xmlns:plone="http://namespaces.plone.org/plone"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n+    xmlns:meta="http://namespaces.zope.org/meta"\n     i18n_domain="plone.restapi">\n \n   <i18n:registerTranslations directory="locales" />\n \n+  <meta:provides feature="plonerestapi7" />\n+\n   <include package="plone.behavior" file="meta.zcml"/>\n   <include package="plone.rest" file="meta.zcml"/>\n \n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-02-15T11:12:52+01:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/e109fd1467902b76f48b259d6bfa000befde530a

Add changelog

Files changed:
A news/1068.feature

b'diff --git a/news/1068.feature b/news/1068.feature\nnew file mode 100644\nindex 000000000..1622ae7af\n--- /dev/null\n+++ b/news/1068.feature\n@@ -0,0 +1,4 @@\n+- Mark restapi 7 with a zcml feature flag\n+  [sneridagh]\n+- Add a couple of additional tests for resolveuid feature reassurance\n+  [sneridagh]\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-02-15T13:20:21+01:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/939854407e0ea8cfbfb5cc7e9c00019f9816f50a

Rename the feature

Files changed:
M src/plone/restapi/configure.zcml

b'diff --git a/src/plone/restapi/configure.zcml b/src/plone/restapi/configure.zcml\nindex b864f6648..5fdbc35e2 100644\n--- a/src/plone/restapi/configure.zcml\n+++ b/src/plone/restapi/configure.zcml\n@@ -10,7 +10,7 @@\n \n   <i18n:registerTranslations directory="locales" />\n \n-  <meta:provides feature="plonerestapi7" />\n+  <meta:provides feature="plonerestapi-7" />\n \n   <include package="plone.behavior" file="meta.zcml"/>\n   <include package="plone.rest" file="meta.zcml"/>\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-02-15T17:23:16+01:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/590a478fc2e23eb4beec84be3a8408350b0748e1

Split towncrier in two

Files changed:
A news/1072.feature
M news/1068.feature

b'diff --git a/news/1068.feature b/news/1068.feature\nindex 1622ae7af..6c35aa2fb 100644\n--- a/news/1068.feature\n+++ b/news/1068.feature\n@@ -1,4 +1,2 @@\n-- Mark restapi 7 with a zcml feature flag\n-  [sneridagh]\n-- Add a couple of additional tests for resolveuid feature reassurance\n-  [sneridagh]\n+Mark restapi 7 with a zcml feature flag: ``plonerestapi-7``\n+[sneridagh]\ndiff --git a/news/1072.feature b/news/1072.feature\nnew file mode 100644\nindex 000000000..abe635f22\n--- /dev/null\n+++ b/news/1072.feature\n@@ -0,0 +1,2 @@\n+Add a couple of additional tests for resolveuid feature reassurance\n+[sneridagh]\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-02-15T18:16:48+01:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/c42dbcab9b39aca2eec32c80bc206fc265386834

Provide the feature in its own meta.zcml

Files changed:
A src/plone/restapi/meta.zcml
M src/plone/restapi/configure.zcml

b'diff --git a/src/plone/restapi/configure.zcml b/src/plone/restapi/configure.zcml\nindex 5fdbc35e2..ae4a931da 100644\n--- a/src/plone/restapi/configure.zcml\n+++ b/src/plone/restapi/configure.zcml\n@@ -5,13 +5,10 @@\n     xmlns:plone="http://namespaces.plone.org/plone"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    xmlns:meta="http://namespaces.zope.org/meta"\n     i18n_domain="plone.restapi">\n \n   <i18n:registerTranslations directory="locales" />\n \n-  <meta:provides feature="plonerestapi-7" />\n-\n   <include package="plone.behavior" file="meta.zcml"/>\n   <include package="plone.rest" file="meta.zcml"/>\n \ndiff --git a/src/plone/restapi/meta.zcml b/src/plone/restapi/meta.zcml\nnew file mode 100644\nindex 000000000..580228c85\n--- /dev/null\n+++ b/src/plone/restapi/meta.zcml\n@@ -0,0 +1,8 @@\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:meta="http://namespaces.zope.org/meta"\n+    i18n_domain="plone.restapi">\n+\n+  <meta:provides feature="plonerestapi-7" />\n+\n+</configure>\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-02-16T07:46:08+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.restapi/commit/5d766219e4d6e32195432ae799b9b8188daee475

Merge pull request #1069 from plone/moreresolveuidtestsandconfig

Mark restapi 7 with a zcml feature flag

Files changed:
A news/1068.feature
A news/1072.feature
A src/plone/restapi/meta.zcml
M src/plone/restapi/tests/test_blocks_deserializer.py

b'diff --git a/news/1068.feature b/news/1068.feature\nnew file mode 100644\nindex 000000000..6c35aa2fb\n--- /dev/null\n+++ b/news/1068.feature\n@@ -0,0 +1,2 @@\n+Mark restapi 7 with a zcml feature flag: ``plonerestapi-7``\n+[sneridagh]\ndiff --git a/news/1072.feature b/news/1072.feature\nnew file mode 100644\nindex 000000000..abe635f22\n--- /dev/null\n+++ b/news/1072.feature\n@@ -0,0 +1,2 @@\n+Add a couple of additional tests for resolveuid feature reassurance\n+[sneridagh]\ndiff --git a/src/plone/restapi/meta.zcml b/src/plone/restapi/meta.zcml\nnew file mode 100644\nindex 000000000..580228c85\n--- /dev/null\n+++ b/src/plone/restapi/meta.zcml\n@@ -0,0 +1,8 @@\n+<configure\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:meta="http://namespaces.zope.org/meta"\n+    i18n_domain="plone.restapi">\n+\n+  <meta:provides feature="plonerestapi-7" />\n+\n+</configure>\ndiff --git a/src/plone/restapi/tests/test_blocks_deserializer.py b/src/plone/restapi/tests/test_blocks_deserializer.py\nindex c18b8923e..b0ac5499f 100644\n--- a/src/plone/restapi/tests/test_blocks_deserializer.py\n+++ b/src/plone/restapi/tests/test_blocks_deserializer.py\n@@ -189,6 +189,22 @@ def test_blocks_image_href(self):\n             self.portal.doc1.blocks["123"]["url"], "http://example.com/1.jpg"\n         )\n \n+    def test_blocks_doc_relative(self):\n+        doc_uid = IUUID(self.portal.doc1)\n+        self.deserialize(blocks={"123": {"@type": "foo", "url": "/doc1"}})\n+\n+        self.assertEqual(\n+            self.portal.doc1.blocks["123"]["url"], "../resolveuid/{}".format(doc_uid)\n+        )\n+\n+    def test_blocks_image_relative(self):\n+        image_uid = IUUID(self.image)\n+        self.deserialize(blocks={"123": {"@type": "image", "url": "/image-1"}})\n+\n+        self.assertEqual(\n+            self.portal.doc1.blocks["123"]["url"], "../resolveuid/{}".format(image_uid)\n+        )\n+\n     def test_blocks_custom_block_resolve_standard_fields(self):\n         self.deserialize(\n             blocks={"123": {"@type": "foo", "url": self.portal.doc1.absolute_url()}}\n'

