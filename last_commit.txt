Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-20T10:30:03+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/aaecceba9e2ac60588f919185c16fea5e4ef1270

Only check once if ATCT is available

Otherwise the call to check if the distribution is available is done on every single call to ``getOAI``, which can be potentially hundreds of times per request. 

Fixes https://github.com/plone/Products.CMFPlone/issues/2765

Files changed:
M Products/CMFPlone/PloneBaseTool.py

b"diff --git a/Products/CMFPlone/PloneBaseTool.py b/Products/CMFPlone/PloneBaseTool.py\nindex 84b1823ef1..514c632709 100644\n--- a/Products/CMFPlone/PloneBaseTool.py\n+++ b/Products/CMFPlone/PloneBaseTool.py\n@@ -29,7 +29,7 @@ def initializeTFC():\n         try:\n             pkg_resources.get_distribution('Products.ATContentTypes')\n         except pkg_resources.DistributionNotFound:\n-            pass\n+            TempFolderClass = False\n         else:\n             from Products.ATContentTypes.tool.factory import TempFolder\n             TempFolderClass = TempFolder\n"

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-20T10:30:57+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/faab3bb875f4244354ab6cadbe88685b401d0626

Add news entry

Files changed:
A news/2765.bugfix

b'diff --git a/news/2765.bugfix b/news/2765.bugfix\nnew file mode 100644\nindex 0000000000..614f3c7adb\n--- /dev/null\n+++ b/news/2765.bugfix\n@@ -0,0 +1,2 @@\n+Check only once if Products.ATContentTypes is available.\n+[gforcada]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2019-02-20T16:20:49+01:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/a2ce0c7c3bd71be05a112e27680041481ab82f41

Merge pull request #2766 from plone/gforcada-patch-1

Only check once if ATCT is available

Files changed:
A news/2765.bugfix
M Products/CMFPlone/PloneBaseTool.py

b"diff --git a/Products/CMFPlone/PloneBaseTool.py b/Products/CMFPlone/PloneBaseTool.py\nindex 84b1823ef1..514c632709 100644\n--- a/Products/CMFPlone/PloneBaseTool.py\n+++ b/Products/CMFPlone/PloneBaseTool.py\n@@ -29,7 +29,7 @@ def initializeTFC():\n         try:\n             pkg_resources.get_distribution('Products.ATContentTypes')\n         except pkg_resources.DistributionNotFound:\n-            pass\n+            TempFolderClass = False\n         else:\n             from Products.ATContentTypes.tool.factory import TempFolder\n             TempFolderClass = TempFolder\ndiff --git a/news/2765.bugfix b/news/2765.bugfix\nnew file mode 100644\nindex 0000000000..614f3c7adb\n--- /dev/null\n+++ b/news/2765.bugfix\n@@ -0,0 +1,2 @@\n+Check only once if Products.ATContentTypes is available.\n+[gforcada]\n"

