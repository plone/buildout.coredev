Repository: plone.outputfilters


Branch: refs/heads/master
Date: 2020-08-13T16:46:24-04:00
Author: Flip McFadden (flipmcf) <flipmcf@gmail.com>
Commit: https://github.com/plone/plone.outputfilters/commit/b95200ab038f3c89c021a3eb1a2d35e623aa15b9

Check for -a- tag in captioned image.

before unwrapping, see if there is something to unwrap.

Files changed:
M plone/outputfilters/filters/resolveuid_and_caption.py

b"diff --git a/plone/outputfilters/filters/resolveuid_and_caption.py b/plone/outputfilters/filters/resolveuid_and_caption.py\nindex 957c12f..aaaaf14 100644\n--- a/plone/outputfilters/filters/resolveuid_and_caption.py\n+++ b/plone/outputfilters/filters/resolveuid_and_caption.py\n@@ -347,7 +347,8 @@ def handle_captioned_image(self, attributes, image, fullimage,\n \n         # if we are a captioned image within a link, remove and occurrences\n         # of a tags inside caption template to preserve the outer link\n-        if bool(elem.find_parent('a')):\n+        if bool(elem.find_parent('a')) and \\\n+           bool(captioned.find('a')):\n             captioned.a.unwrap()\n \n         elem.replace_with(captioned)\n"

Repository: plone.outputfilters


Branch: refs/heads/master
Date: 2020-08-13T16:58:24-04:00
Author: Flip McFadden (flipmcf) <flipmcf@gmail.com>
Commit: https://github.com/plone/plone.outputfilters/commit/7bd5506243a4a906b284d959880635a349daa041

Create 39.bugfix

Files changed:
A news/39.bugfix

b"diff --git a/news/39.bugfix b/news/39.bugfix\nnew file mode 100644\nindex 0000000..e47e1d5\n--- /dev/null\n+++ b/news/39.bugfix\n@@ -0,0 +1 @@\n+fix AttributeError: 'NoneType' object has no attribute 'unwrap' exception when a fullsize image is wrapped in an <a> tag. [flipmcf]\n"

Repository: plone.outputfilters


Branch: refs/heads/master
Date: 2020-08-19T11:21:32+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.outputfilters/commit/fa0d89d68846ea5af0243204d38446f831907570

Merge pull request #41 from flipmcf/issue-39

Check for -a- tag in captioned image.

Files changed:
A news/39.bugfix
M plone/outputfilters/filters/resolveuid_and_caption.py

b"diff --git a/news/39.bugfix b/news/39.bugfix\nnew file mode 100644\nindex 0000000..e47e1d5\n--- /dev/null\n+++ b/news/39.bugfix\n@@ -0,0 +1 @@\n+fix AttributeError: 'NoneType' object has no attribute 'unwrap' exception when a fullsize image is wrapped in an <a> tag. [flipmcf]\ndiff --git a/plone/outputfilters/filters/resolveuid_and_caption.py b/plone/outputfilters/filters/resolveuid_and_caption.py\nindex 957c12f..aaaaf14 100644\n--- a/plone/outputfilters/filters/resolveuid_and_caption.py\n+++ b/plone/outputfilters/filters/resolveuid_and_caption.py\n@@ -347,7 +347,8 @@ def handle_captioned_image(self, attributes, image, fullimage,\n \n         # if we are a captioned image within a link, remove and occurrences\n         # of a tags inside caption template to preserve the outer link\n-        if bool(elem.find_parent('a')):\n+        if bool(elem.find_parent('a')) and \\\n+           bool(captioned.find('a')):\n             captioned.a.unwrap()\n \n         elem.replace_with(captioned)\n"

