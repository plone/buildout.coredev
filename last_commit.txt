Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2021-02-13T09:50:39+01:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/plone.portlet.collection/commit/5e2d8b84c1e2279bfeef2dc76c89aa6d39403743

Barceloneta LTS (#27)

* update markup for bootstrap

* bootstrap b1 changes

* update markup in doctest

* change item details

Co-authored-by: Peter Holzer &lt;peter.holzer@agitator.com&gt;

Files changed:
M plone/portlet/collection/collection.pt
M plone/portlet/collection/tests/functional.txt

b'diff --git a/plone/portlet/collection/collection.pt b/plone/portlet/collection/collection.pt\nindex 435f879..3f38ff4 100644\n--- a/plone/portlet/collection/collection.pt\n+++ b/plone/portlet/collection/collection.pt\n@@ -1,71 +1,71 @@\n-<section class="portlet portletCollection"\n-    i18n:domain="plone"\n-    tal:define="collection_url view/collection_url;\n-                plone_view context/@@plone;\n-                toLocalizedTime nocall:plone_view/toLocalizedTime;\n-                viewActions python:context.portal_registry.get(\'plone.types_use_view_action_in_listings\', []);"\n-    tal:attributes="class string:portlet portletCollection ${view/css_class}"><header class="portletHeader">\n-        <span class="portletTopLeft"></span>\n-        <a tal:attributes="href collection_url" tal:omit-tag="not:view/data/show_more">\n-            <span tal:content="view/data/header" />\n-        </a>\n-        <span class="portletTopRight"></span>\n-  </header>\n+<html xmlns="http://www.w3.org/1999/xhtml"\n+      xmlns:tal="http://xml.zope.org/namespaces/tal"\n+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+      tal:omit-tag="">\n \n+  <div class="card portlet portletCollection"\n+      i18n:domain="plone"\n+      tal:define="collection_url view/collection_url;\n+                  plone_view context/@@plone;\n+                  toLocalizedTime nocall:plone_view/toLocalizedTime;\n+                  viewActions python:context.portal_registry.get(\'plone.types_use_view_action_in_listings\', []);"\n+      tal:attributes="class string:card portlet portletCollection ${view/css_class}">\n \n-  <ul class="portletContent">\n-    <tal:events tal:repeat="obj view/results">\n-    <li class="portletItem"\n-        tal:define="plone_layout context/@@plone_layout;\n-                    portal context/@@plone_portal_state/portal;\n-                    image_scale portal/@@image_scale;\n-                    plone_view context/@@plone;\n-                    oddrow repeat/obj/odd;\n-                    useView python:obj.portal_type in viewActions;\n-                    itemUrl python:useView and obj.getURL() + \'/view\' or obj.getURL();\n-                    item_wf_state obj/review_state;\n-                    item_wf_state_class python:\'state-\' + plone_view.normalizeString(item_wf_state);\n-                    item_type obj/portal_type;\n-                    supress_icon    view/data/no_icons;\n-                    supress_thumb   view/data/no_thumbs;\n-                    thumb_scale view/thumb_scale;\n-                    item_type_class python:(\'contenttype-\' + plone_view.normalizeString(item_type)) if not supress_icon else \'\'"\n-        tal:attributes="class python:oddrow and \'portletItem even\' or \'portletItem odd\'">\n-        <a href="#"\n-           tal:attributes="href itemUrl;\n-                           class  string:tile $item_type_class $item_wf_state_class;\n-                           title obj/Description">\n-            <img class="mime-icon" tal:condition="python:item_type ==\'File\' and not supress_icon"\n-                 tal:attributes="href obj/getURL;\n-                                 src python:view.getMimeTypeIcon(obj);"> \n+    <div class="card-header">\n+      <a tal:attributes="href collection_url" tal:omit-tag="not:view/data/show_more">\n+        <span tal:content="view/data/header" />\n+      </a>\n+    </div>\n \n+    <div class="card-body">\n+      <ul>\n+        <tal:events tal:repeat="obj view/results">\n+        <li class="portletItem"\n+            tal:define="plone_layout context/@@plone_layout;\n+                        portal context/@@plone_portal_state/portal;\n+                        image_scale portal/@@image_scale;\n+                        plone_view context/@@plone;\n+                        oddrow repeat/obj/odd;\n+                        useView python:obj.portal_type in viewActions;\n+                        itemUrl python:useView and obj.getURL() + \'/view\' or obj.getURL();\n+                        item_wf_state obj/review_state;\n+                        item_wf_state_class python:\'state-\' + plone_view.normalizeString(item_wf_state);\n+                        item_type obj/portal_type;\n+                        supress_icon    view/data/no_icons;\n+                        supress_thumb   view/data/no_thumbs;\n+                        thumb_scale view/thumb_scale;\n+                        item_type_class python:(\'contenttype-\' + plone_view.normalizeString(item_type)) if not supress_icon else \'\'"\n+            tal:attributes="class python:oddrow and \'portletItem even\' or \'portletItem odd\'">\n+          <a href="#"\n+              tal:attributes="href itemUrl;\n+                              class  string:tile $item_type_class $item_wf_state_class;\n+                              title obj/Description">\n+            <img class="mime-icon" tal:condition="python:item_type ==\'File\' and not supress_icon"\n+                tal:attributes="href obj/getURL;\n+                                src python:view.getMimeTypeIcon(obj);">\n             <img tal:condition="python: obj.getIcon and thumb_scale and not supress_thumb"\n-                 tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'pull-right thumb-\'+thumb_scale)" />\n+                tal:replace="structure python:image_scale.tag(obj, \'image\', scale=thumb_scale, css_class=\'float-end thumb-\'+thumb_scale)" />\n+\n+            <span tal:replace="obj/Title">Title</span>\n+          </a>\n+          <div class="portletItemDetails"\n+               tal:condition="view/data/show_dates"\n+               tal:define="obj_date python:obj.start and obj.start or obj.Date();"\n+               tal:content="python:toLocalizedTime(obj_date)">May 5</div>\n+        </li>\n+        </tal:events>\n+      </ul>\n+    </div>\n \n-            <span tal:replace="obj/Title">\n-             Title </span>\n-            <span class="portletItemDetails"\n-                  tal:condition="view/data/show_dates"\n-                  tal:define="obj_date python:obj.start and obj.start or obj.Date();"\n-                  tal:content="python:toLocalizedTime(obj_date)">\n-                Date\n-            </span>\n-        </a>\n-    </li>\n-    </tal:events>\n-  </ul>\n+    <div class="card-footer"\n+        tal:condition="python:showMore or view.include_empty_footer()"\n+        tal:define="showMore view/data/show_more">\n+      <a tal:condition="showMore" tal:attributes="href collection_url">\n+        <span class="hiddenStructure"><span tal:replace="view/data/header" /> - </span>\n+        <span i18n:translate="more_url">More&hellip;</span>\n+      </a>\n+    </div>\n \n-    <footer class="portletFooter"\n-            tal:condition="python:showMore or view.include_empty_footer()"\n-            tal:define="showMore view/data/show_more">\n-        <span class="portletBottomLeft"></span>\n-        <span tal:condition="showMore">\n-        <a tal:attributes="href collection_url">\n-           <span class="hiddenStructure"><span tal:replace="view/data/header" /> - </span>\n-           <span i18n:translate="more_url">More&hellip;</span>\n-        </a>\n-        </span>\n-        <span class="portletBottomRight"></span>\n-  </footer>\n+  </div>\n \n-</section>\n+</html>\n\\ No newline at end of file\ndiff --git a/plone/portlet/collection/tests/functional.txt b/plone/portlet/collection/tests/functional.txt\nindex cc2b775..8169497 100644\n--- a/plone/portlet/collection/tests/functional.txt\n+++ b/plone/portlet/collection/tests/functional.txt\n@@ -83,31 +83,28 @@ Go to the home page and see if the portlet looks OK.\n     ...     lines = [line.strip() for line in contents.splitlines() if line.strip()]\n     ...     return \'\\n\'.join(lines)\n     >>> print(strip_white_space(portlet_contents))\n-    <section class="portlet portletCollection portlet-collection-test-collection"><header class="portletHeader">\n-    <span class="portletTopLeft"...\n+    <div class="card portlet portletCollection portlet-collection-test-collection">\n+    <div class="card-header">\n     <a href="http://nohost/plone/test-collection">\n     <span>Test Collection</span>\n     </a>\n-    <span class="portletTopRight"...\n-    </header>\n-    <ul class="portletContent">\n+    </div>\n+    <div class="card-body">\n+    <ul>\n     <li class="portletItem odd">\n     <a href="http://nohost/plone/test-document" class="tile contenttype-document state-private" title="">\n     Test Document\n     </a>\n     </li>\n     </ul>\n-    <footer class="portletFooter">\n-    <span class="portletBottomLeft"...\n-    <span>\n+    </div>\n+    <div class="card-footer">\n     <a href="http://nohost/plone/test-collection">\n     <span class="hiddenStructure">Test Collection - </span>\n-    <span>More...\n+    <span>More&#8230;</span>\n     </a>\n-    </span>\n-    <span class="portletBottomRight"...\n-    </footer>\n-    </section>\n+    </div>\n+    </div>\n \n Now test what happens if we toggle the "show more link" option.\n \n@@ -143,10 +140,10 @@ Now test what happens if we toggle the "show dates" option.\n Make sure the dates show up::\n \n     >>> browser.open(portal_url)\n-    >>> \'<span class="portletItemDetails">\' in browser.contents\n+    >>> \'<div class="portletItemDetails"\' in browser.contents\n     True\n \n     >>> from DateTime import DateTime\n     >>> cur_year = DateTime().year()\n-    >>> re.search(r\'<span class="portletItemDetails">.*{}.*</span>\'.format(cur_year), browser.contents) is not None\n+    >>> re.search(r\'<div class="portletItemDetails".*{}.*</div>\'.format(cur_year), browser.contents) is not None\n     True\n'

