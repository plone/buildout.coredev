Repository: plone.app.theming


Branch: refs/heads/master
Date: 2020-08-25T01:01:22+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.theming/commit/1126941b1e9d8422f79170e5855f1ec8328a41b2

Fixed deprecation warning for ConfigParser.readfp.

```
DeprecationWarning: This method will be removed in future versions.
Use 'parser.read_file()' instead.
```

The standard ConfigParser on Python 2 does not have the read_file method,
but we have backports.configparser, which *does* have it.
Use the new one when available.

Files changed:
A news/3130.bugfix
M src/plone/app/theming/plugins/utils.py
M src/plone/app/theming/utils.py

b'diff --git a/news/3130.bugfix b/news/3130.bugfix\nnew file mode 100644\nindex 0000000..84994fb\n--- /dev/null\n+++ b/news/3130.bugfix\n@@ -0,0 +1,2 @@\n+Fixed deprecation warning for ConfigParser.readfp.\n+[maurits]\ndiff --git a/src/plone/app/theming/plugins/utils.py b/src/plone/app/theming/plugins/utils.py\nindex a7e0ddd..2fa3d26 100644\n--- a/src/plone/app/theming/plugins/utils.py\n+++ b/src/plone/app/theming/plugins/utils.py\n@@ -87,7 +87,11 @@ def getPluginSettings(themeDirectory, plugins=None):\n         fp = themeDirectory.openFile(MANIFEST_FILENAME)\n         try:\n             if six.PY2:\n-                parser.readfp(fp)\n+                if hasattr(parser, "read_file"):\n+                    # backports.configparser\n+                    parser.read_file(fp)\n+                else:\n+                    parser.readfp(fp)\n             else:\n                 parser.read_string(fp.read().decode())\n             for section in parser.sections():\ndiff --git a/src/plone/app/theming/utils.py b/src/plone/app/theming/utils.py\nindex dfbe572..ed6b734 100644\n--- a/src/plone/app/theming/utils.py\n+++ b/src/plone/app/theming/utils.py\n@@ -546,7 +546,11 @@ def createThemeFromTemplate(title, description, baseOn=\'template\'):\n         if six.PY2:\n             fp = target.openFile(MANIFEST_FILENAME)\n             try:\n-                manifest.readfp(fp)\n+                if hasattr(manifest, "read_file"):\n+                    # backports.configparser\n+                    manifest.read_file(fp)\n+                else:\n+                    manifest.readfp(fp)\n             finally:\n                 fp.close()\n \n'

Repository: plone.app.theming


Branch: refs/heads/master
Date: 2020-08-25T09:21:32+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.theming/commit/9656803c960575c6d86e1399cc150ce0f11611bf

Merge pull request #191 from plone/maurits/fix-warnings

Fixed deprecation warning for ConfigParser.readfp.

Files changed:
A news/3130.bugfix
M src/plone/app/theming/plugins/utils.py
M src/plone/app/theming/utils.py

b'diff --git a/news/3130.bugfix b/news/3130.bugfix\nnew file mode 100644\nindex 0000000..84994fb\n--- /dev/null\n+++ b/news/3130.bugfix\n@@ -0,0 +1,2 @@\n+Fixed deprecation warning for ConfigParser.readfp.\n+[maurits]\ndiff --git a/src/plone/app/theming/plugins/utils.py b/src/plone/app/theming/plugins/utils.py\nindex a7e0ddd..2fa3d26 100644\n--- a/src/plone/app/theming/plugins/utils.py\n+++ b/src/plone/app/theming/plugins/utils.py\n@@ -87,7 +87,11 @@ def getPluginSettings(themeDirectory, plugins=None):\n         fp = themeDirectory.openFile(MANIFEST_FILENAME)\n         try:\n             if six.PY2:\n-                parser.readfp(fp)\n+                if hasattr(parser, "read_file"):\n+                    # backports.configparser\n+                    parser.read_file(fp)\n+                else:\n+                    parser.readfp(fp)\n             else:\n                 parser.read_string(fp.read().decode())\n             for section in parser.sections():\ndiff --git a/src/plone/app/theming/utils.py b/src/plone/app/theming/utils.py\nindex dfbe572..ed6b734 100644\n--- a/src/plone/app/theming/utils.py\n+++ b/src/plone/app/theming/utils.py\n@@ -546,7 +546,11 @@ def createThemeFromTemplate(title, description, baseOn=\'template\'):\n         if six.PY2:\n             fp = target.openFile(MANIFEST_FILENAME)\n             try:\n-                manifest.readfp(fp)\n+                if hasattr(manifest, "read_file"):\n+                    # backports.configparser\n+                    manifest.read_file(fp)\n+                else:\n+                    manifest.readfp(fp)\n             finally:\n                 fp.close()\n \n'

