Repository: plone.restapi


Branch: refs/heads/main
Date: 2024-03-02T18:10:00-08:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.restapi/commit/3709074036380fb86ec33ec7d20251808a9732aa

add available languages information to the @site endpoint (#1738)

* add available languages information to the @site endpoint

* add changelog

* add docs

---------

Co-authored-by: Timo Stollenwerk &lt;tisto@users.noreply.github.com&gt;
Co-authored-by: David Glick &lt;david@glicksoftware.com&gt;

Files changed:
A news/1738.feature
M src/plone/restapi/services/site/get.py
M src/plone/restapi/tests/http-examples/site_get.resp
M src/plone/restapi/tests/test_services_site.py

b'diff --git a/news/1738.feature b/news/1738.feature\nnew file mode 100644\nindex 000000000..9a22a5328\n--- /dev/null\n+++ b/news/1738.feature\n@@ -0,0 +1,2 @@\n+Add available languages information to the @site endpoint\n+[erral]\ndiff --git a/src/plone/restapi/services/site/get.py b/src/plone/restapi/services/site/get.py\nindex 6c029c567..43840a8b8 100644\n--- a/src/plone/restapi/services/site/get.py\n+++ b/src/plone/restapi/services/site/get.py\n@@ -3,6 +3,7 @@\n from plone.app.event.base import replacement_zones\n from plone.event.utils import default_timezone as fallback_default_timezone\n from plone.event.utils import validated_timezone\n+from plone.i18n.interfaces import ILanguageSchema\n from plone.registry.interfaces import IRegistry\n from plone.restapi.interfaces import IExpandableElement\n from plone.restapi.services import Service\n@@ -36,12 +37,17 @@ def __call__(self, expand=False):\n         image_settings = registry.forInterface(\n             IImagingSchema, prefix="plone", check=False\n         )\n+        language_settings = registry.forInterface(\n+            ILanguageSchema, prefix="plone", check=False\n+        )\n         result["site"].update(\n             {\n                 "plone.site_title": portal_state.portal_title(),\n                 "plone.site_logo": site_settings.site_logo and getSiteLogo() or None,\n                 "plone.robots_txt": site_settings.robots_txt,\n                 "plone.allowed_sizes": image_settings.allowed_sizes,\n+                "plone.default_language": language_settings.default_language,\n+                "plone.available_languages": language_settings.available_languages,\n                 "plone.portal_timezone": self.plone_timezone(),\n             }\n         )\ndiff --git a/src/plone/restapi/tests/http-examples/site_get.resp b/src/plone/restapi/tests/http-examples/site_get.resp\nindex 427a10eaa..28a4c1167 100644\n--- a/src/plone/restapi/tests/http-examples/site_get.resp\n+++ b/src/plone/restapi/tests/http-examples/site_get.resp\n@@ -16,6 +16,13 @@ Content-Type: application/json\n         "icon 32:32",\n         "listing 16:16"\n     ],\n+    "plone.available_languages": [\n+        "en",\n+        "de",\n+        "es",\n+        "fr"\n+    ],\n+    "plone.default_language": "en",\n     "plone.portal_timezone": "UTC",\n     "plone.robots_txt": "Sitemap: {portal_url}/sitemap.xml.gz\\n\\n# Define access-restrictions for robots/spiders\\n# http://www.robotstxt.org/wc/norobots.html\\n\\n\\n\\n# By default we allow robots to access all areas of our site\\n# already accessible to anonymous users\\n\\nUser-agent: *\\nDisallow:\\n\\n\\n\\n# Add Googlebot-specific syntax extension to exclude forms\\n# that are repeated for each piece of content in the site\\n# the wildcard is only supported by Googlebot\\n# http://www.google.com/support/webmasters/bin/answer.py?answer=40367&ctx=sibling\\n\\nUser-Agent: Googlebot\\nDisallow: /*?\\nDisallow: /*atct_album_view$\\nDisallow: /*folder_factories$\\nDisallow: /*folder_summary_view$\\nDisallow: /*login_form$\\nDisallow: /*mail_password_form$\\nDisallow: /@@search\\nDisallow: /*search_rss$\\nDisallow: /*sendto_form$\\nDisallow: /*summary_view$\\nDisallow: /*thumbnail_view$\\nDisallow: /*view$\\n",\n     "plone.site_logo": null,\ndiff --git a/src/plone/restapi/tests/test_services_site.py b/src/plone/restapi/tests/test_services_site.py\nindex dfeeaa2bc..37d764088 100644\n--- a/src/plone/restapi/tests/test_services_site.py\n+++ b/src/plone/restapi/tests/test_services_site.py\n@@ -9,7 +9,6 @@\n \n \n class TestServicesSite(unittest.TestCase):\n-\n     layer = PLONE_RESTAPI_DX_FUNCTIONAL_TESTING\n \n     def setUp(self):\n@@ -36,4 +35,6 @@ def test_get_site(self):\n         self.assertIn("plone.site_logo", response.json())\n         self.assertIn("plone.robots_txt", response.json())\n         self.assertIn("plone.allowed_sizes", response.json())\n+        self.assertIn("plone.available_languages", response.json())\n+        self.assertIn("plone.default_language", response.json())\n         self.assertEqual(response.json()["plone.portal_timezone"], "UTC")\n'

