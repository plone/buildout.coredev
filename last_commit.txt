Repository: plone.api


Branch: refs/heads/master
Date: 2024-04-29T13:48:10-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.api/commit/063f1630e746726d033fa996fae16bf8913954b5

In relation.create, handle existing value of None

Files changed:
M src/plone/api/relation.py

b'diff --git a/src/plone/api/relation.py b/src/plone/api/relation.py\nindex bf39a8aa..1b0bda97 100644\n--- a/src/plone/api/relation.py\n+++ b/src/plone/api/relation.py\n@@ -217,7 +217,7 @@ def create(source=None, target=None, relationship=None):\n             target.absolute_url(),\n         )\n         if not has_relation:\n-            existing_relations = getattr(source, from_attribute, [])\n+            existing_relations = getattr(source, from_attribute, None) or []\n             existing_relations.append(RelationValue(to_id))\n             setattr(source, from_attribute, existing_relations)\n             modified(source)\n'

Repository: plone.api


Branch: refs/heads/master
Date: 2024-04-29T13:49:09-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.api/commit/5677a0cbade9f25853f41e524ea7603c0eac1cdc

changelog

Files changed:
A news/535.bugfix

b'diff --git a/news/535.bugfix b/news/535.bugfix\nnew file mode 100644\nindex 00000000..ff9053e2\n--- /dev/null\n+++ b/news/535.bugfix\n@@ -0,0 +1 @@\n+In relation.create: Fix edge case where existing RelationList value is None. @davisagli\n'

Repository: plone.api


Branch: refs/heads/master
Date: 2024-04-30T07:40:25-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.api/commit/7dc89978db5a894a8474c64e29f24fbdfc78e339

Merge pull request #535 from plone/fix-create-relation-none

In relation.create, handle existing value of None

Files changed:
A news/535.bugfix
M src/plone/api/relation.py

b'diff --git a/news/535.bugfix b/news/535.bugfix\nnew file mode 100644\nindex 00000000..ff9053e2\n--- /dev/null\n+++ b/news/535.bugfix\n@@ -0,0 +1 @@\n+In relation.create: Fix edge case where existing RelationList value is None. @davisagli\ndiff --git a/src/plone/api/relation.py b/src/plone/api/relation.py\nindex bf39a8aa..1b0bda97 100644\n--- a/src/plone/api/relation.py\n+++ b/src/plone/api/relation.py\n@@ -217,7 +217,7 @@ def create(source=None, target=None, relationship=None):\n             target.absolute_url(),\n         )\n         if not has_relation:\n-            existing_relations = getattr(source, from_attribute, [])\n+            existing_relations = getattr(source, from_attribute, None) or []\n             existing_relations.append(RelationValue(to_id))\n             setattr(source, from_attribute, existing_relations)\n             modified(source)\n'

