Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2023-07-04T15:32:00+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.z3cform/commit/2c85c7cf204fa291e3d64b67c4f862b1bed6e40c

Pre select the saved values to fix browser validation of required input

Files changed:
M plone/app/z3cform/templates/orderedselect_input.pt

b'diff --git a/plone/app/z3cform/templates/orderedselect_input.pt b/plone/app/z3cform/templates/orderedselect_input.pt\nindex ccf2a37..e70df4b 100644\n--- a/plone/app/z3cform/templates/orderedselect_input.pt\n+++ b/plone/app/z3cform/templates/orderedselect_input.pt\n@@ -7,43 +7,34 @@\n           type="text/javascript"\n   ></script>\n \n-  <table class="ordered-selection-field"\n+  <table class="ordered-selection-field table table-borderless"\n          border="0"\n-         tal:attributes="\n-           id view/id;\n-         "\n-  >\n+         id="${view/id}">\n     <tr>\n       <td>\n-        <select class=""\n-                id="from"\n-                name="from"\n-                size="5"\n-                tal:attributes="\n-                  id string:${view/id}-from;\n-                  name string:${view/name}.from;\n-                  class string:form-control ${view/klass};\n-                  style view/style;\n-                  title view/title;\n-                  lang view/lang;\n-                  onclick view/onclick;\n-                  ondblclick view/ondblclick;\n-                  onmousedown view/onmousedown;\n-                  onmouseup view/onmouseup;\n-                  onmouseover view/onmouseover;\n-                  onmousemove view/onmousemove;\n-                  onmouseout view/onmouseout;\n-                  onkeypress view/onkeypress;\n-                  onkeydown view/onkeydown;\n-                  onkeyup view/onkeyup;\n-                  disabled view/disabled;\n-                  tabindex view/tabindex;\n-                  onfocus view/onfocus;\n-                  onblur view/onblur;\n-                  onchange view/onchange;\n-                  multiple view/multiple;\n-                  size view/size;\n-                "\n+        <select id="${view/id}-from"\n+                class="form-control ${view/klass}"\n+                name="${view/name}.from"\n+                size="${view/size}"\n+                style="${view/style}"\n+                title="${view/title}"\n+                lang="${view/lang}"\n+                onclick="${view/onclick}"\n+                ondblclick="${view/ondblclick}"\n+                onmousedown="${view/onmousedown}"\n+                onmouseup="${view/onmouseup}"\n+                onmouseover="${view/onmouseover}"\n+                onmousemove="${view/onmousemove}"\n+                onmouseout="${view/onmouseout}"\n+                onkeypress="${view/onkeypress}"\n+                onkeydown="${view/onkeydown}"\n+                onkeyup="${view/onkeyup}"\n+                disabled="${view/disabled}"\n+                tabindex="${view/tabindex}"\n+                onfocus="${view/onfocus}"\n+                onblur="${view/onblur}"\n+                onchange="${view/onchange}"\n+                multiple="${view/multiple}"\n         >\n           <option tal:repeat="entry view/notselectedItems"\n                   tal:content="nocall:entry/content"\n@@ -76,42 +67,36 @@\n         >&larr;</button>\n       </td>\n       <td>\n-        <select class=""\n-                id="to"\n-                name="to"\n-                size="5"\n-                tal:attributes="\n-                  id string:${view/id}-to;\n-                  name string:${view/name}.to;\n-                  class string:form-control ${view/klass};\n-                  style view/style;\n-                  title view/title;\n-                  lang view/lang;\n-                  onclick view/onclick;\n-                  ondblclick view/ondblclick;\n-                  onmousedown view/onmousedown;\n-                  onmouseup view/onmouseup;\n-                  onmouseover view/onmouseover;\n-                  onmousemove view/onmousemove;\n-                  onmouseout view/onmouseout;\n-                  onkeypress view/onkeypress;\n-                  onkeydown view/onkeydown;\n-                  onkeyup view/onkeyup;\n-                  disabled view/disabled;\n-                  tabindex view/tabindex;\n-                  onfocus view/onfocus;\n-                  onblur view/onblur;\n-                  onchange view/onchange;\n-                  multiple view/multiple;\n-                  size view/size;\n-                  required python:view.required and \'required\' or None;\n-                "\n-        >\n+        <select id="${view/id}-to"\n+                class="form-select ${view/klass}"\n+                name="${view/name}.to"\n+                size="${view/size}"\n+                style="${view/style}"\n+                title="${view/title}"\n+                lang="${view/lang}"\n+                required="${python:view.required and \'required\' or None}"\n+                onclick="${view/onclick}"\n+                ondblclick="${view/ondblclick}"\n+                onmousedown="${view/onmousedown}"\n+                onmouseup="${view/onmouseup}"\n+                onmouseover="${view/onmouseover}"\n+                onmousemove="${view/onmousemove}"\n+                onmouseout="${view/onmouseout}"\n+                onkeypress="${view/onkeypress}"\n+                onkeydown="${view/onkeydown}"\n+                onkeyup="${view/onkeyup}"\n+                disabled="${view/disabled}"\n+                tabindex="${view/tabindex}"\n+                onfocus="${view/onfocus}"\n+                onblur="${view/onblur}"\n+                onchange="${view/onchange}"\n+                multiple="${view/multiple}">\n           <option tal:repeat="entry view/selectedItems"\n                   tal:content="nocall:entry/content"\n                   tal:attributes="\n                     value entry/value;\n                   "\n+                  selected="selected"\n                   i18n:translate=""\n           ></option>\n         </select>\n@@ -128,12 +113,8 @@\n               "\n         >\n           <script type="text/javascript"\n-                  tal:content="string:copyDataForSubmit(\'${view/id}\');"\n-          >\n-          /*  <![CDATA[ */\n+                  tal:content="string:copyDataForSubmit(\'${view/id}\');">\n           // initial copying of field "field.to" --> "field"\n-          copyDataForSubmit("<i tal:replace="${view/id}"/>");\n-          /* ]]> */\n           </script>\n         </span>\n       </td>\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2023-07-04T15:34:35+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.z3cform/commit/13c2a333dac076fc7e2608d157f924614f4cda1b

changenote

Files changed:
A news/178.bugfix

b'diff --git a/news/178.bugfix b/news/178.bugfix\nnew file mode 100644\nindex 0000000..0124888\n--- /dev/null\n+++ b/news/178.bugfix\n@@ -0,0 +1,2 @@\n+Fix OrdereSelectWidget browser validation when the input is required.\n+[petschki]\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2023-07-04T15:38:34+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.z3cform/commit/fc5504c879f2dd23b8e2ef81db39be8dea7d363f

zpretty

Files changed:
M plone/app/z3cform/templates/orderedselect_input.pt

b'diff --git a/plone/app/z3cform/templates/orderedselect_input.pt b/plone/app/z3cform/templates/orderedselect_input.pt\nindex e70df4b..a5a2d00 100644\n--- a/plone/app/z3cform/templates/orderedselect_input.pt\n+++ b/plone/app/z3cform/templates/orderedselect_input.pt\n@@ -8,33 +8,34 @@\n   ></script>\n \n   <table class="ordered-selection-field table table-borderless"\n+         id="${view/id}"\n          border="0"\n-         id="${view/id}">\n+  >\n     <tr>\n       <td>\n-        <select id="${view/id}-from"\n-                class="form-control ${view/klass}"\n-                name="${view/name}.from"\n-                size="${view/size}"\n-                style="${view/style}"\n-                title="${view/title}"\n+        <select class="form-control ${view/klass}"\n+                id="${view/id}-from"\n+                disabled="${view/disabled}"\n                 lang="${view/lang}"\n+                multiple="${view/multiple}"\n+                name="${view/name}.from"\n+                onblur="${view/onblur}"\n+                onchange="${view/onchange}"\n                 onclick="${view/onclick}"\n                 ondblclick="${view/ondblclick}"\n+                onfocus="${view/onfocus}"\n+                onkeydown="${view/onkeydown}"\n+                onkeypress="${view/onkeypress}"\n+                onkeyup="${view/onkeyup}"\n                 onmousedown="${view/onmousedown}"\n-                onmouseup="${view/onmouseup}"\n-                onmouseover="${view/onmouseover}"\n                 onmousemove="${view/onmousemove}"\n                 onmouseout="${view/onmouseout}"\n-                onkeypress="${view/onkeypress}"\n-                onkeydown="${view/onkeydown}"\n-                onkeyup="${view/onkeyup}"\n-                disabled="${view/disabled}"\n+                onmouseover="${view/onmouseover}"\n+                onmouseup="${view/onmouseup}"\n+                size="${view/size}"\n+                style="${view/style}"\n                 tabindex="${view/tabindex}"\n-                onfocus="${view/onfocus}"\n-                onblur="${view/onblur}"\n-                onchange="${view/onchange}"\n-                multiple="${view/multiple}"\n+                title="${view/title}"\n         >\n           <option tal:repeat="entry view/notselectedItems"\n                   tal:content="nocall:entry/content"\n@@ -67,36 +68,37 @@\n         >&larr;</button>\n       </td>\n       <td>\n-        <select id="${view/id}-to"\n-                class="form-select ${view/klass}"\n-                name="${view/name}.to"\n-                size="${view/size}"\n-                style="${view/style}"\n-                title="${view/title}"\n+        <select class="form-select ${view/klass}"\n+                id="${view/id}-to"\n+                disabled="${view/disabled}"\n                 lang="${view/lang}"\n-                required="${python:view.required and \'required\' or None}"\n+                multiple="${view/multiple}"\n+                name="${view/name}.to"\n+                onblur="${view/onblur}"\n+                onchange="${view/onchange}"\n                 onclick="${view/onclick}"\n                 ondblclick="${view/ondblclick}"\n+                onfocus="${view/onfocus}"\n+                onkeydown="${view/onkeydown}"\n+                onkeypress="${view/onkeypress}"\n+                onkeyup="${view/onkeyup}"\n                 onmousedown="${view/onmousedown}"\n-                onmouseup="${view/onmouseup}"\n-                onmouseover="${view/onmouseover}"\n                 onmousemove="${view/onmousemove}"\n                 onmouseout="${view/onmouseout}"\n-                onkeypress="${view/onkeypress}"\n-                onkeydown="${view/onkeydown}"\n-                onkeyup="${view/onkeyup}"\n-                disabled="${view/disabled}"\n+                onmouseover="${view/onmouseover}"\n+                onmouseup="${view/onmouseup}"\n+                required="${python:view.required and \'required\' or None}"\n+                size="${view/size}"\n+                style="${view/style}"\n                 tabindex="${view/tabindex}"\n-                onfocus="${view/onfocus}"\n-                onblur="${view/onblur}"\n-                onchange="${view/onchange}"\n-                multiple="${view/multiple}">\n-          <option tal:repeat="entry view/selectedItems"\n+                title="${view/title}"\n+        >\n+          <option selected="selected"\n+                  tal:repeat="entry view/selectedItems"\n                   tal:content="nocall:entry/content"\n                   tal:attributes="\n                     value entry/value;\n                   "\n-                  selected="selected"\n                   i18n:translate=""\n           ></option>\n         </select>\n@@ -113,7 +115,8 @@\n               "\n         >\n           <script type="text/javascript"\n-                  tal:content="string:copyDataForSubmit(\'${view/id}\');">\n+                  tal:content="string:copyDataForSubmit(\'${view/id}\');"\n+          >\n           // initial copying of field "field.to" --> "field"\n           </script>\n         </span>\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2023-07-05T07:29:32+02:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/eb6d1f7fcc00dd7107f9f45fc2527f4a029853b7

Merge pull request #178 from plone/petschki-orderedselect-required-fix

OrderedSelectWidget: preselect the saved values to fix browser validation of required input

Files changed:
A news/178.bugfix
M plone/app/z3cform/templates/orderedselect_input.pt

b'diff --git a/news/178.bugfix b/news/178.bugfix\nnew file mode 100644\nindex 0000000..0124888\n--- /dev/null\n+++ b/news/178.bugfix\n@@ -0,0 +1,2 @@\n+Fix OrdereSelectWidget browser validation when the input is required.\n+[petschki]\ndiff --git a/plone/app/z3cform/templates/orderedselect_input.pt b/plone/app/z3cform/templates/orderedselect_input.pt\nindex ccf2a37..a5a2d00 100644\n--- a/plone/app/z3cform/templates/orderedselect_input.pt\n+++ b/plone/app/z3cform/templates/orderedselect_input.pt\n@@ -7,43 +7,35 @@\n           type="text/javascript"\n   ></script>\n \n-  <table class="ordered-selection-field"\n+  <table class="ordered-selection-field table table-borderless"\n+         id="${view/id}"\n          border="0"\n-         tal:attributes="\n-           id view/id;\n-         "\n   >\n     <tr>\n       <td>\n-        <select class=""\n-                id="from"\n-                name="from"\n-                size="5"\n-                tal:attributes="\n-                  id string:${view/id}-from;\n-                  name string:${view/name}.from;\n-                  class string:form-control ${view/klass};\n-                  style view/style;\n-                  title view/title;\n-                  lang view/lang;\n-                  onclick view/onclick;\n-                  ondblclick view/ondblclick;\n-                  onmousedown view/onmousedown;\n-                  onmouseup view/onmouseup;\n-                  onmouseover view/onmouseover;\n-                  onmousemove view/onmousemove;\n-                  onmouseout view/onmouseout;\n-                  onkeypress view/onkeypress;\n-                  onkeydown view/onkeydown;\n-                  onkeyup view/onkeyup;\n-                  disabled view/disabled;\n-                  tabindex view/tabindex;\n-                  onfocus view/onfocus;\n-                  onblur view/onblur;\n-                  onchange view/onchange;\n-                  multiple view/multiple;\n-                  size view/size;\n-                "\n+        <select class="form-control ${view/klass}"\n+                id="${view/id}-from"\n+                disabled="${view/disabled}"\n+                lang="${view/lang}"\n+                multiple="${view/multiple}"\n+                name="${view/name}.from"\n+                onblur="${view/onblur}"\n+                onchange="${view/onchange}"\n+                onclick="${view/onclick}"\n+                ondblclick="${view/ondblclick}"\n+                onfocus="${view/onfocus}"\n+                onkeydown="${view/onkeydown}"\n+                onkeypress="${view/onkeypress}"\n+                onkeyup="${view/onkeyup}"\n+                onmousedown="${view/onmousedown}"\n+                onmousemove="${view/onmousemove}"\n+                onmouseout="${view/onmouseout}"\n+                onmouseover="${view/onmouseover}"\n+                onmouseup="${view/onmouseup}"\n+                size="${view/size}"\n+                style="${view/style}"\n+                tabindex="${view/tabindex}"\n+                title="${view/title}"\n         >\n           <option tal:repeat="entry view/notselectedItems"\n                   tal:content="nocall:entry/content"\n@@ -76,38 +68,33 @@\n         >&larr;</button>\n       </td>\n       <td>\n-        <select class=""\n-                id="to"\n-                name="to"\n-                size="5"\n-                tal:attributes="\n-                  id string:${view/id}-to;\n-                  name string:${view/name}.to;\n-                  class string:form-control ${view/klass};\n-                  style view/style;\n-                  title view/title;\n-                  lang view/lang;\n-                  onclick view/onclick;\n-                  ondblclick view/ondblclick;\n-                  onmousedown view/onmousedown;\n-                  onmouseup view/onmouseup;\n-                  onmouseover view/onmouseover;\n-                  onmousemove view/onmousemove;\n-                  onmouseout view/onmouseout;\n-                  onkeypress view/onkeypress;\n-                  onkeydown view/onkeydown;\n-                  onkeyup view/onkeyup;\n-                  disabled view/disabled;\n-                  tabindex view/tabindex;\n-                  onfocus view/onfocus;\n-                  onblur view/onblur;\n-                  onchange view/onchange;\n-                  multiple view/multiple;\n-                  size view/size;\n-                  required python:view.required and \'required\' or None;\n-                "\n+        <select class="form-select ${view/klass}"\n+                id="${view/id}-to"\n+                disabled="${view/disabled}"\n+                lang="${view/lang}"\n+                multiple="${view/multiple}"\n+                name="${view/name}.to"\n+                onblur="${view/onblur}"\n+                onchange="${view/onchange}"\n+                onclick="${view/onclick}"\n+                ondblclick="${view/ondblclick}"\n+                onfocus="${view/onfocus}"\n+                onkeydown="${view/onkeydown}"\n+                onkeypress="${view/onkeypress}"\n+                onkeyup="${view/onkeyup}"\n+                onmousedown="${view/onmousedown}"\n+                onmousemove="${view/onmousemove}"\n+                onmouseout="${view/onmouseout}"\n+                onmouseover="${view/onmouseover}"\n+                onmouseup="${view/onmouseup}"\n+                required="${python:view.required and \'required\' or None}"\n+                size="${view/size}"\n+                style="${view/style}"\n+                tabindex="${view/tabindex}"\n+                title="${view/title}"\n         >\n-          <option tal:repeat="entry view/selectedItems"\n+          <option selected="selected"\n+                  tal:repeat="entry view/selectedItems"\n                   tal:content="nocall:entry/content"\n                   tal:attributes="\n                     value entry/value;\n@@ -130,10 +117,7 @@\n           <script type="text/javascript"\n                   tal:content="string:copyDataForSubmit(\'${view/id}\');"\n           >\n-          /*  <![CDATA[ */\n           // initial copying of field "field.to" --> "field"\n-          copyDataForSubmit("<i tal:replace="${view/id}"/>");\n-          /* ]]> */\n           </script>\n         </span>\n       </td>\n'

