Repository: plone.app.layout


Branch: refs/heads/master
Date: 2020-04-15T15:47:13+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/d9cdeaf7976d881fa6100bc09fab17af56a38535

Make navtree more robust against empty title

Files changed:
A news/237.bugfix
M plone/app/layout/viewlets/common.py
M plone/app/layout/viewlets/sections.pt

b'diff --git a/news/237.bugfix b/news/237.bugfix\nnew file mode 100644\nindex 00000000..96135470\n--- /dev/null\n+++ b/news/237.bugfix\n@@ -0,0 +1,2 @@\n+Make navtree more robust against empty title or name, do not fail but fall back to id.\n+[jensens]\ndiff --git a/plone/app/layout/viewlets/common.py b/plone/app/layout/viewlets/common.py\nindex 6d3e2eef..79f45617 100644\n--- a/plone/app/layout/viewlets/common.py\n+++ b/plone/app/layout/viewlets/common.py\n@@ -365,9 +365,9 @@ def render_item(self, item, path):\n             item.update(\n                 {"sub": sub, "opener": "", "aria_haspopup": "", "has_sub_class": "",}\n             )\n-        if "title" in item:\n+        if "title" in item and item["title"]:\n             item["title"] = escape(item["title"])\n-        if "name" in item:\n+        if "name" in item and item["name"]:\n             item["name"] = escape(item["name"])\n         return self._item_markup_template.format(**item)\n \ndiff --git a/plone/app/layout/viewlets/sections.pt b/plone/app/layout/viewlets/sections.pt\nindex 12085d89..db3fd688 100644\n--- a/plone/app/layout/viewlets/sections.pt\n+++ b/plone/app/layout/viewlets/sections.pt\n@@ -19,7 +19,7 @@\n \n       <div class="plone-collapse plone-navbar-collapse" id="portal-globalnav-collapse">\n         <ul class="plone-nav plone-navbar-nav" id="portal-globalnav">\n-          <navtree tal:replace="structure view/render_globalnav" />\n+          <navtree tal:replace="structure python:view.render_globalnav()" />\n         </ul>\n       </div>\n     </div>\n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2020-04-15T17:12:57+02:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/033013c776a45b7be812eb71622108c66e771755

Merge pull request #237 from plone/jensens-more-robust-navtree

Make navtree more robust against empty title

Files changed:
A news/237.bugfix
M plone/app/layout/viewlets/common.py
M plone/app/layout/viewlets/sections.pt

b'diff --git a/news/237.bugfix b/news/237.bugfix\nnew file mode 100644\nindex 00000000..96135470\n--- /dev/null\n+++ b/news/237.bugfix\n@@ -0,0 +1,2 @@\n+Make navtree more robust against empty title or name, do not fail but fall back to id.\n+[jensens]\ndiff --git a/plone/app/layout/viewlets/common.py b/plone/app/layout/viewlets/common.py\nindex 6d3e2eef..79f45617 100644\n--- a/plone/app/layout/viewlets/common.py\n+++ b/plone/app/layout/viewlets/common.py\n@@ -365,9 +365,9 @@ def render_item(self, item, path):\n             item.update(\n                 {"sub": sub, "opener": "", "aria_haspopup": "", "has_sub_class": "",}\n             )\n-        if "title" in item:\n+        if "title" in item and item["title"]:\n             item["title"] = escape(item["title"])\n-        if "name" in item:\n+        if "name" in item and item["name"]:\n             item["name"] = escape(item["name"])\n         return self._item_markup_template.format(**item)\n \ndiff --git a/plone/app/layout/viewlets/sections.pt b/plone/app/layout/viewlets/sections.pt\nindex 12085d89..db3fd688 100644\n--- a/plone/app/layout/viewlets/sections.pt\n+++ b/plone/app/layout/viewlets/sections.pt\n@@ -19,7 +19,7 @@\n \n       <div class="plone-collapse plone-navbar-collapse" id="portal-globalnav-collapse">\n         <ul class="plone-nav plone-navbar-nav" id="portal-globalnav">\n-          <navtree tal:replace="structure view/render_globalnav" />\n+          <navtree tal:replace="structure python:view.render_globalnav()" />\n         </ul>\n       </div>\n     </div>\n'

