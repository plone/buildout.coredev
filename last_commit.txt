Repository: mockup


Branch: refs/heads/master
Date: 2020-08-03T14:40:29+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/mockup/commit/c875ad19ecafcfad6bc8e99be9e049b6c67b7d69

respect default_page_types in actionmenu if folder_contents (#1005)

respect default_page_types in actionmenu if folder_contents.
Fixes https://github.com/plone/Products.CMFPlone/issues/2700

Files changed:
A news/1005.bugfix
M mockup/patterns/structure/js/actionmenu.js
M mockup/patterns/structure/pattern.js
M mockup/tests/pattern-structure-test.js

b'diff --git a/mockup/patterns/structure/js/actionmenu.js b/mockup/patterns/structure/js/actionmenu.js\nindex 0717f5c8e..163d11ec3 100644\n--- a/mockup/patterns/structure/js/actionmenu.js\n+++ b/mockup/patterns/structure/js/actionmenu.js\n@@ -108,7 +108,7 @@ define([\'underscore\', \'translate\'], function(_, _t) {\n       delete result[\'move-top\'];\n       delete result[\'move-bottom\'];\n     }\n-    if (model.is_folderish || !app.setDefaultPageUrl) {\n+    if (app.defaultPageTypes.indexOf(model.portal_type) == -1 || !app.setDefaultPageUrl) {\n       delete result[\'set-default-page\'];\n     }\n \ndiff --git a/mockup/patterns/structure/pattern.js b/mockup/patterns/structure/pattern.js\nindex b5b07c3cf..d8c0d2f0d 100644\n--- a/mockup/patterns/structure/pattern.js\n+++ b/mockup/patterns/structure/pattern.js\n@@ -119,6 +119,14 @@ define([\n           \'Blob\': \'/view\'\n       },\n \n+      defaultPageTypes: null,\n+      _default_defaultPageTypes: [\n+          \'Document\',\n+          \'Event\',\n+          \'News Item\',\n+          \'Collection\'\n+      ],\n+\n       collectionConstructor:\n         \'mockup-patterns-structure-url/js/collections/result\',\n \n@@ -187,7 +195,7 @@ define([\n         May want to consider moving the _default_* values out of the\n         options object.\n       */\n-      var replaceDefaults = [\'attributes\', \'activeColumns\', \'availableColumns\', \'buttons\', \'typeToViewAction\'];\n+      var replaceDefaults = [\'attributes\', \'activeColumns\', \'availableColumns\', \'buttons\', \'typeToViewAction\', \'defaultPageTypes\'];\n       _.each(replaceDefaults, function(idx) {\n         if (self.options[idx] === null) {\n           self.options[idx] = self.options[\'_default_\' + idx];\ndiff --git a/mockup/tests/pattern-structure-test.js b/mockup/tests/pattern-structure-test.js\nindex 00684df24..515b430fc 100644\n--- a/mockup/tests/pattern-structure-test.js\n+++ b/mockup/tests/pattern-structure-test.js\n@@ -135,6 +135,12 @@ define([\n \n         \'activeColumns\': [],\n         \'availableColumns\': [],\n+        \'defaultPageTypes\': [\n+          \'Document\',\n+          \'Event\',\n+          \'News Item\',\n+          \'Collection\'\n+        ],\n         \'indexOptionsUrl\': \'\',\n         \'setDefaultPageUrl\': \'\',\n         \'collectionConstructor\': \'mockup-patterns-structure-url/js/collections/result\',\n@@ -530,6 +536,12 @@ define([\n         \'activeColumns\': [],\n         \'availableColumns\': [],\n         \'collectionConstructor\': \'mockup-patterns-structure-url/js/collections/result\',\n+        \'defaultPageTypes\': [\n+          \'Document\',\n+          \'Event\',\n+          \'News Item\',\n+          \'Collection\'\n+        ],\n         \'typeToViewAction\': {\n           \'File\': \'/view\',\n           \'Image\': \'/view\',\n@@ -821,6 +833,12 @@ define([\n         "indexOptionsUrl": "/tests/json/queryStringCriteria.json",\n         "contextInfoUrl": "{path}/contextInfo",\n         "setDefaultPageUrl": "/setDefaultPage",\n+        "defaultPageTypes": [\n+          "Document",\n+          "Event",\n+          "News Item",\n+          "Collection"\n+        ],\n         "urlStructure": {\n           "base": "http://localhost:9876",\n           "appended": "/folder_contents"\n@@ -871,7 +889,7 @@ define([\n             UID: \'123sdfasdf\' + path + i,\n             getURL: \'http://localhost:9876\' + path + \'/item\' + i,\n             path: path + \'/item\' + i,\n-            portal_type: \'Document \' + i,\n+            portal_type: \'Document\',\n             Description: \'document\',\n             Title: \'Document \' + i,\n             \'review_state\': \'published\',\n@@ -1223,6 +1241,7 @@ define([\n       // cannot select all\n       expect($(\'a.selectAll\', item).length).to.equal(0);\n       // can set default page\n+      expect($(\'a.set-default-page\', item).length).to.equal(1);\n       expect($(\'a.set-default-page\', item).text().trim()).to.equal(\n         \'Set as default page\');\n       $(\'a.set-default-page\', item).click();\ndiff --git a/news/1005.bugfix b/news/1005.bugfix\nnew file mode 100644\nindex 000000000..4cbe411f1\n--- /dev/null\n+++ b/news/1005.bugfix\n@@ -0,0 +1,2 @@\n+Respect default_page_types in actionmenu if folder_contents. Fixes https://github.com/plone/Products.CMFPlone/issues/2700\n+[pbauer]\n\\ No newline at end of file\n'

