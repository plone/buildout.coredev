Repository: plone.app.upgrade


Branch: refs/heads/1.x
Date: 2020-09-22T17:05:40-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/66be38cd0806fad5b1f3a618cb294e4d5e5d8c31

Check that maxage field is a FieldRef before getting its recordName. fixes gh-246

Files changed:
A news/246.bugfix
M plone/app/upgrade/v43/final.py

b'diff --git a/news/246.bugfix b/news/246.bugfix\nnew file mode 100644\nindex 00000000..f09a89af\n--- /dev/null\n+++ b/news/246.bugfix\n@@ -0,0 +1,2 @@\n+- Check that maxage field is a FieldRef before getting its recordName\n+  [frapell]\ndiff --git a/plone/app/upgrade/v43/final.py b/plone/app/upgrade/v43/final.py\nindex bad22f87..4dab42d6 100644\n--- a/plone/app/upgrade/v43/final.py\n+++ b/plone/app/upgrade/v43/final.py\n@@ -323,7 +323,7 @@ def removeFakeKupu(context):\n \n def addSortOnProperty(context):\n     """Add sort_on field to search controlpanel.\n-    \n+\n     The default value of this field is relevance.\n     """\n     site_properties = getToolByName(context, \'portal_properties\').site_properties\n@@ -355,7 +355,8 @@ def fix_double_smaxage(context):\n     for name in (maxage, def_maxage, def_smaxage):\n         if name not in registry:\n             return\n-    if registry.records[maxage].field.recordName != def_smaxage:\n+    field = registry.records[maxage].field\n+    if isinstance(field, FieldRef) and field.recordName != def_smaxage:\n         # no fix needed\n         return\n     field_ref = FieldRef(def_maxage, registry.records[def_maxage].field)\n'

Repository: plone.app.upgrade


Branch: refs/heads/1.x
Date: 2020-09-23T10:14:21+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/9fb2543c2518a9ea2323e9bfb44bc7147eaf1878

Merge pull request #247 from plone/frapell-1.x

Fix specific issue when upgrading to 4.3.20

Files changed:
A news/246.bugfix
M plone/app/upgrade/v43/final.py

b'diff --git a/news/246.bugfix b/news/246.bugfix\nnew file mode 100644\nindex 00000000..f09a89af\n--- /dev/null\n+++ b/news/246.bugfix\n@@ -0,0 +1,2 @@\n+- Check that maxage field is a FieldRef before getting its recordName\n+  [frapell]\ndiff --git a/plone/app/upgrade/v43/final.py b/plone/app/upgrade/v43/final.py\nindex bad22f87..4dab42d6 100644\n--- a/plone/app/upgrade/v43/final.py\n+++ b/plone/app/upgrade/v43/final.py\n@@ -323,7 +323,7 @@ def removeFakeKupu(context):\n \n def addSortOnProperty(context):\n     """Add sort_on field to search controlpanel.\n-    \n+\n     The default value of this field is relevance.\n     """\n     site_properties = getToolByName(context, \'portal_properties\').site_properties\n@@ -355,7 +355,8 @@ def fix_double_smaxage(context):\n     for name in (maxage, def_maxage, def_smaxage):\n         if name not in registry:\n             return\n-    if registry.records[maxage].field.recordName != def_smaxage:\n+    field = registry.records[maxage].field\n+    if isinstance(field, FieldRef) and field.recordName != def_smaxage:\n         # no fix needed\n         return\n     field_ref = FieldRef(def_maxage, registry.records[def_maxage].field)\n'

