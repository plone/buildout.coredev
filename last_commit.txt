Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2020-05-27T20:44:16+03:00
Author: Alin Voinea (avoinea) <contact@avoinea.com>
Commit: https://github.com/plone/plone.schemaeditor/commit/7b822ff9ab523f348730d42b6a3db823b6b737e3

Fixes #76 - Can't get Fields vocabulary via RestAPI

Files changed:
M plone/schemaeditor/browser/schema/listing.py
M plone/schemaeditor/fields.py

b'diff --git a/plone/schemaeditor/browser/schema/listing.py b/plone/schemaeditor/browser/schema/listing.py\nindex 55e2cc1..6a6152e 100644\n--- a/plone/schemaeditor/browser/schema/listing.py\n+++ b/plone/schemaeditor/browser/schema/listing.py\n@@ -64,8 +64,9 @@ def _field_factory(self, field):\n             field.__module__,\n             field.__class__.__name__,\n         )\n-        if self.context.allowedFields is not None:\n-            if field_identifier not in self.context.allowedFields:\n+        allowedFields = getattr(self.context, "allowedFields", None)\n+        if allowedFields is not None:\n+            if field_identifier not in allowedFields:\n                 return None\n         return queryUtility(IFieldFactory, name=field_identifier)\n \ndiff --git a/plone/schemaeditor/fields.py b/plone/schemaeditor/fields.py\nindex 7fcb460..4cb2f3a 100644\n--- a/plone/schemaeditor/fields.py\n+++ b/plone/schemaeditor/fields.py\n@@ -59,9 +59,10 @@ def protected(self, field):\n def FieldsVocabularyFactory(context):\n     request = getRequest()\n     field_factories = getUtilitiesFor(IFieldFactory)\n-    if context.allowedFields is not None:\n+    allowedFields = getattr(context, "allowedFields", None)\n+    if allowedFields is not None:\n         field_factories = [(id, factory) for id, factory in field_factories\n-                           if id in context.allowedFields]\n+                           if id in allowedFields]\n     terms = []\n     for (field_id, factory) in field_factories:\n         terms.append(\n'

Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2020-05-27T20:50:54+03:00
Author: Alin Voinea (avoinea) <contact@avoinea.com>
Commit: https://github.com/plone/plone.schemaeditor/commit/a970a50337f4d14dc0a1b95f0db724aee61feb67

Add CHANGELOG

Files changed:
A news/76.bugfix

b'diff --git a/news/76.bugfix b/news/76.bugfix\nnew file mode 100644\nindex 0000000..7ef755d\n--- /dev/null\n+++ b/news/76.bugfix\n@@ -0,0 +1 @@\n+Fix `Fields` vocabulary via RestAPI [avoinea]\n'

Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2020-05-27T20:51:06+03:00
Author: Alin Voinea (avoinea) <contact@avoinea.com>
Commit: https://github.com/plone/plone.schemaeditor/commit/8c8cd6653aeeab61a04e855fc24833da432e53c6

PyFlakes

Files changed:
M plone/schemaeditor/browser/schema/traversal.py

b'diff --git a/plone/schemaeditor/browser/schema/traversal.py b/plone/schemaeditor/browser/schema/traversal.py\nindex ebf87a5..db9f2c7 100644\n--- a/plone/schemaeditor/browser/schema/traversal.py\n+++ b/plone/schemaeditor/browser/schema/traversal.py\n@@ -6,8 +6,6 @@\n from zope.publisher.interfaces.browser import IBrowserPublisher\n from ZPublisher.BaseRequest import DefaultPublishTraverse\n \n-import six\n-\n \n @implementer(ISchemaContext, IBrowserPublisher)\n class SchemaContext(SimpleItem):\n'

Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2020-06-19T16:07:56+03:00
Author: Alin Voinea (avoinea) <contact@avoinea.com>
Commit: https://github.com/plone/plone.schemaeditor/commit/6dd1a7a4af9bfc98ba41e5107a7a9bc53929b0d0

Merge pull request #77 from plone/restapi-fields-vocabulary

Fixes #76 - Restapi Fields vocabulary

Files changed:
A news/76.bugfix
M plone/schemaeditor/browser/schema/listing.py
M plone/schemaeditor/browser/schema/traversal.py
M plone/schemaeditor/fields.py

b'diff --git a/news/76.bugfix b/news/76.bugfix\nnew file mode 100644\nindex 0000000..7ef755d\n--- /dev/null\n+++ b/news/76.bugfix\n@@ -0,0 +1 @@\n+Fix `Fields` vocabulary via RestAPI [avoinea]\ndiff --git a/plone/schemaeditor/browser/schema/listing.py b/plone/schemaeditor/browser/schema/listing.py\nindex 55e2cc1..6a6152e 100644\n--- a/plone/schemaeditor/browser/schema/listing.py\n+++ b/plone/schemaeditor/browser/schema/listing.py\n@@ -64,8 +64,9 @@ def _field_factory(self, field):\n             field.__module__,\n             field.__class__.__name__,\n         )\n-        if self.context.allowedFields is not None:\n-            if field_identifier not in self.context.allowedFields:\n+        allowedFields = getattr(self.context, "allowedFields", None)\n+        if allowedFields is not None:\n+            if field_identifier not in allowedFields:\n                 return None\n         return queryUtility(IFieldFactory, name=field_identifier)\n \ndiff --git a/plone/schemaeditor/browser/schema/traversal.py b/plone/schemaeditor/browser/schema/traversal.py\nindex ebf87a5..db9f2c7 100644\n--- a/plone/schemaeditor/browser/schema/traversal.py\n+++ b/plone/schemaeditor/browser/schema/traversal.py\n@@ -6,8 +6,6 @@\n from zope.publisher.interfaces.browser import IBrowserPublisher\n from ZPublisher.BaseRequest import DefaultPublishTraverse\n \n-import six\n-\n \n @implementer(ISchemaContext, IBrowserPublisher)\n class SchemaContext(SimpleItem):\ndiff --git a/plone/schemaeditor/fields.py b/plone/schemaeditor/fields.py\nindex 7fcb460..4cb2f3a 100644\n--- a/plone/schemaeditor/fields.py\n+++ b/plone/schemaeditor/fields.py\n@@ -59,9 +59,10 @@ def protected(self, field):\n def FieldsVocabularyFactory(context):\n     request = getRequest()\n     field_factories = getUtilitiesFor(IFieldFactory)\n-    if context.allowedFields is not None:\n+    allowedFields = getattr(context, "allowedFields", None)\n+    if allowedFields is not None:\n         field_factories = [(id, factory) for id, factory in field_factories\n-                           if id in context.allowedFields]\n+                           if id in allowedFields]\n     terms = []\n     for (field_id, factory) in field_factories:\n         terms.append(\n'

