Repository: plone.restapi


Branch: refs/heads/main
Date: 2024-10-01T08:53:30-07:00
Author: Faakhir Zahid (Faakhir30) <110815427+Faakhir30@users.noreply.github.com>
Commit: https://github.com/plone/plone.restapi/commit/7a5fcf19b42bfc398760e0ff61b63c360a5d1233

Fix logger initialization at add Allias by csv (#1821)

* added upload and download aliases in csv format.

* Update documentation

* handle file closing

* fix logger init

* Add check to upload CSV file's content-type.

Files changed:
M src/plone/restapi/services/aliases/add.py

b'diff --git a/src/plone/restapi/services/aliases/add.py b/src/plone/restapi/services/aliases/add.py\nindex ab8af1ed2..e54ccc0c6 100644\n--- a/src/plone/restapi/services/aliases/add.py\n+++ b/src/plone/restapi/services/aliases/add.py\n@@ -18,7 +18,7 @@\n import plone.protect.interfaces\n import logging\n \n-logger = logging.getLogger("Plone")\n+logger = logging.getLogger(__name__)\n \n \n @implementer(IPublishTraverse)\n@@ -94,11 +94,16 @@ def _reply_csv(self):\n         form = self.request.form\n         if not form.get("file"):\n             raise BadRequest("No file uploaded")\n+\n+        file = form["file"]\n+\n+        if file.headers.get("Content-Type") not in ("text/csv", "application/csv"):\n+            raise BadRequest("Uploaded file is not a valid CSV file")\n+\n         controlpanel = RedirectsControlPanel(self.context, self.request)\n         storage = getUtility(IRedirectionStorage)\n         status = IStatusMessage(self.request)\n         portal = getSite()\n-        file = form["file"]\n         controlpanel.upload(file, portal, storage, status)\n         file.close()\n \n'

