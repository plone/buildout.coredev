Repository: plone.volto


Branch: refs/heads/main
Date: 2024-01-05T22:07:58+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.volto/commit/d044b651f784209297fe3822d02741058cdeb841

Fix changed behavior and marker interfaces for plone.leadimage and plone.richtext.

See: https://github.com/plone/plone.app.contenttypes/pull/480

Files changed:
A news/133.bugfix
M src/plone/volto/browser/migrate_richtext.py
M src/plone/volto/scripts/add_image_field_metadata.py

b'diff --git a/news/133.bugfix b/news/133.bugfix\nnew file mode 100644\nindex 00000000..5b0fac50\n--- /dev/null\n+++ b/news/133.bugfix\n@@ -0,0 +1,3 @@\n+Fix changed behavior and marker interfaces for plone.leadimage and plone.richtext.\n+See: https://github.com/plone/plone.app.contenttypes/pull/480\n+[thet]\ndiff --git a/src/plone/volto/browser/migrate_richtext.py b/src/plone/volto/browser/migrate_richtext.py\nindex c0e74c8c..82c09d3c 100644\n--- a/src/plone/volto/browser/migrate_richtext.py\n+++ b/src/plone/volto/browser/migrate_richtext.py\n@@ -1,7 +1,7 @@\n from logging import getLogger\n from operator import itemgetter\n from plone import api\n-from plone.app.contenttypes.behaviors.leadimage import ILeadImage\n+from plone.app.contenttypes.behaviors.leadimage import ILeadImageBehavior\n from plone.app.textfield.value import RichTextValue\n from Products.Five import BrowserView\n from uuid import uuid4\n@@ -102,7 +102,7 @@ def migrate_richtext_to_blocks(\n                 blocks[uuid] = {"@type": "description"}\n                 blocks_layout["items"].append(uuid)\n \n-            if ILeadImage(obj, None) and ILeadImage(obj).image:\n+            if ILeadImageBehavior(obj, None) and ILeadImageBehavior(obj).image:\n                 uuid = str(uuid4())\n                 blocks[uuid] = {"@type": "leadimage"}\n                 blocks_layout["items"].append(uuid)\n@@ -161,7 +161,7 @@ def get_blocks_from_richtext(\n \n \n def types_with_blocks():\n-    """A list of content types with volto.blocks behavior"""\n+    """A list of content types with volto.blocks behavior."""\n     portal_types = api.portal.get_tool("portal_types")\n     results = []\n     for fti in portal_types.listTypeInfo():\ndiff --git a/src/plone/volto/scripts/add_image_field_metadata.py b/src/plone/volto/scripts/add_image_field_metadata.py\nindex ce2a860d..867c93d4 100644\n--- a/src/plone/volto/scripts/add_image_field_metadata.py\n+++ b/src/plone/volto/scripts/add_image_field_metadata.py\n@@ -2,7 +2,7 @@\n bin/instance -O Plone run scripts/add_image_field_metadata.py\n """\n from plone import api\n-from plone.app.contenttypes.behaviors.leadimage import ILeadImageBehavior\n+from plone.app.contenttypes.behaviors.leadimage import ILeadImage\n from plone.volto.behaviors.preview import IPreview\n from plone.volto.scripts.utils import print_info\n \n@@ -12,7 +12,7 @@\n catalog = api.portal.get_tool("portal_catalog")\n \n with api.env.adopt_roles(["Manager"]):\n-    images = api.content.find(object_provides=ILeadImageBehavior.__identifier__)\n+    images = api.content.find(object_provides=ILeadImage.__identifier__)\n     preview_images = api.content.find(object_provides=IPreview.__identifier__)\n \n     brains = images + preview_images\n'

Repository: plone.volto


Branch: refs/heads/main
Date: 2024-01-05T22:08:28+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.volto/commit/259e160876afd8f8c7faed85bb1a66488a6d9a71

Merge pull request #134 from plone/fix-behavior-interfaces

Fix changed behavior and marker interfaces for plone.leadimage and plone.richtext.

Files changed:
A news/133.bugfix
M src/plone/volto/browser/migrate_richtext.py
M src/plone/volto/scripts/add_image_field_metadata.py

b'diff --git a/news/133.bugfix b/news/133.bugfix\nnew file mode 100644\nindex 00000000..5b0fac50\n--- /dev/null\n+++ b/news/133.bugfix\n@@ -0,0 +1,3 @@\n+Fix changed behavior and marker interfaces for plone.leadimage and plone.richtext.\n+See: https://github.com/plone/plone.app.contenttypes/pull/480\n+[thet]\ndiff --git a/src/plone/volto/browser/migrate_richtext.py b/src/plone/volto/browser/migrate_richtext.py\nindex c0e74c8c..82c09d3c 100644\n--- a/src/plone/volto/browser/migrate_richtext.py\n+++ b/src/plone/volto/browser/migrate_richtext.py\n@@ -1,7 +1,7 @@\n from logging import getLogger\n from operator import itemgetter\n from plone import api\n-from plone.app.contenttypes.behaviors.leadimage import ILeadImage\n+from plone.app.contenttypes.behaviors.leadimage import ILeadImageBehavior\n from plone.app.textfield.value import RichTextValue\n from Products.Five import BrowserView\n from uuid import uuid4\n@@ -102,7 +102,7 @@ def migrate_richtext_to_blocks(\n                 blocks[uuid] = {"@type": "description"}\n                 blocks_layout["items"].append(uuid)\n \n-            if ILeadImage(obj, None) and ILeadImage(obj).image:\n+            if ILeadImageBehavior(obj, None) and ILeadImageBehavior(obj).image:\n                 uuid = str(uuid4())\n                 blocks[uuid] = {"@type": "leadimage"}\n                 blocks_layout["items"].append(uuid)\n@@ -161,7 +161,7 @@ def get_blocks_from_richtext(\n \n \n def types_with_blocks():\n-    """A list of content types with volto.blocks behavior"""\n+    """A list of content types with volto.blocks behavior."""\n     portal_types = api.portal.get_tool("portal_types")\n     results = []\n     for fti in portal_types.listTypeInfo():\ndiff --git a/src/plone/volto/scripts/add_image_field_metadata.py b/src/plone/volto/scripts/add_image_field_metadata.py\nindex ce2a860d..867c93d4 100644\n--- a/src/plone/volto/scripts/add_image_field_metadata.py\n+++ b/src/plone/volto/scripts/add_image_field_metadata.py\n@@ -2,7 +2,7 @@\n bin/instance -O Plone run scripts/add_image_field_metadata.py\n """\n from plone import api\n-from plone.app.contenttypes.behaviors.leadimage import ILeadImageBehavior\n+from plone.app.contenttypes.behaviors.leadimage import ILeadImage\n from plone.volto.behaviors.preview import IPreview\n from plone.volto.scripts.utils import print_info\n \n@@ -12,7 +12,7 @@\n catalog = api.portal.get_tool("portal_catalog")\n \n with api.env.adopt_roles(["Manager"]):\n-    images = api.content.find(object_provides=ILeadImageBehavior.__identifier__)\n+    images = api.content.find(object_provides=ILeadImage.__identifier__)\n     preview_images = api.content.find(object_provides=IPreview.__identifier__)\n \n     brains = images + preview_images\n'

