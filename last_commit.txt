Repository: plone.protect


Branch: refs/heads/4.x
Date: 2023-04-18T23:02:46+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.protect/commit/68ba6848cf06010fe9fc36147084ddaac185383f

Revert "do not depend here on plone.portlets"

This reverts commit 115c110d700bcf4e77fd4e30bc54fb584d0de05a.

That was meant for master only.

Files changed:
M plone/protect/auto.py
D news/99.bugfix

b"diff --git a/news/99.bugfix b/news/99.bugfix\ndeleted file mode 100644\nindex 1f23cbb..0000000\n--- a/news/99.bugfix\n+++ /dev/null\n@@ -1,3 +0,0 @@\n-Do not hard-depend on `plone.portlets`.\n-Prepare for Plone with portlets optional.\n-@jensens\n\\ No newline at end of file\ndiff --git a/plone/protect/auto.py b/plone/protect/auto.py\nindex 1602e65..d1c43e7 100644\n--- a/plone/protect/auto.py\n+++ b/plone/protect/auto.py\n@@ -5,6 +5,7 @@\n from lxml import etree\n from lxml import html\n from plone.keyring.interfaces import IKeyManager\n+from plone.portlets.interfaces import IPortletAssignment\n from plone.protect.authenticator import check\n from plone.protect.authenticator import createToken\n from plone.protect.authenticator import isAnonymousUser\n@@ -54,12 +55,6 @@\n except ImportError:\n     ScalesDict = None\n \n-# do not hard depend here on plone.portlets (for Plone 7)\n-try:\n-    from plone.portlets.interfaces import IPortletAssignment\n-except ImportError:\n-    IPortletAssignment = None\n-\n \n logger = logging.getLogger('plone.protect')\n \n@@ -264,7 +259,7 @@ def _check(self):\n                     safe_oids = self.request.environ[SAFE_WRITE_KEY]\n                 safe = True\n                 for obj in registered:\n-                    if IPortletAssignment is not None and IPortletAssignment.providedBy(obj):\n+                    if IPortletAssignment.providedBy(obj):\n                         continue\n                     if getattr(obj, '_p_oid', False) in safe_oids:\n                         continue\n"

