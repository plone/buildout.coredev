Repository: plone.folder


Branch: refs/heads/master
Date: 2021-05-05T08:50:18+02:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/plone.folder/commit/0ebb042ae00686b1af9f62625c473367c3be8544

Restore WebDAV support. (#17)

Restore WebDAV support. fixes #16

Files changed:
A news/16.bugfix
M src/plone/folder/ordered.py
M src/plone/folder/tests/test_webdav.py

b'diff --git a/news/16.bugfix b/news/16.bugfix\nnew file mode 100644\nindex 0000000..b3343aa\n--- /dev/null\n+++ b/news/16.bugfix\n@@ -0,0 +1 @@\n+Restore webdav support [frapell]\ndiff --git a/src/plone/folder/ordered.py b/src/plone/folder/ordered.py\nindex 8b6e0d4..fac2cd6 100644\n--- a/src/plone/folder/ordered.py\n+++ b/src/plone/folder/ordered.py\n@@ -20,17 +20,11 @@\n     # bbb import for Zope2\n     from Products.ZCatalog.Lazy import LazyMap\n \n-import pkg_resources\n-\n-\n-HAS_ZSERVER = True\n+HAS_WEBDAV = True\n try:\n-    dist = pkg_resources.get_distribution(\'ZServer\')\n-except pkg_resources.DistributionNotFound:\n-    HAS_ZSERVER = False\n-\n-if HAS_ZSERVER:\n     from webdav.NullResource import NullResource\n+except ImportError:\n+    HAS_WEBDAV = False\n \n \n @implementer(IOrderedContainer, IOrderableFolder, IAttributeAnnotatable)\n@@ -235,7 +229,7 @@ def __getitem__(self, key):\n         if hasattr(self, \'REQUEST\'):\n             request = self.REQUEST\n             method = request.get(\'REQUEST_METHOD\', \'GET\')\n-            if (HAS_ZSERVER and getattr(request, \'maybe_webdav_client\', False)\n+            if (HAS_WEBDAV and getattr(request, \'maybe_webdav_client\', False)\n                and method not in (\'GET\', \'POST\')):\n                 return NullResource(self, key, request).__of__(self)\n         raise KeyError(key)\ndiff --git a/src/plone/folder/tests/test_webdav.py b/src/plone/folder/tests/test_webdav.py\nindex 593eda9..05b8da0 100644\n--- a/src/plone/folder/tests/test_webdav.py\n+++ b/src/plone/folder/tests/test_webdav.py\n@@ -9,14 +9,11 @@\n import unittest\n \n \n-HAS_ZSERVER = True\n+HAS_WEBDAV = True\n try:\n-    dist = pkg_resources.get_distribution(\'ZServer\')\n-except pkg_resources.DistributionNotFound:\n-    HAS_ZSERVER = False\n-\n-if HAS_ZSERVER:\n     from webdav.NullResource import NullResource\n+except ImportError:\n+    HAS_WEBDAV = False\n \n \n class TestRequestContainer(Explicit):\n@@ -46,7 +43,7 @@ def test_getitem_not_dav_request(self):\n         except KeyError:\n             pass\n \n-    @unittest.skipUnless(HAS_ZSERVER, \'ZServer is optional\')\n+    @unittest.skipUnless(HAS_WEBDAV, \'ZServer is optional\')\n     def test_getitem_dav_request(self):\n         root = TestRequestContainer()\n         folder = CMFOrderedBTreeFolderBase("f1").__of__(root)\n'

