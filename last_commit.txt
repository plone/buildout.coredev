Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2022-08-03T09:04:41+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/4a7f7408f30e1230859ead063ddf1f7395e35242

set portal title in registry when creating a new Plone site

Files changed:
M Products/CMFPlone/factory.py

b'diff --git a/Products/CMFPlone/factory.py b/Products/CMFPlone/factory.py\nindex 395c0e7ae4..56f1b04152 100644\n--- a/Products/CMFPlone/factory.py\n+++ b/Products/CMFPlone/factory.py\n@@ -160,6 +160,7 @@ def addPloneSite(context, site_id, title=\'Plone site\', description=\'\',\n     reg[\'plone.available_timezones\'] = [portal_timezone]\n     reg[\'plone.default_language\'] = default_language\n     reg[\'plone.available_languages\'] = [default_language]\n+    reg[\'plone.site_title\'] = title\n \n     # Install default content types profile if user do not select "example content"\n     # during site creation.\n'

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2022-08-03T09:04:45+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/fd80df42d9149eba31e442d78acba4cc89b051e3

changelog

Files changed:
A news/3584.bugfix

b'diff --git a/news/3584.bugfix b/news/3584.bugfix\nnew file mode 100644\nindex 0000000000..b83dbc1f59\n--- /dev/null\n+++ b/news/3584.bugfix\n@@ -0,0 +1,2 @@\n+Set portal title in registry when creating a new Plone site\n+[erral]\n'

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2022-08-03T09:04:45+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/0f516e6d5716fa0bb05e1978cd64e68ce7a6bb51

test

Files changed:
M Products/CMFPlone/tests/test_factory.py

b'diff --git a/Products/CMFPlone/tests/test_factory.py b/Products/CMFPlone/tests/test_factory.py\nindex e3c776f881..97b08c1780 100644\n--- a/Products/CMFPlone/tests/test_factory.py\n+++ b/Products/CMFPlone/tests/test_factory.py\n@@ -4,6 +4,8 @@\n from Products.CMFPlone.utils import get_installer\n from Products.CMFPlone.testing import PRODUCTS_CMFPLONE_INTEGRATION_TESTING\n from zope.component import queryUtility\n+from zope.component import getUtility\n+from plone.registry.interfaces import IRegistry\n \n import unittest\n \n@@ -54,3 +56,10 @@ def test_site_creation_without_content_but_with_content_types(self):\n         # Folder\n         fti = queryUtility(IDexterityFTI, name=\'Folder\')\n         self.assertIsNotNone(fti)\n+\n+    def test_site_creation_title_is_set_in_registry(self):\n+        """ Plone site title should be stored in registry """\n+        ploneSite = addPloneSite(\n+            self.app, \'ploneFoo\', title=\'Foo\', setup_content=False)\n+        registry = getUtility(IRegistry, context=ploneSite)\n+        self.assertEqual(registry[\'plone.site_title\'], \'Foo\')\n'

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2022-08-03T09:38:49+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/3f3a93ffd320c1735cff0c2cd843c8d03034d827

save as unicode

Files changed:
M Products/CMFPlone/factory.py

b'diff --git a/Products/CMFPlone/factory.py b/Products/CMFPlone/factory.py\nindex 56f1b04152..3e2219b179 100644\n--- a/Products/CMFPlone/factory.py\n+++ b/Products/CMFPlone/factory.py\n@@ -5,6 +5,7 @@\n from Products.CMFPlone.events import SiteManagerCreatedEvent\n from Products.CMFPlone.interfaces import INonInstallable\n from Products.CMFPlone.Portal import PloneSite\n+from Products.CMFPlone.utils import safe_unicode\n from Products.GenericSetup.tool import SetupTool\n from Products.statusmessages.interfaces import IStatusMessage\n from zope.component import queryUtility\n@@ -160,7 +161,7 @@ def addPloneSite(context, site_id, title=\'Plone site\', description=\'\',\n     reg[\'plone.available_timezones\'] = [portal_timezone]\n     reg[\'plone.default_language\'] = default_language\n     reg[\'plone.available_languages\'] = [default_language]\n-    reg[\'plone.site_title\'] = title\n+    reg[\'plone.site_title\'] = safe_unicode(title)\n \n     # Install default content types profile if user do not select "example content"\n     # during site creation.\n'

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2022-08-05T14:43:42+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/22974bd20dcd4a7fee001049ce55f1085dd5446b

Merge pull request #3586 from plone/erral-issue-3584-plone-5.2

Set portal title in registry when creating a Plone site [5.2]

Files changed:
A news/3584.bugfix
M Products/CMFPlone/factory.py
M Products/CMFPlone/tests/test_factory.py

b'diff --git a/Products/CMFPlone/factory.py b/Products/CMFPlone/factory.py\nindex 395c0e7ae4..3e2219b179 100644\n--- a/Products/CMFPlone/factory.py\n+++ b/Products/CMFPlone/factory.py\n@@ -5,6 +5,7 @@\n from Products.CMFPlone.events import SiteManagerCreatedEvent\n from Products.CMFPlone.interfaces import INonInstallable\n from Products.CMFPlone.Portal import PloneSite\n+from Products.CMFPlone.utils import safe_unicode\n from Products.GenericSetup.tool import SetupTool\n from Products.statusmessages.interfaces import IStatusMessage\n from zope.component import queryUtility\n@@ -160,6 +161,7 @@ def addPloneSite(context, site_id, title=\'Plone site\', description=\'\',\n     reg[\'plone.available_timezones\'] = [portal_timezone]\n     reg[\'plone.default_language\'] = default_language\n     reg[\'plone.available_languages\'] = [default_language]\n+    reg[\'plone.site_title\'] = safe_unicode(title)\n \n     # Install default content types profile if user do not select "example content"\n     # during site creation.\ndiff --git a/Products/CMFPlone/tests/test_factory.py b/Products/CMFPlone/tests/test_factory.py\nindex e3c776f881..97b08c1780 100644\n--- a/Products/CMFPlone/tests/test_factory.py\n+++ b/Products/CMFPlone/tests/test_factory.py\n@@ -4,6 +4,8 @@\n from Products.CMFPlone.utils import get_installer\n from Products.CMFPlone.testing import PRODUCTS_CMFPLONE_INTEGRATION_TESTING\n from zope.component import queryUtility\n+from zope.component import getUtility\n+from plone.registry.interfaces import IRegistry\n \n import unittest\n \n@@ -54,3 +56,10 @@ def test_site_creation_without_content_but_with_content_types(self):\n         # Folder\n         fti = queryUtility(IDexterityFTI, name=\'Folder\')\n         self.assertIsNotNone(fti)\n+\n+    def test_site_creation_title_is_set_in_registry(self):\n+        """ Plone site title should be stored in registry """\n+        ploneSite = addPloneSite(\n+            self.app, \'ploneFoo\', title=\'Foo\', setup_content=False)\n+        registry = getUtility(IRegistry, context=ploneSite)\n+        self.assertEqual(registry[\'plone.site_title\'], \'Foo\')\ndiff --git a/news/3584.bugfix b/news/3584.bugfix\nnew file mode 100644\nindex 0000000000..b83dbc1f59\n--- /dev/null\n+++ b/news/3584.bugfix\n@@ -0,0 +1,2 @@\n+Set portal title in registry when creating a new Plone site\n+[erral]\n'

