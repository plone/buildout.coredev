Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2020-08-03T16:13:39+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contenttypes/commit/2dd0be7f0d49852d2acdb0c374b4145981e06229

In the edge case where the meta_type could not be resolved assume is_folderish being false.

Files changed:
A news/567.bugfix
M plone/app/contenttypes/migration/migration.py

b"diff --git a/news/567.bugfix b/news/567.bugfix\nnew file mode 100644\nindex 00000000..77338565\n--- /dev/null\n+++ b/news/567.bugfix\n@@ -0,0 +1,2 @@\n+In the edge case where the meta_type could not be resolved assume is_folderish being false.\n+[pbauer]\n\\ No newline at end of file\ndiff --git a/plone/app/contenttypes/migration/migration.py b/plone/app/contenttypes/migration/migration.py\nindex 4ee3dd64..b9c8894c 100644\n--- a/plone/app/contenttypes/migration/migration.py\n+++ b/plone/app/contenttypes/migration/migration.py\n@@ -524,6 +524,8 @@ def migrateCustomAT(fields_mapping,\n             is_folderish = getattr(src_obj, 'isPrincipiaFolderish', False)\n             src_meta_type = src_obj.meta_type\n     else:\n+        # fallback\n+        is_folderish = False\n         # Get info from at-fti\n         src_meta_type = fti.content_meta_type\n         archetype_tool = getToolByName(portal, 'archetype_tool', None)\n@@ -533,6 +535,7 @@ def migrateCustomAT(fields_mapping,\n             if info.get('meta_type') == src_meta_type:\n                 klass = info.get('klass', None)\n                 is_folderish = klass.isPrincipiaFolderish\n+                break\n \n     migrator = makeCustomATMigrator(context=portal,\n                                     src_type=src_type,\n"

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2020-08-04T13:26:24+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/175e0fbd0f35f5a12d0eee2488f085b0860a3e5f

Merge pull request #567 from plone/custom_migration_edge_case

In the edge case where the meta_type could not be resolved

Files changed:
A news/567.bugfix
M plone/app/contenttypes/migration/migration.py

b"diff --git a/news/567.bugfix b/news/567.bugfix\nnew file mode 100644\nindex 00000000..77338565\n--- /dev/null\n+++ b/news/567.bugfix\n@@ -0,0 +1,2 @@\n+In the edge case where the meta_type could not be resolved assume is_folderish being false.\n+[pbauer]\n\\ No newline at end of file\ndiff --git a/plone/app/contenttypes/migration/migration.py b/plone/app/contenttypes/migration/migration.py\nindex 4ee3dd64..b9c8894c 100644\n--- a/plone/app/contenttypes/migration/migration.py\n+++ b/plone/app/contenttypes/migration/migration.py\n@@ -524,6 +524,8 @@ def migrateCustomAT(fields_mapping,\n             is_folderish = getattr(src_obj, 'isPrincipiaFolderish', False)\n             src_meta_type = src_obj.meta_type\n     else:\n+        # fallback\n+        is_folderish = False\n         # Get info from at-fti\n         src_meta_type = fti.content_meta_type\n         archetype_tool = getToolByName(portal, 'archetype_tool', None)\n@@ -533,6 +535,7 @@ def migrateCustomAT(fields_mapping,\n             if info.get('meta_type') == src_meta_type:\n                 klass = info.get('klass', None)\n                 is_folderish = klass.isPrincipiaFolderish\n+                break\n \n     migrator = makeCustomATMigrator(context=portal,\n                                     src_type=src_type,\n"

