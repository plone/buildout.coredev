Repository: plone.namedfile


Branch: refs/heads/master
Date: 2021-07-09T16:22:29+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.namedfile/commit/0b0cd855f2f0ef006ff8ddad8b04d180a3e55994

Cache stable image scales strongly.

When plone.app.imaging is available, this is already done.
Otherwise, we should do this ourselves.
Fixes https://github.com/plone/plone.namedfile/issues/100.

Files changed:
A news/100.bugfix
M plone/namedfile/scaling.zcml

b'diff --git a/news/100.bugfix b/news/100.bugfix\nnew file mode 100644\nindex 0000000..2d9c017\n--- /dev/null\n+++ b/news/100.bugfix\n@@ -0,0 +1,5 @@\n+Cache stable image scales strongly.\n+When plone.app.imaging is available, this is already done.\n+Otherwise, we should do this ourselves.\n+Fixes `issue 100 <https://github.com/plone/plone.namedfile/issues/100>`_.\n+[maurits]\ndiff --git a/plone/namedfile/scaling.zcml b/plone/namedfile/scaling.zcml\nindex bf76834..e528232 100644\n--- a/plone/namedfile/scaling.zcml\n+++ b/plone/namedfile/scaling.zcml\n@@ -1,5 +1,7 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n+    xmlns:cache="http://namespaces.zope.org/cache"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n     xmlns:browser="http://namespaces.zope.org/browser">\n   <include package="zope.annotation" />\n   <browser:page\n@@ -20,4 +22,21 @@\n       factory=".scaling.DefaultImageScalingFactory"\n       for="*"\n   />\n+\n+  <!-- In plone.app.caching, image scales are weakly cached.\n+       But stable (uid) image scales should be strongly cached.\n+       When plone.app.imaging is available, this is already done.\n+       Otherwise, we should do this ourselves.\n+       See https://github.com/plone/plone.namedfile/issues/100 -->\n+  <configure zcml:condition="not-installed plone.app.imaging">\n+    <configure zcml:condition="installed z3c.caching">\n+      <include package="z3c.caching" />\n+      <include package="z3c.caching" file="meta.zcml" />\n+      <cache:ruleset\n+          for=".interfaces.IStableImageScale"\n+          ruleset="plone.stableResource"\n+          />\n+    </configure>\n+  </configure>\n+\n </configure>\n'

Repository: plone.namedfile


Branch: refs/heads/master
Date: 2021-07-11T11:10:17+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.namedfile/commit/8f92092395da017f103063960816518411e9c58a

Merge pull request #101 from plone/maurits/stable-scales-stable-cache

Cache stable image scales strongly.

Files changed:
A news/100.bugfix
M plone/namedfile/scaling.zcml

b'diff --git a/news/100.bugfix b/news/100.bugfix\nnew file mode 100644\nindex 0000000..2d9c017\n--- /dev/null\n+++ b/news/100.bugfix\n@@ -0,0 +1,5 @@\n+Cache stable image scales strongly.\n+When plone.app.imaging is available, this is already done.\n+Otherwise, we should do this ourselves.\n+Fixes `issue 100 <https://github.com/plone/plone.namedfile/issues/100>`_.\n+[maurits]\ndiff --git a/plone/namedfile/scaling.zcml b/plone/namedfile/scaling.zcml\nindex bf76834..e528232 100644\n--- a/plone/namedfile/scaling.zcml\n+++ b/plone/namedfile/scaling.zcml\n@@ -1,5 +1,7 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n+    xmlns:cache="http://namespaces.zope.org/cache"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n     xmlns:browser="http://namespaces.zope.org/browser">\n   <include package="zope.annotation" />\n   <browser:page\n@@ -20,4 +22,21 @@\n       factory=".scaling.DefaultImageScalingFactory"\n       for="*"\n   />\n+\n+  <!-- In plone.app.caching, image scales are weakly cached.\n+       But stable (uid) image scales should be strongly cached.\n+       When plone.app.imaging is available, this is already done.\n+       Otherwise, we should do this ourselves.\n+       See https://github.com/plone/plone.namedfile/issues/100 -->\n+  <configure zcml:condition="not-installed plone.app.imaging">\n+    <configure zcml:condition="installed z3c.caching">\n+      <include package="z3c.caching" />\n+      <include package="z3c.caching" file="meta.zcml" />\n+      <cache:ruleset\n+          for=".interfaces.IStableImageScale"\n+          ruleset="plone.stableResource"\n+          />\n+    </configure>\n+  </configure>\n+\n </configure>\n'

