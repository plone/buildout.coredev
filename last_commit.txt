Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-07-09T22:45:30+02:00
Author: Timo Stollenwerk (tisto) <tisto@users.noreply.github.com>
Commit: https://github.com/plone/plone.restapi/commit/cec8f442d3725b4d68eff7ac3ab846c39ae9c414

Fix Plone 5.2.x deprecation message 'ILanguageSchema is deprecated'. (#976)

* Fix Plone 5.2.x deprecation message 'ILanguageSchema is deprecated'.

* Fix syntax error and flake8

Co-authored-by: ale-rt &lt;alessandro.pisa@gmail.com&gt;

Files changed:
A news/975.bugfix
M src/plone/restapi/controlpanels/__init__.py

b"diff --git a/news/975.bugfix b/news/975.bugfix\nnew file mode 100644\nindex 000000000..64b2e101f\n--- /dev/null\n+++ b/news/975.bugfix\n@@ -0,0 +1,2 @@\n+Fix Plone 5.2.x deprecation message 'ILanguageSchema is deprecated'.\n+[timo]\n\\ No newline at end of file\ndiff --git a/src/plone/restapi/controlpanels/__init__.py b/src/plone/restapi/controlpanels/__init__.py\nindex 3461a3c36..8585ab2af 100644\n--- a/src/plone/restapi/controlpanels/__init__.py\n+++ b/src/plone/restapi/controlpanels/__init__.py\n@@ -3,7 +3,6 @@\n from Products.CMFPlone.interfaces.controlpanel import IDateAndTimeSchema\n from Products.CMFPlone.interfaces.controlpanel import IEditingSchema\n from Products.CMFPlone.interfaces.controlpanel import IImagingSchema\n-from Products.CMFPlone.interfaces.controlpanel import ILanguageSchema\n from Products.CMFPlone.interfaces.controlpanel import IMailSchema\n from Products.CMFPlone.interfaces.controlpanel import IMarkupSchema\n from Products.CMFPlone.interfaces.controlpanel import INavigationSchema\n@@ -17,6 +16,11 @@\n from zope.publisher.interfaces import NotFound\n from plone.restapi.controlpanels.interfaces import IControlpanel\n \n+try:\n+    from plone.i18n.interfaces import ILanguageSchema\n+except ImportError:  # pragma: no cover\n+    from Products.CMFPlone.interfaces.controlpanel import ILanguageSchema\n+\n \n @implementer(IControlpanel)\n class RegistryConfigletPanel(object):\n"

Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-07-09T22:48:35+02:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/4901c98f983979af6aa936b607c3c3feaee33965

Do not hardcode the port in tests because it may depend on environment variables (#979)

Fixes #978

Files changed:
A news/978.bugfix
M src/plone/restapi/tests/test_services_querystringsearch.py

b'diff --git a/news/978.bugfix b/news/978.bugfix\nnew file mode 100644\nindex 000000000..888293ab2\n--- /dev/null\n+++ b/news/978.bugfix\n@@ -0,0 +1 @@\n+Do not hardcode the port in tests because it may depend on environment variables [ale-rt]\ndiff --git a/src/plone/restapi/tests/test_services_querystringsearch.py b/src/plone/restapi/tests/test_services_querystringsearch.py\nindex f855aa442..7191a5612 100644\n--- a/src/plone/restapi/tests/test_services_querystringsearch.py\n+++ b/src/plone/restapi/tests/test_services_querystringsearch.py\n@@ -165,5 +165,5 @@ def test_querystringsearch_do_not_return_context(self):\n         self.assertEqual(response.json()["items_total"], 1)\n         self.assertEqual(\n             response.json()["items"][0]["@id"],\n-            "http://localhost:55001/plone/testdocument2",\n+            "{}/testdocument2".format(self.portal.absolute_url()),\n         )\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-07-09T23:21:25+02:00
Author: Timo Stollenwerk (tisto) <stollenwerk@kitconcept.com>
Commit: https://github.com/plone/plone.restapi/commit/df7fa7c784c7c2af57fb013e17c133ef2796e78c

Preparing release 6.13.6

Files changed:
M CHANGES.rst
M setup.py
D news/975.bugfix
D news/978.bugfix

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 731618e3a..5c3a50ff6 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -8,6 +8,17 @@ Changelog\n \n .. towncrier release notes start\n \n+6.13.6 (2020-07-09)\n+-------------------\n+\n+Bug fixes:\n+\n+\n+- Fix Plone 5.2.x deprecation message 'ILanguageSchema is deprecated'.\n+  [timo] (#975)\n+- Do not hardcode the port in tests because it may depend on environment variables [ale-rt] (#978)\n+\n+\n 6.13.5 (2020-06-29)\n -------------------\n \ndiff --git a/news/975.bugfix b/news/975.bugfix\ndeleted file mode 100644\nindex 64b2e101f..000000000\n--- a/news/975.bugfix\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-Fix Plone 5.2.x deprecation message 'ILanguageSchema is deprecated'.\n-[timo]\n\\ No newline at end of file\ndiff --git a/news/978.bugfix b/news/978.bugfix\ndeleted file mode 100644\nindex 888293ab2..000000000\n--- a/news/978.bugfix\n+++ /dev/null\n@@ -1 +0,0 @@\n-Do not hardcode the port in tests because it may depend on environment variables [ale-rt]\ndiff --git a/setup.py b/setup.py\nindex 948b2c267..8b928e0f7 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -2,7 +2,7 @@\n \n import sys\n \n-version = '6.13.6.dev0'\n+version = '6.13.6'\n \n \n def read(filename):\n"

Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-07-09T23:21:54+02:00
Author: Timo Stollenwerk (tisto) <stollenwerk@kitconcept.com>
Commit: https://github.com/plone/plone.restapi/commit/d4a0cd861e77a38d3eb0fb88810639b41598ff12

Back to development: 6.13.7

Files changed:
M setup.py

b"diff --git a/setup.py b/setup.py\nindex 8b928e0f7..e625cabcc 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -2,7 +2,7 @@\n \n import sys\n \n-version = '6.13.6'\n+version = '6.13.7.dev0'\n \n \n def read(filename):\n"

Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-07-09T23:37:23+02:00
Author: Timo Stollenwerk (tisto) <stollenwerk@kitconcept.com>
Commit: https://github.com/plone/plone.restapi/commit/086d4d0d6139f76991ee5f44ec9fc3bd6e4c1936

Cleanup changelog

Files changed:
M CHANGES.rst

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 5c3a50ff6..b3918556b 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -44,7 +44,7 @@ Bug fixes:\n Bug fixes:\n \n \n-- - Take the `include_items` parameter into account in `SerializeCollectionToJson`. [gbastien] (#957)\n+- Take the `include_items` parameter into account in `SerializeCollectionToJson`. [gbastien] (#957)\n \n \n 6.13.2 (2020-06-15)\n@@ -53,7 +53,7 @@ Bug fixes:\n Bug fixes:\n \n \n-- - Include plone.app.controlpanel permissions.zcml in database service to avoid ConfigurationExecutionError regarding 'plone.app.controlpanel.Overview' permission while starting Plone 4.3.x [gbastien] (#956)\n+- Include plone.app.controlpanel permissions.zcml in database service to avoid ConfigurationExecutionError regarding 'plone.app.controlpanel.Overview' permission while starting Plone 4.3.x [gbastien] (#956)\n \n \n 6.13.1 (2020-06-03)\n"

Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-07-16T21:54:56+02:00
Author: Fulvio Casali (fulv) <fulviocasali@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/ccaadcc6f6a233697556682ab2f5ab729c5c36a0

Add a converter for Decimal() objects. (#977)

* Add a converter for Decimal() objects.

* Fix tests and py2

* format with %f can still alter the decimal representation, better with str

* Make black happy

Files changed:
A news/963.bugfix
M src/plone/restapi/serializer/configure.zcml
M src/plone/restapi/serializer/converters.py
M src/plone/restapi/tests/test_dxcontent_serializer.py
M src/plone/restapi/tests/test_dxfield_deserializer.py
M src/plone/restapi/tests/test_dxfield_serializer.py

b'diff --git a/news/963.bugfix b/news/963.bugfix\nnew file mode 100644\nindex 000000000..5b63614a8\n--- /dev/null\n+++ b/news/963.bugfix\n@@ -0,0 +1,2 @@\n+- Add a Decimal() converter\n+  [fulv]\ndiff --git a/src/plone/restapi/serializer/configure.zcml b/src/plone/restapi/serializer/configure.zcml\nindex e9244c92a..f22cc0dd1 100644\n--- a/src/plone/restapi/serializer/configure.zcml\n+++ b/src/plone/restapi/serializer/configure.zcml\n@@ -42,6 +42,7 @@\n     </configure>\n \n     <adapter factory=".converters.date_converter" />\n+    <adapter factory=".converters.decimal_converter" />\n     <adapter factory=".converters.default_converter" />\n     <adapter factory=".converters.dict_converter" />\n     <adapter factory=".converters.frozenset_converter" />\ndiff --git a/src/plone/restapi/serializer/converters.py b/src/plone/restapi/serializer/converters.py\nindex cf1e18ecd..b3aaaa4c9 100644\n--- a/src/plone/restapi/serializer/converters.py\n+++ b/src/plone/restapi/serializer/converters.py\n@@ -4,6 +4,7 @@\n from datetime import time\n from datetime import timedelta\n from DateTime import DateTime\n+from decimal import Decimal\n from persistent.list import PersistentList\n from persistent.mapping import PersistentMapping\n from plone.app.textfield.interfaces import IRichTextValue\n@@ -86,6 +87,12 @@ def default_converter(value):\n     )\n \n \n+@adapter(Decimal)\n+@implementer(IJsonCompatible)\n+def decimal_converter(value):\n+    return safe_unicode(str(value))\n+\n+\n @adapter(bytes)\n @implementer(IJsonCompatible)\n def bytes_converter(value):\ndiff --git a/src/plone/restapi/tests/test_dxcontent_serializer.py b/src/plone/restapi/tests/test_dxcontent_serializer.py\nindex f4bc38c3b..6b169c330 100644\n--- a/src/plone/restapi/tests/test_dxcontent_serializer.py\n+++ b/src/plone/restapi/tests/test_dxcontent_serializer.py\n@@ -4,6 +4,7 @@\n from datetime import time\n from datetime import timedelta\n from DateTime import DateTime\n+from decimal import Decimal\n from plone import api\n from plone.app.discussion.interfaces import IDiscussionSettings\n from plone.app.testing import logout\n@@ -68,7 +69,7 @@ def setUp(self):\n             test_choice_field=u"foo",\n             test_date_field=date(2015, 7, 15),\n             test_datetime_field=datetime(2015, 6, 20, 13, 22, 4),\n-            test_decimal_field="1.1",\n+            test_decimal_field=Decimal(1.1),\n             test_dict_field={"foo": "bar", "spam": "eggs", "1": 1},\n             test_float_field=1.5,\n             test_frozenset_field=frozenset([1, 2, 3]),\ndiff --git a/src/plone/restapi/tests/test_dxfield_deserializer.py b/src/plone/restapi/tests/test_dxfield_deserializer.py\nindex a67949055..46ee9d9b7 100644\n--- a/src/plone/restapi/tests/test_dxfield_deserializer.py\n+++ b/src/plone/restapi/tests/test_dxfield_deserializer.py\n@@ -177,10 +177,10 @@ def test_datetime_deserialization_required(self):\n             with self.assertRaises(RequiredMissing):\n                 self.deserialize(field_name, None)\n \n-    def test_decimal_deserialization_returns_decimal(self):\n+    def test_text_deserialization_returns_decimal(self):\n         value = self.deserialize("test_decimal_field", u"1.1")\n         self.assertTrue(isinstance(value, Decimal), "Not a <Decimal>")\n-        self.assertEqual(Decimal("1.1"), value)\n+        self.assertEqual(Decimal(u"1.1"), value)\n \n     def test_dict_deserialization_returns_dict(self):\n         value = self.deserialize("test_dict_field", {u"key": u"value"})\ndiff --git a/src/plone/restapi/tests/test_dxfield_serializer.py b/src/plone/restapi/tests/test_dxfield_serializer.py\nindex 8b0ecf70a..604019146 100644\n--- a/src/plone/restapi/tests/test_dxfield_serializer.py\n+++ b/src/plone/restapi/tests/test_dxfield_serializer.py\n@@ -3,6 +3,7 @@\n from datetime import datetime\n from datetime import time\n from datetime import timedelta\n+from decimal import Decimal\n from mock import patch\n from plone.app.textfield.value import RichTextValue\n from plone.dexterity.utils import iterSchemata\n@@ -107,7 +108,7 @@ def test_datetime_field_serialization_returns_unicode(self):\n         self.assertEqual(u"2015-06-20T13:22:04", value)\n \n     def test_decimal_field_serialization_returns_unicode(self):\n-        value = self.serialize("test_decimal_field", "1.1")\n+        value = self.serialize("test_decimal_field", Decimal(u"1.1"))\n         self.assertTrue(isinstance(value, six.text_type), "Not an <unicode>")\n         self.assertEqual(u"1.1", value)\n \n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-07-16T21:55:36+02:00
Author: Timo Stollenwerk (tisto) <stollenwerk@kitconcept.com>
Commit: https://github.com/plone/plone.restapi/commit/d2cc3643ec8c40e4fb037c9efd014837874ffe46

Preparing release 6.13.7

Files changed:
M CHANGES.rst
M setup.py
D news/963.bugfix

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex b3918556b..5ec63d614 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -8,6 +8,16 @@ Changelog\n \n .. towncrier release notes start\n \n+6.13.7 (2020-07-16)\n+-------------------\n+\n+Bug fixes:\n+\n+\n+- - Add a Decimal() converter\n+    [fulv] (#963)\n+\n+\n 6.13.6 (2020-07-09)\n -------------------\n \ndiff --git a/news/963.bugfix b/news/963.bugfix\ndeleted file mode 100644\nindex 5b63614a8..000000000\n--- a/news/963.bugfix\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-- Add a Decimal() converter\n-  [fulv]\ndiff --git a/setup.py b/setup.py\nindex e625cabcc..81248df01 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -2,7 +2,7 @@\n \n import sys\n \n-version = '6.13.7.dev0'\n+version = '6.13.7'\n \n \n def read(filename):\n"

Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-07-16T21:56:11+02:00
Author: Timo Stollenwerk (tisto) <stollenwerk@kitconcept.com>
Commit: https://github.com/plone/plone.restapi/commit/21e946af4e9ca777cd89caec03f66e3c850bb6c0

Back to development: 6.13.8

Files changed:
M setup.py

b"diff --git a/setup.py b/setup.py\nindex 81248df01..f79aed47d 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -2,7 +2,7 @@\n \n import sys\n \n-version = '6.13.7'\n+version = '6.13.8.dev0'\n \n \n def read(filename):\n"

Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-07-16T21:58:08+02:00
Author: Timo Stollenwerk (tisto) <stollenwerk@kitconcept.com>
Commit: https://github.com/plone/plone.restapi/commit/06522d85b5f2a1c3379552db9aa05cd92880fee2

Merge branch '6.x.x'

Files changed:
M CHANGES.rst

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex fde4713f4..dce93a738 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -62,6 +62,27 @@ New features:\n   [buchi,timo,cekk] (#808)\n \n \n+6.13.7 (2020-07-16)\n+-------------------\n+\n+Bug fixes:\n+\n+\n+- - Add a Decimal() converter\n+    [fulv] (#963)\n+\n+\n+6.13.6 (2020-07-09)\n+-------------------\n+\n+Bug fixes:\n+\n+\n+- Fix Plone 5.2.x deprecation message 'ILanguageSchema is deprecated'.\n+  [timo] (#975)\n+- Do not hardcode the port in tests because it may depend on environment variables [ale-rt] (#978)\n+\n+\n 6.13.5 (2020-06-29)\n -------------------\n \n@@ -95,6 +116,10 @@ Bug fixes:\n \n Bug fixes:\n \n+<<<<<<< HEAD\n+=======\n+\n+>>>>>>> 6.x.x\n - Include plone.app.controlpanel permissions.zcml in database service to avoid ConfigurationExecutionError regarding 'plone.app.controlpanel.Overview' permission while starting Plone 4.3.x [gbastien] (#956)\n \n \n"

