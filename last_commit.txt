Repository: plone.restapi


Branch: refs/heads/main
Date: 2024-01-05T16:54:11-08:00
Author: Wesley Barroso Lopes (wesleybl) <wesleybl@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/16325f20b927f28ff03762687862dcaea9944da5

Give Site Administrator permission to manage users (#1712)

* Give Site Administrator permission to manage users

Permission of related endpoints changed from cmf.ManagePortal to
plone.app.controlpanel.UsersAndGroups. It was also necessary to give
Manage users and plone.restapi: Access Plone user information
permissions to the Site Administrator.

* Does not allow a Site Administrator to set a Manager role

* Does not allow a Site Administrator delete Manager

* Test that the Site Administrator cannot add a Manager

* Do not allow a Site Administrator user to add users to groups that have
the Manager role

* Do not allow the Site Administrator to set the Manager role for a group

* Do not allow the Site Administrator to create groups with the Manager
role

* Does not allow an Site Administrator add group to group with Manager
role

* Do not allow Site Administrator to delete group with Manager role

* Add can_assign and can_assign_add keys to the roles endpoint

This is to inform the front-end whether role assignment should be
allowed or not. It was necessary to create the can_assign_add key,
because a user can only create another with the roles they have. But in
editing he can assign other roles.

* Add can_delete key to the users endpoint

Used to backend hide remove user button if user cannot be removed by
currently authenticated user

* Add can_delete key to the groups endpoint

Used to backend hide remove group button if group cannot be removed by
currently authenticated user

* Does not allow a Site Administrator to change a Manager's email and
password

* Update examples in documentation

* Uses acl_users.userFolderDelUsers to delete users

Therefore, it is not necessary to give Manage users permission to the
Site Administrator.

* Simplifies logic that defines whether the user can update roles

* Show message on lack of permission errors

* Set default roles as list

This prevents '"Manager" in roles' breaking if roles was missing

* Quote the plone.app.controlpanel.UsersAndGroups permission in changes

* Remove can_assign_add key

* Add upgrade step

Upgrade step to give permission plone.restapi: Access Plone user
information to Site Administrator

* Define can_delete in group serializer

* Define can_delete in users serializer

* Shows the can_delete key in the users and groups serializer only if the
user has "Plone Site Setup: Users and Groups" permission

* Rename ManageUsers to PloneManageUsers

* Uses PloneManageUsers variable instead of the string

* Remove can_delete key from users/groups endpoints

* Remove can_assign key from roles endpoint

* remove unused function

---------

Co-authored-by: David Glick &lt;david@glicksoftware.com&gt;

Files changed:
A news/1712.feature
A src/plone/restapi/tests/test_services_roles.py
A src/plone/restapi/upgrades/to0007.py
M src/plone/restapi/locales/de/LC_MESSAGES/plone.restapi.po
M src/plone/restapi/locales/es/LC_MESSAGES/plone.restapi.po
M src/plone/restapi/locales/fr/LC_MESSAGES/plone.restapi.po
M src/plone/restapi/locales/plone.restapi.pot
M src/plone/restapi/locales/pt_BR/LC_MESSAGES/plone.restapi.po
M src/plone/restapi/permissions.py
M src/plone/restapi/profiles/default/metadata.xml
M src/plone/restapi/profiles/default/rolemap.xml
M src/plone/restapi/serializer/utils.py
M src/plone/restapi/services/groups/add.py
M src/plone/restapi/services/groups/configure.zcml
M src/plone/restapi/services/groups/delete.py
M src/plone/restapi/services/groups/update.py
M src/plone/restapi/services/roles/configure.zcml
M src/plone/restapi/services/users/add.py
M src/plone/restapi/services/users/configure.zcml
M src/plone/restapi/services/users/delete.py
M src/plone/restapi/services/users/get.py
M src/plone/restapi/services/users/update.py
M src/plone/restapi/tests/http-examples/translated_messages_addons.resp
M src/plone/restapi/tests/test_addons.py
M src/plone/restapi/tests/test_serializer_group.py
M src/plone/restapi/tests/test_serializer_user.py
M src/plone/restapi/tests/test_services_groups.py
M src/plone/restapi/tests/test_services_users.py
M src/plone/restapi/tests/test_upgrades.py
M src/plone/restapi/upgrades/configure.zcml
D src/plone/restapi/tests/test_roles.py

b'diff --git a/news/1712.feature b/news/1712.feature\nnew file mode 100644\nindex 0000000000..b3c588cf81\n--- /dev/null\n+++ b/news/1712.feature\n@@ -0,0 +1 @@\n+Give Site Administrator permission to manage users. To make this possible, we now check the "plone.app.controlpanel.UsersAndGroups" permission instead of "cmf.ManagePortal" in a lot of operations in the users and groups endpoints. @wesleybl\ndiff --git a/src/plone/restapi/locales/de/LC_MESSAGES/plone.restapi.po b/src/plone/restapi/locales/de/LC_MESSAGES/plone.restapi.po\nindex 4a2b3ccf9a..0a4c1ec545 100644\n--- a/src/plone/restapi/locales/de/LC_MESSAGES/plone.restapi.po\n+++ b/src/plone/restapi/locales/de/LC_MESSAGES/plone.restapi.po\n@@ -1,7 +1,7 @@\n msgid ""\n msgstr ""\n "Project-Id-Version: PACKAGE VERSION\\n"\n-"POT-Creation-Date: 2022-12-29 15:58+0000\\n"\n+"POT-Creation-Date: 2023-09-25 20:32+0000\\n"\n "PO-Revision-Date: YEAR-MO-DA HO:MI +ZONE\\n"\n "Last-Translator: Timo Stollenwerk <tisto@plone.org>\\n"\n "Language-Team: German <DE@li.org>\\n"\n@@ -14,11 +14,11 @@ msgstr ""\n "Preferred-Encodings: utf-8 latin1\\n"\n "Domain: plone.restapi\\n"\n \n-#: plone/restapi/services/email_send/post.py:81\n+#: plone/restapi/services/email_send/post.py:88\n msgid "${sender_fullname} via ${portal_title}"\n msgstr "${sender_fullname} via ${portal_title}"\n \n-#: plone/restapi/services/email_send/post.py:74\n+#: plone/restapi/services/email_send/post.py:81\n msgid "A portal user via ${portal_title}"\n msgstr "Ein Portal Nutzer via ${portal_title}"\n \n@@ -34,23 +34,23 @@ msgstr ""\n msgid "Adds sample workflows for testing"\n msgstr ""\n \n-#: plone/restapi/services/aliases/add.py:106\n+#: plone/restapi/services/aliases/add.py:107\n msgid "Alternative urls that point to themselves will cause an endless cycle of redirects."\n msgstr ""\n \n-#: plone/restapi/configure.zcml:115\n+#: plone/restapi/configure.zcml:116\n msgid "Blocks"\n msgstr ""\n \n-#: plone/restapi/configure.zcml:122\n+#: plone/restapi/configure.zcml:123\n msgid "Blocks (Editable Layout)"\n msgstr ""\n \n-#: plone/restapi/configure.zcml:122\n+#: plone/restapi/configure.zcml:123\n msgid "Enables Volto Blocks (editable layout) support"\n msgstr ""\n \n-#: plone/restapi/configure.zcml:115\n+#: plone/restapi/configure.zcml:116\n msgid "Enables Volto Blocks support"\n msgstr ""\n \n@@ -58,7 +58,7 @@ msgstr ""\n msgid "Enables blocks on the Document content type"\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:133\n+#: plone/restapi/services/contextnavigation/get.py:136\n msgid "Enter a valid scale name (see \'Image Handling\' control panel) to override (e.g. icon, tile, thumb, mini, preview, ... ). Leave empty to use default (see \'Site\' control panel)."\n msgstr ""\n \n@@ -67,15 +67,15 @@ msgid "Error in fields. ${errors_to_string}"\n msgstr ""\n \n #. Default: "The reset_token is expired."\n-#: plone/restapi/services/users/add.py:312\n+#: plone/restapi/services/users/add.py:319\n msgid "Expired Token"\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:126\n+#: plone/restapi/services/contextnavigation/get.py:129\n msgid "If enabled, the portlet will not show document type icons."\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:145\n+#: plone/restapi/services/contextnavigation/get.py:148\n msgid "If enabled, the portlet will not show thumbs."\n msgstr ""\n \n@@ -91,11 +91,11 @@ msgstr ""\n msgid "Layout"\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:195\n+#: plone/restapi/services/contextnavigation/get.py:197\n msgid "Navigation"\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:132\n+#: plone/restapi/services/contextnavigation/get.py:135\n msgid "Override thumb scale"\n msgstr ""\n \n@@ -123,23 +123,23 @@ msgstr ""\n msgid "Roles"\n msgstr ""\n \n-#: plone/restapi/services/users/add.py:350\n+#: plone/restapi/services/users/add.py:357\n msgid "See the user endpoint documentation for the valid parameters."\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:125\n+#: plone/restapi/services/contextnavigation/get.py:128\n msgid "Suppress Icons"\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:144\n+#: plone/restapi/services/contextnavigation/get.py:147\n msgid "Suppress thumbs"\n msgstr ""\n \n-#: plone/restapi/services/users/add.py:342\n+#: plone/restapi/services/users/add.py:349\n msgid "The password passed as \'old_password\' is wrong."\n msgstr ""\n \n-#: plone/restapi/services/users/add.py:307\n+#: plone/restapi/services/users/add.py:314\n msgid "The reset_token is unknown/not valid."\n msgstr ""\n \n@@ -147,11 +147,11 @@ msgstr ""\n msgid "Volto Blocks"\n msgstr ""\n \n-#: plone/restapi/services/users/update.py:119\n+#: plone/restapi/services/users/update.py:151\n msgid "You are not authorized to perform this action"\n msgstr ""\n \n-#: plone/restapi/services/email_send/post.py:91\n+#: plone/restapi/services/email_send/post.py:98\n msgid "You are receiving this mail because ${sender_fullname} sent this message via the site ${portal_title}:"\n msgstr "Sie erhalten diese E-Mail, weil Ihnen ${sender_fullname} diese Nachricht \xc3\xbcber die Webseite ${portal_title} geschickt hat:"\n \n@@ -159,14 +159,22 @@ msgstr "Sie erhalten diese E-Mail, weil Ihnen ${sender_fullname} diese Nachricht\n msgid "You can\'t send both password and sendPasswordReset."\n msgstr ""\n \n-#: plone/restapi/services/users/add.py:322\n+#: plone/restapi/services/users/add.py:329\n msgid "You can\'t set a password without a password reset token."\n msgstr ""\n \n-#: plone/restapi/services/users/update.py:125\n+#: plone/restapi/services/users/update.py:120\n+msgid "You can\'t update roles of this user"\n+msgstr ""\n+\n+#: plone/restapi/services/users/update.py:157\n msgid "You can\'t update the properties of this user"\n msgstr ""\n \n+#: plone/restapi/services/users/update.py:94\n+msgid "You can\'t update this user"\n+msgstr ""\n+\n #: plone/restapi/services/users/add.py:284\n msgid "You can\'t use \'reset_token\' and \'old_password\' together."\n msgstr ""\n@@ -179,72 +187,72 @@ msgstr ""\n msgid "You need AddPortalMember permission."\n msgstr ""\n \n-#: plone/restapi/services/users/add.py:329\n+#: plone/restapi/services/users/add.py:336\n msgid "You need to be logged in as the user \'${username}\' to set the password."\n msgstr ""\n \n #. Default: "Missing dependency"\n-#: plone/restapi/services/addons/addons.py:207\n+#: plone/restapi/services/addons/addons.py:212\n msgid "dependency_missing"\n msgstr ""\n \n #. Default: "If selected, the navigation tree will only show the current folder and its children at all times."\n-#: plone/restapi/services/contextnavigation/get.py:84\n+#: plone/restapi/services/contextnavigation/get.py:87\n msgid "help_current_folder_only"\n msgstr ""\n \n #. Default: "Whether or not to show the top, or \'root\', node in the navigation tree. This is affected by the \'Start level\' setting."\n-#: plone/restapi/services/contextnavigation/get.py:69\n+#: plone/restapi/services/contextnavigation/get.py:72\n msgid "help_include_top_node"\n msgstr ""\n \n #. Default: "You may search for and choose a folder to act as the root of the navigation tree. Leave blank to use the Plone site root."\n-#: plone/restapi/services/contextnavigation/get.py:58\n+#: plone/restapi/services/contextnavigation/get.py:61\n msgid "help_navigation_root"\n msgstr ""\n \n #. Default: "An integer value that specifies the number of folder levels below the site root that must be exceeded before the navigation tree will display. 0 means that the navigation tree should be displayed everywhere including pages in the root of the site. 1 means the tree only shows up inside folders located in the root and downwards, never showing at the top level."\n-#: plone/restapi/services/contextnavigation/get.py:96\n+#: plone/restapi/services/contextnavigation/get.py:99\n msgid "help_navigation_start_level"\n msgstr ""\n \n #. Default: "The title of the navigation tree."\n-#: plone/restapi/services/contextnavigation/get.py:49\n+#: plone/restapi/services/contextnavigation/get.py:52\n msgid "help_navigation_title"\n msgstr ""\n \n #. Default: "How many folders should be included before the navigation tree stops. 0 means no limit. 1 only includes the root folder."\n-#: plone/restapi/services/contextnavigation/get.py:113\n+#: plone/restapi/services/contextnavigation/get.py:116\n msgid "help_navigation_tree_depth"\n msgstr ""\n \n #. Default: "Only show the contents of the current folder."\n-#: plone/restapi/services/contextnavigation/get.py:80\n+#: plone/restapi/services/contextnavigation/get.py:83\n msgid "label_current_folder_only"\n msgstr ""\n \n #. Default: "Include top node"\n-#: plone/restapi/services/contextnavigation/get.py:68\n+#: plone/restapi/services/contextnavigation/get.py:71\n msgid "label_include_top_node"\n msgstr ""\n \n #. Default: "Root node"\n-#: plone/restapi/services/contextnavigation/get.py:57\n+#: plone/restapi/services/contextnavigation/get.py:60\n msgid "label_navigation_root_path"\n msgstr ""\n \n #. Default: "Start level"\n-#: plone/restapi/services/contextnavigation/get.py:95\n+#: plone/restapi/services/contextnavigation/get.py:98\n msgid "label_navigation_startlevel"\n msgstr ""\n \n #. Default: "Title"\n-#: plone/restapi/services/contextnavigation/get.py:48\n+#: plone/restapi/services/contextnavigation/get.py:51\n msgid "label_navigation_title"\n msgstr ""\n \n #. Default: "Navigation tree depth"\n-#: plone/restapi/services/contextnavigation/get.py:112\n+#: plone/restapi/services/contextnavigation/get.py:115\n msgid "label_navigation_tree_depth"\n msgstr ""\n \ndiff --git a/src/plone/restapi/locales/es/LC_MESSAGES/plone.restapi.po b/src/plone/restapi/locales/es/LC_MESSAGES/plone.restapi.po\nindex b957833eec..6510309a30 100644\n--- a/src/plone/restapi/locales/es/LC_MESSAGES/plone.restapi.po\n+++ b/src/plone/restapi/locales/es/LC_MESSAGES/plone.restapi.po\n@@ -4,11 +4,10 @@\n msgid ""\n msgstr ""\n "Project-Id-Version: Plone\\n"\n-"POT-Creation-Date: 2019-12-09 10:14+0000\\n"\n+"POT-Creation-Date: 2023-09-25 20:32+0000\\n"\n "PO-Revision-Date: 2023-08-23 21:19-0400\\n"\n "Last-Translator: Leonardo J. Caballero G. <leonardocaballero@gmail.com>\\n"\n "Language-Team: ES <LL@li.org>\\n"\n-"Language: es\\n"\n "MIME-Version: 1.0\\n"\n "Content-Type: text/plain; charset=UTF-8\\n"\n "Content-Transfer-Encoding: 8bit\\n"\n@@ -17,14 +16,15 @@ msgstr ""\n "Language-Name: Espa\xc3\xb1ol\\n"\n "Preferred-Encodings: utf-8 latin1\\n"\n "Domain: plone.restapi\\n"\n+"Language: es\\n"\n "X-Generator: Poedit 3.3.2\\n"\n "X-Is-Fallback-For: es-ar es-bo es-cl es-co es-cr es-do es-ec es-es es-sv es-gt es-hn es-mx es-ni es-pa es-py es-pe es-pr es-us es-uy es-ve\\n"\n \n-#: plone/restapi/services/email_send/post.py:81\n+#: plone/restapi/services/email_send/post.py:88\n msgid "${sender_fullname} via ${portal_title}"\n msgstr "${sender_fullname} v\xc3\xada ${portal_title}"\n \n-#: plone/restapi/services/email_send/post.py:74\n+#: plone/restapi/services/email_send/post.py:81\n msgid "A portal user via ${portal_title}"\n msgstr "Un usuario de portal user v\xc3\xada ${portal_title}"\n \n@@ -40,23 +40,23 @@ msgstr "A\xc3\xb1adir tipos de contenido de ejemplo para pruebas"\n msgid "Adds sample workflows for testing"\n msgstr "A\xc3\xb1adir flujos de trabajo de muestra para realizar pruebas"\n \n-#: plone/restapi/services/aliases/add.py:106\n+#: plone/restapi/services/aliases/add.py:107\n msgid "Alternative urls that point to themselves will cause an endless cycle of redirects."\n msgstr "Las URL alternativas que apuntan a s\xc3\xad mismas provocar\xc3\xa1n un bucle interminable de redireccionamientos."\n \n-#: plone/restapi/configure.zcml:115\n+#: plone/restapi/configure.zcml:116\n msgid "Blocks"\n msgstr "Bloques"\n \n-#: plone/restapi/configure.zcml:122\n+#: plone/restapi/configure.zcml:123\n msgid "Blocks (Editable Layout)"\n msgstr "Bloques (Dise\xc3\xb1o editable)"\n \n-#: plone/restapi/configure.zcml:122\n+#: plone/restapi/configure.zcml:123\n msgid "Enables Volto Blocks (editable layout) support"\n msgstr "Habilita el soporte para bloques Volto (dise\xc3\xb1o editable)"\n \n-#: plone/restapi/configure.zcml:115\n+#: plone/restapi/configure.zcml:116\n msgid "Enables Volto Blocks support"\n msgstr "Habilitar soporte a Bloques Volto"\n \n@@ -64,7 +64,7 @@ msgstr "Habilitar soporte a Bloques Volto"\n msgid "Enables blocks on the Document content type"\n msgstr "Habilitar bloques en el tipo de contenido Documento"\n \n-#: plone/restapi/services/contextnavigation/get.py:133\n+#: plone/restapi/services/contextnavigation/get.py:136\n msgid "Enter a valid scale name (see \'Image Handling\' control panel) to override (e.g. icon, tile, thumb, mini, preview, ... ). Leave empty to use default (see \'Site\' control panel)."\n msgstr "Introducir un nombre de escala v\xc3\xa1lido (consulte \'Manipulaci\xc3\xb3n de im\xc3\xa1genes\' en el panel de control) para anular (por ejemplo, icon, tile, thumb, mini, preview...). D\xc3\xa9jelo en blanco para usar el valor predeterminado (consulte \'Sitio\' en el panel de control)."\n \n@@ -73,15 +73,15 @@ msgid "Error in fields. ${errors_to_string}"\n msgstr "Errores en los campos. ${errors_to_string}"\n \n #. Default: "The reset_token is expired."\n-#: plone/restapi/services/users/add.py:312\n+#: plone/restapi/services/users/add.py:319\n msgid "Expired Token"\n msgstr "Token caducado"\n \n-#: plone/restapi/services/contextnavigation/get.py:126\n+#: plone/restapi/services/contextnavigation/get.py:129\n msgid "If enabled, the portlet will not show document type icons."\n msgstr "Si est\xc3\xa1 habilitado, el portlet no mostrar\xc3\xa1 los iconos de tipo de contenido."\n \n-#: plone/restapi/services/contextnavigation/get.py:145\n+#: plone/restapi/services/contextnavigation/get.py:148\n msgid "If enabled, the portlet will not show thumbs."\n msgstr "Si est\xc3\xa1 habilitado, el portlet no mostrar\xc3\xa1 miniaturas."\n \n@@ -97,11 +97,11 @@ msgstr "Si introduce \'Restablecer token\' debe ingresar \'Nueva contrase\xc3\xb1a\'"\n msgid "Layout"\n msgstr "Dise\xc3\xb1o"\n \n-#: plone/restapi/services/contextnavigation/get.py:195\n+#: plone/restapi/services/contextnavigation/get.py:197\n msgid "Navigation"\n msgstr "Navegaci\xc3\xb3n"\n \n-#: plone/restapi/services/contextnavigation/get.py:132\n+#: plone/restapi/services/contextnavigation/get.py:135\n msgid "Override thumb scale"\n msgstr "Anular escala de miniaturas"\n \n@@ -129,23 +129,23 @@ msgstr "Revertido para revisi\xc3\xb3n ${version}"\n msgid "Roles"\n msgstr "Roles"\n \n-#: plone/restapi/services/users/add.py:350\n+#: plone/restapi/services/users/add.py:357\n msgid "See the user endpoint documentation for the valid parameters."\n msgstr "Consulte la documentaci\xc3\xb3n del usuario del terminal para conocer los par\xc3\xa1metros v\xc3\xa1lidos."\n \n-#: plone/restapi/services/contextnavigation/get.py:125\n+#: plone/restapi/services/contextnavigation/get.py:128\n msgid "Suppress Icons"\n msgstr "Suprimir iconos"\n \n-#: plone/restapi/services/contextnavigation/get.py:144\n+#: plone/restapi/services/contextnavigation/get.py:147\n msgid "Suppress thumbs"\n msgstr "Suprimir miniaturas"\n \n-#: plone/restapi/services/users/add.py:342\n+#: plone/restapi/services/users/add.py:349\n msgid "The password passed as \'old_password\' is wrong."\n msgstr "La contrase\xc3\xb1a pasada como \\"Contrase\xc3\xb1a anterior\\" no es v\xc3\xa1lida."\n \n-#: plone/restapi/services/users/add.py:307\n+#: plone/restapi/services/users/add.py:314\n msgid "The reset_token is unknown/not valid."\n msgstr "El reset_token es desconocido/no v\xc3\xa1lido."\n \n@@ -153,11 +153,11 @@ msgstr "El reset_token es desconocido/no v\xc3\xa1lido."\n msgid "Volto Blocks"\n msgstr "Bloques Volto"\n \n-#: plone/restapi/services/users/update.py:119\n+#: plone/restapi/services/users/update.py:151\n msgid "You are not authorized to perform this action"\n msgstr "No est\xc3\xa1 autorizado a realizar esta acci\xc3\xb3n."\n \n-#: plone/restapi/services/email_send/post.py:91\n+#: plone/restapi/services/email_send/post.py:98\n msgid "You are receiving this mail because ${sender_fullname} sent this message via the site ${portal_title}:"\n msgstr "Est\xc3\xa1 recibiendo este correo porque ${sender_fullname} envi\xc3\xb3 este mensaje a trav\xc3\xa9s del sitio ${portal_title}:"\n \n@@ -165,14 +165,22 @@ msgstr "Est\xc3\xa1 recibiendo este correo porque ${sender_fullname} envi\xc3\xb3 este mensa\n msgid "You can\'t send both password and sendPasswordReset."\n msgstr "No puede enviar la contrase\xc3\xb1a y \'Enviar un correo electr\xc3\xb3nico de confirmaci\xc3\xb3n con un enlace para establecer la contrase\xc3\xb1a\'."\n \n-#: plone/restapi/services/users/add.py:322\n+#: plone/restapi/services/users/add.py:329\n msgid "You can\'t set a password without a password reset token."\n msgstr "No puede establecer una contrase\xc3\xb1a sin un token de restablecimiento de contrase\xc3\xb1a."\n \n-#: plone/restapi/services/users/update.py:125\n+#: plone/restapi/services/users/update.py:120\n+msgid "You can\'t update roles of this user"\n+msgstr ""\n+\n+#: plone/restapi/services/users/update.py:157\n msgid "You can\'t update the properties of this user"\n msgstr "No puede actualizar las propiedades de este usuario."\n \n+#: plone/restapi/services/users/update.py:94\n+msgid "You can\'t update this user"\n+msgstr ""\n+\n #: plone/restapi/services/users/add.py:284\n msgid "You can\'t use \'reset_token\' and \'old_password\' together."\n msgstr "No puede utilizar \'Restablecer token\' y \'Contrase\xc3\xb1a anterior\' juntas."\n@@ -185,72 +193,72 @@ msgstr "Debe enviar una contrase\xc3\xb1a o \'Enviar un correo electr\xc3\xb3nico de confirma\n msgid "You need AddPortalMember permission."\n msgstr "Necesita el permiso AddPortalMember."\n \n-#: plone/restapi/services/users/add.py:329\n+#: plone/restapi/services/users/add.py:336\n msgid "You need to be logged in as the user \'${username}\' to set the password."\n msgstr "Debe iniciar sesi\xc3\xb3n como usuario \'${username}\' para poder establecer la contrase\xc3\xb1a."\n \n #. Default: "Missing dependency"\n-#: plone/restapi/services/addons/addons.py:207\n+#: plone/restapi/services/addons/addons.py:212\n msgid "dependency_missing"\n msgstr "Dependencia faltante"\n \n #. Default: "If selected, the navigation tree will only show the current folder and its children at all times."\n-#: plone/restapi/services/contextnavigation/get.py:84\n+#: plone/restapi/services/contextnavigation/get.py:87\n msgid "help_current_folder_only"\n msgstr "Si se selecciona, el \xc3\xa1rbol de navegaci\xc3\xb3n siempre mostrar\xc3\xa1 solo la carpeta actual y sus hijos."\n \n #. Default: "Whether or not to show the top, or \'root\', node in the navigation tree. This is affected by the \'Start level\' setting."\n-#: plone/restapi/services/contextnavigation/get.py:69\n+#: plone/restapi/services/contextnavigation/get.py:72\n msgid "help_include_top_node"\n msgstr "Si el nodo superior, o \'ra\xc3\xadz\', debe mostrarse o no en el \xc3\xa1rbol de navegaci\xc3\xb3n. Esto se ve afectado por la configuraci\xc3\xb3n del \'Nivel inicial\'."\n \n #. Default: "You may search for and choose a folder to act as the root of the navigation tree. Leave blank to use the Plone site root."\n-#: plone/restapi/services/contextnavigation/get.py:58\n+#: plone/restapi/services/contextnavigation/get.py:61\n msgid "help_navigation_root"\n msgstr "Puede buscar y seleccionar una carpeta para que act\xc3\xbae como ra\xc3\xadz del \xc3\xa1rbol de navegaci\xc3\xb3n. D\xc3\xa9jelo en blanco para usar la ra\xc3\xadz del sitio Plone."\n \n #. Default: "An integer value that specifies the number of folder levels below the site root that must be exceeded before the navigation tree will display. 0 means that the navigation tree should be displayed everywhere including pages in the root of the site. 1 means the tree only shows up inside folders located in the root and downwards, never showing at the top level."\n-#: plone/restapi/services/contextnavigation/get.py:96\n+#: plone/restapi/services/contextnavigation/get.py:99\n msgid "help_navigation_start_level"\n msgstr "Un valor entero que especifica el n\xc3\xbamero de niveles de carpeta debajo de la ra\xc3\xadz del sitio que se deben exceder antes de que se muestre el \xc3\xa1rbol de navegaci\xc3\xb3n. 0 significa que el \xc3\xa1rbol de navegaci\xc3\xb3n debe mostrarse en cualquier lugar, incluidas las p\xc3\xa1ginas en la ra\xc3\xadz del sitio. 1 significa que el \xc3\xa1rbol solo aparecer\xc3\xa1 dentro de las carpetas ubicadas en la ra\xc3\xadz y debajo de ella, y nunca aparecer\xc3\xa1 en el nivel ra\xc3\xadz."\n \n #. Default: "The title of the navigation tree."\n-#: plone/restapi/services/contextnavigation/get.py:49\n+#: plone/restapi/services/contextnavigation/get.py:52\n msgid "help_navigation_title"\n msgstr "El t\xc3\xadtulo del \xc3\xa1rbol de navegaci\xc3\xb3n."\n \n #. Default: "How many folders should be included before the navigation tree stops. 0 means no limit. 1 only includes the root folder."\n-#: plone/restapi/services/contextnavigation/get.py:113\n+#: plone/restapi/services/contextnavigation/get.py:116\n msgid "help_navigation_tree_depth"\n msgstr "Cu\xc3\xa1ntas carpetas se deben incluir antes de que se detenga el \xc3\xa1rbol de navegaci\xc3\xb3n. 0 significa sin l\xc3\xadmite. 1 significa incluir solo la carpeta ra\xc3\xadz."\n \n #. Default: "Only show the contents of the current folder."\n-#: plone/restapi/services/contextnavigation/get.py:80\n+#: plone/restapi/services/contextnavigation/get.py:83\n msgid "label_current_folder_only"\n msgstr "Muestra solo el contenido de la carpeta actual."\n \n #. Default: "Include top node"\n-#: plone/restapi/services/contextnavigation/get.py:68\n+#: plone/restapi/services/contextnavigation/get.py:71\n msgid "label_include_top_node"\n msgstr "Incluir nodo superior"\n \n #. Default: "Root node"\n-#: plone/restapi/services/contextnavigation/get.py:57\n+#: plone/restapi/services/contextnavigation/get.py:60\n msgid "label_navigation_root_path"\n msgstr "Nodo ra\xc3\xadz"\n \n #. Default: "Start level"\n-#: plone/restapi/services/contextnavigation/get.py:95\n+#: plone/restapi/services/contextnavigation/get.py:98\n msgid "label_navigation_startlevel"\n msgstr "Nivel inicial"\n \n #. Default: "Title"\n-#: plone/restapi/services/contextnavigation/get.py:48\n+#: plone/restapi/services/contextnavigation/get.py:51\n msgid "label_navigation_title"\n msgstr "T\xc3\xadtulo"\n \n #. Default: "Navigation tree depth"\n-#: plone/restapi/services/contextnavigation/get.py:112\n+#: plone/restapi/services/contextnavigation/get.py:115\n msgid "label_navigation_tree_depth"\n msgstr "Profundidad del \xc3\xa1rbol de navegaci\xc3\xb3n"\n \ndiff --git a/src/plone/restapi/locales/fr/LC_MESSAGES/plone.restapi.po b/src/plone/restapi/locales/fr/LC_MESSAGES/plone.restapi.po\nindex 7d1260a51e..9d25934588 100644\n--- a/src/plone/restapi/locales/fr/LC_MESSAGES/plone.restapi.po\n+++ b/src/plone/restapi/locales/fr/LC_MESSAGES/plone.restapi.po\n@@ -1,7 +1,7 @@\n msgid ""\n msgstr ""\n "Project-Id-Version: PACKAGE VERSION\\n"\n-"POT-Creation-Date: 2022-12-29 15:58+0000\\n"\n+"POT-Creation-Date: 2023-09-25 20:32+0000\\n"\n "PO-Revision-Date: YEAR-MO-DA HO:MI +ZONE\\n"\n "Last-Translator: Julien Chandelle <jchandelle@affinitic.be>\\n"\n "Language-Team: French <FR@li.org>\\n"\n@@ -14,11 +14,11 @@ msgstr ""\n "Preferred-Encodings: utf-8 latin1\\n"\n "Domain: plone.restapi\\n"\n \n-#: plone/restapi/services/email_send/post.py:81\n+#: plone/restapi/services/email_send/post.py:88\n msgid "${sender_fullname} via ${portal_title}"\n msgstr "${sender_fullname} via ${portal_title}"\n \n-#: plone/restapi/services/email_send/post.py:74\n+#: plone/restapi/services/email_send/post.py:81\n msgid "A portal user via ${portal_title}"\n msgstr "Un utilisateur du portail via ${portal_title}"\n \n@@ -34,23 +34,23 @@ msgstr ""\n msgid "Adds sample workflows for testing"\n msgstr ""\n \n-#: plone/restapi/services/aliases/add.py:106\n+#: plone/restapi/services/aliases/add.py:107\n msgid "Alternative urls that point to themselves will cause an endless cycle of redirects."\n msgstr "Les URLs alternatives qui pointent vers elles-m\xc3\xaames provoqueront un cycle sans fin de redirections."\n \n-#: plone/restapi/configure.zcml:115\n+#: plone/restapi/configure.zcml:116\n msgid "Blocks"\n msgstr "Blocs"\n \n-#: plone/restapi/configure.zcml:122\n+#: plone/restapi/configure.zcml:123\n msgid "Blocks (Editable Layout)"\n msgstr "Blocs (mise en page modifiable)"\n \n-#: plone/restapi/configure.zcml:122\n+#: plone/restapi/configure.zcml:123\n msgid "Enables Volto Blocks (editable layout) support"\n msgstr "Active la prise en charge des blocs Volto (mise en page modifiable)"\n \n-#: plone/restapi/configure.zcml:115\n+#: plone/restapi/configure.zcml:116\n msgid "Enables Volto Blocks support"\n msgstr "Active la prise en charge des blocs Volto"\n \n@@ -58,7 +58,7 @@ msgstr "Active la prise en charge des blocs Volto"\n msgid "Enables blocks on the Document content type"\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:133\n+#: plone/restapi/services/contextnavigation/get.py:136\n msgid "Enter a valid scale name (see \'Image Handling\' control panel) to override (e.g. icon, tile, thumb, mini, preview, ... ). Leave empty to use default (see \'Site\' control panel)."\n msgstr "Saisissez un nom d\'\xc3\xa9chelle valide (cf. \xc2\xab\xc2\xa0Gestion des images\xc2\xa0\xc2\xbb dans le panneau de configuration) pour outrepasser (p. ex. icon, tile, thumb, mini, preview, etc.). Laisser vide pour utiliser les \xc3\xa9chelles par d\xc3\xa9faut (cf. \xc2\xab\xc2\xa0Site\xc2\xa0\xc2\xbb dans le panneau de configuration)."\n \n@@ -67,15 +67,15 @@ msgid "Error in fields. ${errors_to_string}"\n msgstr "Erreur dans les champs. ${errors_to_string}"\n \n #. Default: "The reset_token is expired."\n-#: plone/restapi/services/users/add.py:312\n+#: plone/restapi/services/users/add.py:319\n msgid "Expired Token"\n msgstr "Le reset_token a expir\xc3\xa9"\n \n-#: plone/restapi/services/contextnavigation/get.py:126\n+#: plone/restapi/services/contextnavigation/get.py:129\n msgid "If enabled, the portlet will not show document type icons."\n msgstr "Si activ\xc3\xa9, le portlet n\'affichera pas les ic\xc3\xb4nes de types de documents."\n \n-#: plone/restapi/services/contextnavigation/get.py:145\n+#: plone/restapi/services/contextnavigation/get.py:148\n msgid "If enabled, the portlet will not show thumbs."\n msgstr "Si activ\xc3\xa9, le portlet n\'affichera pas les miniatures."\n \n@@ -91,11 +91,11 @@ msgstr "Si vous passez le param\xc3\xa8tre \'reset_token\', vous devez passer le param\xc3\xa8\n msgid "Layout"\n msgstr "Mise en page"\n \n-#: plone/restapi/services/contextnavigation/get.py:195\n+#: plone/restapi/services/contextnavigation/get.py:197\n msgid "Navigation"\n msgstr "Navigation"\n \n-#: plone/restapi/services/contextnavigation/get.py:132\n+#: plone/restapi/services/contextnavigation/get.py:135\n msgid "Override thumb scale"\n msgstr "Remplacer l\'\xc3\xa9chelle de miniature"\n \n@@ -123,23 +123,23 @@ msgstr "Retour \xc3\xa0 la r\xc3\xa9vision ${version}"\n msgid "Roles"\n msgstr "R\xc3\xb4les"\n \n-#: plone/restapi/services/users/add.py:350\n+#: plone/restapi/services/users/add.py:357\n msgid "See the user endpoint documentation for the valid parameters."\n msgstr "Consultez la documentation du endpoint user pour les param\xc3\xa8tres valides."\n \n-#: plone/restapi/services/contextnavigation/get.py:125\n+#: plone/restapi/services/contextnavigation/get.py:128\n msgid "Suppress Icons"\n msgstr "Supprimer les ic\xc3\xb4nes"\n \n-#: plone/restapi/services/contextnavigation/get.py:144\n+#: plone/restapi/services/contextnavigation/get.py:147\n msgid "Suppress thumbs"\n msgstr "Supprimer les miniatures"\n \n-#: plone/restapi/services/users/add.py:342\n+#: plone/restapi/services/users/add.py:349\n msgid "The password passed as \'old_password\' is wrong."\n msgstr "Le mot de passe pass\xc3\xa9 comme \'old_password\' est erron\xc3\xa9."\n \n-#: plone/restapi/services/users/add.py:307\n+#: plone/restapi/services/users/add.py:314\n msgid "The reset_token is unknown/not valid."\n msgstr "Le reset_token est inconnu/non valide."\n \n@@ -147,11 +147,11 @@ msgstr "Le reset_token est inconnu/non valide."\n msgid "Volto Blocks"\n msgstr "Blocs Volto"\n \n-#: plone/restapi/services/users/update.py:119\n+#: plone/restapi/services/users/update.py:151\n msgid "You are not authorized to perform this action"\n msgstr "Vous n\'\xc3\xaates pas autoris\xc3\xa9 \xc3\xa0 effectuer cette action"\n \n-#: plone/restapi/services/email_send/post.py:91\n+#: plone/restapi/services/email_send/post.py:98\n msgid "You are receiving this mail because ${sender_fullname} sent this message via the site ${portal_title}:"\n msgstr "Vous recevez cette e-mail, car ${sender_fullname} vous a envoy\xc3\xa9 ce message depuis ${portal_title}:"\n \n@@ -159,14 +159,22 @@ msgstr "Vous recevez cette e-mail, car ${sender_fullname} vous a envoy\xc3\xa9 ce mess\n msgid "You can\'t send both password and sendPasswordReset."\n msgstr "Vous ne pouvez pas envoyer \xc3\xa0 la fois le password et sendPasswordReset"\n \n-#: plone/restapi/services/users/add.py:322\n+#: plone/restapi/services/users/add.py:329\n msgid "You can\'t set a password without a password reset token."\n msgstr "Vous ne pouvez pas d\xc3\xa9finir de mot de passe sans un jeton de r\xc3\xa9initialisation de mot de passe."\n \n-#: plone/restapi/services/users/update.py:125\n+#: plone/restapi/services/users/update.py:120\n+msgid "You can\'t update roles of this user"\n+msgstr ""\n+\n+#: plone/restapi/services/users/update.py:157\n msgid "You can\'t update the properties of this user"\n msgstr "Vous ne pouvez pas mettre \xc3\xa0 jour les propri\xc3\xa9t\xc3\xa9s de cet utilisateur"\n \n+#: plone/restapi/services/users/update.py:94\n+msgid "You can\'t update this user"\n+msgstr ""\n+\n #: plone/restapi/services/users/add.py:284\n msgid "You can\'t use \'reset_token\' and \'old_password\' together."\n msgstr "Vous ne pouvez pas utiliser \'reset_token\' et \'old_password\' ensemble."\n@@ -179,72 +187,72 @@ msgstr "Vous devez soit saisir un password ou sendPasswordReset"\n msgid "You need AddPortalMember permission."\n msgstr "Vous avez besoin de la permission AddPortalMember"\n \n-#: plone/restapi/services/users/add.py:329\n+#: plone/restapi/services/users/add.py:336\n msgid "You need to be logged in as the user \'${username}\' to set the password."\n msgstr "Vous devez \xc3\xaatre connect\xc3\xa9 an tant que \'${username}\' pour d\xc3\xa9finir le mot de passe."\n \n #. Default: "Missing dependency"\n-#: plone/restapi/services/addons/addons.py:207\n+#: plone/restapi/services/addons/addons.py:212\n msgid "dependency_missing"\n msgstr "D\xc3\xa9pendence manquante"\n \n #. Default: "If selected, the navigation tree will only show the current folder and its children at all times."\n-#: plone/restapi/services/contextnavigation/get.py:84\n+#: plone/restapi/services/contextnavigation/get.py:87\n msgid "help_current_folder_only"\n msgstr "Si cette option est s\xc3\xa9lectionn\xc3\xa9e, l\'arborescence de navigation n\'affichera \xc3\xa0 tout moment que le dossier actuel et ses enfants."\n \n #. Default: "Whether or not to show the top, or \'root\', node in the navigation tree. This is affected by the \'Start level\' setting."\n-#: plone/restapi/services/contextnavigation/get.py:69\n+#: plone/restapi/services/contextnavigation/get.py:72\n msgid "help_include_top_node"\n msgstr "Afficher ou non le n\xc5\x93ud sup\xc3\xa9rieur ou \'racine\' dans l\'arborescence de navigation. Ceci est affect\xc3\xa9 par le param\xc3\xa8tre \'Niveau de d\xc3\xa9marrage\'."\n \n #. Default: "You may search for and choose a folder to act as the root of the navigation tree. Leave blank to use the Plone site root."\n-#: plone/restapi/services/contextnavigation/get.py:58\n+#: plone/restapi/services/contextnavigation/get.py:61\n msgid "help_navigation_root"\n msgstr "Vous pouvez rechercher et choisir un dossier qui servira de racine \xc3\xa0 l\'arborescence de navigation. Laissez vide pour utiliser la racine du site Plone."\n \n #. Default: "An integer value that specifies the number of folder levels below the site root that must be exceeded before the navigation tree will display. 0 means that the navigation tree should be displayed everywhere including pages in the root of the site. 1 means the tree only shows up inside folders located in the root and downwards, never showing at the top level."\n-#: plone/restapi/services/contextnavigation/get.py:96\n+#: plone/restapi/services/contextnavigation/get.py:99\n msgid "help_navigation_start_level"\n msgstr "Une nombre enti\xc3\xa8re qui sp\xc3\xa9cifie le nombre de niveaux de dossier sous la racine du site qui doit \xc3\xaatre d\xc3\xa9pass\xc3\xa9 avant que l\'arborescence de navigation s\'affiche. 0 signifie que l\'arborescence de navigation doit \xc3\xaatre affich\xc3\xa9e partout, en ce compris les pages \xc3\xa0 la racine du site. 1 signifie que l\'arborescence n\'appara\xc3\xaet qu\'\xc3\xa0 l\'int\xc3\xa9rieur des dossiers situ\xc3\xa9s \xc3\xa0 la racine et en dessous, sans jamais s\'afficher au niveau sup\xc3\xa9rieur."\n \n #. Default: "The title of the navigation tree."\n-#: plone/restapi/services/contextnavigation/get.py:49\n+#: plone/restapi/services/contextnavigation/get.py:52\n msgid "help_navigation_title"\n msgstr "Titre de l\'arborescence de navigation."\n \n #. Default: "How many folders should be included before the navigation tree stops. 0 means no limit. 1 only includes the root folder."\n-#: plone/restapi/services/contextnavigation/get.py:113\n+#: plone/restapi/services/contextnavigation/get.py:116\n msgid "help_navigation_tree_depth"\n msgstr "Combien de dossiers doivent \xc3\xaatre inclus avant que l\'arborescence de navigation ne s\'arr\xc3\xaate. 0 signifie aucune limite. 1 inclut uniquement le dossier racine."\n \n #. Default: "Only show the contents of the current folder."\n-#: plone/restapi/services/contextnavigation/get.py:80\n+#: plone/restapi/services/contextnavigation/get.py:83\n msgid "label_current_folder_only"\n msgstr "Afficher uniquement le contenu du dossier actuel."\n \n #. Default: "Include top node"\n-#: plone/restapi/services/contextnavigation/get.py:68\n+#: plone/restapi/services/contextnavigation/get.py:71\n msgid "label_include_top_node"\n msgstr "Inclure le n\xc5\x93ud sup\xc3\xa9rieur"\n \n #. Default: "Root node"\n-#: plone/restapi/services/contextnavigation/get.py:57\n+#: plone/restapi/services/contextnavigation/get.py:60\n msgid "label_navigation_root_path"\n msgstr "Noeud principal"\n \n #. Default: "Start level"\n-#: plone/restapi/services/contextnavigation/get.py:95\n+#: plone/restapi/services/contextnavigation/get.py:98\n msgid "label_navigation_startlevel"\n msgstr "Niveau de d\xc3\xa9marrage"\n \n #. Default: "Title"\n-#: plone/restapi/services/contextnavigation/get.py:48\n+#: plone/restapi/services/contextnavigation/get.py:51\n msgid "label_navigation_title"\n msgstr "Titre"\n \n #. Default: "Navigation tree depth"\n-#: plone/restapi/services/contextnavigation/get.py:112\n+#: plone/restapi/services/contextnavigation/get.py:115\n msgid "label_navigation_tree_depth"\n msgstr "Profondeur de l\'arborescence de navigation"\n \ndiff --git a/src/plone/restapi/locales/plone.restapi.pot b/src/plone/restapi/locales/plone.restapi.pot\nindex 17bca71cfe..d1d2abf57a 100644\n--- a/src/plone/restapi/locales/plone.restapi.pot\n+++ b/src/plone/restapi/locales/plone.restapi.pot\n@@ -4,7 +4,7 @@\n msgid ""\n msgstr ""\n "Project-Id-Version: PACKAGE VERSION\\n"\n-"POT-Creation-Date: 2022-12-29 15:58+0000\\n"\n+"POT-Creation-Date: 2023-09-25 20:32+0000\\n"\n "PO-Revision-Date: YEAR-MO-DA HO:MI +ZONE\\n"\n "Last-Translator: FULL NAME <EMAIL@ADDRESS>\\n"\n "Language-Team: LANGUAGE <LL@li.org>\\n"\n@@ -17,11 +17,11 @@ msgstr ""\n "Preferred-Encodings: utf-8 latin1\\n"\n "Domain: plone.restapi\\n"\n \n-#: plone/restapi/services/email_send/post.py:81\n+#: plone/restapi/services/email_send/post.py:88\n msgid "${sender_fullname} via ${portal_title}"\n msgstr ""\n \n-#: plone/restapi/services/email_send/post.py:74\n+#: plone/restapi/services/email_send/post.py:81\n msgid "A portal user via ${portal_title}"\n msgstr ""\n \n@@ -37,23 +37,23 @@ msgstr ""\n msgid "Adds sample workflows for testing"\n msgstr ""\n \n-#: plone/restapi/services/aliases/add.py:106\n+#: plone/restapi/services/aliases/add.py:107\n msgid "Alternative urls that point to themselves will cause an endless cycle of redirects."\n msgstr ""\n \n-#: plone/restapi/configure.zcml:115\n+#: plone/restapi/configure.zcml:116\n msgid "Blocks"\n msgstr ""\n \n-#: plone/restapi/configure.zcml:122\n+#: plone/restapi/configure.zcml:123\n msgid "Blocks (Editable Layout)"\n msgstr ""\n \n-#: plone/restapi/configure.zcml:122\n+#: plone/restapi/configure.zcml:123\n msgid "Enables Volto Blocks (editable layout) support"\n msgstr ""\n \n-#: plone/restapi/configure.zcml:115\n+#: plone/restapi/configure.zcml:116\n msgid "Enables Volto Blocks support"\n msgstr ""\n \n@@ -61,7 +61,7 @@ msgstr ""\n msgid "Enables blocks on the Document content type"\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:133\n+#: plone/restapi/services/contextnavigation/get.py:136\n msgid "Enter a valid scale name (see \'Image Handling\' control panel) to override (e.g. icon, tile, thumb, mini, preview, ... ). Leave empty to use default (see \'Site\' control panel)."\n msgstr ""\n \n@@ -70,15 +70,15 @@ msgid "Error in fields. ${errors_to_string}"\n msgstr ""\n \n #. Default: "The reset_token is expired."\n-#: plone/restapi/services/users/add.py:312\n+#: plone/restapi/services/users/add.py:319\n msgid "Expired Token"\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:126\n+#: plone/restapi/services/contextnavigation/get.py:129\n msgid "If enabled, the portlet will not show document type icons."\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:145\n+#: plone/restapi/services/contextnavigation/get.py:148\n msgid "If enabled, the portlet will not show thumbs."\n msgstr ""\n \n@@ -94,11 +94,11 @@ msgstr ""\n msgid "Layout"\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:195\n+#: plone/restapi/services/contextnavigation/get.py:197\n msgid "Navigation"\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:132\n+#: plone/restapi/services/contextnavigation/get.py:135\n msgid "Override thumb scale"\n msgstr ""\n \n@@ -126,23 +126,23 @@ msgstr ""\n msgid "Roles"\n msgstr ""\n \n-#: plone/restapi/services/users/add.py:350\n+#: plone/restapi/services/users/add.py:357\n msgid "See the user endpoint documentation for the valid parameters."\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:125\n+#: plone/restapi/services/contextnavigation/get.py:128\n msgid "Suppress Icons"\n msgstr ""\n \n-#: plone/restapi/services/contextnavigation/get.py:144\n+#: plone/restapi/services/contextnavigation/get.py:147\n msgid "Suppress thumbs"\n msgstr ""\n \n-#: plone/restapi/services/users/add.py:342\n+#: plone/restapi/services/users/add.py:349\n msgid "The password passed as \'old_password\' is wrong."\n msgstr ""\n \n-#: plone/restapi/services/users/add.py:307\n+#: plone/restapi/services/users/add.py:314\n msgid "The reset_token is unknown/not valid."\n msgstr ""\n \n@@ -150,11 +150,11 @@ msgstr ""\n msgid "Volto Blocks"\n msgstr ""\n \n-#: plone/restapi/services/users/update.py:119\n+#: plone/restapi/services/users/update.py:151\n msgid "You are not authorized to perform this action"\n msgstr ""\n \n-#: plone/restapi/services/email_send/post.py:91\n+#: plone/restapi/services/email_send/post.py:98\n msgid "You are receiving this mail because ${sender_fullname} sent this message via the site ${portal_title}:"\n msgstr ""\n \n@@ -162,14 +162,22 @@ msgstr ""\n msgid "You can\'t send both password and sendPasswordReset."\n msgstr ""\n \n-#: plone/restapi/services/users/add.py:322\n+#: plone/restapi/services/users/add.py:329\n msgid "You can\'t set a password without a password reset token."\n msgstr ""\n \n-#: plone/restapi/services/users/update.py:125\n+#: plone/restapi/services/users/update.py:120\n+msgid "You can\'t update roles of this user"\n+msgstr ""\n+\n+#: plone/restapi/services/users/update.py:157\n msgid "You can\'t update the properties of this user"\n msgstr ""\n \n+#: plone/restapi/services/users/update.py:94\n+msgid "You can\'t update this user"\n+msgstr ""\n+\n #: plone/restapi/services/users/add.py:284\n msgid "You can\'t use \'reset_token\' and \'old_password\' together."\n msgstr ""\n@@ -182,72 +190,72 @@ msgstr ""\n msgid "You need AddPortalMember permission."\n msgstr ""\n \n-#: plone/restapi/services/users/add.py:329\n+#: plone/restapi/services/users/add.py:336\n msgid "You need to be logged in as the user \'${username}\' to set the password."\n msgstr ""\n \n #. Default: "Missing dependency"\n-#: plone/restapi/services/addons/addons.py:207\n+#: plone/restapi/services/addons/addons.py:212\n msgid "dependency_missing"\n msgstr ""\n \n #. Default: "If selected, the navigation tree will only show the current folder and its children at all times."\n-#: plone/restapi/services/contextnavigation/get.py:84\n+#: plone/restapi/services/contextnavigation/get.py:87\n msgid "help_current_folder_only"\n msgstr ""\n \n #. Default: "Whether or not to show the top, or \'root\', node in the navigation tree. This is affected by the \'Start level\' setting."\n-#: plone/restapi/services/contextnavigation/get.py:69\n+#: plone/restapi/services/contextnavigation/get.py:72\n msgid "help_include_top_node"\n msgstr ""\n \n #. Default: "You may search for and choose a folder to act as the root of the navigation tree. Leave blank to use the Plone site root."\n-#: plone/restapi/services/contextnavigation/get.py:58\n+#: plone/restapi/services/contextnavigation/get.py:61\n msgid "help_navigation_root"\n msgstr ""\n \n #. Default: "An integer value that specifies the number of folder levels below the site root that must be exceeded before the navigation tree will display. 0 means that the navigation tree should be displayed everywhere including pages in the root of the site. 1 means the tree only shows up inside folders located in the root and downwards, never showing at the top level."\n-#: plone/restapi/services/contextnavigation/get.py:96\n+#: plone/restapi/services/contextnavigation/get.py:99\n msgid "help_navigation_start_level"\n msgstr ""\n \n #. Default: "The title of the navigation tree."\n-#: plone/restapi/services/contextnavigation/get.py:49\n+#: plone/restapi/services/contextnavigation/get.py:52\n msgid "help_navigation_title"\n msgstr ""\n \n #. Default: "How many folders should be included before the navigation tree stops. 0 means no limit. 1 only includes the root folder."\n-#: plone/restapi/services/contextnavigation/get.py:113\n+#: plone/restapi/services/contextnavigation/get.py:116\n msgid "help_navigation_tree_depth"\n msgstr ""\n \n #. Default: "Only show the contents of the current folder."\n-#: plone/restapi/services/contextnavigation/get.py:80\n+#: plone/restapi/services/contextnavigation/get.py:83\n msgid "label_current_folder_only"\n msgstr ""\n \n #. Default: "Include top node"\n-#: plone/restapi/services/contextnavigation/get.py:68\n+#: plone/restapi/services/contextnavigation/get.py:71\n msgid "label_include_top_node"\n msgstr ""\n \n #. Default: "Root node"\n-#: plone/restapi/services/contextnavigation/get.py:57\n+#: plone/restapi/services/contextnavigation/get.py:60\n msgid "label_navigation_root_path"\n msgstr ""\n \n #. Default: "Start level"\n-#: plone/restapi/services/contextnavigation/get.py:95\n+#: plone/restapi/services/contextnavigation/get.py:98\n msgid "label_navigation_startlevel"\n msgstr ""\n \n #. Default: "Title"\n-#: plone/restapi/services/contextnavigation/get.py:48\n+#: plone/restapi/services/contextnavigation/get.py:51\n msgid "label_navigation_title"\n msgstr ""\n \n #. Default: "Navigation tree depth"\n-#: plone/restapi/services/contextnavigation/get.py:112\n+#: plone/restapi/services/contextnavigation/get.py:115\n msgid "label_navigation_tree_depth"\n msgstr ""\n \ndiff --git a/src/plone/restapi/locales/pt_BR/LC_MESSAGES/plone.restapi.po b/src/plone/restapi/locales/pt_BR/LC_MESSAGES/plone.restapi.po\nindex 1c5afcc61d..dd921dca1f 100644\n--- a/src/plone/restapi/locales/pt_BR/LC_MESSAGES/plone.restapi.po\n+++ b/src/plone/restapi/locales/pt_BR/LC_MESSAGES/plone.restapi.po\n@@ -1,7 +1,7 @@\n msgid ""\n msgstr ""\n "Project-Id-Version: plone.restapi\\n"\n-"POT-Creation-Date: 2022-12-29 15:58+0000\\n"\n+"POT-Creation-Date: 2023-09-25 20:32+0000\\n"\n "PO-Revision-Date: YEAR-MO-DA HO:MI +ZONE\\n"\n "Last-Translator: Wesley Barroso Lopes\\n"\n "Language-Team: \\n"\n@@ -14,11 +14,11 @@ msgstr ""\n "Preferred-Encodings: utf-8 latin1\\n"\n "Domain: plone.restapi\\n"\n \n-#: plone/restapi/services/email_send/post.py:81\n+#: plone/restapi/services/email_send/post.py:88\n msgid "${sender_fullname} via ${portal_title}"\n msgstr ""\n \n-#: plone/restapi/services/email_send/post.py:74\n+#: plone/restapi/services/email_send/post.py:81\n msgid "A portal user via ${portal_title}"\n msgstr "Um usu\xc3\xa1rio do portal via ${portal_title}"\n \n@@ -34,23 +34,23 @@ msgstr "Adiciona tipos de conte\xc3\xbado de amostra para teste"\n msgid "Adds sample workflows for testing"\n msgstr "Adiciona workflows de amostra para teste"\n \n-#: plone/restapi/services/aliases/add.py:106\n+#: plone/restapi/services/aliases/add.py:107\n msgid "Alternative urls that point to themselves will cause an endless cycle of redirects."\n msgstr "URLs alternativas que apontam para si mesmas causar\xc3\xa3o um ciclo intermin\xc3\xa1vel de redirecionamentos."\n \n-#: plone/restapi/configure.zcml:115\n+#: plone/restapi/configure.zcml:116\n msgid "Blocks"\n msgstr "Blocos"\n \n-#: plone/restapi/configure.zcml:122\n+#: plone/restapi/configure.zcml:123\n msgid "Blocks (Editable Layout)"\n msgstr "Blocos (Layout Edit\xc3\xa1vel)"\n \n-#: plone/restapi/configure.zcml:122\n+#: plone/restapi/configure.zcml:123\n msgid "Enables Volto Blocks (editable layout) support"\n msgstr "Habilita o suporte a Blocos Volto (layout edit\xc3\xa1vel)"\n \n-#: plone/restapi/configure.zcml:115\n+#: plone/restapi/configure.zcml:116\n msgid "Enables Volto Blocks support"\n msgstr "Habilita o suporte a Blocos Volto"\n \n@@ -58,7 +58,7 @@ msgstr "Habilita o suporte a Blocos Volto"\n msgid "Enables blocks on the Document content type"\n msgstr "Habilita blocos no tipo de conte\xc3\xbado P\xc3\xa1gina"\n \n-#: plone/restapi/services/contextnavigation/get.py:133\n+#: plone/restapi/services/contextnavigation/get.py:136\n msgid "Enter a valid scale name (see \'Image Handling\' control panel) to override (e.g. icon, tile, thumb, mini, preview, ... ). Leave empty to use default (see \'Site\' control panel)."\n msgstr "Informe um nome de escala v\xc3\xa1lido (ver \'Manipula\xc3\xa7\xc3\xa3o de Imagem\' no painel de controle) para sobrescrever (por exemplo, icon, tile, thumb, mini, preview\xe2\x80\xa6). Deixe em branco para usar o valor padr\xc3\xa3o (ver \'Site\' no painel de controle)."\n \n@@ -67,15 +67,15 @@ msgid "Error in fields. ${errors_to_string}"\n msgstr "Erros em campos. ${errors_to_string}"\n \n #. Default: "The reset_token is expired."\n-#: plone/restapi/services/users/add.py:312\n+#: plone/restapi/services/users/add.py:319\n msgid "Expired Token"\n msgstr "Token Expir\xc3\xa1do"\n \n-#: plone/restapi/services/contextnavigation/get.py:126\n+#: plone/restapi/services/contextnavigation/get.py:129\n msgid "If enabled, the portlet will not show document type icons."\n msgstr "Caso ativado, o portlet n\xc3\xa3o mostrar\xc3\xa1 os \xc3\xadcones do tipo de conte\xc3\xbado"\n \n-#: plone/restapi/services/contextnavigation/get.py:145\n+#: plone/restapi/services/contextnavigation/get.py:148\n msgid "If enabled, the portlet will not show thumbs."\n msgstr "Caso ativado, o portlet n\xc3\xa3o mostrar\xc3\xa1 miniaturas."\n \n@@ -91,11 +91,11 @@ msgstr "Se voc\xc3\xaa informar \'Redefinir Token\' voc\xc3\xaa deve informar \'Nova Senha\'"\n msgid "Layout"\n msgstr "Layout"\n \n-#: plone/restapi/services/contextnavigation/get.py:195\n+#: plone/restapi/services/contextnavigation/get.py:197\n msgid "Navigation"\n msgstr "Navega\xc3\xa7\xc3\xa3o"\n \n-#: plone/restapi/services/contextnavigation/get.py:132\n+#: plone/restapi/services/contextnavigation/get.py:135\n msgid "Override thumb scale"\n msgstr "Sobrescrever a escala da miniatura"\n \n@@ -123,23 +123,23 @@ msgstr "Revertido para revis\xc3\xa3o ${version}"\n msgid "Roles"\n msgstr "Pap\xc3\xa9is"\n \n-#: plone/restapi/services/users/add.py:350\n+#: plone/restapi/services/users/add.py:357\n msgid "See the user endpoint documentation for the valid parameters."\n msgstr "Consulte a documenta\xc3\xa7\xc3\xa3o do endpoint user para obter os par\xc3\xa2metros v\xc3\xa1lidos."\n \n-#: plone/restapi/services/contextnavigation/get.py:125\n+#: plone/restapi/services/contextnavigation/get.py:128\n msgid "Suppress Icons"\n msgstr "Suprimir \xc3\xadcones"\n \n-#: plone/restapi/services/contextnavigation/get.py:144\n+#: plone/restapi/services/contextnavigation/get.py:147\n msgid "Suppress thumbs"\n msgstr "Suprimir miniaturas"\n \n-#: plone/restapi/services/users/add.py:342\n+#: plone/restapi/services/users/add.py:349\n msgid "The password passed as \'old_password\' is wrong."\n msgstr "A Senha passada como \'Senha Antiga\' n\xc3\xa3o \xc3\xa9 v\xc3\xa1lida."\n \n-#: plone/restapi/services/users/add.py:307\n+#: plone/restapi/services/users/add.py:314\n msgid "The reset_token is unknown/not valid."\n msgstr "O reset_token \xc3\xa9 desconhecido/inv\xc3\xa1lido."\n \n@@ -147,11 +147,11 @@ msgstr "O reset_token \xc3\xa9 desconhecido/inv\xc3\xa1lido."\n msgid "Volto Blocks"\n msgstr "Blocos Volto"\n \n-#: plone/restapi/services/users/update.py:119\n+#: plone/restapi/services/users/update.py:151\n msgid "You are not authorized to perform this action"\n msgstr "Voc\xc3\xaa n\xc3\xa3o est\xc3\xa1 autorizado a realizar esta a\xc3\xa7\xc3\xa3o"\n \n-#: plone/restapi/services/email_send/post.py:91\n+#: plone/restapi/services/email_send/post.py:98\n msgid "You are receiving this mail because ${sender_fullname} sent this message via the site ${portal_title}:"\n msgstr "Voc\xc3\xaa est\xc3\xa1 recebendo este e-mail porque ${sender_fullname} enviou esta mensagem atrav\xc3\xa9s do site ${portal_title}:"\n \n@@ -159,14 +159,22 @@ msgstr "Voc\xc3\xaa est\xc3\xa1 recebendo este e-mail porque ${sender_fullname} enviou esta\n msgid "You can\'t send both password and sendPasswordReset."\n msgstr "Voc\xc3\xaa n\xc3\xa3o pode informar Senha e \'Envie um e-mail de confirma\xc3\xa7\xc3\xa3o com um link para definir a senha\'."\n \n-#: plone/restapi/services/users/add.py:322\n+#: plone/restapi/services/users/add.py:329\n msgid "You can\'t set a password without a password reset token."\n msgstr "Voc\xc3\xaa n\xc3\xa3o pode definir uma senha sem um token de redefini\xc3\xa7\xc3\xa3o de senha."\n \n-#: plone/restapi/services/users/update.py:125\n+#: plone/restapi/services/users/update.py:120\n+msgid "You can\'t update roles of this user"\n+msgstr "Voc\xc3\xaa n\xc3\xa3o pode atualizar os pap\xc3\xa9is deste usu\xc3\xa1rio"\n+\n+#: plone/restapi/services/users/update.py:157\n msgid "You can\'t update the properties of this user"\n msgstr "Voc\xc3\xaa n\xc3\xa3o pode atualizar as propriedades deste usu\xc3\xa1rio"\n \n+#: plone/restapi/services/users/update.py:94\n+msgid "You can\'t update this user"\n+msgstr "Voc\xc3\xaa n\xc3\xa3o pode atualizar este usu\xc3\xa1rio"\n+\n #: plone/restapi/services/users/add.py:284\n msgid "You can\'t use \'reset_token\' and \'old_password\' together."\n msgstr "Voc\xc3\xaa n\xc3\xa3o pode usar \'Redefinir Token\' e \'Senha Antiga\' juntos."\n@@ -179,72 +187,72 @@ msgstr "Voc\xc3\xaa deve informar uma Senha ou \'Envie um e-mail de confirma\xc3\xa7\xc3\xa3o com u\n msgid "You need AddPortalMember permission."\n msgstr "Voc\xc3\xaa precisa da permiss\xc3\xa3o AddPortalMember."\n \n-#: plone/restapi/services/users/add.py:329\n+#: plone/restapi/services/users/add.py:336\n msgid "You need to be logged in as the user \'${username}\' to set the password."\n msgstr "Voc\xc3\xaa precisa estar logado como o usu\xc3\xa1rio \'${username}\' para definir a senha."\n \n #. Default: "Missing dependency"\n-#: plone/restapi/services/addons/addons.py:207\n+#: plone/restapi/services/addons/addons.py:212\n msgid "dependency_missing"\n msgstr "Depend\xc3\xaancia ausente"\n \n #. Default: "If selected, the navigation tree will only show the current folder and its children at all times."\n-#: plone/restapi/services/contextnavigation/get.py:84\n+#: plone/restapi/services/contextnavigation/get.py:87\n msgid "help_current_folder_only"\n msgstr "Caso selecionado, a \xc3\xa1rvore de navega\xc3\xa7\xc3\xa3o ir\xc3\xa1 sempre mostrar somente a pasta atual e seus filhos."\n \n #. Default: "Whether or not to show the top, or \'root\', node in the navigation tree. This is affected by the \'Start level\' setting."\n-#: plone/restapi/services/contextnavigation/get.py:69\n+#: plone/restapi/services/contextnavigation/get.py:72\n msgid "help_include_top_node"\n msgstr "Se o nodo topo, ou \'raiz\', deve ser ou n\xc3\xa3o exibido na \xc3\xa1rvore de navega\xc3\xa7\xc3\xa3o. Isso \xc3\xa9 afetado pela configura\xc3\xa7\xc3\xa3o do \'N\xc3\xadvel inicial\'."\n \n #. Default: "You may search for and choose a folder to act as the root of the navigation tree. Leave blank to use the Plone site root."\n-#: plone/restapi/services/contextnavigation/get.py:58\n+#: plone/restapi/services/contextnavigation/get.py:61\n msgid "help_navigation_root"\n msgstr "Voc\xc3\xaa pode procurar por e selecionar uma pasta para agir como a raiz da \xc3\xa1rvore de navega\xc3\xa7\xc3\xa3o. Deixe em branco para usar a raiz do site Plone."\n \n #. Default: "An integer value that specifies the number of folder levels below the site root that must be exceeded before the navigation tree will display. 0 means that the navigation tree should be displayed everywhere including pages in the root of the site. 1 means the tree only shows up inside folders located in the root and downwards, never showing at the top level."\n-#: plone/restapi/services/contextnavigation/get.py:96\n+#: plone/restapi/services/contextnavigation/get.py:99\n msgid "help_navigation_start_level"\n msgstr "Um valor inteiro que especifica o n\xc3\xbamero de n\xc3\xadveis de pastas abaixo da raiz do site que deve ser excedido antes que a \xc3\xa1rvore de navega\xc3\xa7\xc3\xa3o seja mostrada. 0 significa que a \xc3\xa1rvore de navega\xc3\xa7\xc3\xa3o deve ser mostrada em qualquer lugar, incluindo p\xc3\xa1ginas na raiz do site. 1 significa que a \xc3\xa1rvore somente aparecer\xc3\xa1 dentro de pastas localizadas na raiz e abaixo delas, nunca aparecendo no n\xc3\xadvel raiz."\n \n #. Default: "The title of the navigation tree."\n-#: plone/restapi/services/contextnavigation/get.py:49\n+#: plone/restapi/services/contextnavigation/get.py:52\n msgid "help_navigation_title"\n msgstr "O t\xc3\xadtulo da \xc3\xa1rvore de navega\xc3\xa7\xc3\xa3o."\n \n #. Default: "How many folders should be included before the navigation tree stops. 0 means no limit. 1 only includes the root folder."\n-#: plone/restapi/services/contextnavigation/get.py:113\n+#: plone/restapi/services/contextnavigation/get.py:116\n msgid "help_navigation_tree_depth"\n msgstr "Quantas pastas devem ser inclu\xc3\xaddas antes que a \xc3\xa1rvore de navega\xc3\xa7\xc3\xa3o pare. 0 significa sem limite. 1 significa incluir somente a pasta raiz."\n \n #. Default: "Only show the contents of the current folder."\n-#: plone/restapi/services/contextnavigation/get.py:80\n+#: plone/restapi/services/contextnavigation/get.py:83\n msgid "label_current_folder_only"\n msgstr "Apenas exibir o conte\xc3\xbado da pasta atual."\n \n #. Default: "Include top node"\n-#: plone/restapi/services/contextnavigation/get.py:68\n+#: plone/restapi/services/contextnavigation/get.py:71\n msgid "label_include_top_node"\n msgstr "Incluir o nodo topo"\n \n #. Default: "Root node"\n-#: plone/restapi/services/contextnavigation/get.py:57\n+#: plone/restapi/services/contextnavigation/get.py:60\n msgid "label_navigation_root_path"\n msgstr "Nodo raiz"\n \n #. Default: "Start level"\n-#: plone/restapi/services/contextnavigation/get.py:95\n+#: plone/restapi/services/contextnavigation/get.py:98\n msgid "label_navigation_startlevel"\n msgstr "N\xc3\xadvel inicial"\n \n #. Default: "Title"\n-#: plone/restapi/services/contextnavigation/get.py:48\n+#: plone/restapi/services/contextnavigation/get.py:51\n msgid "label_navigation_title"\n msgstr "T\xc3\xadtulo"\n \n #. Default: "Navigation tree depth"\n-#: plone/restapi/services/contextnavigation/get.py:112\n+#: plone/restapi/services/contextnavigation/get.py:115\n msgid "label_navigation_tree_depth"\n msgstr "Profundidade da \xc3\xa1rvore de navega\xc3\xa7\xc3\xa3o"\n \ndiff --git a/src/plone/restapi/permissions.py b/src/plone/restapi/permissions.py\nindex 95cd445ed7..af1e36b361 100644\n--- a/src/plone/restapi/permissions.py\n+++ b/src/plone/restapi/permissions.py\n@@ -2,3 +2,5 @@\n # permissions. Granted to Anonymous (i.e. everyone) by default via rolemap.xml\n \n UseRESTAPI = "plone.restapi: Use REST API"\n+\n+PloneManageUsers = "Plone Site Setup: Users and Groups"\ndiff --git a/src/plone/restapi/profiles/default/metadata.xml b/src/plone/restapi/profiles/default/metadata.xml\nindex 81970e34ed..1e4872e498 100644\n--- a/src/plone/restapi/profiles/default/metadata.xml\n+++ b/src/plone/restapi/profiles/default/metadata.xml\n@@ -1,4 +1,4 @@\n <?xml version="1.0"?>\n <metadata>\n-  <version>0006</version>\n+  <version>0007</version>\n </metadata>\ndiff --git a/src/plone/restapi/profiles/default/rolemap.xml b/src/plone/restapi/profiles/default/rolemap.xml\nindex d6fcc0d439..b0d19ef9fb 100644\n--- a/src/plone/restapi/profiles/default/rolemap.xml\n+++ b/src/plone/restapi/profiles/default/rolemap.xml\n@@ -9,6 +9,7 @@\n     </permission>\n     <permission name="plone.restapi: Access Plone user information" acquire="True">\n       <role name="Manager"/>\n+      <role name="Site Administrator"/>\n     </permission>\n   </permissions>\n </rolemap>\ndiff --git a/src/plone/restapi/serializer/utils.py b/src/plone/restapi/serializer/utils.py\nindex e0c3bbdeff..4ac4e4ee7b 100644\n--- a/src/plone/restapi/serializer/utils.py\n+++ b/src/plone/restapi/serializer/utils.py\n@@ -1,9 +1,9 @@\n-from plone.dexterity.schema import lookup_fti\n from plone.app.uuid.utils import uuidToCatalogBrain\n+from plone.dexterity.schema import lookup_fti\n from plone.restapi.interfaces import IObjectPrimaryFieldTarget\n from zope.component import queryMultiAdapter\n-from zope.i18n import translate\n from zope.globalrequest import getRequest\n+from zope.i18n import translate\n \n import re\n \n@@ -43,7 +43,7 @@ def resolve_uid(path):\n \n \n def uid_to_url(path):\n-    path, brain = resolve_uid(path)\n+    path, _brain = resolve_uid(path)\n     return path\n \n \ndiff --git a/src/plone/restapi/services/groups/add.py b/src/plone/restapi/services/groups/add.py\nindex ae4561cc19..e9b5ab5d11 100644\n--- a/src/plone/restapi/services/groups/add.py\n+++ b/src/plone/restapi/services/groups/add.py\n@@ -1,6 +1,8 @@\n+from AccessControl import getSecurityManager\n from plone.restapi.deserializer import json_body\n from plone.restapi.interfaces import ISerializeToJson\n from plone.restapi.services import Service\n+from Products.CMFCore.permissions import ManagePortal\n from Products.CMFCore.utils import getToolByName\n from zExceptions import BadRequest\n from zope.component import queryMultiAdapter\n@@ -13,6 +15,10 @@\n class GroupsPost(Service):\n     """Creates a new group."""\n \n+    @property\n+    def is_zope_manager(self):\n+        return getSecurityManager().checkPermission(ManagePortal, self.context)\n+\n     def reply(self):\n         portal = getSite()\n         data = json_body(self.request)\n@@ -22,10 +28,16 @@ def reply(self):\n         if not groupname:\n             raise BadRequest("Property \'groupname\' is required")\n \n+        roles = data.get("roles", [])\n+\n+        if not self.is_zope_manager and "Manager" in roles:\n+            raise BadRequest(\n+                "You don\'t have permission to create a group with the \'Manager\' role"\n+            )\n+\n         email = data.get("email", None)\n         title = data.get("title", None)\n         description = data.get("description", None)\n-        roles = data.get("roles", None)\n         groups = data.get("groups", None)\n         users = data.get("users", [])\n \ndiff --git a/src/plone/restapi/services/groups/configure.zcml b/src/plone/restapi/services/groups/configure.zcml\nindex 491f2f9a47..8fc7b6e3ec 100644\n--- a/src/plone/restapi/services/groups/configure.zcml\n+++ b/src/plone/restapi/services/groups/configure.zcml\n@@ -8,7 +8,7 @@\n       method="GET"\n       factory=".get.GroupsGet"\n       for="Products.CMFCore.interfaces.ISiteRoot"\n-      permission="cmf.ManagePortal"\n+      permission="plone.app.controlpanel.UsersAndGroups"\n       name="@groups"\n       />\n \n@@ -16,7 +16,7 @@\n       method="PATCH"\n       factory=".update.GroupsPatch"\n       for="Products.CMFCore.interfaces.ISiteRoot"\n-      permission="cmf.ManagePortal"\n+      permission="plone.app.controlpanel.UsersAndGroups"\n       name="@groups"\n       />\n \n@@ -24,7 +24,7 @@\n       method="POST"\n       factory=".add.GroupsPost"\n       for="Products.CMFCore.interfaces.ISiteRoot"\n-      permission="cmf.ManagePortal"\n+      permission="plone.app.controlpanel.UsersAndGroups"\n       name="@groups"\n       />\n \n@@ -32,7 +32,7 @@\n       method="DELETE"\n       factory=".delete.GroupsDelete"\n       for="Products.CMFCore.interfaces.ISiteRoot"\n-      permission="cmf.ManagePortal"\n+      permission="plone.app.controlpanel.UsersAndGroups"\n       name="@groups"\n       />\n \ndiff --git a/src/plone/restapi/services/groups/delete.py b/src/plone/restapi/services/groups/delete.py\nindex 395d33f3dc..7c13cd62b9 100644\n--- a/src/plone/restapi/services/groups/delete.py\n+++ b/src/plone/restapi/services/groups/delete.py\n@@ -1,5 +1,8 @@\n+from AccessControl import getSecurityManager\n from plone.restapi.services import Service\n+from Products.CMFCore.permissions import ManagePortal\n from Products.CMFCore.utils import getToolByName\n+from zExceptions import BadRequest\n from zExceptions import NotFound\n from zope.component.hooks import getSite\n from zope.interface import implementer\n@@ -19,6 +22,10 @@ def publishTraverse(self, request, name):\n         self.params.append(name)\n         return self\n \n+    @property\n+    def is_zope_manager(self):\n+        return getSecurityManager().checkPermission(ManagePortal, self.context)\n+\n     @property\n     def _get_group_id(self):\n         if len(self.params) != 1:\n@@ -38,6 +45,11 @@ def reply(self):\n         if not group:\n             raise NotFound("Trying to delete a non-existing group.")\n \n+        if not self.is_zope_manager and "Manager" in group.getRoles():\n+            raise BadRequest(\n+                "You don\'t have permission to delete a group with the Manager role"\n+            )\n+\n         delete_successful = portal_groups.removeGroup(self._get_group_id)\n         if delete_successful:\n             return self.reply_no_content()\ndiff --git a/src/plone/restapi/services/groups/update.py b/src/plone/restapi/services/groups/update.py\nindex 9d17ebc77c..5cd3212aa9 100644\n--- a/src/plone/restapi/services/groups/update.py\n+++ b/src/plone/restapi/services/groups/update.py\n@@ -1,5 +1,7 @@\n+from AccessControl import getSecurityManager\n from plone.restapi.deserializer import json_body\n from plone.restapi.services import Service\n+from Products.CMFCore.permissions import ManagePortal\n from Products.CMFCore.utils import getToolByName\n from zExceptions import BadRequest\n from zope.component.hooks import getSite\n@@ -34,6 +36,36 @@ def __init__(self, context, request):\n         super().__init__(context, request)\n         self.params = []\n \n+    @property\n+    def is_zope_manager(self):\n+        return getSecurityManager().checkPermission(ManagePortal, self.context)\n+\n+    def can_update(self, group, users, roles, groups):\n+        # Manager can update\n+        if self.is_zope_manager:\n+            return True\n+        # Does not allow an Site Administrator to add users to groups\n+        # with the Manager role\n+        current_group_roles = group.getRoles()\n+        if "Manager" in current_group_roles and users:\n+            return False\n+        # Does not allow an Site Administrator set Manager to group\n+        result_roles = True\n+        if roles:\n+            if "Manager" in roles:\n+                result_roles = "Manager" in current_group_roles\n+            else:\n+                result_roles = "Manager" not in current_group_roles\n+        # Does not allow an Site Administrator add group to group with Manager role\n+        result_groups = True\n+        if groups:\n+            for assign_group_id in groups:\n+                assign_group = self._get_group(assign_group_id)\n+                if "Manager" in assign_group.getRoles():\n+                    result_groups = False\n+                    break\n+        return result_roles and result_groups\n+\n     def publishTraverse(self, request, name):\n         # Consume any path segments after /@groups as parameters\n         self.params.append(name)\n@@ -57,9 +89,14 @@ def reply(self):\n         if not group:\n             raise BadRequest("Trying to update a non-existing group.")\n \n+        users = data.get("users", {})\n         roles = data.get("roles", None)\n         groups = data.get("groups", None)\n-        users = data.get("users", {})\n+\n+        if not self.can_update(group, users, roles, groups):\n+            raise BadRequest(\n+                "You don\'t have permission to assign a \'Manager\' role to a group."\n+            )\n \n         # Disable CSRF protection\n         if "IDisableCSRFProtection" in dir(plone.protect.interfaces):\ndiff --git a/src/plone/restapi/services/roles/configure.zcml b/src/plone/restapi/services/roles/configure.zcml\nindex cec643c321..4dfd989234 100644\n--- a/src/plone/restapi/services/roles/configure.zcml\n+++ b/src/plone/restapi/services/roles/configure.zcml\n@@ -7,7 +7,7 @@\n       method="GET"\n       factory=".get.RolesGet"\n       for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-      permission="cmf.ManagePortal"\n+      permission="plone.app.controlpanel.UsersAndGroups"\n       name="@roles"\n       />\n \ndiff --git a/src/plone/restapi/services/users/add.py b/src/plone/restapi/services/users/add.py\nindex a032be99e2..2750d401fc 100644\n--- a/src/plone/restapi/services/users/add.py\n+++ b/src/plone/restapi/services/users/add.py\n@@ -4,6 +4,7 @@\n from plone.restapi.bbb import ISecuritySchema\n from plone.restapi.deserializer import json_body\n from plone.restapi.interfaces import ISerializeToJson\n+from plone.restapi.permissions import PloneManageUsers\n from plone.restapi.services import Service\n from Products.CMFCore.permissions import AddPortalMember\n from Products.CMFCore.permissions import SetOwnPassword\n@@ -244,7 +245,7 @@ def _error(self, status, _type, msgid):\n     @property\n     def can_manage_users(self):\n         sm = getSecurityManager()\n-        return sm.checkPermission("plone.app.controlpanel.UsersAndGroups", self.context)\n+        return sm.checkPermission(PloneManageUsers, self.context)\n \n     @property\n     def can_set_own_password(self):\ndiff --git a/src/plone/restapi/services/users/configure.zcml b/src/plone/restapi/services/users/configure.zcml\nindex e7d3505dec..b3c48ddaee 100644\n--- a/src/plone/restapi/services/users/configure.zcml\n+++ b/src/plone/restapi/services/users/configure.zcml\n@@ -32,7 +32,7 @@\n       method="DELETE"\n       factory=".delete.UsersDelete"\n       for="Products.CMFCore.interfaces.ISiteRoot"\n-      permission="cmf.ManagePortal"\n+      permission="plone.app.controlpanel.UsersAndGroups"\n       name="@users"\n       />\n \ndiff --git a/src/plone/restapi/services/users/delete.py b/src/plone/restapi/services/users/delete.py\nindex e7517f6655..bac99f22dd 100644\n--- a/src/plone/restapi/services/users/delete.py\n+++ b/src/plone/restapi/services/users/delete.py\n@@ -1,6 +1,10 @@\n+from AccessControl import getSecurityManager\n from plone.restapi.services import Service\n+from Products.CMFCore.interfaces import ISiteRoot\n+from Products.CMFCore.permissions import ManagePortal\n from Products.CMFCore.utils import getToolByName\n-from zope.component.hooks import getSite\n+from zExceptions import BadRequest\n+from zope.component import getUtility\n from zope.interface import implementer\n from zope.publisher.interfaces import IPublishTraverse\n \n@@ -15,6 +19,12 @@ class UsersDelete(Service):\n     def __init__(self, context, request):\n         super().__init__(context, request)\n         self.params = []\n+        self.portal_membership = getToolByName(context, "portal_membership")\n+        self.acl_users = getToolByName(context, "acl_users")\n+\n+    @property\n+    def is_zope_manager(self):\n+        return getSecurityManager().checkPermission(ManagePortal, self.context)\n \n     def publishTraverse(self, request, name):\n         # Consume any path segments after /@users as parameters\n@@ -27,9 +37,19 @@ def _get_user_id(self):\n             raise Exception("Must supply exactly one parameter (user id)")\n         return self.params[0]\n \n+    def _get_user(self, user_id):\n+        return self.portal_membership.getMemberById(user_id)\n+\n     def reply(self):\n-        portal = getSite()\n-        portal_membership = getToolByName(portal, "portal_membership")\n+        user = self._get_user(self._get_user_id)\n+        if not user:\n+            return self.reply_no_content(status=404)\n+        if not self.is_zope_manager:\n+            current_roles = user.getRoles()\n+            if "Manager" in current_roles:\n+                raise BadRequest(\n+                    "You don\'t have permission to delete a user with \'Manager\' role."\n+                )\n \n         delete_memberareas = (\n             self.request.get("delete_memberareas", True) not in FALSE_VALUES\n@@ -39,12 +59,21 @@ def reply(self):\n             self.request.get("delete_localroles", True) not in FALSE_VALUES\n         )\n \n-        delete_successful = portal_membership.deleteMembers(\n-            (self._get_user_id,),\n-            delete_memberareas=delete_memberareas,\n-            delete_localroles=delete_localroles,\n-        )\n-        if delete_successful:\n-            return self.reply_no_content()\n-        else:\n+        try:\n+            self.acl_users.userFolderDelUsers((self._get_user_id,))\n+        except (AttributeError, NotImplementedError):\n             return self.reply_no_content(status=404)\n+\n+        if delete_memberareas:\n+            # Delete member data in portal_memberdata.\n+            mdtool = getToolByName(self.context, "portal_memberdata", None)\n+            if mdtool is not None:\n+                mdtool.deleteMemberData(self._get_user_id)\n+\n+        if delete_localroles:\n+            # Delete members\' local roles.\n+            self.portal_membership.deleteLocalRoles(\n+                getUtility(ISiteRoot), (self._get_user_id,), reindex=1, recursive=1\n+            )\n+\n+        return self.reply_no_content()\ndiff --git a/src/plone/restapi/services/users/get.py b/src/plone/restapi/services/users/get.py\nindex 393237f740..e900b7de6f 100644\n--- a/src/plone/restapi/services/users/get.py\n+++ b/src/plone/restapi/services/users/get.py\n@@ -7,6 +7,7 @@\n from plone.namedfile.browser import USE_DENYLIST\n from plone.namedfile.utils import stream_data\n from plone.restapi.interfaces import ISerializeToJson\n+from plone.restapi.permissions import PloneManageUsers\n from plone.restapi.services import Service\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.utils import normalizeString\n@@ -177,11 +178,11 @@ def _get_filtered_users(self, query, groups_filter, search_term, limit):\n \n     def has_permission_to_query(self):\n         sm = getSecurityManager()\n-        return sm.checkPermission("Manage portal", self.context)\n+        return sm.checkPermission(PloneManageUsers, self.context)\n \n     def has_permission_to_enumerate(self):\n         sm = getSecurityManager()\n-        return sm.checkPermission("Manage portal", self.context)\n+        return sm.checkPermission(PloneManageUsers, self.context)\n \n     def has_permission_to_access_user_info(self):\n         sm = getSecurityManager()\ndiff --git a/src/plone/restapi/services/users/update.py b/src/plone/restapi/services/users/update.py\nindex 0e07d69d03..428727d1c3 100644\n--- a/src/plone/restapi/services/users/update.py\n+++ b/src/plone/restapi/services/users/update.py\n@@ -4,7 +4,9 @@\n from OFS.Image import Image\n from plone.restapi import _\n from plone.restapi.bbb import ISecuritySchema\n+from plone.restapi.permissions import PloneManageUsers\n from plone.restapi.services import Service\n+from Products.CMFCore.permissions import ManagePortal\n from Products.CMFCore.permissions import SetOwnPassword\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.utils import set_own_login_name\n@@ -30,6 +32,20 @@ def __init__(self, context, request):\n         super().__init__(context, request)\n         self.params = []\n \n+    @property\n+    def is_zope_manager(self):\n+        return getSecurityManager().checkPermission(ManagePortal, self.context)\n+\n+    def can_change_roles(self, target_roles, current_roles):\n+        if self.is_zope_manager:\n+            return True\n+        return ("Manager" in current_roles) == ("Manager" in list(target_roles))\n+\n+    def can_change(self, current_roles):\n+        if self.is_zope_manager:\n+            return True\n+        return "Manager" not in current_roles\n+\n     def publishTraverse(self, request, name):\n         # Consume any path segments after /@users as parameters\n         self.params.append(name)\n@@ -67,7 +83,15 @@ def reply(self):\n         security = getAdapter(self.context, ISecuritySchema)\n \n         if self.can_manage_users:\n+            current_roles = user.getRoles()\n             for key, value in user_settings_to_update.items():\n+                if key in ["password", "email"]:\n+                    if not self.can_change(current_roles):\n+                        return self._error(\n+                            403,\n+                            "Forbidden",\n+                            _("You can\'t update this user"),\n+                        )\n                 if key == "password":\n                     self._change_user_password(user, value)\n                 elif key == "username":\n@@ -85,9 +109,16 @@ def reply(self):\n                 to_add = [key for key, enabled in roles.items() if enabled]\n                 to_remove = [key for key, enabled in roles.items() if not enabled]\n \n-                target_roles = set(user.getRoles()) - set(to_remove)\n+                target_roles = set(current_roles) - set(to_remove)\n                 target_roles = target_roles | set(to_add)\n \n+                if not self.can_change_roles(target_roles, current_roles):\n+                    return self._error(\n+                        403,\n+                        "Forbidden",\n+                        _("You can\'t update roles of this user"),\n+                    )\n+\n                 acl_users = getToolByName(self.context, "acl_users")\n                 acl_users.userFolderEditUser(\n                     principal_id=user.id,\n@@ -130,7 +161,7 @@ def reply(self):\n     @property\n     def can_manage_users(self):\n         sm = getSecurityManager()\n-        return sm.checkPermission("plone.app.controlpanel.UsersAndGroups", self.context)\n+        return sm.checkPermission(PloneManageUsers, self.context)\n \n     @property\n     def can_set_own_password(self):\ndiff --git a/src/plone/restapi/tests/http-examples/translated_messages_addons.resp b/src/plone/restapi/tests/http-examples/translated_messages_addons.resp\nindex 28fbcebaa4..6e7df00140 100644\n--- a/src/plone/restapi/tests/http-examples/translated_messages_addons.resp\n+++ b/src/plone/restapi/tests/http-examples/translated_messages_addons.resp\n@@ -69,8 +69,8 @@ Content-Type: application/json\n             "upgrade_info": {\n                 "available": false,\n                 "hasProfile": true,\n-                "installedVersion": "0006",\n-                "newVersion": "0006",\n+                "installedVersion": "0007",\n+                "newVersion": "0007",\n                 "required": false\n             },\n             "version": "1.2.3"\ndiff --git a/src/plone/restapi/tests/test_addons.py b/src/plone/restapi/tests/test_addons.py\nindex e309e861df..02a7f6262b 100644\n--- a/src/plone/restapi/tests/test_addons.py\n+++ b/src/plone/restapi/tests/test_addons.py\n@@ -120,7 +120,7 @@ def _get_upgrade_info(self):\n                 "available": True,\n                 "hasProfile": True,\n                 "installedVersion": "0002",\n-                "newVersion": "0006",\n+                "newVersion": "0007",\n                 "required": True,\n             },\n             _get_upgrade_info(self),\n@@ -134,8 +134,8 @@ def _get_upgrade_info(self):\n             {\n                 "available": False,\n                 "hasProfile": True,\n-                "installedVersion": "0006",\n-                "newVersion": "0006",\n+                "installedVersion": "0007",\n+                "newVersion": "0007",\n                 "required": False,\n             },\n             _get_upgrade_info(self),\n@@ -189,7 +189,7 @@ def _get_upgrade_info(self):\n                 "available": True,\n                 "hasProfile": True,\n                 "installedVersion": "0002",\n-                "newVersion": "0006",\n+                "newVersion": "0007",\n                 "required": True,\n             },\n             _get_upgrade_info(self),\ndiff --git a/src/plone/restapi/tests/test_serializer_group.py b/src/plone/restapi/tests/test_serializer_group.py\nindex 4be5e90ef3..41737e0c31 100644\n--- a/src/plone/restapi/tests/test_serializer_group.py\n+++ b/src/plone/restapi/tests/test_serializer_group.py\n@@ -1,4 +1,5 @@\n from plone import api\n+from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n from plone.restapi.interfaces import ISerializeToJson\n from plone.restapi.interfaces import ISerializeToJsonSummary\n@@ -58,3 +59,24 @@ def test_summary(self):\n         self.assertEqual("Plone Team", group.get("title"))\n         self.assertEqual("We are Plone", group.get("description"))\n         self.assertNotIn("users", group)\n+\n+    def test_serialize_group_with_member(self):\n+        setRoles(self.portal, TEST_USER_ID, ["Member"])\n+        group = self.serialize(self.group)\n+        self.assertEqual(\n+            {\n+                "@id": "http://nohost/plone/@groups/ploneteam",\n+                "id": "ploneteam",\n+                "groupname": "ploneteam",\n+                "email": "ploneteam@plone.org",\n+                "title": "Plone Team",\n+                "description": "We are Plone",\n+                "roles": ["Authenticated"],\n+                "members": {\n+                    "@id": "http://nohost",\n+                    "items_total": 1,\n+                    "items": ["test_user_1_"],\n+                },\n+            },\n+            group,\n+        )\ndiff --git a/src/plone/restapi/tests/test_serializer_user.py b/src/plone/restapi/tests/test_serializer_user.py\nindex e3971350f1..41ae20be6c 100644\n--- a/src/plone/restapi/tests/test_serializer_user.py\n+++ b/src/plone/restapi/tests/test_serializer_user.py\n@@ -1,5 +1,7 @@\n from DateTime import DateTime\n from plone import api\n+from plone.app.testing import setRoles\n+from plone.app.testing import TEST_USER_ID\n from plone.app.users.browser.schemaeditor import applySchema\n from plone.restapi.interfaces import ISerializeToJson\n from plone.restapi.testing import PLONE_RESTAPI_DX_INTEGRATION_TESTING\n@@ -49,7 +51,6 @@ def test_serialize_roles(self):\n         self.assertNotIn("Anonymous", user["roles"])\n \n     def test_serialize_custom_member_schema(self):\n-        from plone.app.users.browser.schemaeditor import applySchema\n \n         member_schema = """\n             <model xmlns="http://namespaces.plone.org/supermodel/schema"\n@@ -79,6 +80,32 @@ def test_serialize_custom_member_schema(self):\n         self.assertIn("twitter", res)\n         self.assertEqual(res["twitter"], "TheRealDuck")\n \n+    def test_serialize_user_with_member(self):\n+        setRoles(self.portal, TEST_USER_ID, ["Member"])\n+        user = self.serialize(self.user)\n+        self.assertEqual(\n+            {\n+                "@id": "http://nohost/plone/@users/noam",\n+                "id": "noam",\n+                "username": "noam",\n+                "roles": ["Member"],\n+                "fullname": "Noam Avram Chomsky",\n+                "email": "noam.chomsky@example.com",\n+                "home_page": "web.mit.edu/chomsky",\n+                "description": "Professor of Linguistics",\n+                "location": "Cambridge, MA",\n+                "portrait": None,\n+                "groups": {\n+                    "@id": "http://nohost",\n+                    "items_total": 1,\n+                    "items": [\n+                        {"id": "AuthenticatedUsers", "title": "AuthenticatedUsers"}\n+                    ],\n+                },\n+            },\n+            user,\n+        )\n+\n \n class TestSerializeUserCustomSchemaToJsonAdapter(unittest.TestCase):\n \ndiff --git a/src/plone/restapi/tests/test_services_groups.py b/src/plone/restapi/tests/test_services_groups.py\nindex 848df9351b..428069d845 100644\n--- a/src/plone/restapi/tests/test_services_groups.py\n+++ b/src/plone/restapi/tests/test_services_groups.py\n@@ -44,6 +44,20 @@ def setUp(self):\n     def tearDown(self):\n         self.api_session.close()\n \n+    def set_siteadm(self):\n+        siteadm_username = "siteadm"\n+        siteadm_password = "siteadmpassword"\n+        api.user.create(\n+            email="siteadm@example.com",\n+            roles=["Site Administrator"],\n+            username=siteadm_username,\n+            password=siteadm_password,\n+        )\n+        self.api_session = RelativeSession(self.portal_url, test=self)\n+        self.api_session.headers.update({"Accept": "application/json"})\n+        self.api_session.auth = (siteadm_username, siteadm_password)\n+        transaction.commit()\n+\n     def test_list_groups(self):\n         response = self.api_session.get("/@groups")\n \n@@ -173,3 +187,59 @@ def test_delete_non_existing_group(self):\n         transaction.commit()\n \n         self.assertEqual(response.status_code, 404)\n+\n+    def test_siteadm_not_add_user_to_group_with_manager_role(self):\n+        self.set_siteadm()\n+        payload = {\n+            "users": {TEST_USER_ID: True, SITE_OWNER_NAME: False},\n+        }\n+        self.api_session.patch("/@groups/Administrators", json=payload)\n+        transaction.commit()\n+\n+        administrators = self.gtool.getGroupById("Administrators")\n+        self.assertNotIn(TEST_USER_ID, administrators.getGroupMemberIds())\n+\n+    def test_siteadm_not_add_group_to_group_with_manager_role(self):\n+        self.set_siteadm()\n+        transaction.commit()\n+\n+        payload = {\n+            "groups": ["Administrators"],\n+        }\n+        self.api_session.patch("/@groups/ploneteam", json=payload)\n+        transaction.commit()\n+\n+        administrators = self.gtool.getGroupById("Administrators")\n+        self.assertNotIn("ploneteam", administrators.getGroupMemberIds())\n+\n+    def test_siteadm_not_set_manager_to_group(self):\n+        self.set_siteadm()\n+        payload = {\n+            "roles": ["Manager"],\n+        }\n+        self.api_session.patch("/@groups/ploneteam", json=payload)\n+        transaction.commit()\n+\n+        ploneteam = self.gtool.getGroupById("ploneteam")\n+        self.assertNotIn("Manager", ploneteam.getRoles())\n+\n+    def test_siteadm_not_add_group_with_manager_role(self):\n+        self.set_siteadm()\n+        self.api_session.post(\n+            "/@groups",\n+            json={\n+                "groupname": "fwt",\n+                "roles": ["Manager"],\n+            },\n+        )\n+        transaction.commit()\n+\n+        fwt = self.gtool.getGroupById("fwt")\n+        self.assertIsNone(fwt)\n+\n+    def test_siteadm_not_delete_group_with_manager_role(self):\n+        self.set_siteadm()\n+        self.api_session.delete("/@groups/Administrators")\n+        transaction.commit()\n+\n+        self.assertIsNotNone(self.gtool.getGroupById("Administrators"))\ndiff --git a/src/plone/restapi/tests/test_roles.py b/src/plone/restapi/tests/test_services_roles.py\nsimilarity index 58%\nrename from src/plone/restapi/tests/test_roles.py\nrename to src/plone/restapi/tests/test_services_roles.py\nindex 8946e1d134..3b10bf635f 100644\n--- a/src/plone/restapi/tests/test_roles.py\n+++ b/src/plone/restapi/tests/test_services_roles.py\n@@ -1,8 +1,10 @@\n+from plone import api\n from plone.app.testing import SITE_OWNER_NAME\n from plone.app.testing import SITE_OWNER_PASSWORD\n from plone.restapi.testing import PLONE_RESTAPI_DX_FUNCTIONAL_TESTING\n from plone.restapi.testing import RelativeSession\n \n+import transaction\n import unittest\n \n \n@@ -21,6 +23,20 @@ def setUp(self):\n     def tearDown(self):\n         self.api_session.close()\n \n+    def set_siteadm(self):\n+        siteadm_username = "siteadm"\n+        siteadm_password = "siteadmpassword"\n+        api.user.create(\n+            email="siteadm@example.com",\n+            roles=["Site Administrator"],\n+            username=siteadm_username,\n+            password=siteadm_password,\n+        )\n+        self.api_session = RelativeSession(self.portal_url, test=self)\n+        self.api_session.headers.update({"Accept": "application/json"})\n+        self.api_session.auth = (siteadm_username, siteadm_password)\n+        transaction.commit()\n+\n     def test_roles_endpoint_lists_roles(self):\n         response = self.api_session.get("/@roles")\n \n@@ -73,6 +89,59 @@ def test_roles_endpoint_lists_roles(self):\n         for item in result:\n             self.assertIn(item, expected)\n \n+    def test_siteadm_roles_endpoint_lists_roles(self):\n+        self.set_siteadm()\n+        response = self.api_session.get("/@roles")\n+\n+        expected = (\n+            {\n+                "@id": self.portal_url + "/@roles/Contributor",\n+                "@type": "role",\n+                "id": "Contributor",\n+                "title": "Contributor",\n+            },\n+            {\n+                "@id": self.portal_url + "/@roles/Editor",\n+                "@type": "role",\n+                "id": "Editor",\n+                "title": "Editor",\n+            },\n+            {\n+                "@id": self.portal_url + "/@roles/Member",\n+                "@type": "role",\n+                "id": "Member",\n+                "title": "Member",\n+            },\n+            {\n+                "@id": self.portal_url + "/@roles/Reader",\n+                "@type": "role",\n+                "id": "Reader",\n+                "title": "Reader",\n+            },\n+            {\n+                "@id": self.portal_url + "/@roles/Reviewer",\n+                "@type": "role",\n+                "id": "Reviewer",\n+                "title": "Reviewer",\n+            },\n+            {\n+                "@id": self.portal_url + "/@roles/Site Administrator",\n+                "@type": "role",\n+                "id": "Site Administrator",\n+                "title": "Site Administrator",\n+            },\n+            {\n+                "@id": self.portal_url + "/@roles/Manager",\n+                "@type": "role",\n+                "id": "Manager",\n+                "title": "Manager",\n+            },\n+        )\n+        result = response.json()\n+        self.assertEqual(len(expected), len(result))\n+        for item in result:\n+            self.assertIn(item, expected)\n+\n     def test_roles_endpoint_translates_role_titles(self):\n         self.api_session.headers.update({"Accept-Language": "de"})\n         response = self.api_session.get("/@roles")\ndiff --git a/src/plone/restapi/tests/test_services_users.py b/src/plone/restapi/tests/test_services_users.py\nindex 59cdd97d4e..b203743b3e 100644\n--- a/src/plone/restapi/tests/test_services_users.py\n+++ b/src/plone/restapi/tests/test_services_users.py\n@@ -102,6 +102,29 @@ def makeRealImage(self):\n         with open(path, "rb") as image:\n             yield dummy.FileUpload(dummy.FieldStorage(image))\n \n+    def set_siteadm(self):\n+        siteadm_username = "siteadm"\n+        siteadm_password = "siteadmpassword"\n+        api.user.create(\n+            email="siteadm@example.com",\n+            roles=["Site Administrator"],\n+            username=siteadm_username,\n+            password=siteadm_password,\n+        )\n+        self.api_session = RelativeSession(self.portal_url, test=self)\n+        self.api_session.headers.update({"Accept": "application/json"})\n+        self.api_session.auth = (siteadm_username, siteadm_password)\n+        transaction.commit()\n+\n+    def create_manager(self):\n+        api.user.create(\n+            email="manager@example.com",\n+            roles=["Manager"],\n+            username="manager",\n+            password="managerpassword",\n+        )\n+        transaction.commit()\n+\n     def test_list_users(self):\n         response = self.api_session.get("/@users")\n \n@@ -1312,3 +1335,104 @@ def getMemberById(self, userid):\n         self.assertEqual(len(users), 2)\n         self.assertEqual(users[0].userid, "user1")\n         self.assertEqual(users[1].userid, "user2")\n+\n+    def test_siteadm_not_update_manager(self):\n+        self.set_siteadm()\n+        payload = {\n+            "roles": {\n+                "Contributor": False,\n+                "Editor": False,\n+                "Reviewer": False,\n+                "Manager": True,\n+                "Member": True,\n+                "Reader": False,\n+                "Site Administrator": False,\n+            }\n+        }\n+\n+        self.api_session.patch("/@users/noam", json=payload)\n+        transaction.commit()\n+\n+        noam = api.user.get(userid="noam")\n+        self.assertNotIn("Manager", noam.getRoles())\n+\n+    def test_manager_update_manager(self):\n+        payload = {\n+            "roles": {\n+                "Contributor": False,\n+                "Editor": False,\n+                "Reviewer": False,\n+                "Manager": True,\n+                "Member": True,\n+                "Reader": False,\n+                "Site Administrator": False,\n+            }\n+        }\n+\n+        self.api_session.patch("/@users/noam", json=payload)\n+        transaction.commit()\n+\n+        noam = api.user.get(userid="noam")\n+        self.assertIn("Manager", noam.getRoles())\n+\n+    def test_siteadm_not_delete_manager(self):\n+        self.set_siteadm()\n+        api.user.grant_roles(username="noam", roles=["Manager"])\n+        transaction.commit()\n+        self.api_session.delete("/@users/noam")\n+        transaction.commit()\n+\n+        self.assertIsNotNone(api.user.get(userid="noam"))\n+\n+    def test_siteadm_not_add_manager(self):\n+        self.set_siteadm()\n+        self.api_session.post(\n+            "/@users",\n+            json={\n+                "username": "howard",\n+                "email": "howard.zinn2@example.com",\n+                "password": "peopleshistory",\n+                "roles": ["Manager"],\n+            },\n+        )\n+        transaction.commit()\n+\n+        self.assertIsNone(api.user.get(userid="howard"))\n+\n+    def test_siteadm_not_change_manager_password(self):\n+        self.set_siteadm()\n+        self.create_manager()\n+        self.api_session.patch(\n+            "/@users/manager",\n+            json={\n+                "password": "newmanagerpassword",\n+            },\n+        )\n+        transaction.commit()\n+\n+        response = self.api_session.post(\n+            "/@login",\n+            json={\n+                "login": "manager",\n+                "password": "newmanagerpassword",\n+            },\n+        )\n+\n+        self.assertEqual(\n+            "Wrong login and/or password.", response.json()["error"]["message"]\n+        )\n+\n+    def test_siteadm_not_change_manager_email(self):\n+        self.set_siteadm()\n+        self.create_manager()\n+        self.api_session.patch(\n+            "/@users/manager",\n+            json={\n+                "email": "newmanageremail@test.com",\n+            },\n+        )\n+        transaction.commit()\n+\n+        self.assertEqual(\n+            "manager@example.com", api.user.get(userid="manager").getProperty("email")\n+        )\ndiff --git a/src/plone/restapi/tests/test_upgrades.py b/src/plone/restapi/tests/test_upgrades.py\nindex 63c9ca7374..e587cb9983 100644\n--- a/src/plone/restapi/tests/test_upgrades.py\n+++ b/src/plone/restapi/tests/test_upgrades.py\n@@ -1,3 +1,6 @@\n+from AccessControl.SecurityManagement import getSecurityManager\n+from plone.app.testing import setRoles\n+from plone.app.testing import TEST_USER_ID\n from plone.app.upgrade.utils import loadMigrationProfile\n from plone.restapi.testing import PLONE_RESTAPI_DX_INTEGRATION_TESTING\n from Products.CMFCore.utils import getToolByName\n@@ -40,3 +43,35 @@ def test_run_migration_profile_to_0005(self):\n         portal_setup = getToolByName(self.portal, "portal_setup")\n         rename_tiles_to_blocks(portal_setup)\n         self.assertTrue(True)\n+\n+    def previous_state_0007(self):\n+        self.portal.manage_permission(\n+            "plone.restapi: Access Plone user information",\n+            roles=["Manager"],\n+            acquire=1,\n+        )\n+\n+    def test_previous_state_0007(self):\n+        self.previous_state_0007()\n+        setRoles(self.portal, TEST_USER_ID, ["Site Administrator"])\n+        sm = getSecurityManager()\n+        self.assertIsNone(\n+            sm.checkPermission(\n+                "plone.restapi: Access Plone user information", self.portal\n+            )\n+        )\n+\n+    def test_run_migration_profile_to_0007(self):\n+        self.previous_state_0007()\n+        from plone.restapi.upgrades.to0007 import site_administrator_permission\n+\n+        portal_setup = getToolByName(self.portal, "portal_setup")\n+        site_administrator_permission(portal_setup)\n+\n+        setRoles(self.portal, TEST_USER_ID, ["Site Administrator"])\n+        sm = getSecurityManager()\n+        self.assertTrue(\n+            sm.checkPermission(\n+                "plone.restapi: Access Plone user information", self.portal\n+            )\n+        )\ndiff --git a/src/plone/restapi/upgrades/configure.zcml b/src/plone/restapi/upgrades/configure.zcml\nindex 66bb67b0d7..ab6cae887d 100644\n--- a/src/plone/restapi/upgrades/configure.zcml\n+++ b/src/plone/restapi/upgrades/configure.zcml\n@@ -69,4 +69,13 @@\n       handler="plone.restapi.upgrades.to0006.rename_iface_to_name_in_blocks_behavior"\n       />\n \n+  <genericsetup:upgradeStep\n+      title="Give permission plone.restapi: Access Plone user information to Site Administrator"\n+      description=""\n+      profile="plone.restapi:default"\n+      source="0006"\n+      destination="0007"\n+      handler="plone.restapi.upgrades.to0007.site_administrator_permission"\n+      />\n+\n </configure>\ndiff --git a/src/plone/restapi/upgrades/to0007.py b/src/plone/restapi/upgrades/to0007.py\nnew file mode 100644\nindex 0000000000..7253e331ad\n--- /dev/null\n+++ b/src/plone/restapi/upgrades/to0007.py\n@@ -0,0 +1,19 @@\n+from plone import api\n+\n+import logging\n+\n+\n+logger = logging.getLogger(__name__)\n+\n+\n+def site_administrator_permission(setup_context):\n+    """Give permission plone.restapi: Access Plone user information to\n+    Site Administrator"""\n+    api.portal.get().manage_permission(\n+        "plone.restapi: Access Plone user information",\n+        roles=["Manager", "Site Administrator"],\n+        acquire=1,\n+    )\n+    logger.info(\n+        "Give permission plone.restapi: Access Plone user information to Site Administrator"\n+    )\n'

