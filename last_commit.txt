Repository: plone.app.event


Branch: refs/heads/master
Date: 2021-02-13T09:56:05+01:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.event/commit/8efd1d053471c393e2b24810057acc36a535b5cb

Barceloneta LTS (#323)

* Remove unnecessary required markers from fields

* fix outdated pull classes

* update markup for bootstrap

* bootstrap b1 changes

* feature complete event_view

* try to fix robottests - failed ðŸ˜¢

* update event summary

* major version bump

Co-authored-by: Peter Holzer &lt;peter.holzer@agitator.com&gt;

Files changed:
A plone/app/event/tests/robot/variables.py
M plone/app/event/browser/event_summary.pt
M plone/app/event/portlets/portlet_calendar.pt
M plone/app/event/portlets/portlet_events.pt
M plone/app/event/portlets/portlet_events.py
M plone/app/event/testing.py
M plone/app/event/tests/INACTIVE_test_robot.py
M plone/app/event/tests/robot/test_event_roundtrip.robot
M plone/app/event/tests/test_event_summary.py
M setup.py

b'diff --git a/plone/app/event/browser/event_summary.pt b/plone/app/event/browser/event_summary.pt\nindex 0a62c7cb..61a58654 100644\n--- a/plone/app/event/browser/event_summary.pt\n+++ b/plone/app/event/browser/event_summary.pt\n@@ -5,136 +5,165 @@\n       lang="en"\n       i18n:domain="plone"\n       tal:omit-tag="">\n-<body tal:omit-tag="">\n-\n-<tal:def tal:define="data python:view.data; excludes view/excludes">\n-\n-  <ul class="event summary details" summary="Event details" i18n:attributes="summary summary_event_details">\n-\n-    <tal:cond condition="python:\'title\' not in excludes">\n-      <li class="event-title">\n-        <strong i18n:translate="event_event">Event</strong>\n-        <a tal:attributes="href data/url" tal:content="data/title">title</a>\n-      </li>\n-    </tal:cond>\n-\n-    <tal:cond condition="python:\'subjects\' not in excludes">\n-    <tal:cond condition="data/subjects">\n-      <li class="event-category">\n-        <strong i18n:translate="event_what">What</strong>\n-        <span itemprop="disambiguatingDescription" tal:repeat="item data/subjects" tal:content="item" />\n-      </li>\n-    </tal:cond>\n-    </tal:cond>\n-\n-    <tal:cond condition="python:\'date\' not in excludes">\n-      <li class="event-date">\n-        <strong i18n:translate="event_when">When</strong>\n-        <span tal:define="start_tzname data/timezone;\n-                      start_utcdelta python:data.start.tzinfo.utcoffset(data.start);\n-                      start_utcoffset python:(start_utcdelta.days*86400+start_utcdelta.seconds)*100/60/60;\n-                      start_utcoffset python:int(start_utcoffset)">\n-          <tal:date replace="structure python:view.formatted_date(context)" />\n-          <span class="timezone"\n-              tal:condition="start_tzname">\n-            (<tal:tzname replace="start_tzname">timezone name</tal:tzname> / UTC<tal:tzoffset replace="start_utcoffset" />)\n-          </span>\n-        </span>\n-      </li>\n-    </tal:cond>\n-\n-    <tal:cond condition="python:\'occurrences\' not in excludes">\n-    <tal:cond define="next_occs view/next_occurrences;\n-                      all_occs view/num_more_occurrences"\n-              condition="python:len(next_occs) > 1 or all_occs > 1">\n-      <li class="event-dates">\n-        <strong i18n:translate="">\n-          All dates\n-        </strong>\n-        <span tal:repeat="occ next_occs">\n-          <tal:def define="this_is_occ python: occ.absolute_url() == context.absolute_url()">\n-          <a tal:attributes="href occ/absolute_url" tal:omit-tag="this_is_occ">\n-            <strong tal:omit-tag="not: this_is_occ">\n-              <tal:date replace="structure python:view.formatted_date(occ)"/>\n-            </strong>\n-          </a>\n-          </tal:def>\n-        </span>\n-        <span tal:condition="view/num_more_occurrences">\n-          <a tal:attributes="href string:${view/event_context/absolute_url}/@@event_listing"\n-              tal:content="view/more_occurrences_text">\n-            There are 12 more occurrences.\n-          </a>\n-        </span>\n-      </li>\n-    </tal:cond>\n-    </tal:cond>\n-\n-    <tal:cond condition="python:\'location\' not in excludes">\n-    <tal:cond condition="data/location">\n-      <li class="event-location" itemprop="location" itemscope itemtype="http://schema.org/Place">\n-        <strong i18n:translate="event_where">Where</strong>\n-        <span itemprop="address" tal:content="data/location" >Location</span>\n-      </li>\n-    </tal:cond>\n-    </tal:cond>\n-\n-    <tal:cond condition="python:\'contact\' not in excludes">\n-    <tal:cond define="mail data/contact_email; name data/contact_name;" tal:condition="python:name or mail">\n-      <li class="event-contact">\n-        <strong i18n:translate="contact_name">Contact Name</strong>\n-        <tal:span>\n-          <a class="email" tal:condition="mail" tal:attributes="href string:mailto:${mail}" tal:content="name" />\n-          <span tal:condition="not:mail" tal:content="name" />\n-        </tal:span>\n-      </li>\n-    </tal:cond>\n-\n-    <tal:cond condition="data/contact_phone">\n-      <li class="event-tel">\n-        <strong i18n:translate="contact_phone">Contact Phone</strong>\n-        <span tal:content="data/contact_phone">Contact Phone</span>\n-      </li>\n-    </tal:cond>\n-\n-    <tal:cond condition="data/attendees|nothing">\n-      <li class="event-attendee">\n-        <strong i18n:translate="contact_attendees">Attendees</strong>\n-        <span itemprop="attendee" tal:repeat="item data/attendees" tal:content="item" />\n-      </li>\n-    </tal:cond>\n-    </tal:cond>\n-\n-    <tal:cond condition="python:\'event_url\' not in excludes">\n-    <tal:cond condition="data/event_url">\n-      <li class="event-url">\n-        <strong i18n:translate="event_url">Web</strong>\n-        <tal:span>\n-          <a href="" tal:attributes="href data/event_url" i18n:translate="external_website">Visit external website</a>\n-        </tal:span>\n-      </li>\n-    </tal:cond>\n-    </tal:cond>\n-\n-    <tal:cond condition="python:\'ical\' not in excludes">\n-      <li class="event-calendar">\n-        <strong i18n:translate="heading_add_to_calendar">Add event to calendar</strong>\n-        <tal:span tal:define="here_url context/@@plone_context_state/object_url;\n-                        portal_url context/@@plone_portal_state/portal_url;">\n-          <a href="#" rel="nofollow"\n-             tal:attributes="href string:$here_url/ics_view"\n-             title="Download this event in iCal format"\n-             i18n:attributes="title title_add_to_ical;">\n-            <img src="" alt="" width="14" height="14" class="icalIcon"\n-                tal:attributes="src string:${portal_url}/++plone++plone.app.event/calendar.svg"/>\n-            <span i18n:translate="label_add_to_ical">iCal</span></a>\n-        </tal:span>\n-      </li>\n-    </tal:cond>\n-\n-  </ul>\n-\n-</tal:def>\n-\n-</body>\n+\n+  <div class="card event-summary">\n+    <div class="card-body pb-1 row"\n+         tal:define="portal_url context/@@plone_portal_state/portal_url;\n+                     data python:view.data;\n+                     excludes view/excludes;\n+                     icons python:context.restrictedTraverse(\'@@iconresolver\')">\n+\n+      <div class="col-md-6">\n+\n+        <div class="mb-3 d-flex">\n+          <div class="meta-icon">\n+            <tal:icon replace="structure python:icons.tag(\'calendar\')" />\n+          </div>\n+          <div>\n+            <strong class="meta-label" i18n:translate="event_when">When</strong>\n+            <p class="card-text h4">\n+              <span tal:define="start_tzname data/timezone;\n+                                start_utcdelta python:data.start.tzinfo.utcoffset(data.start);\n+                                start_utcoffset python:(start_utcdelta.days*86400+start_utcdelta.seconds)*100/60/60;\n+                                start_utcoffset python:int(start_utcoffset)">\n+                <tal:date replace="structure python:view.formatted_date(context)" />\n+                <span class="timezone text-muted"\n+                      tal:condition="start_tzname"><br />\n+                  (<tal:tzname replace="start_tzname">timezone name</tal:tzname> / UTC<tal:tzoffset replace="start_utcoffset" />)\n+                </span>\n+              </span>\n+            </p>\n+          </div>\n+        </div>\n+\n+        <tal:cond condition="python:\'occurrences\' not in excludes">\n+        <div class="mb-3"\n+             tal:define="next_occs view/next_occurrences;\n+                         all_occs view/num_more_occurrences"\n+              tal:condition="python:len(next_occs) > 1 or all_occs > 1">\n+          <div class="d-flex">\n+            <div class="meta-icon">\n+              <tal:icon replace="structure python:icons.tag(\'calendar-week\')" />\n+            </div>\n+            <div>\n+              <strong class="meta-label" i18n:translate="">\n+                All dates\n+              </strong>\n+              <p class="card-text">\n+                <span tal:repeat="occ next_occs">\n+                  <tal:def define="this_is_occ python: occ.absolute_url() == context.absolute_url()">\n+                  <a tal:attributes="href occ/absolute_url" tal:omit-tag="this_is_occ">\n+                    <strong tal:omit-tag="not: this_is_occ">\n+                      <tal:date replace="structure python:view.formatted_date(occ)"/>\n+                    </strong>\n+                  </a>\n+                  </tal:def>\n+                  <br />\n+                </span>\n+                <span tal:condition="view/num_more_occurrences">\n+                  <a tal:attributes="href string:${view/event_context/absolute_url}/@@event_listing"\n+                      tal:content="view/more_occurrences_text">\n+                    There are 12 more occurrences.\n+                  </a>\n+                </span>\n+              </p>\n+            </div>\n+          </div>\n+        </div>\n+        </tal:cond>\n+\n+      </div>\n+\n+      <div class="col-md-6">\n+\n+        <div class="row row-cols-1 row-cols-xl-2">\n+\n+          <div class="col mb-3" tal:condition="python: data.location and \'location\' not in excludes">\n+            <div class="d-flex">\n+              <div class="meta-icon">\n+                <tal:icon replace="structure python:icons.tag(\'geo-alt\')" />\n+              </div>\n+              <div>\n+                <strong class="meta-label" i18n:translate="event_where">Where</strong>\n+                <p class="card-text" itemprop="location" tal:content="data/location">Location</p>\n+              </div>\n+            </div>\n+          </div>\n+\n+          <tal:cond condition="python:\'contact\' not in excludes">\n+\n+          <div class="col mb-3" tal:define="mail data/contact_email; name data/contact_name;" tal:condition="python:name or mail">\n+            <div class="d-flex">\n+              <div class="meta-icon">\n+                <tal:icon replace="structure python:icons.tag(\'person\')" />\n+              </div>\n+              <div>\n+                <strong class="meta-label" i18n:translate="contact_name">Contact Name</strong>\n+                <p class="card-text" tal:condition="mail"><a class="email" tal:attributes="href string:mailto:${mail}" tal:content="name">Mail</a></p>\n+                <p class="card-text" tal:condition="not:mail" tal:content="name">Name</p>\n+              </div>\n+            </div>\n+          </div>\n+\n+          <div class="col mb-3" tal:condition="data/contact_phone">\n+            <div class="d-flex">\n+              <div class="meta-icon">\n+                <tal:icon replace="structure python:icons.tag(\'phone\')" />\n+              </div>\n+              <div>\n+                <strong class="meta-label" i18n:translate="contact_phone">Contact Phone</strong>\n+                <p class="card-text"><a href="tel:${data/contact_phone}" title="" i18n:attributes="title contact_phone" tal:content="data/contact_phone">Contact Phone</a></p>\n+              </div>\n+            </div>\n+          </div>\n+\n+          <div class="col mb-3" tal:condition="data/attendees|nothing">\n+            <div class="d-flex">\n+              <div class="meta-icon">\n+                <tal:icon replace="structure python:icons.tag(\'people\')" />\n+              </div>\n+              <div>\n+                <strong class="meta-label" i18n:translate="contact_attendees">Attendees</strong>\n+                <p class="card-text">\n+                  <tal:attendees tal:repeat="item data/attendees"><span class="text-no-wrap" tal:content="item">Attendee</span><span tal:condition="not:repeat/item/end">, </span></tal:attendees>\n+                </p>\n+              </div>\n+            </div>\n+          </div>\n+\n+          </tal:cond>\n+\n+          <div class="col mb-3" tal:condition="python: data.event_url and \'event_url\' not in excludes">\n+            <div class="d-flex">\n+              <div class="meta-icon">\n+                <tal:icon replace="structure python:icons.tag(\'laptop\')" />\n+              </div>\n+              <div>\n+                <strong class="meta-label" i18n:translate="event_url">Web</strong>\n+                <p class="card-text"><a href="" tal:attributes="href data/event_url" i18n:translate="external_website">Visit external website</a></p>\n+              </div>\n+            </div>\n+          </div>\n+\n+          <div class="col mb-3" tal:condition="python:\'ical\' not in excludes">\n+            <div class="d-flex">\n+              <div class="meta-icon">\n+                <tal:icon replace="structure python:icons.tag(\'calendar-plus\')" />\n+              </div>\n+              <div>\n+                <strong class="meta-label" i18n:translate="heading_add_to_calendar">Add event to calendar</strong>\n+                <p class="card-text" tal:define="here_url context/@@plone_context_state/object_url">\n+                  <a href="#" rel="nofollow" tal:attributes="href string:$here_url/ics_view" title="Download this event in iCal format" i18n:attributes="title title_add_to_ical;">iCal</a>\n+                </p>\n+              </div>\n+            </div>\n+          </div>\n+\n+        </div>\n+\n+      </div>\n+\n+    </div>\n+  </div>\n+\n </html>\ndiff --git a/plone/app/event/portlets/portlet_calendar.pt b/plone/app/event/portlets/portlet_calendar.pt\nindex f17f21da..e2da9fc6 100644\n--- a/plone/app/event/portlets/portlet_calendar.pt\n+++ b/plone/app/event/portlets/portlet_calendar.pt\n@@ -3,80 +3,79 @@\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       i18n:domain="plone"\n       tal:omit-tag="">\n-<section class="portlet portletCalendar" role="section"\n-    tal:define="navigation_root_url context/@@plone_portal_state/navigation_root_url;\n-                month view/month;\n-                year view/year;">\n \n-  <header class="portletHeader">\n-    <a href="#" rel="nofollow" class="calendarPrevious pat-contentloader" title="Previous month"\n-        tal:define="prev_month view/prev_month;\n-                    prev_year view/prev_year"\n-        tal:attributes="href view/prev_query;\n-                        data-year prev_year;\n-                        data-month prev_month;\n-                        data-pat-contentloader python: view.nav_pattern_options(prev_year, prev_month)"\n-        i18n:attributes="title title_previous_month;">&laquo;</a>\n+  <div class="card portlet portlet-calendar"\n+      tal:define="navigation_root_url context/@@plone_portal_state/navigation_root_url; month view/month; year view/year;">\n \n-    <span i18n:translate="" tal:omit-tag="">\n-      <span i18n:name="monthname" i18n:translate=""\n-          tal:content="view/month_name"\n-          tal:omit-tag="">monthname</span>\n-      <span i18n:name="year" i18n:translate=""\n-          tal:content="year"\n-          tal:omit-tag="">year</span>\n-    </span>\n+    <div class="card-header text-center">\n+      <a href="#" rel="nofollow" class="calendarPrevious pat-contentloader" title="Previous month"\n+          tal:define="prev_month view/prev_month;\n+                      prev_year view/prev_year"\n+          tal:attributes="href view/prev_query;\n+                          data-year prev_year;\n+                          data-month prev_month;\n+                          data-pat-contentloader python: view.nav_pattern_options(prev_year, prev_month)"\n+          i18n:attributes="title title_previous_month;">&laquo;</a>\n \n-    <a href="#" rel="nofollow" class="calendarNext pat-contentloader" title="Next month"\n-         tal:define="next_month view/next_month;\n-                     next_year view/next_year"\n-         tal:attributes="href view/next_query;\n-                         data-year next_year;\n-                         data-month next_month;\n-                         data-pat-contentloader python: view.nav_pattern_options(next_year, next_month)"\n-         i18n:attributes="title title_next_month;">&raquo;</a>\n-  </header>\n+      <span i18n:translate="" tal:omit-tag="">\n+        <span i18n:name="monthname" i18n:translate=""\n+            tal:content="view/month_name"\n+            tal:omit-tag="">monthname</span>\n+        <span i18n:name="year" i18n:translate=""\n+            tal:content="year"\n+            tal:omit-tag="">year</span>\n+      </span>\n \n-  <section class="portletContent">\n-    <table class="ploneCalendar" summary="Calendar"\n-        i18n:attributes="summary summary_calendar">\n-      <caption class="hiddenStructure"\n-          i18n:translate="" tal:content="string:month-${month}">monthname</caption>\n-      <thead>\n-        <tr class="weekdays"><tal:data repeat="weekday view/weekdays">\n-          <th scope="col" i18n:translate="" tal:content="weekday">Su</th>\n-        </tal:data></tr>\n-      </thead>\n-      <tbody>\n-        <tr tal:repeat="week view/cal_data">\n-          <tal:block repeat="day week">\n-          <td class="event"\n-              tal:define="today day/today;\n-                          next_month day/next_month;\n-                          prev_month day/prev_month;\n-                          events day/events;\n-                          limit python:len(events) if events is not None else 0"\n-              tal:attributes="class python:u\'event%s%s%s%s\' %\n-                          ((\' today\' if today else \'\'),\n-                          (\' cal_next_month\' if next_month else \'\'),\n-                          (\' cal_prev_month\' if prev_month else \'\'),\n-                          (\' cal_has_events\' if events else \'\'))">\n-            <tal:comment tal:condition="nothing">Add span or a to style td children and not td</tal:comment>\n-            <span\n-                tal:condition="not:events"\n-                tal:content="day/day"></span>\n-            <a href=""\n-                tal:condition="events"\n-                tal:attributes="href python:view.date_events_url(day[\'date_string\']);\n-                                title day/events_string;"\n-                \n-                tal:content="day/day">31</a>\n+      <a href="#" rel="nofollow" class="calendarNext pat-contentloader" title="Next month"\n+            tal:define="next_month view/next_month;\n+                        next_year view/next_year"\n+            tal:attributes="href view/next_query;\n+                            data-year next_year;\n+                            data-month next_month;\n+                            data-pat-contentloader python: view.nav_pattern_options(next_year, next_month)"\n+            i18n:attributes="title title_next_month;">&raquo;</a>\n+    </div>\n \n-          </td>\n-          </tal:block>\n-        </tr>\n-      </tbody>\n-    </table>\n-  </section>\n-</section>\n-</html>\n+    <div class="card-body table-responsive">\n+      <table class="table table-sm table-borderless mb-0" summary="Calendar" i18n:attributes="summary summary_calendar">\n+        <caption class="hiddenStructure" i18n:translate="" tal:content="string:month-${month}">monthname</caption>\n+        <thead>\n+          <tr class="weekdays"><tal:data repeat="weekday view/weekdays">\n+            <th scope="col" i18n:translate="" tal:content="weekday">Su</th>\n+          </tal:data></tr>\n+        </thead>\n+        <tbody>\n+          <tr tal:repeat="week view/cal_data">\n+            <tal:block repeat="day week">\n+            <td class="event"\n+                tal:define="today day/today;\n+                            next_month day/next_month;\n+                            prev_month day/prev_month;\n+                            events day/events;\n+                            limit python:len(events) if events is not None else 0"\n+                tal:attributes="class python:u\'event%s%s%s%s\' %\n+                            ((\' today\' if today else \'\'),\n+                            (\' cal_next_month\' if next_month else \'\'),\n+                            (\' cal_prev_month\' if prev_month else \'\'),\n+                            (\' cal_has_events\' if events else \'\'))">\n+              <tal:comment tal:condition="nothing">Add span or a to style td children and not td</tal:comment>\n+              <span\n+                  tal:condition="not:events"\n+                  tal:content="day/day"></span>\n+              <a href=""\n+                  tal:condition="events"\n+                  tal:attributes="href python:view.date_events_url(day[\'date_string\']);\n+                                  title day/events_string;"\n+\n+                  tal:content="day/day">31</a>\n+\n+            </td>\n+            </tal:block>\n+          </tr>\n+        </tbody>\n+      </table>\n+    </div>\n+\n+  </div>\n+\n+</html>\n\\ No newline at end of file\ndiff --git a/plone/app/event/portlets/portlet_events.pt b/plone/app/event/portlets/portlet_events.pt\nindex 2d3ba092..7e7bd832 100644\n--- a/plone/app/event/portlets/portlet_events.pt\n+++ b/plone/app/event/portlets/portlet_events.pt\n@@ -2,70 +2,74 @@\n       xmlns:tal="http://xml.zope.org/namespaces/tal"\n       xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n       tal:omit-tag="">\n-<section class="portlet portletEvents"\n-    i18n:domain="plone">\n \n-  <header class="portletHeader">\n-    <a href="" class="tile"\n-        tal:define="next_link view/next_url"\n-        tal:omit-tag="not:next_link"\n-        tal:attributes="href next_link"\n-        i18n:translate="box_events">\n-        Upcoming Events\n-    </a>\n-  </header>\n-  <section class="portletContent">\n-    <ul tal:define="thumb_scale view/thumb_scale">\n-      <tal:events repeat="item view/events">\n-      <li class="portletItem"\n-          tal:define="oddrow repeat/item/odd;\n-                      item_url      item/url;\n-                      item_descr    item/description;\n-                      item_title    item/title;\n-                      item_location item/location;\n-                      item_hasimage item/context/image|nothing"\n-          tal:attributes="class python:\'portletItem odd\' if oddrow else \'portletItem even\'">\n-        <a href="#" class="tile"\n-            tal:attributes="href item_url;\n-                            title item_descr"\n-            tal:define="scale item/context/@@images|nothing;">\n-          <span tal:condition="item_hasimage">\n-              <img tal:define="img_tag python:scale.scale(\'image\', scale=thumb_scale).tag(css_class=\'pull-right thumb-\'+thumb_scale)"\n-                   tal:replace="structure img_tag" />\n-          </span>\n-          <span tal:replace="item_title">Some Event</span>\n-        </a>\n-        <span class="portletItemDetails">\n-          <tal:date replace="structure python:view.formatted_date(item)" /><br />\n-          <span class="timezone"\n-              tal:define="tz item/timezone"\n-              tal:condition="tz">\n-            (<tal:tzname replace="tz">TZ</tal:tzname>)\n-          </span>\n-          <span class="location"\n-              tal:condition="item_location"> &mdash;\n-            <tal:location content="item_location">Location</tal:location>\n+  <div class="card portlet portletEvents"\n+      i18n:domain="plone">\n+\n+    <div class="card-header portletHeader">\n+      <a href="" class="tile"\n+          tal:define="next_link view/next_url"\n+          tal:omit-tag="not:next_link"\n+          tal:attributes="href next_link"\n+          i18n:translate="box_events">\n+          Upcoming Events\n+      </a>\n+    </div>\n+\n+    <div class="card-body portletContent">\n+      <ul tal:define="thumb_scale view/thumb_scale">\n+        <tal:events repeat="item view/events">\n+        <li class="portletItem"\n+            tal:define="oddrow repeat/item/odd;\n+                        item_url      item/url;\n+                        item_descr    item/description;\n+                        item_title    item/title;\n+                        item_location item/location;\n+                        item_hasimage item/context/image|nothing"\n+            tal:attributes="class python:\'portletItem odd\' if oddrow else \'portletItem even\'">\n+          <a href="#" class="tile"\n+              tal:attributes="href item_url;\n+                              title item_descr"\n+              tal:define="scale item/context/@@images|nothing;">\n+            <span tal:condition="item_hasimage">\n+              <img tal:define="img_tag python:scale.scale(\'image\', scale=thumb_scale).tag(css_class=\'float-end thumb-\'+thumb_scale)"\n+                  tal:replace="structure img_tag" />\n+            </span>\n+            <span tal:replace="item_title">Some Event</span>\n+          </a>\n+          <span class="portletItemDetails">\n+            <tal:date replace="structure python:view.formatted_date(item)" />\n+            <span class="timezone"\n+                tal:define="tz item/timezone"\n+                tal:condition="tz">\n+              (<tal:tzname replace="tz">TZ</tal:tzname>)\n+            </span>\n+            <span class="location"\n+                tal:condition="item_location"> &mdash;\n+              <tal:location content="item_location">Location</tal:location>\n+            </span>\n           </span>\n-        </span>\n-      </li>\n-      </tal:events>\n-    </ul>\n-  </section>\n-  <footer class="portletFooter">\n-    <a class="tile previous-events"\n-        tal:define="prev_link view/prev_url"\n-        tal:condition="prev_link"\n-        tal:attributes="href prev_link"\n-        i18n:translate="box_previous_events">\n-      Previous events&hellip;\n-    </a>\n-    <br />\n-    <a class="tile upcoming-events"\n-        tal:define="next_link view/next_url"\n-        tal:attributes="href next_link"\n-        i18n:translate="box_upcoming_events">\n-      Upcoming events&hellip;\n-    </a>\n-  </footer>\n-</section>\n-</html>\n+        </li>\n+        </tal:events>\n+      </ul>\n+    </div>\n+\n+    <div class="card-footer portletFooter d-flex justify-content-around">\n+      <a class="p-6 tile previous-events"\n+          tal:define="prev_link view/prev_url"\n+          tal:condition="prev_link"\n+          tal:attributes="href prev_link"\n+          i18n:translate="box_previous_events">\n+        Previous events&hellip;\n+      </a>\n+      <a class="p-6 tile upcoming-events"\n+          tal:define="next_link view/next_url"\n+          tal:attributes="href next_link"\n+          i18n:translate="box_upcoming_events">\n+        Upcoming events&hellip;\n+      </a>\n+    </div>\n+\n+  </div>\n+\n+</html>\n\\ No newline at end of file\ndiff --git a/plone/app/event/portlets/portlet_events.py b/plone/app/event/portlets/portlet_events.py\nindex cec1a60e..fe902e3a 100644\n--- a/plone/app/event/portlets/portlet_events.py\n+++ b/plone/app/event/portlets/portlet_events.py\n@@ -76,7 +76,7 @@ class IEventsPortlet(IPortletDataProvider):\n         title=_(u"Suppress thumbs"),\n         description=_(\n             u"If enabled, the portlet will not show thumbs."),\n-        required=True,\n+        required=False,\n         default=False)\n \n \ndiff --git a/plone/app/event/testing.py b/plone/app/event/testing.py\nindex 6be08d56..4c60b4d4 100644\n--- a/plone/app/event/testing.py\n+++ b/plone/app/event/testing.py\n@@ -112,17 +112,11 @@ class PAEventDXLayer(PloneSandboxLayer):\n \n     def setUpZope(self, app, configurationContext):\n         self.ostz = os_zone()\n-        # Load ZCML\n-        import plone.app.contenttypes\n-        self.loadZCML(package=plone.app.contenttypes,\n-                      context=configurationContext)\n-\n         import plone.app.event.dx\n         self.loadZCML(package=plone.app.event.dx,\n                       context=configurationContext)\n \n     def setUpPloneSite(self, portal):\n-        self.applyProfile(portal, \'plone.app.contenttypes:default\')\n         self.applyProfile(portal, \'plone.app.event:testing\')\n         set_timezone(tz=\'UTC\')\n \ndiff --git a/plone/app/event/tests/INACTIVE_test_robot.py b/plone/app/event/tests/INACTIVE_test_robot.py\nindex 33d0e7b4..f155d5b2 100644\n--- a/plone/app/event/tests/INACTIVE_test_robot.py\n+++ b/plone/app/event/tests/INACTIVE_test_robot.py\n@@ -1,26 +1,32 @@\n-from plone.app.event.testing import PAEventDX_ROBOT_TESTING\n-from plone.app.testing.interfaces import ROBOT_TEST_LEVEL\n-from plone.testing import layered\n-\n+# -*- conding: utf-8 -*-\n+import os\n import robotsuite\n import unittest\n \n+from plone.app.event.testing import PAEventDX_ROBOT_TESTING\n+from plone.app.testing import ROBOT_TEST_LEVEL\n+from plone.testing import layered\n+\n \n-# TODO: Remove\n-# The robot test fails irregularily, most probably when run on end-of-day, even\n-# with this fix in place:\n-# https://github.com/plone/plone.app.event/commit/623cec04872a847e2b9f810346424a6d663c6370\n-# Example test failure:\n-# Job started: 31.08.2014 22:07:05\n-# http://jenkins.plone.org/job/plone-5.0-python-2.7/3136/testReport/junit/plone.app.event.tests.test_robot/RobotTestCase/Scenario_Create_and_view_an_event/  # noqa\n-# Scenario: plone.app.event.tests.test_robot.RobotTestCase.Scenario Create and view an event  # noqa\n-# Message: Value of text field \'css=#formfield-form-widgets-IEventBasic-end input.pattern-pickadate-date\' should have been \'February 10, 2014\' but was \'February 11, 2014\'  # noqa\n-@unittest.skip("Skipping due to irregular failures")\n-def INACTIVE_test_suite():\n+def test_suite():\n     suite = unittest.TestSuite()\n-    suite.level = ROBOT_TEST_LEVEL\n-    suite.addTests([\n-        layered(robotsuite.RobotTestSuite(\'robot\'),\n-                layer=PAEventDX_ROBOT_TESTING),\n-    ])\n+    current_dir = os.path.abspath(os.path.dirname(__file__))\n+    robot_dir = os.path.join(current_dir, \'robot\')\n+    robot_tests = [\n+        os.path.join(\'robot\', doc) for doc in\n+        os.listdir(robot_dir) if doc.endswith(\'.robot\')\n+        and doc.startswith(\'test_\')\n+    ]\n+    for robot_test in robot_tests:\n+        robottestsuite = robotsuite.RobotTestSuite(\n+            robot_test,\n+            noncritical=[\'unstable\'],\n+        )\n+        robottestsuite.level = ROBOT_TEST_LEVEL\n+        suite.addTests([\n+            layered(\n+                robottestsuite,\n+                layer=PAEventDX_ROBOT_TESTING\n+            ),\n+        ])\n     return suite\ndiff --git a/plone/app/event/tests/robot/test_event_roundtrip.robot b/plone/app/event/tests/robot/test_event_roundtrip.robot\nindex 6afc7908..884a4cb9 100644\n--- a/plone/app/event/tests/robot/test_event_roundtrip.robot\n+++ b/plone/app/event/tests/robot/test_event_roundtrip.robot\n@@ -8,6 +8,9 @@ Library  Remote  ${PLONE_URL}/RobotRemote\n Test Setup  Open test browser\n Test Teardown  Close all browsers\n \n+Variables  plone/app/event/tests/robot/variables.py\n+\n+\n *** Variables ***\n \n \n@@ -16,6 +19,7 @@ Test Teardown  Close all browsers\n Scenario: Create and view an event\n   Given a site owner\n     and an event add form\n+  Debug\n   When I select a date in calendar overlay\n   Then it should be filled in the form\n \n@@ -67,12 +71,12 @@ I select a date in calendar overlay\n   Click Element  xpath=//div[@data-fieldname="form.widgets.IEventBasic.start"]//input[contains(@class,"pattern-pickadate-date")]\n   Wait until page contains  Sat\n # For Javascript: Month 1 = February.\n-  Select from list  css=div[data-fieldname="form.widgets.IEventBasic.start"] .picker__select--month  1\n-  Select from list  css=div[data-fieldname="form.widgets.IEventBasic.start"] select.picker__select--year  2014\n-  Click Element  xpath=//div[@data-fieldname="form.widgets.IEventBasic.start"]//div[contains(@class, \'picker__day\')][contains(text(), "10")]\n+  Select from list by label  css=div[data-fieldname="form.widgets.IEventBasic.start"] .picker__select--month  ${EVENT_START_MONTHNAME}\n+  Select from list by label  css=div[data-fieldname="form.widgets.IEventBasic.start"] select.picker__select--year  ${EVENT_START_YEAR}\n+  Click Element  xpath=//div[@data-fieldname="form.widgets.IEventBasic.start"]//div[contains(@class, \'picker__day\')][contains(text(), "${EVENT_START_DAY}")]\n # Select Times\n   Click Element  xpath=//div[@data-fieldname="form.widgets.IEventBasic.start"]//input[contains(@class,"pattern-pickadate-time")]\n-  Click Element  xpath=//div[@data-fieldname="form.widgets.IEventBasic.start"]//div[contains(@class, \'picker--time\')]//li[contains(@class, \'picker__list-item\')][contains(text(), "10:00 a.m.")]\n+  Click Element  xpath=//div[@data-fieldname="form.widgets.IEventBasic.start"]//div[contains(@class, \'picker--time\')]//li[contains(@class, \'picker__list-item\')][contains(text(), "${EVENT_START_HOUR}:00")]\n \n \n I click on Recurrence Add\n@@ -80,7 +84,7 @@ I click on Recurrence Add\n   Wait until page contains  Repeat\n \n I select weekly repeat\n-  Select From List  css=#rirtemplate  weekly\n+  Select From List by label  css=#rirtemplate  weekly\n \n I fill ${NUM} occurrences\n   Input text  name=rirangebyoccurrencesvalue  ${NUM}\n@@ -102,16 +106,16 @@ I open the event listing\n # Then\n \n it should be filled in the form\n-  Textfield Value Should Be  css=#formfield-form-widgets-IEventBasic-start input.pattern-pickadate-date  February 10, 2014\n-  Textfield Value Should Be  css=#formfield-form-widgets-IEventBasic-start input.pattern-pickadate-time  10:00 a.m.\n-  Textfield Value Should Be  css=#formfield-form-widgets-IEventBasic-end input.pattern-pickadate-date  February 10, 2014\n-  Textfield Value Should Be  css=#formfield-form-widgets-IEventBasic-end input.pattern-pickadate-time  11:00 a.m.\n+  Textfield Value Should Be  css=#formfield-form-widgets-IEventBasic-start input.pattern-pickadate-date  ${EVENT_START_MONTHNAME} ${EVENT_START_DAY}, ${EVENT_START_YEAR}\n+  Textfield Should Contain  css=#formfield-form-widgets-IEventBasic-start input.pattern-pickadate-time  ${EVENT_START_HOUR}:00\n+  Textfield Value Should Be  css=#formfield-form-widgets-IEventBasic-end input.pattern-pickadate-date  ${EVENT_END_MONTHNAME} ${EVENT_END_DAY}, ${EVENT_END_YEAR}\n+  Textfield Should Contain  css=#formfield-form-widgets-IEventBasic-end input.pattern-pickadate-time  ${EVENT_END_HOUR}:00\n \n I should see the recurrence overlay\n   Page Should Contain  Recurrence\n   Page Should Contain  Selected dates\n-  Xpath Should Match X Times  //div[contains(@class, \'occurrence\') and contains(@class, \'start\')]  1\n-  Xpath Should Match X Times  //div[contains(@class, \'occurrence\') and contains(@class, \'rrule\')]  6\n+  Page Should Contain Element  //div[contains(@class, \'occurrence\') and contains(@class, \'start\')]  1\n+  Page Should Contain Element  //div[contains(@class, \'occurrence\') and contains(@class, \'rrule\')]  6\n \n I should see the recurrence overlay in weeekly repeat mode\n   Page Should Contain  Repeats every\n@@ -130,10 +134,10 @@ the overlay should be closed\n # http://stackoverflow.com/questions/1604471/how-can-i-find-an-element-by-css-class-with-xpath\n \n I should see ${NUM} occurrences in the overlay\n-  Xpath Should Match X Times  //div[contains(concat(\' \', normalize-space(@class), \' \'), \' rioccurrences \')]/div[contains(@class, \'occurrence\')]  ${NUM}\n+  Page Should Contain Element  //div[contains(concat(\' \', normalize-space(@class), \' \'), \' rioccurrences \')]/div[contains(@class, \'occurrence\')]  ${NUM}\n \n I should see ${NUM} occurrences in the form\n-  Xpath Should Match X Times  //div[contains(concat(\' \', normalize-space(@class), \' \'), \' ridisplay \')]/div[contains(concat(\' \', normalize-space(@class), \' \'), \' rioccurrences \')]/div[contains(@class, \'occurrence\')]  ${NUM}\n+  Page Should Contain Element  //div[contains(concat(\' \', normalize-space(@class), \' \'), \' ridisplay \')]/div[contains(concat(\' \', normalize-space(@class), \' \'), \' rioccurrences \')]/div[contains(@class, \'occurrence\')]  ${NUM}\n \n I should see the event detail view\n   Page Should Contain  Testevent\n@@ -158,4 +162,4 @@ I should see the occurrence detail view\n   Page Should Contain  iCal\n \n I should see the event listing view\n-  Xpath Should Match X Times  //article[@class="vevent"]  3\n+  Page Should Contain Element  //article[@class="vevent"]  3\ndiff --git a/plone/app/event/tests/robot/variables.py b/plone/app/event/tests/robot/variables.py\nnew file mode 100644\nindex 00000000..614ef170\n--- /dev/null\n+++ b/plone/app/event/tests/robot/variables.py\n@@ -0,0 +1,22 @@\n+# setup dates\n+from datetime import datetime\n+from datetime import timedelta\n+\n+import locale\n+\n+# important for MONTHNAME\n+locale.setlocale(locale.LC_ALL, "en_US")\n+\n+NOW = datetime.now() + timedelta(days=1)\n+EVENT_START_YEAR = NOW.strftime("%Y")\n+EVENT_START_MONTH = str(NOW.month - 1)\n+EVENT_START_MONTHNAME = NOW.strftime("%B")\n+EVENT_START_DAY = NOW.strftime("%d")\n+EVENT_START_HOUR = str(int(NOW.strftime("%I")))\n+\n+END = NOW + timedelta(hours=1)\n+EVENT_END_YEAR = END.strftime("%Y")\n+EVENT_END_MONTH = str(END.month - 1)\n+EVENT_END_MONTHNAME = END.strftime("%B")\n+EVENT_END_DAY = END.strftime("%d")\n+EVENT_END_HOUR = str(int(END.strftime("%I")))\ndiff --git a/plone/app/event/tests/test_event_summary.py b/plone/app/event/tests/test_event_summary.py\nindex f52a5415..9286e1a7 100644\n--- a/plone/app/event/tests/test_event_summary.py\n+++ b/plone/app/event/tests/test_event_summary.py\n@@ -108,7 +108,7 @@ def test_event_summary__recurring_excludes(self):\n \n         output = view()\n \n-        self.assertTrue(\'Now Event\' in output)  # Title not shown by def.\n+        self.assertTrue(\'Now Event\' not in output)  # Title not shown by def.\n         self.assertTrue(\'2013-05-05\' in output)\n         self.assertTrue(\'All dates\' not in output)\n         self.assertTrue(\'2013-05-07\' not in output)\ndiff --git a/setup.py b/setup.py\nindex 55ca87c8..e4158d8c 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -5,7 +5,7 @@\n import os\n \n \n-version = \'3.2.11.dev0\'\n+version = \'4.0.0.dev0\'\n \n \n long_description = (\'\\n\\n\'.join([\n'

