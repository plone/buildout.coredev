Repository: plone.batching


Branch: refs/heads/1.1.x
Date: 2021-03-01T15:41:42+01:00
Author: Peter Holzer (agitator) <peter.holzer@agitator.com>
Commit: https://github.com/plone/plone.batching/commit/db3d6567f6f8cf438b90a33c1907ccedfd5177c3

cherry pick changes from https://github.com/plone/plone.batching/pull/26

Files changed:
A news/26.feature
M plone/batching/browser.py

b'diff --git a/news/26.feature b/news/26.feature\nnew file mode 100644\nindex 0000000..f1b7f68\n--- /dev/null\n+++ b/news/26.feature\n@@ -0,0 +1,2 @@\n+Include request form parameters from parent request to allow batching in plone.app.standardtiles and filtering with collective.collectionfilter.\n+[agitator]\n\\ No newline at end of file\ndiff --git a/plone/batching/browser.py b/plone/batching/browser.py\nindex 333faf2..a6fb418 100644\n--- a/plone/batching/browser.py\n+++ b/plone/batching/browser.py\n@@ -39,7 +39,11 @@ class BootstrapBatchView(BatchView):\n class PloneBatchView(BatchView):\n \n     def make_link(self, pagenumber=None, omit_params=[\'ajax_load\']):\n+        # Include request form parameters from parent request\n         query_params = {}\n+        if "PARENT_REQUEST" in self.request:\n+            query_params.update(self.request["PARENT_REQUEST"].form)\n+        # update/override parent params with actual request params\n         query_params.update(self.request.form)\n         if self.batchformkeys:\n             for key in list(query_params.keys()):\n@@ -52,12 +56,10 @@ def make_link(self, pagenumber=None, omit_params=[\'ajax_load\']):\n \n         start = max(pagenumber - 1, 0) * self.batch.pagesize\n         query_params[self.batch.b_start_str] = start\n-        url = u\'{0}?{1}\'.format(\n-            self.request.ACTUAL_URL,\n-            make_query(query_params)\n-        )\n+        url = u"{0}?{1}".format(self.request.ACTUAL_URL, make_query(query_params))\n         return url\n \n \n+\n class PloneBootstrapBatchView(BootstrapBatchView, PloneBatchView):\n     pass\n'

Repository: plone.batching


Branch: refs/heads/1.1.x
Date: 2021-03-02T11:25:29+01:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.batching/commit/9f2b54ba711a7177644a7370ad01419b00041eea

Merge pull request #29 from plone/1.1.x-req-params-from-parent-req

cherry pick changes from https://github.com/plone/plone.batching/pull/26

Files changed:
A news/26.feature
M plone/batching/browser.py

b'diff --git a/news/26.feature b/news/26.feature\nnew file mode 100644\nindex 0000000..f1b7f68\n--- /dev/null\n+++ b/news/26.feature\n@@ -0,0 +1,2 @@\n+Include request form parameters from parent request to allow batching in plone.app.standardtiles and filtering with collective.collectionfilter.\n+[agitator]\n\\ No newline at end of file\ndiff --git a/plone/batching/browser.py b/plone/batching/browser.py\nindex 333faf2..a6fb418 100644\n--- a/plone/batching/browser.py\n+++ b/plone/batching/browser.py\n@@ -39,7 +39,11 @@ class BootstrapBatchView(BatchView):\n class PloneBatchView(BatchView):\n \n     def make_link(self, pagenumber=None, omit_params=[\'ajax_load\']):\n+        # Include request form parameters from parent request\n         query_params = {}\n+        if "PARENT_REQUEST" in self.request:\n+            query_params.update(self.request["PARENT_REQUEST"].form)\n+        # update/override parent params with actual request params\n         query_params.update(self.request.form)\n         if self.batchformkeys:\n             for key in list(query_params.keys()):\n@@ -52,12 +56,10 @@ def make_link(self, pagenumber=None, omit_params=[\'ajax_load\']):\n \n         start = max(pagenumber - 1, 0) * self.batch.pagesize\n         query_params[self.batch.b_start_str] = start\n-        url = u\'{0}?{1}\'.format(\n-            self.request.ACTUAL_URL,\n-            make_query(query_params)\n-        )\n+        url = u"{0}?{1}".format(self.request.ACTUAL_URL, make_query(query_params))\n         return url\n \n \n+\n class PloneBootstrapBatchView(BootstrapBatchView, PloneBatchView):\n     pass\n'

