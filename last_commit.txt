Repository: plone.app.discussion


Branch: refs/heads/4.x
Date: 2024-08-19T15:01:31+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.discussion/commit/c0cba64999f2a1bd717cf2352be421ed69513890

Add missing icon

The `view` action of comments had no icon on Plone 6.

Files changed:
M plone/app/discussion/profiles/default/types/Discussion_Item.xml

b'diff --git a/plone/app/discussion/profiles/default/types/Discussion_Item.xml b/plone/app/discussion/profiles/default/types/Discussion_Item.xml\nindex c05efcb9..eccc9c20 100644\n--- a/plone/app/discussion/profiles/default/types/Discussion_Item.xml\n+++ b/plone/app/discussion/profiles/default/types/Discussion_Item.xml\n@@ -30,6 +30,7 @@\n           condition_expr=""\n           title="View"\n           url_expr="string:${object_url}/@@view"\n+          icon_expr="string:toolbar-action/view"\n           visible="True"\n   >\n     <permission value="View" />\n'

Repository: plone.app.discussion


Branch: refs/heads/4.x
Date: 2024-08-19T15:01:31+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.gnome@gmail.com>
Commit: https://github.com/plone/plone.app.discussion/commit/3c5f4570dcc625c54b5da5606b47f83a6885f163

Add news entry

Files changed:
A news/+ignore.bugfix

b"diff --git a/news/+ignore.bugfix b/news/+ignore.bugfix\nnew file mode 100644\nindex 00000000..7f7f4e85\n--- /dev/null\n+++ b/news/+ignore.bugfix\n@@ -0,0 +1,2 @@\n+Add missing icon on comments' `view` action\n+[gforcada]\n"

Repository: plone.app.discussion


Branch: refs/heads/4.x
Date: 2024-08-19T16:21:53+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.discussion/commit/6983e3505b4985f9f15a1800467aecf1e5078acd

Register contenttype icon.  Add upgrade step for updating the icons.

Files changed:
A news/222.bugfix
A plone/app/discussion/profiles/to_2002/registry.xml
A plone/app/discussion/profiles/to_2002/types/Discussion_Item.xml
A plone/app/discussion/setuphandlers.py
M plone/app/discussion/configure.zcml
M plone/app/discussion/profiles/default/metadata.xml
M plone/app/discussion/profiles/default/registry.xml
M plone/app/discussion/profiles/default/types/Discussion_Item.xml
M plone/app/discussion/upgrades.zcml
D news/+ignore.bugfix

b'diff --git a/news/+ignore.bugfix b/news/+ignore.bugfix\ndeleted file mode 100644\nindex 7f7f4e85..00000000\n--- a/news/+ignore.bugfix\n+++ /dev/null\n@@ -1,2 +0,0 @@\n-Add missing icon on comments\' `view` action\n-[gforcada]\ndiff --git a/news/222.bugfix b/news/222.bugfix\nnew file mode 100644\nindex 00000000..6f0a228f\n--- /dev/null\n+++ b/news/222.bugfix\n@@ -0,0 +1,3 @@\n+Add missing icon on comments\' `view` action\n+Register contenttype icon for comments.\n+[gforcada, maurits]\ndiff --git a/plone/app/discussion/configure.zcml b/plone/app/discussion/configure.zcml\nindex e2b82f2d..ada1914f 100644\n--- a/plone/app/discussion/configure.zcml\n+++ b/plone/app/discussion/configure.zcml\n@@ -46,6 +46,11 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       directory="profiles/default"\n       />\n+  <utility\n+      factory=".setuphandlers.HiddenProfiles"\n+      provides="plone.base.interfaces.INonInstallable"\n+      name="plone.app.discussion"\n+      />\n   <!-- For upgrade steps see upgrades.zcml. -->\n \n   <!-- Comments -->\ndiff --git a/plone/app/discussion/profiles/default/metadata.xml b/plone/app/discussion/profiles/default/metadata.xml\nindex 38abca6d..4cad4f61 100644\n--- a/plone/app/discussion/profiles/default/metadata.xml\n+++ b/plone/app/discussion/profiles/default/metadata.xml\n@@ -1,6 +1,6 @@\n <?xml version="1.0" encoding="utf-8"?>\n <metadata>\n-  <version>2001</version>\n+  <version>2002</version>\n   <dependencies>\n     <dependency>profile-plone.resource:default</dependency>\n     <dependency>profile-plone.app.registry:default</dependency>\ndiff --git a/plone/app/discussion/profiles/default/registry.xml b/plone/app/discussion/profiles/default/registry.xml\nindex 2a1aaffc..944359d3 100644\n--- a/plone/app/discussion/profiles/default/registry.xml\n+++ b/plone/app/discussion/profiles/default/registry.xml\n@@ -4,4 +4,10 @@\n     <value key="edit_comment_enabled">False</value>\n     <value key="delete_own_comment_enabled">False</value>\n   </records>\n+  <record name="plone.icon.contenttype/discussion-item">\n+    <field type="plone.registry.field.TextLine">\n+      <title>Plone Image</title>\n+    </field>\n+    <value key="resource">++plone++bootstrap-icons/chat-left-text.svg</value>\n+  </record>\n </registry>\ndiff --git a/plone/app/discussion/profiles/default/types/Discussion_Item.xml b/plone/app/discussion/profiles/default/types/Discussion_Item.xml\nindex eccc9c20..01f73b0e 100644\n--- a/plone/app/discussion/profiles/default/types/Discussion_Item.xml\n+++ b/plone/app/discussion/profiles/default/types/Discussion_Item.xml\n@@ -10,7 +10,7 @@\n   <property name="description"\n             i18n:translate=""\n   >Comments added to a content item.</property>\n-  <property name="content_icon">discussionitem_icon.png</property>\n+  <property name="content_icon">++plone++bootstrap-icons/chat-left-text.svg</property>\n   <property name="content_meta_type">Discussion Item</property>\n   <property name="product" />\n   <property name="factory">plone.Comment</property>\ndiff --git a/plone/app/discussion/profiles/to_2002/registry.xml b/plone/app/discussion/profiles/to_2002/registry.xml\nnew file mode 100644\nindex 00000000..e7886adb\n--- /dev/null\n+++ b/plone/app/discussion/profiles/to_2002/registry.xml\n@@ -0,0 +1,9 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<registry>\n+  <record name="plone.icon.contenttype/discussion-item">\n+    <field type="plone.registry.field.TextLine">\n+      <title>Plone Image</title>\n+    </field>\n+    <value key="resource">++plone++bootstrap-icons/chat-left-text.svg</value>\n+  </record>\n+</registry>\ndiff --git a/plone/app/discussion/profiles/to_2002/types/Discussion_Item.xml b/plone/app/discussion/profiles/to_2002/types/Discussion_Item.xml\nnew file mode 100644\nindex 00000000..95bbadbc\n--- /dev/null\n+++ b/plone/app/discussion/profiles/to_2002/types/Discussion_Item.xml\n@@ -0,0 +1,26 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Factory-based Type Information"\n+        name="Discussion Item"\n+        i18n:domain="plone"\n+>\n+  <property name="content_icon">++plone++bootstrap-icons/chat-left-text.svg</property>\n+  <alias from="(Default)"\n+         to="@@view"\n+  />\n+  <alias from="view"\n+         to="@@view"\n+  />\n+  <!-- Note: we cannot only set an icon_exp in this action:\n+       the other settings would be reset to empty then. -->\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          title="View"\n+          url_expr="string:${object_url}/@@view"\n+          icon_expr="string:toolbar-action/view"\n+          visible="True"\n+  >\n+    <permission value="View" />\n+  </action>\n+</object>\ndiff --git a/plone/app/discussion/setuphandlers.py b/plone/app/discussion/setuphandlers.py\nnew file mode 100644\nindex 00000000..7b9e9c6b\n--- /dev/null\n+++ b/plone/app/discussion/setuphandlers.py\n@@ -0,0 +1,10 @@\n+from plone.base.interfaces import INonInstallable\n+from zope.interface import implementer\n+\n+\n+@implementer(INonInstallable)\n+class HiddenProfiles:\n+    def getNonInstallableProfiles(self):\n+        return [\n+            "plone.app.contenttypes:to_2002",\n+        ]\ndiff --git a/plone/app/discussion/upgrades.zcml b/plone/app/discussion/upgrades.zcml\nindex d265d428..5f716f6e 100644\n--- a/plone/app/discussion/upgrades.zcml\n+++ b/plone/app/discussion/upgrades.zcml\n@@ -108,4 +108,23 @@\n         />\n   </genericsetup:upgradeSteps>\n \n+  <genericsetup:registerProfile\n+      name="to_2002"\n+      title="Upgrade: icons"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n+      directory="profiles/to_2002"\n+      />\n+\n+  <genericsetup:upgradeSteps\n+      profile="plone.app.discussion:default"\n+      source="2001"\n+      destination="2002"\n+      >\n+    <genericsetup:upgradeDepends\n+        title="Update icons"\n+        import_profile="plone.app.discussion:to_2002"\n+        />\n+  </genericsetup:upgradeSteps>\n+\n </configure>\n'

Repository: plone.app.discussion


Branch: refs/heads/4.x
Date: 2024-08-19T16:29:55+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.discussion/commit/7b599163bed9cc58f21653172afe3371f7b9477c

zpretty

Files changed:
M plone/app/discussion/profiles/default/types/Discussion_Item.xml
M plone/app/discussion/profiles/to_2002/types/Discussion_Item.xml

b'diff --git a/plone/app/discussion/profiles/default/types/Discussion_Item.xml b/plone/app/discussion/profiles/default/types/Discussion_Item.xml\nindex 01f73b0e..64c98c61 100644\n--- a/plone/app/discussion/profiles/default/types/Discussion_Item.xml\n+++ b/plone/app/discussion/profiles/default/types/Discussion_Item.xml\n@@ -28,9 +28,9 @@\n   <action action_id="view"\n           category="object"\n           condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n           title="View"\n           url_expr="string:${object_url}/@@view"\n-          icon_expr="string:toolbar-action/view"\n           visible="True"\n   >\n     <permission value="View" />\ndiff --git a/plone/app/discussion/profiles/to_2002/types/Discussion_Item.xml b/plone/app/discussion/profiles/to_2002/types/Discussion_Item.xml\nindex 95bbadbc..92fb9496 100644\n--- a/plone/app/discussion/profiles/to_2002/types/Discussion_Item.xml\n+++ b/plone/app/discussion/profiles/to_2002/types/Discussion_Item.xml\n@@ -16,9 +16,9 @@\n   <action action_id="view"\n           category="object"\n           condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n           title="View"\n           url_expr="string:${object_url}/@@view"\n-          icon_expr="string:toolbar-action/view"\n           visible="True"\n   >\n     <permission value="View" />\n'

Repository: plone.app.discussion


Branch: refs/heads/4.x
Date: 2024-08-21T12:20:51+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.discussion/commit/f71e608714cef1bb0f2e1539b66b96f3daf652c8

Fix copy-paste leftover.

Files changed:
M plone/app/discussion/setuphandlers.py

b'diff --git a/plone/app/discussion/setuphandlers.py b/plone/app/discussion/setuphandlers.py\nindex 7b9e9c6b..ca898bae 100644\n--- a/plone/app/discussion/setuphandlers.py\n+++ b/plone/app/discussion/setuphandlers.py\n@@ -6,5 +6,5 @@\n class HiddenProfiles:\n     def getNonInstallableProfiles(self):\n         return [\n-            "plone.app.contenttypes:to_2002",\n+            "plone.app.discussion:to_2002",\n         ]\n'

Repository: plone.app.discussion


Branch: refs/heads/4.x
Date: 2024-09-02T16:34:09+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@py76.be>
Commit: https://github.com/plone/plone.app.discussion/commit/512d53bdbd5bf95fa76a728c45b1106b97543770

Merge pull request #222 from plone/gforcada-patch-2

Add missing icon

Files changed:
A news/222.bugfix
A plone/app/discussion/profiles/to_2002/registry.xml
A plone/app/discussion/profiles/to_2002/types/Discussion_Item.xml
A plone/app/discussion/setuphandlers.py
M plone/app/discussion/configure.zcml
M plone/app/discussion/profiles/default/metadata.xml
M plone/app/discussion/profiles/default/registry.xml
M plone/app/discussion/profiles/default/types/Discussion_Item.xml
M plone/app/discussion/upgrades.zcml

b'diff --git a/news/222.bugfix b/news/222.bugfix\nnew file mode 100644\nindex 00000000..6f0a228f\n--- /dev/null\n+++ b/news/222.bugfix\n@@ -0,0 +1,3 @@\n+Add missing icon on comments\' `view` action\n+Register contenttype icon for comments.\n+[gforcada, maurits]\ndiff --git a/plone/app/discussion/configure.zcml b/plone/app/discussion/configure.zcml\nindex e2b82f2d..ada1914f 100644\n--- a/plone/app/discussion/configure.zcml\n+++ b/plone/app/discussion/configure.zcml\n@@ -46,6 +46,11 @@\n       for="plone.base.interfaces.IPloneSiteRoot"\n       directory="profiles/default"\n       />\n+  <utility\n+      factory=".setuphandlers.HiddenProfiles"\n+      provides="plone.base.interfaces.INonInstallable"\n+      name="plone.app.discussion"\n+      />\n   <!-- For upgrade steps see upgrades.zcml. -->\n \n   <!-- Comments -->\ndiff --git a/plone/app/discussion/profiles/default/metadata.xml b/plone/app/discussion/profiles/default/metadata.xml\nindex 38abca6d..4cad4f61 100644\n--- a/plone/app/discussion/profiles/default/metadata.xml\n+++ b/plone/app/discussion/profiles/default/metadata.xml\n@@ -1,6 +1,6 @@\n <?xml version="1.0" encoding="utf-8"?>\n <metadata>\n-  <version>2001</version>\n+  <version>2002</version>\n   <dependencies>\n     <dependency>profile-plone.resource:default</dependency>\n     <dependency>profile-plone.app.registry:default</dependency>\ndiff --git a/plone/app/discussion/profiles/default/registry.xml b/plone/app/discussion/profiles/default/registry.xml\nindex 2a1aaffc..944359d3 100644\n--- a/plone/app/discussion/profiles/default/registry.xml\n+++ b/plone/app/discussion/profiles/default/registry.xml\n@@ -4,4 +4,10 @@\n     <value key="edit_comment_enabled">False</value>\n     <value key="delete_own_comment_enabled">False</value>\n   </records>\n+  <record name="plone.icon.contenttype/discussion-item">\n+    <field type="plone.registry.field.TextLine">\n+      <title>Plone Image</title>\n+    </field>\n+    <value key="resource">++plone++bootstrap-icons/chat-left-text.svg</value>\n+  </record>\n </registry>\ndiff --git a/plone/app/discussion/profiles/default/types/Discussion_Item.xml b/plone/app/discussion/profiles/default/types/Discussion_Item.xml\nindex c05efcb9..64c98c61 100644\n--- a/plone/app/discussion/profiles/default/types/Discussion_Item.xml\n+++ b/plone/app/discussion/profiles/default/types/Discussion_Item.xml\n@@ -10,7 +10,7 @@\n   <property name="description"\n             i18n:translate=""\n   >Comments added to a content item.</property>\n-  <property name="content_icon">discussionitem_icon.png</property>\n+  <property name="content_icon">++plone++bootstrap-icons/chat-left-text.svg</property>\n   <property name="content_meta_type">Discussion Item</property>\n   <property name="product" />\n   <property name="factory">plone.Comment</property>\n@@ -28,6 +28,7 @@\n   <action action_id="view"\n           category="object"\n           condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n           title="View"\n           url_expr="string:${object_url}/@@view"\n           visible="True"\ndiff --git a/plone/app/discussion/profiles/to_2002/registry.xml b/plone/app/discussion/profiles/to_2002/registry.xml\nnew file mode 100644\nindex 00000000..e7886adb\n--- /dev/null\n+++ b/plone/app/discussion/profiles/to_2002/registry.xml\n@@ -0,0 +1,9 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<registry>\n+  <record name="plone.icon.contenttype/discussion-item">\n+    <field type="plone.registry.field.TextLine">\n+      <title>Plone Image</title>\n+    </field>\n+    <value key="resource">++plone++bootstrap-icons/chat-left-text.svg</value>\n+  </record>\n+</registry>\ndiff --git a/plone/app/discussion/profiles/to_2002/types/Discussion_Item.xml b/plone/app/discussion/profiles/to_2002/types/Discussion_Item.xml\nnew file mode 100644\nindex 00000000..92fb9496\n--- /dev/null\n+++ b/plone/app/discussion/profiles/to_2002/types/Discussion_Item.xml\n@@ -0,0 +1,26 @@\n+<?xml version="1.0" encoding="utf-8"?>\n+<object xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n+        meta_type="Factory-based Type Information"\n+        name="Discussion Item"\n+        i18n:domain="plone"\n+>\n+  <property name="content_icon">++plone++bootstrap-icons/chat-left-text.svg</property>\n+  <alias from="(Default)"\n+         to="@@view"\n+  />\n+  <alias from="view"\n+         to="@@view"\n+  />\n+  <!-- Note: we cannot only set an icon_exp in this action:\n+       the other settings would be reset to empty then. -->\n+  <action action_id="view"\n+          category="object"\n+          condition_expr=""\n+          icon_expr="string:toolbar-action/view"\n+          title="View"\n+          url_expr="string:${object_url}/@@view"\n+          visible="True"\n+  >\n+    <permission value="View" />\n+  </action>\n+</object>\ndiff --git a/plone/app/discussion/setuphandlers.py b/plone/app/discussion/setuphandlers.py\nnew file mode 100644\nindex 00000000..ca898bae\n--- /dev/null\n+++ b/plone/app/discussion/setuphandlers.py\n@@ -0,0 +1,10 @@\n+from plone.base.interfaces import INonInstallable\n+from zope.interface import implementer\n+\n+\n+@implementer(INonInstallable)\n+class HiddenProfiles:\n+    def getNonInstallableProfiles(self):\n+        return [\n+            "plone.app.discussion:to_2002",\n+        ]\ndiff --git a/plone/app/discussion/upgrades.zcml b/plone/app/discussion/upgrades.zcml\nindex d265d428..5f716f6e 100644\n--- a/plone/app/discussion/upgrades.zcml\n+++ b/plone/app/discussion/upgrades.zcml\n@@ -108,4 +108,23 @@\n         />\n   </genericsetup:upgradeSteps>\n \n+  <genericsetup:registerProfile\n+      name="to_2002"\n+      title="Upgrade: icons"\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="plone.base.interfaces.IMigratingPloneSiteRoot"\n+      directory="profiles/to_2002"\n+      />\n+\n+  <genericsetup:upgradeSteps\n+      profile="plone.app.discussion:default"\n+      source="2001"\n+      destination="2002"\n+      >\n+    <genericsetup:upgradeDepends\n+        title="Update icons"\n+        import_profile="plone.app.discussion:to_2002"\n+        />\n+  </genericsetup:upgradeSteps>\n+\n </configure>\n'

