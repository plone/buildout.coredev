Repository: plone.app.layout


Branch: refs/heads/master
Date: 2020-07-07T15:59:49+02:00
Author: Vincent Fretin (vincentfretin) <vincent.fretin@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/08d6206102c7253b94a170e672d09b9e302d6172

translate modal title (for Log in modal for example)

Files changed:
A news/241.bugfix
M plone/app/layout/viewlets/common.py

b'diff --git a/news/241.bugfix b/news/241.bugfix\nnew file mode 100644\nindex 00000000..12678a4c\n--- /dev/null\n+++ b/news/241.bugfix\n@@ -0,0 +1,3 @@\n+Translate title modal like the "Log in" modal.\n+This fixes https://github.com/plone/Products.CMFPlone/issues/3132\n+[vincentfretin]\ndiff --git a/plone/app/layout/viewlets/common.py b/plone/app/layout/viewlets/common.py\nindex 60b118f2..1fb80952 100644\n--- a/plone/app/layout/viewlets/common.py\n+++ b/plone/app/layout/viewlets/common.py\n@@ -14,6 +14,7 @@\n from plone.protect.utils import addTokenToUrl\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n+from Products.CMFPlone import PloneMessageFactory as _\n from Products.CMFPlone.interfaces import IPloneSiteRoot\n from Products.CMFPlone.interfaces import ISearchSchema\n from Products.CMFPlone.interfaces import ISiteSchema\n@@ -32,6 +33,8 @@\n from zope.interface import implementer\n from zope.viewlet.interfaces import IViewlet\n \n+import json\n+\n \n try:\n     from html import escape\n@@ -468,6 +471,11 @@ def update(self):\n             modal = action.get("modal")\n             if modal:\n                 info["class"] = "pat-plone-modal"\n+                if \'"title":\' in modal:\n+                    modal = json.loads(modal)\n+                    modal[\'title\'] = translate(_(modal[\'title\']), context=self.request)\n+                    modal = json.dumps(modal)\n+\n                 info["data-pat-plone-modal"] = modal\n             self.user_actions.append(info)\n \n'

Repository: plone.app.layout


Branch: refs/heads/master
Date: 2020-07-07T18:28:38+02:00
Author: Vincent Fretin (vincentfretin) <vincent.fretin@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/f6795eda5f88581cff196d90267673c833f6bce2

Merge pull request #241 from plone/translate-modal-title

translate modal title (for Log in modal for example)

Files changed:
A news/241.bugfix
M plone/app/layout/viewlets/common.py

b'diff --git a/news/241.bugfix b/news/241.bugfix\nnew file mode 100644\nindex 00000000..12678a4c\n--- /dev/null\n+++ b/news/241.bugfix\n@@ -0,0 +1,3 @@\n+Translate title modal like the "Log in" modal.\n+This fixes https://github.com/plone/Products.CMFPlone/issues/3132\n+[vincentfretin]\ndiff --git a/plone/app/layout/viewlets/common.py b/plone/app/layout/viewlets/common.py\nindex 60b118f2..1fb80952 100644\n--- a/plone/app/layout/viewlets/common.py\n+++ b/plone/app/layout/viewlets/common.py\n@@ -14,6 +14,7 @@\n from plone.protect.utils import addTokenToUrl\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n+from Products.CMFPlone import PloneMessageFactory as _\n from Products.CMFPlone.interfaces import IPloneSiteRoot\n from Products.CMFPlone.interfaces import ISearchSchema\n from Products.CMFPlone.interfaces import ISiteSchema\n@@ -32,6 +33,8 @@\n from zope.interface import implementer\n from zope.viewlet.interfaces import IViewlet\n \n+import json\n+\n \n try:\n     from html import escape\n@@ -468,6 +471,11 @@ def update(self):\n             modal = action.get("modal")\n             if modal:\n                 info["class"] = "pat-plone-modal"\n+                if \'"title":\' in modal:\n+                    modal = json.loads(modal)\n+                    modal[\'title\'] = translate(_(modal[\'title\']), context=self.request)\n+                    modal = json.dumps(modal)\n+\n                 info["data-pat-plone-modal"] = modal\n             self.user_actions.append(info)\n \n'

