Repository: plone.restapi


Branch: refs/heads/main
Date: 2023-11-23T16:43:21+01:00
Author: Víctor Fernández de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/497055bc2e3d4fe44c442407e1e2c620dcb23e4b

Add `preview_image` and `preview_image_link` to the list of smart fields for resolveuid and link integrity (#1735)

* Add preview_image and preview_image_link to the list of smart fields for resolveuid and link_integrity

* Changelog

Files changed:
A news/1735.feature
M src/plone/restapi/blocks_linkintegrity.py
M src/plone/restapi/deserializer/blocks.py
M src/plone/restapi/serializer/blocks.py

b'diff --git a/news/1735.feature b/news/1735.feature\nnew file mode 100644\nindex 000000000..b56d32453\n--- /dev/null\n+++ b/news/1735.feature\n@@ -0,0 +1,2 @@\n+Added preview_image and preview_image_link to the list of smart fields for resolveuid and link integrity\n+[sneridagh]\ndiff --git a/src/plone/restapi/blocks_linkintegrity.py b/src/plone/restapi/blocks_linkintegrity.py\nindex f6c365dd8..5a907baa6 100644\n--- a/src/plone/restapi/blocks_linkintegrity.py\n+++ b/src/plone/restapi/blocks_linkintegrity.py\n@@ -57,7 +57,6 @@ def __call__(self, block):\n @adapter(IBlocks, IBrowserRequest)\n @implementer(IBlockFieldLinkIntegrityRetriever)\n class SlateBlockLinksRetriever:\n-\n     order = 100\n     block_type = "slate"\n     field = "value"\n@@ -111,7 +110,7 @@ def __call__(self, block):\n         Returns a list of internal links\n         """\n         links = []\n-        for field in ["url", "href"]:\n+        for field in ["url", "href", "preview_image", "preview_image_link"]:\n             value = block.get(field, "")\n             for url in get_urls_from_value(value):\n                 links.append(url)\ndiff --git a/src/plone/restapi/deserializer/blocks.py b/src/plone/restapi/deserializer/blocks.py\nindex a4746eb4b..655805903 100644\n--- a/src/plone/restapi/deserializer/blocks.py\n+++ b/src/plone/restapi/deserializer/blocks.py\n@@ -55,7 +55,7 @@ class ResolveUIDDeserializerBase:\n \n     order = 1\n     block_type = None\n-    fields = ["url", "href"]\n+    fields = ["url", "href", "preview_image", "preview_image_link"]\n     disabled = os.environ.get("disable_transform_resolveuid", False)\n \n     def __init__(self, context, request):\ndiff --git a/src/plone/restapi/serializer/blocks.py b/src/plone/restapi/serializer/blocks.py\nindex 5a8733580..76669b709 100644\n--- a/src/plone/restapi/serializer/blocks.py\n+++ b/src/plone/restapi/serializer/blocks.py\n@@ -40,7 +40,7 @@ def __call__(self):\n class ResolveUIDSerializerBase:\n     order = 1\n     block_type = None\n-    fields = ["url", "href"]\n+    fields = ["url", "href", "preview_image", "preview_image_link"]\n     disabled = os.environ.get("disable_transform_resolveuid", False)\n \n     def __init__(self, context, request):\n'

