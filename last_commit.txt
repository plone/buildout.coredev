Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2020-09-18T12:51:26+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contenttypes/commit/07143d54e6605c5bcfc2bc607fc88af067774966

Allow passing a custom catalog-query to migrateCustomAT to constrain which objects to migrate

Files changed:
A news/572.feature
M plone/app/contenttypes/migration/migration.py

b'diff --git a/news/572.feature b/news/572.feature\nnew file mode 100644\nindex 00000000..7a49f2fa\n--- /dev/null\n+++ b/news/572.feature\n@@ -0,0 +1 @@\n+Allow passing a custom catalog-query to migrateCustomAT to constrain which objects to migrate. [pbauer]\n\\ No newline at end of file\ndiff --git a/plone/app/contenttypes/migration/migration.py b/plone/app/contenttypes/migration/migration.py\nindex b9c8894c..f547d752 100644\n--- a/plone/app/contenttypes/migration/migration.py\n+++ b/plone/app/contenttypes/migration/migration.py\n@@ -484,6 +484,7 @@ def migrateCustomAT(fields_mapping,\n                     dry_run=False,\n                     patch_linkintegrity=False,\n                     patch_searchabletext=False,\n+                    query=None,\n                     ):\n     """\n     Try to get types infos from archetype_tool, then set a migrator and pass it\n@@ -554,6 +555,8 @@ def migrateCustomAT(fields_mapping,\n                            \'src_meta_type\': src_meta_type,\n                            \'dst_meta_type\': \'\',\n                            \'use_savepoint\': True}\n+        if query:\n+            walker_settings[\'query\'] = query\n         if dry_run:\n             walker_settings[\'limit\'] = 1\n         walker = CustomQueryWalker(**walker_settings)\n'

