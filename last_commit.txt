Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2020-05-25T22:51:03+02:00
Author: Kristin Kuche (krissik) <kuche@hrz.uni-marburg.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/01899db8ba6cb93ea5b40a816856e41cca8c1195

Add changelog entry

Files changed:
A news/2861.bugfix

b"diff --git a/news/2861.bugfix b/news/2861.bugfix\nnew file mode 100644\nindex 0000000000..3a04299ce9\n--- /dev/null\n+++ b/news/2861.bugfix\n@@ -0,0 +1 @@\n+ If 'tinymce-content-css' option is missing in themes manifest.cfg prevent unnecessary loading of a css at nav_root_url while editing a page.  [krissik]\n\\ No newline at end of file\n"

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2020-05-25T22:51:03+02:00
Author: krissik (krissik) <krissik@users.noreply.github.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/c525ce0c8a212b7560107c4eca455ff1ef7791f5

Prevent loading of css at nav_root_url

If 'tinymce-content-css' is missing in themes manifest.cfg its default value is ''.

Files changed:
M Products/CMFPlone/patterns/tinymce.py

b"diff --git a/Products/CMFPlone/patterns/tinymce.py b/Products/CMFPlone/patterns/tinymce.py\nindex 7283055d07..a858e7fe3d 100644\n--- a/Products/CMFPlone/patterns/tinymce.py\n+++ b/Products/CMFPlone/patterns/tinymce.py\n@@ -49,7 +49,7 @@ def get_content_css(self, style_css=''):\n                 files.append('/'.join([self.nav_root_url, url.strip()]))\n         theme = self.get_theme()\n         tinymce_content_css = getattr(theme, 'tinymce_content_css', None)\n-        if tinymce_content_css is not None:\n+        if tinymce_content_css is not None and tinymce_content_css != '':\n             for path in theme.tinymce_content_css.split(','):\n                 if path.startswith('http://') or path.startswith('https://'):\n                     files.append(path)\n"

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2020-06-02T08:37:51+02:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/168fd151145b8c50b004495c09375d159531d921

Merge branch '5.2.x' into 2861-backport

Files changed:
A news/2482.bugfix
M Products/CMFPlone/interfaces/controlpanel.py

b"diff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py\nindex 88a5496a6b..3d5681c509 100644\n--- a/Products/CMFPlone/interfaces/controlpanel.py\n+++ b/Products/CMFPlone/interfaces/controlpanel.py\n@@ -246,6 +246,7 @@ class IFilterSchema(Interface):\n             u'head',\n             u'header',\n             u'hgroup',\n+            u'hr',\n             u'html',\n             u'i',\n             u'iframe',\n@@ -297,7 +298,7 @@ class IFilterSchema(Interface):\n     custom_attributes = schema.List(\n         title=_(u'Custom attributes'),\n         description=_(u'These attributes are additionally allowed.'),\n-        default=[],\n+        default=['style'],\n         value_type=schema.TextLine(),\n         missing_value=[],\n         required=False)\ndiff --git a/news/2482.bugfix b/news/2482.bugfix\nnew file mode 100644\nindex 0000000000..f207ddeee7\n--- /dev/null\n+++ b/news/2482.bugfix\n@@ -0,0 +1,2 @@\n+Update HTMLFilter settings to enable TinyMCE styling features. See #2329, #2482, #2535\n+[petschki]\n"

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2020-06-10T23:47:27+02:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/18332752f82e4d025d0c4213fff55b5b74960772

Merge branch '5.2.x' into 2861-backport

Files changed:
A news/3105.bugfix
M Products/CMFPlone/interfaces/controlpanel.py

b"diff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py\nindex 3d5681c509..729858a84a 100644\n--- a/Products/CMFPlone/interfaces/controlpanel.py\n+++ b/Products/CMFPlone/interfaces/controlpanel.py\n@@ -298,7 +298,7 @@ class IFilterSchema(Interface):\n     custom_attributes = schema.List(\n         title=_(u'Custom attributes'),\n         description=_(u'These attributes are additionally allowed.'),\n-        default=['style'],\n+        default=[u'style'],\n         value_type=schema.TextLine(),\n         missing_value=[],\n         required=False)\ndiff --git a/news/3105.bugfix b/news/3105.bugfix\nnew file mode 100644\nindex 0000000000..87eb6e03f4\n--- /dev/null\n+++ b/news/3105.bugfix\n@@ -0,0 +1,2 @@\n+Bugfix for #3103\n+[petschki]\n"

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2020-06-27T13:41:24+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/Products.CMFPlone/commit/7eeea36d6f0f1d1ff751eba0093ca205df5f032f

Merge branch '5.2.x' into 2861-backport

Files changed:
A news/3086.feature
A news/3115.bugfix
M Products/CMFPlone/resources/browser/styles.py
M Products/CMFPlone/skins/plone_prefs/prefs_error_log_setProperties.py
M Products/CMFPlone/tests/robot/test_linkintegrity.robot

b'diff --git a/Products/CMFPlone/resources/browser/styles.py b/Products/CMFPlone/resources/browser/styles.py\nindex 2c34ceed0e..7e4c9e815a 100644\n--- a/Products/CMFPlone/resources/browser/styles.py\n+++ b/Products/CMFPlone/resources/browser/styles.py\n@@ -1,9 +1,12 @@\n # -*- coding: utf-8 -*-\n from plone.app.layout.viewlets.common import ViewletBase\n+from plone.app.theming.interfaces import IThemeSettings\n+from plone.registry.interfaces import IRegistry\n from Products.CMFPlone.resources.browser.cook import cookWhenChangingSettings\n from Products.CMFPlone.resources.browser.resource import ResourceBase\n from Products.CMFPlone.utils import get_top_request\n from six.moves.urllib import parse\n+from zope.component import getUtility\n \n \n class StylesBase(ResourceBase):\n@@ -81,6 +84,19 @@ def get_data(self, bundle, result):\n                     \'src\': css_location\n                 })\n \n+    @property\n+    def _theme_settings(self):\n+        registry = getUtility(IRegistry)\n+        return registry.forInterface(IThemeSettings, False)\n+\n+    @property\n+    def custom_css(self):\n+        return self._theme_settings.custom_css\n+\n+    @property\n+    def custom_css_timestamp(self):\n+        return self._theme_settings.custom_css_timestamp\n+\n     def styles(self):\n         """\n         Get all the styles\n@@ -143,6 +159,19 @@ def styles(self):\n                     \'bundle\': \'diazo\'}\n \n             result.append(data)\n+\n+        # custom.css\n+        if self.custom_css:\n+            custom_css = {\n+                \'rel\': \'stylesheet\',\n+                \'conditionalcomment\': \'\',\n+                \'src\': "{0}/custom.css?timestamp={1}".format(\n+                    self.site_url,\n+                    self.custom_css_timestamp,\n+                ),\n+                \'bundle\': \'custom-css\'\n+            }\n+            result.append(custom_css)\n         return result\n \n \ndiff --git a/Products/CMFPlone/skins/plone_prefs/prefs_error_log_setProperties.py b/Products/CMFPlone/skins/plone_prefs/prefs_error_log_setProperties.py\nindex ab5cbf4ac4..b321accd8e 100644\n--- a/Products/CMFPlone/skins/plone_prefs/prefs_error_log_setProperties.py\n+++ b/Products/CMFPlone/skins/plone_prefs/prefs_error_log_setProperties.py\n@@ -8,9 +8,11 @@\n ##title=\n \n from Products.CMFPlone import PloneMessageFactory as _\n+from Products.CMFPlone.utils import safe_nativestring\n \n request = context.REQUEST\n \n+ignored_exceptions = map(safe_nativestring, ignored_exceptions)\n context.error_log.setProperties(keep_entries, copy_to_zlog, ignored_exceptions)\n context.plone_utils.addPortalMessage(_(u\'Changes made.\'))\n \ndiff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex 4450d31070..348211668b 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -143,5 +143,5 @@ remove link to page\n   Input text  css=.mce-content-body  foo\n   Execute Javascript    function selectElementContents(el) {var range = document.createRange(); range.selectNodeContents(el); var sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);} var el = document.getElementById("tinymce"); selectElementContents(el);\n   UnSelect Frame\n-  Click Button  css=div[aria-label="Remove link(s)"] button\n+  Click Button  css=div[aria-label="Remove link"] button\n   Click Button  css=#form-buttons-save\ndiff --git a/news/3086.feature b/news/3086.feature\nnew file mode 100644\nindex 0000000000..e3668f60b6\n--- /dev/null\n+++ b/news/3086.feature\n@@ -0,0 +1,3 @@\n+Insert virtual custom.css bundle into the header after diazo bundle.\n+Only add this when custom css is set in the theming control panel.\n+[MrTango]\ndiff --git a/news/3115.bugfix b/news/3115.bugfix\nnew file mode 100644\nindex 0000000000..db971854f2\n--- /dev/null\n+++ b/news/3115.bugfix\n@@ -0,0 +1 @@\n+Fixed saving ignored exception types in Python 3.  [maurits]\n'

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2020-06-28T00:20:19+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/Products.CMFPlone/commit/50143b8c1232fcbeda78e1e46fb5a58ba3ab5a9c

Merge pull request #3101 from plone/2861-backport

Backport #2860 for Plone 5.2

Files changed:
A news/2861.bugfix
M Products/CMFPlone/patterns/tinymce.py

b"diff --git a/Products/CMFPlone/patterns/tinymce.py b/Products/CMFPlone/patterns/tinymce.py\nindex 7283055d07..a858e7fe3d 100644\n--- a/Products/CMFPlone/patterns/tinymce.py\n+++ b/Products/CMFPlone/patterns/tinymce.py\n@@ -49,7 +49,7 @@ def get_content_css(self, style_css=''):\n                 files.append('/'.join([self.nav_root_url, url.strip()]))\n         theme = self.get_theme()\n         tinymce_content_css = getattr(theme, 'tinymce_content_css', None)\n-        if tinymce_content_css is not None:\n+        if tinymce_content_css is not None and tinymce_content_css != '':\n             for path in theme.tinymce_content_css.split(','):\n                 if path.startswith('http://') or path.startswith('https://'):\n                     files.append(path)\ndiff --git a/news/2861.bugfix b/news/2861.bugfix\nnew file mode 100644\nindex 0000000000..3a04299ce9\n--- /dev/null\n+++ b/news/2861.bugfix\n@@ -0,0 +1 @@\n+ If 'tinymce-content-css' option is missing in themes manifest.cfg prevent unnecessary loading of a css at nav_root_url while editing a page.  [krissik]\n\\ No newline at end of file\n"

