Repository: plone.app.iterate


Branch: refs/heads/master
Date: 2024-02-19T14:15:01+01:00
Author: Kim Paulissen (spereverde) <spereverde@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/f37417f6a8464746a1a1532116c3b777fc772502

Plone6 styles (#114)

* Adapt viewlet styles to Plone 6

* add button css vclasses

* add plone.app.layout as dependency

* wrap messages in container

* zpretty

---------

Co-authored-by: Philip Bauer &lt;bauer@starzel.de&gt;

Files changed:
A news/95.news
M plone/app/iterate/browser/cancel.pt
M plone/app/iterate/browser/checkin.pt
M plone/app/iterate/browser/checkout.pt
M plone/app/iterate/browser/info.py
M plone/app/iterate/browser/info_baseline.pt
M plone/app/iterate/browser/info_checkout.pt
M setup.py

b'diff --git a/news/95.news b/news/95.news\nnew file mode 100644\nindex 0000000..fc711eb\n--- /dev/null\n+++ b/news/95.news\n@@ -0,0 +1 @@\n+Adapt viewlet styles to Plone 6 [pbauer]\n\\ No newline at end of file\ndiff --git a/plone/app/iterate/browser/cancel.pt b/plone/app/iterate/browser/cancel.pt\nindex 3b25333..7068c2c 100644\n--- a/plone/app/iterate/browser/cancel.pt\n+++ b/plone/app/iterate/browser/cancel.pt\n@@ -36,14 +36,14 @@\n \n             <div class="formControls">\n \n-              <input class="destructive"\n+              <input class="btn btn-danger"\n                      name="form.button.Cancel"\n                      type="submit"\n                      value="Cancel checkout"\n                      i18n:attributes="value"\n               />\n \n-              <input class="standalone"\n+              <input class="btn btn-secondary"\n                      name="form.button.Keep"\n                      type="submit"\n                      value="Keep checkout"\ndiff --git a/plone/app/iterate/browser/checkin.pt b/plone/app/iterate/browser/checkin.pt\nindex 3feaffb..0b53c25 100644\n--- a/plone/app/iterate/browser/checkin.pt\n+++ b/plone/app/iterate/browser/checkin.pt\n@@ -57,14 +57,14 @@\n               </div>\n \n               <div class="formControls">\n-                <input class="context"\n+                <input class="btn btn-primary"\n                        name="form.button.Checkin"\n                        type="submit"\n                        value="Check in"\n                        i18n:attributes="value"\n                 />\n \n-                <input class="standalone"\n+                <input class="btn btn-secondary"\n                        name="form.button.Cancel"\n                        type="submit"\n                        value="Cancel"\ndiff --git a/plone/app/iterate/browser/checkout.pt b/plone/app/iterate/browser/checkout.pt\nindex 45b308b..25bfa24 100644\n--- a/plone/app/iterate/browser/checkout.pt\n+++ b/plone/app/iterate/browser/checkout.pt\n@@ -91,14 +91,14 @@\n \n         <div class="formControls">\n \n-          <input class="context"\n+          <input class="btn btn-primary"\n                  name="form.button.Checkout"\n                  type="submit"\n                  value="Check out"\n                  i18n:attributes="value"\n           />\n \n-          <input class="standalone"\n+          <input class="btn btn-secondary"\n                  name="form.button.Cancel"\n                  type="submit"\n                  value="Cancel"\ndiff --git a/plone/app/iterate/browser/info.py b/plone/app/iterate/browser/info.py\nindex c18fcb1..092d6f5 100644\n--- a/plone/app/iterate/browser/info.py\n+++ b/plone/app/iterate/browser/info.py\n@@ -4,6 +4,7 @@\n from plone.app.iterate.interfaces import ICheckinCheckoutPolicy\n from plone.app.iterate.interfaces import keys\n from plone.app.iterate.permissions import CheckoutPermission\n+from plone.app.layout.viewlets.globalstatusmessage import MTYPES_DISPLAY\n from plone.memoize.instance import memoize\n from Products.CMFCore.permissions import ModifyPortalContent\n from Products.CMFCore.utils import getToolByName\n@@ -96,6 +97,10 @@ def properties(self):\n     def _getReference(self):\n         raise NotImplementedError\n \n+    def display_info_for_mtype(self, mtype):\n+        """get info for display of an mtype"""\n+        return MTYPES_DISPLAY.get(mtype, MTYPES_DISPLAY["info"])\n+\n \n class BaselineInfoViewlet(BaseInfoViewlet):\n     index = ViewPageTemplateFile("info_baseline.pt")\ndiff --git a/plone/app/iterate/browser/info_baseline.pt b/plone/app/iterate/browser/info_baseline.pt\nindex 2728015..6e2c97d 100644\n--- a/plone/app/iterate/browser/info_baseline.pt\n+++ b/plone/app/iterate/browser/info_baseline.pt\n@@ -1,40 +1,47 @@\n-<div class="portalMessage warning"\n-     tal:define="\n-       working_copy view/working_copy;\n-       isAnon context/@@plone_portal_state/anonymous;\n-     "\n-     tal:condition="python: not isAnon"\n-     i18n:domain="plone"\n->\n+<div class="container">\n+  <div class="portalMessage ${python:display_info[\'cssclass\']}"\n+       role="alert"\n+       tal:define="\n+         working_copy view/working_copy;\n+         isAnon context/@@plone_portal_state/anonymous;\n+         display_info python:view.display_info_for_mtype(\'warning\');\n+         icons nocall: context/@@iconresolver;\n+       "\n+       tal:condition="python: not isAnon"\n+       i18n:domain="plone"\n+  >\n+\n+    <tal:icon tal:replace="structure python:icons.tag(display_info[\'icon\'], tag_alt=display_info[\'msg\'], tag_class=\'statusmessage-icon mb-1 me-2\')" />\n \n-  <strong i18n:translate="">Warning</strong>\n-  <tal:block i18n:translate="working_copy_info">\n+    <strong>${python:display_info[\'msg\']}</strong>\n+    <tal:block i18n:translate="working_copy_info">\n         This item is being edited by\n-    <a tal:content="view/creator_name"\n-       tal:omit-tag="not: view/creator_url"\n-       tal:attributes="\n-         href view/creator_url;\n-       "\n-       i18n:name="creator"\n-    >john smith</a>\n+      <a tal:content="view/creator_name"\n+         tal:omit-tag="not: view/creator_url"\n+         tal:attributes="\n+           href view/creator_url;\n+         "\n+         i18n:name="creator"\n+      >john smith</a>\n         in\n-    <a tal:attributes="\n-         href working_copy/@@plone_context_state/view_url;\n-         title working_copy/Description;\n-       "\n-       i18n:name="working_copy"\n-       i18n:translate="label_working_copy"\n-    >a working copy</a>\n+      <a tal:attributes="\n+           href working_copy/@@plone_context_state/view_url;\n+           title working_copy/Description;\n+         "\n+         i18n:name="working_copy"\n+         i18n:translate="label_working_copy"\n+      >a working copy</a>\n         created on\n-    <span tal:content="view/created"\n-          i18n:name="created"\n-    ></span>.\n+      <span tal:content="view/created"\n+            i18n:name="created"\n+      ></span>.\n \n-  </tal:block>\n+    </tal:block>\n \n-  (<a tal:attributes="\n-       href string:${context/absolute_url}/@@iterate_diff;\n-     "\n-     i18n:translate="label_view_changes"\n-  >View changes</a>)\n+    (<a tal:attributes="\n+         href string:${context/absolute_url}/@@iterate_diff;\n+       "\n+       i18n:translate="label_view_changes"\n+    >View changes</a>)\n+  </div>\n </div>\ndiff --git a/plone/app/iterate/browser/info_checkout.pt b/plone/app/iterate/browser/info_checkout.pt\nindex 9226b01..9d8f750 100644\n--- a/plone/app/iterate/browser/info_checkout.pt\n+++ b/plone/app/iterate/browser/info_checkout.pt\n@@ -1,40 +1,46 @@\n-<div class="portalMessage info"\n-     tal:define="\n-       baseline view/baseline;\n-     "\n-     i18n:domain="plone"\n->\n+<div class="container">\n+  <div class="portalMessage ${python:display_info[\'cssclass\']}"\n+       tal:define="\n+         baseline view/baseline;\n+         display_info python:view.display_info_for_mtype(\'warning\');\n+         icons nocall: context/@@iconresolver;\n+       "\n+       i18n:domain="plone"\n+  >\n+\n+    <tal:icon tal:replace="structure python:icons.tag(display_info[\'icon\'], tag_alt=display_info[\'msg\'], tag_class=\'statusmessage-icon mb-1 me-2\')" />\n \n-  <strong i18n:translate="">Warning</strong>\n-  <tal:block i18n:translate="checkout_info">\n+    <strong>${python:display_info[\'msg\']}</strong>\n+    <tal:block i18n:translate="checkout_info">\n \n         This is a working copy of\n-    <a tal:content="baseline/Title"\n-       tal:attributes="\n-         href baseline/@@plone_context_state/view_url;\n-         title baseline/Description;\n-       "\n-       i18n:name="baseline_title"\n-    ></a>, made by\n+      <a tal:content="baseline/Title"\n+         tal:attributes="\n+           href baseline/@@plone_context_state/view_url;\n+           title baseline/Description;\n+         "\n+         i18n:name="baseline_title"\n+      ></a>, made by\n \n-    <a tal:content="view/creator_name"\n-       tal:omit-tag="not: view/creator_url"\n-       tal:attributes="\n-         href view/creator_url;\n-       "\n-       i18n:name="creator"\n-    >john smith</a>\n+      <a tal:content="view/creator_name"\n+         tal:omit-tag="not: view/creator_url"\n+         tal:attributes="\n+           href view/creator_url;\n+         "\n+         i18n:name="creator"\n+      >john smith</a>\n \n         on\n \n-    <span tal:content="view/created"\n-          i18n:name="created"\n-    ></span>.\n-  </tal:block>\n+      <span tal:content="view/created"\n+            i18n:name="created"\n+      ></span>.\n+    </tal:block>\n \n-  (<a tal:attributes="\n-       href string:${context/absolute_url}/@@iterate_diff;\n-     "\n-     i18n:translate="view_changes"\n-  >View changes</a>)\n+    (<a tal:attributes="\n+         href string:${context/absolute_url}/@@iterate_diff;\n+       "\n+       i18n:translate="view_changes"\n+    >View changes</a>)\n+  </div>\n </div>\ndiff --git a/setup.py b/setup.py\nindex 13dd918..ff43e54 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -63,6 +63,7 @@\n         "zope.schema",\n         "zope.viewlet",\n         "persistent",\n+        "plone.app.layout",\n         "plone.base",\n         "plone.dexterity",\n         "plone.registry",\n'

