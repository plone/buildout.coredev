Repository: plone.app.registry


Branch: refs/heads/master
Date: 2021-02-13T09:54:41+01:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.registry/commit/6d5fe54848c1eb9c232a1999bee140c1b7e9d06d

Barceloneta LTS (#44)

* disable old styles

* bootstrap markup update

* bootstrap markup update

* bs5 form updates

* use icon from icon resolver

* update button classes for bootstrap

* update button classes for bootstrap

* use explicit icon name

* turn configlet portlets into menu

* bootstrap b1 changes

Co-authored-by: Peter Holzer &lt;peter.holzer@agitator.com&gt;
Co-authored-by: Jens W. Klein &lt;jk@kleinundpartner.at&gt;

Files changed:
M plone/app/registry/browser/controlpanel.py
M plone/app/registry/browser/edit.py
M plone/app/registry/browser/records.py
M plone/app/registry/browser/resources/style.css
M plone/app/registry/browser/templates/controlpanel_layout.pt
M plone/app/registry/browser/templates/records.pt
M plone/app/registry/profiles/default/controlpanel.xml

b'diff --git a/plone/app/registry/browser/controlpanel.py b/plone/app/registry/browser/controlpanel.py\nindex 27e160f..8042f86 100644\n--- a/plone/app/registry/browser/controlpanel.py\n+++ b/plone/app/registry/browser/controlpanel.py\n@@ -51,8 +51,8 @@ def getContent(self):\n \n     def updateActions(self):\n         super(RegistryEditForm, self).updateActions()\n-        self.actions[\'save\'].addClass("context")\n-        self.actions[\'cancel\'].addClass("standalone")\n+        self.actions[\'save\'].addClass("btn btn-primary")\n+        self.actions[\'cancel\'].addClass("btn btn-secondary")\n \n     @button.buttonAndHandler(_(u"Save"), name=\'save\')\n     def handleSave(self, action):\ndiff --git a/plone/app/registry/browser/edit.py b/plone/app/registry/browser/edit.py\nindex 846fb88..2c565ef 100644\n--- a/plone/app/registry/browser/edit.py\n+++ b/plone/app/registry/browser/edit.py\n@@ -28,8 +28,8 @@ def update(self):\n \n     def updateActions(self):\n         super(RecordEditForm, self).updateActions()\n-        self.actions[\'save\'].addClass("context")\n-        self.actions[\'cancel\'].addClass("standalone")\n+        self.actions[\'save\'].addClass("btn btn-primary")\n+        self.actions[\'cancel\'].addClass("btn btn-secondary")\n \n     @property\n     def label(self):\ndiff --git a/plone/app/registry/browser/records.py b/plone/app/registry/browser/records.py\nindex 93454f1..2975953 100644\n--- a/plone/app/registry/browser/records.py\n+++ b/plone/app/registry/browser/records.py\n@@ -103,6 +103,10 @@ class RecordsControlPanel(AutoExtensibleForm, form.Form):\n     def action(self):\n         return \'{url}#autotoc-item-autotoc-3\'.format(url=self.context.absolute_url())\n \n+    def updateActions(self):\n+        super(RecordsControlPanel, self).updateActions()\n+        self.actions[\'addfield\'].addClass(\'btn-primary\')\n+\n     @button.buttonAndHandler(u\'Add field\', name=\'addfield\')\n     def action_addfield(self, action):\n         data, errors = self.extractData()\ndiff --git a/plone/app/registry/browser/resources/style.css b/plone/app/registry/browser/resources/style.css\nindex 5d1275f..5149225 100644\n--- a/plone/app/registry/browser/resources/style.css\n+++ b/plone/app/registry/browser/resources/style.css\n@@ -1,4 +1,4 @@\n-#searchrow th{\n+/* #searchrow th{\n     padding:0;\n     margin:0;\n     position: relative;\n@@ -36,4 +36,4 @@\n     bottom: 0;\n     right: 0;\n }\n-\n+ */\ndiff --git a/plone/app/registry/browser/templates/controlpanel_layout.pt b/plone/app/registry/browser/templates/controlpanel_layout.pt\nindex 1dadb1f..b98f2b4 100644\n--- a/plone/app/registry/browser/templates/controlpanel_layout.pt\n+++ b/plone/app/registry/browser/templates/controlpanel_layout.pt\n@@ -7,26 +7,25 @@\n       i18n:domain="plone">\n \n <body>\n-<div metal:fill-slot="prefs_configlet_main">\n+<tal:main metal:fill-slot="prefs_configlet_main">\n \n-    <a id="setup-link" class="link-parent"\n-       tal:attributes="href view/control_panel_url"\n-       i18n:translate="">\n-        Site Setup\n-    </a>\n+  <header>\n \n-    <h1 class="documentFirstHeading" tal:content="view/label">View Title</h1>\n+    <h1 tal:content="view/label">View Title</h1>\n+    <p class="lead" tal:condition="view/description | nothing" tal:content="view/description">View Description</p>\n \n-    <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n-      Portal status message\n-    </div>\n+  </header>\n+\n+  <div metal:use-macro="context/global_statusmessage/macros/portal_message">\n+    Portal status message\n+  </div>\n \n-    <div id="content-core">\n-        <div id="layout-contents">\n-            <span tal:replace="structure view/contents" />\n-        </div>\n+  <div id="content-core">\n+    <div id="layout-contents">\n+      <span tal:replace="structure view/contents" />\n     </div>\n+  </div>\n \n-</div>\n+</tal:main>\n </body>\n </html>\ndiff --git a/plone/app/registry/browser/templates/records.pt b/plone/app/registry/browser/templates/records.pt\nindex 5dbb2d3..0abd13d 100644\n--- a/plone/app/registry/browser/templates/records.pt\n+++ b/plone/app/registry/browser/templates/records.pt\n@@ -15,66 +15,83 @@\n </metal:block>\n \n <body>\n-<div id="content" metal:fill-slot="prefs_configlet_content"\n+<article id="content" metal:fill-slot="prefs_configlet_main"\n   tal:define="records view/records">\n \n-    <a id="setup-link" class="link-parent"\n-       tal:attributes="href string:$portal_url/@@overview-controlpanel"\n-       i18n:translate="">\n-       Site Setup\n-    </a>\n-\n+  <header>\n     <h1 class="documentFirstHeading" i18n:translate="heading_registry">Configuration Registry</h1>\n \n-    <p class="documentDescription" i18n:translate="description_registry">\n+    <p class="lead" i18n:translate="description_registry">\n         The table below shows record currently managed by the configuration\n         registry. Click on a record to edit it.\n     </p>\n-\n+  </header>\n     <div id="content-core">\n       <div class="pat-autotoc autotabs"\n            data-pat-autotoc="section:.tab;levels:h2;">\n         <div id="recordsContainer" class="tab">\n           <h2>Records</h2>\n-          <table id="recordsTable" class="listing">\n-              <thead>\n-                  <tr id="searchrow">\n-                      <th colspan="5" class="nosort">\n-                          <form id="clear-filter">\n-                              <button type="submit" i18n:translate="clear_filter">\n-                                  Clear filter\n-                              </button>\n-                          </form>\n-                          <form tal:define="qp request/qp|nothing;\n-                                            q request/q|nothing;" id="registry-filter">\n-                            <div class="row">\n-                              <div class="col-sm-10">\n-                                <input name="q" id="q" placeholder="filter by..." size="30"\n-                                    i18n:attributes="placeholder"\n-                                    tal:attributes="value python: qp or q" />\n-                              </div>\n-                              <div class="col-sm-2">\n-                                <input type="submit" value="Filter" i18n:attributes="value" />\n-                              </div>\n-                            </div>\n-                            <div class="row">\n-                              <div class="col-sm-6">\n-                                <span i18n:translate="or">or</span>\n-                                <select name="qp" tal:define="prefixes python: sorted(view.prefixes.keys())">\n-                                  <option value="" i18n:translate="select_prefix">Select Prefix</option>\n-                                  <tal:prefixes tal:repeat="prefix prefixes">\n-                                    <option\n-                                      tal:define="value python: \'prefix:\' + (view.prefixes[prefix] or \'\')"\n-                                      tal:attributes="value value;"\n-                                      tal:content="prefix"/>\n-                                  </tal:prefixes>\n-                                </select>\n-                              </div>\n-                            </div>\n-                          </form>\n+          <div id="recordsTable">\n \n-                      </th>\n-                  </tr>\n+            <div id="searchrow">\n+\n+                <form tal:define="qp request/qp|nothing;\n+                                  q request/q|nothing;" id="registry-filter">\n+\n+                  <div class="mb-3">\n+                    <div class="input-group">\n+                      <input class="form-control"\n+                        name="q" id="q"\n+                        placeholder="filter by..."\n+                        i18n:attributes="placeholder"\n+                        tal:attributes="value python: qp or q" />\n+                      <div class="input-group-append">\n+                        <button class="btn btn-primary"\n+                          type="submit"\n+                          value="Filter"\n+                          i18n:translate=""\n+                          i18n:attributes="value">\n+                          Filter\n+                        </button>\n+                      </div>\n+                    </div>\n+                  </div>\n+\n+                  <div class="row justify-content-between">\n+                    <div class="mb-3 col-auto">\n+                      <div class="input-group">\n+                        <label class="col-form-label me-2" i18n:translate="or">or</label>\n+                        <select class="form-select"\n+                          name="qp"\n+                          tal:define="prefixes python: sorted(view.prefixes.keys())">\n+                          <option value="" i18n:translate="select_prefix">Select Prefix</option>\n+                          <tal:prefixes tal:repeat="prefix prefixes">\n+                            <option\n+                              tal:define="value python: \'prefix:\' + (view.prefixes[prefix] or \'\')"\n+                              tal:attributes="value value;"\n+                              tal:content="prefix"/>\n+                          </tal:prefixes>\n+                        </select>\n+                      </div>\n+                    </div>\n+                    <div class="mb-3 col-auto">\n+                      <form id="clear-filter">\n+                          <button class="btn btn-secondary"\n+                            type="submit"\n+                            i18n:translate="clear_filter">\n+                              Clear filter\n+                          </button>\n+                      </form>\n+                    </div>\n+                  </div>\n+\n+                </form>\n+\n+\n+            </div>\n+\n+          <table class="table table-responsive table-bordered table-striped">\n+              <thead>\n                   <tr>\n                       <th i18n:translate="heading_name">Name</th>\n                       <th i18n:translate="heading_title">Title</th>\n@@ -103,12 +120,10 @@\n                                   class="value"/>\n                             <tal:non-iface tal:condition="not: record/interfaceName|nothing">\n                               <br />\n-                              (\n-                              <a href="${context/absolute_url}/@@delete-record?name=${record/__name__}"\n+                             (<a href="${context/absolute_url}/@@delete-record?name=${record/__name__}"\n                                  class="recordsDeleteLink" i18n:translate="">\n                                  Delete record\n-                              </a>\n-                              )\n+                              </a>)\n                             </tal:non-iface>\n                           </td>\n                       </tr>\n@@ -123,13 +138,14 @@\n               </tfoot>\n           </table>\n         </div>\n+        </div>\n         <div class="tab">\n           <h2 i18n:translate="export">Export</h2>\n           <p i18n:translate="registry_export_text">Will export the entire registry into a single XML file.</p>\n           <form method="POST">\n             <input type="hidden" name="button.exportregistry" value="true"/>\n             <div class="formControls">\n-              <button type="submit" i18n:translate="export_button">Export Now</button>\n+              <button class="btn btn-primary" type="submit" i18n:translate="export_button">Export Now</button>\n             </div>\n           </form>\n           <hr />\n@@ -138,13 +154,13 @@\n         <div class="tab">\n           <h2 i18n:translate="import">Import</h2>\n           <form method="POST" enctype=\'multipart/form-data\'>\n-            <div class="form-group field">\n-              <label for="exportFile" i18n:translate="">Registry XML File</label>\n+            <div class="mb-3 field">\n+              <label for="exportFile" class="form-label" i18n:translate="">Registry XML File</label>\n               <input type="file" name="file" id="exportFile" class="form-control" />\n             </div>\n             <input type="hidden" name="button.importregistry" value="true"/>\n-            <div class="formControls">\n-              <button type="submit" i18n:translate="import_button">Import File</button>\n+            <div class="formControls mt-3">\n+              <button class="btn btn-primary" type="submit" i18n:translate="import_button">Import File</button>\n             </div>\n           </form>\n         </div>\n@@ -158,6 +174,6 @@\n       <script type="text/javascript" src="${context/portal_url}/++resource++plone.app.registry/registry.js">\n       </script>\n     </div>\n-</div>\n+</article>\n </body>\n </html>\ndiff --git a/plone/app/registry/profiles/default/controlpanel.xml b/plone/app/registry/profiles/default/controlpanel.xml\nindex 44b9d3b..30d5f57 100644\n--- a/plone/app/registry/profiles/default/controlpanel.xml\n+++ b/plone/app/registry/profiles/default/controlpanel.xml\n@@ -4,7 +4,7 @@\n  <configlet title="Configuration Registry" action_id="plone.app.registry"\n     appId="plone.app.registry" category="plone-advanced" condition_expr=""\n     url_expr="string:${portal_url}/portal_registry"\n-    icon_expr="string:$portal_url/++resource++plone.app.registry/icon.png"\n+    icon_expr="string:gear"\n     visible="True" i18n:attributes="title">\n   <permission>Manage portal</permission>\n  </configlet>\n'

