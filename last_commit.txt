Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-06-19T11:06:35+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/0743d4884ec1e477200f09dd45d51e3d6dbc52b1

Mockup TinyMCE settings: Remove unused loadingBaseUrl option.

Files changed:
A news/3765-1.bugfix
M Products/CMFPlone/patterns/settings.py

b'diff --git a/Products/CMFPlone/patterns/settings.py b/Products/CMFPlone/patterns/settings.py\nindex 84c9f663a2..5573868983 100644\n--- a/Products/CMFPlone/patterns/settings.py\n+++ b/Products/CMFPlone/patterns/settings.py\n@@ -156,9 +156,6 @@ def tinymce(self):\n             "pictureVariants": self.picture_variants,\n             "imageCaptioningEnabled": self.image_captioning,\n             "linkAttribute": "UID",\n-            # This is for loading the languages on tinymce\n-            "loadingBaseUrl": "{}/++plone++static/components/tinymce-builded/"\n-            "js/tinymce".format(portal_url),\n             "relatedItems": related_items_config,\n             "prependToScalePart": "/@@images/image/",\n             "prependToUrl": "{}/resolveuid/".format(site_path.rstrip("/")),\ndiff --git a/news/3765-1.bugfix b/news/3765-1.bugfix\nnew file mode 100644\nindex 0000000000..befe772169\n--- /dev/null\n+++ b/news/3765-1.bugfix\n@@ -0,0 +1 @@\n+Mockup TinyMCE settings: Remove unused loadingBaseUrl option.\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-06-19T11:06:35+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/05a1d6ff506a6b73130a38cc44cbcfc9f409e4c4

Mockup TinyMCE settings: Remove deprecated AtD plugin settings.

Files changed:
A news/3765-2.bugfix
M Products/CMFPlone/patterns/tinymce.py
M Products/CMFPlone/tests/test_patternsettings.py

b'diff --git a/Products/CMFPlone/patterns/tinymce.py b/Products/CMFPlone/patterns/tinymce.py\nindex 27d569ef83..62fca9c63d 100644\n--- a/Products/CMFPlone/patterns/tinymce.py\n+++ b/Products/CMFPlone/patterns/tinymce.py\n@@ -139,31 +139,6 @@ def get_tiny_config(self):\n                 "plonelink ploneimage inserttable |" " cell row column deletetable"\n             )\n \n-        if settings.libraries_spellchecker_choice == "AtD":\n-            mtool = getToolByName(self.context, "portal_membership")\n-            member = mtool.getAuthenticatedMember()\n-            member_id = member.getId()\n-            if member_id:\n-                if "compat3x" not in tiny_config["plugins"]:\n-                    tiny_config["plugins"].append("compat3x")\n-                tiny_config["external_plugins"][\n-                    "AtD"\n-                ] = "{}/++plone++static/tinymce-AtD-plugin/" "editor_plugin.js".format(\n-                    self.nav_root_url\n-                )\n-                # None when Anonymous User\n-                tiny_config["atd_rpc_id"] = "plone-" + member_id\n-                tiny_config["atd_rpc_url"] = self.nav_root_url\n-                tiny_config["atd_show_types"] = ",".join(\n-                    settings.libraries_atd_show_types\n-                )\n-                tiny_config["atd_ignore_strings"] = ",".join(\n-                    settings.libraries_atd_ignore_strings\n-                )\n-                toolbar_additions.append("AtD")\n-        elif settings.libraries_spellchecker_choice == "AtD":\n-            tiny_config["browser_spellcheck"] = True\n-\n         if toolbar_additions:\n             tiny_config["toolbar"] += " | {}".format(" ".join(toolbar_additions))\n \ndiff --git a/Products/CMFPlone/tests/test_patternsettings.py b/Products/CMFPlone/tests/test_patternsettings.py\nindex e485b2bff3..b447b96e51 100644\n--- a/Products/CMFPlone/tests/test_patternsettings.py\n+++ b/Products/CMFPlone/tests/test_patternsettings.py\n@@ -22,15 +22,6 @@ def get_conf(self):\n         )\n         return json.loads(adapter.tinymce()["data-pat-tinymce"])\n \n-    def test_atd_included(self):\n-        registry = getUtility(IRegistry)\n-        settings = registry.forInterface(ITinyMCESchema, prefix="plone")\n-        settings.libraries_spellchecker_choice = "AtD"\n-        login(self.layer["portal"], TEST_USER_NAME)\n-        conf = self.get_conf()\n-        self.assertTrue("compat3x" in conf["tiny"]["plugins"])\n-        self.assertTrue("AtD" in conf["tiny"]["external_plugins"])\n-\n     def test_style_formats(self):\n         conf = self.get_conf()\n         self.assertEqual(len(conf["tiny"]["style_formats"]), 5)\ndiff --git a/news/3765-2.bugfix b/news/3765-2.bugfix\nnew file mode 100644\nindex 0000000000..64cdb7bfc9\n--- /dev/null\n+++ b/news/3765-2.bugfix\n@@ -0,0 +1 @@\n+Mockup TinyMCE settings: Remove deprecated AtD plugin settings.\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-06-19T11:06:35+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/7e25a32caf0a3ac3f1c11f9a2b9013af92812331

Mockup TinyMCE settings: Remove unused AtD related views.

Files changed:
A news/3765-3.bugfix
M Products/CMFPlone/browser/configure.zcml

b'diff --git a/Products/CMFPlone/browser/configure.zcml b/Products/CMFPlone/browser/configure.zcml\nindex 36941da36b..23ecdcfdd3 100644\n--- a/Products/CMFPlone/browser/configure.zcml\n+++ b/Products/CMFPlone/browser/configure.zcml\n@@ -224,15 +224,6 @@\n       permission="zope2.View"\n       />\n \n-  <!-- AtD Support -->\n-  <browser:page\n-      name="checkDocument"\n-      for="*"\n-      class=".atd.ATDProxyView"\n-      attribute="checkDocument"\n-      permission="zope2.View"\n-      />\n-\n   <!-- Default Page View -->\n   <browser:page\n       name="default_page"\ndiff --git a/news/3765-3.bugfix b/news/3765-3.bugfix\nnew file mode 100644\nindex 0000000000..0f699fdb93\n--- /dev/null\n+++ b/news/3765-3.bugfix\n@@ -0,0 +1 @@\n+Mockup TinyMCE settings: Remove unused AtD related views.\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-06-19T11:06:36+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/848321cc2557fe2e29e5d1882246f87fbf40c7e4

Mockup TinyMCE settings: Remove unused ITinyMCESpellCheckerSchema and ITinyMCESpellCheckerForm.

Files changed:
A news/3765-4.bugfix
M Products/CMFPlone/controlpanel/browser/tinymce.py
M Products/CMFPlone/interfaces/__init__.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/tinymce.py b/Products/CMFPlone/controlpanel/browser/tinymce.py\nindex a7cd3e97ee..aa829445e2 100644\n--- a/Products/CMFPlone/controlpanel/browser/tinymce.py\n+++ b/Products/CMFPlone/controlpanel/browser/tinymce.py\n@@ -5,7 +5,6 @@\n from plone.base.interfaces import ITinyMCEPluginSchema\n from plone.base.interfaces import ITinyMCEResourceTypesSchema\n from plone.base.interfaces import ITinyMCESchema\n-from plone.base.interfaces import ITinyMCESpellCheckerSchema\n from z3c.form import field\n from z3c.form import group\n from z3c.form.browser.checkbox import CheckBoxFieldWidget\n@@ -16,11 +15,6 @@ class TinyMCEPluginForm(group.GroupForm):\n     fields = field.Fields(ITinyMCEPluginSchema)\n \n \n-class TinyMCESpellCheckerForm(group.GroupForm):\n-    label = _("Spell Checker")\n-    fields = field.Fields(ITinyMCESpellCheckerSchema)\n-\n-\n class TinyMCEResourceTypesForm(group.GroupForm):\n     label = _("Resource Types")\n     fields = field.Fields(ITinyMCEResourceTypesSchema)\n@@ -39,7 +33,6 @@ class TinyMCEControlPanelForm(controlpanel.RegistryEditForm):\n     fields = field.Fields(ITinyMCELayoutSchema)\n     groups = (\n         TinyMCEPluginForm,\n-        TinyMCESpellCheckerForm,\n         TinyMCEResourceTypesForm,\n         TinyMCEAdvancedForm,\n     )\ndiff --git a/Products/CMFPlone/interfaces/__init__.py b/Products/CMFPlone/interfaces/__init__.py\nindex f00871004f..afb3e1df15 100644\n--- a/Products/CMFPlone/interfaces/__init__.py\n+++ b/Products/CMFPlone/interfaces/__init__.py\n@@ -31,7 +31,6 @@\n     ITinyMCEPluginSchema="plone.base.interfaces.controlpanel:ITinyMCEPluginSchema",\n     ITinyMCEResourceTypesSchema="plone.base.interfaces.controlpanel:ITinyMCEResourceTypesSchema",\n     ITinyMCESchema="plone.base.interfaces.controlpanel:ITinyMCESchema",\n-    ITinyMCESpellCheckerSchema="plone.base.interfaces.controlpanel:ITinyMCESpellCheckerSchema",\n     ITypesSchema="plone.base.interfaces.controlpanel:ITypesSchema",\n     IUserGroupsSettingsSchema="plone.base.interfaces.controlpanel:IUserGroupsSettingsSchema",\n     IConfigurationChangedEvent="plone.base.interfaces.events:IConfigurationChangedEvent",\ndiff --git a/news/3765-4.bugfix b/news/3765-4.bugfix\nnew file mode 100644\nindex 0000000000..47a716e6a4\n--- /dev/null\n+++ b/news/3765-4.bugfix\n@@ -0,0 +1 @@\n+Mockup TinyMCE settings: Remove unused ITinyMCESpellCheckerSchema and ITinyMCESpellCheckerForm.\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-06-19T15:19:55+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@py76.be>
Commit: https://github.com/plone/Products.CMFPlone/commit/dce6b9751de41bf15f53d827a4f5e0853b946168

Merge pull request #3765 from plone/cleanup-patterns

Cleanup patterns settings

Files changed:
A news/3765-1.bugfix
A news/3765-2.bugfix
A news/3765-3.bugfix
A news/3765-4.bugfix
M Products/CMFPlone/browser/configure.zcml
M Products/CMFPlone/controlpanel/browser/tinymce.py
M Products/CMFPlone/interfaces/__init__.py
M Products/CMFPlone/patterns/settings.py
M Products/CMFPlone/patterns/tinymce.py
M Products/CMFPlone/tests/test_patternsettings.py

b'diff --git a/Products/CMFPlone/browser/configure.zcml b/Products/CMFPlone/browser/configure.zcml\nindex 36941da36b..23ecdcfdd3 100644\n--- a/Products/CMFPlone/browser/configure.zcml\n+++ b/Products/CMFPlone/browser/configure.zcml\n@@ -224,15 +224,6 @@\n       permission="zope2.View"\n       />\n \n-  <!-- AtD Support -->\n-  <browser:page\n-      name="checkDocument"\n-      for="*"\n-      class=".atd.ATDProxyView"\n-      attribute="checkDocument"\n-      permission="zope2.View"\n-      />\n-\n   <!-- Default Page View -->\n   <browser:page\n       name="default_page"\ndiff --git a/Products/CMFPlone/controlpanel/browser/tinymce.py b/Products/CMFPlone/controlpanel/browser/tinymce.py\nindex a7cd3e97ee..aa829445e2 100644\n--- a/Products/CMFPlone/controlpanel/browser/tinymce.py\n+++ b/Products/CMFPlone/controlpanel/browser/tinymce.py\n@@ -5,7 +5,6 @@\n from plone.base.interfaces import ITinyMCEPluginSchema\n from plone.base.interfaces import ITinyMCEResourceTypesSchema\n from plone.base.interfaces import ITinyMCESchema\n-from plone.base.interfaces import ITinyMCESpellCheckerSchema\n from z3c.form import field\n from z3c.form import group\n from z3c.form.browser.checkbox import CheckBoxFieldWidget\n@@ -16,11 +15,6 @@ class TinyMCEPluginForm(group.GroupForm):\n     fields = field.Fields(ITinyMCEPluginSchema)\n \n \n-class TinyMCESpellCheckerForm(group.GroupForm):\n-    label = _("Spell Checker")\n-    fields = field.Fields(ITinyMCESpellCheckerSchema)\n-\n-\n class TinyMCEResourceTypesForm(group.GroupForm):\n     label = _("Resource Types")\n     fields = field.Fields(ITinyMCEResourceTypesSchema)\n@@ -39,7 +33,6 @@ class TinyMCEControlPanelForm(controlpanel.RegistryEditForm):\n     fields = field.Fields(ITinyMCELayoutSchema)\n     groups = (\n         TinyMCEPluginForm,\n-        TinyMCESpellCheckerForm,\n         TinyMCEResourceTypesForm,\n         TinyMCEAdvancedForm,\n     )\ndiff --git a/Products/CMFPlone/interfaces/__init__.py b/Products/CMFPlone/interfaces/__init__.py\nindex f00871004f..afb3e1df15 100644\n--- a/Products/CMFPlone/interfaces/__init__.py\n+++ b/Products/CMFPlone/interfaces/__init__.py\n@@ -31,7 +31,6 @@\n     ITinyMCEPluginSchema="plone.base.interfaces.controlpanel:ITinyMCEPluginSchema",\n     ITinyMCEResourceTypesSchema="plone.base.interfaces.controlpanel:ITinyMCEResourceTypesSchema",\n     ITinyMCESchema="plone.base.interfaces.controlpanel:ITinyMCESchema",\n-    ITinyMCESpellCheckerSchema="plone.base.interfaces.controlpanel:ITinyMCESpellCheckerSchema",\n     ITypesSchema="plone.base.interfaces.controlpanel:ITypesSchema",\n     IUserGroupsSettingsSchema="plone.base.interfaces.controlpanel:IUserGroupsSettingsSchema",\n     IConfigurationChangedEvent="plone.base.interfaces.events:IConfigurationChangedEvent",\ndiff --git a/Products/CMFPlone/patterns/settings.py b/Products/CMFPlone/patterns/settings.py\nindex 84c9f663a2..5573868983 100644\n--- a/Products/CMFPlone/patterns/settings.py\n+++ b/Products/CMFPlone/patterns/settings.py\n@@ -156,9 +156,6 @@ def tinymce(self):\n             "pictureVariants": self.picture_variants,\n             "imageCaptioningEnabled": self.image_captioning,\n             "linkAttribute": "UID",\n-            # This is for loading the languages on tinymce\n-            "loadingBaseUrl": "{}/++plone++static/components/tinymce-builded/"\n-            "js/tinymce".format(portal_url),\n             "relatedItems": related_items_config,\n             "prependToScalePart": "/@@images/image/",\n             "prependToUrl": "{}/resolveuid/".format(site_path.rstrip("/")),\ndiff --git a/Products/CMFPlone/patterns/tinymce.py b/Products/CMFPlone/patterns/tinymce.py\nindex 27d569ef83..62fca9c63d 100644\n--- a/Products/CMFPlone/patterns/tinymce.py\n+++ b/Products/CMFPlone/patterns/tinymce.py\n@@ -139,31 +139,6 @@ def get_tiny_config(self):\n                 "plonelink ploneimage inserttable |" " cell row column deletetable"\n             )\n \n-        if settings.libraries_spellchecker_choice == "AtD":\n-            mtool = getToolByName(self.context, "portal_membership")\n-            member = mtool.getAuthenticatedMember()\n-            member_id = member.getId()\n-            if member_id:\n-                if "compat3x" not in tiny_config["plugins"]:\n-                    tiny_config["plugins"].append("compat3x")\n-                tiny_config["external_plugins"][\n-                    "AtD"\n-                ] = "{}/++plone++static/tinymce-AtD-plugin/" "editor_plugin.js".format(\n-                    self.nav_root_url\n-                )\n-                # None when Anonymous User\n-                tiny_config["atd_rpc_id"] = "plone-" + member_id\n-                tiny_config["atd_rpc_url"] = self.nav_root_url\n-                tiny_config["atd_show_types"] = ",".join(\n-                    settings.libraries_atd_show_types\n-                )\n-                tiny_config["atd_ignore_strings"] = ",".join(\n-                    settings.libraries_atd_ignore_strings\n-                )\n-                toolbar_additions.append("AtD")\n-        elif settings.libraries_spellchecker_choice == "AtD":\n-            tiny_config["browser_spellcheck"] = True\n-\n         if toolbar_additions:\n             tiny_config["toolbar"] += " | {}".format(" ".join(toolbar_additions))\n \ndiff --git a/Products/CMFPlone/tests/test_patternsettings.py b/Products/CMFPlone/tests/test_patternsettings.py\nindex e485b2bff3..b447b96e51 100644\n--- a/Products/CMFPlone/tests/test_patternsettings.py\n+++ b/Products/CMFPlone/tests/test_patternsettings.py\n@@ -22,15 +22,6 @@ def get_conf(self):\n         )\n         return json.loads(adapter.tinymce()["data-pat-tinymce"])\n \n-    def test_atd_included(self):\n-        registry = getUtility(IRegistry)\n-        settings = registry.forInterface(ITinyMCESchema, prefix="plone")\n-        settings.libraries_spellchecker_choice = "AtD"\n-        login(self.layer["portal"], TEST_USER_NAME)\n-        conf = self.get_conf()\n-        self.assertTrue("compat3x" in conf["tiny"]["plugins"])\n-        self.assertTrue("AtD" in conf["tiny"]["external_plugins"])\n-\n     def test_style_formats(self):\n         conf = self.get_conf()\n         self.assertEqual(len(conf["tiny"]["style_formats"]), 5)\ndiff --git a/news/3765-1.bugfix b/news/3765-1.bugfix\nnew file mode 100644\nindex 0000000000..befe772169\n--- /dev/null\n+++ b/news/3765-1.bugfix\n@@ -0,0 +1 @@\n+Mockup TinyMCE settings: Remove unused loadingBaseUrl option.\ndiff --git a/news/3765-2.bugfix b/news/3765-2.bugfix\nnew file mode 100644\nindex 0000000000..64cdb7bfc9\n--- /dev/null\n+++ b/news/3765-2.bugfix\n@@ -0,0 +1 @@\n+Mockup TinyMCE settings: Remove deprecated AtD plugin settings.\ndiff --git a/news/3765-3.bugfix b/news/3765-3.bugfix\nnew file mode 100644\nindex 0000000000..0f699fdb93\n--- /dev/null\n+++ b/news/3765-3.bugfix\n@@ -0,0 +1 @@\n+Mockup TinyMCE settings: Remove unused AtD related views.\ndiff --git a/news/3765-4.bugfix b/news/3765-4.bugfix\nnew file mode 100644\nindex 0000000000..47a716e6a4\n--- /dev/null\n+++ b/news/3765-4.bugfix\n@@ -0,0 +1 @@\n+Mockup TinyMCE settings: Remove unused ITinyMCESpellCheckerSchema and ITinyMCESpellCheckerForm.\n'

