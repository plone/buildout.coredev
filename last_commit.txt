Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2022-08-24T11:47:25+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/8f89e16ab211bd4f46909908634779f6a779ea7f

Fixed adding control panel action via ZMI.

Files changed:
A news/1959.bugfix
M Products/CMFPlone/PloneControlPanel.py

b'diff --git a/Products/CMFPlone/PloneControlPanel.py b/Products/CMFPlone/PloneControlPanel.py\nindex e5b05f12b9..3cbfaa60e3 100644\n--- a/Products/CMFPlone/PloneControlPanel.py\n+++ b/Products/CMFPlone/PloneControlPanel.py\n@@ -227,7 +227,7 @@ def addAction(self,\n                   description=\'\',\n                   REQUEST=None,\n                   ):\n-        # Add an action to our list.\n+        """Add an action to our list."""\n         if not name:\n             raise ValueError(\'A name is required.\')\n \ndiff --git a/news/1959.bugfix b/news/1959.bugfix\nnew file mode 100644\nindex 0000000000..04254865c2\n--- /dev/null\n+++ b/news/1959.bugfix\n@@ -0,0 +1,2 @@\n+Fixed adding control panel action via ZMI.\n+[maurits]\n'

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2022-08-24T23:08:03+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/db054cd85e7f2325cb5090df0f2282f18cdbd690

Fixed test registerConfiglet: instead of NotFound we get Unauthorized.

Files changed:
M Products/CMFPlone/tests/testSecurity.py

b'diff --git a/Products/CMFPlone/tests/testSecurity.py b/Products/CMFPlone/tests/testSecurity.py\nindex 6d8ae3008c..8b799931bc 100644\n--- a/Products/CMFPlone/tests/testSecurity.py\n+++ b/Products/CMFPlone/tests/testSecurity.py\n@@ -87,7 +87,9 @@ def test_widget_traversal_2(self):\n     def test_registerConfiglet_1(self):\n         VECTOR = "/plone/portal_controlpanel/registerConfiglet?id=cake&name=Cakey&action=woo&permission=View&icon_expr="\n         res = self.publish(VECTOR)\n-        self.assertEqual(404, res.status)\n+        self.assertEqual(302, res.status)\n+        self.assertTrue(res.headers[\'location\'].startswith(\n+            \'http://nohost/plone/acl_users/credentials_cookie_auth/require_login\'))\n \n     def test_registerConfiglet_2(self):\n         VECTOR = "/plone/portal_controlpanel/registerConfiglet?id=cake&name=Cakey&action=woo&permission=View&icon_expr="\n'

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2022-08-25T17:28:37+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/5c969e16774dff83ea9d78855bad63ee0bb4c0a7

Merge pull request #3621 from plone/maurits-issue-1959-52

Fixed adding control panel action via ZMI. [5.2]

Files changed:
A news/1959.bugfix
M Products/CMFPlone/PloneControlPanel.py
M Products/CMFPlone/tests/testSecurity.py

b'diff --git a/Products/CMFPlone/PloneControlPanel.py b/Products/CMFPlone/PloneControlPanel.py\nindex e5b05f12b9..3cbfaa60e3 100644\n--- a/Products/CMFPlone/PloneControlPanel.py\n+++ b/Products/CMFPlone/PloneControlPanel.py\n@@ -227,7 +227,7 @@ def addAction(self,\n                   description=\'\',\n                   REQUEST=None,\n                   ):\n-        # Add an action to our list.\n+        """Add an action to our list."""\n         if not name:\n             raise ValueError(\'A name is required.\')\n \ndiff --git a/Products/CMFPlone/tests/testSecurity.py b/Products/CMFPlone/tests/testSecurity.py\nindex 6d8ae3008c..8b799931bc 100644\n--- a/Products/CMFPlone/tests/testSecurity.py\n+++ b/Products/CMFPlone/tests/testSecurity.py\n@@ -87,7 +87,9 @@ def test_widget_traversal_2(self):\n     def test_registerConfiglet_1(self):\n         VECTOR = "/plone/portal_controlpanel/registerConfiglet?id=cake&name=Cakey&action=woo&permission=View&icon_expr="\n         res = self.publish(VECTOR)\n-        self.assertEqual(404, res.status)\n+        self.assertEqual(302, res.status)\n+        self.assertTrue(res.headers[\'location\'].startswith(\n+            \'http://nohost/plone/acl_users/credentials_cookie_auth/require_login\'))\n \n     def test_registerConfiglet_2(self):\n         VECTOR = "/plone/portal_controlpanel/registerConfiglet?id=cake&name=Cakey&action=woo&permission=View&icon_expr="\ndiff --git a/news/1959.bugfix b/news/1959.bugfix\nnew file mode 100644\nindex 0000000000..04254865c2\n--- /dev/null\n+++ b/news/1959.bugfix\n@@ -0,0 +1,2 @@\n+Fixed adding control panel action via ZMI.\n+[maurits]\n'

