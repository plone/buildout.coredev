Repository: plone.namedfile


Branch: refs/heads/master
Date: 2023-08-21T19:07:13+02:00
Author: Marcel Liebischer (mliebischer) <liebischer@interaktiv.de>
Commit: https://github.com/plone/plone.namedfile/commit/18f39bb3e0b9eb284d855b576150e6bbf68fde85

Fix extracting dimensions of SVG files with lots of metadata (e.g. &lt;svg&gt; tag bigger than `MAX_INFO_BYTES`)

Files changed:
A plone/namedfile/tests/image_large_header.svg
M plone/namedfile/file.py
M plone/namedfile/tests/__init__.py
M plone/namedfile/tests/test_blobfile.py
M plone/namedfile/tests/test_svg.py
M plone/namedfile/utils/svg_utils.py

b'diff --git a/plone/namedfile/file.py b/plone/namedfile/file.py\nindex 7c2d1ef..f527aa1 100644\n--- a/plone/namedfile/file.py\n+++ b/plone/namedfile/file.py\n@@ -405,7 +405,8 @@ def _setData(self, data):\n         super()._setData(data)\n         firstbytes = self.getFirstBytes()\n         res = getImageInfo(firstbytes)\n-        if res == ("image/jpeg", -1, -1) or res == ("image/tiff", -1, -1):\n+        if res == ("image/jpeg", -1, -1) or res == ("image/tiff", -1, -1) or \\\n+                res == ("image/svg+xml", -1, -1):\n             # header was longer than firstbytes\n             start = len(firstbytes)\n             length = max(0, MAX_INFO_BYTES - start)\ndiff --git a/plone/namedfile/tests/__init__.py b/plone/namedfile/tests/__init__.py\nindex 07f36b8..16d30e5 100644\n--- a/plone/namedfile/tests/__init__.py\n+++ b/plone/namedfile/tests/__init__.py\n@@ -1,8 +1,8 @@\n import os\n \n \n-def getFile(filename):\n+def getFile(filename, length=None):\n     """return contents of the file with the given name"""\n     filename = os.path.join(os.path.dirname(__file__), filename)\n     with open(filename, "rb") as data_file:\n-        return data_file.read()\n+        return data_file.read(length)\ndiff --git a/plone/namedfile/tests/image_large_header.svg b/plone/namedfile/tests/image_large_header.svg\nnew file mode 100644\nindex 0000000..ce53a0a\n--- /dev/null\n+++ b/plone/namedfile/tests/image_large_header.svg\n@@ -0,0 +1,661 @@\n+<?xml version="1.0" encoding="UTF-8"?>\n+<!-- A SVG FILE WITH HEADER BIGGER THAN 1024 BYTES -->\n+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n+<svg\n+    xmlns="http://www.w3.org/2000/svg"\n+    xmlns:xlink="http://www.w3.org/1999/xlink"\n+    version="1.1"\n+    width="1041px"\n+    height="751px"\n+    viewBox="-0.5 -0.5 1041 751"\n+    content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2023-08-21T10:32:15.881Z&quot; agent=&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36&quot; etag=&quot;n0PTuwXMO_1Zdm6R5Qzs&quot; version=&quot;21.6.8&quot;&gt;&lt;diagram name=&quot;Page-1&quot; id=&quot;a7904f86-f2b4-8e86-fa97-74104820619b&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;"\n+>\n+  <defs/>\n+  <g>\n+    <path d="M 70 115 L 70 0 L 630 0 L 630 45" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 140 205 L 160 205 L 160 405 L 180 405" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="0" y="115" width="140" height="180" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 180px; padding-top: 115px; margin-left: 0px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 180px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="0" y="127" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 140 392.5 L 170 392.5 L 170 250 L 180 250" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="0" y="355" width="140" height="150" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 150px; padding-top: 355px; margin-left: 0px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 150px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="0" y="367" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 180 160 L 140 160" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/>\n+    <path d="M 320 160 L 345 160 L 345 72.5 L 370 72.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="180" y="115" width="140" height="180" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 180px; padding-top: 115px; margin-left: 180px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 180px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="180" y="127" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 180 505 L 160 505 L 160 467.5 L 140 467.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 180 455 L 160 455 L 160 430 L 140 430" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="180" y="355" width="140" height="200" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 200px; padding-top: 355px; margin-left: 180px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 200px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field11 = value11\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field12 = value12</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="180" y="367" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 370 147.5 L 360 147.5 L 360 205 L 320 205" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="370" y="35" width="140" height="150" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 150px; padding-top: 35px; margin-left: 370px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 150px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="370" y="47" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 510 260 L 534 260 L 534 386 L 560 386" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="370" y="215" width="140" height="90" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 90px; padding-top: 215px; margin-left: 370px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 90px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="370" y="227" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 510 465 L 535 465 L 535 435 L 560 435" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 510 420 L 520 420 L 520 282.5 L 510 282.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 370 420 L 345 420 L 345 250 L 320 250" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="370" y="375" width="140" height="180" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 180px; padding-top: 375px; margin-left: 370px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 180px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="370" y="387" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 370 637.5 L 345 637.5 L 345 505 L 320 505" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 370 712.5 L 370 723 L 330 723 L 330 525.6 L 320.84 525.6" fill="none" stroke="rgb(0, 0, 0)"\n+          stroke-miterlimit="10" pointer-events="stroke"/>\n+    <path d="M 370 675 L 370 685 L 360 685 L 360 455 L 320 455" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="370" y="600" width="140" height="150" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 150px; padding-top: 600px; margin-left: 370px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 150px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="370" y="612" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 560 146 L 534 146 L 534 237.5 L 510 237.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="560" y="45" width="140" height="200" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 200px; padding-top: 45px; margin-left: 560px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 200px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field11 = value11\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field12 = value12</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="560" y="57" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 700 335 L 715 335 L 715 192.5 L 730 192.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 700 385 L 715 385 L 715 352.5 L 730 352.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 700 435 L 715 435 L 715 500 L 730 500" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="560" y="285" width="140" height="200" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 200px; padding-top: 285px; margin-left: 560px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 200px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="560" y="297" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 560 612.5 L 535 612.5 L 535 510 L 510 510" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="560" y="575" width="140" height="150" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 150px; padding-top: 575px; margin-left: 560px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 150px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="560" y="587" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 870 192.5 L 885 192.5 L 885 245 L 900 245" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="730" y="110" width="140" height="110" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 110px; padding-top: 110px; margin-left: 730px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 110px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="730" y="122" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <rect x="730" y="285" width="140" height="90" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 90px; padding-top: 285px; margin-left: 730px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 90px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="730" y="297" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <rect x="730" y="445" width="140" height="110" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 110px; padding-top: 445px; margin-left: 730px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 110px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="730" y="457" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <rect x="900" y="195" width="140" height="200" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 200px; padding-top: 195px; margin-left: 900px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 200px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field11 = value11\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field12 = value12</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="900" y="207" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <rect x="450" y="420" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+  </g>\n+  <switch>\n+    <g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/>\n+    <a transform="translate(0,-5)" xlink:href="https://www.drawio.com/doc/faq/svg-export-text-problems" target="_blank">\n+      <text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text>\n+    </a>\n+  </switch>\n+</svg>\n\\ No newline at end of file\ndiff --git a/plone/namedfile/tests/test_blobfile.py b/plone/namedfile/tests/test_blobfile.py\nindex d7df2fc..d748246 100644\n--- a/plone/namedfile/tests/test_blobfile.py\n+++ b/plone/namedfile/tests/test_blobfile.py\n@@ -27,6 +27,7 @@\n from zope.component import provideUtility\n from zope.interface.verify import verifyClass\n \n+import os\n import struct\n import transaction\n import unittest\n@@ -79,7 +80,7 @@ def testInterface(self):\n         self.assertTrue(INamedBlobImage.implementedBy(NamedBlobImage))\n         self.assertTrue(verifyClass(INamedBlobFile, NamedBlobImage))\n \n-    def testDataMutatorWithLargeHeader(self):\n+    def testDataMutatorWithLargeJPGHeader(self):\n         from plone.namedfile.file import IMAGE_INFO_BYTES\n \n         bogus_header_length = struct.pack(">H", IMAGE_INFO_BYTES * 2)\n@@ -93,6 +94,23 @@ def testDataMutatorWithLargeHeader(self):\n         image._setData(data)\n         self.assertEqual(image.getImageSize(), (1024, 680))\n \n+    def testDataMutatorWithLargeSVGHeader(self):\n+        from plone.namedfile.file import IMAGE_INFO_BYTES\n+\n+        to_big_header_data = b\'d\' * (IMAGE_INFO_BYTES * 2)\n+\n+        data = (\n+            b\'<svg xmlns="http://www.w3.org/2000/svg" \'\n+            b\'width="1024px" \'\n+            b\'height="680px" \'\n+            b\'foobar="\' + to_big_header_data + b\'">\'\n+            b\'</svg>"\'\n+        )\n+        image = self._makeImage()\n+        image._setData(data)\n+        self.assertEqual(image.getImageSize(), (1024, 680))\n+        self.assertGreater(len(to_big_header_data), IMAGE_INFO_BYTES)\n+\n \n class TestImageFunctional(unittest.TestCase):\n \ndiff --git a/plone/namedfile/tests/test_svg.py b/plone/namedfile/tests/test_svg.py\nindex 0619f6c..cc2a31c 100644\n--- a/plone/namedfile/tests/test_svg.py\n+++ b/plone/namedfile/tests/test_svg.py\n@@ -1,11 +1,11 @@\n+import unittest\n+\n from plone.namedfile.file import NamedImage\n from plone.namedfile.tests import getFile\n from plone.namedfile.utils import get_contenttype\n from plone.namedfile.utils.svg_utils import dimension_int\n from plone.namedfile.utils.svg_utils import process_svg\n \n-import unittest\n-\n \n class TestSvg(unittest.TestCase):\n     def test_get_contenttype(self):\n@@ -23,6 +23,25 @@ def test_process_svg(self):\n         self.assertEqual(width, 158)\n         self.assertEqual(height, 40)\n \n+    def test_process_svg__indicate_header_truncation(self):\n+        """ Check that we can detect SVG files where the file header was\n+         larger than the requested first bytes. process_svg() should\n+         return -1 as dimensions to indicate the truncation."""\n+\n+        truncated_data = getFile("image_large_header.svg", length=1024)\n+        content_type, width, height = process_svg(truncated_data)\n+        self.assertEqual(content_type, "image/svg+xml")\n+        self.assertEqual(width, -1)\n+        self.assertEqual(height, -1)\n+\n+    def test_process_svg__can_handle_large_header(self):\n+\n+        data = getFile("image_large_header.svg")\n+        content_type, width, height = process_svg(data)\n+        self.assertEqual(content_type, "image/svg+xml")\n+        self.assertEqual(width, 1041)\n+        self.assertEqual(height, 751)\n+\n     def test_dimension_int(self):\n \n         self.assertEqual(dimension_int("auto"), 0)\ndiff --git a/plone/namedfile/utils/svg_utils.py b/plone/namedfile/utils/svg_utils.py\nindex 004dedc..59c8dd5 100644\n--- a/plone/namedfile/utils/svg_utils.py\n+++ b/plone/namedfile/utils/svg_utils.py\n@@ -21,15 +21,16 @@ def process_svg(data):\n             w = dimension_int(el.attrib.get("width"))\n             h = dimension_int(el.attrib.get("height"))\n             break\n-    except et.ParseError:\n+        w = w if w > 1 else 1\n+        h = h if h > 1 else 1\n+    except et.ParseError as e:\n+        log.debug(f"Failed to parse SVG dimensions: {e}")\n         pass\n \n     if tag == "{http://www.w3.org/2000/svg}svg" or (\n         size == 1024 and b"http://www.w3.org/2000/svg" in data\n     ):\n         content_type = "image/svg+xml"\n-        w = w if w > 1 else 1\n-        h = h if h > 1 else 1\n \n     return content_type, w, h\n \n'

Repository: plone.namedfile


Branch: refs/heads/master
Date: 2023-08-22T15:12:07+02:00
Author: Marcel Liebischer (mliebischer) <liebischer@interaktiv.de>
Commit: https://github.com/plone/plone.namedfile/commit/2035c6b8a0eca79bef3ba6e06bf29552497ee3e0

Merge branch 'master' into mliebischer-support-svg-with-large-header

Files changed:
M CHANGES.rst
M plone/namedfile/picture.py
M plone/namedfile/scaling.py
M plone/namedfile/storages.py
M plone/namedfile/tests/test_scaling.py
M plone/namedfile/tests/test_scaling_functional.py
M plone/namedfile/z3c-blobfile.zcml
M setup.py

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 6e04f96..1125697 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -8,6 +8,42 @@ Changelog\n \n .. towncrier release notes start\n \n+6.1.1 (2023-06-22)\n+------------------\n+\n+Bug fixes:\n+\n+\n+- Return a 400 Bad Request response if the `@@images` view is published without a subpath. @davisagli (#144)\n+\n+\n+Tests\n+\n+\n+- Fix tests to work with various ``beautifulsoup4`` versions.\n+  [maurits] (#867)\n+\n+\n+6.1.0 (2023-05-22)\n+------------------\n+\n+New features:\n+\n+\n+- Move ``Zope2FileUploadStorable`` code from plone.app.z3cform to here to break a cyclic dependency.\n+  [gforcada] (#3764)\n+\n+\n+6.0.2 (2023-05-08)\n+------------------\n+\n+Bug fixes:\n+\n+\n+- Fix picture tag when original image is used instead of a scale.\n+  [maurits] (#142)\n+\n+\n 6.0.1 (2023-03-14)\n ------------------\n \ndiff --git a/plone/namedfile/picture.py b/plone/namedfile/picture.py\nindex 6b38786..14ea65b 100644\n--- a/plone/namedfile/picture.py\n+++ b/plone/namedfile/picture.py\n@@ -145,5 +145,15 @@ def update_src_scale(self, src, scale):\n             src_scale = "/".join(parts[:-1]) + f"/{field_name}/{scale}"\n             src_scale\n         else:\n-            src_scale = "/".join(parts[:-1]) + f"/{scale}"\n+            # Usually the url has \'@@images/fieldname/other_scale\',\n+            # and then we replace the other scale.\n+            # But the url may use the original image, e.g. @@images/image.\n+            # Then we want to keep the fieldname and return \'.../image/scale\'.\n+            try:\n+                full = len(parts) - parts.index("@@images") == 2\n+            except ValueError:\n+                full = False\n+            if not full:\n+                parts = parts[:-1]\n+            src_scale = "/".join(parts) + f"/{scale}"\n         return src_scale\ndiff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py\nindex c21e8c8..9ec3bd0 100644\n--- a/plone/namedfile/scaling.py\n+++ b/plone/namedfile/scaling.py\n@@ -21,6 +21,7 @@\n from Products.CMFPlone.utils import safe_encode\n from Products.Five import BrowserView\n from xml.sax.saxutils import quoteattr\n+from zExceptions import BadRequest\n from zExceptions import Unauthorized\n from ZODB.blob import BlobFile\n from ZODB.POSException import ConflictError\n@@ -30,7 +31,7 @@\n from zope.deprecation import deprecate\n from zope.interface import alsoProvides\n from zope.interface import implementer\n-from zope.publisher.interfaces import IPublishTraverse\n+from zope.publisher.interfaces.browser import IBrowserPublisher\n from zope.publisher.interfaces import NotFound\n from zope.traversing.interfaces import ITraversable\n from zope.traversing.interfaces import TraversalError\n@@ -390,7 +391,7 @@ def __call__(\n         return value, format_, dimensions\n \n \n-@implementer(ITraversable, IPublishTraverse)\n+@implementer(ITraversable, IBrowserPublisher)\n class ImageScaling(BrowserView):\n     """view used for generating (and storing) image scales"""\n \n@@ -434,6 +435,10 @@ def publishTraverse(self, request, name):\n             return scale_view\n         raise NotFound(self, name, self.request)\n \n+    def browserDefault(self, request):\n+        # There\'s nothing in the path after /@@images\n+        raise BadRequest("Missing image scale path")\n+\n     def traverse(self, name, furtherPath):\n         """used for path traversal, i.e. in zope page templates"""\n         # validate access\ndiff --git a/plone/namedfile/storages.py b/plone/namedfile/storages.py\nindex 5626200..6bb4c32 100644\n--- a/plone/namedfile/storages.py\n+++ b/plone/namedfile/storages.py\n@@ -105,3 +105,14 @@ def store(self, pdata, blob):\n         fp = blob.open("w")\n         fp.write(bytes(pdata))\n         fp.close()\n+\n+\n+@implementer(IStorage)\n+class Zope2FileUploadStorable:\n+    def store(self, data, blob):\n+        data.seek(0)\n+        with blob.open("w") as fp:\n+            block = data.read(MAXCHUNKSIZE)\n+            while block:\n+                fp.write(block)\n+                block = data.read(MAXCHUNKSIZE)\ndiff --git a/plone/namedfile/tests/test_scaling.py b/plone/namedfile/tests/test_scaling.py\nindex ed4382a..7934763 100644\n--- a/plone/namedfile/tests/test_scaling.py\n+++ b/plone/namedfile/tests/test_scaling.py\n@@ -547,9 +547,17 @@ def testGetPictureTagByName(self, mock_uuid_to_object):\n http://nohost/item/@@images/image-800-....png 800w,\n http://nohost/item/@@images/image-1000-....png 1000w,\n http://nohost/item/@@images/image-1200-....png 1200w"/>\n- <img height="200" loading="lazy" src="http://nohost/item/@@images/image-600-....png" title="foo" width="200"/>\n+ <img...src="http://nohost/item/@@images/image-600-....png".../>\n </picture>"""\n-        self.assertTrue(_ellipsis_match(expected, tag))\n+        self.assertTrue(_ellipsis_match(expected, tag.strip()))\n+\n+        # The exact placement of the img tag attributes can differ, especially\n+        # with different beautifulsoup versions.\n+        # So check here that all attributes are present.\n+        self.assertIn(\'height="200"\', tag)\n+        self.assertIn(\'loading="lazy"\', tag)\n+        self.assertIn(\'title="foo"\', tag)\n+        self.assertIn(\'width="200"\', tag)\n \n     @patch.object(\n         plone.namedfile.scaling,\n@@ -580,9 +588,18 @@ def testGetPictureTagWithAltAndTitle(self, mock_uuid_to_object):\n {base}/@@images/image-800-....png 800w,\n {base}/@@images/image-1000-....png 1000w,\n {base}/@@images/image-1200-....png 1200w"/>\n- <img alt="Alternative text" height="200" loading="lazy" src="{base}/@@images/image-600-....png" title="Custom title" width="200"/>\n+ <img...src="{base}/@@images/image-600-....png".../>\n </picture>"""\n-        self.assertTrue(_ellipsis_match(expected, tag))\n+        self.assertTrue(_ellipsis_match(expected, tag.strip()))\n+\n+        # The exact placement of the img tag attributes can differ, especially\n+        # with different beautifulsoup versions.\n+        # So check here that all attributes are present.\n+        self.assertIn(\'alt="Alternative text"\', tag)\n+        self.assertIn(\'height="200"\', tag)\n+        self.assertIn(\'loading="lazy"\', tag)\n+        self.assertIn(\'title="Custom title"\', tag)\n+        self.assertIn(\'width="200"\', tag)\n \n     @patch.object(\n         plone.namedfile.scaling,\n@@ -601,8 +618,15 @@ def testGetPictureTagWithoutAnyVariants(self, mock_uuid_to_object):\n         ImageScaling._sizes = patch_Img2PictureTag_allowed_scales()\n         mock_uuid_to_object.return_value = self.item\n         tag = self.scaling.picture("image", picture_variant="medium")\n-        expected = """<img src="http://nohost/item/@@images/image-0-....png" title="foo" height="200" width="200" />"""\n-        self.assertTrue(_ellipsis_match(expected, tag))\n+        expected = """<img...src="http://nohost/item/@@images/image-0-....png".../>"""\n+        self.assertTrue(_ellipsis_match(expected, tag.strip()))\n+\n+        # The exact placement of the img tag attributes can differ, especially\n+        # with different beautifulsoup versions.\n+        # So check here that all attributes are present.\n+        self.assertIn(\'height="200"\', tag)\n+        self.assertIn(\'title="foo"\', tag)\n+        self.assertIn(\'width="200"\', tag)\n \n     def testGetUnknownScale(self):\n         foo = self.scaling.scale("image", scale="foo?")\n@@ -980,6 +1004,34 @@ def test_title(self):\n         )\n \n \n+class Img2PictureTagTests(unittest.TestCase):\n+    """Low level tests for Img2PictureTag."""\n+\n+    def _makeOne(self):\n+        return plone.namedfile.picture.Img2PictureTag()\n+\n+    def test_update_src_scale(self):\n+        update_src_scale = self._makeOne().update_src_scale\n+        self.assertEqual(\n+            update_src_scale("foo/fieldname/old", "new"),\n+            "foo/fieldname/new"\n+        )\n+        self.assertEqual(\n+            update_src_scale("@@images/fieldname/old", "mini"),\n+            "@@images/fieldname/mini"\n+        )\n+        self.assertEqual(\n+            update_src_scale("@@images/fieldname", "preview"),\n+            "@@images/fieldname/preview"\n+        )\n+        self.assertEqual(\n+            update_src_scale(\n+                "photo.jpg/@@images/image-1200-4a03b0a8227d28737f5d9e3e481bdbd6.jpeg",\n+                "teaser"),\n+            "photo.jpg/@@images/image/teaser",\n+        )\n+\n+\n def test_suite():\n     from unittest import defaultTestLoader\n \ndiff --git a/plone/namedfile/tests/test_scaling_functional.py b/plone/namedfile/tests/test_scaling_functional.py\nindex b9610ad..bf8f1fd 100644\n--- a/plone/namedfile/tests/test_scaling_functional.py\n+++ b/plone/namedfile/tests/test_scaling_functional.py\n@@ -10,6 +10,7 @@\n from plone.namedfile.testing import PLONE_NAMEDFILE_FUNCTIONAL_TESTING\n from plone.namedfile.tests import getFile\n from plone.testing.zope import Browser\n+from zExceptions import BadRequest\n from zope.annotation import IAttributeAnnotatable\n from zope.interface import implementer\n \n@@ -215,6 +216,11 @@ def testSVGPublishThumbViaName(self):\n         self.assertEqual("image/svg+xml", self.browser.headers["content-type"])\n         self.assertEqual(self.browser.contents, data)\n \n+    def testImagesViewWithNoSubpath(self):\n+        transaction.commit()\n+        with self.assertRaises(BadRequest):\n+            self.browser.open(self.layer["app"].absolute_url() + "/item/@@images")\n+\n \n def test_suite():\n     from unittest import defaultTestLoader\ndiff --git a/plone/namedfile/z3c-blobfile.zcml b/plone/namedfile/z3c-blobfile.zcml\nindex 3b2ceb3..69a5312 100644\n--- a/plone/namedfile/z3c-blobfile.zcml\n+++ b/plone/namedfile/z3c-blobfile.zcml\n@@ -56,6 +56,12 @@\n       factory=".storages.PDataStorable"\n       />\n \n+  <utility\n+      factory=".storages.Zope2FileUploadStorable"\n+      provides=".interfaces.IStorage"\n+      name="ZPublisher.HTTPRequest.FileUpload"\n+      />\n+\n   <adapter factory=".copy.BlobFileCopyHook" />\n \n </configure>\ndiff --git a/setup.py b/setup.py\nindex 803bd58..024a4a3 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -4,7 +4,7 @@\n import os\n \n \n-version = "6.0.1"\n+version = "6.1.2.dev0"\n \n description = "File types and fields for images, files and blob files with " "filenames"\n long_description = "\\n\\n".join(\n'

Repository: plone.namedfile


Branch: refs/heads/master
Date: 2023-08-22T16:44:18+02:00
Author: Marcel Liebischer (mliebischer) <liebischer@interaktiv.de>
Commit: https://github.com/plone/plone.namedfile/commit/edcf90ab69a19530719c7709143d3d6c7829586f

Add changenote

Files changed:
A news/147.bugfix

b'diff --git a/news/147.bugfix b/news/147.bugfix\nnew file mode 100644\nindex 0000000..5310330\n--- /dev/null\n+++ b/news/147.bugfix\n@@ -0,0 +1,6 @@\n+Fixed the issue where SVG images containing extensive metadata were not being displayed\n+correctly (resulting in a width/height of 1px). This problem could occur when the\n+<svg> tag exceeded the MAX_INFO_BYTES limit.\n+\n+Fixes `issue 147 <https://github.com/plone/plone.namedfile/issues/147>`_.\n+[mliebischer]\n\\ No newline at end of file\n'

Repository: plone.namedfile


Branch: refs/heads/master
Date: 2023-08-22T16:44:42+02:00
Author: Marcel Liebischer (mliebischer) <liebischer@interaktiv.de>
Commit: https://github.com/plone/plone.namedfile/commit/99c67897b2948b221c0196f35caaf6caa3dda08c

Merge branch 'mliebischer-601-support-svg-with-large-header' into mliebischer-support-svg-with-large-header

Files changed:
A news/147.bugfix

b'diff --git a/news/147.bugfix b/news/147.bugfix\nnew file mode 100644\nindex 0000000..5310330\n--- /dev/null\n+++ b/news/147.bugfix\n@@ -0,0 +1,6 @@\n+Fixed the issue where SVG images containing extensive metadata were not being displayed\n+correctly (resulting in a width/height of 1px). This problem could occur when the\n+<svg> tag exceeded the MAX_INFO_BYTES limit.\n+\n+Fixes `issue 147 <https://github.com/plone/plone.namedfile/issues/147>`_.\n+[mliebischer]\n\\ No newline at end of file\n'

Repository: plone.namedfile


Branch: refs/heads/master
Date: 2023-08-28T11:45:42+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.namedfile/commit/2fe758af36ea14feb4b79ed984e01af16a4241bb

Merge pull request #148 from plone/mliebischer-support-svg-with-large-header

Add support for SVG files with large header

Files changed:
A news/147.bugfix
A plone/namedfile/tests/image_large_header.svg
M plone/namedfile/file.py
M plone/namedfile/tests/__init__.py
M plone/namedfile/tests/test_blobfile.py
M plone/namedfile/tests/test_svg.py
M plone/namedfile/utils/svg_utils.py

b'diff --git a/news/147.bugfix b/news/147.bugfix\nnew file mode 100644\nindex 0000000..5310330\n--- /dev/null\n+++ b/news/147.bugfix\n@@ -0,0 +1,6 @@\n+Fixed the issue where SVG images containing extensive metadata were not being displayed\n+correctly (resulting in a width/height of 1px). This problem could occur when the\n+<svg> tag exceeded the MAX_INFO_BYTES limit.\n+\n+Fixes `issue 147 <https://github.com/plone/plone.namedfile/issues/147>`_.\n+[mliebischer]\n\\ No newline at end of file\ndiff --git a/plone/namedfile/file.py b/plone/namedfile/file.py\nindex 7c2d1ef..f527aa1 100644\n--- a/plone/namedfile/file.py\n+++ b/plone/namedfile/file.py\n@@ -405,7 +405,8 @@ def _setData(self, data):\n         super()._setData(data)\n         firstbytes = self.getFirstBytes()\n         res = getImageInfo(firstbytes)\n-        if res == ("image/jpeg", -1, -1) or res == ("image/tiff", -1, -1):\n+        if res == ("image/jpeg", -1, -1) or res == ("image/tiff", -1, -1) or \\\n+                res == ("image/svg+xml", -1, -1):\n             # header was longer than firstbytes\n             start = len(firstbytes)\n             length = max(0, MAX_INFO_BYTES - start)\ndiff --git a/plone/namedfile/tests/__init__.py b/plone/namedfile/tests/__init__.py\nindex 07f36b8..16d30e5 100644\n--- a/plone/namedfile/tests/__init__.py\n+++ b/plone/namedfile/tests/__init__.py\n@@ -1,8 +1,8 @@\n import os\n \n \n-def getFile(filename):\n+def getFile(filename, length=None):\n     """return contents of the file with the given name"""\n     filename = os.path.join(os.path.dirname(__file__), filename)\n     with open(filename, "rb") as data_file:\n-        return data_file.read()\n+        return data_file.read(length)\ndiff --git a/plone/namedfile/tests/image_large_header.svg b/plone/namedfile/tests/image_large_header.svg\nnew file mode 100644\nindex 0000000..ce53a0a\n--- /dev/null\n+++ b/plone/namedfile/tests/image_large_header.svg\n@@ -0,0 +1,661 @@\n+<?xml version="1.0" encoding="UTF-8"?>\n+<!-- A SVG FILE WITH HEADER BIGGER THAN 1024 BYTES -->\n+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n+<svg\n+    xmlns="http://www.w3.org/2000/svg"\n+    xmlns:xlink="http://www.w3.org/1999/xlink"\n+    version="1.1"\n+    width="1041px"\n+    height="751px"\n+    viewBox="-0.5 -0.5 1041 751"\n+    content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2023-08-21T10:32:15.881Z&quot; agent=&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36&quot; etag=&quot;n0PTuwXMO_1Zdm6R5Qzs&quot; version=&quot;21.6.8&quot;&gt;&lt;diagram name=&quot;Page-1&quot; id=&quot;a7904f86-f2b4-8e86-fa97-74104820619b&quot;&gt;7Z3dc5s4EMD/Gj+mAxJffsxHk97NdJJOcm3v6QYb2abFlk/BiX1//QkjEUu2Cc4gA/a+tCCtYVltpN9KK+jh6+nyjoXzyVcakaSHrGjZwzc9hJDlO/y/rGSVl9iWZ+clYxZHouyt4DH+j0hBUbqII/KsCKaUJmk8VwuHdDYjw1QpCxmjr6rYiCbqXefhmGwVPA7DZLv0RxylE1FqW9ZbxRcSjyfi1oErKgbh8PeY0cVM3G9GZySvmYbyMkL0eRJG9HWjCH/u4WtGaZofTZfXJMnsKi2W/+52T22hMiOztMoPkOP3nUHgWeFgiIcousBSsXQl7UAibhZxSlk6oWM6C5PPb6VX62cl2SUtfjZJpwk/tPlhEg5IclWY45omlPGqtUHwFZlFl1k7KSW3cZKIC/Ez4RUBPxvRWXobTuMk86fvhEXhLBTFQsrm5rsKk3g84ycJGXELXG0bRNjomS7YkOyxgnS3kI1JukcG4VwoM8/GlYWd7widkpStuAAjSZjGL6pXhcI5x4Wc+Cm3SLjaEJjTeJY+b1z5ISvgAsvCH/Mrij+zvtbgmrjnl4nzg/z+8mzjQd6K1j5U1Z+8Ov2JLOP058bx35nIJ3ftK1zHn4Xj8JO8Drkn7oZ2ULcbbjjDYW0trvkSJgtxlx7ykuzx54oHeP8usv7tasqfK+ZGuuS11nzJ/11bysrLL1I6z+ucjbqULNMLYdysbsgNSphaHZEhZfxZqZDJnIklcdYJy1vzo7H4f63gQBbcD36tx5LLp9WcyFpuiYH+C14218smTC/50IPnPpNVBlmlrvMoJklkr390I81tFw/CFDGkiqE9YlgVw2UPaeyRHFUJZ1vXRtRyVbXclqjlqWp5LVHLV9XyW6JWoKoVtEStvqpWvyVqZUih9C7WbjW0gf2FsDTm/Hwpxr51B66PhJRLjZL1aDtaj7FbQ6cywn4hyQvJrqqCgEoIBUVnJ0M6jYfiuHzgf04Z/V2w/Q52lgMafy6y7JUNrqLWUeEKWW5+/roRP0iZyUboYAeWgfEY982zFyqDL7/T8OVVoS+/FUEA0oIAJ8ClUYAujx3DYYA0JrAhsCGwIbBhF9gQWOcQ1nGcqqzjmmAdead6WccqYR27d0ITTX4V1mnNRJNjm2jsA8D2DBq735rWlvoCOwI7AjsCO3aBHWFeEeYVa2TtIl+gJROLvnnY9stgu9sTi0EV/vJaw184MN/aZY0NbX1E1g6AtYG1gbWBtYG1T5W1m1ZM7/Z29HvNKKZ1tDbarQZEJ+9EJ5WXApBlIjpxUMPRSaeBtV8FWNuR9eBYWlQsIpV9WQ9b8n1Xc7S6sx76QNNA00DTQNPdoWlgnVLWcbTMORs1mvaAa2Wd5qFl/wafj+GMJNPynVxOK3DGlTsmZVKmW76VS5d3fM8szkhjAs4AztSJMzDkHDTk4KqLf30jIw42EV1X39DZ6aW/Yh97J4YjV3E711Wi5fflkeHoGrvmPbE05fMMXNGq2xU/Pqt3hFXoM2/t+qf1PtzaxSgJqAmoCTNnMHPWgZkzWIeGnE+DYZ/jNZrz6Rwh5/OE+QtV4a+gNfwlJ6uPuIb+ybI8tcUDF8uCB8Ji/lSEVfpjBD+oYwIAa68KC+zylwro8p5teALANbIN8DwSk7vkiHrehu+Xz0Tp8q5j2BGlMSFahWgVolWIVrsQrUL0dVD05cnFtIbyPGpFneahpfQtGh8kGlyBaOpf0Kgl1QNhJXXj/dQQ5BsmGgxEA0QDRANE0x2igfl32AcG+8AaZGZPm3excbP7wBwT04Pn8vpbmYVWjtPteXOBc4RssDNv7PakBzlH+KqIX9bap9/Y7VmLlPpCLAqxKMSiEItCLHp6sShEVgdFVthvNrIy8mGRs8kFc6vwV3veti31Bf4C/gL+Av7qAn8BTxzEE17l3HIzH+84wp7i0umcTn/PAVX5UBlqz/ccEHwLDHjifHgChqLSocjXdg0UEeu7Q5FtYiiSixzQOUHnVGfnBL3AQb1A5QkuI++4kYtf0AlAJwCEAn2Ttp2salqTIUKBlwpD53Q+nRNMx57AdCwsh0NqNqRmN8gwfe1r3Sg4ZgLB6q/vN9/Y08Mfi19P9zff7u7/+fNCfk5awRit3V4ncUoe5+F66vuVhXPV1nuMsMNU+7d59jW2k8i2aRe0wy7e4Wbhp4xmPl3U3fFHmnylEckk/gc=&lt;/diagram&gt;&lt;/mxfile&gt;"\n+>\n+  <defs/>\n+  <g>\n+    <path d="M 70 115 L 70 0 L 630 0 L 630 45" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 140 205 L 160 205 L 160 405 L 180 405" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="0" y="115" width="140" height="180" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 180px; padding-top: 115px; margin-left: 0px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 180px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="0" y="127" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 140 392.5 L 170 392.5 L 170 250 L 180 250" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="0" y="355" width="140" height="150" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 150px; padding-top: 355px; margin-left: 0px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 150px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="0" y="367" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 180 160 L 140 160" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/>\n+    <path d="M 320 160 L 345 160 L 345 72.5 L 370 72.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="180" y="115" width="140" height="180" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 180px; padding-top: 115px; margin-left: 180px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 180px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="180" y="127" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 180 505 L 160 505 L 160 467.5 L 140 467.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 180 455 L 160 455 L 160 430 L 140 430" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="180" y="355" width="140" height="200" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 200px; padding-top: 355px; margin-left: 180px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 200px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field11 = value11\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field12 = value12</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="180" y="367" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 370 147.5 L 360 147.5 L 360 205 L 320 205" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="370" y="35" width="140" height="150" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 150px; padding-top: 35px; margin-left: 370px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 150px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="370" y="47" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 510 260 L 534 260 L 534 386 L 560 386" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="370" y="215" width="140" height="90" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 90px; padding-top: 215px; margin-left: 370px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 90px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="370" y="227" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 510 465 L 535 465 L 535 435 L 560 435" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 510 420 L 520 420 L 520 282.5 L 510 282.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 370 420 L 345 420 L 345 250 L 320 250" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="370" y="375" width="140" height="180" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 180px; padding-top: 375px; margin-left: 370px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 180px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="370" y="387" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 370 637.5 L 345 637.5 L 345 505 L 320 505" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 370 712.5 L 370 723 L 330 723 L 330 525.6 L 320.84 525.6" fill="none" stroke="rgb(0, 0, 0)"\n+          stroke-miterlimit="10" pointer-events="stroke"/>\n+    <path d="M 370 675 L 370 685 L 360 685 L 360 455 L 320 455" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="370" y="600" width="140" height="150" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 150px; padding-top: 600px; margin-left: 370px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 150px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="370" y="612" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 560 146 L 534 146 L 534 237.5 L 510 237.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="560" y="45" width="140" height="200" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 200px; padding-top: 45px; margin-left: 560px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 200px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field11 = value11\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field12 = value12</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="560" y="57" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 700 335 L 715 335 L 715 192.5 L 730 192.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 700 385 L 715 385 L 715 352.5 L 730 352.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <path d="M 700 435 L 715 435 L 715 500 L 730 500" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="560" y="285" width="140" height="200" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 200px; padding-top: 285px; margin-left: 560px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 200px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="560" y="297" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 560 612.5 L 535 612.5 L 535 510 L 510 510" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="560" y="575" width="140" height="150" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 150px; padding-top: 575px; margin-left: 560px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 150px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="560" y="587" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <path d="M 870 192.5 L 885 192.5 L 885 245 L 900 245" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10"\n+          pointer-events="stroke"/>\n+    <rect x="730" y="110" width="140" height="110" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 110px; padding-top: 110px; margin-left: 730px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 110px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="730" y="122" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <rect x="730" y="285" width="140" height="90" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 90px; padding-top: 285px; margin-left: 730px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 90px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="730" y="297" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <rect x="730" y="445" width="140" height="110" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 110px; padding-top: 445px; margin-left: 730px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 110px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="730" y="457" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <rect x="900" y="195" width="140" height="200" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)"\n+          pointer-events="all"/>\n+    <g transform="translate(-0.5 -0.5)">\n+      <switch>\n+        <foreignObject pointer-events="none" width="100%" height="100%"\n+                       requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"\n+                       style="overflow: visible; text-align: left;">\n+          <div xmlns="http://www.w3.org/1999/xhtml"\n+               style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 142px; height: 200px; padding-top: 195px; margin-left: 900px;">\n+            <div data-drawio-colors="color: rgb(0, 0, 0); "\n+                 style="box-sizing: border-box; font-size: 0px; text-align: left; width: 140px; height: 200px; overflow: hidden;">\n+              <div\n+                  style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; width: 100%; height: 100%; white-space: nowrap;">\n+                <p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline">\n+                  <b>Object:Type</b>\n+                </p>\n+                <hr/>\n+                <p style="margin: 0px ; margin-left: 8px">field1 = value1<br/>field2 = value2<br/>field3 = value3\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field4 = value4\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field5 = value5\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field6 = value6\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field7 = value7\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field8 = value8\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field9 = value9\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field10 = value10\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field11 = value11\n+                  <br/>\n+                </p>\n+                <p style="margin: 0px ; margin-left: 8px">field12 = value12</p>\n+              </div>\n+            </div>\n+          </div>\n+        </foreignObject>\n+        <text x="900" y="207" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="12px">Object:Type...</text>\n+      </switch>\n+    </g>\n+    <rect x="450" y="420" width="120" height="60" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/>\n+  </g>\n+  <switch>\n+    <g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/>\n+    <a transform="translate(0,-5)" xlink:href="https://www.drawio.com/doc/faq/svg-export-text-problems" target="_blank">\n+      <text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text>\n+    </a>\n+  </switch>\n+</svg>\n\\ No newline at end of file\ndiff --git a/plone/namedfile/tests/test_blobfile.py b/plone/namedfile/tests/test_blobfile.py\nindex d7df2fc..d748246 100644\n--- a/plone/namedfile/tests/test_blobfile.py\n+++ b/plone/namedfile/tests/test_blobfile.py\n@@ -27,6 +27,7 @@\n from zope.component import provideUtility\n from zope.interface.verify import verifyClass\n \n+import os\n import struct\n import transaction\n import unittest\n@@ -79,7 +80,7 @@ def testInterface(self):\n         self.assertTrue(INamedBlobImage.implementedBy(NamedBlobImage))\n         self.assertTrue(verifyClass(INamedBlobFile, NamedBlobImage))\n \n-    def testDataMutatorWithLargeHeader(self):\n+    def testDataMutatorWithLargeJPGHeader(self):\n         from plone.namedfile.file import IMAGE_INFO_BYTES\n \n         bogus_header_length = struct.pack(">H", IMAGE_INFO_BYTES * 2)\n@@ -93,6 +94,23 @@ def testDataMutatorWithLargeHeader(self):\n         image._setData(data)\n         self.assertEqual(image.getImageSize(), (1024, 680))\n \n+    def testDataMutatorWithLargeSVGHeader(self):\n+        from plone.namedfile.file import IMAGE_INFO_BYTES\n+\n+        to_big_header_data = b\'d\' * (IMAGE_INFO_BYTES * 2)\n+\n+        data = (\n+            b\'<svg xmlns="http://www.w3.org/2000/svg" \'\n+            b\'width="1024px" \'\n+            b\'height="680px" \'\n+            b\'foobar="\' + to_big_header_data + b\'">\'\n+            b\'</svg>"\'\n+        )\n+        image = self._makeImage()\n+        image._setData(data)\n+        self.assertEqual(image.getImageSize(), (1024, 680))\n+        self.assertGreater(len(to_big_header_data), IMAGE_INFO_BYTES)\n+\n \n class TestImageFunctional(unittest.TestCase):\n \ndiff --git a/plone/namedfile/tests/test_svg.py b/plone/namedfile/tests/test_svg.py\nindex 0619f6c..cc2a31c 100644\n--- a/plone/namedfile/tests/test_svg.py\n+++ b/plone/namedfile/tests/test_svg.py\n@@ -1,11 +1,11 @@\n+import unittest\n+\n from plone.namedfile.file import NamedImage\n from plone.namedfile.tests import getFile\n from plone.namedfile.utils import get_contenttype\n from plone.namedfile.utils.svg_utils import dimension_int\n from plone.namedfile.utils.svg_utils import process_svg\n \n-import unittest\n-\n \n class TestSvg(unittest.TestCase):\n     def test_get_contenttype(self):\n@@ -23,6 +23,25 @@ def test_process_svg(self):\n         self.assertEqual(width, 158)\n         self.assertEqual(height, 40)\n \n+    def test_process_svg__indicate_header_truncation(self):\n+        """ Check that we can detect SVG files where the file header was\n+         larger than the requested first bytes. process_svg() should\n+         return -1 as dimensions to indicate the truncation."""\n+\n+        truncated_data = getFile("image_large_header.svg", length=1024)\n+        content_type, width, height = process_svg(truncated_data)\n+        self.assertEqual(content_type, "image/svg+xml")\n+        self.assertEqual(width, -1)\n+        self.assertEqual(height, -1)\n+\n+    def test_process_svg__can_handle_large_header(self):\n+\n+        data = getFile("image_large_header.svg")\n+        content_type, width, height = process_svg(data)\n+        self.assertEqual(content_type, "image/svg+xml")\n+        self.assertEqual(width, 1041)\n+        self.assertEqual(height, 751)\n+\n     def test_dimension_int(self):\n \n         self.assertEqual(dimension_int("auto"), 0)\ndiff --git a/plone/namedfile/utils/svg_utils.py b/plone/namedfile/utils/svg_utils.py\nindex 004dedc..59c8dd5 100644\n--- a/plone/namedfile/utils/svg_utils.py\n+++ b/plone/namedfile/utils/svg_utils.py\n@@ -21,15 +21,16 @@ def process_svg(data):\n             w = dimension_int(el.attrib.get("width"))\n             h = dimension_int(el.attrib.get("height"))\n             break\n-    except et.ParseError:\n+        w = w if w > 1 else 1\n+        h = h if h > 1 else 1\n+    except et.ParseError as e:\n+        log.debug(f"Failed to parse SVG dimensions: {e}")\n         pass\n \n     if tag == "{http://www.w3.org/2000/svg}svg" or (\n         size == 1024 and b"http://www.w3.org/2000/svg" in data\n     ):\n         content_type = "image/svg+xml"\n-        w = w if w > 1 else 1\n-        h = h if h > 1 else 1\n \n     return content_type, w, h\n \n'

