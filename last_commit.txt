Repository: Products.CMFPlone


Branch: refs/heads/6.0.x
Date: 2023-07-12T15:11:33+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/3d7702fdb6257fa0924ea62b840c4eabe38fbf18

Deprecate `plone.app.widgets`

Files changed:
M Products/CMFPlone/factory.py
M Products/CMFPlone/patterns/settings.py
M setup.py

b'diff --git a/Products/CMFPlone/factory.py b/Products/CMFPlone/factory.py\nindex 10e093e37d..d0f48462bd 100644\n--- a/Products/CMFPlone/factory.py\n+++ b/Products/CMFPlone/factory.py\n@@ -71,7 +71,6 @@ def getNonInstallableProducts(self):\n             "plone.app.relationfield",\n             "plone.app.theming",\n             "plone.app.users",\n-            "plone.app.widgets",\n             "plone.app.z3cform",\n             "plone.formwidget.recurrence",\n             "plone.keyring",\ndiff --git a/Products/CMFPlone/patterns/settings.py b/Products/CMFPlone/patterns/settings.py\nindex 73fbfddd47..84c9f663a2 100644\n--- a/Products/CMFPlone/patterns/settings.py\n+++ b/Products/CMFPlone/patterns/settings.py\n@@ -2,8 +2,8 @@\n from Acquisition import aq_parent\n from borg.localrole.interfaces import IFactoryTempFolder\n from plone.app.content.browser.interfaces import IFolderContentsView\n-from plone.app.widgets.utils import get_relateditems_options\n from plone.app.z3cform.utils import call_callables\n+from plone.app.z3cform.widgets.relateditems import get_relateditems_options\n from plone.base.interfaces import IImagingSchema\n from plone.base.interfaces import ILinkSchema\n from plone.base.interfaces import IPatternsSettings\ndiff --git a/setup.py b/setup.py\nindex e18cb4c1b4..af546a3fb5 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -75,6 +75,7 @@\n         "plone.app.viewletmanager",\n         "plone.app.vocabularies",\n         "plone.app.workflow",\n+        "plone.app.z3cform >= 4.1.0",\n         "plone.base",\n         "plone.browserlayer >= 2.1.5",\n         "plone.contentrules",\n'

Repository: Products.CMFPlone


Branch: refs/heads/6.0.x
Date: 2023-07-12T15:15:38+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/53b7217b61c4ab627e579e758e64962de5915c24

Update robottests

Files changed:
M Products/CMFPlone/tests/robot/test_edit.robot

b"diff --git a/Products/CMFPlone/tests/robot/test_edit.robot b/Products/CMFPlone/tests/robot/test_edit.robot\nindex 9c8935560e..944595e38e 100644\n--- a/Products/CMFPlone/tests/robot/test_edit.robot\n+++ b/Products/CMFPlone/tests/robot/test_edit.robot\n@@ -34,22 +34,18 @@ Scenario: Switch tabs\n       and no other tab is shown\n \n Scenario: Adding a related item\n-    Pass Execution  Disabled until plone.app.widgets is merged\n     # Order of the next two lines is important\n     # First we're creating a new item and then editing the original page\n     Given a logged-in site administrator\n       and at least one other item\n       and an edited page\n      When i click the Categorization tab\n-      and i click the add related item button\n-      and an overlay pops up\n       and i select a related item\n-      and i close the overlay\n       and i save the page\n      Then the related item is shown in the page\n \n Scenario: DateTime widget follows form dropdowns values\n-    Pass Execution  Disabled until plone.app.widgets is merged\n+    Pass Execution  Disabled because of browser native datepicker\n     Given a logged-in site administrator\n       and an edited page\n      When i click the Dates tab\n@@ -58,7 +54,7 @@ Scenario: DateTime widget follows form dropdowns values\n      Then popup calendar should have the same date\n \n Scenario: Form dropdowns follows DateTime widget values\n-    Pass Execution  Disabled until plone.app.widgets is merged\n+    Pass Execution  Disabled because of browser native datepicker\n     Given a logged-in site administrator\n       and an edited page\n      When i click the Dates tab\n@@ -92,29 +88,14 @@ I click the ${tab} tab\n     Given patterns are loaded\n     Click link  ${tab}\n \n-I click the add related item button\n-    Click Button  xpath=//input[contains(@class, 'addreference')]\n-\n I select a related item\n-    Click Element  xpath=//div[contains(@class, 'overlay')]//input[@class='insertreference']\n-    Wait until keyword succeeds  10s  1s  Xpath Should Match X Times  //ul[@id = 'ref_browser_items_relatedItems']/descendant::input  1\n-\n-I close the overlay\n-   Click Element  xpath=//div[contains(@class, 'overlay')]//div[@class='close']\n+    Wait For Then Click Element  jquery=.pat-relateditems-container ul.select2-choices:visible\n+    Wait For Then Click Element  jquery=a.pat-relateditems-result-select:first\n \n I save the page\n    Click Button  Save\n \n-I select a date using the dropdowns\n-    Select From List By Label  xpath=//select[@id='edit_form_effectiveDate_0_year']  2001\n-    Select From List By Label  xpath=//select[@id='edit_form_effectiveDate_0_month']  January\n-    Select From List By Label  xpath=//select[@id='edit_form_effectiveDate_0_day']  01\n-    Select From List By Label  xpath=//select[@id='edit_form_effectiveDate_0_hour']  01\n-    Select From List By Label  xpath=//select[@id='edit_form_effectiveDate_0_minute']  00\n-    Select From List By Label  xpath=//select[@id='edit_form_effectiveDate_0_ampm']  AM\n-\n I click the calendar icon\n-\n     Click Element  xpath=//span[@id='edit_form_effectiveDate_0_popup']\n     Element Should Be Visible  xpath=//div[@class='calendar']\n \n@@ -136,7 +117,7 @@ form dropdowns should not have the default values anymore\n     Should Not Be Equal  ${dayLabel}  --\n \n the related item is shown in the page\n-   Xpath Should Match X Times  //dl[@id = 'relatedItemBox']/dd  1\n+    Page should contain element  css=#section-related\n \n an overlay pops up\n     Wait Until Page Contains Element  xpath=//div[contains(@class, 'overlay')]//input[@class='insertreference']\n"

Repository: Products.CMFPlone


Branch: refs/heads/6.0.x
Date: 2023-07-12T15:17:37+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/ebceb6e32292e24884dcf200862cfb764768753e

changenote

Files changed:
A news/3821.bugfix

b'diff --git a/news/3821.bugfix b/news/3821.bugfix\nnew file mode 100644\nindex 0000000000..4174cd044f\n--- /dev/null\n+++ b/news/3821.bugfix\n@@ -0,0 +1,2 @@\n+Update `plone.app.z3cform` dependency version and deprecate `plone.app.widgets`\n+[petschki]\n'

Repository: Products.CMFPlone


Branch: refs/heads/6.0.x
Date: 2023-07-13T10:24:24+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/33f8e260309f0464684344b3e3fb3a55993ba844

Merge pull request #3821 from plone/deprecate-pawidgets-6.0

[6.0] Deprecate `plone.app.widgets`

Files changed:
A news/3821.bugfix
M Products/CMFPlone/factory.py
M Products/CMFPlone/patterns/settings.py
M Products/CMFPlone/tests/robot/test_edit.robot
M setup.py

b'diff --git a/Products/CMFPlone/factory.py b/Products/CMFPlone/factory.py\nindex 10e093e37d..d0f48462bd 100644\n--- a/Products/CMFPlone/factory.py\n+++ b/Products/CMFPlone/factory.py\n@@ -71,7 +71,6 @@ def getNonInstallableProducts(self):\n             "plone.app.relationfield",\n             "plone.app.theming",\n             "plone.app.users",\n-            "plone.app.widgets",\n             "plone.app.z3cform",\n             "plone.formwidget.recurrence",\n             "plone.keyring",\ndiff --git a/Products/CMFPlone/patterns/settings.py b/Products/CMFPlone/patterns/settings.py\nindex 73fbfddd47..84c9f663a2 100644\n--- a/Products/CMFPlone/patterns/settings.py\n+++ b/Products/CMFPlone/patterns/settings.py\n@@ -2,8 +2,8 @@\n from Acquisition import aq_parent\n from borg.localrole.interfaces import IFactoryTempFolder\n from plone.app.content.browser.interfaces import IFolderContentsView\n-from plone.app.widgets.utils import get_relateditems_options\n from plone.app.z3cform.utils import call_callables\n+from plone.app.z3cform.widgets.relateditems import get_relateditems_options\n from plone.base.interfaces import IImagingSchema\n from plone.base.interfaces import ILinkSchema\n from plone.base.interfaces import IPatternsSettings\ndiff --git a/Products/CMFPlone/tests/robot/test_edit.robot b/Products/CMFPlone/tests/robot/test_edit.robot\nindex 9c8935560e..944595e38e 100644\n--- a/Products/CMFPlone/tests/robot/test_edit.robot\n+++ b/Products/CMFPlone/tests/robot/test_edit.robot\n@@ -34,22 +34,18 @@ Scenario: Switch tabs\n       and no other tab is shown\n \n Scenario: Adding a related item\n-    Pass Execution  Disabled until plone.app.widgets is merged\n     # Order of the next two lines is important\n     # First we\'re creating a new item and then editing the original page\n     Given a logged-in site administrator\n       and at least one other item\n       and an edited page\n      When i click the Categorization tab\n-      and i click the add related item button\n-      and an overlay pops up\n       and i select a related item\n-      and i close the overlay\n       and i save the page\n      Then the related item is shown in the page\n \n Scenario: DateTime widget follows form dropdowns values\n-    Pass Execution  Disabled until plone.app.widgets is merged\n+    Pass Execution  Disabled because of browser native datepicker\n     Given a logged-in site administrator\n       and an edited page\n      When i click the Dates tab\n@@ -58,7 +54,7 @@ Scenario: DateTime widget follows form dropdowns values\n      Then popup calendar should have the same date\n \n Scenario: Form dropdowns follows DateTime widget values\n-    Pass Execution  Disabled until plone.app.widgets is merged\n+    Pass Execution  Disabled because of browser native datepicker\n     Given a logged-in site administrator\n       and an edited page\n      When i click the Dates tab\n@@ -92,29 +88,14 @@ I click the ${tab} tab\n     Given patterns are loaded\n     Click link  ${tab}\n \n-I click the add related item button\n-    Click Button  xpath=//input[contains(@class, \'addreference\')]\n-\n I select a related item\n-    Click Element  xpath=//div[contains(@class, \'overlay\')]//input[@class=\'insertreference\']\n-    Wait until keyword succeeds  10s  1s  Xpath Should Match X Times  //ul[@id = \'ref_browser_items_relatedItems\']/descendant::input  1\n-\n-I close the overlay\n-   Click Element  xpath=//div[contains(@class, \'overlay\')]//div[@class=\'close\']\n+    Wait For Then Click Element  jquery=.pat-relateditems-container ul.select2-choices:visible\n+    Wait For Then Click Element  jquery=a.pat-relateditems-result-select:first\n \n I save the page\n    Click Button  Save\n \n-I select a date using the dropdowns\n-    Select From List By Label  xpath=//select[@id=\'edit_form_effectiveDate_0_year\']  2001\n-    Select From List By Label  xpath=//select[@id=\'edit_form_effectiveDate_0_month\']  January\n-    Select From List By Label  xpath=//select[@id=\'edit_form_effectiveDate_0_day\']  01\n-    Select From List By Label  xpath=//select[@id=\'edit_form_effectiveDate_0_hour\']  01\n-    Select From List By Label  xpath=//select[@id=\'edit_form_effectiveDate_0_minute\']  00\n-    Select From List By Label  xpath=//select[@id=\'edit_form_effectiveDate_0_ampm\']  AM\n-\n I click the calendar icon\n-\n     Click Element  xpath=//span[@id=\'edit_form_effectiveDate_0_popup\']\n     Element Should Be Visible  xpath=//div[@class=\'calendar\']\n \n@@ -136,7 +117,7 @@ form dropdowns should not have the default values anymore\n     Should Not Be Equal  ${dayLabel}  --\n \n the related item is shown in the page\n-   Xpath Should Match X Times  //dl[@id = \'relatedItemBox\']/dd  1\n+    Page should contain element  css=#section-related\n \n an overlay pops up\n     Wait Until Page Contains Element  xpath=//div[contains(@class, \'overlay\')]//input[@class=\'insertreference\']\ndiff --git a/news/3821.bugfix b/news/3821.bugfix\nnew file mode 100644\nindex 0000000000..4174cd044f\n--- /dev/null\n+++ b/news/3821.bugfix\n@@ -0,0 +1,2 @@\n+Update `plone.app.z3cform` dependency version and deprecate `plone.app.widgets`\n+[petschki]\ndiff --git a/setup.py b/setup.py\nindex e18cb4c1b4..af546a3fb5 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -75,6 +75,7 @@\n         "plone.app.viewletmanager",\n         "plone.app.vocabularies",\n         "plone.app.workflow",\n+        "plone.app.z3cform >= 4.1.0",\n         "plone.base",\n         "plone.browserlayer >= 2.1.5",\n         "plone.contentrules",\n'

