Repository: plone.app.versioningbehavior


Branch: refs/heads/master
Date: 2021-11-23T21:59:46-03:00
Author: wesleybl (wesleybl) <wesleybl@gmail.com>
Commit: https://github.com/plone/plone.app.versioningbehavior/commit/bb8eb696ef659c1ae242a80cff915272f84f9ebd

Fix testCloneNamedFileBlobsInUpdatedSchema

Now plone.dexterity uses the repr function to convert _p_mtime from
float to string. The str function in Python 2 rounded off _p_mtime by
generating schema names with an unexpected format. So we need to use
repr here too, so the test doesn't fail in Python 2.

Files changed:
M plone/app/versioningbehavior/tests/test_modifiers.py

b'diff --git a/plone/app/versioningbehavior/tests/test_modifiers.py b/plone/app/versioningbehavior/tests/test_modifiers.py\nindex 0bf815f..fd78cf1 100644\n--- a/plone/app/versioningbehavior/tests/test_modifiers.py\n+++ b/plone/app/versioningbehavior/tests/test_modifiers.py\n@@ -1,8 +1,6 @@\n # -*- coding: utf-8 -*-\n-from five.intid import site\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n-from plone.app.testing import TEST_USER_ROLES\n from plone.app.versioningbehavior.modifiers import CloneNamedFileBlobs\n from plone.app.versioningbehavior.modifiers import SkipRelations\n from plone.app.versioningbehavior.testing import PLONE_APP_VERSIONINGBEHAVIOR_FUNCTIONAL_TESTING\n@@ -393,7 +391,7 @@ def testCloneNamedFileBlobsInUpdatedSchema(self):\n         attrs_dict = modifier.getReferencedAttributes(file1)\n         schema_name = portalTypeToSchemaName(\n             \'BlobFile\',\n-            suffix=str(self.portal.portal_types.BlobFile._p_mtime)\n+            suffix=repr(self.portal.portal_types.BlobFile._p_mtime)\n         )\n         attr = "plone.dexterity.schema.generated." + schema_name + ".file"\n         self.assertTrue(attr in attrs_dict)\n'

Repository: plone.app.versioningbehavior


Branch: refs/heads/master
Date: 2021-11-24T08:35:00+01:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.versioningbehavior/commit/700596cc3f3ea0b6373bcb20d6be6ec7d5fe6443

Merge pull request #60 from plone/fix_testCloneNamedFileBlobsInUpdatedSchema

Fix testCloneNamedFileBlobsInUpdatedSchema

Files changed:
M plone/app/versioningbehavior/tests/test_modifiers.py

b'diff --git a/plone/app/versioningbehavior/tests/test_modifiers.py b/plone/app/versioningbehavior/tests/test_modifiers.py\nindex 0bf815f..fd78cf1 100644\n--- a/plone/app/versioningbehavior/tests/test_modifiers.py\n+++ b/plone/app/versioningbehavior/tests/test_modifiers.py\n@@ -1,8 +1,6 @@\n # -*- coding: utf-8 -*-\n-from five.intid import site\n from plone.app.testing import setRoles\n from plone.app.testing import TEST_USER_ID\n-from plone.app.testing import TEST_USER_ROLES\n from plone.app.versioningbehavior.modifiers import CloneNamedFileBlobs\n from plone.app.versioningbehavior.modifiers import SkipRelations\n from plone.app.versioningbehavior.testing import PLONE_APP_VERSIONINGBEHAVIOR_FUNCTIONAL_TESTING\n@@ -393,7 +391,7 @@ def testCloneNamedFileBlobsInUpdatedSchema(self):\n         attrs_dict = modifier.getReferencedAttributes(file1)\n         schema_name = portalTypeToSchemaName(\n             \'BlobFile\',\n-            suffix=str(self.portal.portal_types.BlobFile._p_mtime)\n+            suffix=repr(self.portal.portal_types.BlobFile._p_mtime)\n         )\n         attr = "plone.dexterity.schema.generated." + schema_name + ".file"\n         self.assertTrue(attr in attrs_dict)\n'

