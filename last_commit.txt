Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2024-04-10T09:07:53+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/plone.app.upgrade/commit/989969e3d14d0f200ee7d5ffa9181f57d7c0e60f

sort imports via isort

Files changed:
M plone/app/upgrade/utils.py
M plone/app/upgrade/v52/final.py
M plone/app/upgrade/v60/tests.py

b'diff --git a/plone/app/upgrade/utils.py b/plone/app/upgrade/utils.py\nindex 3423991e..d03487f6 100644\n--- a/plone/app/upgrade/utils.py\n+++ b/plone/app/upgrade/utils.py\n@@ -1,10 +1,10 @@\n from Acquisition import aq_base\n from Missing import MV\n+from plone.base.utils import base_hasattr\n from plone.base.utils import get_installer\n from plone.indexer.interfaces import IIndexableObject\n from Products.CMFCore.DirectoryView import _dirreg\n from Products.CMFCore.utils import getToolByName\n-from plone.base.utils import base_hasattr\n from Products.GenericSetup.interfaces import ISetupTool\n from Products.GenericSetup.registry import _export_step_registry\n from Products.GenericSetup.registry import _import_step_registry\ndiff --git a/plone/app/upgrade/v52/final.py b/plone/app/upgrade/v52/final.py\nindex 1b46a0c3..0513f2d9 100644\n--- a/plone/app/upgrade/v52/final.py\n+++ b/plone/app/upgrade/v52/final.py\n@@ -1,12 +1,12 @@\n from AccessControl.Permissions import view\n from plone.app.upgrade.utils import loadMigrationProfile\n+from plone.base.utils import base_hasattr\n from plone.base.utils import get_installer\n from plone.registry import field\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.interfaces import IMarkupSchema\n from Products.CMFPlone.interfaces import ISiteSchema\n-from plone.base.utils import base_hasattr\n from Products.CMFPlone.utils import safe_unicode\n from zope.component import getUtility\n \ndiff --git a/plone/app/upgrade/v60/tests.py b/plone/app/upgrade/v60/tests.py\nindex ba15a3dd..75149e4c 100644\n--- a/plone/app/upgrade/v60/tests.py\n+++ b/plone/app/upgrade/v60/tests.py\n@@ -1,8 +1,8 @@\n from plone.app.testing import PLONE_INTEGRATION_TESTING\n+from plone.dexterity.interfaces import IDexterityFTI\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from zope.component import getUtility\n-from plone.dexterity.interfaces import IDexterityFTI\n \n import unittest\n \n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2024-04-10T09:08:29+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/plone.app.upgrade/commit/c3461cc6da9d8fd000dd37eb38cd9ddbd3d2389f

add upgradestep for feature accordion plugin tinymce

Files changed:
A plone/app/upgrade/v61/alpha.py
M plone/app/upgrade/v61/configure.zcml

b'diff --git a/plone/app/upgrade/v61/alpha.py b/plone/app/upgrade/v61/alpha.py\nnew file mode 100644\nindex 00000000..ab70cac4\n--- /dev/null\n+++ b/plone/app/upgrade/v61/alpha.py\n@@ -0,0 +1,47 @@\n+from plone.base.interfaces.controlpanel import IFilterSchema\n+from plone.base.interfaces.controlpanel import ITinyMCEPluginSchema\n+from plone.registry.interfaces import IRegistry\n+from zope.component import getUtility\n+\n+\n+def add_feature_tinymce_accordion_plugin(context):\n+    # add accordion plugin to tinymce plugins\n+    # it\'s not enabled per default in the registry\n+\n+    registry = getUtility(IRegistry)\n+\n+    # save the old values temporarily\n+    plugins_record = registry.records.get("plone.plugins")\n+    valid_tags_record = registry.records.get("plone.valid_tags")\n+    custom_attributes_record = registry.records.get("plone.custom_attributes")\n+\n+    old_value_plugins = plugins_record.value\n+    old_value_valid_tags = valid_tags_record.value\n+    old_value_custom_attributes = custom_attributes_record.value\n+\n+    # delete the old registry record, it holds the wrong vocabulary of the old schema\n+    del registry.records["plone.plugins"]\n+    del registry.records["plone.valid_tags"]\n+    del registry.records["plone.custom_attributes"]\n+\n+    # re-register the schema in the registry\n+    registry.registerInterface(ITinyMCEPluginSchema, prefix="plone")\n+    registry.registerInterface(IFilterSchema, prefix="plone")\n+\n+    # add the old value for plugin\n+    plugins_record = registry.records.get("plone.plugins")\n+    plugins_record.value = old_value_plugins\n+\n+    # add the old value for valid_tags\n+    valid_tags_record = registry.records.get("plone.valid_tags")\n+    for val in old_value_valid_tags:\n+        if val in valid_tags_record.value:\n+            continue\n+        valid_tags_record.value.append(val)\n+\n+    # add the old value for custom_attributes\n+    custom_attributes_record = registry.records.get("plone.custom_attributes")\n+    for val in old_value_custom_attributes:\n+        if val in custom_attributes_record.value:\n+            continue\n+        custom_attributes_record.value.append(val)\ndiff --git a/plone/app/upgrade/v61/configure.zcml b/plone/app/upgrade/v61/configure.zcml\nindex efa0ff02..d52ba4d8 100644\n--- a/plone/app/upgrade/v61/configure.zcml\n+++ b/plone/app/upgrade/v61/configure.zcml\n@@ -35,9 +35,11 @@\n       >\n     <!-- Plone 6.1.0a3 -->\n     <gs:upgradeStep\n-        title="Miscellaneous"\n-        handler="..utils.null_upgrade_step"\n+        title="Add Feature to TinyMCE Editor"\n+        description="add accordion plugin to tinymce editor"\n+        handler=".alpha.add_feature_tinymce_accordion_plugin"\n         />\n+        \n   </gs:upgradeSteps>\n \n </configure>\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2024-04-10T09:10:50+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/plone.app.upgrade/commit/d4eb0aa8a6d910de09f62180427693f921f7f7b3

add news

Files changed:
A news/324.feature

b'diff --git a/news/324.feature b/news/324.feature\nnew file mode 100644\nindex 00000000..ce16b8b7\n--- /dev/null\n+++ b/news/324.feature\n@@ -0,0 +1,2 @@\n+Add upgrade step for enable TinyMCE Plugin accordion\n+[1letter]\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2024-04-19T18:21:41+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/dccb3727eb86df7479b79b4ddba1c261c399684a

Merge pull request #325 from plone/feature-#324

Feature #324

Files changed:
A news/324.feature
A plone/app/upgrade/v61/alpha.py
M plone/app/upgrade/utils.py
M plone/app/upgrade/v52/final.py
M plone/app/upgrade/v60/tests.py
M plone/app/upgrade/v61/configure.zcml

b'diff --git a/news/324.feature b/news/324.feature\nnew file mode 100644\nindex 00000000..ce16b8b7\n--- /dev/null\n+++ b/news/324.feature\n@@ -0,0 +1,2 @@\n+Add upgrade step for enable TinyMCE Plugin accordion\n+[1letter]\ndiff --git a/plone/app/upgrade/utils.py b/plone/app/upgrade/utils.py\nindex 3423991e..d03487f6 100644\n--- a/plone/app/upgrade/utils.py\n+++ b/plone/app/upgrade/utils.py\n@@ -1,10 +1,10 @@\n from Acquisition import aq_base\n from Missing import MV\n+from plone.base.utils import base_hasattr\n from plone.base.utils import get_installer\n from plone.indexer.interfaces import IIndexableObject\n from Products.CMFCore.DirectoryView import _dirreg\n from Products.CMFCore.utils import getToolByName\n-from plone.base.utils import base_hasattr\n from Products.GenericSetup.interfaces import ISetupTool\n from Products.GenericSetup.registry import _export_step_registry\n from Products.GenericSetup.registry import _import_step_registry\ndiff --git a/plone/app/upgrade/v52/final.py b/plone/app/upgrade/v52/final.py\nindex 1b46a0c3..0513f2d9 100644\n--- a/plone/app/upgrade/v52/final.py\n+++ b/plone/app/upgrade/v52/final.py\n@@ -1,12 +1,12 @@\n from AccessControl.Permissions import view\n from plone.app.upgrade.utils import loadMigrationProfile\n+from plone.base.utils import base_hasattr\n from plone.base.utils import get_installer\n from plone.registry import field\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.interfaces import IMarkupSchema\n from Products.CMFPlone.interfaces import ISiteSchema\n-from plone.base.utils import base_hasattr\n from Products.CMFPlone.utils import safe_unicode\n from zope.component import getUtility\n \ndiff --git a/plone/app/upgrade/v60/tests.py b/plone/app/upgrade/v60/tests.py\nindex ba15a3dd..75149e4c 100644\n--- a/plone/app/upgrade/v60/tests.py\n+++ b/plone/app/upgrade/v60/tests.py\n@@ -1,8 +1,8 @@\n from plone.app.testing import PLONE_INTEGRATION_TESTING\n+from plone.dexterity.interfaces import IDexterityFTI\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from zope.component import getUtility\n-from plone.dexterity.interfaces import IDexterityFTI\n \n import unittest\n \ndiff --git a/plone/app/upgrade/v61/alpha.py b/plone/app/upgrade/v61/alpha.py\nnew file mode 100644\nindex 00000000..ab70cac4\n--- /dev/null\n+++ b/plone/app/upgrade/v61/alpha.py\n@@ -0,0 +1,47 @@\n+from plone.base.interfaces.controlpanel import IFilterSchema\n+from plone.base.interfaces.controlpanel import ITinyMCEPluginSchema\n+from plone.registry.interfaces import IRegistry\n+from zope.component import getUtility\n+\n+\n+def add_feature_tinymce_accordion_plugin(context):\n+    # add accordion plugin to tinymce plugins\n+    # it\'s not enabled per default in the registry\n+\n+    registry = getUtility(IRegistry)\n+\n+    # save the old values temporarily\n+    plugins_record = registry.records.get("plone.plugins")\n+    valid_tags_record = registry.records.get("plone.valid_tags")\n+    custom_attributes_record = registry.records.get("plone.custom_attributes")\n+\n+    old_value_plugins = plugins_record.value\n+    old_value_valid_tags = valid_tags_record.value\n+    old_value_custom_attributes = custom_attributes_record.value\n+\n+    # delete the old registry record, it holds the wrong vocabulary of the old schema\n+    del registry.records["plone.plugins"]\n+    del registry.records["plone.valid_tags"]\n+    del registry.records["plone.custom_attributes"]\n+\n+    # re-register the schema in the registry\n+    registry.registerInterface(ITinyMCEPluginSchema, prefix="plone")\n+    registry.registerInterface(IFilterSchema, prefix="plone")\n+\n+    # add the old value for plugin\n+    plugins_record = registry.records.get("plone.plugins")\n+    plugins_record.value = old_value_plugins\n+\n+    # add the old value for valid_tags\n+    valid_tags_record = registry.records.get("plone.valid_tags")\n+    for val in old_value_valid_tags:\n+        if val in valid_tags_record.value:\n+            continue\n+        valid_tags_record.value.append(val)\n+\n+    # add the old value for custom_attributes\n+    custom_attributes_record = registry.records.get("plone.custom_attributes")\n+    for val in old_value_custom_attributes:\n+        if val in custom_attributes_record.value:\n+            continue\n+        custom_attributes_record.value.append(val)\ndiff --git a/plone/app/upgrade/v61/configure.zcml b/plone/app/upgrade/v61/configure.zcml\nindex efa0ff02..d52ba4d8 100644\n--- a/plone/app/upgrade/v61/configure.zcml\n+++ b/plone/app/upgrade/v61/configure.zcml\n@@ -35,9 +35,11 @@\n       >\n     <!-- Plone 6.1.0a3 -->\n     <gs:upgradeStep\n-        title="Miscellaneous"\n-        handler="..utils.null_upgrade_step"\n+        title="Add Feature to TinyMCE Editor"\n+        description="add accordion plugin to tinymce editor"\n+        handler=".alpha.add_feature_tinymce_accordion_plugin"\n         />\n+        \n   </gs:upgradeSteps>\n \n </configure>\n'

