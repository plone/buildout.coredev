Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2020-09-10T16:48:02+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.ATContentTypes/commit/8c68ace7375d5a2b4f318bbfafe0d04707c41f1b

Drop use of test() in templates since it is no longer available since Zope 4.5.1 (see https://community.plone.org/t/plone-5-2-1-5-2-2-page-template-issues/12793)

Files changed:
M Products/ATContentTypes/skins/ATContentTypes/atct_album_view.pt
M Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicIndex.cpt
M Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicMetadata.cpt
M Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt
M Products/ATContentTypes/skins/ATContentTypes/atct_topic_subtopics.pt
M Products/ATContentTypes/skins/ATContentTypes/atct_topic_view.pt
M Products/ATContentTypes/skins/ATContentTypes/criterion_edit_form.cpt
M Products/ATContentTypes/skins/ATContentTypes/folder_full_view_item.pt
M Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt
M Products/ATContentTypes/skins/ATContentTypes/folder_summary_view.pt
M Products/ATContentTypes/skins/ATContentTypes/folder_tabular_view.pt
M Products/ATContentTypes/skins/ATContentTypes/newsitem_view.pt
M Products/ATContentTypes/www/portal_factory_manage_types.zpt

b'diff --git a/Products/ATContentTypes/skins/ATContentTypes/atct_album_view.pt b/Products/ATContentTypes/skins/ATContentTypes/atct_album_view.pt\nindex de9a5419..ddee6a1e 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/atct_album_view.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/atct_album_view.pt\n@@ -25,8 +25,7 @@\n                      has_text exists:context/aq_explicit/getText;\n                      text python:has_text and here.getText() or \'\'"\n          tal:condition="text"\n-         tal:attributes="class python:test(here.Format() in (\'text/structured\',\n-                                               \'text/x-rst\', ), \'stx\' + kss_class, \'plain\' + kss_class)">\n+         tal:attributes="class python:\'stx\' + kss_class if here.Format() in (\'text/structured\', \'text/x-rst\', ) else \'plain\' + kss_class">\n         <div metal:define-slot="inside" tal:replace="structure text">The body</div>\n     </div>\n \ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicIndex.cpt b/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicIndex.cpt\nindex 57f3b9db..1a221dfd 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicIndex.cpt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicIndex.cpt\n@@ -105,7 +105,7 @@\n                         <tal:object tal:define="indexObj python:atct_tool.getIndex(index);\n                                                 oddrow repeat/index/odd;">\n \n-                        <tr class="" tal:attributes="class python:test(oddrow, \'even\', \'odd\')">\n+                        <tr class="" tal:attributes="class python:\'even\' if oddrow else \'odd\'">\n                             <td class="listingCheckbox">\n                                 <input type="hidden"\n                                        value=""\n@@ -119,9 +119,9 @@\n                                        name=""\n                                        id=""\n                                        tal:attributes="name string:index.enabled:records;\n-                                                       value python:test(indexObj.enabled, \'1\', \'0\');\n+                                                       value python:\'1\' if indexObj.enabled else \'0\';\n                                                        id string:${indexObj/index}_enabled;\n-                                                       checked python:test(indexObj.enabled, \'checked\', None)"/>\n+                                                       checked python:\'checked\' if indexObj.enabled else None"/>\n                             </td>\n                             <td>\n                                 <span tal:content="indexObj/index"/>\n@@ -148,7 +148,7 @@\n                                        tal:attributes="id string:${indexObj/index}_criteria;">\n                                     <option tal:repeat="criterion python:atct_tool.getCriteriaForIndex(indexObj.index, as_dict= True)"\n                                             tal:attributes="value criterion/name;\n-                                                            selected python:test(criterion[\'name\'] in indexObj.criteria, \'selected\', None);"\n+                                                            selected python:\'selected\' if criterion[\'name\'] in indexObj.criteria else None;"\n                                             tal:content="criterion/description"/>\n                                 </select>\n                                 <br />\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicMetadata.cpt b/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicMetadata.cpt\nindex da1086e2..480efbe1 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicMetadata.cpt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicMetadata.cpt\n@@ -101,7 +101,7 @@\n                     <tal:indexes tal:repeat="index metadata">\n                         <tal:object tal:define="indexObj python:atct_tool.getMetadata(index);\n                                                 oddrow repeat/index/odd">\n-                        <tr class="" tal:attributes="class python:test(oddrow, \'even\', \'odd\')">\n+                        <tr class="" tal:attributes="class python:\'even\' if oddrow else \'odd\'">\n                             <td class="listingCheckbox">\n                                 <input type="hidden"\n                                        value=""\n@@ -113,8 +113,8 @@\n                                        value=""\n                                        name=""\n                                        tal:attributes="name string:metadata.enabled:records;\n-                                                       value python:test(indexObj.enabled, \'1\', \'0\');\n-                                                       checked python:test(indexObj.enabled, \'checked\', None)"/>\n+                                                       value python:\'1\' if indexObj.enabled else \'0\';\n+                                                       checked python:\'checked\' if indexObj.enabled else None"/>\n                             </td>\n                             <td>\n                                 <span tal:content="indexObj/index"/>\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt\nindex d65bf987..4f5f1791 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt\n@@ -38,7 +38,7 @@\n                                        item_created item/CreationDate;\n                                        item_wf_state        item/review_state;\n                                        item_creators item/Creators|item/Creator;\n-                                       item_creators python:test(same_type(item_creators,[]) or same_type(item_creators,()), item_creators, [item_creators]);\n+                                       item_creators python:item_creators if same_type(item_creators,[]) or same_type(item_creators,()) or [item_creators];\n                                        item_start item/start/ISO|item/StartDate|nothing;\n                                        item_end item/end/ISO|item/EndDate|nothing;">\n                 <tr>\n@@ -47,7 +47,7 @@\n                     <para style="Table">\n                         <a href="#"\n                            tal:condition="python:item_type != \'Link\'"\n-                           tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url+\'/\');"\n+                           tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url+\'/\';"\n                            tal:content="item_title_or_id">\n                             Item Title\n                         </a>\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_subtopics.pt b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_subtopics.pt\nindex 78d2aa16..e0927dc0 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_subtopics.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_subtopics.pt\n@@ -98,7 +98,7 @@\n                                              browserDefaultResult context/browserDefault;\n                                              isBrowserDefault     python:len(browserDefaultResult[1]) == 1 and item.id == context.browserDefault()[1][0];\n                                              item_folderish       item/is_folderish|nothing"\n-                                 tal:attributes="class python:test(oddrow, \'draggable even\', \'draggable odd\');\n+                                 tal:attributes="class python:\'draggable even\' if oddrow else \'draggable odd\';\n                                                  id string:folder-contents-item-${item_id};" >\n \n                                  <td class="notDraggable">\n@@ -108,15 +108,14 @@\n                                             value="#"\n                                             tal:attributes="value   item_path;\n                                                             id      string:cb_$item_id;\n-                                                            checked python:test(request.get(\'ids_checked\', False), \'checked\', None);\n+                                                            checked python:\'checked\' if request.get(\'ids_checked\', False) else None;\n                                                             alt     string:Select $item_title_or_id;\n                                                             title   string:Select $item_title_or_id" />\n                                 <input type="hidden" name="obj_paths:list" value="#"\n                                        tal:attributes="value item_rel_url" />\n \n                               </td>\n-                              <td tal:define="url python:test(item_use_view, item_url+\'/view\',\n-                                              test(item_folderish, item_url+\'/folder_contents\', item_url+\'/\'));">\n+                              <td tal:define="url python:item_url+\'/view\' if item_use_view else item_url+\'/folder_contents\' if item_folderish else item_url+\'/\';">\n                                   <span tal:attributes="class item_type_class">\n                                       <img tal:replace="structure item_icon/html_tag" />\n                                       <a href="#" tal:attributes="href  url;\n@@ -178,7 +177,7 @@\n                              i18n:attributes="value"\n                              tal:attributes="value button/title;\n                                              name button/url;\n-                                             class python:test((button[\'id\'] == \'paste\'), \'standalone\', \'context\')" />\n+                                             class python:\'standalone\' if button[\'id\'] == \'paste\' else \'context\'" />\n                     </tal:buttons>\n                 </metal:buttons>\n             </form>\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_view.pt b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_view.pt\nindex 0918e08f..28428490 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_view.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_view.pt\n@@ -34,8 +34,7 @@\n                          templateId=templateId, macro=\'text-field-view\');\n                          text here/getText|nothing"\n              tal:condition="text"\n-             tal:attributes="class python:test(here.Format() in (\'text/structured\',\n-                                                   \'text/x-rst\', ), \'stx\' + kss_class, \'plain\' + kss_class)">\n+             tal:attributes="class python:\'stx\' + kss_class if here.Format() in (\'text/structured\', \'text/x-rst\', ) else \'plain\' + kss_class">\n             <div metal:define-slot="inside" tal:replace="structure text">The body</div>\n         </div>\n \n@@ -64,7 +63,7 @@\n                      <tbody>\n                         <tal:brain tal:repeat="obj topicContents">\n                         <tr tal:define="oddrow repeat/obj/odd;"\n-                            tal:attributes="class python:test(oddrow, \'even\', \'odd\')">\n+                            tal:attributes="class python:\'even\' if oddrow else \'odd\'">\n                             <tal:fields repeat="field here/getCustomViewFields"\n                                         define="normalizeString nocall:context/@@plone/normalizeString;\n                                                 url obj/getURL;\n@@ -75,7 +74,7 @@\n                                                 obj_wf_state obj/review_state|python: wtool.getInfoFor(obj, \'review_state\', \'\');\n                                                 obj_wf_state_class python:\'state-\' + normalizeString(obj_wf_state);\n                                                 obj_ct_class python:\'contenttype-\' + normalizeString(obj_type);\n-                                                obj_url python:test(obj_type in use_view_action, url+\'/view\', url);\n+                                                obj_url python:url+\'/view\' if obj_type in use_view_action else url;\n                                                 title_or_id obj/pretty_title_or_id">\n                             <tal:block define="value python: getattr(obj, field, None)">\n                                 <td tal:condition="python: field != \'Title\'"\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/criterion_edit_form.cpt b/Products/ATContentTypes/skins/ATContentTypes/criterion_edit_form.cpt\nindex 40a67245..3b5e3cf9 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/criterion_edit_form.cpt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/criterion_edit_form.cpt\n@@ -103,7 +103,7 @@ $(function() {\n                 <tbody>\n                     <tal:criteria repeat="criterion criteria">\n                         <tr tal:define="oddrow repeat/criterion/odd;"\n-                            tal:attributes="class python:test(oddrow, \'even\', \'odd\')"\n+                            tal:attributes="class python:\'even\' if oddrow else \'odd\'"\n                             style="vertical-align: top;">\n                           <td metal:use-macro="context/atct_macros/macros/criterion_edit" />\n                         </tr>\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/folder_full_view_item.pt b/Products/ATContentTypes/skins/ATContentTypes/folder_full_view_item.pt\nindex d8f2370e..6197467a 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/folder_full_view_item.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/folder_full_view_item.pt\n@@ -35,7 +35,7 @@\n \n         <h2 class="headline">\n             <a href="#" class="summary url" tal:content="context/Title"\n-               tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url);">\n+               tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url;">\n                Title or id\n              </a>\n         </h2>\n@@ -66,7 +66,7 @@\n \n         <p class="more" tal:condition="python:not(item_macro) or rendering_error">\n             <a href=""\n-               tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url);">\n+               tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url;">\n                <span class="hiddenStructure"><span tal:replace="context/Title" /> - </span>\n                <span i18n:translate="read_more">Read More&hellip;</span>\n             </a>\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt b/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt\nindex 10397b4f..80ba7e04 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt\n@@ -17,8 +17,7 @@\n          tal:define="has_text exists:context/aq_explicit/getText;\n                      text python:has_text and here.getText() or \'\'"\n          tal:condition="text"\n-         tal:attributes="class python:test(context.Format() in (\'text/structured\',\n-                                               \'text/x-rst\', ), \'stx\', \'plain\')">\n+         tal:attributes="class python:\'stx\' if context.Format() in (\'text/structured\', \'text/x-rst\', ) else \'plain\'">\n         <div metal:define-slot="inside" tal:replace="structure text">The body</div>\n     </div>\n \n@@ -63,11 +62,11 @@\n                                    item_samedate python: (item_end - item_start &lt; 1) if item_type == \'Event\' else False">\n                 <metal:block define-slot="entry">\n                 <header metal:define-macro="listitem"\n-                    tal:attributes="class python:test(item_type == \'Event\', \'vevent\', \'\')">\n+                    tal:attributes="class python:\'vevent\' if item_type == \'Event\' else \'\'">\n \n                     <span class="summary">\n                         <a href="#"\n-                           tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url);\n+                           tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url;\n                                            class string:$item_type_class $item_wf_state_class url"\n                            tal:content="item_title_or_id">\n                             Item Title\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/folder_summary_view.pt b/Products/ATContentTypes/skins/ATContentTypes/folder_summary_view.pt\nindex 3dd91edc..6b5a478d 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/folder_summary_view.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/folder_summary_view.pt\n@@ -19,7 +19,7 @@\n \n                     <a href="#"\n                        tal:condition="exists:item_object/image_thumb"\n-                       tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url)">\n+                       tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url">\n                         <img src="" alt=""\n                              tal:replace="structure python: path(\'nocall:item_object/tag\')(scale=\'thumb\', css_class=\'tileImage\')" />\n                     </a>\n@@ -29,7 +29,7 @@\n \n                         <a href="#"\n                            class="summary url"\n-                           tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url);"\n+                           tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url;"\n                            tal:content="item_title_or_id">\n                             Item Title\n                         </a>\n@@ -100,7 +100,7 @@\n \n                     <p class="tileFooter">\n                         <a href=""\n-                           tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url);">\n+                           tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url;">\n                            <span class="hiddenStructure"><span tal:replace="item_title_or_id" /> - </span>\n                            <span i18n:translate="read_more">Read More&hellip;</span>\n                         </a>\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/folder_tabular_view.pt b/Products/ATContentTypes/skins/ATContentTypes/folder_tabular_view.pt\nindex 042791d3..a2bbbbf3 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/folder_tabular_view.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/folder_tabular_view.pt\n@@ -38,7 +38,7 @@\n \n                     <tr metal:define-macro="listitem"\n                         tal:define="oddrow repeat/item/odd;"\n-                        tal:attributes="class python:test(oddrow, \'even\', \'odd\')">\n+                        tal:attributes="class python:\'even\' if oddrow else \'odd\'">\n \n                             <td>\n                                 <img width="16" height="16"\n@@ -50,7 +50,7 @@\n                                                      width item_icon/width;\n                                                      height item_icon/height;" />\n                                 <a href="#"\n-                                   tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url);\n+                                   tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url;\n                                                    class string:$item_wf_state_class $item_type_class;\n                                                    title item_description;"\n                                    tal:content="item_title_or_id">\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/newsitem_view.pt b/Products/ATContentTypes/skins/ATContentTypes/newsitem_view.pt\nindex 83814c8a..3e5d6ed5 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/newsitem_view.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/newsitem_view.pt\n@@ -43,8 +43,7 @@\n                          templateId=templateId, macro=\'text-field-view\');\n                          text text|context/getText|nothing"\n              tal:condition="text"\n-             tal:attributes="class python:test(context.Format() in (\'text/structured\',\n-                                                   \'text/x-rst\', ), \'stx\' + kss_class, \'plain\' + kss_class)">\n+             tal:attributes="class python:\'stx\' + kss_class if context.Format() in (\'text/structured\', \'text/x-rst\', ) else \'plain\' + kss_class">\n             <div metal:define-slot="inside" tal:replace="structure text">The body</div>\n         </div>\n     </metal:block>\ndiff --git a/Products/ATContentTypes/www/portal_factory_manage_types.zpt b/Products/ATContentTypes/www/portal_factory_manage_types.zpt\nindex f7ccb5a7..1f12792f 100644\n--- a/Products/ATContentTypes/www/portal_factory_manage_types.zpt\n+++ b/Products/ATContentTypes/www/portal_factory_manage_types.zpt\n@@ -12,7 +12,7 @@ creation.</p>\n     <tr tal:repeat="type_name python:context.portal_types.listContentTypes()" >\n       <td><input type="checkbox"\n                  tal:attributes="name python:type_name;\n-                                 checked python:test(type_name in factory_types, \'1\', \'\')" /></td>\n+                                 checked python:\'1\' if type_name in factory_types else \'\'" /></td>\n       <td tal:content="type_name" />\n     </tr>\n   </table>\n'

Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2020-09-10T18:31:17+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.ATContentTypes/commit/57b9a10fc89b1af143699115c0210b22c1c2eb29

fix typo and add changelog

Files changed:
A news/24.bugfix
M Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt

b'diff --git a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt\nindex 4f5f1791..bc89272c 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt\n@@ -38,7 +38,7 @@\n                                        item_created item/CreationDate;\n                                        item_wf_state        item/review_state;\n                                        item_creators item/Creators|item/Creator;\n-                                       item_creators python:item_creators if same_type(item_creators,[]) or same_type(item_creators,()) or [item_creators];\n+                                       item_creators python:item_creators if same_type(item_creators,[]) or same_type(item_creators,()) else [item_creators];\n                                        item_start item/start/ISO|item/StartDate|nothing;\n                                        item_end item/end/ISO|item/EndDate|nothing;">\n                 <tr>\ndiff --git a/news/24.bugfix b/news/24.bugfix\nnew file mode 100644\nindex 00000000..9c050c45\n--- /dev/null\n+++ b/news/24.bugfix\n@@ -0,0 +1 @@\n+Drop use of test() in templates [pbauer]\n\\ No newline at end of file\n'

Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2020-09-11T09:48:44+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.ATContentTypes/commit/0e022782985271f343da84afb87679b20b3606d6

Merge pull request #66 from plone/replace_test_in_templates

Drop use of test() in templates

Files changed:
A news/24.bugfix
M Products/ATContentTypes/skins/ATContentTypes/atct_album_view.pt
M Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicIndex.cpt
M Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicMetadata.cpt
M Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt
M Products/ATContentTypes/skins/ATContentTypes/atct_topic_subtopics.pt
M Products/ATContentTypes/skins/ATContentTypes/atct_topic_view.pt
M Products/ATContentTypes/skins/ATContentTypes/criterion_edit_form.cpt
M Products/ATContentTypes/skins/ATContentTypes/folder_full_view_item.pt
M Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt
M Products/ATContentTypes/skins/ATContentTypes/folder_summary_view.pt
M Products/ATContentTypes/skins/ATContentTypes/folder_tabular_view.pt
M Products/ATContentTypes/skins/ATContentTypes/newsitem_view.pt
M Products/ATContentTypes/www/portal_factory_manage_types.zpt

b'diff --git a/Products/ATContentTypes/skins/ATContentTypes/atct_album_view.pt b/Products/ATContentTypes/skins/ATContentTypes/atct_album_view.pt\nindex de9a5419..ddee6a1e 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/atct_album_view.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/atct_album_view.pt\n@@ -25,8 +25,7 @@\n                      has_text exists:context/aq_explicit/getText;\n                      text python:has_text and here.getText() or \'\'"\n          tal:condition="text"\n-         tal:attributes="class python:test(here.Format() in (\'text/structured\',\n-                                               \'text/x-rst\', ), \'stx\' + kss_class, \'plain\' + kss_class)">\n+         tal:attributes="class python:\'stx\' + kss_class if here.Format() in (\'text/structured\', \'text/x-rst\', ) else \'plain\' + kss_class">\n         <div metal:define-slot="inside" tal:replace="structure text">The body</div>\n     </div>\n \ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicIndex.cpt b/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicIndex.cpt\nindex 57f3b9db..1a221dfd 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicIndex.cpt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicIndex.cpt\n@@ -105,7 +105,7 @@\n                         <tal:object tal:define="indexObj python:atct_tool.getIndex(index);\n                                                 oddrow repeat/index/odd;">\n \n-                        <tr class="" tal:attributes="class python:test(oddrow, \'even\', \'odd\')">\n+                        <tr class="" tal:attributes="class python:\'even\' if oddrow else \'odd\'">\n                             <td class="listingCheckbox">\n                                 <input type="hidden"\n                                        value=""\n@@ -119,9 +119,9 @@\n                                        name=""\n                                        id=""\n                                        tal:attributes="name string:index.enabled:records;\n-                                                       value python:test(indexObj.enabled, \'1\', \'0\');\n+                                                       value python:\'1\' if indexObj.enabled else \'0\';\n                                                        id string:${indexObj/index}_enabled;\n-                                                       checked python:test(indexObj.enabled, \'checked\', None)"/>\n+                                                       checked python:\'checked\' if indexObj.enabled else None"/>\n                             </td>\n                             <td>\n                                 <span tal:content="indexObj/index"/>\n@@ -148,7 +148,7 @@\n                                        tal:attributes="id string:${indexObj/index}_criteria;">\n                                     <option tal:repeat="criterion python:atct_tool.getCriteriaForIndex(indexObj.index, as_dict= True)"\n                                             tal:attributes="value criterion/name;\n-                                                            selected python:test(criterion[\'name\'] in indexObj.criteria, \'selected\', None);"\n+                                                            selected python:\'selected\' if criterion[\'name\'] in indexObj.criteria else None;"\n                                             tal:content="criterion/description"/>\n                                 </select>\n                                 <br />\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicMetadata.cpt b/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicMetadata.cpt\nindex da1086e2..480efbe1 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicMetadata.cpt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/atct_manageTopicMetadata.cpt\n@@ -101,7 +101,7 @@\n                     <tal:indexes tal:repeat="index metadata">\n                         <tal:object tal:define="indexObj python:atct_tool.getMetadata(index);\n                                                 oddrow repeat/index/odd">\n-                        <tr class="" tal:attributes="class python:test(oddrow, \'even\', \'odd\')">\n+                        <tr class="" tal:attributes="class python:\'even\' if oddrow else \'odd\'">\n                             <td class="listingCheckbox">\n                                 <input type="hidden"\n                                        value=""\n@@ -113,8 +113,8 @@\n                                        value=""\n                                        name=""\n                                        tal:attributes="name string:metadata.enabled:records;\n-                                                       value python:test(indexObj.enabled, \'1\', \'0\');\n-                                                       checked python:test(indexObj.enabled, \'checked\', None)"/>\n+                                                       value python:\'1\' if indexObj.enabled else \'0\';\n+                                                       checked python:\'checked\' if indexObj.enabled else None"/>\n                             </td>\n                             <td>\n                                 <span tal:content="indexObj/index"/>\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt\nindex d65bf987..bc89272c 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_pdf.pt\n@@ -38,7 +38,7 @@\n                                        item_created item/CreationDate;\n                                        item_wf_state        item/review_state;\n                                        item_creators item/Creators|item/Creator;\n-                                       item_creators python:test(same_type(item_creators,[]) or same_type(item_creators,()), item_creators, [item_creators]);\n+                                       item_creators python:item_creators if same_type(item_creators,[]) or same_type(item_creators,()) else [item_creators];\n                                        item_start item/start/ISO|item/StartDate|nothing;\n                                        item_end item/end/ISO|item/EndDate|nothing;">\n                 <tr>\n@@ -47,7 +47,7 @@\n                     <para style="Table">\n                         <a href="#"\n                            tal:condition="python:item_type != \'Link\'"\n-                           tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url+\'/\');"\n+                           tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url+\'/\';"\n                            tal:content="item_title_or_id">\n                             Item Title\n                         </a>\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_subtopics.pt b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_subtopics.pt\nindex 78d2aa16..e0927dc0 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_subtopics.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_subtopics.pt\n@@ -98,7 +98,7 @@\n                                              browserDefaultResult context/browserDefault;\n                                              isBrowserDefault     python:len(browserDefaultResult[1]) == 1 and item.id == context.browserDefault()[1][0];\n                                              item_folderish       item/is_folderish|nothing"\n-                                 tal:attributes="class python:test(oddrow, \'draggable even\', \'draggable odd\');\n+                                 tal:attributes="class python:\'draggable even\' if oddrow else \'draggable odd\';\n                                                  id string:folder-contents-item-${item_id};" >\n \n                                  <td class="notDraggable">\n@@ -108,15 +108,14 @@\n                                             value="#"\n                                             tal:attributes="value   item_path;\n                                                             id      string:cb_$item_id;\n-                                                            checked python:test(request.get(\'ids_checked\', False), \'checked\', None);\n+                                                            checked python:\'checked\' if request.get(\'ids_checked\', False) else None;\n                                                             alt     string:Select $item_title_or_id;\n                                                             title   string:Select $item_title_or_id" />\n                                 <input type="hidden" name="obj_paths:list" value="#"\n                                        tal:attributes="value item_rel_url" />\n \n                               </td>\n-                              <td tal:define="url python:test(item_use_view, item_url+\'/view\',\n-                                              test(item_folderish, item_url+\'/folder_contents\', item_url+\'/\'));">\n+                              <td tal:define="url python:item_url+\'/view\' if item_use_view else item_url+\'/folder_contents\' if item_folderish else item_url+\'/\';">\n                                   <span tal:attributes="class item_type_class">\n                                       <img tal:replace="structure item_icon/html_tag" />\n                                       <a href="#" tal:attributes="href  url;\n@@ -178,7 +177,7 @@\n                              i18n:attributes="value"\n                              tal:attributes="value button/title;\n                                              name button/url;\n-                                             class python:test((button[\'id\'] == \'paste\'), \'standalone\', \'context\')" />\n+                                             class python:\'standalone\' if button[\'id\'] == \'paste\' else \'context\'" />\n                     </tal:buttons>\n                 </metal:buttons>\n             </form>\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_view.pt b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_view.pt\nindex 0918e08f..28428490 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/atct_topic_view.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/atct_topic_view.pt\n@@ -34,8 +34,7 @@\n                          templateId=templateId, macro=\'text-field-view\');\n                          text here/getText|nothing"\n              tal:condition="text"\n-             tal:attributes="class python:test(here.Format() in (\'text/structured\',\n-                                                   \'text/x-rst\', ), \'stx\' + kss_class, \'plain\' + kss_class)">\n+             tal:attributes="class python:\'stx\' + kss_class if here.Format() in (\'text/structured\', \'text/x-rst\', ) else \'plain\' + kss_class">\n             <div metal:define-slot="inside" tal:replace="structure text">The body</div>\n         </div>\n \n@@ -64,7 +63,7 @@\n                      <tbody>\n                         <tal:brain tal:repeat="obj topicContents">\n                         <tr tal:define="oddrow repeat/obj/odd;"\n-                            tal:attributes="class python:test(oddrow, \'even\', \'odd\')">\n+                            tal:attributes="class python:\'even\' if oddrow else \'odd\'">\n                             <tal:fields repeat="field here/getCustomViewFields"\n                                         define="normalizeString nocall:context/@@plone/normalizeString;\n                                                 url obj/getURL;\n@@ -75,7 +74,7 @@\n                                                 obj_wf_state obj/review_state|python: wtool.getInfoFor(obj, \'review_state\', \'\');\n                                                 obj_wf_state_class python:\'state-\' + normalizeString(obj_wf_state);\n                                                 obj_ct_class python:\'contenttype-\' + normalizeString(obj_type);\n-                                                obj_url python:test(obj_type in use_view_action, url+\'/view\', url);\n+                                                obj_url python:url+\'/view\' if obj_type in use_view_action else url;\n                                                 title_or_id obj/pretty_title_or_id">\n                             <tal:block define="value python: getattr(obj, field, None)">\n                                 <td tal:condition="python: field != \'Title\'"\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/criterion_edit_form.cpt b/Products/ATContentTypes/skins/ATContentTypes/criterion_edit_form.cpt\nindex 40a67245..3b5e3cf9 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/criterion_edit_form.cpt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/criterion_edit_form.cpt\n@@ -103,7 +103,7 @@ $(function() {\n                 <tbody>\n                     <tal:criteria repeat="criterion criteria">\n                         <tr tal:define="oddrow repeat/criterion/odd;"\n-                            tal:attributes="class python:test(oddrow, \'even\', \'odd\')"\n+                            tal:attributes="class python:\'even\' if oddrow else \'odd\'"\n                             style="vertical-align: top;">\n                           <td metal:use-macro="context/atct_macros/macros/criterion_edit" />\n                         </tr>\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/folder_full_view_item.pt b/Products/ATContentTypes/skins/ATContentTypes/folder_full_view_item.pt\nindex d8f2370e..6197467a 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/folder_full_view_item.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/folder_full_view_item.pt\n@@ -35,7 +35,7 @@\n \n         <h2 class="headline">\n             <a href="#" class="summary url" tal:content="context/Title"\n-               tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url);">\n+               tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url;">\n                Title or id\n              </a>\n         </h2>\n@@ -66,7 +66,7 @@\n \n         <p class="more" tal:condition="python:not(item_macro) or rendering_error">\n             <a href=""\n-               tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url);">\n+               tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url;">\n                <span class="hiddenStructure"><span tal:replace="context/Title" /> - </span>\n                <span i18n:translate="read_more">Read More&hellip;</span>\n             </a>\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt b/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt\nindex 10397b4f..80ba7e04 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/folder_listing.pt\n@@ -17,8 +17,7 @@\n          tal:define="has_text exists:context/aq_explicit/getText;\n                      text python:has_text and here.getText() or \'\'"\n          tal:condition="text"\n-         tal:attributes="class python:test(context.Format() in (\'text/structured\',\n-                                               \'text/x-rst\', ), \'stx\', \'plain\')">\n+         tal:attributes="class python:\'stx\' if context.Format() in (\'text/structured\', \'text/x-rst\', ) else \'plain\'">\n         <div metal:define-slot="inside" tal:replace="structure text">The body</div>\n     </div>\n \n@@ -63,11 +62,11 @@\n                                    item_samedate python: (item_end - item_start &lt; 1) if item_type == \'Event\' else False">\n                 <metal:block define-slot="entry">\n                 <header metal:define-macro="listitem"\n-                    tal:attributes="class python:test(item_type == \'Event\', \'vevent\', \'\')">\n+                    tal:attributes="class python:\'vevent\' if item_type == \'Event\' else \'\'">\n \n                     <span class="summary">\n                         <a href="#"\n-                           tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url);\n+                           tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url;\n                                            class string:$item_type_class $item_wf_state_class url"\n                            tal:content="item_title_or_id">\n                             Item Title\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/folder_summary_view.pt b/Products/ATContentTypes/skins/ATContentTypes/folder_summary_view.pt\nindex 3dd91edc..6b5a478d 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/folder_summary_view.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/folder_summary_view.pt\n@@ -19,7 +19,7 @@\n \n                     <a href="#"\n                        tal:condition="exists:item_object/image_thumb"\n-                       tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url)">\n+                       tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url">\n                         <img src="" alt=""\n                              tal:replace="structure python: path(\'nocall:item_object/tag\')(scale=\'thumb\', css_class=\'tileImage\')" />\n                     </a>\n@@ -29,7 +29,7 @@\n \n                         <a href="#"\n                            class="summary url"\n-                           tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url);"\n+                           tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url;"\n                            tal:content="item_title_or_id">\n                             Item Title\n                         </a>\n@@ -100,7 +100,7 @@\n \n                     <p class="tileFooter">\n                         <a href=""\n-                           tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url);">\n+                           tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url;">\n                            <span class="hiddenStructure"><span tal:replace="item_title_or_id" /> - </span>\n                            <span i18n:translate="read_more">Read More&hellip;</span>\n                         </a>\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/folder_tabular_view.pt b/Products/ATContentTypes/skins/ATContentTypes/folder_tabular_view.pt\nindex 042791d3..a2bbbbf3 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/folder_tabular_view.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/folder_tabular_view.pt\n@@ -38,7 +38,7 @@\n \n                     <tr metal:define-macro="listitem"\n                         tal:define="oddrow repeat/item/odd;"\n-                        tal:attributes="class python:test(oddrow, \'even\', \'odd\')">\n+                        tal:attributes="class python:\'even\' if oddrow else \'odd\'">\n \n                             <td>\n                                 <img width="16" height="16"\n@@ -50,7 +50,7 @@\n                                                      width item_icon/width;\n                                                      height item_icon/height;" />\n                                 <a href="#"\n-                                   tal:attributes="href python:test(item_type in use_view_action, item_url+\'/view\', item_url);\n+                                   tal:attributes="href python:item_url+\'/view\' if item_type in use_view_action else item_url;\n                                                    class string:$item_wf_state_class $item_type_class;\n                                                    title item_description;"\n                                    tal:content="item_title_or_id">\ndiff --git a/Products/ATContentTypes/skins/ATContentTypes/newsitem_view.pt b/Products/ATContentTypes/skins/ATContentTypes/newsitem_view.pt\nindex 83814c8a..3e5d6ed5 100644\n--- a/Products/ATContentTypes/skins/ATContentTypes/newsitem_view.pt\n+++ b/Products/ATContentTypes/skins/ATContentTypes/newsitem_view.pt\n@@ -43,8 +43,7 @@\n                          templateId=templateId, macro=\'text-field-view\');\n                          text text|context/getText|nothing"\n              tal:condition="text"\n-             tal:attributes="class python:test(context.Format() in (\'text/structured\',\n-                                                   \'text/x-rst\', ), \'stx\' + kss_class, \'plain\' + kss_class)">\n+             tal:attributes="class python:\'stx\' + kss_class if context.Format() in (\'text/structured\', \'text/x-rst\', ) else \'plain\' + kss_class">\n             <div metal:define-slot="inside" tal:replace="structure text">The body</div>\n         </div>\n     </metal:block>\ndiff --git a/Products/ATContentTypes/www/portal_factory_manage_types.zpt b/Products/ATContentTypes/www/portal_factory_manage_types.zpt\nindex f7ccb5a7..1f12792f 100644\n--- a/Products/ATContentTypes/www/portal_factory_manage_types.zpt\n+++ b/Products/ATContentTypes/www/portal_factory_manage_types.zpt\n@@ -12,7 +12,7 @@ creation.</p>\n     <tr tal:repeat="type_name python:context.portal_types.listContentTypes()" >\n       <td><input type="checkbox"\n                  tal:attributes="name python:type_name;\n-                                 checked python:test(type_name in factory_types, \'1\', \'\')" /></td>\n+                                 checked python:\'1\' if type_name in factory_types else \'\'" /></td>\n       <td tal:content="type_name" />\n     </tr>\n   </table>\ndiff --git a/news/24.bugfix b/news/24.bugfix\nnew file mode 100644\nindex 00000000..9c050c45\n--- /dev/null\n+++ b/news/24.bugfix\n@@ -0,0 +1 @@\n+Drop use of test() in templates [pbauer]\n\\ No newline at end of file\n'

