Repository: plone.app.caching


Branch: refs/heads/master
Date: 2024-06-19T11:25:35+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/f95f32b41ebe027f24c4517316f64a3e3290702b

Configuring with plone/meta

Files changed:
A dependabot.yml
M .editorconfig
M .flake8
M .github/workflows/meta.yml
M .gitignore
M .meta.toml
M .pre-commit-config.yaml
M pyproject.toml
M tox.ini

b'diff --git a/.editorconfig b/.editorconfig\nindex 8ae05aa..5b3c112 100644\n--- a/.editorconfig\n+++ b/.editorconfig\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n #\n # EditorConfig Configuration file, for more details see:\n@@ -13,7 +13,8 @@\n root = true\n \n \n-[*]  # For All Files\n+[*]\n+# Default settings for all files.\n # Unix-style newlines with a newline ending every file\n end_of_line = lf\n insert_final_newline = true\n@@ -29,11 +30,12 @@ max_line_length = off\n # 4 space indentation\n indent_size = 4\n \n-[*.{yml,zpt,pt,dtml,zcml}]\n+[*.{yml,zpt,pt,dtml,zcml,html,xml}]\n # 2 space indentation\n indent_size = 2\n \n-[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss,html}]  # Frontend development\n+[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss}]\n+# Frontend development\n # 2 space indentation\n indent_size = 2\n max_line_length = 80\ndiff --git a/.flake8 b/.flake8\nindex 7ef4f64..38918f4 100644\n--- a/.flake8\n+++ b/.flake8\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [flake8]\n doctests = 1\ndiff --git a/.github/workflows/meta.yml b/.github/workflows/meta.yml\nindex 02dcdd5..981e32a 100644\n--- a/.github/workflows/meta.yml\n+++ b/.github/workflows/meta.yml\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n name: Meta\n on:\n@@ -55,6 +55,13 @@ jobs:\n # os_dependencies = "git libxml2 libxslt"\n ##\n \n+##\n+# To test against a specific matrix of python versions\n+# when running tests jobs, add in .meta.toml:\n+# [github]\n+# py_versions = "[\'3.12\', \'3.11\']"\n+##\n+\n \n ##\n # Specify additional jobs in .meta.toml:\ndiff --git a/.gitignore b/.gitignore\nindex 503e47c..486392f 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n # python related\n *.egg-info\n@@ -35,6 +35,7 @@ lib64\n parts/\n pyvenv.cfg\n var/\n+local.cfg\n \n # mxdev\n /instance/\ndiff --git a/.meta.toml b/.meta.toml\nindex a0b797b..798d1dd 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -1,9 +1,9 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [meta]\n template = "default"\n-commit-id = "68cda6e4"\n+commit-id = "a89af8f2"\n \n [pyproject]\n check_manifest_ignores = """\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex b6eb043..da56023 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n ci:\n     autofix_prs: false\n@@ -7,16 +7,16 @@ ci:\n \n repos:\n -   repo: https://github.com/asottile/pyupgrade\n-    rev: v3.14.0\n+    rev: v3.15.2\n     hooks:\n     -   id: pyupgrade\n         args: [--py38-plus]\n -   repo: https://github.com/pycqa/isort\n-    rev: 5.12.0\n+    rev: 5.13.2\n     hooks:\n     -   id: isort\n -   repo: https://github.com/psf/black\n-    rev: 23.9.1\n+    rev: 24.4.2\n     hooks:\n     -   id: black\n -   repo: https://github.com/collective/zpretty\n@@ -32,7 +32,7 @@ repos:\n #  """\n ##\n -   repo: https://github.com/PyCQA/flake8\n-    rev: 6.1.0\n+    rev: 7.0.0\n     hooks:\n     -   id: flake8\n \n@@ -44,7 +44,7 @@ repos:\n #  """\n ##\n -   repo: https://github.com/codespell-project/codespell\n-    rev: v2.2.6\n+    rev: v2.3.0\n     hooks:\n     -   id: codespell\n         additional_dependencies:\n@@ -66,12 +66,12 @@ repos:\n     hooks:\n     -   id: pyroma\n -   repo: https://github.com/mgedmin/check-python-versions\n-    rev: "0.21.3"\n+    rev: "0.22.0"\n     hooks:\n     -   id: check-python-versions\n         args: [\'--only\', \'setup.py,pyproject.toml\']\n -   repo: https://github.com/collective/i18ndude\n-    rev: "6.1.0"\n+    rev: "6.2.0"\n     hooks:\n     -   id: i18ndude\n \ndiff --git a/dependabot.yml b/dependabot.yml\nnew file mode 100644\nindex 0000000..bbd3ab0\n--- /dev/null\n+++ b/dependabot.yml\n@@ -0,0 +1,11 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/main/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+version: 2\n+updates:\n+\n+  - package-ecosystem: "github-actions"\n+    directory: "/"\n+    schedule:\n+      # Check for updates to GitHub Actions every week\n+      interval: "weekly"\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 921a574..c1cf23a 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,6 +1,9 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n+[build-system]\n+requires = ["setuptools>=68.2"]\n+\n [tool.towncrier]\n directory = "news/"\n filename = "CHANGES.md"\n@@ -70,7 +73,7 @@ target-version = ["py38"]\n ##\n \n [tool.codespell]\n-ignore-words-list = "discreet,ordner"\n+ignore-words-list = "discreet,assertin,ordner"\n skip = "*.po,"\n ##\n # Add extra configuration options in .meta.toml:\n@@ -133,11 +136,12 @@ ignore-packages = [\'zope.dublincore\']\n [tool.check-manifest]\n ignore = [\n     ".editorconfig",\n+    ".flake8",\n     ".meta.toml",\n     ".pre-commit-config.yaml",\n-    "tox.ini",\n-    ".flake8",\n+    "dependabot.yml",\n     "mx.ini",\n+    "tox.ini",\n     ".tox",\n     "constraints-mxdev.txt",\n     "instance.yaml",\n@@ -145,6 +149,7 @@ ignore = [\n     "requirements-mxdev.txt",\n \n ]\n+\n ##\n # Add extra configuration options in .meta.toml:\n #  [pyproject]\n@@ -152,6 +157,11 @@ ignore = [\n #      "*.map.js",\n #      "*.pyc",\n #  """\n+#  check_manifest_extra_lines = """\n+#  ignore-bad-ideas = [\n+#      "some/test/file/PKG-INFO",\n+#  ]\n+#  """\n ##\n \n \ndiff --git a/tox.ini b/tox.ini\nindex 988e4ea..bb6b070 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [tox]\n # We need 4.4.0 for constrain_package_deps.\n@@ -32,6 +32,14 @@ commands =\n     echo "Unrecognized environment name {envname}"\n     false\n \n+##\n+# Add extra configuration options in .meta.toml:\n+#  [tox]\n+#  testenv_options = """\n+#  basepython = /usr/bin/python3.8\n+#  """\n+##\n+\n [testenv:init]\n description = Prepare environment\n skip_install = true\n@@ -63,9 +71,9 @@ description = check if the package defines all its dependencies\n skip_install = true\n deps =\n     build\n-    z3c.dependencychecker==2.11\n+    z3c.dependencychecker==2.14.3\n commands =\n-    python -m build --sdist --no-isolation\n+    python -m build --sdist\n     dependencychecker\n \n [testenv:dependencies-graph]\n@@ -101,7 +109,7 @@ set_env =\n deps =\n     zope.testrunner\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n-    \n+\n ##\n # Specify additional deps in .meta.toml:\n #  [tox]\n@@ -144,11 +152,12 @@ deps =\n     coverage\n     zope.testrunner\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n-    \n+\n commands =\n     coverage run --branch --source plone.app.caching {envbindir}/zope-testrunner --quiet --all --test-path={toxinidir} -s plone.app.caching {posargs}\n     coverage report -m --format markdown\n     coverage xml\n+    coverage html\n extras =\n     test\n \n@@ -161,19 +170,22 @@ deps =\n     build\n     towncrier\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n-    \n+\n commands =\n     # fake version to not have to install the package\n     # we build the change log as news entries might break\n     # the README that is displayed on PyPI\n     towncrier build --version=100.0.0 --yes\n-    python -m build --sdist --no-isolation\n+    python -m build --sdist\n     twine check dist/*\n \n [testenv:circular]\n description = ensure there are no cyclic dependencies\n use_develop = true\n skip_install = false\n+# Here we must always constrain the package deps to what is already installed,\n+# otherwise we simply get the latest from PyPI, which may not work.\n+constrain_package_deps = true\n set_env =\n \n ##\n@@ -189,7 +201,7 @@ deps =\n     pipdeptree\n     pipforester\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n-    \n+\n commands =\n     # Generate the full dependency tree\n     sh -c \'pipdeptree -j > forest.json\'\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2024-06-19T11:44:56+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/bd7d91fea8a1f8690fa3802dbcb0d65e714a0dcf

black

Files changed:
M plone/app/caching/browser/controlpanel.py
M plone/app/caching/tests/test_operation_default.py
M plone/app/caching/tests/test_operation_utils.py

b'diff --git a/plone/app/caching/browser/controlpanel.py b/plone/app/caching/browser/controlpanel.py\nindex a79fa3a..ed26008 100644\n--- a/plone/app/caching/browser/controlpanel.py\n+++ b/plone/app/caching/browser/controlpanel.py\n@@ -34,7 +34,10 @@\n \n # Borrowed from zope.schema to avoid an import of a private name\n _isuri = re.compile(\n-    r"[a-zA-z0-9+.-]+:" r"\\S*$"  # scheme  # non space (should be pickier)\n+    # scheme\n+    r"[a-zA-z0-9+.-]+:"\n+    # non space (should be pickier)\n+    r"\\S*$"\n ).match\n \n \ndiff --git a/plone/app/caching/tests/test_operation_default.py b/plone/app/caching/tests/test_operation_default.py\nindex 7e81dbc..776a357 100644\n--- a/plone/app/caching/tests/test_operation_default.py\n+++ b/plone/app/caching/tests/test_operation_default.py\n@@ -65,9 +65,9 @@ def test_last_modified_no_etags(self):\n         browser.open(\n             f"{self.portal[\'f1\'].absolute_url()}/++add++Document",\n         )\n-        browser.getControl(\n-            name="form.widgets.IDublinCore.title"\n-        ).value = "dummy content"\n+        browser.getControl(name="form.widgets.IDublinCore.title").value = (\n+            "dummy content"\n+        )\n         browser.getControl("Save").click()\n         self.assertNotIn("Etag", browser.headers)\n \n@@ -79,8 +79,8 @@ def test_last_modified_no_etags(self):\n         url = self.portal["f1"].absolute_url()\n         token = getToken(TEST_USER_NAME)\n         browser.open(f"{url}/dummy-content/edit?_authenticator={token}")\n-        browser.getControl(\n-            name="form.widgets.IDublinCore.title"\n-        ).value = "dummy content"\n+        browser.getControl(name="form.widgets.IDublinCore.title").value = (\n+            "dummy content"\n+        )\n         browser.getControl("Save").click()\n         self.assertIn("Etag", browser.headers)\ndiff --git a/plone/app/caching/tests/test_operation_utils.py b/plone/app/caching/tests/test_operation_utils.py\nindex 9661e69..ec6164d 100644\n--- a/plone/app/caching/tests/test_operation_utils.py\n+++ b/plone/app/caching/tests/test_operation_utils.py\n@@ -610,9 +610,9 @@ def test_isModified_ims_not_modified_two_dates(self):\n         response = HTTPResponse()\n         request = HTTPRequest(StringIO(), environ, response)\n \n-        request.environ[\n-            "HTTP_IF_MODIFIED_SINCE"\n-        ] = "Thu, 24 Nov 2011 03:04:05 GMT; Thu, 24 Nov 2011 03:04:05"\n+        request.environ["HTTP_IF_MODIFIED_SINCE"] = (\n+            "Thu, 24 Nov 2011 03:04:05 GMT; Thu, 24 Nov 2011 03:04:05"\n+        )\n \n         lastModified = datetime.datetime(2010, 11, 24, 3, 4, 5, 6, dateutil.tz.tzutc())\n \n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2024-06-19T11:44:57+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.caching/commit/7871504bc609dea3b1f9cceb8ee0e60f9803ec2e

Add Zope as dependency.

```
Missing requirements
====================
     OFS.Image.File
     Products.Five.browser.pagetemplatefile.ViewPageTemplateFile

Missing test requirements
=========================
     OFS.Image
     OFS.Image.File
     OFS.Image.Image
     OFS.SimpleItem.SimpleItem
     Products.Five.browser.BrowserView
     Products.Five.browser.resource.FileResource
     Products.PageTemplates.ZopePageTemplate.ZopePageTemplate
     ZPublisher.HTTPRequest.HTTPRequest
     ZPublisher.HTTPResponse.HTTPResponse
```

Files changed:
A news/1.bugfix
M setup.py

b'diff --git a/news/1.bugfix b/news/1.bugfix\nnew file mode 100644\nindex 0000000..1dbe99a\n--- /dev/null\n+++ b/news/1.bugfix\n@@ -0,0 +1,2 @@\n+Add Zope to dependencies.  Update config files with plone/meta.\n+[maurits]\ndiff --git a/setup.py b/setup.py\nindex bdfaa4b..4b46263 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -44,13 +44,12 @@\n     zip_safe=False,\n     python_requires=">=3.8",\n     install_requires=[\n-        "AccessControl",\n-        "Acquisition",\n         "Products.CMFCore",\n         "Products.CMFDynamicViewFTI",\n         "Products.CMFPlone",\n         "Products.GenericSetup",\n         "Products.statusmessages",\n+        "Zope",\n         "setuptools",\n         "python-dateutil",\n         "plone.app.registry",\n@@ -67,18 +66,7 @@\n         "z3c.caching",\n         "z3c.form",\n         "z3c.zcmlhook",\n-        "zope.annotation",\n-        "zope.browserresource",\n-        "zope.component",\n-        "zope.event",\n-        "zope.globalrequest",\n-        "zope.i18nmessageid",\n-        "zope.interface",\n-        "zope.lifecycleevent",\n-        "zope.pagetemplate",\n-        "zope.publisher",\n         "zope.ramcache",\n-        "zope.schema",\n     ],\n     extras_require={\n         "test": [\n'

Repository: plone.app.caching


Branch: refs/heads/master
Date: 2024-06-19T15:09:11+02:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.caching/commit/d94ed87dc08d8464b1f669e1b641309b43b344d9

Merge pull request #140 from plone/plone-meta

Add Zope to dependencies.  Update config files with plone/meta.

Files changed:
A dependabot.yml
A news/1.bugfix
M .editorconfig
M .flake8
M .github/workflows/meta.yml
M .gitignore
M .meta.toml
M .pre-commit-config.yaml
M plone/app/caching/browser/controlpanel.py
M plone/app/caching/tests/test_operation_default.py
M plone/app/caching/tests/test_operation_utils.py
M pyproject.toml
M setup.py
M tox.ini

b'diff --git a/.editorconfig b/.editorconfig\nindex 8ae05aa..5b3c112 100644\n--- a/.editorconfig\n+++ b/.editorconfig\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n #\n # EditorConfig Configuration file, for more details see:\n@@ -13,7 +13,8 @@\n root = true\n \n \n-[*]  # For All Files\n+[*]\n+# Default settings for all files.\n # Unix-style newlines with a newline ending every file\n end_of_line = lf\n insert_final_newline = true\n@@ -29,11 +30,12 @@ max_line_length = off\n # 4 space indentation\n indent_size = 4\n \n-[*.{yml,zpt,pt,dtml,zcml}]\n+[*.{yml,zpt,pt,dtml,zcml,html,xml}]\n # 2 space indentation\n indent_size = 2\n \n-[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss,html}]  # Frontend development\n+[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss}]\n+# Frontend development\n # 2 space indentation\n indent_size = 2\n max_line_length = 80\ndiff --git a/.flake8 b/.flake8\nindex 7ef4f64..38918f4 100644\n--- a/.flake8\n+++ b/.flake8\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [flake8]\n doctests = 1\ndiff --git a/.github/workflows/meta.yml b/.github/workflows/meta.yml\nindex 02dcdd5..981e32a 100644\n--- a/.github/workflows/meta.yml\n+++ b/.github/workflows/meta.yml\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n name: Meta\n on:\n@@ -55,6 +55,13 @@ jobs:\n # os_dependencies = "git libxml2 libxslt"\n ##\n \n+##\n+# To test against a specific matrix of python versions\n+# when running tests jobs, add in .meta.toml:\n+# [github]\n+# py_versions = "[\'3.12\', \'3.11\']"\n+##\n+\n \n ##\n # Specify additional jobs in .meta.toml:\ndiff --git a/.gitignore b/.gitignore\nindex 503e47c..486392f 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n # python related\n *.egg-info\n@@ -35,6 +35,7 @@ lib64\n parts/\n pyvenv.cfg\n var/\n+local.cfg\n \n # mxdev\n /instance/\ndiff --git a/.meta.toml b/.meta.toml\nindex a0b797b..798d1dd 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -1,9 +1,9 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [meta]\n template = "default"\n-commit-id = "68cda6e4"\n+commit-id = "a89af8f2"\n \n [pyproject]\n check_manifest_ignores = """\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex b6eb043..da56023 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n ci:\n     autofix_prs: false\n@@ -7,16 +7,16 @@ ci:\n \n repos:\n -   repo: https://github.com/asottile/pyupgrade\n-    rev: v3.14.0\n+    rev: v3.15.2\n     hooks:\n     -   id: pyupgrade\n         args: [--py38-plus]\n -   repo: https://github.com/pycqa/isort\n-    rev: 5.12.0\n+    rev: 5.13.2\n     hooks:\n     -   id: isort\n -   repo: https://github.com/psf/black\n-    rev: 23.9.1\n+    rev: 24.4.2\n     hooks:\n     -   id: black\n -   repo: https://github.com/collective/zpretty\n@@ -32,7 +32,7 @@ repos:\n #  """\n ##\n -   repo: https://github.com/PyCQA/flake8\n-    rev: 6.1.0\n+    rev: 7.0.0\n     hooks:\n     -   id: flake8\n \n@@ -44,7 +44,7 @@ repos:\n #  """\n ##\n -   repo: https://github.com/codespell-project/codespell\n-    rev: v2.2.6\n+    rev: v2.3.0\n     hooks:\n     -   id: codespell\n         additional_dependencies:\n@@ -66,12 +66,12 @@ repos:\n     hooks:\n     -   id: pyroma\n -   repo: https://github.com/mgedmin/check-python-versions\n-    rev: "0.21.3"\n+    rev: "0.22.0"\n     hooks:\n     -   id: check-python-versions\n         args: [\'--only\', \'setup.py,pyproject.toml\']\n -   repo: https://github.com/collective/i18ndude\n-    rev: "6.1.0"\n+    rev: "6.2.0"\n     hooks:\n     -   id: i18ndude\n \ndiff --git a/dependabot.yml b/dependabot.yml\nnew file mode 100644\nindex 0000000..bbd3ab0\n--- /dev/null\n+++ b/dependabot.yml\n@@ -0,0 +1,11 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/main/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+version: 2\n+updates:\n+\n+  - package-ecosystem: "github-actions"\n+    directory: "/"\n+    schedule:\n+      # Check for updates to GitHub Actions every week\n+      interval: "weekly"\ndiff --git a/news/1.bugfix b/news/1.bugfix\nnew file mode 100644\nindex 0000000..1dbe99a\n--- /dev/null\n+++ b/news/1.bugfix\n@@ -0,0 +1,2 @@\n+Add Zope to dependencies.  Update config files with plone/meta.\n+[maurits]\ndiff --git a/plone/app/caching/browser/controlpanel.py b/plone/app/caching/browser/controlpanel.py\nindex a79fa3a..ed26008 100644\n--- a/plone/app/caching/browser/controlpanel.py\n+++ b/plone/app/caching/browser/controlpanel.py\n@@ -34,7 +34,10 @@\n \n # Borrowed from zope.schema to avoid an import of a private name\n _isuri = re.compile(\n-    r"[a-zA-z0-9+.-]+:" r"\\S*$"  # scheme  # non space (should be pickier)\n+    # scheme\n+    r"[a-zA-z0-9+.-]+:"\n+    # non space (should be pickier)\n+    r"\\S*$"\n ).match\n \n \ndiff --git a/plone/app/caching/tests/test_operation_default.py b/plone/app/caching/tests/test_operation_default.py\nindex 7e81dbc..776a357 100644\n--- a/plone/app/caching/tests/test_operation_default.py\n+++ b/plone/app/caching/tests/test_operation_default.py\n@@ -65,9 +65,9 @@ def test_last_modified_no_etags(self):\n         browser.open(\n             f"{self.portal[\'f1\'].absolute_url()}/++add++Document",\n         )\n-        browser.getControl(\n-            name="form.widgets.IDublinCore.title"\n-        ).value = "dummy content"\n+        browser.getControl(name="form.widgets.IDublinCore.title").value = (\n+            "dummy content"\n+        )\n         browser.getControl("Save").click()\n         self.assertNotIn("Etag", browser.headers)\n \n@@ -79,8 +79,8 @@ def test_last_modified_no_etags(self):\n         url = self.portal["f1"].absolute_url()\n         token = getToken(TEST_USER_NAME)\n         browser.open(f"{url}/dummy-content/edit?_authenticator={token}")\n-        browser.getControl(\n-            name="form.widgets.IDublinCore.title"\n-        ).value = "dummy content"\n+        browser.getControl(name="form.widgets.IDublinCore.title").value = (\n+            "dummy content"\n+        )\n         browser.getControl("Save").click()\n         self.assertIn("Etag", browser.headers)\ndiff --git a/plone/app/caching/tests/test_operation_utils.py b/plone/app/caching/tests/test_operation_utils.py\nindex 9661e69..ec6164d 100644\n--- a/plone/app/caching/tests/test_operation_utils.py\n+++ b/plone/app/caching/tests/test_operation_utils.py\n@@ -610,9 +610,9 @@ def test_isModified_ims_not_modified_two_dates(self):\n         response = HTTPResponse()\n         request = HTTPRequest(StringIO(), environ, response)\n \n-        request.environ[\n-            "HTTP_IF_MODIFIED_SINCE"\n-        ] = "Thu, 24 Nov 2011 03:04:05 GMT; Thu, 24 Nov 2011 03:04:05"\n+        request.environ["HTTP_IF_MODIFIED_SINCE"] = (\n+            "Thu, 24 Nov 2011 03:04:05 GMT; Thu, 24 Nov 2011 03:04:05"\n+        )\n \n         lastModified = datetime.datetime(2010, 11, 24, 3, 4, 5, 6, dateutil.tz.tzutc())\n \ndiff --git a/pyproject.toml b/pyproject.toml\nindex 921a574..c1cf23a 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,6 +1,9 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n+[build-system]\n+requires = ["setuptools>=68.2"]\n+\n [tool.towncrier]\n directory = "news/"\n filename = "CHANGES.md"\n@@ -70,7 +73,7 @@ target-version = ["py38"]\n ##\n \n [tool.codespell]\n-ignore-words-list = "discreet,ordner"\n+ignore-words-list = "discreet,assertin,ordner"\n skip = "*.po,"\n ##\n # Add extra configuration options in .meta.toml:\n@@ -133,11 +136,12 @@ ignore-packages = [\'zope.dublincore\']\n [tool.check-manifest]\n ignore = [\n     ".editorconfig",\n+    ".flake8",\n     ".meta.toml",\n     ".pre-commit-config.yaml",\n-    "tox.ini",\n-    ".flake8",\n+    "dependabot.yml",\n     "mx.ini",\n+    "tox.ini",\n     ".tox",\n     "constraints-mxdev.txt",\n     "instance.yaml",\n@@ -145,6 +149,7 @@ ignore = [\n     "requirements-mxdev.txt",\n \n ]\n+\n ##\n # Add extra configuration options in .meta.toml:\n #  [pyproject]\n@@ -152,6 +157,11 @@ ignore = [\n #      "*.map.js",\n #      "*.pyc",\n #  """\n+#  check_manifest_extra_lines = """\n+#  ignore-bad-ideas = [\n+#      "some/test/file/PKG-INFO",\n+#  ]\n+#  """\n ##\n \n \ndiff --git a/setup.py b/setup.py\nindex bdfaa4b..4b46263 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -44,13 +44,12 @@\n     zip_safe=False,\n     python_requires=">=3.8",\n     install_requires=[\n-        "AccessControl",\n-        "Acquisition",\n         "Products.CMFCore",\n         "Products.CMFDynamicViewFTI",\n         "Products.CMFPlone",\n         "Products.GenericSetup",\n         "Products.statusmessages",\n+        "Zope",\n         "setuptools",\n         "python-dateutil",\n         "plone.app.registry",\n@@ -67,18 +66,7 @@\n         "z3c.caching",\n         "z3c.form",\n         "z3c.zcmlhook",\n-        "zope.annotation",\n-        "zope.browserresource",\n-        "zope.component",\n-        "zope.event",\n-        "zope.globalrequest",\n-        "zope.i18nmessageid",\n-        "zope.interface",\n-        "zope.lifecycleevent",\n-        "zope.pagetemplate",\n-        "zope.publisher",\n         "zope.ramcache",\n-        "zope.schema",\n     ],\n     extras_require={\n         "test": [\ndiff --git a/tox.ini b/tox.ini\nindex 988e4ea..bb6b070 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [tox]\n # We need 4.4.0 for constrain_package_deps.\n@@ -32,6 +32,14 @@ commands =\n     echo "Unrecognized environment name {envname}"\n     false\n \n+##\n+# Add extra configuration options in .meta.toml:\n+#  [tox]\n+#  testenv_options = """\n+#  basepython = /usr/bin/python3.8\n+#  """\n+##\n+\n [testenv:init]\n description = Prepare environment\n skip_install = true\n@@ -63,9 +71,9 @@ description = check if the package defines all its dependencies\n skip_install = true\n deps =\n     build\n-    z3c.dependencychecker==2.11\n+    z3c.dependencychecker==2.14.3\n commands =\n-    python -m build --sdist --no-isolation\n+    python -m build --sdist\n     dependencychecker\n \n [testenv:dependencies-graph]\n@@ -101,7 +109,7 @@ set_env =\n deps =\n     zope.testrunner\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n-    \n+\n ##\n # Specify additional deps in .meta.toml:\n #  [tox]\n@@ -144,11 +152,12 @@ deps =\n     coverage\n     zope.testrunner\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n-    \n+\n commands =\n     coverage run --branch --source plone.app.caching {envbindir}/zope-testrunner --quiet --all --test-path={toxinidir} -s plone.app.caching {posargs}\n     coverage report -m --format markdown\n     coverage xml\n+    coverage html\n extras =\n     test\n \n@@ -161,19 +170,22 @@ deps =\n     build\n     towncrier\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n-    \n+\n commands =\n     # fake version to not have to install the package\n     # we build the change log as news entries might break\n     # the README that is displayed on PyPI\n     towncrier build --version=100.0.0 --yes\n-    python -m build --sdist --no-isolation\n+    python -m build --sdist\n     twine check dist/*\n \n [testenv:circular]\n description = ensure there are no cyclic dependencies\n use_develop = true\n skip_install = false\n+# Here we must always constrain the package deps to what is already installed,\n+# otherwise we simply get the latest from PyPI, which may not work.\n+constrain_package_deps = true\n set_env =\n \n ##\n@@ -189,7 +201,7 @@ deps =\n     pipdeptree\n     pipforester\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n-    \n+\n commands =\n     # Generate the full dependency tree\n     sh -c \'pipdeptree -j > forest.json\'\n'

