Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-16T18:13:39+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/0203e73ced237deda05d09b632b978c9facce910

Fix robot tests for new `pat-contentbrowser` selectors in TinyMCE

Files changed:
M Products/CMFPlone/tests/robot/test_linkintegrity.robot
M Products/CMFPlone/tests/robot/test_tinymce.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex b0c6fa4dbb..854580c3d2 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -21,6 +21,10 @@ Resource  keywords.robot\n Test Setup  Run keywords  Plone Test Setup\n Test Teardown  Run keywords  Plone Test Teardown\n \n+*** Variables ****************************************************************\n+\n+${SELENIUM_RUN_ON_FAILURE}  Capture page screenshot and log source\n+\n \n *** Test Cases ***************************************************************\n \n@@ -74,18 +78,16 @@ a link in rich text\n   Input text  css=.mce-content-body  foo\n   Execute Javascript    function selectElementContents(el) {var range = document.createRange(); range.selectNodeContents(el); var sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);} var el = document.getElementById("tinymce"); selectElementContents(el);\n   UnSelect Frame\n-  Click Button  css=button[aria-label="Insert/edit link"]\n \n-  Given patterns are loaded\n-  Wait until element is visible  css=.pat-relateditems .select2-input.select2-default\n-  Click Element  css=.pat-relateditems .select2-input.select2-default\n-  Wait until element is visible  css=.pat-relateditems-result.one-level-up a.pat-relateditems-result-browse\n-  Click Element  css=.pat-relateditems-result.one-level-up a.pat-relateditems-result-browse\n-  Wait until element is visible  xpath=(//span[contains(., \'Foo\')])\n-  Sleep  2s\n-  Click Element  xpath=(//span[contains(., \'Foo\')])\n-  Wait until element is visible  css=.pat-relateditems-item-title\n-  Wait For Then Click Element  css=.modal-footer .btn-primary\n+  Click Button  css=button[aria-label="Insert/edit link"]\n+  Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+  Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n+  Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+  Wait For Then Click Element  css=.modal-footer input[name="insert"]\n+  Select Frame  css=.tox-edit-area iframe\n+  Execute Javascript  window.getSelection().removeAllRanges()\n+  UnSelect Frame\n+  Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n   Wait For Then Click Element  css=#form-buttons-save\n \n \ndiff --git a/Products/CMFPlone/tests/robot/test_tinymce.robot b/Products/CMFPlone/tests/robot/test_tinymce.robot\nindex 75eb8d00c7..edaa1fd006 100644\n--- a/Products/CMFPlone/tests/robot/test_tinymce.robot\n+++ b/Products/CMFPlone/tests/robot/test_tinymce.robot\n@@ -55,11 +55,10 @@ insert link\n     Execute Javascript    function selectElementContents(el) {var range = document.createRange(); range.selectNodeContents(el); var sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);} var el = document.getElementById("tinymce"); selectElementContents(el);\n     UnSelect Frame\n     Click Button  css=button[aria-label="Insert/edit link"]\n-    Click Button  css=.pat-relateditems-container button.favorites\n-    Click Link  css=.pat-relateditems-container .favorites a.fav[href=\'/\']\n-    Wait Until Element Is Visible  css=.pat-relateditems-result-select.selectable\n-    Click Link  css=.pat-relateditems-result-select.selectable\n-    Click Button  css=.modal-footer input[name="insert"]\n+    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait For Then Click Element  css=.modal-footer input[name="insert"]\n     Select Frame  css=.tox-edit-area iframe\n     Execute Javascript  window.getSelection().removeAllRanges()\n     UnSelect Frame\n@@ -67,10 +66,11 @@ insert link\n \n insert image\n     Click Button  css=button[aria-label="Insert/edit image"]\n-    Click Button  css=.pat-relateditems-container button.favorites\n-    Click Link  css=.pat-relateditems-container .favorites a.fav[href=\'/\']\n-    Wait Until Element Is Visible  css=.pat-relateditems-result-select.selectable\n-    Click Link  css=.pat-relateditems-result-select.selectable\n+    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper .selected-item .item-info button.btn-link\n+    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n+    Capture Page Screenshot\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Input Text  css=.modal-body [name="title"]  SomeTitle\n     Input Text  css=.modal-body [name="alt"]  SomeAlt\n     Click Button  css=.modal-footer input[name="insert"]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-16T18:13:39+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/f34473d54120fe39b590391464e7ce711ae904a9

fix tinymce robot test

Files changed:
M Products/CMFPlone/tests/robot/test_tinymce.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_tinymce.robot b/Products/CMFPlone/tests/robot/test_tinymce.robot\nindex edaa1fd006..69eb813598 100644\n--- a/Products/CMFPlone/tests/robot/test_tinymce.robot\n+++ b/Products/CMFPlone/tests/robot/test_tinymce.robot\n@@ -47,17 +47,25 @@ an uploaded image\n text inserted into wysiwyg\n     Wait Until Element Is Visible  css=.tox-edit-area iframe\n     Select Frame  css=.tox-edit-area iframe\n-    Input text  css=.mce-content-body  foobar\n+    Press Keys    //body[@id="tinymce"]    Susi Sorglos and John Doe\n     UnSelect Frame\n \n insert link\n-    Select Frame  css=.tox-edit-area iframe\n-    Execute Javascript    function selectElementContents(el) {var range = document.createRange(); range.selectNodeContents(el); var sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);} var el = document.getElementById("tinymce"); selectElementContents(el);\n-    UnSelect Frame\n+    Execute Javascript    function selectText() {\n+    ...    var iframe_document = document.querySelector(".tox-edit-area iframe").contentDocument;\n+    ...    var body = iframe_document.body;\n+    ...    var p = body.firstChild;\n+    ...    var range = new Range();\n+    ...    range.setStart(p.firstChild, 5);\n+    ...    range.setEnd(p.firstChild, 12);\n+    ...    iframe_document.getSelection().removeAllRanges();\n+    ...    iframe_document.getSelection().addRange(range);\n+    ...    }; selectText();\n     Click Button  css=button[aria-label="Insert/edit link"]\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n     Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n     Wait For Then Click Element  css=.modal-footer input[name="insert"]\n     Select Frame  css=.tox-edit-area iframe\n     Execute Javascript  window.getSelection().removeAllRanges()\n@@ -66,12 +74,12 @@ insert link\n \n insert image\n     Click Button  css=button[aria-label="Insert/edit image"]\n-    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper .selected-item .item-info button.btn-link\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n     Capture Page Screenshot\n     Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n     Input Text  css=.modal-body [name="title"]  SomeTitle\n     Input Text  css=.modal-body [name="alt"]  SomeAlt\n     Click Button  css=.modal-footer input[name="insert"]\n-    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n+    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-16T18:13:39+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/8271ca9be6e135fc249ff2c213d9a72f563e3227

fix linkintegrity robot test

Files changed:
M Products/CMFPlone/tests/robot/test_linkintegrity.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex 854580c3d2..b45dc121ac 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -83,6 +83,7 @@ a link in rich text\n   Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n   Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n   Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+  Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n   Wait For Then Click Element  css=.modal-footer input[name="insert"]\n   Select Frame  css=.tox-edit-area iframe\n   Execute Javascript  window.getSelection().removeAllRanges()\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-16T18:13:39+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/06b742b068458d45ceda16fbdc3345abdf59944a

add more robot tests for pat-contentbrowser

Files changed:
A Products/CMFPlone/tests/robot/test_contentbrowser.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nnew file mode 100644\nindex 0000000000..a4627623e2\n--- /dev/null\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -0,0 +1,247 @@\n+*** Settings *****************************************************************\n+\n+Resource  plone/app/robotframework/keywords.robot\n+Resource  plone/app/robotframework/saucelabs.robot\n+Resource  plone/app/robotframework/selenium.robot\n+Resource  keywords.robot\n+\n+Library  Remote  ${PLONE_URL}/RobotRemote\n+\n+Variables  Products/CMFPlone/tests/robot/variables.py\n+\n+# use this for a ful browser window if you develop the tests\n+# Test Setup  Run keywords  Plone Test Setup    Maximize Browser Window\n+Test Setup  Run keywords  Plone Test Setup\n+Test Teardown  Run keywords  Plone Test Teardown\n+\n+*** Variables ***\n+\n+${ASSET_FOLDER}    asset-folder\n+${DOCUMENT_ID}    doc\n+\n+*** Test cases ***************************************************************\n+\n+\n+Scenario: Select a related Item\n+     Given a logged-in site administrator\n+       and a document\n+       and a nested asset folder\n+      When I select a related item image via contentbrowser\n+      Then a image is selected as related item\n+\n+Scenario: Select more than one related Items\n+    Given a logged-in site administrator\n+      and a document\n+      and a nested asset folder\n+     When I select two related item images via contentbrowser\n+     Then two images are selected as related item\n+\n+Scenario: add an internal Link via contentbrowser\n+    Given a logged-in site administrator\n+      and a document\n+      and a nested asset folder\n+     When I set an internal link via contentbrowser\n+      and I save the document\n+     Then the document contain the internal link\n+\n+Scenario: add an image via contentbrowser\n+    Given a logged-in site administrator\n+      and a document\n+      and a nested asset folder\n+     When I set an image via contentbrowser\n+      and I save the document\n+     Then the document contain the image\n+\n+Scenario: upload an image via contentbrowser\n+    Given a logged-in site administrator\n+      and a document\n+      and a nested asset folder\n+     When I upload an image via contentbrowser\n+      and I save the document\n+     Then the document contain the uploaded image      \n+      \n+\n+*** Keywords *****************************************************************\n+\n+# --- GIVEN ------------------------------------------------------------------\n+\n+a nested asset folder\n+    #\n+    # + Assets\n+    #  + Mixed\n+    #   - File1    \n+    #   - Image1\n+    #   - Document1\n+    #   - News Item1\n+    #   + Files\n+    #    - File1\n+    #    - File2\n+    #    + Images\n+    #     - Image1\n+    #     - Image2\n+    #\n+    ${folder_assets_uid}=  Create content    type=Folder    title=Assets    id=${ASSET_FOLDER}\n+\n+    ${folder_mixed_uid}=  Create content    type=Folder    title=Mixed    container=${folder_assets_uid}\n+    Create content    type=File    title=File1    container=${folder_mixed_uid}\n+    Create content    type=Image    title=Image1    container=${folder_mixed_uid}\n+    Create content    type=Document    title=Document1    container=${folder_mixed_uid}\n+    Create content    type=News Item    title=News Item1    container=${folder_mixed_uid}\n+\n+    ${folder_files_uid}=  Create content    type=Folder    title=Files    container=${folder_mixed_uid}\n+    Create content    type=File    title=File1    container=${folder_files_uid}\n+    Create content    type=File    title=File2    container=${folder_files_uid}\n+    \n+    ${folder_images_uid}=  Create content    type=Folder    title=Images    container=${folder_files_uid}\n+    Create content    type=Image    id=image-1    title=Image1    container=${folder_images_uid}\n+    Create content    type=Image    id=image-2    title=Image2    container=${folder_images_uid}\n+\n+a document\n+    Create content  type=Document  id=${DOCUMENT_ID}    title=My Page\n+\n+# --- WHEN ------------------------------------------------------------------\n+\n+I select a related item image via contentbrowser\n+   Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n+   # Click the Categorization Tab\n+   Wait For Then Click Element    //a[@id="autotoc-item-autotoc-2"]\n+   # Click the select button\n+   Wait For Then Click Element    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n+   # Click third element in first column, that is the "Assets" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[4]/div[contains(@class, "browseSub")]\n+   # Click first element in second column, that is the "Mixed" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]/div[contains(@class, "browseSub")]\n+   # Click fifth element in third column, that is the "Files" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[5]/div[contains(@class, "browseSub")]\n+   # Click third element in fourth column, that is the "Images" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[3]/div[contains(@class, "browseSub")]\n+   # Click second element in fifth column, that is the "Image2" Object\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]\n+   # Click the select Button in the Toolbar of column 6\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[6]/div[contains(@class, "levelToolbar")]/button\n+\n+\n+I select two related item images via contentbrowser\n+   Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n+   # Click the Categorization Tab\n+   Wait For Then Click Element    //a[@id="autotoc-item-autotoc-2"]\n+   # Click the select button\n+   Wait For Then Click Element    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n+   # Click third element in first column, that is the "Assets" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[4]/div[contains(@class, "browseSub")]\n+   # Click first element in second column, that is the "Mixed" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]/div[contains(@class, "browseSub")]\n+   # Click fifth element in third column, that is the "Files" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[5]/div[contains(@class, "browseSub")]\n+   # Click third element in fourth column, that is the "Images" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[3]/div[contains(@class, "browseSub")]\n+   \n+   # now we select two items in a colum via CTRL+Click\n+   # Click second element in fifth column, that is the "Image1" Object\n+   Wait For Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[1]\n+   Click Element        //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[1]    CTRL\n+   # Click second element in fifth column, that is the "Image2" Object\n+   Wait For Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]\n+   Click Element        //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]    CTRL\n+   # Click the select Button in the Toolbar of column 6\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[6]/div[contains(@class, "levelToolbar")]/button\n+\n+\n+I set an internal link via contentbrowser\n+    Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n+    Select Frame  css=.tox-edit-area iframe\n+    Press Keys    //body[@id="tinymce"]    Susi Sorglos and John Doe\n+    UnSelect Frame\n+    Execute Javascript    function selectText() {\n+    ...    var iframe_document = document.querySelector(".tox-edit-area iframe").contentDocument;\n+    ...    var body = iframe_document.body;\n+    ...    var p = body.firstChild;\n+    ...    var range = new Range();    \n+    ...    console.log(iframe_document, body, p, p.firstChild, range);\n+    ...    range.setStart(p.firstChild, 5);\n+    ...    range.setEnd(p.firstChild, 12);\n+    ...    iframe_document.getSelection().removeAllRanges();\n+    ...    iframe_document.getSelection().addRange(range);\n+    ...    }; selectText();\n+    Click Button  //button[@aria-label="Insert/edit link"]\n+    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n+    Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n+    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n+\n+I set an image via contentbrowser\n+    Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n+    Select Frame  css=.tox-edit-area iframe\n+    Press Keys    //body[@id="tinymce"]    Susi Sorglos and John Doe\n+    UnSelect Frame\n+    Click Button  //button[@aria-label="Insert/edit image"]\n+    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[1]\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n+    Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n+    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n+\n+I upload an image via contentbrowser\n+    Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n+    Select Frame  css=.tox-edit-area iframe\n+    Press Keys    //body[@id="tinymce"]    Susi Sorglos and John Doe\n+    UnSelect Frame\n+    Click Button  //button[@aria-label="Insert/edit image"]\n+    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]/button[contains(@class,"upload")]\n+    Choose File    xpath=//div[contains(@class,"pat-upload")]//input[@class="dz-hidden-input"]    ${PATH_TO_TEST_FILES}/plone-logo.png\n+    Wait For Then Click Element  xpath=//div[contains(@class,"pat-upload")]//button[contains(@class,"upload-all")]\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[3]\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n+    Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n+    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]    \n+\n+I save the document\n+    Click Button    xpath=//button[@id="form-buttons-save"]\n+\n+\n+\n+# --- THEN ------------------------------------------------------------------    \n+\n+a image is selected as related item\n+    image is releated item    //div[contains(@class, "content-browser-selected-items")]/div[1]/img    /asset-folder/mixed/files/images/image-2/@@images/image/mini    \n+\n+\n+two images are selected as related item\n+    image is releated item    //div[contains(@class, "content-browser-selected-items")]/div[1]/img    /asset-folder/mixed/files/images/image-1/@@images/image/mini    \n+    image is releated item    //div[contains(@class, "content-browser-selected-items")]/div[2]/img    /asset-folder/mixed/files/images/image-2/@@images/image/mini\n+    \n+the document contain the internal link\n+    Element exists    //div[@id="parent-fieldname-text"]//a    href    /plone/doc\n+\n+the document contain the image\n+    rendered textfield contain the image with title    Image1\n+\n+the document contain the uploaded image\n+    rendered textfield contain the image with title    plone-logo.png\n+\n+\n+#--- Helper DRY -------------------------------------------------------------\n+\n+image is releated item\n+    [arguments]    ${xpath}    ${imagepath}\n+    Element exists    ${xpath}    src    ${imagepath}\n+\n+rendered textfield contain the image with title\n+    [arguments]  ${imagetitle}\n+    Element exists    //div[@id="parent-fieldname-text"]//picture/img    title    ${imagetitle}\n+\n+Element exists\n+    [arguments]  ${xpath}    ${attr}    ${value}\n+    ${element}=    Set Variable    ${xpath}\n+    Element Should Be Visible    ${element}\n+    ${_attr}=  Get Element Attribute    ${element}    ${attr}\n+    Should End With    ${_attr}    ${value}\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-16T18:13:39+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/8f2908e1fa050b995d63aa6e948bad352fdb630a

add News

Files changed:
A news/3980.bugfix

b'diff --git a/news/3980.bugfix b/news/3980.bugfix\nnew file mode 100644\nindex 0000000000..db21c66371\n--- /dev/null\n+++ b/news/3980.bugfix\n@@ -0,0 +1,6 @@\n+Update robot tests for new `pat-contentbrowser` pattern.\n+[petschki]\n+\n+- Make tests more robust for new `pat-contentbrowser` pattern.\n+- add more robot tests for `pat-contentbrowser` pattern.\n+[1letter]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-16T18:13:39+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/41ab1db1c34023d6684009da5557d2ab3aba07bb

remove log statement from js code in test

Files changed:
M Products/CMFPlone/tests/robot/test_contentbrowser.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nindex a4627623e2..1f2af5bfe1 100644\n--- a/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -156,8 +156,7 @@ I set an internal link via contentbrowser\n     ...    var iframe_document = document.querySelector(".tox-edit-area iframe").contentDocument;\n     ...    var body = iframe_document.body;\n     ...    var p = body.firstChild;\n-    ...    var range = new Range();    \n-    ...    console.log(iframe_document, body, p, p.firstChild, range);\n+    ...    var range = new Range();\n     ...    range.setStart(p.firstChild, 5);\n     ...    range.setEnd(p.firstChild, 12);\n     ...    iframe_document.getSelection().removeAllRanges();\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-16T18:13:39+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/5b1b411a077220024243dd2b57a018de2c4e05cd

add robot test for search via pat-contentbrowser

Files changed:
M Products/CMFPlone/tests/robot/test_contentbrowser.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nindex 1f2af5bfe1..3e1bfc1158 100644\n--- a/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -58,7 +58,15 @@ Scenario: upload an image via contentbrowser\n       and a nested asset folder\n      When I upload an image via contentbrowser\n       and I save the document\n-     Then the document contain the uploaded image      \n+     Then the document contain the uploaded image\n+\n+Scenario: search and select an image via contentbrowser\n+    Given a logged-in site administrator\n+      and a document\n+      and a nested asset folder\n+     When I search and select an image via contentbrowser\n+      and I save the document\n+     Then the document contain the image by search       \n       \n \n *** Keywords *****************************************************************\n@@ -95,6 +103,8 @@ a nested asset folder\n     ${folder_images_uid}=  Create content    type=Folder    title=Images    container=${folder_files_uid}\n     Create content    type=Image    id=image-1    title=Image1    container=${folder_images_uid}\n     Create content    type=Image    id=image-2    title=Image2    container=${folder_images_uid}\n+    Create content    type=Image    id=image-3    title=My Image    container=${folder_images_uid}\n+    Create content    type=Image    id=image-4    title=Another Image    container=${folder_images_uid}\n \n a document\n     Create content  type=Document  id=${DOCUMENT_ID}    title=My Page\n@@ -201,7 +211,30 @@ I upload an image via contentbrowser\n     Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n     Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n-    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]    \n+    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n+\n+I search and select an image via contentbrowser\n+    Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n+    Select Frame  css=.tox-edit-area iframe\n+    Press Keys    //body[@id="tinymce"]    Susi Sorglos and John Doe\n+    UnSelect Frame\n+    Click Button  //button[@aria-label="Insert/edit image"]\n+    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[2]\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[1]    \n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]\n+    Press Keys    xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]    Anot\n+    # here we need a timeout, because the search filter is not so fast like the testbrowser, it looks like a asynch operation\n+    ${speed}    Get Selenium Speed\n+    Set Selenium Speed    1 seconds\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[1]\n+    Set Selenium Speed    ${speed}\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n+    Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n+    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n \n I save the document\n     Click Button    xpath=//button[@id="form-buttons-save"]\n@@ -224,6 +257,9 @@ the document contain the internal link\n the document contain the image\n     rendered textfield contain the image with title    Image1\n \n+the document contain the image by search\n+    rendered textfield contain the image with title    Another Image\n+\n the document contain the uploaded image\n     rendered textfield contain the image with title    plone-logo.png\n \n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-16T18:13:39+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/c71cd80109eeb6fcbba973ce7f598c1f1079be5d

add custom keyword for item selection in column off contentbrowser

Files changed:
M Products/CMFPlone/tests/robot/test_contentbrowser.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nindex 3e1bfc1158..5f51d3dfab 100644\n--- a/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -118,13 +118,13 @@ I select a related item image via contentbrowser\n    # Click the select button\n    Wait For Then Click Element    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n    # Click third element in first column, that is the "Assets" folder\n-   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[4]/div[contains(@class, "browseSub")]\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[4]\n    # Click first element in second column, that is the "Mixed" folder\n-   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]/div[contains(@class, "browseSub")]\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n    # Click fifth element in third column, that is the "Files" folder\n-   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[5]/div[contains(@class, "browseSub")]\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[5]\n    # Click third element in fourth column, that is the "Images" folder\n-   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[3]/div[contains(@class, "browseSub")]\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[3]\n    # Click second element in fifth column, that is the "Image2" Object\n    Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]\n    # Click the select Button in the Toolbar of column 6\n@@ -138,13 +138,13 @@ I select two related item images via contentbrowser\n    # Click the select button\n    Wait For Then Click Element    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n    # Click third element in first column, that is the "Assets" folder\n-   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[4]/div[contains(@class, "browseSub")]\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[4]\n    # Click first element in second column, that is the "Mixed" folder\n-   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]/div[contains(@class, "browseSub")]\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n    # Click fifth element in third column, that is the "Files" folder\n-   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[5]/div[contains(@class, "browseSub")]\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[5]\n    # Click third element in fourth column, that is the "Images" folder\n-   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[3]/div[contains(@class, "browseSub")]\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[3]\n    \n    # now we select two items in a colum via CTRL+Click\n    # Click second element in fifth column, that is the "Image1" Object\n@@ -174,7 +174,7 @@ I set an internal link via contentbrowser\n     ...    }; selectText();\n     Click Button  //button[@aria-label="Insert/edit link"]\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n+    Click item in column    1    3\n     Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n     Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n@@ -187,9 +187,9 @@ I set an image via contentbrowser\n     UnSelect Frame\n     Click Button  //button[@aria-label="Insert/edit image"]\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[1]\n+    Click item in column    1    3    \n+    Click item in column    2    1    \n+    Click item in column    3    1\n     Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n     Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n@@ -202,12 +202,12 @@ I upload an image via contentbrowser\n     UnSelect Frame\n     Click Button  //button[@aria-label="Insert/edit image"]\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n+    Click item in column    1    3    \n+    Click item in column    2    1\n     Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]/button[contains(@class,"upload")]\n     Choose File    xpath=//div[contains(@class,"pat-upload")]//input[@class="dz-hidden-input"]    ${PATH_TO_TEST_FILES}/plone-logo.png\n     Wait For Then Click Element  xpath=//div[contains(@class,"pat-upload")]//button[contains(@class,"upload-all")]\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[3]\n+    Click item in column    3    3\n     Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n     Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n@@ -220,16 +220,16 @@ I search and select an image via contentbrowser\n     UnSelect Frame\n     Click Button  //button[@aria-label="Insert/edit image"]\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[2]\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[1]    \n+    Click item in column    1    3\n+    Click item in column    2    1\n+    Click item in column    3    2\n+    Click item in column    4    1\n     Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]\n     Press Keys    xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]    Anot\n     # here we need a timeout, because the search filter is not so fast like the testbrowser, it looks like a asynch operation\n     ${speed}    Get Selenium Speed\n     Set Selenium Speed    1 seconds\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[1]\n+    Click item in column    5    1\n     Set Selenium Speed    ${speed}\n     Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n@@ -279,4 +279,8 @@ Element exists\n     ${element}=    Set Variable    ${xpath}\n     Element Should Be Visible    ${element}\n     ${_attr}=  Get Element Attribute    ${element}    ${attr}\n-    Should End With    ${_attr}    ${value}\n\\ No newline at end of file\n+    Should End With    ${_attr}    ${value}\n+\n+Click item in column\n+    [arguments]  ${colnumber}    ${itemposition}\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[${colnumber}]/div[contains(@class, "levelItems")]/div[${itemposition}]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-16T18:13:39+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/98e24a1ff0498f4aa46c41f4a78690f98110865a

remove expilcit locator strategy keyword "xpath"

Files changed:
M Products/CMFPlone/tests/robot/test_contentbrowser.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nindex 5f51d3dfab..0c6f5fca05 100644\n--- a/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -175,8 +175,8 @@ I set an internal link via contentbrowser\n     Click Button  //button[@aria-label="Insert/edit link"]\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n-    Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    //div[contains(@class,"content-browser-position-wrapper")]\n     Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n     Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n \n@@ -190,8 +190,8 @@ I set an image via contentbrowser\n     Click item in column    1    3    \n     Click item in column    2    1    \n     Click item in column    3    1\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n-    Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    //div[contains(@class,"content-browser-position-wrapper")]\n     Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n     Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n \n@@ -204,12 +204,12 @@ I upload an image via contentbrowser\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3    \n     Click item in column    2    1\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]/button[contains(@class,"upload")]\n-    Choose File    xpath=//div[contains(@class,"pat-upload")]//input[@class="dz-hidden-input"]    ${PATH_TO_TEST_FILES}/plone-logo.png\n-    Wait For Then Click Element  xpath=//div[contains(@class,"pat-upload")]//button[contains(@class,"upload-all")]\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]/button[contains(@class,"upload")]\n+    Choose File    //div[contains(@class,"pat-upload")]//input[@class="dz-hidden-input"]    ${PATH_TO_TEST_FILES}/plone-logo.png\n+    Wait For Then Click Element  //div[contains(@class,"pat-upload")]//button[contains(@class,"upload-all")]\n     Click item in column    3    3\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n-    Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    //div[contains(@class,"content-browser-position-wrapper")]\n     Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n     Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n \n@@ -224,20 +224,20 @@ I search and select an image via contentbrowser\n     Click item in column    2    1\n     Click item in column    3    2\n     Click item in column    4    1\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]\n-    Press Keys    xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]    Anot\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]\n+    Press Keys    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]    Anot\n     # here we need a timeout, because the search filter is not so fast like the testbrowser, it looks like a asynch operation\n     ${speed}    Get Selenium Speed\n     Set Selenium Speed    1 seconds\n     Click item in column    5    1\n     Set Selenium Speed    ${speed}\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n-    Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    //div[contains(@class,"content-browser-position-wrapper")]\n     Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n     Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n \n I save the document\n-    Click Button    xpath=//button[@id="form-buttons-save"]\n+    Click Button    //button[@id="form-buttons-save"]\n \n \n \n@@ -283,4 +283,4 @@ Element exists\n \n Click item in column\n     [arguments]  ${colnumber}    ${itemposition}\n-    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[${colnumber}]/div[contains(@class, "levelItems")]/div[${itemposition}]\n\\ No newline at end of file\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[${colnumber}]/div[contains(@class, "levelItems")]/div[${itemposition}]\n\\ No newline at end of file\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-16T18:13:39+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/7ba34ef0cd7b86d0a7a18e1ac6e8d97af8316a67

fix wrong "CTRL" click behavior on MacOS

Files changed:
M Products/CMFPlone/tests/robot/test_contentbrowser.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nindex 0c6f5fca05..0a74c88087 100644\n--- a/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -66,8 +66,8 @@ Scenario: search and select an image via contentbrowser\n       and a nested asset folder\n      When I search and select an image via contentbrowser\n       and I save the document\n-     Then the document contain the image by search       \n-      \n+     Then the document contain the image by search\n+\n \n *** Keywords *****************************************************************\n \n@@ -77,7 +77,7 @@ a nested asset folder\n     #\n     # + Assets\n     #  + Mixed\n-    #   - File1    \n+    #   - File1\n     #   - Image1\n     #   - Document1\n     #   - News Item1\n@@ -99,7 +99,7 @@ a nested asset folder\n     ${folder_files_uid}=  Create content    type=Folder    title=Files    container=${folder_mixed_uid}\n     Create content    type=File    title=File1    container=${folder_files_uid}\n     Create content    type=File    title=File2    container=${folder_files_uid}\n-    \n+\n     ${folder_images_uid}=  Create content    type=Folder    title=Images    container=${folder_files_uid}\n     Create content    type=Image    id=image-1    title=Image1    container=${folder_images_uid}\n     Create content    type=Image    id=image-2    title=Image2    container=${folder_images_uid}\n@@ -145,14 +145,13 @@ I select two related item images via contentbrowser\n    Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[5]\n    # Click third element in fourth column, that is the "Images" folder\n    Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[3]\n-   \n-   # now we select two items in a colum via CTRL+Click\n-   # Click second element in fifth column, that is the "Image1" Object\n-   Wait For Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[1]\n-   Click Element        //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[1]    CTRL\n-   # Click second element in fifth column, that is the "Image2" Object\n+\n+   # now we select two items in a colum via Shift+Click\n+   # Click first element in fifth column, that is the "Image1" Object\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[1]\n+   # Click second element in fifth column with SHIFT, that is the "Image2" Object\n    Wait For Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]\n-   Click Element        //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]    CTRL\n+   Click Element        //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]    SHIFT\n    # Click the select Button in the Toolbar of column 6\n    Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[6]/div[contains(@class, "levelToolbar")]/button\n \n@@ -187,8 +186,8 @@ I set an image via contentbrowser\n     UnSelect Frame\n     Click Button  //button[@aria-label="Insert/edit image"]\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click item in column    1    3    \n-    Click item in column    2    1    \n+    Click item in column    1    3\n+    Click item in column    2    1\n     Click item in column    3    1\n     Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Wait Until Element Is Not Visible    //div[contains(@class,"content-browser-position-wrapper")]\n@@ -202,7 +201,7 @@ I upload an image via contentbrowser\n     UnSelect Frame\n     Click Button  //button[@aria-label="Insert/edit image"]\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click item in column    1    3    \n+    Click item in column    1    3\n     Click item in column    2    1\n     Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]/button[contains(@class,"upload")]\n     Choose File    //div[contains(@class,"pat-upload")]//input[@class="dz-hidden-input"]    ${PATH_TO_TEST_FILES}/plone-logo.png\n@@ -241,16 +240,16 @@ I save the document\n \n \n \n-# --- THEN ------------------------------------------------------------------    \n+# --- THEN ------------------------------------------------------------------\n \n a image is selected as related item\n-    image is releated item    //div[contains(@class, "content-browser-selected-items")]/div[1]/img    /asset-folder/mixed/files/images/image-2/@@images/image/mini    \n+    image is releated item    //div[contains(@class, "content-browser-selected-items")]/div[1]/img    /asset-folder/mixed/files/images/image-2/@@images/image/mini\n \n \n two images are selected as related item\n-    image is releated item    //div[contains(@class, "content-browser-selected-items")]/div[1]/img    /asset-folder/mixed/files/images/image-1/@@images/image/mini    \n+    image is releated item    //div[contains(@class, "content-browser-selected-items")]/div[1]/img    /asset-folder/mixed/files/images/image-1/@@images/image/mini\n     image is releated item    //div[contains(@class, "content-browser-selected-items")]/div[2]/img    /asset-folder/mixed/files/images/image-2/@@images/image/mini\n-    \n+\n the document contain the internal link\n     Element exists    //div[@id="parent-fieldname-text"]//a    href    /plone/doc\n \n@@ -283,4 +282,4 @@ Element exists\n \n Click item in column\n     [arguments]  ${colnumber}    ${itemposition}\n-    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[${colnumber}]/div[contains(@class, "levelItems")]/div[${itemposition}]\n\\ No newline at end of file\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[${colnumber}]/div[contains(@class, "levelItems")]/div[${itemposition}]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-16T18:13:39+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/113ae2469cd36bfb4e93920fa1e659dff26a6a5b

Update editing relateditems field

Files changed:
M Products/CMFPlone/tests/robot/test_edit.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_edit.robot b/Products/CMFPlone/tests/robot/test_edit.robot\nindex 944595e38e..95cafeda71 100644\n--- a/Products/CMFPlone/tests/robot/test_edit.robot\n+++ b/Products/CMFPlone/tests/robot/test_edit.robot\n@@ -89,8 +89,12 @@ I click the ${tab} tab\n     Click link  ${tab}\n \n I select a related item\n-    Wait For Then Click Element  jquery=.pat-relateditems-container ul.select2-choices:visible\n-    Wait For Then Click Element  jquery=a.pat-relateditems-result-select:first\n+    # Click the select button\n+    Wait For Then Click Element  //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n+    # Click first element in first column\n+    Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[1]\n+    # Click the select Button in the Toolbar of column 2\n+    Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelToolbar")]/button\n \n I save the page\n    Click Button  Save\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-16T18:13:39+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/93b09400aa304f7749648351ffe90660b963b7e7

Add test for selecting an internal item in `Link` item with pat-contentbrowser

Files changed:
M Products/CMFPlone/tests/robot/test_edit.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_edit.robot b/Products/CMFPlone/tests/robot/test_edit.robot\nindex 95cafeda71..169b44418d 100644\n--- a/Products/CMFPlone/tests/robot/test_edit.robot\n+++ b/Products/CMFPlone/tests/robot/test_edit.robot\n@@ -15,8 +15,10 @@ Test Teardown  Run keywords  Plone Test Teardown\n *** Variables ****************************************************************\n \n ${TITLE}  An edited page\n+${LINK_TITLE}  An edited link item\n ${PAGE_ID}  an-edited-page\n-\n+${LINK_ID}  an-edited-link-item\n+${SELENIUM_RUN_ON_FAILURE}  Capture Page Screenshot and log source\n \n *** Test cases ***************************************************************\n \n@@ -62,6 +64,20 @@ Scenario: Form dropdowns follows DateTime widget values\n       and i select a date using the widget\n      Then form dropdowns should not have the default values anymore\n \n+Scenario: A link item is opened to edit\n+    Given a logged-in site administrator\n+      and an edited link item\n+     Then i have the title input field\n+      and i can only see the default tab\n+\n+Scenario: Add an internal link to linked item\n+    Given a logged-in site administrator\n+      and at least one other item\n+      and an edited link item\n+      and i select a linked item\n+      and i save the page\n+     Then the linked item is shown in the page\n+      and Capture page screenshot and log source\n \n *** Keywords *****************************************************************\n \n@@ -72,6 +88,11 @@ an edited page\n     Go to  ${PLONE_URL}/${PAGE_ID}/edit\n     Wait until page contains  Edit Page\n \n+an edited link item\n+    Create content  type=Link  title=${LINK_TITLE}\n+    Go to  ${PLONE_URL}/${LINK_ID}/edit\n+    Wait until page contains  Edit Link\n+\n \n # --- WHEN -------------------------------------------------------------------\n \n@@ -96,6 +117,15 @@ I select a related item\n     # Click the select Button in the Toolbar of column 2\n     Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelToolbar")]/button\n \n+I select a linked item\n+    # Click the select button\n+    Wait For Then Click Element  //div[@id="formfield-form-widgets-remoteUrl"]//button\n+    # Click first element in first column\n+    Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[1]\n+    # Click the select Button in the Toolbar of column 2\n+    # This selects the "test-folder"\n+    Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelToolbar")]/button\n+\n I save the page\n    Click Button  Save\n \n@@ -123,6 +153,10 @@ form dropdowns should not have the default values anymore\n the related item is shown in the page\n     Page should contain element  css=#section-related\n \n+the linked item is shown in the page\n+    # check if the selected testfolder is linked\n+    Page should contain element  xpath=//a[@href=\'${PLONE_URL}/test-folder\']\n+\n an overlay pops up\n     Wait Until Page Contains Element  xpath=//div[contains(@class, \'overlay\')]//input[@class=\'insertreference\']\n \n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-17T00:06:02+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/d070b26ecb1045c8d8d3a75cc1034d8b9009df4f

Fix test

Files changed:
M Products/CMFPlone/tests/robot/test_contentbrowser.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nindex 0a74c88087..1b73ba645f 100644\n--- a/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -71,6 +71,13 @@ Scenario: search and select an image via contentbrowser\n \n *** Keywords *****************************************************************\n \n+Pause\n+    [Documentation]  Visually pause test execution with interactive dialog by\n+    ...              importing **Dialogs**-library and calling its\n+    ...              **Pause Execution**-keyword.\n+    Import library  Dialogs\n+    Pause execution\n+\n # --- GIVEN ------------------------------------------------------------------\n \n a nested asset folder\n@@ -158,9 +165,7 @@ I select two related item images via contentbrowser\n \n I set an internal link via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n-    Select Frame  css=.tox-edit-area iframe\n-    Press Keys    //body[@id="tinymce"]    Susi Sorglos and John Doe\n-    UnSelect Frame\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n     Execute Javascript    function selectText() {\n     ...    var iframe_document = document.querySelector(".tox-edit-area iframe").contentDocument;\n     ...    var body = iframe_document.body;\n@@ -171,7 +176,9 @@ I set an internal link via contentbrowser\n     ...    iframe_document.getSelection().removeAllRanges();\n     ...    iframe_document.getSelection().addRange(range);\n     ...    }; selectText();\n-    Click Button  //button[@aria-label="Insert/edit link"]\n+    # hack for button behind sticky formcontrols on small screens\n+    Scroll Element Into View    //select[@name="form.widgets.IRichTextBehavior.text.mimeType"]\n+    Click Button    //button[@aria-label=\'Insert/edit link\']\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\n     Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n@@ -181,10 +188,10 @@ I set an internal link via contentbrowser\n \n I set an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n-    Select Frame  css=.tox-edit-area iframe\n-    Press Keys    //body[@id="tinymce"]    Susi Sorglos and John Doe\n-    UnSelect Frame\n-    Click Button  //button[@aria-label="Insert/edit image"]\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n+    # hack for button behind sticky formcontrols on small screens\n+    Scroll Element Into View    //select[@name="form.widgets.IRichTextBehavior.text.mimeType"]\n+    Click Button    //button[@aria-label=\'Insert/edit image\']\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\n     Click item in column    2    1\n@@ -196,9 +203,9 @@ I set an image via contentbrowser\n \n I upload an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n-    Select Frame  css=.tox-edit-area iframe\n-    Press Keys    //body[@id="tinymce"]    Susi Sorglos and John Doe\n-    UnSelect Frame\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n+    # hack for button behind sticky formcontrols on small screens\n+    Scroll Element Into View    //select[@name="form.widgets.IRichTextBehavior.text.mimeType"]\n     Click Button  //button[@aria-label="Insert/edit image"]\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\n@@ -214,9 +221,9 @@ I upload an image via contentbrowser\n \n I search and select an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n-    Select Frame  css=.tox-edit-area iframe\n-    Press Keys    //body[@id="tinymce"]    Susi Sorglos and John Doe\n-    UnSelect Frame\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n+    # hack for button behind sticky formcontrols on small screens\n+    Scroll Element Into View    //select[@name="form.widgets.IRichTextBehavior.text.mimeType"]\n     Click Button  //button[@aria-label="Insert/edit image"]\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\n@@ -265,6 +272,13 @@ the document contain the uploaded image\n \n #--- Helper DRY -------------------------------------------------------------\n \n+Fill text to tinymce editor\n+    [arguments]    ${text}\n+    Wait Until Element Is Visible    css=.tox-edit-area iframe\n+    Select Frame    css=.tox-edit-area iframe\n+    Input Text    //body[@id="tinymce"]    ${text}\n+    UnSelect Frame\n+\n image is releated item\n     [arguments]    ${xpath}    ${imagepath}\n     Element exists    ${xpath}    src    ${imagepath}\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-17T00:06:36+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/2c4ce674608a93ce686a4ac45fea9be265b34fe6

remove unused keyword

Files changed:
M Products/CMFPlone/tests/robot/test_contentbrowser.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nindex 1b73ba645f..847d4ea181 100644\n--- a/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -71,13 +71,6 @@ Scenario: search and select an image via contentbrowser\n \n *** Keywords *****************************************************************\n \n-Pause\n-    [Documentation]  Visually pause test execution with interactive dialog by\n-    ...              importing **Dialogs**-library and calling its\n-    ...              **Pause Execution**-keyword.\n-    Import library  Dialogs\n-    Pause execution\n-\n # --- GIVEN ------------------------------------------------------------------\n \n a nested asset folder\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-18T09:27:47+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/048e2d94c2218d6d27219245b3e53e4efeafaaec

remove unneeded hack

Files changed:
M Products/CMFPlone/tests/robot/test_contentbrowser.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nindex 847d4ea181..577fbf2b32 100644\n--- a/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -169,8 +169,6 @@ I set an internal link via contentbrowser\n     ...    iframe_document.getSelection().removeAllRanges();\n     ...    iframe_document.getSelection().addRange(range);\n     ...    }; selectText();\n-    # hack for button behind sticky formcontrols on small screens\n-    Scroll Element Into View    //select[@name="form.widgets.IRichTextBehavior.text.mimeType"]\n     Click Button    //button[@aria-label=\'Insert/edit link\']\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\n@@ -182,8 +180,6 @@ I set an internal link via contentbrowser\n I set an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n     Fill text to tinymce editor    Susi Sorglos and John Doe\n-    # hack for button behind sticky formcontrols on small screens\n-    Scroll Element Into View    //select[@name="form.widgets.IRichTextBehavior.text.mimeType"]\n     Click Button    //button[@aria-label=\'Insert/edit image\']\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\n@@ -197,8 +193,6 @@ I set an image via contentbrowser\n I upload an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n     Fill text to tinymce editor    Susi Sorglos and John Doe\n-    # hack for button behind sticky formcontrols on small screens\n-    Scroll Element Into View    //select[@name="form.widgets.IRichTextBehavior.text.mimeType"]\n     Click Button  //button[@aria-label="Insert/edit image"]\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\n@@ -215,8 +209,6 @@ I upload an image via contentbrowser\n I search and select an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n     Fill text to tinymce editor    Susi Sorglos and John Doe\n-    # hack for button behind sticky formcontrols on small screens\n-    Scroll Element Into View    //select[@name="form.widgets.IRichTextBehavior.text.mimeType"]\n     Click Button  //button[@aria-label="Insert/edit image"]\n     Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-09-20T11:52:40+02:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/68ba21849d61d335261c1efcb642aa0041137c94

Merge pull request #4008 from plone/1letter-pat-contentbrowser-robot-tests

Fix robot tests and new robot tests for new pat-contentbrowser pattern

Files changed:
A Products/CMFPlone/tests/robot/test_contentbrowser.robot
A news/3980.bugfix
M Products/CMFPlone/tests/robot/test_edit.robot
M Products/CMFPlone/tests/robot/test_linkintegrity.robot
M Products/CMFPlone/tests/robot/test_tinymce.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nnew file mode 100644\nindex 0000000000..577fbf2b32\n--- /dev/null\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -0,0 +1,284 @@\n+*** Settings *****************************************************************\n+\n+Resource  plone/app/robotframework/keywords.robot\n+Resource  plone/app/robotframework/saucelabs.robot\n+Resource  plone/app/robotframework/selenium.robot\n+Resource  keywords.robot\n+\n+Library  Remote  ${PLONE_URL}/RobotRemote\n+\n+Variables  Products/CMFPlone/tests/robot/variables.py\n+\n+# use this for a ful browser window if you develop the tests\n+# Test Setup  Run keywords  Plone Test Setup    Maximize Browser Window\n+Test Setup  Run keywords  Plone Test Setup\n+Test Teardown  Run keywords  Plone Test Teardown\n+\n+*** Variables ***\n+\n+${ASSET_FOLDER}    asset-folder\n+${DOCUMENT_ID}    doc\n+\n+*** Test cases ***************************************************************\n+\n+\n+Scenario: Select a related Item\n+     Given a logged-in site administrator\n+       and a document\n+       and a nested asset folder\n+      When I select a related item image via contentbrowser\n+      Then a image is selected as related item\n+\n+Scenario: Select more than one related Items\n+    Given a logged-in site administrator\n+      and a document\n+      and a nested asset folder\n+     When I select two related item images via contentbrowser\n+     Then two images are selected as related item\n+\n+Scenario: add an internal Link via contentbrowser\n+    Given a logged-in site administrator\n+      and a document\n+      and a nested asset folder\n+     When I set an internal link via contentbrowser\n+      and I save the document\n+     Then the document contain the internal link\n+\n+Scenario: add an image via contentbrowser\n+    Given a logged-in site administrator\n+      and a document\n+      and a nested asset folder\n+     When I set an image via contentbrowser\n+      and I save the document\n+     Then the document contain the image\n+\n+Scenario: upload an image via contentbrowser\n+    Given a logged-in site administrator\n+      and a document\n+      and a nested asset folder\n+     When I upload an image via contentbrowser\n+      and I save the document\n+     Then the document contain the uploaded image\n+\n+Scenario: search and select an image via contentbrowser\n+    Given a logged-in site administrator\n+      and a document\n+      and a nested asset folder\n+     When I search and select an image via contentbrowser\n+      and I save the document\n+     Then the document contain the image by search\n+\n+\n+*** Keywords *****************************************************************\n+\n+# --- GIVEN ------------------------------------------------------------------\n+\n+a nested asset folder\n+    #\n+    # + Assets\n+    #  + Mixed\n+    #   - File1\n+    #   - Image1\n+    #   - Document1\n+    #   - News Item1\n+    #   + Files\n+    #    - File1\n+    #    - File2\n+    #    + Images\n+    #     - Image1\n+    #     - Image2\n+    #\n+    ${folder_assets_uid}=  Create content    type=Folder    title=Assets    id=${ASSET_FOLDER}\n+\n+    ${folder_mixed_uid}=  Create content    type=Folder    title=Mixed    container=${folder_assets_uid}\n+    Create content    type=File    title=File1    container=${folder_mixed_uid}\n+    Create content    type=Image    title=Image1    container=${folder_mixed_uid}\n+    Create content    type=Document    title=Document1    container=${folder_mixed_uid}\n+    Create content    type=News Item    title=News Item1    container=${folder_mixed_uid}\n+\n+    ${folder_files_uid}=  Create content    type=Folder    title=Files    container=${folder_mixed_uid}\n+    Create content    type=File    title=File1    container=${folder_files_uid}\n+    Create content    type=File    title=File2    container=${folder_files_uid}\n+\n+    ${folder_images_uid}=  Create content    type=Folder    title=Images    container=${folder_files_uid}\n+    Create content    type=Image    id=image-1    title=Image1    container=${folder_images_uid}\n+    Create content    type=Image    id=image-2    title=Image2    container=${folder_images_uid}\n+    Create content    type=Image    id=image-3    title=My Image    container=${folder_images_uid}\n+    Create content    type=Image    id=image-4    title=Another Image    container=${folder_images_uid}\n+\n+a document\n+    Create content  type=Document  id=${DOCUMENT_ID}    title=My Page\n+\n+# --- WHEN ------------------------------------------------------------------\n+\n+I select a related item image via contentbrowser\n+   Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n+   # Click the Categorization Tab\n+   Wait For Then Click Element    //a[@id="autotoc-item-autotoc-2"]\n+   # Click the select button\n+   Wait For Then Click Element    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n+   # Click third element in first column, that is the "Assets" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[4]\n+   # Click first element in second column, that is the "Mixed" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n+   # Click fifth element in third column, that is the "Files" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[5]\n+   # Click third element in fourth column, that is the "Images" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[3]\n+   # Click second element in fifth column, that is the "Image2" Object\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]\n+   # Click the select Button in the Toolbar of column 6\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[6]/div[contains(@class, "levelToolbar")]/button\n+\n+\n+I select two related item images via contentbrowser\n+   Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n+   # Click the Categorization Tab\n+   Wait For Then Click Element    //a[@id="autotoc-item-autotoc-2"]\n+   # Click the select button\n+   Wait For Then Click Element    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n+   # Click third element in first column, that is the "Assets" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[4]\n+   # Click first element in second column, that is the "Mixed" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n+   # Click fifth element in third column, that is the "Files" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[5]\n+   # Click third element in fourth column, that is the "Images" folder\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[3]\n+\n+   # now we select two items in a colum via Shift+Click\n+   # Click first element in fifth column, that is the "Image1" Object\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[1]\n+   # Click second element in fifth column with SHIFT, that is the "Image2" Object\n+   Wait For Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]\n+   Click Element        //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]    SHIFT\n+   # Click the select Button in the Toolbar of column 6\n+   Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[6]/div[contains(@class, "levelToolbar")]/button\n+\n+\n+I set an internal link via contentbrowser\n+    Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n+    Execute Javascript    function selectText() {\n+    ...    var iframe_document = document.querySelector(".tox-edit-area iframe").contentDocument;\n+    ...    var body = iframe_document.body;\n+    ...    var p = body.firstChild;\n+    ...    var range = new Range();\n+    ...    range.setStart(p.firstChild, 5);\n+    ...    range.setEnd(p.firstChild, 12);\n+    ...    iframe_document.getSelection().removeAllRanges();\n+    ...    iframe_document.getSelection().addRange(range);\n+    ...    }; selectText();\n+    Click Button    //button[@aria-label=\'Insert/edit link\']\n+    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+    Click item in column    1    3\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    //div[contains(@class,"content-browser-position-wrapper")]\n+    Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n+    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n+\n+I set an image via contentbrowser\n+    Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n+    Click Button    //button[@aria-label=\'Insert/edit image\']\n+    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+    Click item in column    1    3\n+    Click item in column    2    1\n+    Click item in column    3    1\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    //div[contains(@class,"content-browser-position-wrapper")]\n+    Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n+    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n+\n+I upload an image via contentbrowser\n+    Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n+    Click Button  //button[@aria-label="Insert/edit image"]\n+    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+    Click item in column    1    3\n+    Click item in column    2    1\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]/button[contains(@class,"upload")]\n+    Choose File    //div[contains(@class,"pat-upload")]//input[@class="dz-hidden-input"]    ${PATH_TO_TEST_FILES}/plone-logo.png\n+    Wait For Then Click Element  //div[contains(@class,"pat-upload")]//button[contains(@class,"upload-all")]\n+    Click item in column    3    3\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    //div[contains(@class,"content-browser-position-wrapper")]\n+    Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n+    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n+\n+I search and select an image via contentbrowser\n+    Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n+    Click Button  //button[@aria-label="Insert/edit image"]\n+    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+    Click item in column    1    3\n+    Click item in column    2    1\n+    Click item in column    3    2\n+    Click item in column    4    1\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]\n+    Press Keys    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]    Anot\n+    # here we need a timeout, because the search filter is not so fast like the testbrowser, it looks like a asynch operation\n+    ${speed}    Get Selenium Speed\n+    Set Selenium Speed    1 seconds\n+    Click item in column    5    1\n+    Set Selenium Speed    ${speed}\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    //div[contains(@class,"content-browser-position-wrapper")]\n+    Wait For Then Click Element    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n+    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n+\n+I save the document\n+    Click Button    //button[@id="form-buttons-save"]\n+\n+\n+\n+# --- THEN ------------------------------------------------------------------\n+\n+a image is selected as related item\n+    image is releated item    //div[contains(@class, "content-browser-selected-items")]/div[1]/img    /asset-folder/mixed/files/images/image-2/@@images/image/mini\n+\n+\n+two images are selected as related item\n+    image is releated item    //div[contains(@class, "content-browser-selected-items")]/div[1]/img    /asset-folder/mixed/files/images/image-1/@@images/image/mini\n+    image is releated item    //div[contains(@class, "content-browser-selected-items")]/div[2]/img    /asset-folder/mixed/files/images/image-2/@@images/image/mini\n+\n+the document contain the internal link\n+    Element exists    //div[@id="parent-fieldname-text"]//a    href    /plone/doc\n+\n+the document contain the image\n+    rendered textfield contain the image with title    Image1\n+\n+the document contain the image by search\n+    rendered textfield contain the image with title    Another Image\n+\n+the document contain the uploaded image\n+    rendered textfield contain the image with title    plone-logo.png\n+\n+\n+#--- Helper DRY -------------------------------------------------------------\n+\n+Fill text to tinymce editor\n+    [arguments]    ${text}\n+    Wait Until Element Is Visible    css=.tox-edit-area iframe\n+    Select Frame    css=.tox-edit-area iframe\n+    Input Text    //body[@id="tinymce"]    ${text}\n+    UnSelect Frame\n+\n+image is releated item\n+    [arguments]    ${xpath}    ${imagepath}\n+    Element exists    ${xpath}    src    ${imagepath}\n+\n+rendered textfield contain the image with title\n+    [arguments]  ${imagetitle}\n+    Element exists    //div[@id="parent-fieldname-text"]//picture/img    title    ${imagetitle}\n+\n+Element exists\n+    [arguments]  ${xpath}    ${attr}    ${value}\n+    ${element}=    Set Variable    ${xpath}\n+    Element Should Be Visible    ${element}\n+    ${_attr}=  Get Element Attribute    ${element}    ${attr}\n+    Should End With    ${_attr}    ${value}\n+\n+Click item in column\n+    [arguments]  ${colnumber}    ${itemposition}\n+    Wait For Then Click Element  //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[${colnumber}]/div[contains(@class, "levelItems")]/div[${itemposition}]\ndiff --git a/Products/CMFPlone/tests/robot/test_edit.robot b/Products/CMFPlone/tests/robot/test_edit.robot\nindex 944595e38e..169b44418d 100644\n--- a/Products/CMFPlone/tests/robot/test_edit.robot\n+++ b/Products/CMFPlone/tests/robot/test_edit.robot\n@@ -15,8 +15,10 @@ Test Teardown  Run keywords  Plone Test Teardown\n *** Variables ****************************************************************\n \n ${TITLE}  An edited page\n+${LINK_TITLE}  An edited link item\n ${PAGE_ID}  an-edited-page\n-\n+${LINK_ID}  an-edited-link-item\n+${SELENIUM_RUN_ON_FAILURE}  Capture Page Screenshot and log source\n \n *** Test cases ***************************************************************\n \n@@ -62,6 +64,20 @@ Scenario: Form dropdowns follows DateTime widget values\n       and i select a date using the widget\n      Then form dropdowns should not have the default values anymore\n \n+Scenario: A link item is opened to edit\n+    Given a logged-in site administrator\n+      and an edited link item\n+     Then i have the title input field\n+      and i can only see the default tab\n+\n+Scenario: Add an internal link to linked item\n+    Given a logged-in site administrator\n+      and at least one other item\n+      and an edited link item\n+      and i select a linked item\n+      and i save the page\n+     Then the linked item is shown in the page\n+      and Capture page screenshot and log source\n \n *** Keywords *****************************************************************\n \n@@ -72,6 +88,11 @@ an edited page\n     Go to  ${PLONE_URL}/${PAGE_ID}/edit\n     Wait until page contains  Edit Page\n \n+an edited link item\n+    Create content  type=Link  title=${LINK_TITLE}\n+    Go to  ${PLONE_URL}/${LINK_ID}/edit\n+    Wait until page contains  Edit Link\n+\n \n # --- WHEN -------------------------------------------------------------------\n \n@@ -89,8 +110,21 @@ I click the ${tab} tab\n     Click link  ${tab}\n \n I select a related item\n-    Wait For Then Click Element  jquery=.pat-relateditems-container ul.select2-choices:visible\n-    Wait For Then Click Element  jquery=a.pat-relateditems-result-select:first\n+    # Click the select button\n+    Wait For Then Click Element  //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n+    # Click first element in first column\n+    Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[1]\n+    # Click the select Button in the Toolbar of column 2\n+    Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelToolbar")]/button\n+\n+I select a linked item\n+    # Click the select button\n+    Wait For Then Click Element  //div[@id="formfield-form-widgets-remoteUrl"]//button\n+    # Click first element in first column\n+    Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[1]\n+    # Click the select Button in the Toolbar of column 2\n+    # This selects the "test-folder"\n+    Wait For Then Click Element    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelToolbar")]/button\n \n I save the page\n    Click Button  Save\n@@ -119,6 +153,10 @@ form dropdowns should not have the default values anymore\n the related item is shown in the page\n     Page should contain element  css=#section-related\n \n+the linked item is shown in the page\n+    # check if the selected testfolder is linked\n+    Page should contain element  xpath=//a[@href=\'${PLONE_URL}/test-folder\']\n+\n an overlay pops up\n     Wait Until Page Contains Element  xpath=//div[contains(@class, \'overlay\')]//input[@class=\'insertreference\']\n \ndiff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex b0c6fa4dbb..b45dc121ac 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -21,6 +21,10 @@ Resource  keywords.robot\n Test Setup  Run keywords  Plone Test Setup\n Test Teardown  Run keywords  Plone Test Teardown\n \n+*** Variables ****************************************************************\n+\n+${SELENIUM_RUN_ON_FAILURE}  Capture page screenshot and log source\n+\n \n *** Test Cases ***************************************************************\n \n@@ -74,18 +78,17 @@ a link in rich text\n   Input text  css=.mce-content-body  foo\n   Execute Javascript    function selectElementContents(el) {var range = document.createRange(); range.selectNodeContents(el); var sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);} var el = document.getElementById("tinymce"); selectElementContents(el);\n   UnSelect Frame\n-  Click Button  css=button[aria-label="Insert/edit link"]\n \n-  Given patterns are loaded\n-  Wait until element is visible  css=.pat-relateditems .select2-input.select2-default\n-  Click Element  css=.pat-relateditems .select2-input.select2-default\n-  Wait until element is visible  css=.pat-relateditems-result.one-level-up a.pat-relateditems-result-browse\n-  Click Element  css=.pat-relateditems-result.one-level-up a.pat-relateditems-result-browse\n-  Wait until element is visible  xpath=(//span[contains(., \'Foo\')])\n-  Sleep  2s\n-  Click Element  xpath=(//span[contains(., \'Foo\')])\n-  Wait until element is visible  css=.pat-relateditems-item-title\n-  Wait For Then Click Element  css=.modal-footer .btn-primary\n+  Click Button  css=button[aria-label="Insert/edit link"]\n+  Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+  Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n+  Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+  Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n+  Wait For Then Click Element  css=.modal-footer input[name="insert"]\n+  Select Frame  css=.tox-edit-area iframe\n+  Execute Javascript  window.getSelection().removeAllRanges()\n+  UnSelect Frame\n+  Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n   Wait For Then Click Element  css=#form-buttons-save\n \n \ndiff --git a/Products/CMFPlone/tests/robot/test_tinymce.robot b/Products/CMFPlone/tests/robot/test_tinymce.robot\nindex 75eb8d00c7..69eb813598 100644\n--- a/Products/CMFPlone/tests/robot/test_tinymce.robot\n+++ b/Products/CMFPlone/tests/robot/test_tinymce.robot\n@@ -47,19 +47,26 @@ an uploaded image\n text inserted into wysiwyg\n     Wait Until Element Is Visible  css=.tox-edit-area iframe\n     Select Frame  css=.tox-edit-area iframe\n-    Input text  css=.mce-content-body  foobar\n+    Press Keys    //body[@id="tinymce"]    Susi Sorglos and John Doe\n     UnSelect Frame\n \n insert link\n-    Select Frame  css=.tox-edit-area iframe\n-    Execute Javascript    function selectElementContents(el) {var range = document.createRange(); range.selectNodeContents(el); var sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(range);} var el = document.getElementById("tinymce"); selectElementContents(el);\n-    UnSelect Frame\n+    Execute Javascript    function selectText() {\n+    ...    var iframe_document = document.querySelector(".tox-edit-area iframe").contentDocument;\n+    ...    var body = iframe_document.body;\n+    ...    var p = body.firstChild;\n+    ...    var range = new Range();\n+    ...    range.setStart(p.firstChild, 5);\n+    ...    range.setEnd(p.firstChild, 12);\n+    ...    iframe_document.getSelection().removeAllRanges();\n+    ...    iframe_document.getSelection().addRange(range);\n+    ...    }; selectText();\n     Click Button  css=button[aria-label="Insert/edit link"]\n-    Click Button  css=.pat-relateditems-container button.favorites\n-    Click Link  css=.pat-relateditems-container .favorites a.fav[href=\'/\']\n-    Wait Until Element Is Visible  css=.pat-relateditems-result-select.selectable\n-    Click Link  css=.pat-relateditems-result-select.selectable\n-    Click Button  css=.modal-footer input[name="insert"]\n+    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n+    Wait For Then Click Element  css=.modal-footer input[name="insert"]\n     Select Frame  css=.tox-edit-area iframe\n     Execute Javascript  window.getSelection().removeAllRanges()\n     UnSelect Frame\n@@ -67,11 +74,12 @@ insert link\n \n insert image\n     Click Button  css=button[aria-label="Insert/edit image"]\n-    Click Button  css=.pat-relateditems-container button.favorites\n-    Click Link  css=.pat-relateditems-container .favorites a.fav[href=\'/\']\n-    Wait Until Element Is Visible  css=.pat-relateditems-result-select.selectable\n-    Click Link  css=.pat-relateditems-result-select.selectable\n+    Wait For Then Click Element  css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n+    Capture Page Screenshot\n+    Wait For Then Click Element  xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Wait Until Element Is Not Visible    xpath=//div[contains(@class,"content-browser-position-wrapper")]\n     Input Text  css=.modal-body [name="title"]  SomeTitle\n     Input Text  css=.modal-body [name="alt"]  SomeAlt\n     Click Button  css=.modal-footer input[name="insert"]\n-    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n+    Wait Until Element Is Not Visible  css=.modal-footer input[name="insert"]\n\\ No newline at end of file\ndiff --git a/news/3980.bugfix b/news/3980.bugfix\nnew file mode 100644\nindex 0000000000..db21c66371\n--- /dev/null\n+++ b/news/3980.bugfix\n@@ -0,0 +1,6 @@\n+Update robot tests for new `pat-contentbrowser` pattern.\n+[petschki]\n+\n+- Make tests more robust for new `pat-contentbrowser` pattern.\n+- add more robot tests for `pat-contentbrowser` pattern.\n+[1letter]\n'

