Repository: plone.app.portlets


Branch: refs/heads/4.4.x
Date: 2021-06-30T00:49:11+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.portlets/commit/4e5cd8e47ef3d73edb50e7affdc4c4a9c1053524

Only allow http and https urls in RSS portlet.

From Products.PloneHotfix20210518.
See https://plone.org/security/hotfix/20210518/blind-ssrf-via-feedparser-accessing-an-internal-url

Files changed:
A news/3274.bugfix
A plone/app/portlets/tests/atom_feed_maurits.xml
M plone/app/portlets/portlets/rss.py
M plone/app/portlets/tests/test_rss_portlet.py

b'diff --git a/news/3274.bugfix b/news/3274.bugfix\nnew file mode 100644\nindex 00000000..f391a821\n--- /dev/null\n+++ b/news/3274.bugfix\n@@ -0,0 +1,3 @@\n+Only allow http and https urls in RSS portlet.\n+From `Products.PloneHotfix20210518 <https://plone.org/security/hotfix/20210518/blind-ssrf-via-feedparser-accessing-an-internal-url>`_.\n+[maurits]\ndiff --git a/plone/app/portlets/portlets/rss.py b/plone/app/portlets/portlets/rss.py\nindex 9cdfe110..bae430ca 100644\n--- a/plone/app/portlets/portlets/rss.py\n+++ b/plone/app/portlets/portlets/rss.py\n@@ -11,6 +11,13 @@\n import feedparser\n import time\n \n+try:\n+    # Py 3\n+    from urllib.parse import urlparse\n+except ImportError:\n+    # Py 2\n+    from urlparse import urlparse\n+\n \n # Accept these bozo_exceptions encountered by feedparser when parsing\n # the feed:\n@@ -153,6 +160,13 @@ def _buildItemDict(self, item):\n     def _retrieveFeed(self):\n         """do the actual work and try to retrieve the feed"""\n         url = self.url\n+        if url:\n+            if len(url.splitlines()) > 1:\n+                # More than one line in a url: probably a hacker.\n+                url = ""\n+            elif urlparse(url).scheme not in ("https", "http"):\n+                # Mostly: prevent loading local file: urls.\n+                url = ""\n         if url != \'\':\n             self._last_update_time_in_minutes = time.time() / 60\n             self._last_update_time = DateTime()\ndiff --git a/plone/app/portlets/tests/atom_feed_maurits.xml b/plone/app/portlets/tests/atom_feed_maurits.xml\nnew file mode 100644\nindex 00000000..7655d714\n--- /dev/null\n+++ b/plone/app/portlets/tests/atom_feed_maurits.xml\n@@ -0,0 +1,1520 @@\n+<?xml version="1.0" ?>\n+<?xml-stylesheet href="atom.css" type="text/css"?>\n+\n+<feed xmlns="http://www.w3.org/2005/Atom"\n+      xmlns:atom="http://www.w3.org/2005/Atom"\n+      xmlns:dc="http://purl.org/dc/elements/1.1/"\n+      xml:base="https://maurits.vanrees.org" xml:lang="en">\n+  <link rel="self"\n+        href="https://maurits.vanrees.org/weblog/topics/plone/@@atom.xml" />\n+  <div xmlns="http://www.w3.org/1999/xhtml">\n+    <a href="http://www.atomenabled.org/feedvalidator/check.cgi?url=https://maurits.vanrees.org/weblog/atom.xml">\n+      <img title="Validate my Atom feed" width="88"\n+           height="31"\n+           src="http://www.atomenabled.org/feedvalidator/images/valid-atom.png"\n+           alt="[Valid Atom]" border="0px" />\n+    </a>\n+    <p>\n+      <span>\n+        This is an Atom formatted XML site feed. It is intended to be viewed in\n+        a Newsreader or syndicated to another site. Please visit\n+      </span>\n+      <a href="http://www.atomenabled.org/">Atom Enabled</a>\n+      <span>\n+        for more info.\n+      </span>\n+    </p>\n+  </div>\n+\n+  <title type="html">Weblog</title>\n+\n+\n+  <updated>2021-01-05T10:33:42+00:00</updated>\n+\n+  <link href="https://maurits.vanrees.org/weblog"\n+        rel="alternate" type="text/html" />\n+\n+\n+\n+  <id>urn:syndication:3a1d81067fb16b9d671c9ee4a6efa204</id>\n+\n+  <generator uri="http://plone.org/products/fatsyndication/" version="0.1">fatsyndication</generator>\n+\n+\n+\n+    <entry>\n+\n+      <title>Philip Bauer: Growing Pains: PosKeyErrors and Other Malaises</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/philip-bauer-growing-pains-poskeyerrors-and-other-malaises" />\n+\n+\n+\n+      <id>urn:syndication:a2e343ca7c1c64182bc128b9a4f0be0b</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>This talk is about the issues that you face when your project grows, the code base grows, the database grows, the problems grow.\n+This is about the causes and some of the remedies.</p>\n+<div class="section" id="symptom-1-huge-database">\n+<h3><a name="symptom-1-huge-database">Symptom 1: huge database</a></h3>\n+<p>Cause 1: a huge number of revisions or versions.</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Remove all versions and pack the database. When you migrate to a new Plone version, and you ask your client, they will usually be okay with this.</li>\n+<li>Manage or limit revisions. Easiest is to use <a class="reference" href="https://github.com/collective/collective.revisionmanager">collective.revisionmanager</a> for this. Especially, revisions may have been left behind for content that no longer exists. You can easily remove it with this tool.</li>\n+<li>Disable versioning of Files. It is disabled by default, but maybe someone has switched it on.</li>\n+<li>Enable manual versioning instead of automatic. Then the editor needs to check a box when they make a major change that they want to be able to rollback.</li>\n+</ul>\n+<p>Cause 2: no packing.</p>\n+<p>Remedy: just pack it. Use the <tt class="docutils literal"><span class="pre">zeopack</span></tt> script, which part of <tt class="docutils literal"><span class="pre">plone.recipe.zeoserver</span></tt>. Add a cronjob for this, weekly seems best for most sites.</p>\n+<p>Cause 3: unused content.</p>\n+<p>Remedy: delete it. You have to find it first.\n+Of course no code can tell you which content is safe to delete.\n+You could use <tt class="docutils literal"><span class="pre">statistics.py</span></tt> from <a class="reference" href="https://github.com/collective/collective.migrationhelpers">collective.migrationhelpers</a> to get an idea of where which content is.</p>\n+<p>Cause 4: the SearchableText index is huge</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Use solr or elasticsearch and possibly remove the <tt class="docutils literal"><span class="pre">SearchableText</span></tt> index.</li>\n+<li>Don\'t index files. They are converted to text, but this may not be needed for your site.</li>\n+</ul>\n+<p>Cause 5: large blobs\n+For example, plone.de had a Linux <tt class="docutils literal"><span class="pre">iso</span></tt> image, which was huge.</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Limit the upload size. You could do this in nginx/apache. Archetypes had something, you can likely do this in Dexterity too.</li>\n+<li>Get stats and remove or replace too large items.</li>\n+</ul>\n+<p>Cause 6: aborted uploads (rare)</p>\n+<p>Remedy: check <tt class="docutils literal"><span class="pre">IAnnotations(portal).get(\'file_upload_map\')</span></tt>.</p>\n+</div>\n+<div class="section" id="symptom-2-slow-site">\n+<h3><a name="symptom-2-slow-site">Symptom 2: slow site</a></h3>\n+<p>Cause 1: unneeded full renders of content</p>\n+<p>Remedy: use Python in page templates.\n+By default, page templates use path expressions like this: <tt class="docutils literal"><span class="pre">tal:define=&quot;foo</span> <span class="pre">context/foo&quot;</span></tt>.\n+But this tries to render&nbsp; foo as html if possible.\n+Use <tt class="docutils literal"><span class="pre">foo</span> <span class="pre">python:context.foo</span></tt> instead.</p>\n+<p>Cause 2: wake up many objects</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Always try to use brains and metadata. The difference is huge, also with Dexterity.</li>\n+<li>Listing 3000 brains: 0.2 seconds</li>\n+<li>Listing 3000 objects: 2 seconds</li>\n+<li>Same is true for Volto when you use the search-endpoint with <tt class="docutils literal"><span class="pre">fullobjects</span></tt>.</li>\n+</ul>\n+<p>Of course most page templates in Plone will not list thousands of objects, but will be paginated.\n+Still: just use brains, they are so much tastier.</p>\n+<p>Cause 3: no caching</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Switch on the built-in caching</li>\n+<li>Add varnish</li>\n+<li>Manage the zeocache (that is a bit of science, ask the community)</li>\n+<li>Use <tt class="docutils literal"><span class="pre">memoize</span></tt> in your code.</li>\n+</ul>\n+<p>Cause 4: hardware</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Don\'t be cheap.</li>\n+<li>Buy enough ram to keep the database in memory.</li>\n+<li>Remember that your consulting time probably costs more than buying better hardware would.</li>\n+</ul>\n+<p>Cause 5: slow code</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Learn and use profiling. A very handy toy for that is <a class="reference" href="https://pypi.org/project/py-spy/">py-spy</a>. Sample use: <tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">py-spy</span> <span class="pre">top</span> <span class="pre">--pid</span> <span class="pre">12345</span></tt></li>\n+<li>Do not call methods multiple times from templates. Call them once, store the result, and use this.</li>\n+</ul>\n+<p>Cause 6: slow data sources</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>decouple, for example using redis or celery</li>\n+<li>Use your choice of async implementations</li>\n+<li>Use lazyloading of images if they come from outside of your Plone site.</li>\n+</ul>\n+</div>\n+<div class="section" id="symptom-3-conflict-errors">\n+<h3><a name="symptom-3-conflict-errors">Symptom 3: conflict errors</a></h3>\n+<p>Conflict errors happen when two requests work at the same time and both change the same object.\n+This is complicated, but Zope and the ZODB have built-in conflict resolution.</p>\n+<p>Cause 1: conflict resolving is not enabled.\n+The zeoserver needs access to the same code that your zeoclient has, otherwise conflicts cannot be resolved and the transaction will be aborted.</p>\n+<p>Remedy: add all application code to the zeoserver:</p>\n+<pre class="literal-block">\n+[zeoserver]\n+eggs = ${buildout:eggs}\n+</pre>\n+<p>Cause 2: long running requests change data</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Prevent writes.</li>\n+<li>If it takes long, do intermediate commits when possible.</li>\n+<li>Prevent crossfire: disable cronjobs and editors when a long request needs to run.</li>\n+<li>Use async. Talk to Asko about that probably.</li>\n+</ul>\n+</div>\n+<div class="section" id="symptom-4-poskeyerrors">\n+<h3><a name="symptom-4-poskeyerrors">Symptom 4: PosKeyErrors</a></h3>\n+<p>Cause 1: missing blobs</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Copy all blobs of course.</li>\n+<li>Use <a class="reference" href="https://pypi.org/project/experimental.gracefulblobmissing/">experimental.gracefulblobmissing</a> in development to create dummy blobs where needed.</li>\n+<li>Find and delete afflicted content in a browser view.</li>\n+<li>There can be cases when you have two zeoclients and the syncing does not work well. Talk to Alessandro about that.</li>\n+</ul>\n+</div>\n+<div class="section" id="symptom-5-broken-data">\n+<h3><a name="symptom-5-broken-data">Symptom 5: broken data</a></h3>\n+<p>Now for the really interesting part.\n+These are errors like:</p>\n+<pre class="literal-block">\n+ModuleNotFoundError\n+AttributeError\n+ImportError\n+PostKeyError\n+BrokenObject\n+</pre>\n+<p>I could read you my whole blog post about <a class="reference" href="https://www.starzel.de/blog/zodb-debugging">zodb debugging</a>.</p>\n+<p>Cause 1: code to unpickle som data is missing</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Ignore the errors, if normal operation still works, and the site only has to stay up for a limited time, because <tt class="docutils literal"><span class="pre">zeopack</span></tt> probably also fails.</li>\n+<li>Fix it with a <a class="reference" href="https://github.com/zopefoundation/zodbupdate#id4">rename_dict</a>. See <a class="reference" href="https://github.com/zestsoftware/zest.zodbupdate">zest.zodbupdate</a> for some examples that are actually really useful. [Thanks! MvR]</li>\n+<li>Work around it with an <tt class="docutils literal"><span class="pre">alias_module</span></tt> patch, like <tt class="docutils literal"><span class="pre">plone.app.upgrade</span></tt> does in several cases. Then imports can work again.</li>\n+<li>Find out what and where broken objects are and then fix or remove them safely. Use <a class="reference" href="https://pypi.org/project/zodbverify/">zodbverify</a>.</li>\n+</ul>\n+<p>Steps for the last one:</p>\n+<ul class="simple">\n+<li>Call <tt class="docutils literal"><span class="pre">bin/zodbverify</span> <span class="pre">-f</span> <span class="pre">var/filestorage/Data.fs</span></tt> to get all broken objects.</li>\n+<li>Pick one error type at a time, with an oid (object id) that has a problem.</li>\n+<li>Call <tt class="docutils literal"><span class="pre">bin/zodbverify</span> <span class="pre">-f</span> <span class="pre">var/filestorage/Data.fs</span> <span class="pre">-o</span> <span class="pre">&lt;oid&gt;</span> <span class="pre">-D</span></tt> to inspect one object and find out where it is referenced.</li>\n+<li>For the extra options, you should use the branch from my <a class="reference" href="https://github.com/plone/zodbverify/pull/8">pull request</a>, which I still have not finished yet, but it runs fine.</li>\n+<li>Remove or fix the object.</li>\n+<li>Important: make notes, write upgrade steps, keep the terminal log, because you will forget it and need it again.</li>\n+</ul>\n+<p>To remove or fix the object, it helps to start the actual Plone site with some special zodbverify sauce:</p>\n+<pre class="literal-block">\n+./bin/instance zodbverify -f var/filestorage/Data.fs -o &lt;oid&gt; -D\n+</pre>\n+<p>Then you can use your debugging skills to try and fix things.\n+Note that after you fixed it, you need to commit the changes explicitly:</p>\n+<pre class="literal-block">\n+import transaction\n+transaction.commit()\n+</pre>\n+<p>Note that the bad object is still in the database, until you pack it.</p>\n+<p>Frequent culprits are IntIds and Relations, especially if you migrated from Archetypes to Dexterity.\n+Using <a class="reference" href="https://github.com/collective/collective.relationhelpers/blob/master/src/collective/relationhelpers/api.py">collective.relationhelpers</a> you can clean this up:</p>\n+<pre class="literal-block">\n+from collective.relationhelpers.api import cleanup_intids\n+from collective.relationhelpers.api import purge_relations\n+from collective.relationhelpers.api import restore_relations\n+from collective.relationhelpers.api import store_relations\n+# store all relations in a annotation on the portal\n+store_relations()\n+# empty the relation-catalog\n+purge_relations()\n+# remove all relationvalues and refs to broken objects from intid\n+cleanup_intids()\n+# recreate all relations from a annotation on the portal\n+restore_relations()\n+</pre>\n+</div>\n+<div class="section" id="symptom-6-bad-code">\n+<h3><a name="symptom-6-bad-code">Symptom 6: bad code</a></h3>\n+<p>Unreadable, untested, unused, undocumented, unmaintained, complicated, overly complex, too much code.\n+If you can convince a client to <em>not</em> want a feature because they will only use it once, that is a win.\n+Every line of code that is <em>not</em> written, is a good line of code.</p>\n+</div>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-11T17:08:38+00:00</published>\n+\n+      <updated>2021-01-05T10:33:42+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Maik Derstappen: Plone 6 Theming with Diazo</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/maik-derstappen-plone-6-theming-with-diazo" />\n+\n+\n+\n+      <id>urn:syndication:3ba6d872864981f8695780e8de6d246f</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>How does Plone theming look in classic UI?</p>\n+<ul class="simple">\n+<li>html5 theme plus a mapping configuration</li>\n+<li>deploying themes as ZIP-file for shared hosting is possible</li>\n+<li>With Diazo you can map any Plone html to a static theme layout.</li>\n+</ul>\n+<p>Separating frontend and backend theme.\n+Don\'t reinvent the backend views!\n+You could theme the backend, so for content editors and admins, but it looks fine, not needed.\n+You should focus on the frontend layout for visitors.\n+To use the default backend layout you can include <tt class="docutils literal"><span class="pre">backend.xml</span></tt> in your rules, with some conditions.</p>\n+<p>Diazo is not for everything!\n+If the backend markup differs from what you need, do not try to solve it with Diazo or XSLT.\n+Instead, fix the backend templates directly, most likely with a <tt class="docutils literal"><span class="pre">z3c.jbot</span></tt> override.</p>\n+<p>You can use <a class="reference" href="https://github.com/collective/collective.themefragments/">theme fragments</a> or browser views to add new templates.\n+The theme fragments can also be used as tiles in Mosaic.</p>\n+<p>I like using SASS mixins.\n+Say you have a <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;main-wrapper</span> <span class="pre">container&quot;&gt;</span></tt>.\n+Cleaner would be <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;main-wrapper&quot;&gt;</span></tt>.\n+You can do this with mixins with <tt class="docutils literal"><span class="pre">&#64;include</span></tt> in your selector.</p>\n+<p>For more information on Diazo, see <a class="reference" href="https://diazo.org">https://diazo.org</a>.</p>\n+<div class="section" id="new-features-in-plone-6">\n+<h3><a name="new-features-in-plone-6">New features in Plone 6</a></h3>\n+<p>From the backend we get Bootstrap 5 compatible html.\n+Result is that Bootstrap themes are easier to integrate in Plone 6.</p>\n+<p>You have custom CSS in the theming control panel, for small changes.\n+This actually sneaked into Plone 5.2.2 as well.</p>\n+<p>We have simplified Diazo rules.</p>\n+<p>Create a theme with plonecli:</p>\n+<ul class="simple">\n+<li>pip install plonecli</li>\n+<li>plonecli create addon plonetheme.yourtheme</li>\n+<li>cd plonetheme.yourtheme</li>\n+<li>plonecli add theme</li>\n+<li>plonecli build</li>\n+</ul>\n+<p>Theme from this presentation will be published as <a class="reference" href="https://github.com/collective/collective.bunapisicuto">collective.bunapisicuto</a> when it is ready for you to inspect.</p>\n+</div>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-10T22:16:11+00:00</published>\n+\n+      <updated>2020-12-10T22:16:11+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Stefan Antonelli: Plone 6 Theming from Scratch</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/stefan-antonelli-plone-6-theming-from-scratch" />\n+\n+\n+\n+      <id>urn:syndication:d1f0f9b0e055800492dbadd973f3290e</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>How to create a theme for Plone 6.\n+Quite easy, because the templates use Bootstrap 5 classes.\n+We build a theme from scratch, no Barceloneta, no Diazo.</p>\n+<p>First step is to create an empty plone_addon package with <tt class="docutils literal"><span class="pre">plonecli</span></tt> or <tt class="docutils literal"><span class="pre">mr.bob</span></tt>.\n+For the questions you can answer: use Plone 5.2.1. We will switch later.\n+My theme is <a class="reference" href="https://github.com/collective/plonetheme.munich">plonetheme.munich</a>.</p>\n+<p>I recommend to cleanup the standard package a bit.\n+I remove tests, constraints for Plone 4 and 5.\n+Check it out in the commits.</p>\n+<p>Now switch to <a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/buildout.cfg">extend Plone 6</a> and run the buildout.</p>\n+<p>You can add theme structure with a bob template, but I prefer creating my own.</p>\n+<p>Some interesting files:</p>\n+<ul class="simple">\n+<li><a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/package.json">package.json</a> lists various tasks, especially the <tt class="docutils literal"><span class="pre">watch</span></tt> task.</li>\n+<li>In the theme <a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/src/plonetheme/munich/theme/manifest.cfg">manifest.cfg</a> we more or less disable Diazo by emptying the <tt class="docutils literal"><span class="pre">rules</span></tt> line.</li>\n+<li>The compiled CSS and JavaScript are registered in <a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/src/plonetheme/munich/profiles/default/registry/main.xml">registry.xml</a>.</li>\n+</ul>\n+<p>You can compile SASS to CSS using npm or yarn.\n+Do <tt class="docutils literal"><span class="pre">yarn</span> <span class="pre">install</span></tt> in the top of your package.\n+Later, with <tt class="docutils literal"><span class="pre">yarn</span> <span class="pre">dist</span></tt> you make it ready for production.</p>\n+<p>After these steps Plone is partially broken, or at least ugly.\n+I do some <a class="reference" href="https://github.com/collective/plonetheme.munich/commit/000717fb336849facec17b8fbd7b75686ec6146b">basic fixes</a> and it looks better.</p>\n+<p>For templates that you need to change you add <tt class="docutils literal"><span class="pre">z3c.jbot</span></tt> overrides.\n+Personally I always kick out the &quot;search in section&quot; checkbox.</p>\n+<p>I don\'t like columns, but for this example I kept them.\n+In most cases I need just one column.\n+Plus maybe a side bar for portlets, but portlets must die.</p>\n+<p>With <tt class="docutils literal"><span class="pre">plonetheme.tokyo</span></tt> everything is Bootstrap, no columns, so no portlets, really fully responsive.\n+This was the package where we built on Barceloneta Plone 5.2 and introduced lots of template overrides to put in Bootstrap.\n+For Plone 6 we can just remove the overrides.</p>\n+<p>What about the toolbar? Yes, we dropped it.\n+We bring editing features and navigation together.\n+This is now a few feature: <a class="reference" href="https://github.com/collective/collective.sidebar">collective.sidebar</a>.\n+It is only one template to override.\n+It works for Plone 5.2 at the moment, and I may work on it for Plone 6 during the sprints.</p>\n+<p>Question: is TTW still a viable path?</p>\n+<p>Answer: I like to concentrate on one path.\n+I am not an expert in TTW theming.\n+I switched to file system, except really small customizations.\n+For small CSS customizations there is a field in the theming control panel.</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-10T17:08:30+00:00</published>\n+\n+      <updated>2020-12-10T17:08:30+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Stefan Antonelli and Peter Holzer: Modernize Plone\xe2\x80\x99s Classic UI</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/stefan-antonelli-and-peter-holzer-modernize-plone2019s-classic-ui" />\n+\n+\n+\n+      <id>urn:syndication:468faba6197c93edadf910d668dac1c1</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>What was new in Plone 5?\n+We had beautiful new theme: Barceloneta.\n+Diazo theming by default.\n+We switched to CSS compilation with <tt class="docutils literal"><span class="pre">less</span></tt>.</p>\n+<p>During the Tokyo conference Stefan thought up Tokyo Theme.\n+Clean responsive theme for Plone 5.\n+Tons of overrides to tackle problems in Plone 5.\n+Issue with navigation and editing on mobile we solved with collective.sidebar.</p>\n+<p>We had community discussions, especially during several Plone events.\n+Everyone tried to use Bootstrap (components).\n+First idea: map variables from Barceloneta to Bootstrap, because they have similar ideas using different terms.</p>\n+<p>We have PLIP to modernize markup in templates, and another PLIP to modernize the default theme: Barceloneta LTS.\n+Forms using z3c.form are already using the new classes.</p>\n+<p>Make things easier: UI, development.\n+Creating a modern UI for the web is complex.\n+You need to support different devices, responsiveness.\n+In Bootstrap there are patterns for most useful things.</p>\n+<p>Developer perspective: expect one way to do things.\n+Developers should not have to worry about design.\n+When busy in the backend, you should focus on Python, not on it looking nice and shiny.\n+Don\'t think about markup, just use components.\n+The good news: there is documentation. The Bootstrap documentation is our documentation.</p>\n+<p>What is new in Plone 6?</p>\n+<ul class="simple">\n+<li>Volto is the default UI.</li>\n+<li>There still is the Classic UI with Barceloneta look and feel, but updated.</li>\n+<li>No TTW (through the web) theming.</li>\n+<li>But there is a textarea to add some simple CSS (already in 5.2.3).</li>\n+<li>Some CSS variables may be changeable TTW.</li>\n+<li>Finally jQuery 3</li>\n+</ul>\n+<p>Bootstrap is still the most popular front-end framework.\n+Well documented, tested and maintained.\n+It is so easy to create stuff, I enjoy it a lot.</p>\n+<p>What is new in Bootstrap 5?</p>\n+<ul class="simple">\n+<li>Improved overall look and feel.</li>\n+<li>Updated and extended the color system</li>\n+<li>Custom properties: css variables</li>\n+<li>SVG Icon library</li>\n+<li>Pure javascript</li>\n+<li>Dropped IE10 and IE11 support</li>\n+<li>Bootstrap 5 is currently alpha 3.</li>\n+<li>See <a class="reference" href="https://v5.getbootstrap.com">https://v5.getbootstrap.com</a></li>\n+</ul>\n+<p>Features: what do we get from these changes?</p>\n+<ul class="simple">\n+<li>Core templates use Bootstrap 5 markup. Instead of overrides in <tt class="docutils literal"><span class="pre">plonetheme.tokyo</span></tt>, we have lots of branches for the actual packages.</li>\n+<li>All major templates have been touched already.</li>\n+<li>For the current state, see the unofficial demo at <a class="reference" href="https://classic.plone.de">https://classic.plone.de</a></li>\n+<li>The <a class="reference" href="https://getbootstrap.com/docs/5.0/getting-started/introduction/">Bootstrap documentation</a> has lots of snippets than you can copy.</li>\n+<li>You don\'t need much more CSS on top of it if you paste most examples. We added a little for own components, like navigation.</li>\n+</ul>\n+<p>Barceloneta appearance is fully customizable.\n+It is basically on opinionated set of bootstrap variables.\n+Every aspect can be changed with variables: colors, fonts, sizes, spacings, grid gutters, etc.\n+There are overall properties, like shadowed, rounded, gradients. Just turn on or off.</p>\n+<p>Theming workflow.\n+<tt class="docutils literal"><span class="pre">plonetheme.barceloneta</span></tt> will also be published as <tt class="docutils literal"><span class="pre">npm</span></tt> package.\n+<tt class="docutils literal"><span class="pre">bobtemplates.plone</span></tt> will have a template for the new theming workflow.\n+You can do quick and dirty customizations through the CSS overrides field in the theme controlpanel.</p>\n+<p>Diazo will still be there, will work as before.\n+Some optimizations in the <tt class="docutils literal"><span class="pre">rules.xml</span></tt> to make content are customizations easier.</p>\n+<p>How to deal with icons?\n+What if you want to change the content type icons? Used to be hard.\n+Now we come up with the idea of an icon resolver.\n+We decided to use the <a class="reference" href="https://icons.getbootstrap.com">bootstrap icons</a>.\n+Icons are registered via GenericSetup, for example with a record name <tt class="docutils literal"><span class="pre">plone.icon.alarm</span></tt> pointing to an SVG.\n+You can then override this in your own GS profile.</p>\n+<p>Example icon use:</p>\n+<pre class="literal-block">\n+&lt;tal:icon replace=&quot;structure python:icons.tag(\'love\', tag_class=\'custom-class\', tag_alt=\'foobar\')&quot; /&gt;\n+</pre>\n+<p>You get get back an inline SVG or an image tag.</p>\n+<p>Note: all z3c form widgets in Plone are now in <tt class="docutils literal"><span class="pre">plone.app.z3cform</span></tt>, and not scattered over lots of packages.</p>\n+<p>We will restart our weekly Plone 6 Classic UI sprints, starting Januari 13 2021, 10:00 (UTC+1).</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-10T16:02:29+00:00</published>\n+\n+      <updated>2020-12-10T16:02:29+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Keynote: The User Experience - Editing Composite Pages in Plone 6 and Beyond</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/keynote-the-user-experience-editing-composite-pages-in-plone-6-and-beyond" />\n+\n+\n+\n+      <id>urn:syndication:e244a1928902dfa6b7ea77347437d2d9</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>It may be a surprise to non-technical people to learn that pages created in Volto are not currently interoperable with traditional Plone\'s page editing. If you think about it, the reason becomes obvious. Volto, like Mosaic, creates tiled layouts, and like Mosaic it stores page data in special fields for the individual blocks and their layout. Neither Volto nor Mosaic pages are editable in TinyMCE, which expects just one rich text field.</p>\n+<p>Is this divergence between sites created in Volto and sites created in traditional Plone a problem? It does make it harder to describe what Plone is, and it might mean that there is no way to mix both approaches - for instance when part of a larger site is available as a Volto-based sub-site. Would it be possible to have one tool and one representation for tiled layouts so that we can avoid this divergence? Is there some other solution? Is it even a problem? Will Plone 6 be backwards compatible with Plone 5 and include a smooth upgrade path?</p>\n+<p>We will tackle these questions in this strategic panel discussion, moderated by Sally Kleinfeldt. Panelists will include Paul Roeland, Philip Bauer, Timo Stollenwerk, Victor Fernandez de Alba, and Eric Steele.</p>\n+<p>First, Philip has a message from Max Jacob who is very ill with pancreatic cancer and may not survive this weekend. He wants to thank the Plone community for what they allowed him to do: like organize the German Plone Konferenz. Thanks for all the friendships. Such a pity that this is happening now, he wanted to jump into only doing Plone for the next few years, due to changes at his job, and looked forward to that.</p>\n+<div class="section" id="classic-mosaic-and-volto-pages">\n+<h3><a name="classic-mosaic-and-volto-pages">Classic, Mosaic and Volto Pages</a></h3>\n+<p>We have Classic, Mosaic and Volto Pages. They have different internal representations and are not compatible.\n+Is this a problem? Is there a solution?\n+Is one tool, one representation possible?\n+If we really need three, how to position?</p>\n+<p>Paul: for me as user this presents a problem. When do you switch over your site?\n+We would like to not write 700 pages from scratch, again, like we did for previous composite pages.</p>\n+<p>Timo: We migrated quite a few large projects from classic Plone to Volto.\n+One of those had collective.cover (other composite page system).\n+Problem in general with such systems, is that they are pretty specific.\n+They solve specific use cases and come from different eras.\n+After any migration, it will not look the same any more.\n+Whatever you do: the page will initially look ugly.\n+So you put a lot of effort into migration, but then have to put manual effort into every page anyway.\n+It <em>can</em> help: you at least have a start.\n+We created a system where we migrated overview pages, and editors could click to migrate other pages one at a time.</p>\n+<p>Philip: We have code to migrate from non-folderish to folderish content types.\n+There will be code to migrate to dexterity site root on Plone 6.\n+We <em>can</em> make sure to migrate any standard content types.\n+Mosaic is another story.\n+So for pages you would at least have the text available. Maybe only visible for editors to pick and choose from.\n+You may lose portlets, unless they get implemented in Volto.</p>\n+<p>Timo: When you go to Plone 6 and do a redesign at the same time, then you can jump on Volto.\n+Otherwise you could stay at Classic Plone for now.\n+There will be an overlap period.</p>\n+<p>Victor: For Mosaic you could dump all tiles into html and insert it in a block.</p>\n+</div>\n+<div class="section" id="how-to-have-a-big-classic-site-with-a-subsite-made-in-volto">\n+<h3><a name="how-to-have-a-big-classic-site-with-a-subsite-made-in-volto">How to have a big Classic site with a subsite made in Volto?</a></h3>\n+<p>Victor: Definitely doable, though we have not done this ourselves.</p>\n+<p>Sally: But what happens when an editor in Classic goes to the Volto subsite? The Volto page would not be editable then, right?</p>\n+<p>Philip: You should not offer this. I see no upside, no use case.\n+Split them into separate applications, with shared authentication maybe.</p>\n+<p>Paul: Use case: large site with several departments.\n+The marketing department may want snazzy new Volto things.</p>\n+<p>Timo: Just create another site then.</p>\n+</div>\n+<div class="section" id="cost-and-benefit-of-upgrading-big-classic-site-to-plone-6">\n+<h3><a name="cost-and-benefit-of-upgrading-big-classic-site-to-plone-6">Cost and benefit of upgrading big Classic Site to Plone 6</a></h3>\n+<p>So you just had a big migration to Plone5, and now what would you get for going to Plone 6.</p>\n+<p>Philip: We have this discussion every major upgrade.\n+Communicate every upgrade as a relaunch.\n+The relaunch is the reason for the upgrade.\n+&quot;There is a new version so you need to upgrade&quot; does not fly for my clients.</p>\n+<p>Timo: We became a very developer oriented community, and every develop understands the need and benefits.\n+We should really get back to giving more value at major releases, so clients really want to upgrade themselves.\n+Plone releases should sell themselves.</p>\n+<p>Eric: It looks like we think Plone 6 + Volto is a costly upgrade with lots of benefits.\n+For Classic 5 to Classic 6 the upgrade is not costly.</p>\n+</div>\n+<div class="section" id="alex-limi-s-vision-for-deco-are-we-there-yet">\n+<h3><a name="alex-limi-s-vision-for-deco-are-we-there-yet">Alex Limi\'s vision for Deco: are we there yet?</a></h3>\n+<p>Was this fulfilled by Mosaic? Volto? Something still needed?</p>\n+<p>Paul: Not quite, but slowly getting there.\n+For me it would be Volto, plus some power features that Eau de Web (EEA) adds.</p>\n+<p>Timo: I think we went beyond what Limi envisioned.</p>\n+<p>Eric and Victor: What we have seen from Volto, is pretty close to what Alex wanted.</p>\n+<p>Victor: We gave the users powerful tools, so beware of them.</p>\n+<p>Philip: Partly yes. Volto is close, and it is for normal users.</p>\n+<p>Now some questions from users.</p>\n+</div>\n+<div class="section" id="is-there-a-plan-for-volto-to-support-editing-the-existing-richtext-fields-of-documents-news-items">\n+<h3><a name="is-there-a-plan-for-volto-to-support-editing-the-existing-richtext-fields-of-documents-news-items">Is there a plan for Volto to support editing the existing Richtext fields of Documents, News Items?</a></h3>\n+<p>Philip: This should be doable.</p>\n+</div>\n+<div class="section" id="migrations">\n+<h3><a name="migrations">Migrations</a></h3>\n+<p>Philip: Plone 4 to 5.2 was three migrations in one.\n+Plone 6 is less of a problem.</p>\n+<p>Eric: 5.2 had a lot of backend migrations.\n+A split between backend and frontend with plone.restapi in between makes things easier.</p>\n+<p>[The question on multiple variations of Volto, especially editors, went a bit too fast for me to write intelligible notes down.]</p>\n+</div>\n+<div class="section" id="what-s-the-future-of-using-ct-s-behaviors-in-plone-to-design-information-architecture">\n+<h3><a name="what-s-the-future-of-using-ct-s-behaviors-in-plone-to-design-information-architecture">What\'s the future of using CT\'s/behaviors in Plone to design information architecture?</a></h3>\n+<blockquote>\n+With Volto the trend seems mixing/adding 40 different blocks for every page.</blockquote>\n+<p>Timo: Blocks are definitely the way to work.\n+But the underlying power of content types and behaviors still exists.</p>\n+<p>Philip: We need blocks that represent a field or a behavior. That is unavoidable.</p>\n+</div>\n+<div class="section" id="next-steps">\n+<h3><a name="next-steps">Next steps</a></h3>\n+<p>Timo: We plan to have an open space on page compositions and Volto, and want to sprint on it.</p>\n+<p>Paul: Good if there is a longer term vision.\n+I would rather have more power that a Site Admin can lock down, than having to choose between three different versions.\n+I don\'t want choice stress.</p>\n+</div>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-10T14:55:55+00:00</published>\n+\n+      <updated>2020-12-10T14:55:55+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Lightning Talks Wednesday</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/lightning-talks-wednesday" />\n+\n+\n+\n+      <id>urn:syndication:c478decef0cbf87b0b04ae96599134b3</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <div class="section" id="lukas-guziel-continuous-deployment">\n+<h3><a name="lukas-guziel-continuous-deployment">Lukas Guziel: Continuous Deployment</a></h3>\n+<p>CD means deploying code automatically.\n+It saves time, reduces human error.\n+It Gitlab you can add <tt class="docutils literal"><span class="pre">gitlib-ci.yml</span></tt> and configure it.\n+Include a base template that you use in multiple projects.\n+End result can be a site that the customer can test.</p>\n+</div>\n+<div class="section" id="erico-andrei-world-plone-day-2021">\n+<h3><a name="erico-andrei-world-plone-day-2021">Erico Andrei: World Plone Day 2021</a></h3>\n+<p>We are a global community.\n+Almost 300 people from 36 countries are at this online conference.\n+World Plone Day is an annual Plone event.\n+Next year of course online. April 28th 2021.</p>\n+<p>We want to stream 24 hours live on our YouTube channel.\n+Showcase Plone. Technical talk, use cases, interviews, demo.</p>\n+<p>It should not all be in English, please use your own language.\n+Talk to your local community.</p>\n+<p>Please help and join. See <a class="reference" href="https://plone.org/events/wpd">https://plone.org/events/wpd</a></p>\n+</div>\n+<div class="section" id="andreas-jung-collective-contentsync2">\n+<h3><a name="andreas-jung-collective-contentsync2">Andreas Jung: collective.contentsync2</a></h3>\n+<p>Syncing content between Plone sites through <tt class="docutils literal"><span class="pre">plone.restapi</span></tt>.\n+It is a behavior.\n+You have a source Plone site and one or more target Plone sites.\n+You need Plone 5.2 under Python 3.</p>\n+<ul class="simple">\n+<li>Create a dedicated user account with global role Editor.</li>\n+<li>Configure on the content sync control panel.</li>\n+<li>Automatically creates two content rules to sync content when added or modified.</li>\n+<li>You can enable it on all content types, also Folders.</li>\n+</ul>\n+<p>See <a class="reference" href="https://github.com/collective/collective.contentsync2">https://github.com/collective/collective.contentsync2</a></p>\n+</div>\n+<div class="section" id="philip-bauer-why-relations-are-weird">\n+<h3><a name="philip-bauer-why-relations-are-weird">Philip Bauer: Why relations are weird</a></h3>\n+<p>These packages have a part in relations:</p>\n+<ul class="simple">\n+<li>zc.relation: abstract relation catalog</li>\n+<li>z3c.relationfield: fields and values on objects</li>\n+<li>plone.app.relationfield: converters from field to widget and vv</li>\n+<li>plone.app.z3cform: widgets</li>\n+<li>mockup: actual widget UI</li>\n+</ul>\n+<p>In a schema use a RelationChoice field with vocabulary plone.app.vocabularies.Catalog, and set pattern directives.</p>\n+<p>It is not straightforward.\n+So I wrote <tt class="docutils literal"><span class="pre">collective.relationhelpers</span></tt>.</p>\n+<p>See <a class="reference" href="https://github.com/collective/collective.relationhelpers">https://github.com/collective/collective.relationhelpers</a></p>\n+<p>Maybe use uuid instead of all this code.</p>\n+<p>[About ten people in the chat want to merge this package into plone.api. Actually, see <a class="reference" href="https://github.com/plone/plone.api/issues/223">this issue</a>.]</p>\n+</div>\n+<div class="section" id="christopher-lozinski-simple-json-schema-guis">\n+<h3><a name="christopher-lozinski-simple-json-schema-guis">Christopher Lozinski: Simple JSON Schema GUIs</a></h3>\n+<p>Create a JSON schema, automatically generate the UI.\n+Search for basic JSON editor library.\n+He shows JSON in ZODB, so you can browse it, if I understood correctly.\xf0\x9f\x99\x82</p>\n+</div>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-09T18:21:14+00:00</published>\n+\n+      <updated>2020-12-09T18:21:14+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Eric Brehault: Second Guessing the Single-Page-App Pattern</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/eric-brehault-second-guessing-the-single-page-app-pattern" />\n+\n+\n+\n+      <id>urn:syndication:8b678f3acfa36bff175e085791de850d</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>SPA (Single Page App) is about providing an entire app by exposing a single physical web page containing an enormous javascript bundle. It breaks the original web paradigm in many ways. Surprisingly enough, we invest a lot of efforts to mimic the regular web behaviour.</p>\n+<p>Isn\xe2\x80\x99t it time for modern frontend to reconsider the SPA approach?</p>\n+<p>[Note: Eric presented by using a projector to show his slides on a black Plone conference T-shirt. :-)]</p>\n+<p>Why are we doing this? Originally we always requested a whole page and this was considered slow. But we have good bandwidth now. And if you don\'t have good bandwidth, the super big bundle is not good either.</p>\n+<p>With SPA we try very hard to bring back the original working of the page, especially the browser history, being able to browse and then share the link to the current page.</p>\n+<p>To mitigate problems, we created an enormous stack. And we deny the complexity.  New tools create new problems, even when their individual creators does not see the complexity.</p>\n+<p>&quot;SPA isn\'t stable or efficient.&quot;\n+But there is no way back. For example, you cannot create Google Docs  with server side rendered pages.\n+Web 2.0 is 15 years old. It is still about content.</p>\n+<p>SPA is separation of concern, which is a good principle. But we mix the browser layer (how you get and view the page) and the content layer (the page content).</p>\n+<p>It seems a take it or leave it situation: either use SPA or don\'t. What do we want? We want proportionate complexity. Do we need 100 percent SPA?</p>\n+<p>You can use micro components, see for example the demo of Maik Derstappen in the lightning talks on Monday, using Svelte.\n+Micro frontend is bigger than that.  It is a part of the application, that you develop separately. For example, you could do the Plone Sharing page like this.</p>\n+<p>Can we compile each page separately? Then each page is an app.</p>\n+<p>ES6 native support would be interesting. Combine with HTTP/2 and you need no bundles.\n+Bundling is the most brutal thing ever. Horrible. Get rid of it.</p>\n+<p>Respect the layers. SPAs are monolithic. Break them down.</p>\n+<p>We should have a generic browser layer, common to many different use cases, for example for logging in.\n+I don\'t want to code that, but plug it. Second step: push this layer to the browsers themselves.</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-09T17:41:59+00:00</published>\n+\n+      <updated>2020-12-09T17:42:16+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Asko Soukka: Deploying Plone and Volto, the Hard Way</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/asko-soukka-deploying-plone-and-volto-the-hard-way" />\n+\n+\n+\n+      <id>urn:syndication:7d213d4114be2f1ef8ed20a2e1983ed3</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>Here are the <a class="reference" href="https://datakurre.github.io/ploneconf2020/deploying-plone-and-volto-hard-way.pdf">slides</a>.</p>\n+<p>How about building Plone without buildout? Running Plone on Python 3 without WSGI? Deploying Plone and Volto with containers without Docker? Building all this in re-usable and safe manner in sandbox with restricted network access with Nix? Welcome to hear about our hipster setup where we lock, build and configure Plone deployments with Nix, insist to keep ZServer running on Python 3 for the love\'s sake, build software deployments into standalone tarball archives, and run them with Nomad \xe2\x80\x93 the simple on-premises-friendly alternative for K8S.</p>\n+<ul class="simple">\n+<li>The easy, documented way: buildout, WSGI, Docker (if you need containers), Registry.</li>\n+<li>Our way: pip, TxZServer, Nomad, Nix</li>\n+</ul>\n+<p>When you use a container infrastructure, you have multiple containers for running a Plone site, for example zeo clients, zeo servers, load balancer. Nomad helps there, and is much simpler than Kubernetes.\n+We have one job file to rule them all: task groups, instance count, update policy, server resources, volumen mounts, tasks, consul services, vault secrets, environment variables, exec artifacts.</p>\n+<p>Nomad has &quot;isolated fork / exec driver&quot;. No docker image needed. We have a Nix-built artifact, a tarball that we extract in the root of the container.</p>\n+<p>With Nix, you get 100 percent reproducible artifacts. Production equals development. You have a full dependency graph. The result is a standalone tarball, perhaps 100 MB. Disadvantage is that there are no conventions, no metadata, no shared layers, no documentation. It needs learning and practice. Well, some documentation now: <a class="reference" href="https://nixos.org">https://nixos.org</a> and <a class="reference" href="https://nix.dev">https://nix.dev</a>, partially made by people that were using Plone previously.</p>\n+<p>Some ugly parts from Nix:</p>\n+<ul class="simple">\n+<li>Every language has their own Nix-conventions</li>\n+<li>dependency generator ecosystem is comples</li>\n+<li>cyclic dependencies are not supported</li>\n+<li>no storage device is big enough for <tt class="docutils literal"><span class="pre">/nix/store</span></tt></li>\n+</ul>\n+<p>Our (legacy) approach for Plone 5.2.1 without Buildout and with pip:</p>\n+<ul class="simple">\n+<li>generated requirements.txt with buildout</li>\n+<li>create Python env with pip and nix</li>\n+<li>use pip-branch of z3c.autoinclude</li>\n+<li>disabled <tt class="docutils literal"><span class="pre">&lt;includeDependencies</span> <span class="pre">/&gt;</span></tt></li>\n+<li>generate instance skeleton with nix</li>\n+<li>forked plone.recipe.zope2instance</li>\n+</ul>\n+<p>Plone 6 without Buildout should be pip-installable out of the box, but that is hear-say.</p>\n+<p>We use TxZServer in production, so ZServer using Twisted.</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-09T16:22:15+00:00</published>\n+\n+      <updated>2020-12-09T16:22:15+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Nicola Zambello: Theming Volto without SemanticUI: Is It Possible?</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/nicola-zambello-theming-volto-without-semanticui-is-it-possible" />\n+\n+\n+\n+      <id>urn:syndication:d96309ed215a2fec3c67f7f3e4d97885</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>We will walk through the process of building a product for Italian Public Administrations using a bootstrap-based theme.\n+I\'m presenting io-comune, RedTurtle\'s first product based on Volto and the strategies we used.\n+We will see the possibilities in Volto for theming without SemanticUI, using bootstrap and sass and what are the next ideas we could work on.</p>\n+<p>Scenario:</p>\n+<ul class="simple">\n+<li>We wanted to adopt Volto in our new project.</li>\n+<li>We needed to include Bootstrap.</li>\n+<li>Volto uses SemanticUI instead.</li>\n+<li>Two such frameworks will conflict, for example fighting over the same selector.</li>\n+</ul>\n+<p>We tried. We tried harder.\n+A cheap approach did not seem possible, so we looked for a sane one.</p>\n+<p>A new theme: <tt class="docutils literal"><span class="pre">pastanaga-cms-ui</span></tt>. Load only the CSS needed for Volto admin UI, see <a class="reference" href="https://github.com/plone/volto/pull/970">Volto PR 970</a>.\n+And <tt class="docutils literal"><span class="pre">public-ui</span></tt> for public pages.\n+In your <tt class="docutils literal"><span class="pre">src/theme.js</span></tt> do not import the css/less from semantic-ui, but the <tt class="docutils literal"><span class="pre">pastanaga-cms-ui</span></tt>.\n+In theme theme.config also use pastanaga-cms-ui.\n+Also razzle-config.</p>\n+<p>You should normalize your base style, for example:</p>\n+<pre class="literal-block">\n+body.cms-ui {\n+  .public-ui {\n+    font-size: 18px;\n+  }\n+}\n+</pre>\n+<p>and wrap your components with <tt class="docutils literal"><span class="pre">.public-ui</span></tt>.</p>\n+<p>Building a product:</p>\n+<ul class="simple">\n+<li>Base common package for every customer: <a class="reference" href="https://github.com/RedTurtle/design-volto-theme">https://github.com/RedTurtle/design-volto-theme</a></li>\n+<li>New intermediate layer for SemanticUI</li>\n+<li>New config layer for razzle/customizations</li>\n+<li>Template for actual projects: <tt class="docutils literal"><span class="pre">design-volto-kit</span></tt>, with a Yeoman generator: <tt class="docutils literal"><span class="pre">create-italia-volto-app</span></tt></li>\n+</ul>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-09T14:22:41+00:00</published>\n+\n+      <updated>2020-12-09T14:22:41+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Alin Voinea: Volto Dexterity Schema and Layout Editor</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/alin-voinea-volto-dexterity-schema-and-layout-editor" />\n+\n+\n+\n+      <id>urn:syndication:e78a4c57d7c28e52be32a25b83f7c466</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>Through the Web Dexterity Content-Types with Schema Editor and Blocks Layout Editor</p>\n+<p>How do we define content types schemas in Plone?</p>\n+<ul class="simple">\n+<li>TTW schema editor</li>\n+<li>GenericSetup profile</li>\n+<li>Behaviors, schemas in Python</li>\n+</ul>\n+<p>Why do we need them, we have Volto blocks, right?\n+You still need metadata, a title, etcetera. Certainly for larger institutions you need a structure, a schema.\n+Volto itself has schema-based components.</p>\n+<p>Layout editor.\n+Blocks have properties, like a placeholder, a position.\n+You can type text in a block: &quot;Published on date by author&quot;.\n+Then select &quot;date&quot; and link this text to the published date metadata,\n+and select &quot;author&quot; and link it to the author.\n+Save this as a layout for a content type.\n+You can export this to a JSONField in a custom behavior, so you can save it in version control for production.</p>\n+<p>List of add-ons and other packages that make Volto awesome:\n+<a class="reference" href="https://github.com/collective/awesome-volto">https://github.com/collective/awesome-volto</a></p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-08T17:40:59+00:00</published>\n+\n+      <updated>2020-12-08T17:40:59+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Jens Klein: Performance, Profiling, Power-Consumption</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/jens-klein-performance-profiling-power-consumption" />\n+\n+\n+\n+      <id>urn:syndication:8c53225f93c004d147e18d907160144d</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>I want to focus on Python performance, so not caching or database performance.</p>\n+<p>Tools:</p>\n+<ul class="simple">\n+<li><tt class="docutils literal"><span class="pre">py-spy</span></tt>: Overall mix of the whole live application, top-like.</li>\n+<li><tt class="docutils literal"><span class="pre">repoze.profile</span></tt>: WSGI middleware, slows down application. Profile single request and analyse its call stack by count, call time, etc.</li>\n+<li><tt class="docutils literal"><span class="pre">dis</span></tt>: disassembler for Python at the bytecode level.</li>\n+</ul>\n+<p>Improvements Plone 5.2.0-5.2.3:</p>\n+<ul class="simple">\n+<li>Avoided early <tt class="docutils literal"><span class="pre">providedBy</span></tt> calls</li>\n+<li><tt class="docutils literal"><span class="pre">__getattr__</span></tt> early exit on common attributes</li>\n+<li><tt class="docutils literal"><span class="pre">zope.interface</span></tt>: some functions are called hundreds of thousands of times when you reindex an index, so a tiny improvement helps a lot. I found various places that could use improvements, and that landed in the package, together with memory improvements by Jason Madden.</li>\n+</ul>\n+<p>Live demo. I call <tt class="docutils literal"><span class="pre">py-spy</span></tt> with <tt class="docutils literal"><span class="pre">sudo</span></tt> because I need to connect to an existing process id.</p>\n+<p>Future Todo\'s:</p>\n+<ul class="simple">\n+<li><tt class="docutils literal"><span class="pre">plone.restapi</span></tt> has optimization potential, all navigation related, but currently it still supports even Plone 4.3. This will likely wait for a 5.2-only or Python3-only branch.</li>\n+<li><tt class="docutils literal"><span class="pre">plone.registry</span></tt> is called too often</li>\n+<li>Use <tt class="docutils literal"><span class="pre">python:</span></tt> expressions in all page templates. They are way faster than standard Tales expressions.</li>\n+<li>More introspection.</li>\n+<li>Move more logic from page templates to Python code</li>\n+</ul>\n+<p>Advice: start introspecting the performance of your application.</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-08T16:27:53+00:00</published>\n+\n+      <updated>2020-12-08T16:27:53+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Alex Clark: The State of Pillow</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/alex-clark-the-state-of-pillow" />\n+\n+\n+\n+      <id>urn:syndication:e34819d893c83228742eda41c42063d6</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>The Plone Conference account tweeted that a State of Plone talk would be awesome and that the Plone community missed me. I miss the Plone community too, so I am here.</p>\n+<p>I will state it clearly: Pillow would not exist if not for Plone.</p>\n+<p>In July 2010 I announced Pillow as &quot;friendly&quot; fork of PIL. The <a class="reference" href="https://mail.python.org/pipermail/image-sig/2010-July/006423.html">mailing thread</a> and future answers are interesting to read.</p>\n+<p>Some history:</p>\n+<ul class="simple">\n+<li>1991: Python 0.9.1</li>\n+<li>1995: PIL started</li>\n+<li>1998: Zope</li>\n+<li>1999: Zope2</li>\n+<li>2000: Python 2.0 with distutils</li>\n+<li>2001: Plone</li>\n+<li>2005: Buildout</li>\n+<li>2006: I attended my first Plone Conference, in Washington</li>\n+<li>2006: setuptools was born</li>\n+</ul>\n+<p>PIL had an issue, or Plone had an issue with PIL:</p>\n+<ul class="simple">\n+<li>PIL used distutils.</li>\n+<li>Plone 3.2 used Buildout and setuptools</li>\n+<li>PIL was not installable in Buildout and setuptools</li>\n+<li>Specific problem: <tt class="docutils literal"><span class="pre">import</span> <span class="pre">Image</span></tt> could mean the Image module from PIL, or the Image module from Zope.</li>\n+</ul>\n+<p>Various ways of repackaging PIL started, for example <tt class="docutils literal"><span class="pre">PILwoTk</span></tt>. You can still find various PIL derivatives at <a class="reference" href="https://dist.plone.org/thirdparty/">https://dist.plone.org/thirdparty/</a></p>\n+<p>PIL 1.1.6 from 2006 is still the last version on <a class="reference" href="https://pypi.org/project/PIL/#history">PyPI</a>. I got maintainership of this page this year, actually.\n+Pillow 1.0 is basically the same, except that it uses <tt class="docutils literal"><span class="pre">setuptools</span></tt>.\n+This worked in buildout.\n+I was happy.</p>\n+<p>Couple years, nothing really interesting happened.\n+But some contributors came along.\n+Pillow 2.0.0 in March 2013 had Python 3 support.</p>\n+<p>An important milestone in 2015: we added release notes.</p>\n+<p>Release schedule: in the beginning of every quarter.</p>\n+<p>We get some money from Tidelift for maintenance.</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-08T16:23:06+00:00</published>\n+\n+      <updated>2020-12-08T16:26:22+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Lightning talks Monday</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/lightning-talks-monday" />\n+\n+\n+\n+      <id>urn:syndication:73d847717e4336392db709c0738ec383</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <div class="section" id="alec-mitchell-wysiwyg-problems-be-gone">\n+<h3><a name="alec-mitchell-wysiwyg-problems-be-gone">Alec Mitchell: WYSIWYG problems be gone</a></h3>\n+<p>A new add-on to vastly* improve your content editing experience.</p>\n+<p>(* size of improvement may vary, no warranty implied. The following is (un)paid free software promotional content)</p>\n+<p>Adding images to a document is so hard! At least nine steps! (Difficulty be exaggerated for marketing purposes).\n+Why can\'t you drop an image in?\n+You can, with our new, super special add-on <a class="reference" href="https://pypi.org/project/kcrw.tinymce-imagedrop/">krcw.tinymce_imagedrop</a>.</p>\n+<p>Can you drop two?\n+Yes!</p>\n+<p>Can you drop more than two?\n+No, because browsers are weird.</p>\n+<p>But it fails gracefully.</p>\n+</div>\n+<div class="section" id="steve-piercy-deform-and-friends">\n+<h3><a name="steve-piercy-deform-and-friends">Steve Piercy: Deform and friends</a></h3>\n+<p>How I learned to stop worrying and love web forms.\n+We must have a good interface, data structure, validation, security.\n+Deform (form library), colander (de/serialization), peppercorn (data structure), bootstrap forms for design.\n+We have a looooong list of widgets.\n+In deform 3.0 we will use bootstrap 5.\n+See <a class="reference" href="https://github.com/pylons/deform">https://github.com/pylons/deform</a></p>\n+</div>\n+<div class="section" id="christopher-lozinski-forest-wiki">\n+<h3><a name="christopher-lozinski-forest-wiki">Christopher Lozinski: Forest Wiki</a></h3>\n+<p>The <a class="reference" href="https://forestwiki.com/">Forest Wiki</a> is a modern version of Zope 2.\n+Biggest difference: it uses Pyramid\'s security and views.\n+Modern JavaScript enabled ZMI: reorder, sort, rename, etc.\n+Both WYSIWYG and MarkDown pages.\n+Advanced types like JSON, CoffeeScript, pug. Pug is the leading template engine for Node.</p>\n+</div>\n+<div class="section" id="jens-klein-relstorage">\n+<h3><a name="jens-klein-relstorage">Jens Klein: RelStorage</a></h3>\n+<p>Plone relational database backend storage.\n+It is a drop-in replacement for FileStorage of ZEO.\n+You can use PostgreSQL, MySQL, Oracle, SQLite.\n+It has been around for about 13 years, grown old, but in recent years development has picked up, driven by Jason Madden, including Python 3 support. It is much more performant.\n+Latest release 3.4.0 is form October 2020.</p>\n+<p>PostgreSQL is the cloud database, kind of industry standard, well supported by all big cloud providers.\n+Easy to install in Docker.</p>\n+<p>Advantages of RelStorage: fast, parallel commits, better concurrency, shorter locks.\n+Optimized per process caching.\n+Blobs in database.\n+Optionally you can use it in history free mode. You lose the Undo functionality, but you don\'t need to pack so often.</p>\n+<p><tt class="docutils literal"><span class="pre">plone.recipe.zope2instance</span></tt> supports it with the <tt class="docutils literal"><span class="pre">rel-storage</span></tt> option.</p>\n+<p>You can use additional client side caches, shared between all threads of a process.</p>\n+<p>With the <tt class="docutils literal"><span class="pre">zodbconvert</span></tt> tool you convert from ZEO to RelStorage, or the other way around, including converting blobs if needed.</p>\n+<p>ZODB keeps old transactions, so packing is needed, even in history free mode. RelStorage has a fast <tt class="docutils literal"><span class="pre">zodbpack</span></tt>.</p>\n+<p>Blobs:</p>\n+<ul>\n+<li><p class="first">RelStorage 3.x is Python 3 only and runs with Plone 5.2+. Here, blobs should be stored in RelStorage.</p>\n+</li>\n+<li><p class="first">RelStorage 2.x is for Plone 5.0, 5.1, and blobs should <a href="#id1" name="id2"><span class="problematic" id="id2">**</span></a>not**&nbsp; be stored in the database, except for Oracle backends, otherwise you should still use a shared blobs filesystem directory.</p>\n+<div class="system-message" id="id1">\n+<p class="system-message-title">System Message: <a name="id1">WARNING/2</a> (<tt class="docutils">&lt;string&gt;</tt>, line 69); <em><a href="#id2">backlink</a></em></p>\n+<p>Inline strong start-string without end-string.</p>\n+</div>\n+</li>\n+</ul>\n+<p>I use RelStorage today for all my live deployments. I have used it since version 1.6 with Plone 4.3 and never had problems. Always blazing fast. Dev/ops and sysadmins love it: it is a standard solution, nothing special, just works.</p>\n+</div>\n+<div class="section" id="maik-derstappen-add-on-catalog-for-plone">\n+<h3><a name="maik-derstappen-add-on-catalog-for-plone">Maik Derstappen: Add-on catalog for Plone</a></h3>\n+<p>We want to bring back an add-on catalog for Plone. You can look on PyPI, but it is hard to find packages.</p>\n+<p>We worked on a tool for this. You can search on named, filter on Plone versions and add-on types.</p>\n+<p>Components:</p>\n+<ul class="simple">\n+<li>The <a class="reference" href="https://github.com/collective/pyf.aggregator">Python Package Filter Aggregator</a> (<tt class="docutils literal"><span class="pre">pyf.aggregator</span></tt>) aggregates the meta information of all Python packages in the PyPI.</li>\n+<li>an <a class="reference" href="https://github.com/collective/pyf.api">api</a> using elasticsearch</li>\n+<li>a <a class="reference" href="https://github.com/collective/pyf-svelte-gui">prototype in Svelte</a></li>\n+</ul>\n+<p>We only aggregate packages that have classifier <tt class="docutils literal"><span class="pre">Plone</span> <span class="pre">::</span> <span class="pre">Framework</span></tt>.\n+We will probably work on this during the sprints and are happy to onboard you.</p>\n+</div>\n+<div class="section" id="david-bain-plone-and-webflow">\n+<h3><a name="david-bain-plone-and-webflow">David Bain: Plone and Webflow</a></h3>\n+<p>Both platforms are for building websites, but they approach things in different ways.\n+I hope this may inspire.\n+Keep in mind the motivation of the two platforms, which may account for some strengths and weaknesses.</p>\n+<p>Webflow is visual web design, less content management. Strong design tools.\n+Designer friendly layout tools.\n+You can design a page with what you could call blocks.</p>\n+<p>Plone is enterprise content management, focus on security.\n+Linking to an attachment is standard, where it is tricky in Webflow.\n+Forms are way more flexible.</p>\n+<p>We have also built a website in Webflow and based it on Plone.</p>\n+</div>\n+<div class="section" id="steve-piercy-pyramid-project-in-pycharm-professional">\n+<h3><a name="steve-piercy-pyramid-project-in-pycharm-professional">Steve Piercy: Pyramid Project in PyCharm Professional</a></h3>\n+<p>It is easy to create a such a project. Demo.\n+See <a class="reference" href="https://stevepiercy.github.io/pppp/">https://stevepiercy.github.io/pppp/</a></p>\n+</div>\n+<div class="section" id="miu-razvan-volto-grid-block">\n+<h3><a name="miu-razvan-volto-grid-block">Miu Razvan: Volto grid block</a></h3>\n+<ul class="simple">\n+<li>Created by Eau de Web team</li>\n+<li>Dependencies: Volto blocks form</li>\n+<li>Similar component: Volto columns block</li>\n+<li>Use it to organize other blocks.</li>\n+<li>Demo showing lots of configuration options, including for different screen sizes</li>\n+<li>See <a class="reference" href="https://github.com/eea/volto-grid-block">https://github.com/eea/volto-grid-block</a></li>\n+</ul>\n+</div>\n+<div class="section" id="maik-derstappen-custom-elements">\n+<h3><a name="maik-derstappen-custom-elements">Maik Derstappen: Custom elements</a></h3>\n+<p>Custom elements are an extension to normal native html elements, for example <tt class="docutils literal"><span class="pre">&lt;flag-icon&gt;</span></tt>.</p>\n+<p>The promise of web components: write once, use anywhere.\n+See <a class="reference" href="https://custom-elements-everywhere.com/">https://custom-elements-everywhere.com/</a></p>\n+<p>How do you use this in Plone?\n+Use <tt class="docutils literal"><span class="pre">plonecli</span> <span class="pre">add</span> <span class="pre">svelte_app</span></tt> to create a small app. Run <tt class="docutils literal"><span class="pre">yarn</span></tt>. Install in Plone add-ons control panel.\n+Edit a page. Replace html source with <tt class="docutils literal"><span class="pre">&lt;my-svelte-app</span> <span class="pre">/&gt;</span></tt>.\n+And your component is there and working.\n+The size is less than five&nbsp; kilobytes.</p>\n+</div>\n+<div class="section" id="tiberiu-ichim-volto-slate">\n+<h3><a name="tiberiu-ichim-volto-slate">Tiberiu Ichim: volto-slate</a></h3>\n+<p><tt class="docutils literal"><span class="pre">volto-slate</span></tt> is a drop-in replacement for the standard rich text editor in Volto.\n+Volto turns an HTML document into a modern document.</p>\n+<p>Why another text editor instead of improving the existing one?</p>\n+<ul class="simple">\n+<li>With Slate we get a better plugin framework. Plugins are just wrappers around the editor. The standard Draft.js is meant to be integrated directly by an application, no concept of plugins out-of-the-box.</li>\n+<li>Slate has simple DOM-like storage for its values, making it easier to render the ersult.</li>\n+</ul>\n+<p>Current status:</p>\n+<ul class="simple">\n+<li>No migrations of any kind.</li>\n+<li>Right now not possible to completely remove or replace Draftjs out of Volto.</li>\n+</ul>\n+</div>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-08T11:53:56+00:00</published>\n+\n+      <updated>2020-12-09T10:19:52+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Fred van Dijk: collective.collectionfilter as a Light-weight Faceted Navigation or a \'compare\' Console</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/fred-van-dijk-collective-collectionfilter-as-a-light-weight-faceted-navigation-or-a-compare-console" />\n+\n+\n+\n+      <id>urn:syndication:0a9da3a3170511af38154da7691da92a</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>I want to talk about some categorisation and classification options in Plone, next to the folder structure.</p>\n+<p>Faceted navigation: drill down on \'facets\' when you search for items. It was popularized by online shopping. Facets in Plone for developers is: whatever is in the ZCatalog, and for users: what you can search on in Collections.\n+Gold standard is <a class="reference" href="https://github.com/eea/eea.facetednavigation">eea.facetednavigation</a>, developed for the European Environment Agency. Examples: <a class="reference" href="https://www.eea.europa.eu/highlights">EEA</a>,  and on two sites by Zest: <a class="reference" href="https://vaquums.eu/sensor-db">Vaquums</a> and <a class="reference" href="https://www.minaraad.be/zoeken">Minaraad</a>, where it replaces the standard search.</p>\n+<p>collective.collectionfilter is a much leaner, meaner, but also more limited version of faceted navigation. Demo with standard Plone News Items with some tags (also known as categories, also known as Subject). Add a Collection that filters on News Items. Now add collection filter portlets.</p>\n+<p>eea.facetednavigation takes over your complete page. In an action you enable or disable it.</p>\n+<p>Now a demo of collectionfilter in SGBP, a documentation website for water management planning in Belgium/Flanders. The customer wanted to take some graphs and compare them. We did that with collectionfilter and collective.classifiers. With the last one we added structured categories: one for water basins and one for parameters of the graphs. Now we use collectionfilter to query a parameter and show the graphs for all water basins.</p>\n+<p>You can adapt several things in the collectionfilter UI, for example change how search options are displayed. This is documented, but took me a while to get right.</p>\n+<p>Collectionfilter also works with Mosaic, because the portlets are also mapped to tiles.</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-07T21:10:20+00:00</published>\n+\n+      <updated>2020-12-07T21:10:20+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Asko Soukka: Plone and Volto in a Jamstack project</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/asko-soukka-plone-and-volto-in-a-jamstack-project" />\n+\n+\n+\n+      <id>urn:syndication:a2b3ebe0e81fdf7ce953cb80333b0919</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>Here are the <a class="reference" href="https://datakurre.github.io/ploneconf2020/plone-and-volto-in-jamstack-project.pdf">slides</a>.</p>\n+<p>I am a software architect at University of Jyv\xc3\xa4skyl\xc3\xa4. I have been using Plone since 2004 and GatsbyJS since 2018.\n+The university wanted one student information management system to rule them all, but... every organisation shall do their own integrations, using granular REST API with deep JSON responses. And there should be branded study guides, which we crafted with GatsbyJS. But this was not enough for the Open University part. They really needed a CMS.</p>\n+<p>We use Plone 5.2, Volto, GatsbyJS, and have 6000 html pages, times two languages, out of which 760 are Volto pages.\n+With Plone we could extend content types without needing to do any coding, in the content types field editor. In volto we added auto-complete widgets with custom vocabularies. On the GatsbyJs side, we query the connected pages with GraphQL. We render Volto layouts with React components, rendering individual blocks.</p>\n+<p>Why did we choose GatsbyJs? It is a ReactJS-based site generator. Being static, it is very fast. You can use multiple sources as input, using a plugin architecture. Data lookup is done with GraphQL. It is easy to get started, with comprehensive documentation.</p>\n+<p>I mentored two Google Summer of Code projects for the <tt class="docutils literal"><span class="pre">gatsby-source-plone</span></tt> plugin. It supports default types and most TTW types, also Volto blocks. You can do incremental updates by modification date, so it is really fast.</p>\n+<p>Not everything is easy. The full &quot;GatsbyJs experience&quot; requires practice. You want to replace inline images and links with GatsbyJs images and links, replace file links with direct downloads.</p>\n+<p>Using <tt class="docutils literal"><span class="pre">&#64;plone/volto</span></tt> as dependency to render blocks seemed like a good idea, but it required webpack overrides to be impartable, and could not be used for images and links.</p>\n+<p>The ugly parts of GatsbyJs:</p>\n+<ul class="simple">\n+<li>The GraphQL source plugin cannot cache.</li>\n+<li>The build may take hours, and gigabytes of memory.</li>\n+<li>The build result in readonly.</li>\n+<li>For me it is hard to follow GatsbyJs development, especially individual plugins, because they use a monorepo.</li>\n+</ul>\n+<p>Editors can work on the site during the day, and then wee rebuild the result during the night</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-07T17:54:09+00:00</published>\n+\n+      <updated>2020-12-07T17:54:09+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+</feed>\ndiff --git a/plone/app/portlets/tests/test_rss_portlet.py b/plone/app/portlets/tests/test_rss_portlet.py\nindex 7d47b67f..8e5adc20 100644\n--- a/plone/app/portlets/tests/test_rss_portlet.py\n+++ b/plone/app/portlets/tests/test_rss_portlet.py\n@@ -3,6 +3,7 @@\n \n from Products.GenericSetup.utils import _getDottedName\n \n+from plone.namedfile.file import NamedBlobFile\n from plone.portlets.interfaces import IPortletType\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletAssignment\n@@ -10,11 +11,23 @@\n from plone.portlets.interfaces import IPortletRenderer\n \n from plone.app.portlets.portlets import rss\n+from plone.app.portlets.testing import PLONE_APP_PORTLETS_FUNCTIONAL_TESTING\n from plone.app.portlets.tests.base import PortletsTestCase\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import setRoles\n \n \n+import os\n+import transaction\n+import unittest\n+\n+\n+# Take a sample feed.  In this case an atom feed instead of RSS.\n+# Taken from https://maurits.vanrees.org/weblog/topics/plone/@@atom.xml\n+here = os.path.dirname(__file__)\n+sample_feed = os.path.join(here, "atom_feed_maurits.xml")\n+\n+\n class TestPortlet(PortletsTestCase):\n \n     def afterSetUp(self):\n@@ -59,6 +72,17 @@ def testRenderer(self):\n         renderer = getMultiAdapter((context, request, view, manager, assignment), IPortletRenderer)\n         self.assertTrue(isinstance(renderer, rss.Renderer))\n \n+    def testRSSFeedFile(self):\n+        # We should not be able to read a file from the file system.\n+        # We pass a url and a timeout in minutes\n+        feed = rss.RSSFeed("file://" + sample_feed, 1)\n+        feed._retrieveFeed()\n+        self.assertTrue(feed._loaded)\n+        self.assertTrue(feed._failed)\n+        self.assertFalse(feed.ok)\n+        self.assertFalse(feed.siteurl)\n+        self.assertEqual(len(feed.items), 0)\n+\n \n class TestRenderer(PortletsTestCase):\n \n@@ -82,6 +106,31 @@ def testTitle(self):\n         self.assertEqual(r.title, u\'Overridden title\')\n \n \n+class TestFunctional(unittest.TestCase):\n+    layer = PLONE_APP_PORTLETS_FUNCTIONAL_TESTING\n+\n+    def test_rss_feed_http(self):\n+        # First prepare a file in the current site,\n+        # so that we can try to load this via http.\n+        with open(sample_feed, "rb") as myfile:\n+            data = myfile.read()\n+        file_field = NamedBlobFile(data, filename=u"feed.xml")\n+        portal = self.layer["portal"]\n+        feed_id = portal.invokeFactory("File", "feed")\n+        feed = portal[feed_id]\n+        feed.file = file_field\n+        transaction.commit()\n+\n+        # Eat the feed.\n+        feed = rss.RSSFeed(feed.absolute_url(), 1)\n+        feed._retrieveFeed()\n+        self.assertTrue(feed._loaded)\n+        self.assertFalse(feed._failed)\n+        self.assertTrue(feed.ok)\n+        self.assertEqual(feed.siteurl, u"https://maurits.vanrees.org/weblog")\n+        self.assertEqual(len(feed.items), 15)\n+\n+\n def test_suite():\n     from unittest import TestSuite, makeSuite\n     suite = TestSuite()\n'

Repository: plone.app.portlets


Branch: refs/heads/4.4.x
Date: 2021-06-30T12:07:38+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.portlets/commit/6e7a85c4424e836b73c7681877865b49dd375212

Merge pull request #149 from plone/hotfix-20210518-expressions-44x

Only allow http and https urls in RSS portlet. [4.4.x/5.2]

Files changed:
A news/3274.bugfix
A plone/app/portlets/tests/atom_feed_maurits.xml
M plone/app/portlets/portlets/rss.py
M plone/app/portlets/tests/test_rss_portlet.py

b'diff --git a/news/3274.bugfix b/news/3274.bugfix\nnew file mode 100644\nindex 00000000..f391a821\n--- /dev/null\n+++ b/news/3274.bugfix\n@@ -0,0 +1,3 @@\n+Only allow http and https urls in RSS portlet.\n+From `Products.PloneHotfix20210518 <https://plone.org/security/hotfix/20210518/blind-ssrf-via-feedparser-accessing-an-internal-url>`_.\n+[maurits]\ndiff --git a/plone/app/portlets/portlets/rss.py b/plone/app/portlets/portlets/rss.py\nindex 9cdfe110..bae430ca 100644\n--- a/plone/app/portlets/portlets/rss.py\n+++ b/plone/app/portlets/portlets/rss.py\n@@ -11,6 +11,13 @@\n import feedparser\n import time\n \n+try:\n+    # Py 3\n+    from urllib.parse import urlparse\n+except ImportError:\n+    # Py 2\n+    from urlparse import urlparse\n+\n \n # Accept these bozo_exceptions encountered by feedparser when parsing\n # the feed:\n@@ -153,6 +160,13 @@ def _buildItemDict(self, item):\n     def _retrieveFeed(self):\n         """do the actual work and try to retrieve the feed"""\n         url = self.url\n+        if url:\n+            if len(url.splitlines()) > 1:\n+                # More than one line in a url: probably a hacker.\n+                url = ""\n+            elif urlparse(url).scheme not in ("https", "http"):\n+                # Mostly: prevent loading local file: urls.\n+                url = ""\n         if url != \'\':\n             self._last_update_time_in_minutes = time.time() / 60\n             self._last_update_time = DateTime()\ndiff --git a/plone/app/portlets/tests/atom_feed_maurits.xml b/plone/app/portlets/tests/atom_feed_maurits.xml\nnew file mode 100644\nindex 00000000..7655d714\n--- /dev/null\n+++ b/plone/app/portlets/tests/atom_feed_maurits.xml\n@@ -0,0 +1,1520 @@\n+<?xml version="1.0" ?>\n+<?xml-stylesheet href="atom.css" type="text/css"?>\n+\n+<feed xmlns="http://www.w3.org/2005/Atom"\n+      xmlns:atom="http://www.w3.org/2005/Atom"\n+      xmlns:dc="http://purl.org/dc/elements/1.1/"\n+      xml:base="https://maurits.vanrees.org" xml:lang="en">\n+  <link rel="self"\n+        href="https://maurits.vanrees.org/weblog/topics/plone/@@atom.xml" />\n+  <div xmlns="http://www.w3.org/1999/xhtml">\n+    <a href="http://www.atomenabled.org/feedvalidator/check.cgi?url=https://maurits.vanrees.org/weblog/atom.xml">\n+      <img title="Validate my Atom feed" width="88"\n+           height="31"\n+           src="http://www.atomenabled.org/feedvalidator/images/valid-atom.png"\n+           alt="[Valid Atom]" border="0px" />\n+    </a>\n+    <p>\n+      <span>\n+        This is an Atom formatted XML site feed. It is intended to be viewed in\n+        a Newsreader or syndicated to another site. Please visit\n+      </span>\n+      <a href="http://www.atomenabled.org/">Atom Enabled</a>\n+      <span>\n+        for more info.\n+      </span>\n+    </p>\n+  </div>\n+\n+  <title type="html">Weblog</title>\n+\n+\n+  <updated>2021-01-05T10:33:42+00:00</updated>\n+\n+  <link href="https://maurits.vanrees.org/weblog"\n+        rel="alternate" type="text/html" />\n+\n+\n+\n+  <id>urn:syndication:3a1d81067fb16b9d671c9ee4a6efa204</id>\n+\n+  <generator uri="http://plone.org/products/fatsyndication/" version="0.1">fatsyndication</generator>\n+\n+\n+\n+    <entry>\n+\n+      <title>Philip Bauer: Growing Pains: PosKeyErrors and Other Malaises</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/philip-bauer-growing-pains-poskeyerrors-and-other-malaises" />\n+\n+\n+\n+      <id>urn:syndication:a2e343ca7c1c64182bc128b9a4f0be0b</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>This talk is about the issues that you face when your project grows, the code base grows, the database grows, the problems grow.\n+This is about the causes and some of the remedies.</p>\n+<div class="section" id="symptom-1-huge-database">\n+<h3><a name="symptom-1-huge-database">Symptom 1: huge database</a></h3>\n+<p>Cause 1: a huge number of revisions or versions.</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Remove all versions and pack the database. When you migrate to a new Plone version, and you ask your client, they will usually be okay with this.</li>\n+<li>Manage or limit revisions. Easiest is to use <a class="reference" href="https://github.com/collective/collective.revisionmanager">collective.revisionmanager</a> for this. Especially, revisions may have been left behind for content that no longer exists. You can easily remove it with this tool.</li>\n+<li>Disable versioning of Files. It is disabled by default, but maybe someone has switched it on.</li>\n+<li>Enable manual versioning instead of automatic. Then the editor needs to check a box when they make a major change that they want to be able to rollback.</li>\n+</ul>\n+<p>Cause 2: no packing.</p>\n+<p>Remedy: just pack it. Use the <tt class="docutils literal"><span class="pre">zeopack</span></tt> script, which part of <tt class="docutils literal"><span class="pre">plone.recipe.zeoserver</span></tt>. Add a cronjob for this, weekly seems best for most sites.</p>\n+<p>Cause 3: unused content.</p>\n+<p>Remedy: delete it. You have to find it first.\n+Of course no code can tell you which content is safe to delete.\n+You could use <tt class="docutils literal"><span class="pre">statistics.py</span></tt> from <a class="reference" href="https://github.com/collective/collective.migrationhelpers">collective.migrationhelpers</a> to get an idea of where which content is.</p>\n+<p>Cause 4: the SearchableText index is huge</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Use solr or elasticsearch and possibly remove the <tt class="docutils literal"><span class="pre">SearchableText</span></tt> index.</li>\n+<li>Don\'t index files. They are converted to text, but this may not be needed for your site.</li>\n+</ul>\n+<p>Cause 5: large blobs\n+For example, plone.de had a Linux <tt class="docutils literal"><span class="pre">iso</span></tt> image, which was huge.</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Limit the upload size. You could do this in nginx/apache. Archetypes had something, you can likely do this in Dexterity too.</li>\n+<li>Get stats and remove or replace too large items.</li>\n+</ul>\n+<p>Cause 6: aborted uploads (rare)</p>\n+<p>Remedy: check <tt class="docutils literal"><span class="pre">IAnnotations(portal).get(\'file_upload_map\')</span></tt>.</p>\n+</div>\n+<div class="section" id="symptom-2-slow-site">\n+<h3><a name="symptom-2-slow-site">Symptom 2: slow site</a></h3>\n+<p>Cause 1: unneeded full renders of content</p>\n+<p>Remedy: use Python in page templates.\n+By default, page templates use path expressions like this: <tt class="docutils literal"><span class="pre">tal:define=&quot;foo</span> <span class="pre">context/foo&quot;</span></tt>.\n+But this tries to render&nbsp; foo as html if possible.\n+Use <tt class="docutils literal"><span class="pre">foo</span> <span class="pre">python:context.foo</span></tt> instead.</p>\n+<p>Cause 2: wake up many objects</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Always try to use brains and metadata. The difference is huge, also with Dexterity.</li>\n+<li>Listing 3000 brains: 0.2 seconds</li>\n+<li>Listing 3000 objects: 2 seconds</li>\n+<li>Same is true for Volto when you use the search-endpoint with <tt class="docutils literal"><span class="pre">fullobjects</span></tt>.</li>\n+</ul>\n+<p>Of course most page templates in Plone will not list thousands of objects, but will be paginated.\n+Still: just use brains, they are so much tastier.</p>\n+<p>Cause 3: no caching</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Switch on the built-in caching</li>\n+<li>Add varnish</li>\n+<li>Manage the zeocache (that is a bit of science, ask the community)</li>\n+<li>Use <tt class="docutils literal"><span class="pre">memoize</span></tt> in your code.</li>\n+</ul>\n+<p>Cause 4: hardware</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Don\'t be cheap.</li>\n+<li>Buy enough ram to keep the database in memory.</li>\n+<li>Remember that your consulting time probably costs more than buying better hardware would.</li>\n+</ul>\n+<p>Cause 5: slow code</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Learn and use profiling. A very handy toy for that is <a class="reference" href="https://pypi.org/project/py-spy/">py-spy</a>. Sample use: <tt class="docutils literal"><span class="pre">sudo</span> <span class="pre">py-spy</span> <span class="pre">top</span> <span class="pre">--pid</span> <span class="pre">12345</span></tt></li>\n+<li>Do not call methods multiple times from templates. Call them once, store the result, and use this.</li>\n+</ul>\n+<p>Cause 6: slow data sources</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>decouple, for example using redis or celery</li>\n+<li>Use your choice of async implementations</li>\n+<li>Use lazyloading of images if they come from outside of your Plone site.</li>\n+</ul>\n+</div>\n+<div class="section" id="symptom-3-conflict-errors">\n+<h3><a name="symptom-3-conflict-errors">Symptom 3: conflict errors</a></h3>\n+<p>Conflict errors happen when two requests work at the same time and both change the same object.\n+This is complicated, but Zope and the ZODB have built-in conflict resolution.</p>\n+<p>Cause 1: conflict resolving is not enabled.\n+The zeoserver needs access to the same code that your zeoclient has, otherwise conflicts cannot be resolved and the transaction will be aborted.</p>\n+<p>Remedy: add all application code to the zeoserver:</p>\n+<pre class="literal-block">\n+[zeoserver]\n+eggs = ${buildout:eggs}\n+</pre>\n+<p>Cause 2: long running requests change data</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Prevent writes.</li>\n+<li>If it takes long, do intermediate commits when possible.</li>\n+<li>Prevent crossfire: disable cronjobs and editors when a long request needs to run.</li>\n+<li>Use async. Talk to Asko about that probably.</li>\n+</ul>\n+</div>\n+<div class="section" id="symptom-4-poskeyerrors">\n+<h3><a name="symptom-4-poskeyerrors">Symptom 4: PosKeyErrors</a></h3>\n+<p>Cause 1: missing blobs</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Copy all blobs of course.</li>\n+<li>Use <a class="reference" href="https://pypi.org/project/experimental.gracefulblobmissing/">experimental.gracefulblobmissing</a> in development to create dummy blobs where needed.</li>\n+<li>Find and delete afflicted content in a browser view.</li>\n+<li>There can be cases when you have two zeoclients and the syncing does not work well. Talk to Alessandro about that.</li>\n+</ul>\n+</div>\n+<div class="section" id="symptom-5-broken-data">\n+<h3><a name="symptom-5-broken-data">Symptom 5: broken data</a></h3>\n+<p>Now for the really interesting part.\n+These are errors like:</p>\n+<pre class="literal-block">\n+ModuleNotFoundError\n+AttributeError\n+ImportError\n+PostKeyError\n+BrokenObject\n+</pre>\n+<p>I could read you my whole blog post about <a class="reference" href="https://www.starzel.de/blog/zodb-debugging">zodb debugging</a>.</p>\n+<p>Cause 1: code to unpickle som data is missing</p>\n+<p>Remedies:</p>\n+<ul class="simple">\n+<li>Ignore the errors, if normal operation still works, and the site only has to stay up for a limited time, because <tt class="docutils literal"><span class="pre">zeopack</span></tt> probably also fails.</li>\n+<li>Fix it with a <a class="reference" href="https://github.com/zopefoundation/zodbupdate#id4">rename_dict</a>. See <a class="reference" href="https://github.com/zestsoftware/zest.zodbupdate">zest.zodbupdate</a> for some examples that are actually really useful. [Thanks! MvR]</li>\n+<li>Work around it with an <tt class="docutils literal"><span class="pre">alias_module</span></tt> patch, like <tt class="docutils literal"><span class="pre">plone.app.upgrade</span></tt> does in several cases. Then imports can work again.</li>\n+<li>Find out what and where broken objects are and then fix or remove them safely. Use <a class="reference" href="https://pypi.org/project/zodbverify/">zodbverify</a>.</li>\n+</ul>\n+<p>Steps for the last one:</p>\n+<ul class="simple">\n+<li>Call <tt class="docutils literal"><span class="pre">bin/zodbverify</span> <span class="pre">-f</span> <span class="pre">var/filestorage/Data.fs</span></tt> to get all broken objects.</li>\n+<li>Pick one error type at a time, with an oid (object id) that has a problem.</li>\n+<li>Call <tt class="docutils literal"><span class="pre">bin/zodbverify</span> <span class="pre">-f</span> <span class="pre">var/filestorage/Data.fs</span> <span class="pre">-o</span> <span class="pre">&lt;oid&gt;</span> <span class="pre">-D</span></tt> to inspect one object and find out where it is referenced.</li>\n+<li>For the extra options, you should use the branch from my <a class="reference" href="https://github.com/plone/zodbverify/pull/8">pull request</a>, which I still have not finished yet, but it runs fine.</li>\n+<li>Remove or fix the object.</li>\n+<li>Important: make notes, write upgrade steps, keep the terminal log, because you will forget it and need it again.</li>\n+</ul>\n+<p>To remove or fix the object, it helps to start the actual Plone site with some special zodbverify sauce:</p>\n+<pre class="literal-block">\n+./bin/instance zodbverify -f var/filestorage/Data.fs -o &lt;oid&gt; -D\n+</pre>\n+<p>Then you can use your debugging skills to try and fix things.\n+Note that after you fixed it, you need to commit the changes explicitly:</p>\n+<pre class="literal-block">\n+import transaction\n+transaction.commit()\n+</pre>\n+<p>Note that the bad object is still in the database, until you pack it.</p>\n+<p>Frequent culprits are IntIds and Relations, especially if you migrated from Archetypes to Dexterity.\n+Using <a class="reference" href="https://github.com/collective/collective.relationhelpers/blob/master/src/collective/relationhelpers/api.py">collective.relationhelpers</a> you can clean this up:</p>\n+<pre class="literal-block">\n+from collective.relationhelpers.api import cleanup_intids\n+from collective.relationhelpers.api import purge_relations\n+from collective.relationhelpers.api import restore_relations\n+from collective.relationhelpers.api import store_relations\n+# store all relations in a annotation on the portal\n+store_relations()\n+# empty the relation-catalog\n+purge_relations()\n+# remove all relationvalues and refs to broken objects from intid\n+cleanup_intids()\n+# recreate all relations from a annotation on the portal\n+restore_relations()\n+</pre>\n+</div>\n+<div class="section" id="symptom-6-bad-code">\n+<h3><a name="symptom-6-bad-code">Symptom 6: bad code</a></h3>\n+<p>Unreadable, untested, unused, undocumented, unmaintained, complicated, overly complex, too much code.\n+If you can convince a client to <em>not</em> want a feature because they will only use it once, that is a win.\n+Every line of code that is <em>not</em> written, is a good line of code.</p>\n+</div>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-11T17:08:38+00:00</published>\n+\n+      <updated>2021-01-05T10:33:42+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Maik Derstappen: Plone 6 Theming with Diazo</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/maik-derstappen-plone-6-theming-with-diazo" />\n+\n+\n+\n+      <id>urn:syndication:3ba6d872864981f8695780e8de6d246f</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>How does Plone theming look in classic UI?</p>\n+<ul class="simple">\n+<li>html5 theme plus a mapping configuration</li>\n+<li>deploying themes as ZIP-file for shared hosting is possible</li>\n+<li>With Diazo you can map any Plone html to a static theme layout.</li>\n+</ul>\n+<p>Separating frontend and backend theme.\n+Don\'t reinvent the backend views!\n+You could theme the backend, so for content editors and admins, but it looks fine, not needed.\n+You should focus on the frontend layout for visitors.\n+To use the default backend layout you can include <tt class="docutils literal"><span class="pre">backend.xml</span></tt> in your rules, with some conditions.</p>\n+<p>Diazo is not for everything!\n+If the backend markup differs from what you need, do not try to solve it with Diazo or XSLT.\n+Instead, fix the backend templates directly, most likely with a <tt class="docutils literal"><span class="pre">z3c.jbot</span></tt> override.</p>\n+<p>You can use <a class="reference" href="https://github.com/collective/collective.themefragments/">theme fragments</a> or browser views to add new templates.\n+The theme fragments can also be used as tiles in Mosaic.</p>\n+<p>I like using SASS mixins.\n+Say you have a <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;main-wrapper</span> <span class="pre">container&quot;&gt;</span></tt>.\n+Cleaner would be <tt class="docutils literal"><span class="pre">&lt;div</span> <span class="pre">class=&quot;main-wrapper&quot;&gt;</span></tt>.\n+You can do this with mixins with <tt class="docutils literal"><span class="pre">&#64;include</span></tt> in your selector.</p>\n+<p>For more information on Diazo, see <a class="reference" href="https://diazo.org">https://diazo.org</a>.</p>\n+<div class="section" id="new-features-in-plone-6">\n+<h3><a name="new-features-in-plone-6">New features in Plone 6</a></h3>\n+<p>From the backend we get Bootstrap 5 compatible html.\n+Result is that Bootstrap themes are easier to integrate in Plone 6.</p>\n+<p>You have custom CSS in the theming control panel, for small changes.\n+This actually sneaked into Plone 5.2.2 as well.</p>\n+<p>We have simplified Diazo rules.</p>\n+<p>Create a theme with plonecli:</p>\n+<ul class="simple">\n+<li>pip install plonecli</li>\n+<li>plonecli create addon plonetheme.yourtheme</li>\n+<li>cd plonetheme.yourtheme</li>\n+<li>plonecli add theme</li>\n+<li>plonecli build</li>\n+</ul>\n+<p>Theme from this presentation will be published as <a class="reference" href="https://github.com/collective/collective.bunapisicuto">collective.bunapisicuto</a> when it is ready for you to inspect.</p>\n+</div>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-10T22:16:11+00:00</published>\n+\n+      <updated>2020-12-10T22:16:11+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Stefan Antonelli: Plone 6 Theming from Scratch</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/stefan-antonelli-plone-6-theming-from-scratch" />\n+\n+\n+\n+      <id>urn:syndication:d1f0f9b0e055800492dbadd973f3290e</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>How to create a theme for Plone 6.\n+Quite easy, because the templates use Bootstrap 5 classes.\n+We build a theme from scratch, no Barceloneta, no Diazo.</p>\n+<p>First step is to create an empty plone_addon package with <tt class="docutils literal"><span class="pre">plonecli</span></tt> or <tt class="docutils literal"><span class="pre">mr.bob</span></tt>.\n+For the questions you can answer: use Plone 5.2.1. We will switch later.\n+My theme is <a class="reference" href="https://github.com/collective/plonetheme.munich">plonetheme.munich</a>.</p>\n+<p>I recommend to cleanup the standard package a bit.\n+I remove tests, constraints for Plone 4 and 5.\n+Check it out in the commits.</p>\n+<p>Now switch to <a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/buildout.cfg">extend Plone 6</a> and run the buildout.</p>\n+<p>You can add theme structure with a bob template, but I prefer creating my own.</p>\n+<p>Some interesting files:</p>\n+<ul class="simple">\n+<li><a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/package.json">package.json</a> lists various tasks, especially the <tt class="docutils literal"><span class="pre">watch</span></tt> task.</li>\n+<li>In the theme <a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/src/plonetheme/munich/theme/manifest.cfg">manifest.cfg</a> we more or less disable Diazo by emptying the <tt class="docutils literal"><span class="pre">rules</span></tt> line.</li>\n+<li>The compiled CSS and JavaScript are registered in <a class="reference" href="https://github.com/collective/plonetheme.munich/blob/master/src/plonetheme/munich/profiles/default/registry/main.xml">registry.xml</a>.</li>\n+</ul>\n+<p>You can compile SASS to CSS using npm or yarn.\n+Do <tt class="docutils literal"><span class="pre">yarn</span> <span class="pre">install</span></tt> in the top of your package.\n+Later, with <tt class="docutils literal"><span class="pre">yarn</span> <span class="pre">dist</span></tt> you make it ready for production.</p>\n+<p>After these steps Plone is partially broken, or at least ugly.\n+I do some <a class="reference" href="https://github.com/collective/plonetheme.munich/commit/000717fb336849facec17b8fbd7b75686ec6146b">basic fixes</a> and it looks better.</p>\n+<p>For templates that you need to change you add <tt class="docutils literal"><span class="pre">z3c.jbot</span></tt> overrides.\n+Personally I always kick out the &quot;search in section&quot; checkbox.</p>\n+<p>I don\'t like columns, but for this example I kept them.\n+In most cases I need just one column.\n+Plus maybe a side bar for portlets, but portlets must die.</p>\n+<p>With <tt class="docutils literal"><span class="pre">plonetheme.tokyo</span></tt> everything is Bootstrap, no columns, so no portlets, really fully responsive.\n+This was the package where we built on Barceloneta Plone 5.2 and introduced lots of template overrides to put in Bootstrap.\n+For Plone 6 we can just remove the overrides.</p>\n+<p>What about the toolbar? Yes, we dropped it.\n+We bring editing features and navigation together.\n+This is now a few feature: <a class="reference" href="https://github.com/collective/collective.sidebar">collective.sidebar</a>.\n+It is only one template to override.\n+It works for Plone 5.2 at the moment, and I may work on it for Plone 6 during the sprints.</p>\n+<p>Question: is TTW still a viable path?</p>\n+<p>Answer: I like to concentrate on one path.\n+I am not an expert in TTW theming.\n+I switched to file system, except really small customizations.\n+For small CSS customizations there is a field in the theming control panel.</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-10T17:08:30+00:00</published>\n+\n+      <updated>2020-12-10T17:08:30+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Stefan Antonelli and Peter Holzer: Modernize Plone\xe2\x80\x99s Classic UI</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/stefan-antonelli-and-peter-holzer-modernize-plone2019s-classic-ui" />\n+\n+\n+\n+      <id>urn:syndication:468faba6197c93edadf910d668dac1c1</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>What was new in Plone 5?\n+We had beautiful new theme: Barceloneta.\n+Diazo theming by default.\n+We switched to CSS compilation with <tt class="docutils literal"><span class="pre">less</span></tt>.</p>\n+<p>During the Tokyo conference Stefan thought up Tokyo Theme.\n+Clean responsive theme for Plone 5.\n+Tons of overrides to tackle problems in Plone 5.\n+Issue with navigation and editing on mobile we solved with collective.sidebar.</p>\n+<p>We had community discussions, especially during several Plone events.\n+Everyone tried to use Bootstrap (components).\n+First idea: map variables from Barceloneta to Bootstrap, because they have similar ideas using different terms.</p>\n+<p>We have PLIP to modernize markup in templates, and another PLIP to modernize the default theme: Barceloneta LTS.\n+Forms using z3c.form are already using the new classes.</p>\n+<p>Make things easier: UI, development.\n+Creating a modern UI for the web is complex.\n+You need to support different devices, responsiveness.\n+In Bootstrap there are patterns for most useful things.</p>\n+<p>Developer perspective: expect one way to do things.\n+Developers should not have to worry about design.\n+When busy in the backend, you should focus on Python, not on it looking nice and shiny.\n+Don\'t think about markup, just use components.\n+The good news: there is documentation. The Bootstrap documentation is our documentation.</p>\n+<p>What is new in Plone 6?</p>\n+<ul class="simple">\n+<li>Volto is the default UI.</li>\n+<li>There still is the Classic UI with Barceloneta look and feel, but updated.</li>\n+<li>No TTW (through the web) theming.</li>\n+<li>But there is a textarea to add some simple CSS (already in 5.2.3).</li>\n+<li>Some CSS variables may be changeable TTW.</li>\n+<li>Finally jQuery 3</li>\n+</ul>\n+<p>Bootstrap is still the most popular front-end framework.\n+Well documented, tested and maintained.\n+It is so easy to create stuff, I enjoy it a lot.</p>\n+<p>What is new in Bootstrap 5?</p>\n+<ul class="simple">\n+<li>Improved overall look and feel.</li>\n+<li>Updated and extended the color system</li>\n+<li>Custom properties: css variables</li>\n+<li>SVG Icon library</li>\n+<li>Pure javascript</li>\n+<li>Dropped IE10 and IE11 support</li>\n+<li>Bootstrap 5 is currently alpha 3.</li>\n+<li>See <a class="reference" href="https://v5.getbootstrap.com">https://v5.getbootstrap.com</a></li>\n+</ul>\n+<p>Features: what do we get from these changes?</p>\n+<ul class="simple">\n+<li>Core templates use Bootstrap 5 markup. Instead of overrides in <tt class="docutils literal"><span class="pre">plonetheme.tokyo</span></tt>, we have lots of branches for the actual packages.</li>\n+<li>All major templates have been touched already.</li>\n+<li>For the current state, see the unofficial demo at <a class="reference" href="https://classic.plone.de">https://classic.plone.de</a></li>\n+<li>The <a class="reference" href="https://getbootstrap.com/docs/5.0/getting-started/introduction/">Bootstrap documentation</a> has lots of snippets than you can copy.</li>\n+<li>You don\'t need much more CSS on top of it if you paste most examples. We added a little for own components, like navigation.</li>\n+</ul>\n+<p>Barceloneta appearance is fully customizable.\n+It is basically on opinionated set of bootstrap variables.\n+Every aspect can be changed with variables: colors, fonts, sizes, spacings, grid gutters, etc.\n+There are overall properties, like shadowed, rounded, gradients. Just turn on or off.</p>\n+<p>Theming workflow.\n+<tt class="docutils literal"><span class="pre">plonetheme.barceloneta</span></tt> will also be published as <tt class="docutils literal"><span class="pre">npm</span></tt> package.\n+<tt class="docutils literal"><span class="pre">bobtemplates.plone</span></tt> will have a template for the new theming workflow.\n+You can do quick and dirty customizations through the CSS overrides field in the theme controlpanel.</p>\n+<p>Diazo will still be there, will work as before.\n+Some optimizations in the <tt class="docutils literal"><span class="pre">rules.xml</span></tt> to make content are customizations easier.</p>\n+<p>How to deal with icons?\n+What if you want to change the content type icons? Used to be hard.\n+Now we come up with the idea of an icon resolver.\n+We decided to use the <a class="reference" href="https://icons.getbootstrap.com">bootstrap icons</a>.\n+Icons are registered via GenericSetup, for example with a record name <tt class="docutils literal"><span class="pre">plone.icon.alarm</span></tt> pointing to an SVG.\n+You can then override this in your own GS profile.</p>\n+<p>Example icon use:</p>\n+<pre class="literal-block">\n+&lt;tal:icon replace=&quot;structure python:icons.tag(\'love\', tag_class=\'custom-class\', tag_alt=\'foobar\')&quot; /&gt;\n+</pre>\n+<p>You get get back an inline SVG or an image tag.</p>\n+<p>Note: all z3c form widgets in Plone are now in <tt class="docutils literal"><span class="pre">plone.app.z3cform</span></tt>, and not scattered over lots of packages.</p>\n+<p>We will restart our weekly Plone 6 Classic UI sprints, starting Januari 13 2021, 10:00 (UTC+1).</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-10T16:02:29+00:00</published>\n+\n+      <updated>2020-12-10T16:02:29+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Keynote: The User Experience - Editing Composite Pages in Plone 6 and Beyond</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/keynote-the-user-experience-editing-composite-pages-in-plone-6-and-beyond" />\n+\n+\n+\n+      <id>urn:syndication:e244a1928902dfa6b7ea77347437d2d9</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>It may be a surprise to non-technical people to learn that pages created in Volto are not currently interoperable with traditional Plone\'s page editing. If you think about it, the reason becomes obvious. Volto, like Mosaic, creates tiled layouts, and like Mosaic it stores page data in special fields for the individual blocks and their layout. Neither Volto nor Mosaic pages are editable in TinyMCE, which expects just one rich text field.</p>\n+<p>Is this divergence between sites created in Volto and sites created in traditional Plone a problem? It does make it harder to describe what Plone is, and it might mean that there is no way to mix both approaches - for instance when part of a larger site is available as a Volto-based sub-site. Would it be possible to have one tool and one representation for tiled layouts so that we can avoid this divergence? Is there some other solution? Is it even a problem? Will Plone 6 be backwards compatible with Plone 5 and include a smooth upgrade path?</p>\n+<p>We will tackle these questions in this strategic panel discussion, moderated by Sally Kleinfeldt. Panelists will include Paul Roeland, Philip Bauer, Timo Stollenwerk, Victor Fernandez de Alba, and Eric Steele.</p>\n+<p>First, Philip has a message from Max Jacob who is very ill with pancreatic cancer and may not survive this weekend. He wants to thank the Plone community for what they allowed him to do: like organize the German Plone Konferenz. Thanks for all the friendships. Such a pity that this is happening now, he wanted to jump into only doing Plone for the next few years, due to changes at his job, and looked forward to that.</p>\n+<div class="section" id="classic-mosaic-and-volto-pages">\n+<h3><a name="classic-mosaic-and-volto-pages">Classic, Mosaic and Volto Pages</a></h3>\n+<p>We have Classic, Mosaic and Volto Pages. They have different internal representations and are not compatible.\n+Is this a problem? Is there a solution?\n+Is one tool, one representation possible?\n+If we really need three, how to position?</p>\n+<p>Paul: for me as user this presents a problem. When do you switch over your site?\n+We would like to not write 700 pages from scratch, again, like we did for previous composite pages.</p>\n+<p>Timo: We migrated quite a few large projects from classic Plone to Volto.\n+One of those had collective.cover (other composite page system).\n+Problem in general with such systems, is that they are pretty specific.\n+They solve specific use cases and come from different eras.\n+After any migration, it will not look the same any more.\n+Whatever you do: the page will initially look ugly.\n+So you put a lot of effort into migration, but then have to put manual effort into every page anyway.\n+It <em>can</em> help: you at least have a start.\n+We created a system where we migrated overview pages, and editors could click to migrate other pages one at a time.</p>\n+<p>Philip: We have code to migrate from non-folderish to folderish content types.\n+There will be code to migrate to dexterity site root on Plone 6.\n+We <em>can</em> make sure to migrate any standard content types.\n+Mosaic is another story.\n+So for pages you would at least have the text available. Maybe only visible for editors to pick and choose from.\n+You may lose portlets, unless they get implemented in Volto.</p>\n+<p>Timo: When you go to Plone 6 and do a redesign at the same time, then you can jump on Volto.\n+Otherwise you could stay at Classic Plone for now.\n+There will be an overlap period.</p>\n+<p>Victor: For Mosaic you could dump all tiles into html and insert it in a block.</p>\n+</div>\n+<div class="section" id="how-to-have-a-big-classic-site-with-a-subsite-made-in-volto">\n+<h3><a name="how-to-have-a-big-classic-site-with-a-subsite-made-in-volto">How to have a big Classic site with a subsite made in Volto?</a></h3>\n+<p>Victor: Definitely doable, though we have not done this ourselves.</p>\n+<p>Sally: But what happens when an editor in Classic goes to the Volto subsite? The Volto page would not be editable then, right?</p>\n+<p>Philip: You should not offer this. I see no upside, no use case.\n+Split them into separate applications, with shared authentication maybe.</p>\n+<p>Paul: Use case: large site with several departments.\n+The marketing department may want snazzy new Volto things.</p>\n+<p>Timo: Just create another site then.</p>\n+</div>\n+<div class="section" id="cost-and-benefit-of-upgrading-big-classic-site-to-plone-6">\n+<h3><a name="cost-and-benefit-of-upgrading-big-classic-site-to-plone-6">Cost and benefit of upgrading big Classic Site to Plone 6</a></h3>\n+<p>So you just had a big migration to Plone5, and now what would you get for going to Plone 6.</p>\n+<p>Philip: We have this discussion every major upgrade.\n+Communicate every upgrade as a relaunch.\n+The relaunch is the reason for the upgrade.\n+&quot;There is a new version so you need to upgrade&quot; does not fly for my clients.</p>\n+<p>Timo: We became a very developer oriented community, and every develop understands the need and benefits.\n+We should really get back to giving more value at major releases, so clients really want to upgrade themselves.\n+Plone releases should sell themselves.</p>\n+<p>Eric: It looks like we think Plone 6 + Volto is a costly upgrade with lots of benefits.\n+For Classic 5 to Classic 6 the upgrade is not costly.</p>\n+</div>\n+<div class="section" id="alex-limi-s-vision-for-deco-are-we-there-yet">\n+<h3><a name="alex-limi-s-vision-for-deco-are-we-there-yet">Alex Limi\'s vision for Deco: are we there yet?</a></h3>\n+<p>Was this fulfilled by Mosaic? Volto? Something still needed?</p>\n+<p>Paul: Not quite, but slowly getting there.\n+For me it would be Volto, plus some power features that Eau de Web (EEA) adds.</p>\n+<p>Timo: I think we went beyond what Limi envisioned.</p>\n+<p>Eric and Victor: What we have seen from Volto, is pretty close to what Alex wanted.</p>\n+<p>Victor: We gave the users powerful tools, so beware of them.</p>\n+<p>Philip: Partly yes. Volto is close, and it is for normal users.</p>\n+<p>Now some questions from users.</p>\n+</div>\n+<div class="section" id="is-there-a-plan-for-volto-to-support-editing-the-existing-richtext-fields-of-documents-news-items">\n+<h3><a name="is-there-a-plan-for-volto-to-support-editing-the-existing-richtext-fields-of-documents-news-items">Is there a plan for Volto to support editing the existing Richtext fields of Documents, News Items?</a></h3>\n+<p>Philip: This should be doable.</p>\n+</div>\n+<div class="section" id="migrations">\n+<h3><a name="migrations">Migrations</a></h3>\n+<p>Philip: Plone 4 to 5.2 was three migrations in one.\n+Plone 6 is less of a problem.</p>\n+<p>Eric: 5.2 had a lot of backend migrations.\n+A split between backend and frontend with plone.restapi in between makes things easier.</p>\n+<p>[The question on multiple variations of Volto, especially editors, went a bit too fast for me to write intelligible notes down.]</p>\n+</div>\n+<div class="section" id="what-s-the-future-of-using-ct-s-behaviors-in-plone-to-design-information-architecture">\n+<h3><a name="what-s-the-future-of-using-ct-s-behaviors-in-plone-to-design-information-architecture">What\'s the future of using CT\'s/behaviors in Plone to design information architecture?</a></h3>\n+<blockquote>\n+With Volto the trend seems mixing/adding 40 different blocks for every page.</blockquote>\n+<p>Timo: Blocks are definitely the way to work.\n+But the underlying power of content types and behaviors still exists.</p>\n+<p>Philip: We need blocks that represent a field or a behavior. That is unavoidable.</p>\n+</div>\n+<div class="section" id="next-steps">\n+<h3><a name="next-steps">Next steps</a></h3>\n+<p>Timo: We plan to have an open space on page compositions and Volto, and want to sprint on it.</p>\n+<p>Paul: Good if there is a longer term vision.\n+I would rather have more power that a Site Admin can lock down, than having to choose between three different versions.\n+I don\'t want choice stress.</p>\n+</div>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-10T14:55:55+00:00</published>\n+\n+      <updated>2020-12-10T14:55:55+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Lightning Talks Wednesday</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/lightning-talks-wednesday" />\n+\n+\n+\n+      <id>urn:syndication:c478decef0cbf87b0b04ae96599134b3</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <div class="section" id="lukas-guziel-continuous-deployment">\n+<h3><a name="lukas-guziel-continuous-deployment">Lukas Guziel: Continuous Deployment</a></h3>\n+<p>CD means deploying code automatically.\n+It saves time, reduces human error.\n+It Gitlab you can add <tt class="docutils literal"><span class="pre">gitlib-ci.yml</span></tt> and configure it.\n+Include a base template that you use in multiple projects.\n+End result can be a site that the customer can test.</p>\n+</div>\n+<div class="section" id="erico-andrei-world-plone-day-2021">\n+<h3><a name="erico-andrei-world-plone-day-2021">Erico Andrei: World Plone Day 2021</a></h3>\n+<p>We are a global community.\n+Almost 300 people from 36 countries are at this online conference.\n+World Plone Day is an annual Plone event.\n+Next year of course online. April 28th 2021.</p>\n+<p>We want to stream 24 hours live on our YouTube channel.\n+Showcase Plone. Technical talk, use cases, interviews, demo.</p>\n+<p>It should not all be in English, please use your own language.\n+Talk to your local community.</p>\n+<p>Please help and join. See <a class="reference" href="https://plone.org/events/wpd">https://plone.org/events/wpd</a></p>\n+</div>\n+<div class="section" id="andreas-jung-collective-contentsync2">\n+<h3><a name="andreas-jung-collective-contentsync2">Andreas Jung: collective.contentsync2</a></h3>\n+<p>Syncing content between Plone sites through <tt class="docutils literal"><span class="pre">plone.restapi</span></tt>.\n+It is a behavior.\n+You have a source Plone site and one or more target Plone sites.\n+You need Plone 5.2 under Python 3.</p>\n+<ul class="simple">\n+<li>Create a dedicated user account with global role Editor.</li>\n+<li>Configure on the content sync control panel.</li>\n+<li>Automatically creates two content rules to sync content when added or modified.</li>\n+<li>You can enable it on all content types, also Folders.</li>\n+</ul>\n+<p>See <a class="reference" href="https://github.com/collective/collective.contentsync2">https://github.com/collective/collective.contentsync2</a></p>\n+</div>\n+<div class="section" id="philip-bauer-why-relations-are-weird">\n+<h3><a name="philip-bauer-why-relations-are-weird">Philip Bauer: Why relations are weird</a></h3>\n+<p>These packages have a part in relations:</p>\n+<ul class="simple">\n+<li>zc.relation: abstract relation catalog</li>\n+<li>z3c.relationfield: fields and values on objects</li>\n+<li>plone.app.relationfield: converters from field to widget and vv</li>\n+<li>plone.app.z3cform: widgets</li>\n+<li>mockup: actual widget UI</li>\n+</ul>\n+<p>In a schema use a RelationChoice field with vocabulary plone.app.vocabularies.Catalog, and set pattern directives.</p>\n+<p>It is not straightforward.\n+So I wrote <tt class="docutils literal"><span class="pre">collective.relationhelpers</span></tt>.</p>\n+<p>See <a class="reference" href="https://github.com/collective/collective.relationhelpers">https://github.com/collective/collective.relationhelpers</a></p>\n+<p>Maybe use uuid instead of all this code.</p>\n+<p>[About ten people in the chat want to merge this package into plone.api. Actually, see <a class="reference" href="https://github.com/plone/plone.api/issues/223">this issue</a>.]</p>\n+</div>\n+<div class="section" id="christopher-lozinski-simple-json-schema-guis">\n+<h3><a name="christopher-lozinski-simple-json-schema-guis">Christopher Lozinski: Simple JSON Schema GUIs</a></h3>\n+<p>Create a JSON schema, automatically generate the UI.\n+Search for basic JSON editor library.\n+He shows JSON in ZODB, so you can browse it, if I understood correctly.\xf0\x9f\x99\x82</p>\n+</div>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-09T18:21:14+00:00</published>\n+\n+      <updated>2020-12-09T18:21:14+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Eric Brehault: Second Guessing the Single-Page-App Pattern</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/eric-brehault-second-guessing-the-single-page-app-pattern" />\n+\n+\n+\n+      <id>urn:syndication:8b678f3acfa36bff175e085791de850d</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>SPA (Single Page App) is about providing an entire app by exposing a single physical web page containing an enormous javascript bundle. It breaks the original web paradigm in many ways. Surprisingly enough, we invest a lot of efforts to mimic the regular web behaviour.</p>\n+<p>Isn\xe2\x80\x99t it time for modern frontend to reconsider the SPA approach?</p>\n+<p>[Note: Eric presented by using a projector to show his slides on a black Plone conference T-shirt. :-)]</p>\n+<p>Why are we doing this? Originally we always requested a whole page and this was considered slow. But we have good bandwidth now. And if you don\'t have good bandwidth, the super big bundle is not good either.</p>\n+<p>With SPA we try very hard to bring back the original working of the page, especially the browser history, being able to browse and then share the link to the current page.</p>\n+<p>To mitigate problems, we created an enormous stack. And we deny the complexity.  New tools create new problems, even when their individual creators does not see the complexity.</p>\n+<p>&quot;SPA isn\'t stable or efficient.&quot;\n+But there is no way back. For example, you cannot create Google Docs  with server side rendered pages.\n+Web 2.0 is 15 years old. It is still about content.</p>\n+<p>SPA is separation of concern, which is a good principle. But we mix the browser layer (how you get and view the page) and the content layer (the page content).</p>\n+<p>It seems a take it or leave it situation: either use SPA or don\'t. What do we want? We want proportionate complexity. Do we need 100 percent SPA?</p>\n+<p>You can use micro components, see for example the demo of Maik Derstappen in the lightning talks on Monday, using Svelte.\n+Micro frontend is bigger than that.  It is a part of the application, that you develop separately. For example, you could do the Plone Sharing page like this.</p>\n+<p>Can we compile each page separately? Then each page is an app.</p>\n+<p>ES6 native support would be interesting. Combine with HTTP/2 and you need no bundles.\n+Bundling is the most brutal thing ever. Horrible. Get rid of it.</p>\n+<p>Respect the layers. SPAs are monolithic. Break them down.</p>\n+<p>We should have a generic browser layer, common to many different use cases, for example for logging in.\n+I don\'t want to code that, but plug it. Second step: push this layer to the browsers themselves.</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-09T17:41:59+00:00</published>\n+\n+      <updated>2020-12-09T17:42:16+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Asko Soukka: Deploying Plone and Volto, the Hard Way</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/asko-soukka-deploying-plone-and-volto-the-hard-way" />\n+\n+\n+\n+      <id>urn:syndication:7d213d4114be2f1ef8ed20a2e1983ed3</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>Here are the <a class="reference" href="https://datakurre.github.io/ploneconf2020/deploying-plone-and-volto-hard-way.pdf">slides</a>.</p>\n+<p>How about building Plone without buildout? Running Plone on Python 3 without WSGI? Deploying Plone and Volto with containers without Docker? Building all this in re-usable and safe manner in sandbox with restricted network access with Nix? Welcome to hear about our hipster setup where we lock, build and configure Plone deployments with Nix, insist to keep ZServer running on Python 3 for the love\'s sake, build software deployments into standalone tarball archives, and run them with Nomad \xe2\x80\x93 the simple on-premises-friendly alternative for K8S.</p>\n+<ul class="simple">\n+<li>The easy, documented way: buildout, WSGI, Docker (if you need containers), Registry.</li>\n+<li>Our way: pip, TxZServer, Nomad, Nix</li>\n+</ul>\n+<p>When you use a container infrastructure, you have multiple containers for running a Plone site, for example zeo clients, zeo servers, load balancer. Nomad helps there, and is much simpler than Kubernetes.\n+We have one job file to rule them all: task groups, instance count, update policy, server resources, volumen mounts, tasks, consul services, vault secrets, environment variables, exec artifacts.</p>\n+<p>Nomad has &quot;isolated fork / exec driver&quot;. No docker image needed. We have a Nix-built artifact, a tarball that we extract in the root of the container.</p>\n+<p>With Nix, you get 100 percent reproducible artifacts. Production equals development. You have a full dependency graph. The result is a standalone tarball, perhaps 100 MB. Disadvantage is that there are no conventions, no metadata, no shared layers, no documentation. It needs learning and practice. Well, some documentation now: <a class="reference" href="https://nixos.org">https://nixos.org</a> and <a class="reference" href="https://nix.dev">https://nix.dev</a>, partially made by people that were using Plone previously.</p>\n+<p>Some ugly parts from Nix:</p>\n+<ul class="simple">\n+<li>Every language has their own Nix-conventions</li>\n+<li>dependency generator ecosystem is comples</li>\n+<li>cyclic dependencies are not supported</li>\n+<li>no storage device is big enough for <tt class="docutils literal"><span class="pre">/nix/store</span></tt></li>\n+</ul>\n+<p>Our (legacy) approach for Plone 5.2.1 without Buildout and with pip:</p>\n+<ul class="simple">\n+<li>generated requirements.txt with buildout</li>\n+<li>create Python env with pip and nix</li>\n+<li>use pip-branch of z3c.autoinclude</li>\n+<li>disabled <tt class="docutils literal"><span class="pre">&lt;includeDependencies</span> <span class="pre">/&gt;</span></tt></li>\n+<li>generate instance skeleton with nix</li>\n+<li>forked plone.recipe.zope2instance</li>\n+</ul>\n+<p>Plone 6 without Buildout should be pip-installable out of the box, but that is hear-say.</p>\n+<p>We use TxZServer in production, so ZServer using Twisted.</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-09T16:22:15+00:00</published>\n+\n+      <updated>2020-12-09T16:22:15+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Nicola Zambello: Theming Volto without SemanticUI: Is It Possible?</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/nicola-zambello-theming-volto-without-semanticui-is-it-possible" />\n+\n+\n+\n+      <id>urn:syndication:d96309ed215a2fec3c67f7f3e4d97885</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>We will walk through the process of building a product for Italian Public Administrations using a bootstrap-based theme.\n+I\'m presenting io-comune, RedTurtle\'s first product based on Volto and the strategies we used.\n+We will see the possibilities in Volto for theming without SemanticUI, using bootstrap and sass and what are the next ideas we could work on.</p>\n+<p>Scenario:</p>\n+<ul class="simple">\n+<li>We wanted to adopt Volto in our new project.</li>\n+<li>We needed to include Bootstrap.</li>\n+<li>Volto uses SemanticUI instead.</li>\n+<li>Two such frameworks will conflict, for example fighting over the same selector.</li>\n+</ul>\n+<p>We tried. We tried harder.\n+A cheap approach did not seem possible, so we looked for a sane one.</p>\n+<p>A new theme: <tt class="docutils literal"><span class="pre">pastanaga-cms-ui</span></tt>. Load only the CSS needed for Volto admin UI, see <a class="reference" href="https://github.com/plone/volto/pull/970">Volto PR 970</a>.\n+And <tt class="docutils literal"><span class="pre">public-ui</span></tt> for public pages.\n+In your <tt class="docutils literal"><span class="pre">src/theme.js</span></tt> do not import the css/less from semantic-ui, but the <tt class="docutils literal"><span class="pre">pastanaga-cms-ui</span></tt>.\n+In theme theme.config also use pastanaga-cms-ui.\n+Also razzle-config.</p>\n+<p>You should normalize your base style, for example:</p>\n+<pre class="literal-block">\n+body.cms-ui {\n+  .public-ui {\n+    font-size: 18px;\n+  }\n+}\n+</pre>\n+<p>and wrap your components with <tt class="docutils literal"><span class="pre">.public-ui</span></tt>.</p>\n+<p>Building a product:</p>\n+<ul class="simple">\n+<li>Base common package for every customer: <a class="reference" href="https://github.com/RedTurtle/design-volto-theme">https://github.com/RedTurtle/design-volto-theme</a></li>\n+<li>New intermediate layer for SemanticUI</li>\n+<li>New config layer for razzle/customizations</li>\n+<li>Template for actual projects: <tt class="docutils literal"><span class="pre">design-volto-kit</span></tt>, with a Yeoman generator: <tt class="docutils literal"><span class="pre">create-italia-volto-app</span></tt></li>\n+</ul>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-09T14:22:41+00:00</published>\n+\n+      <updated>2020-12-09T14:22:41+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Alin Voinea: Volto Dexterity Schema and Layout Editor</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/alin-voinea-volto-dexterity-schema-and-layout-editor" />\n+\n+\n+\n+      <id>urn:syndication:e78a4c57d7c28e52be32a25b83f7c466</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>Through the Web Dexterity Content-Types with Schema Editor and Blocks Layout Editor</p>\n+<p>How do we define content types schemas in Plone?</p>\n+<ul class="simple">\n+<li>TTW schema editor</li>\n+<li>GenericSetup profile</li>\n+<li>Behaviors, schemas in Python</li>\n+</ul>\n+<p>Why do we need them, we have Volto blocks, right?\n+You still need metadata, a title, etcetera. Certainly for larger institutions you need a structure, a schema.\n+Volto itself has schema-based components.</p>\n+<p>Layout editor.\n+Blocks have properties, like a placeholder, a position.\n+You can type text in a block: &quot;Published on date by author&quot;.\n+Then select &quot;date&quot; and link this text to the published date metadata,\n+and select &quot;author&quot; and link it to the author.\n+Save this as a layout for a content type.\n+You can export this to a JSONField in a custom behavior, so you can save it in version control for production.</p>\n+<p>List of add-ons and other packages that make Volto awesome:\n+<a class="reference" href="https://github.com/collective/awesome-volto">https://github.com/collective/awesome-volto</a></p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-08T17:40:59+00:00</published>\n+\n+      <updated>2020-12-08T17:40:59+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Jens Klein: Performance, Profiling, Power-Consumption</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/jens-klein-performance-profiling-power-consumption" />\n+\n+\n+\n+      <id>urn:syndication:8c53225f93c004d147e18d907160144d</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>I want to focus on Python performance, so not caching or database performance.</p>\n+<p>Tools:</p>\n+<ul class="simple">\n+<li><tt class="docutils literal"><span class="pre">py-spy</span></tt>: Overall mix of the whole live application, top-like.</li>\n+<li><tt class="docutils literal"><span class="pre">repoze.profile</span></tt>: WSGI middleware, slows down application. Profile single request and analyse its call stack by count, call time, etc.</li>\n+<li><tt class="docutils literal"><span class="pre">dis</span></tt>: disassembler for Python at the bytecode level.</li>\n+</ul>\n+<p>Improvements Plone 5.2.0-5.2.3:</p>\n+<ul class="simple">\n+<li>Avoided early <tt class="docutils literal"><span class="pre">providedBy</span></tt> calls</li>\n+<li><tt class="docutils literal"><span class="pre">__getattr__</span></tt> early exit on common attributes</li>\n+<li><tt class="docutils literal"><span class="pre">zope.interface</span></tt>: some functions are called hundreds of thousands of times when you reindex an index, so a tiny improvement helps a lot. I found various places that could use improvements, and that landed in the package, together with memory improvements by Jason Madden.</li>\n+</ul>\n+<p>Live demo. I call <tt class="docutils literal"><span class="pre">py-spy</span></tt> with <tt class="docutils literal"><span class="pre">sudo</span></tt> because I need to connect to an existing process id.</p>\n+<p>Future Todo\'s:</p>\n+<ul class="simple">\n+<li><tt class="docutils literal"><span class="pre">plone.restapi</span></tt> has optimization potential, all navigation related, but currently it still supports even Plone 4.3. This will likely wait for a 5.2-only or Python3-only branch.</li>\n+<li><tt class="docutils literal"><span class="pre">plone.registry</span></tt> is called too often</li>\n+<li>Use <tt class="docutils literal"><span class="pre">python:</span></tt> expressions in all page templates. They are way faster than standard Tales expressions.</li>\n+<li>More introspection.</li>\n+<li>Move more logic from page templates to Python code</li>\n+</ul>\n+<p>Advice: start introspecting the performance of your application.</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-08T16:27:53+00:00</published>\n+\n+      <updated>2020-12-08T16:27:53+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Alex Clark: The State of Pillow</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/alex-clark-the-state-of-pillow" />\n+\n+\n+\n+      <id>urn:syndication:e34819d893c83228742eda41c42063d6</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>The Plone Conference account tweeted that a State of Plone talk would be awesome and that the Plone community missed me. I miss the Plone community too, so I am here.</p>\n+<p>I will state it clearly: Pillow would not exist if not for Plone.</p>\n+<p>In July 2010 I announced Pillow as &quot;friendly&quot; fork of PIL. The <a class="reference" href="https://mail.python.org/pipermail/image-sig/2010-July/006423.html">mailing thread</a> and future answers are interesting to read.</p>\n+<p>Some history:</p>\n+<ul class="simple">\n+<li>1991: Python 0.9.1</li>\n+<li>1995: PIL started</li>\n+<li>1998: Zope</li>\n+<li>1999: Zope2</li>\n+<li>2000: Python 2.0 with distutils</li>\n+<li>2001: Plone</li>\n+<li>2005: Buildout</li>\n+<li>2006: I attended my first Plone Conference, in Washington</li>\n+<li>2006: setuptools was born</li>\n+</ul>\n+<p>PIL had an issue, or Plone had an issue with PIL:</p>\n+<ul class="simple">\n+<li>PIL used distutils.</li>\n+<li>Plone 3.2 used Buildout and setuptools</li>\n+<li>PIL was not installable in Buildout and setuptools</li>\n+<li>Specific problem: <tt class="docutils literal"><span class="pre">import</span> <span class="pre">Image</span></tt> could mean the Image module from PIL, or the Image module from Zope.</li>\n+</ul>\n+<p>Various ways of repackaging PIL started, for example <tt class="docutils literal"><span class="pre">PILwoTk</span></tt>. You can still find various PIL derivatives at <a class="reference" href="https://dist.plone.org/thirdparty/">https://dist.plone.org/thirdparty/</a></p>\n+<p>PIL 1.1.6 from 2006 is still the last version on <a class="reference" href="https://pypi.org/project/PIL/#history">PyPI</a>. I got maintainership of this page this year, actually.\n+Pillow 1.0 is basically the same, except that it uses <tt class="docutils literal"><span class="pre">setuptools</span></tt>.\n+This worked in buildout.\n+I was happy.</p>\n+<p>Couple years, nothing really interesting happened.\n+But some contributors came along.\n+Pillow 2.0.0 in March 2013 had Python 3 support.</p>\n+<p>An important milestone in 2015: we added release notes.</p>\n+<p>Release schedule: in the beginning of every quarter.</p>\n+<p>We get some money from Tidelift for maintenance.</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-08T16:23:06+00:00</published>\n+\n+      <updated>2020-12-08T16:26:22+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Lightning talks Monday</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/lightning-talks-monday" />\n+\n+\n+\n+      <id>urn:syndication:73d847717e4336392db709c0738ec383</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <div class="section" id="alec-mitchell-wysiwyg-problems-be-gone">\n+<h3><a name="alec-mitchell-wysiwyg-problems-be-gone">Alec Mitchell: WYSIWYG problems be gone</a></h3>\n+<p>A new add-on to vastly* improve your content editing experience.</p>\n+<p>(* size of improvement may vary, no warranty implied. The following is (un)paid free software promotional content)</p>\n+<p>Adding images to a document is so hard! At least nine steps! (Difficulty be exaggerated for marketing purposes).\n+Why can\'t you drop an image in?\n+You can, with our new, super special add-on <a class="reference" href="https://pypi.org/project/kcrw.tinymce-imagedrop/">krcw.tinymce_imagedrop</a>.</p>\n+<p>Can you drop two?\n+Yes!</p>\n+<p>Can you drop more than two?\n+No, because browsers are weird.</p>\n+<p>But it fails gracefully.</p>\n+</div>\n+<div class="section" id="steve-piercy-deform-and-friends">\n+<h3><a name="steve-piercy-deform-and-friends">Steve Piercy: Deform and friends</a></h3>\n+<p>How I learned to stop worrying and love web forms.\n+We must have a good interface, data structure, validation, security.\n+Deform (form library), colander (de/serialization), peppercorn (data structure), bootstrap forms for design.\n+We have a looooong list of widgets.\n+In deform 3.0 we will use bootstrap 5.\n+See <a class="reference" href="https://github.com/pylons/deform">https://github.com/pylons/deform</a></p>\n+</div>\n+<div class="section" id="christopher-lozinski-forest-wiki">\n+<h3><a name="christopher-lozinski-forest-wiki">Christopher Lozinski: Forest Wiki</a></h3>\n+<p>The <a class="reference" href="https://forestwiki.com/">Forest Wiki</a> is a modern version of Zope 2.\n+Biggest difference: it uses Pyramid\'s security and views.\n+Modern JavaScript enabled ZMI: reorder, sort, rename, etc.\n+Both WYSIWYG and MarkDown pages.\n+Advanced types like JSON, CoffeeScript, pug. Pug is the leading template engine for Node.</p>\n+</div>\n+<div class="section" id="jens-klein-relstorage">\n+<h3><a name="jens-klein-relstorage">Jens Klein: RelStorage</a></h3>\n+<p>Plone relational database backend storage.\n+It is a drop-in replacement for FileStorage of ZEO.\n+You can use PostgreSQL, MySQL, Oracle, SQLite.\n+It has been around for about 13 years, grown old, but in recent years development has picked up, driven by Jason Madden, including Python 3 support. It is much more performant.\n+Latest release 3.4.0 is form October 2020.</p>\n+<p>PostgreSQL is the cloud database, kind of industry standard, well supported by all big cloud providers.\n+Easy to install in Docker.</p>\n+<p>Advantages of RelStorage: fast, parallel commits, better concurrency, shorter locks.\n+Optimized per process caching.\n+Blobs in database.\n+Optionally you can use it in history free mode. You lose the Undo functionality, but you don\'t need to pack so often.</p>\n+<p><tt class="docutils literal"><span class="pre">plone.recipe.zope2instance</span></tt> supports it with the <tt class="docutils literal"><span class="pre">rel-storage</span></tt> option.</p>\n+<p>You can use additional client side caches, shared between all threads of a process.</p>\n+<p>With the <tt class="docutils literal"><span class="pre">zodbconvert</span></tt> tool you convert from ZEO to RelStorage, or the other way around, including converting blobs if needed.</p>\n+<p>ZODB keeps old transactions, so packing is needed, even in history free mode. RelStorage has a fast <tt class="docutils literal"><span class="pre">zodbpack</span></tt>.</p>\n+<p>Blobs:</p>\n+<ul>\n+<li><p class="first">RelStorage 3.x is Python 3 only and runs with Plone 5.2+. Here, blobs should be stored in RelStorage.</p>\n+</li>\n+<li><p class="first">RelStorage 2.x is for Plone 5.0, 5.1, and blobs should <a href="#id1" name="id2"><span class="problematic" id="id2">**</span></a>not**&nbsp; be stored in the database, except for Oracle backends, otherwise you should still use a shared blobs filesystem directory.</p>\n+<div class="system-message" id="id1">\n+<p class="system-message-title">System Message: <a name="id1">WARNING/2</a> (<tt class="docutils">&lt;string&gt;</tt>, line 69); <em><a href="#id2">backlink</a></em></p>\n+<p>Inline strong start-string without end-string.</p>\n+</div>\n+</li>\n+</ul>\n+<p>I use RelStorage today for all my live deployments. I have used it since version 1.6 with Plone 4.3 and never had problems. Always blazing fast. Dev/ops and sysadmins love it: it is a standard solution, nothing special, just works.</p>\n+</div>\n+<div class="section" id="maik-derstappen-add-on-catalog-for-plone">\n+<h3><a name="maik-derstappen-add-on-catalog-for-plone">Maik Derstappen: Add-on catalog for Plone</a></h3>\n+<p>We want to bring back an add-on catalog for Plone. You can look on PyPI, but it is hard to find packages.</p>\n+<p>We worked on a tool for this. You can search on named, filter on Plone versions and add-on types.</p>\n+<p>Components:</p>\n+<ul class="simple">\n+<li>The <a class="reference" href="https://github.com/collective/pyf.aggregator">Python Package Filter Aggregator</a> (<tt class="docutils literal"><span class="pre">pyf.aggregator</span></tt>) aggregates the meta information of all Python packages in the PyPI.</li>\n+<li>an <a class="reference" href="https://github.com/collective/pyf.api">api</a> using elasticsearch</li>\n+<li>a <a class="reference" href="https://github.com/collective/pyf-svelte-gui">prototype in Svelte</a></li>\n+</ul>\n+<p>We only aggregate packages that have classifier <tt class="docutils literal"><span class="pre">Plone</span> <span class="pre">::</span> <span class="pre">Framework</span></tt>.\n+We will probably work on this during the sprints and are happy to onboard you.</p>\n+</div>\n+<div class="section" id="david-bain-plone-and-webflow">\n+<h3><a name="david-bain-plone-and-webflow">David Bain: Plone and Webflow</a></h3>\n+<p>Both platforms are for building websites, but they approach things in different ways.\n+I hope this may inspire.\n+Keep in mind the motivation of the two platforms, which may account for some strengths and weaknesses.</p>\n+<p>Webflow is visual web design, less content management. Strong design tools.\n+Designer friendly layout tools.\n+You can design a page with what you could call blocks.</p>\n+<p>Plone is enterprise content management, focus on security.\n+Linking to an attachment is standard, where it is tricky in Webflow.\n+Forms are way more flexible.</p>\n+<p>We have also built a website in Webflow and based it on Plone.</p>\n+</div>\n+<div class="section" id="steve-piercy-pyramid-project-in-pycharm-professional">\n+<h3><a name="steve-piercy-pyramid-project-in-pycharm-professional">Steve Piercy: Pyramid Project in PyCharm Professional</a></h3>\n+<p>It is easy to create a such a project. Demo.\n+See <a class="reference" href="https://stevepiercy.github.io/pppp/">https://stevepiercy.github.io/pppp/</a></p>\n+</div>\n+<div class="section" id="miu-razvan-volto-grid-block">\n+<h3><a name="miu-razvan-volto-grid-block">Miu Razvan: Volto grid block</a></h3>\n+<ul class="simple">\n+<li>Created by Eau de Web team</li>\n+<li>Dependencies: Volto blocks form</li>\n+<li>Similar component: Volto columns block</li>\n+<li>Use it to organize other blocks.</li>\n+<li>Demo showing lots of configuration options, including for different screen sizes</li>\n+<li>See <a class="reference" href="https://github.com/eea/volto-grid-block">https://github.com/eea/volto-grid-block</a></li>\n+</ul>\n+</div>\n+<div class="section" id="maik-derstappen-custom-elements">\n+<h3><a name="maik-derstappen-custom-elements">Maik Derstappen: Custom elements</a></h3>\n+<p>Custom elements are an extension to normal native html elements, for example <tt class="docutils literal"><span class="pre">&lt;flag-icon&gt;</span></tt>.</p>\n+<p>The promise of web components: write once, use anywhere.\n+See <a class="reference" href="https://custom-elements-everywhere.com/">https://custom-elements-everywhere.com/</a></p>\n+<p>How do you use this in Plone?\n+Use <tt class="docutils literal"><span class="pre">plonecli</span> <span class="pre">add</span> <span class="pre">svelte_app</span></tt> to create a small app. Run <tt class="docutils literal"><span class="pre">yarn</span></tt>. Install in Plone add-ons control panel.\n+Edit a page. Replace html source with <tt class="docutils literal"><span class="pre">&lt;my-svelte-app</span> <span class="pre">/&gt;</span></tt>.\n+And your component is there and working.\n+The size is less than five&nbsp; kilobytes.</p>\n+</div>\n+<div class="section" id="tiberiu-ichim-volto-slate">\n+<h3><a name="tiberiu-ichim-volto-slate">Tiberiu Ichim: volto-slate</a></h3>\n+<p><tt class="docutils literal"><span class="pre">volto-slate</span></tt> is a drop-in replacement for the standard rich text editor in Volto.\n+Volto turns an HTML document into a modern document.</p>\n+<p>Why another text editor instead of improving the existing one?</p>\n+<ul class="simple">\n+<li>With Slate we get a better plugin framework. Plugins are just wrappers around the editor. The standard Draft.js is meant to be integrated directly by an application, no concept of plugins out-of-the-box.</li>\n+<li>Slate has simple DOM-like storage for its values, making it easier to render the ersult.</li>\n+</ul>\n+<p>Current status:</p>\n+<ul class="simple">\n+<li>No migrations of any kind.</li>\n+<li>Right now not possible to completely remove or replace Draftjs out of Volto.</li>\n+</ul>\n+</div>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-08T11:53:56+00:00</published>\n+\n+      <updated>2020-12-09T10:19:52+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Fred van Dijk: collective.collectionfilter as a Light-weight Faceted Navigation or a \'compare\' Console</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/fred-van-dijk-collective-collectionfilter-as-a-light-weight-faceted-navigation-or-a-compare-console" />\n+\n+\n+\n+      <id>urn:syndication:0a9da3a3170511af38154da7691da92a</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>I want to talk about some categorisation and classification options in Plone, next to the folder structure.</p>\n+<p>Faceted navigation: drill down on \'facets\' when you search for items. It was popularized by online shopping. Facets in Plone for developers is: whatever is in the ZCatalog, and for users: what you can search on in Collections.\n+Gold standard is <a class="reference" href="https://github.com/eea/eea.facetednavigation">eea.facetednavigation</a>, developed for the European Environment Agency. Examples: <a class="reference" href="https://www.eea.europa.eu/highlights">EEA</a>,  and on two sites by Zest: <a class="reference" href="https://vaquums.eu/sensor-db">Vaquums</a> and <a class="reference" href="https://www.minaraad.be/zoeken">Minaraad</a>, where it replaces the standard search.</p>\n+<p>collective.collectionfilter is a much leaner, meaner, but also more limited version of faceted navigation. Demo with standard Plone News Items with some tags (also known as categories, also known as Subject). Add a Collection that filters on News Items. Now add collection filter portlets.</p>\n+<p>eea.facetednavigation takes over your complete page. In an action you enable or disable it.</p>\n+<p>Now a demo of collectionfilter in SGBP, a documentation website for water management planning in Belgium/Flanders. The customer wanted to take some graphs and compare them. We did that with collectionfilter and collective.classifiers. With the last one we added structured categories: one for water basins and one for parameters of the graphs. Now we use collectionfilter to query a parameter and show the graphs for all water basins.</p>\n+<p>You can adapt several things in the collectionfilter UI, for example change how search options are displayed. This is documented, but took me a while to get right.</p>\n+<p>Collectionfilter also works with Mosaic, because the portlets are also mapped to tiles.</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-07T21:10:20+00:00</published>\n+\n+      <updated>2020-12-07T21:10:20+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+\n+    <entry>\n+\n+      <title>Asko Soukka: Plone and Volto in a Jamstack project</title>\n+\n+      <link rel="alternate" type="text/html"\n+            href="https://maurits.vanrees.org/weblog/archive/2020/12/asko-soukka-plone-and-volto-in-a-jamstack-project" />\n+\n+\n+\n+      <id>urn:syndication:a2b3ebe0e81fdf7ce953cb80333b0919</id>\n+\n+\n+\n+\n+\n+\n+      <content type="html"\n+               xml:base="https://maurits.vanrees.org"\n+               xml:lang="en-US" xml:space="preserve">\n+          <![CDATA[\n+          <p>Here are the <a class="reference" href="https://datakurre.github.io/ploneconf2020/plone-and-volto-in-jamstack-project.pdf">slides</a>.</p>\n+<p>I am a software architect at University of Jyv\xc3\xa4skyl\xc3\xa4. I have been using Plone since 2004 and GatsbyJS since 2018.\n+The university wanted one student information management system to rule them all, but... every organisation shall do their own integrations, using granular REST API with deep JSON responses. And there should be branded study guides, which we crafted with GatsbyJS. But this was not enough for the Open University part. They really needed a CMS.</p>\n+<p>We use Plone 5.2, Volto, GatsbyJS, and have 6000 html pages, times two languages, out of which 760 are Volto pages.\n+With Plone we could extend content types without needing to do any coding, in the content types field editor. In volto we added auto-complete widgets with custom vocabularies. On the GatsbyJs side, we query the connected pages with GraphQL. We render Volto layouts with React components, rendering individual blocks.</p>\n+<p>Why did we choose GatsbyJs? It is a ReactJS-based site generator. Being static, it is very fast. You can use multiple sources as input, using a plugin architecture. Data lookup is done with GraphQL. It is easy to get started, with comprehensive documentation.</p>\n+<p>I mentored two Google Summer of Code projects for the <tt class="docutils literal"><span class="pre">gatsby-source-plone</span></tt> plugin. It supports default types and most TTW types, also Volto blocks. You can do incremental updates by modification date, so it is really fast.</p>\n+<p>Not everything is easy. The full &quot;GatsbyJs experience&quot; requires practice. You want to replace inline images and links with GatsbyJs images and links, replace file links with direct downloads.</p>\n+<p>Using <tt class="docutils literal"><span class="pre">&#64;plone/volto</span></tt> as dependency to render blocks seemed like a good idea, but it required webpack overrides to be impartable, and could not be used for images and links.</p>\n+<p>The ugly parts of GatsbyJs:</p>\n+<ul class="simple">\n+<li>The GraphQL source plugin cannot cache.</li>\n+<li>The build may take hours, and gigabytes of memory.</li>\n+<li>The build result in readonly.</li>\n+<li>For me it is hard to follow GatsbyJs development, especially individual plugins, because they use a monorepo.</li>\n+</ul>\n+<p>Editors can work on the site during the day, and then wee rebuild the result during the night</p>\n+\n+          ]]>\n+      </content>\n+\n+\n+\n+      <author>\n+        <name>Maurits van Rees</name>\n+      </author>\n+\n+      <published>2020-12-07T17:54:09+00:00</published>\n+\n+      <updated>2020-12-07T17:54:09+00:00</updated>\n+\n+\n+        <category term="plone" />\n+\n+\n+        <category term="ploneconf2020" />\n+\n+\n+    </entry>\n+\n+\n+\n+</feed>\ndiff --git a/plone/app/portlets/tests/test_rss_portlet.py b/plone/app/portlets/tests/test_rss_portlet.py\nindex 7d47b67f..8e5adc20 100644\n--- a/plone/app/portlets/tests/test_rss_portlet.py\n+++ b/plone/app/portlets/tests/test_rss_portlet.py\n@@ -3,6 +3,7 @@\n \n from Products.GenericSetup.utils import _getDottedName\n \n+from plone.namedfile.file import NamedBlobFile\n from plone.portlets.interfaces import IPortletType\n from plone.portlets.interfaces import IPortletManager\n from plone.portlets.interfaces import IPortletAssignment\n@@ -10,11 +11,23 @@\n from plone.portlets.interfaces import IPortletRenderer\n \n from plone.app.portlets.portlets import rss\n+from plone.app.portlets.testing import PLONE_APP_PORTLETS_FUNCTIONAL_TESTING\n from plone.app.portlets.tests.base import PortletsTestCase\n from plone.app.testing import TEST_USER_ID\n from plone.app.testing import setRoles\n \n \n+import os\n+import transaction\n+import unittest\n+\n+\n+# Take a sample feed.  In this case an atom feed instead of RSS.\n+# Taken from https://maurits.vanrees.org/weblog/topics/plone/@@atom.xml\n+here = os.path.dirname(__file__)\n+sample_feed = os.path.join(here, "atom_feed_maurits.xml")\n+\n+\n class TestPortlet(PortletsTestCase):\n \n     def afterSetUp(self):\n@@ -59,6 +72,17 @@ def testRenderer(self):\n         renderer = getMultiAdapter((context, request, view, manager, assignment), IPortletRenderer)\n         self.assertTrue(isinstance(renderer, rss.Renderer))\n \n+    def testRSSFeedFile(self):\n+        # We should not be able to read a file from the file system.\n+        # We pass a url and a timeout in minutes\n+        feed = rss.RSSFeed("file://" + sample_feed, 1)\n+        feed._retrieveFeed()\n+        self.assertTrue(feed._loaded)\n+        self.assertTrue(feed._failed)\n+        self.assertFalse(feed.ok)\n+        self.assertFalse(feed.siteurl)\n+        self.assertEqual(len(feed.items), 0)\n+\n \n class TestRenderer(PortletsTestCase):\n \n@@ -82,6 +106,31 @@ def testTitle(self):\n         self.assertEqual(r.title, u\'Overridden title\')\n \n \n+class TestFunctional(unittest.TestCase):\n+    layer = PLONE_APP_PORTLETS_FUNCTIONAL_TESTING\n+\n+    def test_rss_feed_http(self):\n+        # First prepare a file in the current site,\n+        # so that we can try to load this via http.\n+        with open(sample_feed, "rb") as myfile:\n+            data = myfile.read()\n+        file_field = NamedBlobFile(data, filename=u"feed.xml")\n+        portal = self.layer["portal"]\n+        feed_id = portal.invokeFactory("File", "feed")\n+        feed = portal[feed_id]\n+        feed.file = file_field\n+        transaction.commit()\n+\n+        # Eat the feed.\n+        feed = rss.RSSFeed(feed.absolute_url(), 1)\n+        feed._retrieveFeed()\n+        self.assertTrue(feed._loaded)\n+        self.assertFalse(feed._failed)\n+        self.assertTrue(feed.ok)\n+        self.assertEqual(feed.siteurl, u"https://maurits.vanrees.org/weblog")\n+        self.assertEqual(len(feed.items), 15)\n+\n+\n def test_suite():\n     from unittest import TestSuite, makeSuite\n     suite = TestSuite()\n'

