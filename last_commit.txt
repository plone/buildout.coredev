Repository: plone.releaser


Branch: refs/heads/master
Date: 2022-12-20T01:07:33+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.releaser/commit/23c7b5fa9c834f431bf6ae08f69fb28569bd2b5a

Fix ValueError when calling 'bin/manage launchpad 5.2.10.1'

```
$ bin/manage launchpad 5.2.10.1
Traceback (most recent call last):
  File "bin/manage", line 71, in &lt;module&gt;
    sys.exit(plone.releaser.manage.manage())
  File "/Users/maurits/shared-eggs/cp27m/plone.releaser-1.8.7-py2.7.egg/plone/releaser/manage.py", line 181, in __call__
    parser.dispatch()
  File "/Users/maurits/shared-eggs/cp27m/argh-0.26.2-py2.7.egg/argh/helpers.py", line 55, in dispatch
    return dispatch(self, *args, **kwargs)
  File "/Users/maurits/shared-eggs/cp27m/argh-0.26.2-py2.7.egg/argh/dispatching.py", line 174, in dispatch
    for line in lines:
  File "/Users/maurits/shared-eggs/cp27m/argh-0.26.2-py2.7.egg/argh/dispatching.py", line 277, in _execute_command
    for line in result:
  File "/Users/maurits/shared-eggs/cp27m/argh-0.26.2-py2.7.egg/argh/dispatching.py", line 260, in _call
    result = function(*positional, **keywords)
  File "/Users/maurits/shared-eggs/cp27m/plone.releaser-1.8.7-py2.7.egg/plone/releaser/manage.py", line 126, in create_launchpad_release
    parsed_version = StrictVersion(version)
  File "/Users/maurits/.pyenv/versions/2.7.18/lib/python2.7/distutils/version.py", line 40, in __init__
    self.parse(vstring)
  File "/Users/maurits/.pyenv/versions/2.7.18/lib/python2.7/distutils/version.py", line 107, in parse
    raise ValueError, "invalid version number '%s'" % vstring
ValueError: invalid version number '5.2.10.1'
```

Files changed:
A news/45.bugfix
M plone/releaser/manage.py

b'diff --git a/news/45.bugfix b/news/45.bugfix\nnew file mode 100644\nindex 0000000..37feb95\n--- /dev/null\n+++ b/news/45.bugfix\n@@ -0,0 +1,2 @@\n+Fix ValueError when calling ``bin/manage launchpad 5.2.10.1``.\n+[maurits]\ndiff --git a/plone/releaser/manage.py b/plone/releaser/manage.py\nindex d4cad5b..55163ad 100644\n--- a/plone/releaser/manage.py\n+++ b/plone/releaser/manage.py\n@@ -123,7 +123,14 @@ def changelog(**kwargs):\n def create_launchpad_release(version):\n     launchpad = Launchpad.login_with("plone.releaser", "production")\n     plone = launchpad.projects["plone"]\n-    parsed_version = StrictVersion(version)\n+    try:\n+        parsed_version = StrictVersion(version)\n+    except ValueError:\n+        # ValueError: invalid version number \'5.2.10.1\'\n+        if version.count(".") < 3:\n+            raise\n+        adapted_version = ".".join(version.split(".")[:3])\n+        parsed_version = StrictVersion(adapted_version)\n     # Blech. This feels flimsy\n     series_name = ".".join([str(a) for a in parsed_version.version[0:2]])\n     series = plone.getSeries(name=series_name)\n'

Repository: plone.releaser


Branch: refs/heads/master
Date: 2022-12-20T10:08:14+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.releaser/commit/6c3173e1f59110d164b20302b2e7a6781fc0e702

Merge pull request #45 from plone/maurits-fix-launchpad-for-too-many-dots

Fix ValueError when calling 'bin/manage launchpad 5.2.10.1'

Files changed:
A news/45.bugfix
M plone/releaser/manage.py

b'diff --git a/news/45.bugfix b/news/45.bugfix\nnew file mode 100644\nindex 0000000..37feb95\n--- /dev/null\n+++ b/news/45.bugfix\n@@ -0,0 +1,2 @@\n+Fix ValueError when calling ``bin/manage launchpad 5.2.10.1``.\n+[maurits]\ndiff --git a/plone/releaser/manage.py b/plone/releaser/manage.py\nindex d4cad5b..55163ad 100644\n--- a/plone/releaser/manage.py\n+++ b/plone/releaser/manage.py\n@@ -123,7 +123,14 @@ def changelog(**kwargs):\n def create_launchpad_release(version):\n     launchpad = Launchpad.login_with("plone.releaser", "production")\n     plone = launchpad.projects["plone"]\n-    parsed_version = StrictVersion(version)\n+    try:\n+        parsed_version = StrictVersion(version)\n+    except ValueError:\n+        # ValueError: invalid version number \'5.2.10.1\'\n+        if version.count(".") < 3:\n+            raise\n+        adapted_version = ".".join(version.split(".")[:3])\n+        parsed_version = StrictVersion(adapted_version)\n     # Blech. This feels flimsy\n     series_name = ".".join([str(a) for a in parsed_version.version[0:2]])\n     series = plone.getSeries(name=series_name)\n'

