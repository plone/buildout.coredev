Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-10-23T17:21:58+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/26632abf8eaae7c086fa251c5a21d8a4f65cae3f

fix tests for newest contentbrowser updates

see

Files changed:
M Products/CMFPlone/tests/robot/keywords.robot
M Products/CMFPlone/tests/robot/test_contentbrowser.robot
M Products/CMFPlone/tests/robot/test_edit.robot
M Products/CMFPlone/tests/robot/test_linkintegrity.robot
M Products/CMFPlone/tests/robot/test_querystring.robot
M Products/CMFPlone/tests/robot/test_tinymce.robot

b'diff --git a/Products/CMFPlone/tests/robot/keywords.robot b/Products/CMFPlone/tests/robot/keywords.robot\nindex f4bb2d383e..7e7254ee5d 100644\n--- a/Products/CMFPlone/tests/robot/keywords.robot\n+++ b/Products/CMFPlone/tests/robot/keywords.robot\n@@ -69,6 +69,12 @@ Remove line from textarea\n     Type Text    //textarea[@name="${fieldName}"]    ${lines}\n \n \n+Click item in contenbrowser column\n+    [arguments]  ${colnumber}    ${itemposition}\n+    Wait For Condition    Element States    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[${colnumber}]/div[contains(@class, "levelItems")]/div[${itemposition}]    contains    visible\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[${colnumber}]/div[contains(@class, "levelItems")]/div[${itemposition}]\n+\n+\n Fill text to tinymce editor\n     [Arguments]    ${text}\n \ndiff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nindex b7b935166d..e370ffa17c 100644\n--- a/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -114,17 +114,17 @@ I select a related item image via contentbrowser\n    # Click the Categorization Tab\n    Click    //a[@id="autotoc-item-autotoc-2"]\n    # Click the select button\n-   Click    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n+   Click    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//a[contains(@class, "btn-primary")]\n    # Click third element in first column, that is the "Assets" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[4]\n+   Click item in contenbrowser column    1    4\n    # Click first element in second column, that is the "Mixed" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n+   Click item in contenbrowser column    2    1\n    # Click fifth element in third column, that is the "Files" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[5]\n+   Click item in contenbrowser column    3    5\n    # Click third element in fourth column, that is the "Images" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[3]\n+   Click item in contenbrowser column    4    3\n    # Click second element in fifth column, that is the "Image2" Object\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]\n+   Click item in contenbrowser column    5    2\n    # Click the select Button in the Toolbar of column 6\n    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[6]/div[contains(@class, "levelToolbar")]/button\n \n@@ -134,19 +134,19 @@ I select two related item images via contentbrowser\n    # Click the Categorization Tab\n    Click    //a[@id="autotoc-item-autotoc-2"]\n    # Click the select button\n-   Click    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n+   Click    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//a[contains(@class, "btn-primary")]\n    # Click third element in first column, that is the "Assets" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[4]\n+   Click item in contenbrowser column    1    4\n    # Click first element in second column, that is the "Mixed" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n+   Click item in contenbrowser column    2    1\n    # Click fifth element in third column, that is the "Files" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[5]\n+   Click item in contenbrowser column    3    5\n    # Click third element in fourth column, that is the "Images" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[3]\n+   Click item in contenbrowser column    4    3\n \n    # now we select two items in a colum via Shift+Click\n    # Click first element in fifth column, that is the "Image1" Object\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[1]\n+   Click item in contenbrowser column    5    1\n    # Click second element in fifth column with SHIFT, that is the "Image2" Object\n    Click With Options    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]    left    Shift\n    # Click the select Button in the Toolbar of column 6\n@@ -168,51 +168,47 @@ I set an internal link via contentbrowser\n     ...        iframe_document.getSelection().addRange(range);\n     ...    }\n     ...    all_elements=False\n-    Click    //button[@aria-label=\'Insert/edit link\']\n-    Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click item in column    1    3\n+    Click tiny button and open contentbrowser    Insert/edit link\n+    Click item in contenbrowser column    1    3\n     Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Click    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n \n I set an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n     Fill text to tinymce editor    Susi Sorglos and John Doe\n-    Click    //button[@aria-label=\'Insert/edit image\']\n-    Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click item in column    1    3\n-    Click item in column    2    1\n-    Click item in column    3    1\n+    Click tiny button and open contentbrowser    Insert/edit image\n+    Click item in contenbrowser column    1    3\n+    Click item in contenbrowser column    2    1\n+    Click item in contenbrowser column    3    1\n     Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Click    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n \n I upload an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n     Fill text to tinymce editor    Susi Sorglos and John Doe\n-    Click    //button[@aria-label="Insert/edit image"]\n-    Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click item in column    1    3\n-    Click item in column    2    1\n+    Click tiny button and open contentbrowser    Insert/edit image\n+    Click item in contenbrowser column    1    3\n+    Click item in contenbrowser column    2    1\n     Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//button[contains(@class,"upload")]\n     Upload File By Selector    //div[contains(@class,"pat-upload")]//input[@class="dz-hidden-input"]    ${PATH_TO_TEST_FILES}/plone-logo.png\n     Click    //div[contains(@class,"pat-upload")]//button[contains(@class,"upload-all")]\n-    Click item in column    3    3\n+    Click item in contenbrowser column    3    3\n     Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Click    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n \n I search and select an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n     Fill text to tinymce editor    Susi Sorglos and John Doe\n-    Click    //button[@aria-label="Insert/edit image"]\n-    Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click item in column    1    3\n-    Click item in column    2    1\n-    Click item in column    3    2\n-    Click item in column    4    1\n+    Click tiny button and open contentbrowser    Insert/edit image\n+    Click item in contenbrowser column    1    3\n+    Click item in contenbrowser column    2    1\n+    Click item in contenbrowser column    3    2\n+    Click item in contenbrowser column    4    1\n     Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]\n     Type Text    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]    Anot\n     # here we need a timeout, because the search filter is not so fast like the testbrowser, it looks like a asynch operation\n     Sleep    1\n-    Click item in column    5    1\n+    Click item in contenbrowser column    5    1\n     Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Click    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n \n@@ -258,6 +254,8 @@ Element exists\n     [arguments]  ${xpath}    ${attr}    ${value}\n     Wait for condition    Attribute    ${xpath}    ${attr}    should end with    ${value}\n \n-Click item in column\n-    [arguments]  ${colnumber}    ${itemposition}\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[${colnumber}]/div[contains(@class, "levelItems")]/div[${itemposition}]\n+Click tiny button and open contentbrowser\n+    [arguments]  ${label}\n+    Click    //button[@aria-label="${label}"]\n+    Wait for Condition    Element States    //div[@class="linkModal"]    contains    visible\n+    Click    //div[@class="linkModal"]//div[contains(@class, "content-browser-selected-items-wrapper")]//a[contains(@class, "btn-primary")]\ndiff --git a/Products/CMFPlone/tests/robot/test_edit.robot b/Products/CMFPlone/tests/robot/test_edit.robot\nindex aede766e59..928778ee61 100644\n--- a/Products/CMFPlone/tests/robot/test_edit.robot\n+++ b/Products/CMFPlone/tests/robot/test_edit.robot\n@@ -110,20 +110,20 @@ I click the ${tab} tab\n \n I select a related item\n     # Click the select button\n-    Click    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n+    Click    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//a[contains(@class, "btn-primary")]\n     # Click first element in first column\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[1]\n+    Click item in contenbrowser column    1    1\n     # Click the select Button in the Toolbar of column 2\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelToolbar")]/button\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelToolbar")]//button[contains(@class, "btn-primary")]\n \n I select a linked item\n     # Click the select button\n-    Click  //div[@id="formfield-form-widgets-remoteUrl"]//button\n+    Click  //div[@id="formfield-form-widgets-remoteUrl"]//a[contains(@class, "btn-primary")]\n     # Click first element in first column\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[1]\n+    Click item in contenbrowser column    1    1\n     # Click the select Button in the Toolbar of column 2\n     # This selects the "test-folder"\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelToolbar")]/button\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelToolbar")]//button[contains(@class, "btn-primary")]\n \n I save the page\n     Click    //button[@name="form.buttons.save"]\n@@ -170,6 +170,7 @@ no other tab is shown\n \n at least one other item\n     Go to    ${PLONE_URL}/++add++Document\n+    Wait For Condition    Classes    //body    contains    patterns-loaded\n     Type Text    //input[@id="form-widgets-IDublinCore-title"]    ${TITLE}\n     Click    //button[@name="form.buttons.save"]\n-    Get Text    //body    contains    Item created\n\\ No newline at end of file\n+    Get Text    //body    contains    Item created\ndiff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex 79d30dc4ad..a476af3476 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -60,9 +60,9 @@ I add a link in rich text\n     Fill text to tinymce editor    foo\n     Mark text foo in tinymce editor\n     Click    //button[@aria-label="Insert/edit link"]\n-    Click    //div[contains(@class,"linkModal")]//div[contains(@class,"content-browser-selected-items-wrapper")]//button[contains(@class,"btn-primary")]\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Click    //div[contains(@class,"linkModal")]//div[contains(@class,"content-browser-selected-items-wrapper")]//a[contains(@class,"btn-primary")]\n+    Click item in contenbrowser column    1    3\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]//button[contains(@class, "btn-primary")]\n     Click    //div[contains(@class,"modal-footer")]//input[@name="insert"]\n     Click    //button[@name="form.buttons.save"]\n     Get Text    //body    contains    Changes saved\ndiff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex ae0a1a3bf4..fa5539976f 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -32,7 +32,7 @@ Scenario: Location query Custom\n       and a bunch of folders\n       and the querystring pattern\n      When I activate the operator Custom in the criteria Location\n-      and I search in B subfolder in the related items widget\n+      and I search in B subfolder in the contentbrowser widget\n      Then we expect 5 hits\n \n Scenario: Location query Advanced\n@@ -350,12 +350,11 @@ I activate the operator ${OPERATOR} in the criteria ${CRITERIA}\n     select index type ${OPERATOR}\n \n \n-I search in ${NAME} subfolder in the related items widget\n+I search in ${NAME} subfolder in the contentbrowser widget\n     mark results\n-    Click    //div[@class="pat-relateditems-container"]//ul[@class="select2-choices"]\n-    # I have seen this fail sometimes, where the screen shot showed the NAME just fine.\n-    Sleep    0.1\n-    Click    //a[contains(concat(\' \', normalize-space(@class), \' \'), \' pat-relateditems-result-select \')]//span[contains(text(),\'${NAME}\')]\n+    Click    //div[@class="querystring-criteria-value"]//div[contains(@class, "content-browser-selected-items-wrapper")]//a[contains(@class, "btn-primary")]\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumn")]//div[contains(@class, "item-title")][text()[contains(.,\'${NAME}\')]]\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelToolbar")]/button\n \n \n I open the select box titled operator\n@@ -474,4 +473,4 @@ wait until result is no longer marked\n  ...    (element) => {\n  ...        return element && element.getAttribute("marker") != "marked"\n  ...    }\n- ...    all_elements=False\n\\ No newline at end of file\n+ ...    all_elements=False\ndiff --git a/Products/CMFPlone/tests/robot/test_tinymce.robot b/Products/CMFPlone/tests/robot/test_tinymce.robot\nindex 31c8e01bbf..c6374b2caa 100644\n--- a/Products/CMFPlone/tests/robot/test_tinymce.robot\n+++ b/Products/CMFPlone/tests/robot/test_tinymce.robot\n@@ -59,16 +59,16 @@ insert link\n     ...    }\n     ...    all_elements=False\n     Click    //button[@aria-label=\'Insert/edit link\']\n-    Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click    xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n-    Click    xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Click    css=.linkModal .content-browser-selected-items-wrapper a.btn-primary\n+    Click item in contenbrowser column    1    3\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]//button\n     Click    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n \n insert image\n     Click    //button[@aria-label="Insert/edit image"]\n-    Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click    xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n-    Click    xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Click    css=.linkModal .content-browser-selected-items-wrapper a.btn-primary\n+    Click item in contenbrowser column    1    3\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]//button\n     Type Text    //div[contains(@class, \'modal-body\')]//input[@name="title"]    SomeTitle\n     Type Text    //div[contains(@class, \'modal-body\')]//input[@name="alt"]    SomeAlt\n     Click    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-10-23T17:23:19+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/ba0e7c66581a36f29e03f5937e18eecd159f9f89

changenote

Files changed:
A news/4037.bugfix

b'diff --git a/news/4037.bugfix b/news/4037.bugfix\nnew file mode 100644\nindex 0000000000..b9047f383d\n--- /dev/null\n+++ b/news/4037.bugfix\n@@ -0,0 +1,2 @@\n+Robottest fixes for latest `pat-contentbrowser` updates.\n+[petschki]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-10-23T18:04:23+02:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/990291d32c24db6ab8d2a9b064693ac7365fe62a

Merge branch 'master' into robottest-contentbrowser-updates

Files changed:
A news/3813.feature.1
M Products/CMFPlone/tests/robot/test_querystring.robot

b'diff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex fa5539976f..12e75d808b 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -336,8 +336,9 @@ a bunch of events\n     ...    container=${F1}\n \n the querystring pattern\n-    #We go the /a to give more useful query results\n+    # We go the /a to give more useful query results\n     Go to    ${PLONE_URL}/a/++add++Collection\n+    Wait For Condition    Classes    //body    contains    patterns-loaded\n     Type Text    //input[@id="form-widgets-IDublinCore-title"]    A Collection\n \n # WHEN\ndiff --git a/news/3813.feature.1 b/news/3813.feature.1\nnew file mode 100644\nindex 0000000000..550519847b\n--- /dev/null\n+++ b/news/3813.feature.1\n@@ -0,0 +1,2 @@\n+make robot tests more robust\n+[1letter]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-10-24T09:48:23+02:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/b8113f17beb0f27fc785c5c90bc4e09676c0f2c0

Merge pull request #4037 from plone/robottest-contentbrowser-updates

Fix tests for newest contentbrowser updates

Files changed:
A news/4037.bugfix
M Products/CMFPlone/tests/robot/keywords.robot
M Products/CMFPlone/tests/robot/test_contentbrowser.robot
M Products/CMFPlone/tests/robot/test_edit.robot
M Products/CMFPlone/tests/robot/test_linkintegrity.robot
M Products/CMFPlone/tests/robot/test_querystring.robot
M Products/CMFPlone/tests/robot/test_tinymce.robot

b'diff --git a/Products/CMFPlone/tests/robot/keywords.robot b/Products/CMFPlone/tests/robot/keywords.robot\nindex f4bb2d383e..7e7254ee5d 100644\n--- a/Products/CMFPlone/tests/robot/keywords.robot\n+++ b/Products/CMFPlone/tests/robot/keywords.robot\n@@ -69,6 +69,12 @@ Remove line from textarea\n     Type Text    //textarea[@name="${fieldName}"]    ${lines}\n \n \n+Click item in contenbrowser column\n+    [arguments]  ${colnumber}    ${itemposition}\n+    Wait For Condition    Element States    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[${colnumber}]/div[contains(@class, "levelItems")]/div[${itemposition}]    contains    visible\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[${colnumber}]/div[contains(@class, "levelItems")]/div[${itemposition}]\n+\n+\n Fill text to tinymce editor\n     [Arguments]    ${text}\n \ndiff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nindex b7b935166d..e370ffa17c 100644\n--- a/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -114,17 +114,17 @@ I select a related item image via contentbrowser\n    # Click the Categorization Tab\n    Click    //a[@id="autotoc-item-autotoc-2"]\n    # Click the select button\n-   Click    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n+   Click    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//a[contains(@class, "btn-primary")]\n    # Click third element in first column, that is the "Assets" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[4]\n+   Click item in contenbrowser column    1    4\n    # Click first element in second column, that is the "Mixed" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n+   Click item in contenbrowser column    2    1\n    # Click fifth element in third column, that is the "Files" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[5]\n+   Click item in contenbrowser column    3    5\n    # Click third element in fourth column, that is the "Images" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[3]\n+   Click item in contenbrowser column    4    3\n    # Click second element in fifth column, that is the "Image2" Object\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]\n+   Click item in contenbrowser column    5    2\n    # Click the select Button in the Toolbar of column 6\n    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[6]/div[contains(@class, "levelToolbar")]/button\n \n@@ -134,19 +134,19 @@ I select two related item images via contentbrowser\n    # Click the Categorization Tab\n    Click    //a[@id="autotoc-item-autotoc-2"]\n    # Click the select button\n-   Click    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n+   Click    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//a[contains(@class, "btn-primary")]\n    # Click third element in first column, that is the "Assets" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[4]\n+   Click item in contenbrowser column    1    4\n    # Click first element in second column, that is the "Mixed" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelItems")]/div[1]\n+   Click item in contenbrowser column    2    1\n    # Click fifth element in third column, that is the "Files" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelItems")]/div[5]\n+   Click item in contenbrowser column    3    5\n    # Click third element in fourth column, that is the "Images" folder\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[4]/div[contains(@class, "levelItems")]/div[3]\n+   Click item in contenbrowser column    4    3\n \n    # now we select two items in a colum via Shift+Click\n    # Click first element in fifth column, that is the "Image1" Object\n-   Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[1]\n+   Click item in contenbrowser column    5    1\n    # Click second element in fifth column with SHIFT, that is the "Image2" Object\n    Click With Options    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[5]/div[contains(@class, "levelItems")]/div[2]    left    Shift\n    # Click the select Button in the Toolbar of column 6\n@@ -168,51 +168,47 @@ I set an internal link via contentbrowser\n     ...        iframe_document.getSelection().addRange(range);\n     ...    }\n     ...    all_elements=False\n-    Click    //button[@aria-label=\'Insert/edit link\']\n-    Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click item in column    1    3\n+    Click tiny button and open contentbrowser    Insert/edit link\n+    Click item in contenbrowser column    1    3\n     Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Click    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n \n I set an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n     Fill text to tinymce editor    Susi Sorglos and John Doe\n-    Click    //button[@aria-label=\'Insert/edit image\']\n-    Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click item in column    1    3\n-    Click item in column    2    1\n-    Click item in column    3    1\n+    Click tiny button and open contentbrowser    Insert/edit image\n+    Click item in contenbrowser column    1    3\n+    Click item in contenbrowser column    2    1\n+    Click item in contenbrowser column    3    1\n     Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Click    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n \n I upload an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n     Fill text to tinymce editor    Susi Sorglos and John Doe\n-    Click    //button[@aria-label="Insert/edit image"]\n-    Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click item in column    1    3\n-    Click item in column    2    1\n+    Click tiny button and open contentbrowser    Insert/edit image\n+    Click item in contenbrowser column    1    3\n+    Click item in contenbrowser column    2    1\n     Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//button[contains(@class,"upload")]\n     Upload File By Selector    //div[contains(@class,"pat-upload")]//input[@class="dz-hidden-input"]    ${PATH_TO_TEST_FILES}/plone-logo.png\n     Click    //div[contains(@class,"pat-upload")]//button[contains(@class,"upload-all")]\n-    Click item in column    3    3\n+    Click item in contenbrowser column    3    3\n     Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Click    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n \n I search and select an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n     Fill text to tinymce editor    Susi Sorglos and John Doe\n-    Click    //button[@aria-label="Insert/edit image"]\n-    Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click item in column    1    3\n-    Click item in column    2    1\n-    Click item in column    3    2\n-    Click item in column    4    1\n+    Click tiny button and open contentbrowser    Insert/edit image\n+    Click item in contenbrowser column    1    3\n+    Click item in contenbrowser column    2    1\n+    Click item in contenbrowser column    3    2\n+    Click item in contenbrowser column    4    1\n     Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]\n     Type Text    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "toolBar")]//input[contains(@name,"filter")]    Anot\n     # here we need a timeout, because the search filter is not so fast like the testbrowser, it looks like a asynch operation\n     Sleep    1\n-    Click item in column    5    1\n+    Click item in contenbrowser column    5    1\n     Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n     Click    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n \n@@ -258,6 +254,8 @@ Element exists\n     [arguments]  ${xpath}    ${attr}    ${value}\n     Wait for condition    Attribute    ${xpath}    ${attr}    should end with    ${value}\n \n-Click item in column\n-    [arguments]  ${colnumber}    ${itemposition}\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[${colnumber}]/div[contains(@class, "levelItems")]/div[${itemposition}]\n+Click tiny button and open contentbrowser\n+    [arguments]  ${label}\n+    Click    //button[@aria-label="${label}"]\n+    Wait for Condition    Element States    //div[@class="linkModal"]    contains    visible\n+    Click    //div[@class="linkModal"]//div[contains(@class, "content-browser-selected-items-wrapper")]//a[contains(@class, "btn-primary")]\ndiff --git a/Products/CMFPlone/tests/robot/test_edit.robot b/Products/CMFPlone/tests/robot/test_edit.robot\nindex aede766e59..928778ee61 100644\n--- a/Products/CMFPlone/tests/robot/test_edit.robot\n+++ b/Products/CMFPlone/tests/robot/test_edit.robot\n@@ -110,20 +110,20 @@ I click the ${tab} tab\n \n I select a related item\n     # Click the select button\n-    Click    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//button\n+    Click    //div[@id="formfield-form-widgets-IRelatedItems-relatedItems"]//a[contains(@class, "btn-primary")]\n     # Click first element in first column\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[1]\n+    Click item in contenbrowser column    1    1\n     # Click the select Button in the Toolbar of column 2\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelToolbar")]/button\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelToolbar")]//button[contains(@class, "btn-primary")]\n \n I select a linked item\n     # Click the select button\n-    Click  //div[@id="formfield-form-widgets-remoteUrl"]//button\n+    Click  //div[@id="formfield-form-widgets-remoteUrl"]//a[contains(@class, "btn-primary")]\n     # Click first element in first column\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[1]\n+    Click item in contenbrowser column    1    1\n     # Click the select Button in the Toolbar of column 2\n     # This selects the "test-folder"\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelToolbar")]/button\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[2]/div[contains(@class, "levelToolbar")]//button[contains(@class, "btn-primary")]\n \n I save the page\n     Click    //button[@name="form.buttons.save"]\n@@ -170,6 +170,7 @@ no other tab is shown\n \n at least one other item\n     Go to    ${PLONE_URL}/++add++Document\n+    Wait For Condition    Classes    //body    contains    patterns-loaded\n     Type Text    //input[@id="form-widgets-IDublinCore-title"]    ${TITLE}\n     Click    //button[@name="form.buttons.save"]\n-    Get Text    //body    contains    Item created\n\\ No newline at end of file\n+    Get Text    //body    contains    Item created\ndiff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex 79d30dc4ad..a476af3476 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -60,9 +60,9 @@ I add a link in rich text\n     Fill text to tinymce editor    foo\n     Mark text foo in tinymce editor\n     Click    //button[@aria-label="Insert/edit link"]\n-    Click    //div[contains(@class,"linkModal")]//div[contains(@class,"content-browser-selected-items-wrapper")]//button[contains(@class,"btn-primary")]\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n-    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Click    //div[contains(@class,"linkModal")]//div[contains(@class,"content-browser-selected-items-wrapper")]//a[contains(@class,"btn-primary")]\n+    Click item in contenbrowser column    1    3\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]//button[contains(@class, "btn-primary")]\n     Click    //div[contains(@class,"modal-footer")]//input[@name="insert"]\n     Click    //button[@name="form.buttons.save"]\n     Get Text    //body    contains    Changes saved\ndiff --git a/Products/CMFPlone/tests/robot/test_querystring.robot b/Products/CMFPlone/tests/robot/test_querystring.robot\nindex 44ab3f8b7d..12e75d808b 100644\n--- a/Products/CMFPlone/tests/robot/test_querystring.robot\n+++ b/Products/CMFPlone/tests/robot/test_querystring.robot\n@@ -32,7 +32,7 @@ Scenario: Location query Custom\n       and a bunch of folders\n       and the querystring pattern\n      When I activate the operator Custom in the criteria Location\n-      and I search in B subfolder in the related items widget\n+      and I search in B subfolder in the contentbrowser widget\n      Then we expect 5 hits\n \n Scenario: Location query Advanced\n@@ -351,12 +351,11 @@ I activate the operator ${OPERATOR} in the criteria ${CRITERIA}\n     select index type ${OPERATOR}\n \n \n-I search in ${NAME} subfolder in the related items widget\n+I search in ${NAME} subfolder in the contentbrowser widget\n     mark results\n-    Click    //div[@class="pat-relateditems-container"]//ul[@class="select2-choices"]\n-    # I have seen this fail sometimes, where the screen shot showed the NAME just fine.\n-    Sleep    0.1\n-    Click    //a[contains(concat(\' \', normalize-space(@class), \' \'), \' pat-relateditems-result-select \')]//span[contains(text(),\'${NAME}\')]\n+    Click    //div[@class="querystring-criteria-value"]//div[contains(@class, "content-browser-selected-items-wrapper")]//a[contains(@class, "btn-primary")]\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumn")]//div[contains(@class, "item-title")][text()[contains(.,\'${NAME}\')]]\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[3]/div[contains(@class, "levelToolbar")]/button\n \n \n I open the select box titled operator\n@@ -475,4 +474,4 @@ wait until result is no longer marked\n  ...    (element) => {\n  ...        return element && element.getAttribute("marker") != "marked"\n  ...    }\n- ...    all_elements=False\n\\ No newline at end of file\n+ ...    all_elements=False\ndiff --git a/Products/CMFPlone/tests/robot/test_tinymce.robot b/Products/CMFPlone/tests/robot/test_tinymce.robot\nindex 31c8e01bbf..c6374b2caa 100644\n--- a/Products/CMFPlone/tests/robot/test_tinymce.robot\n+++ b/Products/CMFPlone/tests/robot/test_tinymce.robot\n@@ -59,16 +59,16 @@ insert link\n     ...    }\n     ...    all_elements=False\n     Click    //button[@aria-label=\'Insert/edit link\']\n-    Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click    xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n-    Click    xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Click    css=.linkModal .content-browser-selected-items-wrapper a.btn-primary\n+    Click item in contenbrowser column    1    3\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]//button\n     Click    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\n \n insert image\n     Click    //button[@aria-label="Insert/edit image"]\n-    Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n-    Click    xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[1]/div[contains(@class, "levelItems")]/div[3]\n-    Click    xpath=//div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]/button\n+    Click    css=.linkModal .content-browser-selected-items-wrapper a.btn-primary\n+    Click item in contenbrowser column    1    3\n+    Click    //div[contains(@class, "content-browser-wrapper")]//div[contains(@class, "levelColumns")]/div[contains(@class, "preview")]/div[contains(@class, "levelToolbar")]//button\n     Type Text    //div[contains(@class, \'modal-body\')]//input[@name="title"]    SomeTitle\n     Type Text    //div[contains(@class, \'modal-body\')]//input[@name="alt"]    SomeAlt\n     Click    //div[contains(@class, \'modal-footer\')]//input[contains(@name, \'insert\')]\ndiff --git a/news/4037.bugfix b/news/4037.bugfix\nnew file mode 100644\nindex 0000000000..b9047f383d\n--- /dev/null\n+++ b/news/4037.bugfix\n@@ -0,0 +1,2 @@\n+Robottest fixes for latest `pat-contentbrowser` updates.\n+[petschki]\n'

