Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2023-04-15T17:19:24+02:00
Author: Malthe Borch (malthe) <mborch@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/6646932ff7a542a6d2128f965a963877d63f2757

Don't set "path" for Plone site root

It doesn't make sense to add a path query targeting the site root â€“ that's a "noop", only making things slower.

Files changed:
A news/3753.bugfix
M Products/CMFPlone/browser/search.py

b"diff --git a/Products/CMFPlone/browser/search.py b/Products/CMFPlone/browser/search.py\nindex 984a907821..06a00be83a 100644\n--- a/Products/CMFPlone/browser/search.py\n+++ b/Products/CMFPlone/browser/search.py\n@@ -1,6 +1,7 @@\n # -*- coding: utf-8 -*-\n from DateTime import DateTime\n from plone.app.contentlisting.interfaces import IContentListing\n+from plone.base.interfaces.siteroot import IPloneSiteRoot\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.browser.navtree import getNavigationRoot\n@@ -128,8 +129,8 @@ def _filter_query(self, query):\n         query['portal_type'] = self.filter_types(types)\n         # respect effective/expiration date\n         query['show_inactive'] = False\n-        # respect navigation root\n-        if 'path' not in query:\n+        # respect navigation root if we're not at the site root.\n+        if 'path' not in query and not IPloneSiteRoot.providedBy(self.context):\n             query['path'] = getNavigationRoot(self.context)\n \n         if 'sort_order' in query and not query['sort_order']:\ndiff --git a/news/3753.bugfix b/news/3753.bugfix\nnew file mode 100644\nindex 0000000000..3069245b55\n--- /dev/null\n+++ b/news/3753.bugfix\n@@ -0,0 +1,2 @@\n+Removed path query from search view when context is site root.\n+[malthe]\n"

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2023-04-15T17:19:24+02:00
Author: Malthe Borch (malthe) <mborch@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/95211f9c3d2525ae1af732d8b4241c96bd69fa63

Fix import

Co-authored-by: Peter Mathis &lt;petschki@users.noreply.github.com&gt;

Files changed:
M Products/CMFPlone/browser/search.py

b'diff --git a/Products/CMFPlone/browser/search.py b/Products/CMFPlone/browser/search.py\nindex 06a00be83a..15da84922f 100644\n--- a/Products/CMFPlone/browser/search.py\n+++ b/Products/CMFPlone/browser/search.py\n@@ -1,7 +1,7 @@\n # -*- coding: utf-8 -*-\n from DateTime import DateTime\n from plone.app.contentlisting.interfaces import IContentListing\n-from plone.base.interfaces.siteroot import IPloneSiteRoot\n+from Products.CMFPlone.interfaces import IPloneSiteRoot\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.browser.navtree import getNavigationRoot\n'

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2023-04-17T12:46:04+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/42e361c871b480db4aa9af8a84c0dc8877925468

Merge pull request #3755 from plone/backport/5.2.x/search-root-path

Don't set "path" for Plone site root

Files changed:
A news/3753.bugfix
M Products/CMFPlone/browser/search.py

b"diff --git a/Products/CMFPlone/browser/search.py b/Products/CMFPlone/browser/search.py\nindex 984a907821..15da84922f 100644\n--- a/Products/CMFPlone/browser/search.py\n+++ b/Products/CMFPlone/browser/search.py\n@@ -1,6 +1,7 @@\n # -*- coding: utf-8 -*-\n from DateTime import DateTime\n from plone.app.contentlisting.interfaces import IContentListing\n+from Products.CMFPlone.interfaces import IPloneSiteRoot\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.browser.navtree import getNavigationRoot\n@@ -128,8 +129,8 @@ def _filter_query(self, query):\n         query['portal_type'] = self.filter_types(types)\n         # respect effective/expiration date\n         query['show_inactive'] = False\n-        # respect navigation root\n-        if 'path' not in query:\n+        # respect navigation root if we're not at the site root.\n+        if 'path' not in query and not IPloneSiteRoot.providedBy(self.context):\n             query['path'] = getNavigationRoot(self.context)\n \n         if 'sort_order' in query and not query['sort_order']:\ndiff --git a/news/3753.bugfix b/news/3753.bugfix\nnew file mode 100644\nindex 0000000000..3069245b55\n--- /dev/null\n+++ b/news/3753.bugfix\n@@ -0,0 +1,2 @@\n+Removed path query from search view when context is site root.\n+[malthe]\n"

