Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2024-05-15T23:17:42+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contentrules/commit/fd9a37c39a70e8f31a04cdac17b4c56e08b84bbb

remove hard dependency on plone.app.discussion

Files changed:
A news/rm-pa-discussion-dependency.bugfix
M .meta.toml
M plone/app/contentrules/handlers.py
M pyproject.toml
M setup.py

b'diff --git a/.meta.toml b/.meta.toml\nindex 70ffe0f..dd1196c 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -6,4 +6,4 @@ template = "default"\n commit-id = "cfffba8c"\n \n [pyproject]\n-dependencies_ignores = "[\'Products.CMFPlone\',]"\n+dependencies_ignores = "[\'Products.CMFPlone\', \'plone.app.discussion\']"\ndiff --git a/news/rm-pa-discussion-dependency.bugfix b/news/rm-pa-discussion-dependency.bugfix\nnew file mode 100644\nindex 0000000..2dd3d09\n--- /dev/null\n+++ b/news/rm-pa-discussion-dependency.bugfix\n@@ -0,0 +1 @@\n+Remove hard dependency on plone.app.discussion. [@jensens]\ndiff --git a/plone/app/contentrules/handlers.py b/plone/app/contentrules/handlers.py\nindex f93fa94..c873fdf 100644\n--- a/plone/app/contentrules/handlers.py\n+++ b/plone/app/contentrules/handlers.py\n@@ -1,6 +1,5 @@\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n-from plone.app.discussion.interfaces import IComment\n from plone.contentrules.engine.interfaces import IRuleExecutor\n from plone.contentrules.engine.interfaces import IRuleStorage\n from plone.contentrules.engine.interfaces import StopRule\n@@ -12,11 +11,20 @@\n from zope.container.interfaces import IContainerModifiedEvent\n from zope.container.interfaces import IObjectAddedEvent\n from zope.container.interfaces import IObjectRemovedEvent\n+from zope.interface import Interface\n from zope.lifecycleevent.interfaces import IObjectCopiedEvent\n \n import threading\n \n \n+try:\n+    from plone.app.discussion.interfaces import IComment\n+except ImportError:\n+\n+    class IComment(Interface):\n+        """Dummy interface if there is no plone.app.discussion available."""\n+\n+\n def _get_uid(context):\n     uid = IUUID(context, None)\n     if uid is not None:\n@@ -142,8 +150,6 @@ def added(event):\n \n     if IContentish.providedBy(obj) or IComment.providedBy(obj):\n         execute(event.newParent, event)\n-    else:\n-        return\n \n \n def removed(event):\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 2f2300d..e5f08bb 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -116,7 +116,7 @@ Zope = [\n   \'Products.CMFCore\', \'Products.CMFDynamicViewFTI\',\n ]\n python-dateutil = [\'dateutil\']\n-ignore-packages = [\'Products.CMFPlone\',]\n+ignore-packages = [\'Products.CMFPlone\',\'plone.app.discussion\']\n \n ##\n # Add extra configuration options in .meta.toml:\ndiff --git a/setup.py b/setup.py\nindex 432f0b8..a736a2e 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -53,7 +53,6 @@\n     install_requires=[\n         "lxml",\n         "plone.app.contenttypes",\n-        "plone.app.discussion",\n         "plone.app.uuid",\n         "plone.app.vocabularies",\n         "plone.autoform",\n'

Repository: plone.app.contentrules


Branch: refs/heads/master
Date: 2024-05-16T19:15:22+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contentrules/commit/7d8cedb6f176bd61b9a058a7bc5d90601cba3d2c

Merge pull request #84 from plone/pa-discussion-dep

remove hard dependency on plone.app.discussion

Files changed:
A news/rm-pa-discussion-dependency.bugfix
M .meta.toml
M plone/app/contentrules/handlers.py
M pyproject.toml
M setup.py

b'diff --git a/.meta.toml b/.meta.toml\nindex 70ffe0f..dd1196c 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -6,4 +6,4 @@ template = "default"\n commit-id = "cfffba8c"\n \n [pyproject]\n-dependencies_ignores = "[\'Products.CMFPlone\',]"\n+dependencies_ignores = "[\'Products.CMFPlone\', \'plone.app.discussion\']"\ndiff --git a/news/rm-pa-discussion-dependency.bugfix b/news/rm-pa-discussion-dependency.bugfix\nnew file mode 100644\nindex 0000000..2dd3d09\n--- /dev/null\n+++ b/news/rm-pa-discussion-dependency.bugfix\n@@ -0,0 +1 @@\n+Remove hard dependency on plone.app.discussion. [@jensens]\ndiff --git a/plone/app/contentrules/handlers.py b/plone/app/contentrules/handlers.py\nindex f93fa94..c873fdf 100644\n--- a/plone/app/contentrules/handlers.py\n+++ b/plone/app/contentrules/handlers.py\n@@ -1,6 +1,5 @@\n from Acquisition import aq_inner\n from Acquisition import aq_parent\n-from plone.app.discussion.interfaces import IComment\n from plone.contentrules.engine.interfaces import IRuleExecutor\n from plone.contentrules.engine.interfaces import IRuleStorage\n from plone.contentrules.engine.interfaces import StopRule\n@@ -12,11 +11,20 @@\n from zope.container.interfaces import IContainerModifiedEvent\n from zope.container.interfaces import IObjectAddedEvent\n from zope.container.interfaces import IObjectRemovedEvent\n+from zope.interface import Interface\n from zope.lifecycleevent.interfaces import IObjectCopiedEvent\n \n import threading\n \n \n+try:\n+    from plone.app.discussion.interfaces import IComment\n+except ImportError:\n+\n+    class IComment(Interface):\n+        """Dummy interface if there is no plone.app.discussion available."""\n+\n+\n def _get_uid(context):\n     uid = IUUID(context, None)\n     if uid is not None:\n@@ -142,8 +150,6 @@ def added(event):\n \n     if IContentish.providedBy(obj) or IComment.providedBy(obj):\n         execute(event.newParent, event)\n-    else:\n-        return\n \n \n def removed(event):\ndiff --git a/pyproject.toml b/pyproject.toml\nindex 2f2300d..e5f08bb 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -116,7 +116,7 @@ Zope = [\n   \'Products.CMFCore\', \'Products.CMFDynamicViewFTI\',\n ]\n python-dateutil = [\'dateutil\']\n-ignore-packages = [\'Products.CMFPlone\',]\n+ignore-packages = [\'Products.CMFPlone\',\'plone.app.discussion\']\n \n ##\n # Add extra configuration options in .meta.toml:\ndiff --git a/setup.py b/setup.py\nindex 432f0b8..a736a2e 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -53,7 +53,6 @@\n     install_requires=[\n         "lxml",\n         "plone.app.contenttypes",\n-        "plone.app.discussion",\n         "plone.app.uuid",\n         "plone.app.vocabularies",\n         "plone.autoform",\n'

