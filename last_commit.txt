Repository: plone.app.discussion


Branch: refs/heads/master
Date: 2024-04-02T17:27:55-03:00
Author: wesleybl (wesleybl) <wesleybl@gmail.com>
Commit: https://github.com/plone/plone.app.discussion/commit/63cc8ac835303da51975f089c52ee345552f9881

Remove hidden input `selected_obj_paths` in moderation form

It is no longer used

Files changed:
M plone/app/discussion/browser/moderation.pt
M plone/app/discussion/browser/moderation.py

b'diff --git a/plone/app/discussion/browser/moderation.pt b/plone/app/discussion/browser/moderation.pt\nindex 6e669881..041e004c 100644\n--- a/plone/app/discussion/browser/moderation.pt\n+++ b/plone/app/discussion/browser/moderation.pt\n@@ -227,13 +227,6 @@\n                                  title   string:Select ${item/Title};\n                                "\n                         />\n-                        <input name="selected_obj_paths:list"\n-                               type="hidden"\n-                               value="#"\n-                               tal:attributes="\n-                                 value item/getURL;\n-                               "\n-                        />\n                       </td>\n                       <td>\n                         <span tal:content="python:item.author_name or item.Creator">Name</span>\ndiff --git a/plone/app/discussion/browser/moderation.py b/plone/app/discussion/browser/moderation.py\nindex 6ee5748f..87a10e9f 100644\n--- a/plone/app/discussion/browser/moderation.py\n+++ b/plone/app/discussion/browser/moderation.py\n@@ -156,18 +156,6 @@ class DeleteComment(BrowserView):\n \n          http://nohost/front-page/++conversation++default/1286289644723317/\\\n          @@moderate-delete-comment\n-\n-       Each table row (comment) in the moderation view contains a hidden input\n-       field with the absolute URL of the content object:\n-\n-         <input type="hidden"\n-                value="http://nohost/front-page/++conversation++default/\\\n-                       1286289644723317"\n-                name="selected_obj_paths:list">\n-\n-       This absolute URL is called from a jQuery method that is bind to the\n-       \'delete\' button of the table row. See javascripts/moderation.js for more\n-       details.\n     """\n \n     def __call__(self):\n@@ -240,18 +228,6 @@ class CommentTransition(BrowserView):\n \n         http://nohost/front-page/++conversation++default/1286289644723317/\\\n         @@transmit-comment\n-\n-    Each table row (comment) in the moderation view contains a hidden input\n-    field with the absolute URL of the content object:\n-\n-        <input type="hidden"\n-            value="http://nohost/front-page/++conversation++default/\\\n-                1286289644723317"\n-            name="selected_obj_paths:list">\n-\n-    This absolute URL is called from a jQuery method that is bind to the\n-    \'delete\' button of the table row. See javascripts/moderation.js for more\n-    details.\n     """\n \n     def __call__(self):\n'

Repository: plone.app.discussion


Branch: refs/heads/master
Date: 2024-04-02T17:29:01-03:00
Author: wesleybl (wesleybl) <wesleybl@gmail.com>
Commit: https://github.com/plone/plone.app.discussion/commit/7bfb1e02057282998733027b4bff944dfaa70952

Fix robot test `Add a Comment to a Document and bulk delete it`

The screenshot shows that the comment check was not selected before the
form was submitted. Then we wait for the checkbox to be selected before
submitting the form

Files changed:
A news/237.internal
M plone/app/discussion/tests/robot/test_moderation.robot

b'diff --git a/news/237.internal b/news/237.internal\nnew file mode 100644\nindex 00000000..104ab412\n--- /dev/null\n+++ b/news/237.internal\n@@ -0,0 +1 @@\n+Fix robot test `Add a Comment to a Document and bulk delete it`. @wesleybl\ndiff --git a/plone/app/discussion/tests/robot/test_moderation.robot b/plone/app/discussion/tests/robot/test_moderation.robot\nindex c24730d5..b37447f2 100644\n--- a/plone/app/discussion/tests/robot/test_moderation.robot\n+++ b/plone/app/discussion/tests/robot/test_moderation.robot\n@@ -67,12 +67,14 @@ I add a comment and delete it\n   Input Text  id=form-widgets-comment-text  This is a comment\n   Click Button  Comment\n   Go To  ${PLONE_URL}/@@moderate-comments?review_state=all\n-  Wait Until Element Is Enabled  css=option[value=delete]\n+  Wait Until Element Is Visible  css=option[value=delete]\n   Wait Until Keyword Succeeds  5x  1s  Select And Check  xpath://select[@name=\'form.select.BulkAction\']  delete\n+  Wait Until Element Is Visible  css=[name=check_all]\n+  Wait Until Element Is Enabled  css=[name=check_all]\n+  Wait Until Element Is Visible  css=[name="paths:list"]\n+  Wait Until Element Is Enabled  css=[name="paths:list"]\n   Select Checkbox  name=check_all\n-  Sleep  1s\n-  # FIXME: Capture screen to debug. Must be removed when the test is fixed.\n-  Capture Page Screenshot\n+  Wait Until Element Is Visible  css=[name="paths:list"]:checked\n   Wait For Then Click Element  css=button[name="form.button.BulkAction"]\n   Wait Until Page Does Not Contain  This is a comment\n \n'

Repository: plone.app.discussion


Branch: refs/heads/master
Date: 2024-04-03T20:40:35-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.discussion/commit/bc128096e7b544e08d3b6f135dd0901d1508aa2c

Merge pull request #237 from plone/fix_robot

Fix robot test "Add a Comment to a Document and bulk delete it"

Files changed:
A news/237.internal
M plone/app/discussion/browser/moderation.pt
M plone/app/discussion/browser/moderation.py
M plone/app/discussion/tests/robot/test_moderation.robot

b'diff --git a/news/237.internal b/news/237.internal\nnew file mode 100644\nindex 00000000..104ab412\n--- /dev/null\n+++ b/news/237.internal\n@@ -0,0 +1 @@\n+Fix robot test `Add a Comment to a Document and bulk delete it`. @wesleybl\ndiff --git a/plone/app/discussion/browser/moderation.pt b/plone/app/discussion/browser/moderation.pt\nindex 6e669881..041e004c 100644\n--- a/plone/app/discussion/browser/moderation.pt\n+++ b/plone/app/discussion/browser/moderation.pt\n@@ -227,13 +227,6 @@\n                                  title   string:Select ${item/Title};\n                                "\n                         />\n-                        <input name="selected_obj_paths:list"\n-                               type="hidden"\n-                               value="#"\n-                               tal:attributes="\n-                                 value item/getURL;\n-                               "\n-                        />\n                       </td>\n                       <td>\n                         <span tal:content="python:item.author_name or item.Creator">Name</span>\ndiff --git a/plone/app/discussion/browser/moderation.py b/plone/app/discussion/browser/moderation.py\nindex 6ee5748f..87a10e9f 100644\n--- a/plone/app/discussion/browser/moderation.py\n+++ b/plone/app/discussion/browser/moderation.py\n@@ -156,18 +156,6 @@ class DeleteComment(BrowserView):\n \n          http://nohost/front-page/++conversation++default/1286289644723317/\\\n          @@moderate-delete-comment\n-\n-       Each table row (comment) in the moderation view contains a hidden input\n-       field with the absolute URL of the content object:\n-\n-         <input type="hidden"\n-                value="http://nohost/front-page/++conversation++default/\\\n-                       1286289644723317"\n-                name="selected_obj_paths:list">\n-\n-       This absolute URL is called from a jQuery method that is bind to the\n-       \'delete\' button of the table row. See javascripts/moderation.js for more\n-       details.\n     """\n \n     def __call__(self):\n@@ -240,18 +228,6 @@ class CommentTransition(BrowserView):\n \n         http://nohost/front-page/++conversation++default/1286289644723317/\\\n         @@transmit-comment\n-\n-    Each table row (comment) in the moderation view contains a hidden input\n-    field with the absolute URL of the content object:\n-\n-        <input type="hidden"\n-            value="http://nohost/front-page/++conversation++default/\\\n-                1286289644723317"\n-            name="selected_obj_paths:list">\n-\n-    This absolute URL is called from a jQuery method that is bind to the\n-    \'delete\' button of the table row. See javascripts/moderation.js for more\n-    details.\n     """\n \n     def __call__(self):\ndiff --git a/plone/app/discussion/tests/robot/test_moderation.robot b/plone/app/discussion/tests/robot/test_moderation.robot\nindex c24730d5..b37447f2 100644\n--- a/plone/app/discussion/tests/robot/test_moderation.robot\n+++ b/plone/app/discussion/tests/robot/test_moderation.robot\n@@ -67,12 +67,14 @@ I add a comment and delete it\n   Input Text  id=form-widgets-comment-text  This is a comment\n   Click Button  Comment\n   Go To  ${PLONE_URL}/@@moderate-comments?review_state=all\n-  Wait Until Element Is Enabled  css=option[value=delete]\n+  Wait Until Element Is Visible  css=option[value=delete]\n   Wait Until Keyword Succeeds  5x  1s  Select And Check  xpath://select[@name=\'form.select.BulkAction\']  delete\n+  Wait Until Element Is Visible  css=[name=check_all]\n+  Wait Until Element Is Enabled  css=[name=check_all]\n+  Wait Until Element Is Visible  css=[name="paths:list"]\n+  Wait Until Element Is Enabled  css=[name="paths:list"]\n   Select Checkbox  name=check_all\n-  Sleep  1s\n-  # FIXME: Capture screen to debug. Must be removed when the test is fixed.\n-  Capture Page Screenshot\n+  Wait Until Element Is Visible  css=[name="paths:list"]:checked\n   Wait For Then Click Element  css=button[name="form.button.BulkAction"]\n   Wait Until Page Does Not Contain  This is a comment\n \n'

