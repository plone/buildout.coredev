Repository: plone.app.event


Branch: refs/heads/master
Date: 2020-09-10T18:35:56+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.event/commit/368ee0af10292abd34dc70df7717ea0bc71d42b0

Replaced deprecated plone.testing.z2 imports with plone.testing.zope, where possible.

Files changed:
A news/3130.bugfix
M plone/app/event/testing.py
M plone/app/event/tests/test_dx_behaviors.py
M plone/app/event/tests/test_ical_import.py
M plone/app/event/tests/test_recurrence.py

b'diff --git a/news/3130.bugfix b/news/3130.bugfix\nnew file mode 100644\nindex 00000000..83040045\n--- /dev/null\n+++ b/news/3130.bugfix\n@@ -0,0 +1,2 @@\n+Replaced deprecated ``plone.testing.z2`` imports with ``plone.testing.zope``, where possible.\n+[maurits]\ndiff --git a/plone/app/event/testing.py b/plone/app/event/testing.py\nindex 14260fa0..6be08d56 100644\n--- a/plone/app/event/testing.py\n+++ b/plone/app/event/testing.py\n@@ -6,12 +6,22 @@\n from plone.app.testing import PLONE_FIXTURE\n from plone.app.testing import PloneSandboxLayer\n from plone.registry.interfaces import IRegistry\n-from plone.testing import z2\n from zope.component import getUtility\n from zope.interface import alsoProvides\n \n import os\n \n+try:\n+    # plone.testing 7+, Plone 5.2+\n+    from plone.testing.zope import WSGI_SERVER_FIXTURE\n+    from plone.testing.zope import installProduct\n+    from plone.testing.zope import uninstallProduct\n+except ImportError:\n+    # plone.testing 6-, Plone 5.1\n+    from plone.testing.z2 import ZSERVER_FIXTURE as WSGI_SERVER_FIXTURE\n+    from plone.testing.z2 import installProduct\n+    from plone.testing.z2 import uninstallProduct\n+\n \n def set_browserlayer(request):\n     """Set the BrowserLayer for the request.\n@@ -69,7 +79,7 @@ def setUpZope(self, app, configurationContext):\n         self.ostz = os_zone()\n \n         # Install products that use an old-style initialize() function\n-        z2.installProduct(app, \'Products.DateRecurringIndex\')\n+        installProduct(app, \'Products.DateRecurringIndex\')\n \n         # Load ZCML\n         import plone.app.event\n@@ -81,7 +91,7 @@ def setUpPloneSite(self, portal):\n \n     def tearDownZope(self, app):\n         # Uninstall old-style Products\n-        z2.uninstallProduct(app, \'Products.DateRecurringIndex\')\n+        uninstallProduct(app, \'Products.DateRecurringIndex\')\n \n         # reset OS TZ\n         if self.ostz:\n@@ -129,6 +139,6 @@ def setUpPloneSite(self, portal):\n     bases=(\n         PAEventDX_FIXTURE,\n         AUTOLOGIN_LIBRARY_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ),\n     name="plone.app.event.dx:Robot")\ndiff --git a/plone/app/event/tests/test_dx_behaviors.py b/plone/app/event/tests/test_dx_behaviors.py\nindex 560d23b5..7aa9d8bc 100644\n--- a/plone/app/event/tests/test_dx_behaviors.py\n+++ b/plone/app/event/tests/test_dx_behaviors.py\n@@ -30,7 +30,6 @@\n from plone.event.interfaces import IEventAccessor\n from plone.event.interfaces import IOccurrence\n from plone.event.interfaces import IRecurrenceSupport\n-from plone.testing.z2 import Browser\n from plone.uuid.interfaces import IUUID\n from zope.annotation.interfaces import IAnnotations\n \n@@ -39,6 +38,13 @@\n import unittest\n import zope.interface\n \n+try:\n+    # plone.testing 7+\n+    from plone.testing.zope import Browser\n+except ImportError:\n+    # plone.testing 6-\n+    from plone.testing.z2 import Browser\n+\n \n TEST_TIMEZONE = "Europe/Vienna"\n \ndiff --git a/plone/app/event/tests/test_ical_import.py b/plone/app/event/tests/test_ical_import.py\nindex 70c9b68c..dffd9af9 100644\n--- a/plone/app/event/tests/test_ical_import.py\n+++ b/plone/app/event/tests/test_ical_import.py\n@@ -6,11 +6,17 @@\n from plone.app.testing import SITE_OWNER_NAME\n from plone.app.testing import SITE_OWNER_PASSWORD\n from plone.app.testing import TEST_USER_ID\n-from plone.testing.z2 import Browser\n \n import transaction\n import unittest\n \n+try:\n+    # plone.testing 7+\n+    from plone.testing.zope import Browser\n+except ImportError:\n+    # plone.testing 6-\n+    from plone.testing.z2 import Browser\n+\n \n class TestICALImportSettings(unittest.TestCase):\n \ndiff --git a/plone/app/event/tests/test_recurrence.py b/plone/app/event/tests/test_recurrence.py\nindex 6f7bc1b1..c294a08b 100644\n--- a/plone/app/event/tests/test_recurrence.py\n+++ b/plone/app/event/tests/test_recurrence.py\n@@ -22,7 +22,6 @@\n from plone.event.interfaces import IEventRecurrence\n from plone.event.interfaces import IOccurrence\n from plone.event.interfaces import IRecurrenceSupport\n-from plone.testing.z2 import Browser\n from zope.annotation.interfaces import IAnnotations\n from zope.interface import alsoProvides\n from zope.publisher.interfaces.browser import IBrowserView\n@@ -35,6 +34,13 @@\n import unittest\n import zope.component\n \n+try:\n+    # plone.testing 7+\n+    from plone.testing.zope import Browser\n+except ImportError:\n+    # plone.testing 6-\n+    from plone.testing.z2 import Browser\n+\n \n TZNAME = "Europe/Vienna"\n \n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2020-09-10T18:46:02+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.event/commit/1fe753d865c9d8683bcd25b88679df6ba25ce7d5

Use named behaviors in our test type.

Files changed:
M plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml

b'diff --git a/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml b/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\nindex 5a3cde31..5cf35cbd 100644\n--- a/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\n+++ b/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\n@@ -28,16 +28,16 @@\n \n   <!-- Enabled behaviors -->\n   <property name="behaviors">\n-    <element value="plone.app.event.dx.behaviors.IEventBasic"/>\n-    <element value="plone.app.event.dx.behaviors.IEventRecurrence"/>\n-    <element value="plone.app.event.dx.behaviors.IEventLocation"/>\n-    <element value="plone.app.event.dx.behaviors.IEventAttendees"/>\n-    <element value="plone.app.event.dx.behaviors.IEventContact"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n-    <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.content.interfaces.INameFromTitle"/>\n-    <element value="plone.app.dexterity.behaviors.discussion.IAllowDiscussion"/>\n-    <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n+    <element value="plone.eventbasic"/>\n+    <element value="plone.eventrecurrence"/>\n+    <element value="plone.eventlocation"/>\n+    <element value="plone.eventattendees"/>\n+    <element value="plone.eventcontact"/>\n+    <element value="plone.richtext"/>\n+    <element value="plone.dublincore"/>\n+    <element value="plone.namefromtitle"/>\n+    <element value="plone.allowdiscussion"/>\n+    <element value="plone.excludefromnavigation"/>\n   </property>\n \n   <!-- View and aliases -->\n'

Repository: plone.app.event


Branch: refs/heads/master
Date: 2020-09-11T08:47:25+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.app.event/commit/7cb7ea0aa144550f3f23bb24c2408d883ebc0bb3

Merge pull request #320 from plone/maurits/fix-warnings-2

Fix deprecation warnings in tests: use plone.testing.zope and named behaviors.

Files changed:
A news/3130.bugfix
M plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml
M plone/app/event/testing.py
M plone/app/event/tests/test_dx_behaviors.py
M plone/app/event/tests/test_ical_import.py
M plone/app/event/tests/test_recurrence.py

b'diff --git a/news/3130.bugfix b/news/3130.bugfix\nnew file mode 100644\nindex 00000000..83040045\n--- /dev/null\n+++ b/news/3130.bugfix\n@@ -0,0 +1,2 @@\n+Replaced deprecated ``plone.testing.z2`` imports with ``plone.testing.zope``, where possible.\n+[maurits]\ndiff --git a/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml b/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\nindex 5a3cde31..5cf35cbd 100644\n--- a/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\n+++ b/plone/app/event/profiles/testing/types/plone.app.event.dx.event.xml\n@@ -28,16 +28,16 @@\n \n   <!-- Enabled behaviors -->\n   <property name="behaviors">\n-    <element value="plone.app.event.dx.behaviors.IEventBasic"/>\n-    <element value="plone.app.event.dx.behaviors.IEventRecurrence"/>\n-    <element value="plone.app.event.dx.behaviors.IEventLocation"/>\n-    <element value="plone.app.event.dx.behaviors.IEventAttendees"/>\n-    <element value="plone.app.event.dx.behaviors.IEventContact"/>\n-    <element value="plone.app.contenttypes.behaviors.richtext.IRichText"/>\n-    <element value="plone.app.dexterity.behaviors.metadata.IDublinCore"/>\n-    <element value="plone.app.content.interfaces.INameFromTitle"/>\n-    <element value="plone.app.dexterity.behaviors.discussion.IAllowDiscussion"/>\n-    <element value="plone.app.dexterity.behaviors.exclfromnav.IExcludeFromNavigation"/>\n+    <element value="plone.eventbasic"/>\n+    <element value="plone.eventrecurrence"/>\n+    <element value="plone.eventlocation"/>\n+    <element value="plone.eventattendees"/>\n+    <element value="plone.eventcontact"/>\n+    <element value="plone.richtext"/>\n+    <element value="plone.dublincore"/>\n+    <element value="plone.namefromtitle"/>\n+    <element value="plone.allowdiscussion"/>\n+    <element value="plone.excludefromnavigation"/>\n   </property>\n \n   <!-- View and aliases -->\ndiff --git a/plone/app/event/testing.py b/plone/app/event/testing.py\nindex 14260fa0..6be08d56 100644\n--- a/plone/app/event/testing.py\n+++ b/plone/app/event/testing.py\n@@ -6,12 +6,22 @@\n from plone.app.testing import PLONE_FIXTURE\n from plone.app.testing import PloneSandboxLayer\n from plone.registry.interfaces import IRegistry\n-from plone.testing import z2\n from zope.component import getUtility\n from zope.interface import alsoProvides\n \n import os\n \n+try:\n+    # plone.testing 7+, Plone 5.2+\n+    from plone.testing.zope import WSGI_SERVER_FIXTURE\n+    from plone.testing.zope import installProduct\n+    from plone.testing.zope import uninstallProduct\n+except ImportError:\n+    # plone.testing 6-, Plone 5.1\n+    from plone.testing.z2 import ZSERVER_FIXTURE as WSGI_SERVER_FIXTURE\n+    from plone.testing.z2 import installProduct\n+    from plone.testing.z2 import uninstallProduct\n+\n \n def set_browserlayer(request):\n     """Set the BrowserLayer for the request.\n@@ -69,7 +79,7 @@ def setUpZope(self, app, configurationContext):\n         self.ostz = os_zone()\n \n         # Install products that use an old-style initialize() function\n-        z2.installProduct(app, \'Products.DateRecurringIndex\')\n+        installProduct(app, \'Products.DateRecurringIndex\')\n \n         # Load ZCML\n         import plone.app.event\n@@ -81,7 +91,7 @@ def setUpPloneSite(self, portal):\n \n     def tearDownZope(self, app):\n         # Uninstall old-style Products\n-        z2.uninstallProduct(app, \'Products.DateRecurringIndex\')\n+        uninstallProduct(app, \'Products.DateRecurringIndex\')\n \n         # reset OS TZ\n         if self.ostz:\n@@ -129,6 +139,6 @@ def setUpPloneSite(self, portal):\n     bases=(\n         PAEventDX_FIXTURE,\n         AUTOLOGIN_LIBRARY_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ),\n     name="plone.app.event.dx:Robot")\ndiff --git a/plone/app/event/tests/test_dx_behaviors.py b/plone/app/event/tests/test_dx_behaviors.py\nindex 560d23b5..7aa9d8bc 100644\n--- a/plone/app/event/tests/test_dx_behaviors.py\n+++ b/plone/app/event/tests/test_dx_behaviors.py\n@@ -30,7 +30,6 @@\n from plone.event.interfaces import IEventAccessor\n from plone.event.interfaces import IOccurrence\n from plone.event.interfaces import IRecurrenceSupport\n-from plone.testing.z2 import Browser\n from plone.uuid.interfaces import IUUID\n from zope.annotation.interfaces import IAnnotations\n \n@@ -39,6 +38,13 @@\n import unittest\n import zope.interface\n \n+try:\n+    # plone.testing 7+\n+    from plone.testing.zope import Browser\n+except ImportError:\n+    # plone.testing 6-\n+    from plone.testing.z2 import Browser\n+\n \n TEST_TIMEZONE = "Europe/Vienna"\n \ndiff --git a/plone/app/event/tests/test_ical_import.py b/plone/app/event/tests/test_ical_import.py\nindex 70c9b68c..dffd9af9 100644\n--- a/plone/app/event/tests/test_ical_import.py\n+++ b/plone/app/event/tests/test_ical_import.py\n@@ -6,11 +6,17 @@\n from plone.app.testing import SITE_OWNER_NAME\n from plone.app.testing import SITE_OWNER_PASSWORD\n from plone.app.testing import TEST_USER_ID\n-from plone.testing.z2 import Browser\n \n import transaction\n import unittest\n \n+try:\n+    # plone.testing 7+\n+    from plone.testing.zope import Browser\n+except ImportError:\n+    # plone.testing 6-\n+    from plone.testing.z2 import Browser\n+\n \n class TestICALImportSettings(unittest.TestCase):\n \ndiff --git a/plone/app/event/tests/test_recurrence.py b/plone/app/event/tests/test_recurrence.py\nindex 6f7bc1b1..c294a08b 100644\n--- a/plone/app/event/tests/test_recurrence.py\n+++ b/plone/app/event/tests/test_recurrence.py\n@@ -22,7 +22,6 @@\n from plone.event.interfaces import IEventRecurrence\n from plone.event.interfaces import IOccurrence\n from plone.event.interfaces import IRecurrenceSupport\n-from plone.testing.z2 import Browser\n from zope.annotation.interfaces import IAnnotations\n from zope.interface import alsoProvides\n from zope.publisher.interfaces.browser import IBrowserView\n@@ -35,6 +34,13 @@\n import unittest\n import zope.component\n \n+try:\n+    # plone.testing 7+\n+    from plone.testing.zope import Browser\n+except ImportError:\n+    # plone.testing 6-\n+    from plone.testing.z2 import Browser\n+\n \n TZNAME = "Europe/Vienna"\n \n'

