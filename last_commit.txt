Repository: Products.CMFPlone


Branch: refs/heads/6.0.x
Date: 2024-04-25T00:55:44+02:00
Author: Mauro Amico (mamico) <mauro.amico@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/c08f40f6341de07b1a56dddeb2182dc752417df9

feat: extends sendmail wrapper

Files changed:
M Products/CMFPlone/patches/sendmail.py

b'diff --git a/Products/CMFPlone/patches/sendmail.py b/Products/CMFPlone/patches/sendmail.py\nindex 126d45aaf0..01aa4d0377 100644\n--- a/Products/CMFPlone/patches/sendmail.py\n+++ b/Products/CMFPlone/patches/sendmail.py\n@@ -38,24 +38,16 @@ def applyPatches():\n         SMTPMailer.send = catchAllExceptions(SMTPMailer.send)\n \n \n-def new_init(\n-    self,\n-    hostname="localhost",\n-    port=25,\n-    username=None,\n-    password=None,\n-    no_tls=False,\n-    force_tls=False,\n-):\n-    registry = getUtility(IRegistry)\n-    mail_settings = registry.forInterface(IMailSchema, prefix="plone")\n-    self.hostname = mail_settings.smtp_host\n-    self.port = mail_settings.smtp_port\n-    self.username = mail_settings.smtp_userid\n-    self.password = mail_settings.smtp_pass\n-    self.force_tls = force_tls\n-    self.no_tls = no_tls\n-    self._smtp = _SMTPState()\n-\n-\n-SMTPMailer.__init__ = new_init\n+def mail_settings_wrapper(func):\n+    def wrapper(self, **kwargs):\n+        registry = getUtility(IRegistry)\n+        mail_settings = registry.forInterface(IMailSchema, prefix="plone")\n+        kwargs["hostname"] = mail_settings.smtp_host\n+        kwargs["port"] = mail_settings.smtp_port\n+        kwargs["username"] = mail_settings.smtp_userid\n+        kwargs["password"] = mail_settings.smtp_pass\n+        return func(self, **kwargs)\n+\n+    return wrapper\n+\n+SMTPMailer.__init__ = mail_settings_wrapper(SMTPMailer.__init__)\n'

Repository: Products.CMFPlone


Branch: refs/heads/6.0.x
Date: 2024-04-25T00:55:58+02:00
Author: Mauro Amico (mamico) <mauro.amico@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/1fcc0d9045431ce0583b34806b96465b91fa8afb

changelog

Files changed:
A news/3941.feature

b'diff --git a/news/3941.feature b/news/3941.feature\nnew file mode 100644\nindex 0000000000..15a20d1cb9\n--- /dev/null\n+++ b/news/3941.feature\n@@ -0,0 +1,2 @@\n+Extends `SMTPMailer.__init__` patch to allow to use other arguments.\n+[mamico]\n'

Repository: Products.CMFPlone


Branch: refs/heads/6.0.x
Date: 2024-04-25T07:40:49+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/Products.CMFPlone/commit/17be64e8d702cc9c5a5b25ad63f880dd39f008d3

Merge pull request #3943 from plone/3941_backport

feat: extends sendmail wrapper

Files changed:
A news/3941.feature
M Products/CMFPlone/patches/sendmail.py

b'diff --git a/Products/CMFPlone/patches/sendmail.py b/Products/CMFPlone/patches/sendmail.py\nindex 126d45aaf0..01aa4d0377 100644\n--- a/Products/CMFPlone/patches/sendmail.py\n+++ b/Products/CMFPlone/patches/sendmail.py\n@@ -38,24 +38,16 @@ def applyPatches():\n         SMTPMailer.send = catchAllExceptions(SMTPMailer.send)\n \n \n-def new_init(\n-    self,\n-    hostname="localhost",\n-    port=25,\n-    username=None,\n-    password=None,\n-    no_tls=False,\n-    force_tls=False,\n-):\n-    registry = getUtility(IRegistry)\n-    mail_settings = registry.forInterface(IMailSchema, prefix="plone")\n-    self.hostname = mail_settings.smtp_host\n-    self.port = mail_settings.smtp_port\n-    self.username = mail_settings.smtp_userid\n-    self.password = mail_settings.smtp_pass\n-    self.force_tls = force_tls\n-    self.no_tls = no_tls\n-    self._smtp = _SMTPState()\n-\n-\n-SMTPMailer.__init__ = new_init\n+def mail_settings_wrapper(func):\n+    def wrapper(self, **kwargs):\n+        registry = getUtility(IRegistry)\n+        mail_settings = registry.forInterface(IMailSchema, prefix="plone")\n+        kwargs["hostname"] = mail_settings.smtp_host\n+        kwargs["port"] = mail_settings.smtp_port\n+        kwargs["username"] = mail_settings.smtp_userid\n+        kwargs["password"] = mail_settings.smtp_pass\n+        return func(self, **kwargs)\n+\n+    return wrapper\n+\n+SMTPMailer.__init__ = mail_settings_wrapper(SMTPMailer.__init__)\ndiff --git a/news/3941.feature b/news/3941.feature\nnew file mode 100644\nindex 0000000000..15a20d1cb9\n--- /dev/null\n+++ b/news/3941.feature\n@@ -0,0 +1,2 @@\n+Extends `SMTPMailer.__init__` patch to allow to use other arguments.\n+[mamico]\n'

