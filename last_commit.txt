Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2022-03-07T14:59:01+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/8b8ca44c89479c00edb73e2e0d74074f64982718

black

Note: this is with latest black 22.1.0.
The previous version (in my case locally 21.8b0) made no changes.

Files changed:
M src/plone/recipe/zope2instance/ctl.py
M src/plone/recipe/zope2instance/recipe.py

b'diff --git a/src/plone/recipe/zope2instance/ctl.py b/src/plone/recipe/zope2instance/ctl.py\nindex 1e0114d..9d1f4ca 100644\n--- a/src/plone/recipe/zope2instance/ctl.py\n+++ b/src/plone/recipe/zope2instance/ctl.py\n@@ -884,19 +884,16 @@ def do_adduser(self, arg):\n         except Exception:\n             print("usage: adduser <name> <password>")\n             return\n-        cmdline = (\n-            self.get_startup_cmd(\n-                self.options.python,\n-                "import Zope2; "\n-                "app = Zope2.app(); "\n-                "result = app.acl_users._doAddUser("\n-                "\'%s\', \'%s\', [\'Manager\'], []); "\n-                "import transaction; "\n-                "transaction.commit(); "\n-                "print(\'Created user:\', result)",\n-            )\n-            % (name, password)\n-        )\n+        cmdline = self.get_startup_cmd(\n+            self.options.python,\n+            "import Zope2; "\n+            "app = Zope2.app(); "\n+            "result = app.acl_users._doAddUser("\n+            "\'%s\', \'%s\', [\'Manager\'], []); "\n+            "import transaction; "\n+            "transaction.commit(); "\n+            "print(\'Created user:\', result)",\n+        ) % (name, password)\n         os.system(cmdline)\n \n     def help_adduser(self):\ndiff --git a/src/plone/recipe/zope2instance/recipe.py b/src/plone/recipe/zope2instance/recipe.py\nindex b86a85b..3d3dfda 100644\n--- a/src/plone/recipe/zope2instance/recipe.py\n+++ b/src/plone/recipe/zope2instance/recipe.py\n@@ -103,13 +103,10 @@ def __init__(self, buildout, name, options):\n             options["initialization"] = ""\n         options["initialization"] = options["initialization"] % options\n \n-        self._include_site_packages = (\n-            options.get(\n-                "include-site-packages",\n-                buildout["buildout"].get("include-site-packages", "false"),\n-            )\n-            not in ("off", "disable", "false")\n-        )\n+        self._include_site_packages = options.get(\n+            "include-site-packages",\n+            buildout["buildout"].get("include-site-packages", "false"),\n+        ) not in ("off", "disable", "false")\n \n         self.wsgi = True\n         self.wsgi_config = os.path.join(options["location"], "etc", "wsgi.ini")\n'

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2022-03-07T15:07:37+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/29421273723fe12c23ab3d5abf34f59d3de983ca

Update Zope versions that we test with: 4.7 and 5.4.

Files changed:
M requirements-testing-zope-4.txt
M requirements-testing-zope-5.txt

b'diff --git a/requirements-testing-zope-4.txt b/requirements-testing-zope-4.txt\nindex 1e27cd3..0a61dab 100644\n--- a/requirements-testing-zope-4.txt\n+++ b/requirements-testing-zope-4.txt\n@@ -1,5 +1,5 @@\n -e .[test]\n--c https://zopefoundation.github.io/Zope/releases/4.5.5/requirements-full.txt\n+-c https://zopefoundation.github.io/Zope/releases/4.7/requirements-full.txt\n \n # Windows specific down here (has to be installed here, fails in buildout)\n # Dependency of zope.sendmail:\ndiff --git a/requirements-testing-zope-5.txt b/requirements-testing-zope-5.txt\nindex a551a68..716ac2a 100644\n--- a/requirements-testing-zope-5.txt\n+++ b/requirements-testing-zope-5.txt\n@@ -1,5 +1,5 @@\n -e .[test]\n--c https://zopefoundation.github.io/Zope/releases/5.1.2/requirements-full.txt\n+-c https://zopefoundation.github.io/Zope/releases/5.4/requirements-full.txt\n \n # Windows specific down here (has to be installed here, fails in buildout)\n # Dependency of zope.sendmail:\n'

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2022-03-07T15:08:08+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/ee59ef0f38dc8c2f8d1cbd5c53f0442806f43a03

tox: test Python 3.9 with Zope 5.

The GitHub actions already do this.

Files changed:
M tox.ini

b'diff --git a/tox.ini b/tox.ini\nindex 12f0258..7faa6fd 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -25,6 +25,11 @@ deps =\n setenv =\n     COVERAGE_FILE=.coverage.{envname}\n \n+[testenv:py39]\n+deps =\n+    -rrequirements-testing-zope-5.txt\n+    coverage\n+\n [testenv:coverage]\n basepython = python2.7\n skip_install = true\n@@ -61,4 +66,4 @@ commands = black --check src setup.py\n basepython = python3.8\n skip_install = true\n deps = isort\n-commands = isort --check-only --df src setup.py\n\\ No newline at end of file\n+commands = isort --check-only --df src setup.py\n'

Repository: plone.recipe.zope2instance


Branch: refs/heads/master
Date: 2022-03-07T17:36:15+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.recipe.zope2instance/commit/010451ebd0398470bb23ae4660116659531b2f0e

Merge pull request #184 from plone/maurits-fix-ci

Fix CI

Files changed:
M requirements-testing-zope-4.txt
M requirements-testing-zope-5.txt
M src/plone/recipe/zope2instance/ctl.py
M src/plone/recipe/zope2instance/recipe.py
M tox.ini

b'diff --git a/requirements-testing-zope-4.txt b/requirements-testing-zope-4.txt\nindex 1e27cd3..0a61dab 100644\n--- a/requirements-testing-zope-4.txt\n+++ b/requirements-testing-zope-4.txt\n@@ -1,5 +1,5 @@\n -e .[test]\n--c https://zopefoundation.github.io/Zope/releases/4.5.5/requirements-full.txt\n+-c https://zopefoundation.github.io/Zope/releases/4.7/requirements-full.txt\n \n # Windows specific down here (has to be installed here, fails in buildout)\n # Dependency of zope.sendmail:\ndiff --git a/requirements-testing-zope-5.txt b/requirements-testing-zope-5.txt\nindex a551a68..716ac2a 100644\n--- a/requirements-testing-zope-5.txt\n+++ b/requirements-testing-zope-5.txt\n@@ -1,5 +1,5 @@\n -e .[test]\n--c https://zopefoundation.github.io/Zope/releases/5.1.2/requirements-full.txt\n+-c https://zopefoundation.github.io/Zope/releases/5.4/requirements-full.txt\n \n # Windows specific down here (has to be installed here, fails in buildout)\n # Dependency of zope.sendmail:\ndiff --git a/src/plone/recipe/zope2instance/ctl.py b/src/plone/recipe/zope2instance/ctl.py\nindex 1e0114d..9d1f4ca 100644\n--- a/src/plone/recipe/zope2instance/ctl.py\n+++ b/src/plone/recipe/zope2instance/ctl.py\n@@ -884,19 +884,16 @@ def do_adduser(self, arg):\n         except Exception:\n             print("usage: adduser <name> <password>")\n             return\n-        cmdline = (\n-            self.get_startup_cmd(\n-                self.options.python,\n-                "import Zope2; "\n-                "app = Zope2.app(); "\n-                "result = app.acl_users._doAddUser("\n-                "\'%s\', \'%s\', [\'Manager\'], []); "\n-                "import transaction; "\n-                "transaction.commit(); "\n-                "print(\'Created user:\', result)",\n-            )\n-            % (name, password)\n-        )\n+        cmdline = self.get_startup_cmd(\n+            self.options.python,\n+            "import Zope2; "\n+            "app = Zope2.app(); "\n+            "result = app.acl_users._doAddUser("\n+            "\'%s\', \'%s\', [\'Manager\'], []); "\n+            "import transaction; "\n+            "transaction.commit(); "\n+            "print(\'Created user:\', result)",\n+        ) % (name, password)\n         os.system(cmdline)\n \n     def help_adduser(self):\ndiff --git a/src/plone/recipe/zope2instance/recipe.py b/src/plone/recipe/zope2instance/recipe.py\nindex b86a85b..3d3dfda 100644\n--- a/src/plone/recipe/zope2instance/recipe.py\n+++ b/src/plone/recipe/zope2instance/recipe.py\n@@ -103,13 +103,10 @@ def __init__(self, buildout, name, options):\n             options["initialization"] = ""\n         options["initialization"] = options["initialization"] % options\n \n-        self._include_site_packages = (\n-            options.get(\n-                "include-site-packages",\n-                buildout["buildout"].get("include-site-packages", "false"),\n-            )\n-            not in ("off", "disable", "false")\n-        )\n+        self._include_site_packages = options.get(\n+            "include-site-packages",\n+            buildout["buildout"].get("include-site-packages", "false"),\n+        ) not in ("off", "disable", "false")\n \n         self.wsgi = True\n         self.wsgi_config = os.path.join(options["location"], "etc", "wsgi.ini")\ndiff --git a/tox.ini b/tox.ini\nindex 12f0258..7faa6fd 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -25,6 +25,11 @@ deps =\n setenv =\n     COVERAGE_FILE=.coverage.{envname}\n \n+[testenv:py39]\n+deps =\n+    -rrequirements-testing-zope-5.txt\n+    coverage\n+\n [testenv:coverage]\n basepython = python2.7\n skip_install = true\n@@ -61,4 +66,4 @@ commands = black --check src setup.py\n basepython = python3.8\n skip_install = true\n deps = isort\n-commands = isort --check-only --df src setup.py\n\\ No newline at end of file\n+commands = isort --check-only --df src setup.py\n'

