Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-09-02T14:46:11+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.restapi/commit/727be2108419bea59e145a2021bb9a7159b36045

Fixed deprecation warnings for zope.site.hooks and ILanguageSchema.

Note: zope.component.hooks already works in Plone 4.3.
Part of https://github.com/plone/plone.restapi/issues/975

Files changed:
A news/975.bugfix
M src/plone/restapi/testing.py
M src/plone/restapi/tests/test_documentation.py
M src/plone/restapi/tests/test_serializer_summary.py

b'diff --git a/news/975.bugfix b/news/975.bugfix\nnew file mode 100644\nindex 000000000..0dfe3916d\n--- /dev/null\n+++ b/news/975.bugfix\n@@ -0,0 +1,2 @@\n+Fixed deprecation warnings for ``zope.site.hooks`` and ``CMFPlone.interfaces.ILanguageSchema``.\n+[maurits]\ndiff --git a/src/plone/restapi/testing.py b/src/plone/restapi/testing.py\nindex 2016cd0ec..82e71fade 100644\n--- a/src/plone/restapi/testing.py\n+++ b/src/plone/restapi/testing.py\n@@ -99,7 +99,12 @@ def enable_request_language_negotiation(portal):\n     pieces of content in different languages.\n     """\n     if PLONE_5:\n-        from Products.CMFPlone.interfaces import ILanguageSchema\n+        try:\n+            # Plone 5.2+\n+            from plone.i18n.interfaces import ILanguageSchema\n+        except ImportError:  # pragma: no cover\n+            # Plone 5.0/5.1\n+            from Products.CMFPlone.interfaces import ILanguageSchema\n \n         registry = getUtility(IRegistry)\n         settings = registry.forInterface(ILanguageSchema, prefix="plone")\ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex 340af949e..1c2e9a4de 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -33,7 +33,7 @@\n from zope.component import createObject\n from zope.component import getUtility\n from zope.interface import alsoProvides\n-from zope.site.hooks import getSite\n+from zope.component.hooks import getSite\n \n import collections\n import json\ndiff --git a/src/plone/restapi/tests/test_serializer_summary.py b/src/plone/restapi/tests/test_serializer_summary.py\nindex 2b102fc97..f8884e7d8 100644\n--- a/src/plone/restapi/tests/test_serializer_summary.py\n+++ b/src/plone/restapi/tests/test_serializer_summary.py\n@@ -13,7 +13,7 @@\n from plone.restapi.testing import register_static_uuid_utility\n from Products.CMFCore.utils import getToolByName\n from zope.component import getMultiAdapter\n-from zope.site.hooks import getSite\n+from zope.component.hooks import getSite\n \n import Missing\n import unittest\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-09-02T15:00:21+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.restapi/commit/6117f4d1672fb622702dc907e46dce4b9c58827f

Fixed DeprecationWarning: splitSchemaName: moved to plone.dexterity.schema

Files changed:
M news/975.bugfix
M src/plone/restapi/types/utils.py

b'diff --git a/news/975.bugfix b/news/975.bugfix\nindex 0dfe3916d..14319d376 100644\n--- a/news/975.bugfix\n+++ b/news/975.bugfix\n@@ -1,2 +1,3 @@\n-Fixed deprecation warnings for ``zope.site.hooks`` and ``CMFPlone.interfaces.ILanguageSchema``.\n+Fixed deprecation warnings for ``zope.site.hooks``, ``CMFPlone.interfaces.ILanguageSchema``\n+and ``plone.dexterity.utils.splitSchemaName``.\n [maurits]\ndiff --git a/src/plone/restapi/types/utils.py b/src/plone/restapi/types/utils.py\nindex cd3d9b684..bac7e0f24 100644\n--- a/src/plone/restapi/types/utils.py\n+++ b/src/plone/restapi/types/utils.py\n@@ -22,7 +22,6 @@\n from plone.dexterity.interfaces import IDexterityContent\n from plone.dexterity.interfaces import IDexterityFTI\n from plone.dexterity.utils import getAdditionalSchemata\n-from plone.dexterity.utils import splitSchemaName\n from plone.i18n.normalizer import idnormalizer\n from plone.restapi.interfaces import IFieldDeserializer\n from plone.restapi.serializer.converters import IJsonCompatible\n@@ -43,6 +42,14 @@\n from zope.interface import implementer\n from zope.schema.interfaces import IVocabularyFactory\n \n+try:\n+    # Plone 5.1+\n+    from plone.dexterity.schema import splitSchemaName\n+except ImportError:\n+    # Plone 4.3\n+    from plone.dexterity.utils import splitSchemaName\n+\n+\n _marker = []  # Create a new marker object.\n \n FIELD_PROPERTIES_MAPPING = {\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-09-02T17:36:45+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.restapi/commit/1fb8709402d0f33ac530dd8969f817bbb9aacb4c

Merge pull request #988 from plone/maurits/fix-warnings

Fixed deprecation warnings for zope.site.hooks and ILanguageSchema.

Files changed:
A news/975.bugfix
M src/plone/restapi/testing.py
M src/plone/restapi/tests/test_documentation.py
M src/plone/restapi/tests/test_serializer_summary.py
M src/plone/restapi/types/utils.py

b'diff --git a/news/975.bugfix b/news/975.bugfix\nnew file mode 100644\nindex 000000000..14319d376\n--- /dev/null\n+++ b/news/975.bugfix\n@@ -0,0 +1,3 @@\n+Fixed deprecation warnings for ``zope.site.hooks``, ``CMFPlone.interfaces.ILanguageSchema``\n+and ``plone.dexterity.utils.splitSchemaName``.\n+[maurits]\ndiff --git a/src/plone/restapi/testing.py b/src/plone/restapi/testing.py\nindex 2016cd0ec..82e71fade 100644\n--- a/src/plone/restapi/testing.py\n+++ b/src/plone/restapi/testing.py\n@@ -99,7 +99,12 @@ def enable_request_language_negotiation(portal):\n     pieces of content in different languages.\n     """\n     if PLONE_5:\n-        from Products.CMFPlone.interfaces import ILanguageSchema\n+        try:\n+            # Plone 5.2+\n+            from plone.i18n.interfaces import ILanguageSchema\n+        except ImportError:  # pragma: no cover\n+            # Plone 5.0/5.1\n+            from Products.CMFPlone.interfaces import ILanguageSchema\n \n         registry = getUtility(IRegistry)\n         settings = registry.forInterface(ILanguageSchema, prefix="plone")\ndiff --git a/src/plone/restapi/tests/test_documentation.py b/src/plone/restapi/tests/test_documentation.py\nindex 340af949e..1c2e9a4de 100644\n--- a/src/plone/restapi/tests/test_documentation.py\n+++ b/src/plone/restapi/tests/test_documentation.py\n@@ -33,7 +33,7 @@\n from zope.component import createObject\n from zope.component import getUtility\n from zope.interface import alsoProvides\n-from zope.site.hooks import getSite\n+from zope.component.hooks import getSite\n \n import collections\n import json\ndiff --git a/src/plone/restapi/tests/test_serializer_summary.py b/src/plone/restapi/tests/test_serializer_summary.py\nindex 2b102fc97..f8884e7d8 100644\n--- a/src/plone/restapi/tests/test_serializer_summary.py\n+++ b/src/plone/restapi/tests/test_serializer_summary.py\n@@ -13,7 +13,7 @@\n from plone.restapi.testing import register_static_uuid_utility\n from Products.CMFCore.utils import getToolByName\n from zope.component import getMultiAdapter\n-from zope.site.hooks import getSite\n+from zope.component.hooks import getSite\n \n import Missing\n import unittest\ndiff --git a/src/plone/restapi/types/utils.py b/src/plone/restapi/types/utils.py\nindex cd3d9b684..bac7e0f24 100644\n--- a/src/plone/restapi/types/utils.py\n+++ b/src/plone/restapi/types/utils.py\n@@ -22,7 +22,6 @@\n from plone.dexterity.interfaces import IDexterityContent\n from plone.dexterity.interfaces import IDexterityFTI\n from plone.dexterity.utils import getAdditionalSchemata\n-from plone.dexterity.utils import splitSchemaName\n from plone.i18n.normalizer import idnormalizer\n from plone.restapi.interfaces import IFieldDeserializer\n from plone.restapi.serializer.converters import IJsonCompatible\n@@ -43,6 +42,14 @@\n from zope.interface import implementer\n from zope.schema.interfaces import IVocabularyFactory\n \n+try:\n+    # Plone 5.1+\n+    from plone.dexterity.schema import splitSchemaName\n+except ImportError:\n+    # Plone 4.3\n+    from plone.dexterity.utils import splitSchemaName\n+\n+\n _marker = []  # Create a new marker object.\n \n FIELD_PROPERTIES_MAPPING = {\n'

