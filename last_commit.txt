Repository: plone.restapi


Branch: refs/heads/7.x.x
Date: 2021-10-12T12:12:18+02:00
Author: ichim-david (ichim-david) <ichim.david@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/745a0c2bb57602631d31abc26729952a753b3fa2

Port #1120 to 7.x.x (#1245)

* Pin jsonschema to a version that is still compatible with Python 2.7

* Pin flake8 and pycodestyle that doesn't crash on Python 2.7 or 3.8 and Plone 5.2

* Added news entry for history change

* Add collective.zpretty integration (#1120)

* Run zpretty on zcml files

* Support for bash

* Fix GH workflow name

* Test zpretty wf

* Try to fail on git diff

* Run zpretty

* Add zpretty makefile target

* Add news entry

* Rename news file

(cherry picked from commit 80c0b085381dceb177b48fed34897ecd69d7efa4)

* Set sleep also for test_types_document_patch_properties since it failed

* zpretty fix

* Added missing name to locking patch

Co-authored-by: Tiberiu Ichim &lt;tiberiuichim@users.noreply.github.com&gt;

Files changed:
A .github/workflows/zpretty.yml
A news/1120.internal
M Makefile
M requirements.txt
M src/plone/restapi/configure.zcml
M src/plone/restapi/demo/configure.zcml
M src/plone/restapi/deserializer/configure.zcml
M src/plone/restapi/deserializer/controlpanels/configure.zcml
M src/plone/restapi/indexers.zcml
M src/plone/restapi/meta.zcml
M src/plone/restapi/permissions.zcml
M src/plone/restapi/search/configure.zcml
M src/plone/restapi/serializer/configure.zcml
M src/plone/restapi/serializer/controlpanels/configure.zcml
M src/plone/restapi/services/actions/configure.zcml
M src/plone/restapi/services/addons/configure.zcml
M src/plone/restapi/services/auth/configure.zcml
M src/plone/restapi/services/breadcrumbs/configure.zcml
M src/plone/restapi/services/configure.zcml
M src/plone/restapi/services/content/configure.zcml
M src/plone/restapi/services/contextnavigation/configure.zcml
M src/plone/restapi/services/controlpanels/configure.zcml
M src/plone/restapi/services/copymove/configure.zcml
M src/plone/restapi/services/database/configure.zcml
M src/plone/restapi/services/discussion/configure.zcml
M src/plone/restapi/services/email_notification/configure.zcml
M src/plone/restapi/services/email_send/configure.zcml
M src/plone/restapi/services/groups/configure.zcml
M src/plone/restapi/services/history/configure.zcml
M src/plone/restapi/services/multilingual/configure.zcml
M src/plone/restapi/services/navigation/configure.zcml
M src/plone/restapi/services/principals/configure.zcml
M src/plone/restapi/services/querysources/configure.zcml
M src/plone/restapi/services/querystring/configure.zcml
M src/plone/restapi/services/querystringsearch/configure.zcml
M src/plone/restapi/services/registry/configure.zcml
M src/plone/restapi/services/roles/configure.zcml
M src/plone/restapi/services/search/configure.zcml
M src/plone/restapi/services/sources/configure.zcml
M src/plone/restapi/services/system/configure.zcml
M src/plone/restapi/services/tiles/configure.zcml
M src/plone/restapi/services/types/configure.zcml
M src/plone/restapi/services/users/configure.zcml
M src/plone/restapi/services/vocabularies/configure.zcml
M src/plone/restapi/services/workflow/configure.zcml
M src/plone/restapi/testing.zcml
M src/plone/restapi/tests/test_services_types.py
M src/plone/restapi/types/configure.zcml
M src/plone/restapi/upgrades/configure.zcml

b'diff --git a/.github/workflows/zpretty.yml b/.github/workflows/zpretty.yml\nnew file mode 100644\nindex 000000000..ef53ff490\n--- /dev/null\n+++ b/.github/workflows/zpretty.yml\n@@ -0,0 +1,39 @@\n+name: zpretty\n+on: [push]\n+jobs:\n+  build:\n+    runs-on: ubuntu-latest\n+    strategy:\n+      fail-fast: false\n+      matrix:\n+        python-version: [3.8]\n+\n+    steps:\n+      # git checkout\n+      - uses: actions/checkout@v2\n+\n+      # python setup\n+      - name: Set up Python ${{ matrix.python-version }}\n+        uses: actions/setup-python@v1\n+        with:\n+          python-version: ${{ matrix.python-version }}\n+\n+      # python cache\n+      - uses: actions/cache@v1\n+        with:\n+          path: ~/.cache/pip\n+          key: ${{ runner.os }}-pip-${{ hashFiles(\'**/requirements.txt\') }}\n+          restore-keys: |\n+            ${{ runner.os }}-pip-\n+\n+      # install zpretty\n+      - name: install zpretty\n+        run: pip install zpretty\n+\n+      # run zpretty\n+      - name: run zpretty\n+        run: find src/ -name *.zcml | xargs zpretty -i\n+\n+      # run git diff\n+      - name: run git diff\n+        run: git diff --exit-code\ndiff --git a/Makefile b/Makefile\nindex 78f6e9d7f..451e93f80 100644\n--- a/Makefile\n+++ b/Makefile\n@@ -101,6 +101,10 @@ black:  ## Black\n \tbin/code-analysis\n \tif [ -f "bin/black" ]; then bin/black src/ ; fi\n \n+.PHONY: zpretty\n+zpretty:\t##\n+\tif [ -f "bin/zpretty" ]; then zpretty -i ./**/*.zcml; fi\n+\n .PHONY: Build Docs\n docs:  ## Build Docs\n \tbin/sphinxbuilder\ndiff --git a/news/1120.internal b/news/1120.internal\nnew file mode 100644\nindex 000000000..63683ff2d\n--- /dev/null\n+++ b/news/1120.internal\n@@ -0,0 +1 @@\n+Format zcml files with collective.zpretty. Add zpretty Github workflow. @tiberiuichim\ndiff --git a/requirements.txt b/requirements.txt\nindex 8466fed9b..4d851222a 100644\n--- a/requirements.txt\n+++ b/requirements.txt\n@@ -2,3 +2,4 @@\n setuptools==42.0.2\n zc.buildout==2.13.3\n wheel\n+zpretty\ndiff --git a/src/plone/restapi/configure.zcml b/src/plone/restapi/configure.zcml\nindex 5bf67e96a..9f5fcaf2c 100644\n--- a/src/plone/restapi/configure.zcml\n+++ b/src/plone/restapi/configure.zcml\n@@ -1,85 +1,98 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:five="http://namespaces.zope.org/five"\n+    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:i18n="http://namespaces.zope.org/i18n"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone.restapi">\n+    i18n_domain="plone.restapi"\n+    >\n \n   <i18n:registerTranslations directory="locales" />\n \n-  <include package="plone.behavior" file="meta.zcml"/>\n-  <include package="plone.rest" file="meta.zcml"/>\n+  <include\n+      package="plone.behavior"\n+      file="meta.zcml"\n+      />\n+  <include\n+      package="plone.rest"\n+      file="meta.zcml"\n+      />\n \n   <include package="plone.behavior" />\n   <include package="plone.rest" />\n   <include package="plone.schema" />\n   <include file="indexers.zcml" />\n \n-  <five:registerPackage package="." initialize=".initialize" />\n+  <five:registerPackage\n+      package="."\n+      initialize=".initialize"\n+      />\n \n   <include file="permissions.zcml" />\n \n   <genericsetup:registerProfile\n       name="default"\n       title="plone.restapi"\n-      directory="profiles/default"\n       description="RESTful hypermedia API for Plone."\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/default"\n       />\n \n   <genericsetup:registerProfile\n       name="testing"\n       title="plone.restapi testing"\n-      directory="profiles/testing"\n       description="Adds sample content types for testing"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       for="Products.CMFPlone.interfaces.ITestCasePloneSiteRoot"\n+      directory="profiles/testing"\n       />\n \n   <genericsetup:registerProfile\n       name="testing-workflows"\n       title="plone.restapi testing-workflows"\n-      directory="profiles/testing-workflows"\n       description="Adds sample workflows for testing"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n       for="Products.CMFPlone.interfaces.ITestCasePloneSiteRoot"\n+      directory="profiles/testing-workflows"\n       />\n \n   <genericsetup:registerProfile\n       name="performance"\n       title="plone.restapi performance testing"\n-      directory="profiles/performance"\n       description="Adds sample content for performance testing"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/performance"\n       />\n \n   <genericsetup:registerProfile\n       name="blocks"\n       title="Volto Blocks"\n-      directory="profiles/blocks"\n       description="Enables blocks on the Document content type"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/blocks"\n       />\n \n   <!-- Register "various" import step -->\n   <genericsetup:importStep\n-    name="plone.restapi"\n-    title="plone.restapi special import handlers"\n-    description=""\n-    handler="plone.restapi.setuphandlers.import_various"\n-    />\n+      name="plone.restapi"\n+      title="plone.restapi special import handlers"\n+      description=""\n+      handler="plone.restapi.setuphandlers.import_various"\n+      />\n \n   <genericsetup:registerProfile\n       name="uninstall"\n       title="plone.restapi"\n-      directory="profiles/uninstall"\n       description="RESTful hypermedia API for Plone - Uninstall"\n       provides="Products.GenericSetup.interfaces.EXTENSION"\n+      directory="profiles/uninstall"\n       />\n \n-  <include package="plone.rest" file="configure.zcml" />\n+  <include\n+      package="plone.rest"\n+      file="configure.zcml"\n+      />\n   <include package=".services" />\n   <include package=".serializer" />\n   <include package=".deserializer" />\n@@ -90,21 +103,24 @@\n \n   <configure zcml:condition="installed plone.app.dexterity">\n \n-    <include package="plone.behavior" file="meta.zcml"/>\n+    <include\n+        package="plone.behavior"\n+        file="meta.zcml"\n+        />\n \n     <plone:behavior\n         name="volto.blocks"\n         title="Blocks"\n         description="Enables Volto Blocks support"\n         provides=".behaviors.IBlocks"\n-      />\n+        />\n \n   </configure>\n \n   <utility\n       factory=".setuphandlers.HiddenProfiles"\n-      name="plone.restapi"\n       provides="Products.CMFPlone.interfaces.INonInstallable"\n+      name="plone.restapi"\n       />\n \n </configure>\ndiff --git a/src/plone/restapi/demo/configure.zcml b/src/plone/restapi/demo/configure.zcml\nindex fe5745bc4..61e0349d3 100644\n--- a/src/plone/restapi/demo/configure.zcml\n+++ b/src/plone/restapi/demo/configure.zcml\n@@ -2,22 +2,23 @@\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n     xmlns:five="http://namespaces.zope.org/five"\n-    xmlns:i18n="http://namespaces.zope.org/i18n"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    i18n_domain="plone.restapi">\n+    xmlns:i18n="http://namespaces.zope.org/i18n"\n+    i18n_domain="plone.restapi"\n+    >\n \n   <browser:page\n-    for="*"\n-    name="plone-restapi-demo-angular"\n-    template="angular.pt"\n-    permission="zope2.View"\n-    />\n+      name="plone-restapi-demo-angular"\n+      for="*"\n+      template="angular.pt"\n+      permission="zope2.View"\n+      />\n \n   <browser:page\n-    for="*"\n-    name="500-internal-server-error"\n-    class=".demo.InternalServerErrorView"\n-    permission="zope2.View"\n-    />\n+      name="500-internal-server-error"\n+      for="*"\n+      class=".demo.InternalServerErrorView"\n+      permission="zope2.View"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/deserializer/configure.zcml b/src/plone/restapi/deserializer/configure.zcml\nindex 997ca68cf..2407d7d4b 100644\n--- a/src/plone/restapi/deserializer/configure.zcml\n+++ b/src/plone/restapi/deserializer/configure.zcml\n@@ -1,7 +1,8 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone.restapi">\n+    i18n_domain="plone.restapi"\n+    >\n \n   <adapter factory=".site.DeserializeSiteRootFromJson" />\n   <adapter factory=".dxcontent.DeserializeFromJson" />\n@@ -22,25 +23,75 @@\n     <adapter factory=".dxfields.LinkTextLineFieldDeserializer" />\n   </configure>\n \n-  <subscriber factory=".blocks.TextBlockDeserializer"\n-    provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"/>\n-  <subscriber factory=".blocks.HTMLBlockDeserializer"\n-    provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"/>\n-  <subscriber factory=".blocks.ImageBlockDeserializer"\n-    provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"/>\n-  <subscriber factory=".blocks.ResolveUIDDeserializer"\n-    provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"/>\n-  <subscriber factory=".blocks.TextBlockDeserializerRoot"\n-    provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"/>\n-  <subscriber factory=".blocks.HTMLBlockDeserializerRoot"\n-    provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"/>\n-  <subscriber factory=".blocks.ImageBlockDeserializerRoot"\n-    provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"/>\n-  <subscriber factory=".blocks.ResolveUIDDeserializerRoot"\n-    provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"/>\n-  \n-  <adapter factory=".local_roles.DeserializeFromJson"\n-           name="local_roles"/>\n+  <subscriber\n+      factory=".blocks.TextBlockDeserializer"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.HTMLBlockDeserializer"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.ImageBlockDeserializer"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.ResolveUIDDeserializer"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.TextBlockDeserializerRoot"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.HTMLBlockDeserializerRoot"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.ImageBlockDeserializerRoot"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.ResolveUIDDeserializerRoot"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.TextBlockDeserializer"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.HTMLBlockDeserializer"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.ImageBlockDeserializer"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.ResolveUIDDeserializer"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.TextBlockDeserializerRoot"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.HTMLBlockDeserializerRoot"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.ImageBlockDeserializerRoot"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.ResolveUIDDeserializerRoot"\n+      provides="plone.restapi.interfaces.IBlockFieldDeserializationTransformer"\n+      />\n+\n+  <adapter\n+      factory=".local_roles.DeserializeFromJson"\n+      name="local_roles"\n+      />\n \n   <configure zcml:condition="installed z3c.relationfield">\n     <adapter factory=".relationfield.RelationChoiceFieldDeserializer" />\n@@ -54,7 +105,7 @@\n   <configure zcml:condition="installed Products.Archetypes.atapi">\n     <adapter factory=".atcontent.DeserializeFromJson" />\n     <configure zcml:condition="installed plone.app.blob">\n-        <adapter factory=".atfields.BlobFieldDeserializer" />\n+      <adapter factory=".atfields.BlobFieldDeserializer" />\n     </configure>\n     <adapter factory=".atfields.DefaultFieldDeserializer" />\n     <adapter factory=".atfields.FileFieldDeserializer" />\ndiff --git a/src/plone/restapi/deserializer/controlpanels/configure.zcml b/src/plone/restapi/deserializer/controlpanels/configure.zcml\nindex 1e3fe4cc2..e6202ceb3 100644\n--- a/src/plone/restapi/deserializer/controlpanels/configure.zcml\n+++ b/src/plone/restapi/deserializer/controlpanels/configure.zcml\n@@ -1,8 +1,9 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    i18n_domain="plone.restapi">\n+    i18n_domain="plone.restapi"\n+    >\n \n-    <adapter factory=".ControlpanelDeserializeFromJson" />\n-    <adapter factory=".types.DexterityTypesControlpanelDeserializeFromJson" />\n+  <adapter factory=".ControlpanelDeserializeFromJson" />\n+  <adapter factory=".types.DexterityTypesControlpanelDeserializeFromJson" />\n \n </configure>\ndiff --git a/src/plone/restapi/indexers.zcml b/src/plone/restapi/indexers.zcml\nindex 4a3c2cd22..b9f1e7496 100644\n--- a/src/plone/restapi/indexers.zcml\n+++ b/src/plone/restapi/indexers.zcml\n@@ -1,12 +1,18 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone">\n+    i18n_domain="plone"\n+    >\n \n   <configure zcml:condition="installed plone.app.contenttypes">\n-    <adapter name="SearchableText" factory=".indexers.SearchableText_blocks" />\n-    <adapter name="text" factory=".indexers.TextBlockSearchableText" />\n+    <adapter\n+        factory=".indexers.SearchableText_blocks"\n+        name="SearchableText"\n+        />\n+    <adapter\n+        factory=".indexers.TextBlockSearchableText"\n+        name="text"\n+        />\n   </configure>\n \n </configure>\n-\ndiff --git a/src/plone/restapi/meta.zcml b/src/plone/restapi/meta.zcml\nindex 580228c85..92dca6cbf 100644\n--- a/src/plone/restapi/meta.zcml\n+++ b/src/plone/restapi/meta.zcml\n@@ -1,7 +1,8 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:meta="http://namespaces.zope.org/meta"\n-    i18n_domain="plone.restapi">\n+    i18n_domain="plone.restapi"\n+    >\n \n   <meta:provides feature="plonerestapi-7" />\n \ndiff --git a/src/plone/restapi/permissions.zcml b/src/plone/restapi/permissions.zcml\nindex 8dcd48e81..2ff8a58ea 100644\n--- a/src/plone/restapi/permissions.zcml\n+++ b/src/plone/restapi/permissions.zcml\n@@ -1,6 +1,7 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    i18n_domain="plone.restapi">\n+    i18n_domain="plone.restapi"\n+    >\n \n   <permission\n       id="plone.restapi.UseRESTAPI"\ndiff --git a/src/plone/restapi/search/configure.zcml b/src/plone/restapi/search/configure.zcml\nindex ba5742f0d..9f7e8165d 100644\n--- a/src/plone/restapi/search/configure.zcml\n+++ b/src/plone/restapi/search/configure.zcml\n@@ -2,21 +2,22 @@\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:i18n="http://namespaces.zope.org/i18n"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone.restapi">\n+    i18n_domain="plone.restapi"\n+    >\n \n-    <adapter factory=".query.ZCatalogCompatibleQueryAdapter" />\n+  <adapter factory=".query.ZCatalogCompatibleQueryAdapter" />\n \n-    <adapter factory=".query.ZCTextIndexQueryParser" />\n-    <adapter factory=".query.KeywordIndexQueryParser" />\n-    <adapter factory=".query.FieldIndexQueryParser" />\n-    <adapter factory=".query.BooleanIndexQueryParser" />\n-    <adapter factory=".query.ExtendedPathIndexQueryParser" />\n-    <adapter factory=".query.DateIndexQueryParser" />\n-    <adapter factory=".query.DateRangeIndexQueryParser" />\n-    <adapter factory=".query.UUIDIndexQueryParser" />\n+  <adapter factory=".query.ZCTextIndexQueryParser" />\n+  <adapter factory=".query.KeywordIndexQueryParser" />\n+  <adapter factory=".query.FieldIndexQueryParser" />\n+  <adapter factory=".query.BooleanIndexQueryParser" />\n+  <adapter factory=".query.ExtendedPathIndexQueryParser" />\n+  <adapter factory=".query.DateIndexQueryParser" />\n+  <adapter factory=".query.DateRangeIndexQueryParser" />\n+  <adapter factory=".query.UUIDIndexQueryParser" />\n \n-    <configure zcml:condition="installed Products.DateRecurringIndex">\n-        <adapter factory=".date_recurring_index.DateRecurringIndexQueryParser" />\n-    </configure>\n+  <configure zcml:condition="installed Products.DateRecurringIndex">\n+    <adapter factory=".date_recurring_index.DateRecurringIndexQueryParser" />\n+  </configure>\n \n </configure>\ndiff --git a/src/plone/restapi/serializer/configure.zcml b/src/plone/restapi/serializer/configure.zcml\nindex 2d748ac4a..69b6dff54 100644\n--- a/src/plone/restapi/serializer/configure.zcml\n+++ b/src/plone/restapi/serializer/configure.zcml\n@@ -1,114 +1,124 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone.restapi">\n-\n-    <adapter factory=".site.SerializeSiteRootToJson" />\n-    <adapter factory=".dxcontent.SerializeToJson" />\n-    <adapter factory=".dxcontent.SerializeFolderToJson" />\n-    <adapter\n-        factory=".dxcontent.DexterityObjectPrimaryFieldTarget" />\n-\n-    <configure zcml:condition="installed plone.app.contenttypes">\n-        <adapter factory=".collection.SerializeCollectionToJson" />\n-        <adapter factory=".dxfields.TextLineFieldSerializer" />\n-    </configure>\n-\n-    <adapter factory=".summary.DefaultJSONSummarySerializer" />\n-    <adapter factory=".summary.SiteRootJSONSummarySerializer" />\n-\n-    <adapter factory=".dxfields.DefaultFieldSerializer" />\n-    <adapter factory=".dxfields.ChoiceFieldSerializer" />\n-    <adapter factory=".dxfields.CollectionFieldSerializer" />\n-    <adapter factory=".dxfields.FileFieldSerializer" />\n-    <adapter factory=".dxfields.ImageFieldSerializer" />\n-    <adapter factory=".dxfields.RichttextFieldSerializer" />\n-    <adapter factory=".dxfields.DefaultPrimaryFieldTarget" />\n-    <adapter factory=".dxfields.PrimaryFileFieldTarget" />\n-\n-    <adapter factory=".blocks.BlocksJSONFieldSerializer" />\n-    <subscriber factory=".blocks.TextBlockSerializer"\n-      provides="plone.restapi.interfaces.IBlockFieldSerializationTransformer"/>\n-    <subscriber factory=".blocks.ResolveUIDSerializer"\n-      provides="plone.restapi.interfaces.IBlockFieldSerializationTransformer"/>\n-    <subscriber factory=".blocks.TextBlockSerializerRoot"\n-      provides="plone.restapi.interfaces.IBlockFieldSerializationTransformer"/>\n-    <subscriber factory=".blocks.ResolveUIDSerializerRoot"\n-      provides="plone.restapi.interfaces.IBlockFieldSerializationTransformer"/>\n-\n-    <!--\n+    i18n_domain="plone.restapi"\n+    >\n+\n+  <adapter factory=".site.SerializeSiteRootToJson" />\n+  <adapter factory=".dxcontent.SerializeToJson" />\n+  <adapter factory=".dxcontent.SerializeFolderToJson" />\n+  <adapter factory=".dxcontent.DexterityObjectPrimaryFieldTarget" />\n+\n+  <configure zcml:condition="installed plone.app.contenttypes">\n+    <adapter factory=".collection.SerializeCollectionToJson" />\n+    <adapter factory=".dxfields.TextLineFieldSerializer" />\n+  </configure>\n+\n+  <adapter factory=".summary.DefaultJSONSummarySerializer" />\n+  <adapter factory=".summary.SiteRootJSONSummarySerializer" />\n+\n+  <adapter factory=".dxfields.DefaultFieldSerializer" />\n+  <adapter factory=".dxfields.ChoiceFieldSerializer" />\n+  <adapter factory=".dxfields.CollectionFieldSerializer" />\n+  <adapter factory=".dxfields.FileFieldSerializer" />\n+  <adapter factory=".dxfields.ImageFieldSerializer" />\n+  <adapter factory=".dxfields.RichttextFieldSerializer" />\n+  <adapter factory=".dxfields.DefaultPrimaryFieldTarget" />\n+  <adapter factory=".dxfields.PrimaryFileFieldTarget" />\n+\n+\n+  <adapter factory=".blocks.BlocksJSONFieldSerializer" />\n+  <subscriber\n+      factory=".blocks.TextBlockSerializer"\n+      provides="plone.restapi.interfaces.IBlockFieldSerializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.ResolveUIDSerializer"\n+      provides="plone.restapi.interfaces.IBlockFieldSerializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.TextBlockSerializerRoot"\n+      provides="plone.restapi.interfaces.IBlockFieldSerializationTransformer"\n+      />\n+  <subscriber\n+      factory=".blocks.ResolveUIDSerializerRoot"\n+      provides="plone.restapi.interfaces.IBlockFieldSerializationTransformer"\n+      />\n+\n+  <!--\n       We check for Products.Archetypes.atapi to avoid false positive\n       due to code aliases in migration code,\n       see https://github.com/plone/plone.restapi/pull/1004\n     -->\n-    <configure zcml:condition="installed Products.Archetypes.atapi">\n-        <adapter factory=".atcontent.SerializeToJson" />\n-        <adapter factory=".atcontent.SerializeFolderToJson" />\n-        <configure zcml:condition="installed plone.app.blob">\n-            <adapter factory=".atfields.BlobFieldSerializer" />\n-            <adapter factory=".atfields.BlobImageFieldSerializer" />\n-        </configure>\n-        <adapter factory=".atfields.DefaultFieldSerializer" />\n-        <adapter factory=".atfields.FileFieldSerializer" />\n-        <adapter factory=".atfields.ImageFieldSerializer" />\n-        <adapter factory=".atfields.ReferenceFieldSerializer" />\n-        <adapter factory=".atfields.TextFieldSerializer" />\n-        <configure zcml:condition="installed plone.app.collection">\n-            <adapter factory=".atfields.QueryFieldSerializer" />\n-            <adapter factory=".atcollection.SerializeCollectionToJson" />\n-        </configure>\n+  <configure zcml:condition="installed Products.Archetypes.atapi">\n+    <adapter factory=".atcontent.SerializeToJson" />\n+    <adapter factory=".atcontent.SerializeFolderToJson" />\n+    <configure zcml:condition="installed plone.app.blob">\n+      <adapter factory=".atfields.BlobFieldSerializer" />\n+      <adapter factory=".atfields.BlobImageFieldSerializer" />\n     </configure>\n-\n-    <adapter factory=".converters.date_converter" />\n-    <adapter factory=".converters.decimal_converter" />\n-    <adapter factory=".converters.default_converter" />\n-    <adapter factory=".converters.dict_converter" />\n-    <adapter factory=".converters.frozenset_converter" />\n-    <adapter factory=".converters.i18n_message_converter" />\n-    <adapter factory=".converters.list_converter" />\n-    <adapter factory=".converters.missing_value_converter" />\n-    <adapter factory=".converters.persistent_list_converter" />\n-    <adapter factory=".converters.persistent_mapping_converter" />\n-    <adapter factory=".converters.python_datetime_converter" />\n-    <adapter factory=".converters.RichtextDXContextConverter" />\n-    <adapter factory=".converters.set_converter" />\n-    <adapter factory=".converters.bytes_converter" />\n-    <adapter factory=".converters.time_converter" />\n-    <adapter factory=".converters.timedelta_converter" />\n-    <adapter factory=".converters.tuple_converter" />\n-    <adapter factory=".converters.zope_DateTime_converter" />\n-\n-    <configure zcml:condition="installed z3c.relationfield">\n-        <adapter factory=".relationfield.RelationChoiceFieldSerializer" />\n-        <adapter factory=".relationfield.RelationListFieldSerializer" />\n-        <adapter factory=".relationfield.relationvalue_converter" />\n-    </configure>\n-\n-    <adapter factory=".catalog.LazyCatalogResultSerializer" />\n-\n-    <adapter factory=".user.SerializeUserToJson" />\n-    <adapter factory=".user.SerializeUserToJsonSummary" />\n-    <adapter factory=".group.SerializeGroupToJson" />\n-    <adapter factory=".group.SerializeGroupToJsonSummary" />\n-\n-    <adapter factory=".local_roles.SerializeLocalRolesToJson"\n-             name="local_roles"\n-             />\n-\n-    <adapter factory=".vocabularies.SerializeVocabularyToJson" />\n-    <adapter factory=".vocabularies.SerializeSourceToJson" />\n-    <adapter factory=".vocabularies.SerializeTermToJson" />\n-\n-    <adapter factory=".registry.SerializeRegistryToJson" />\n-\n-    <adapter factory=".discussion.ConversationSerializer" />\n-    <adapter factory=".discussion.CommentSerializer" />\n-\n-    <configure zcml:condition="installed plone.tiles">\n-        <adapter factory=".tile.TileSummarySerializeToJson" />\n-        <adapter factory=".tile.TileSerializeToJson" />\n+    <adapter factory=".atfields.DefaultFieldSerializer" />\n+    <adapter factory=".atfields.FileFieldSerializer" />\n+    <adapter factory=".atfields.ImageFieldSerializer" />\n+    <adapter factory=".atfields.ReferenceFieldSerializer" />\n+    <adapter factory=".atfields.TextFieldSerializer" />\n+    <configure zcml:condition="installed plone.app.collection">\n+      <adapter factory=".atfields.QueryFieldSerializer" />\n+      <adapter factory=".atcollection.SerializeCollectionToJson" />\n     </configure>\n-\n-    <include package=".controlpanels" />\n+  </configure>\n+\n+  <adapter factory=".converters.date_converter" />\n+  <adapter factory=".converters.decimal_converter" />\n+  <adapter factory=".converters.default_converter" />\n+  <adapter factory=".converters.dict_converter" />\n+  <adapter factory=".converters.frozenset_converter" />\n+  <adapter factory=".converters.i18n_message_converter" />\n+  <adapter factory=".converters.list_converter" />\n+  <adapter factory=".converters.missing_value_converter" />\n+  <adapter factory=".converters.persistent_list_converter" />\n+  <adapter factory=".converters.persistent_mapping_converter" />\n+  <adapter factory=".converters.python_datetime_converter" />\n+  <adapter factory=".converters.RichtextDXContextConverter" />\n+  <adapter factory=".converters.set_converter" />\n+  <adapter factory=".converters.bytes_converter" />\n+  <adapter factory=".converters.time_converter" />\n+  <adapter factory=".converters.timedelta_converter" />\n+  <adapter factory=".converters.tuple_converter" />\n+  <adapter factory=".converters.zope_DateTime_converter" />\n+\n+  <configure zcml:condition="installed z3c.relationfield">\n+    <adapter factory=".relationfield.RelationChoiceFieldSerializer" />\n+    <adapter factory=".relationfield.RelationListFieldSerializer" />\n+    <adapter factory=".relationfield.relationvalue_converter" />\n+  </configure>\n+\n+  <adapter factory=".catalog.LazyCatalogResultSerializer" />\n+\n+  <adapter factory=".user.SerializeUserToJson" />\n+  <adapter factory=".user.SerializeUserToJsonSummary" />\n+  <adapter factory=".group.SerializeGroupToJson" />\n+  <adapter factory=".group.SerializeGroupToJsonSummary" />\n+\n+  <adapter\n+      factory=".local_roles.SerializeLocalRolesToJson"\n+      name="local_roles"\n+      />\n+\n+  <adapter factory=".vocabularies.SerializeVocabularyToJson" />\n+  <adapter factory=".vocabularies.SerializeSourceToJson" />\n+  <adapter factory=".vocabularies.SerializeTermToJson" />\n+\n+  <adapter factory=".registry.SerializeRegistryToJson" />\n+\n+  <adapter factory=".discussion.ConversationSerializer" />\n+  <adapter factory=".discussion.CommentSerializer" />\n+\n+  <configure zcml:condition="installed plone.tiles">\n+    <adapter factory=".tile.TileSummarySerializeToJson" />\n+    <adapter factory=".tile.TileSerializeToJson" />\n+  </configure>\n+\n+  <include package=".controlpanels" />\n \n </configure>\ndiff --git a/src/plone/restapi/serializer/controlpanels/configure.zcml b/src/plone/restapi/serializer/controlpanels/configure.zcml\nindex 5e8c81936..4d3d5dc7a 100644\n--- a/src/plone/restapi/serializer/controlpanels/configure.zcml\n+++ b/src/plone/restapi/serializer/controlpanels/configure.zcml\n@@ -1,9 +1,10 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    i18n_domain="plone.restapi">\n+    i18n_domain="plone.restapi"\n+    >\n \n-    <adapter factory=".ControlpanelSerializeToJson" />\n-    <adapter factory=".ControlpanelSummarySerializeToJson" />\n-    <adapter factory=".types.DexterityTypesControlpanelSerializeToJson" />\n+  <adapter factory=".ControlpanelSerializeToJson" />\n+  <adapter factory=".ControlpanelSummarySerializeToJson" />\n+  <adapter factory=".types.DexterityTypesControlpanelSerializeToJson" />\n \n </configure>\ndiff --git a/src/plone/restapi/services/actions/configure.zcml b/src/plone/restapi/services/actions/configure.zcml\nindex 30787c8f1..b716a1a99 100644\n--- a/src/plone/restapi/services/actions/configure.zcml\n+++ b/src/plone/restapi/services/actions/configure.zcml\n@@ -1,15 +1,19 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n-  <adapter factory=".get.Actions" name="actions"/>\n+  <adapter\n+      factory=".get.Actions"\n+      name="actions"\n+      />\n \n   <plone:service\n-    method="GET"\n-    for="zope.interface.Interface"\n-    factory=".get.ActionsGet"\n-    name="@actions"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".get.ActionsGet"\n+      for="zope.interface.Interface"\n+      permission="zope2.View"\n+      name="@actions"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/addons/configure.zcml b/src/plone/restapi/services/addons/configure.zcml\nindex 99a1c6be2..b8140dc1f 100644\n--- a/src/plone/restapi/services/addons/configure.zcml\n+++ b/src/plone/restapi/services/addons/configure.zcml\n@@ -1,21 +1,22 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n   <plone:service\n-    method="GET"\n-    for="zope.interface.Interface"\n-    factory=".get.AddonsGet"\n-    name="@addons"\n-    permission="cmf.ManagePortal"\n-    />\n+      method="GET"\n+      factory=".get.AddonsGet"\n+      for="zope.interface.Interface"\n+      permission="cmf.ManagePortal"\n+      name="@addons"\n+      />\n \n   <plone:service\n-    method="POST"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".post.AddonsPost"\n-    name="@addons"\n-    permission="cmf.ManagePortal"\n-    />\n+      method="POST"\n+      factory=".post.AddonsPost"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="cmf.ManagePortal"\n+      name="@addons"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/auth/configure.zcml b/src/plone/restapi/services/auth/configure.zcml\nindex ab0440f72..dec5304c5 100644\n--- a/src/plone/restapi/services/auth/configure.zcml\n+++ b/src/plone/restapi/services/auth/configure.zcml\n@@ -1,30 +1,31 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <plone:service\n-    method="POST"\n-    name="@login"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".login.Login"\n-    permission="zope.Public"\n-    />\n+      method="POST"\n+      factory=".login.Login"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="zope.Public"\n+      name="@login"\n+      />\n \n   <plone:service\n-    method="POST"\n-    name="@logout"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".logout.Logout"\n-    permission="zope.Public"\n-    />\n+      method="POST"\n+      factory=".logout.Logout"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="zope.Public"\n+      name="@logout"\n+      />\n \n   <plone:service\n-    method="POST"\n-    name="@login-renew"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".renew.Renew"\n-    permission="zope.Public"\n-    />\n+      method="POST"\n+      factory=".renew.Renew"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="zope.Public"\n+      name="@login-renew"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/breadcrumbs/configure.zcml b/src/plone/restapi/services/breadcrumbs/configure.zcml\nindex 167d7168f..6dde6de78 100644\n--- a/src/plone/restapi/services/breadcrumbs/configure.zcml\n+++ b/src/plone/restapi/services/breadcrumbs/configure.zcml\n@@ -1,15 +1,19 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n-  <adapter factory=".get.Breadcrumbs" name="breadcrumbs"/>\n+  <adapter\n+      factory=".get.Breadcrumbs"\n+      name="breadcrumbs"\n+      />\n \n   <plone:service\n-    method="GET"\n-    for="zope.interface.Interface"\n-    factory=".get.BreadcrumbsGet"\n-    name="@breadcrumbs"\n-    permission="zope2.View"\n-    />\n-    \n+      method="GET"\n+      factory=".get.BreadcrumbsGet"\n+      for="zope.interface.Interface"\n+      permission="zope2.View"\n+      name="@breadcrumbs"\n+      />\n+\n </configure>\ndiff --git a/src/plone/restapi/services/configure.zcml b/src/plone/restapi/services/configure.zcml\nindex 046bef933..b9f4fac9d 100644\n--- a/src/plone/restapi/services/configure.zcml\n+++ b/src/plone/restapi/services/configure.zcml\n@@ -1,44 +1,56 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <!-- Service registrations below need permissions from CMFCore -->\n-  <include package="Products.CMFCore" file="permissions.zcml" />\n+  <include\n+      package="Products.CMFCore"\n+      file="permissions.zcml"\n+      />\n \n   <include package=".auth" />\n   <include package=".actions" />\n   <include package=".addons" />\n-  <include package=".breadcrumbs"/>\n-  <include package=".content"/>\n+  <include package=".breadcrumbs" />\n+  <include package=".content" />\n   <include package=".controlpanels" />\n-  <include package=".copymove"/>\n-  <include package=".database"/>\n-  <include package=".discussion"/>\n-  <include package=".groups"/>\n-  <include package=".navigation"/>\n-  <include package=".contextnavigation"/>\n-  <include package=".history"/>\n+  <include package=".copymove" />\n+  <include package=".database" />\n+  <include package=".discussion" />\n+  <include package=".groups" />\n+  <include package=".navigation" />\n+  <include package=".contextnavigation" />\n+  <include package=".history" />\n   <include package=".locking" />\n-  <include package=".principals"/>\n-  <include package=".querysources"/>\n-  <include package=".querystring"/>\n-  <include package=".querystringsearch"/>\n-  <include package=".registry"/>\n-  <include package=".roles"/>\n-  <include package=".search"/>\n-  <include package=".system"/>\n-  <include package=".sources"/>\n-  <include package=".types"/>\n-  <include package=".users"/>\n-  <include package=".vocabularies"/>\n-  <include package=".workflow"/>\n-  <include package=".multilingual"\n-      zcml:condition="have plone-5"/>\n-  <include package=".email_notification"\n-      zcml:condition="have plone-5"/>\n-  <include package=".email_send"\n-      zcml:condition="have plone-5"/>\n-  <include package=".tiles"\n-      zcml:condition="installed plone.tiles" />\n+  <include package=".principals" />\n+  <include package=".querysources" />\n+  <include package=".querystring" />\n+  <include package=".querystringsearch" />\n+  <include package=".registry" />\n+  <include package=".roles" />\n+  <include package=".search" />\n+  <include package=".system" />\n+  <include package=".sources" />\n+  <include package=".types" />\n+  <include package=".users" />\n+  <include package=".vocabularies" />\n+  <include package=".workflow" />\n+  <include\n+      package=".multilingual"\n+      zcml:condition="have plone-5"\n+      />\n+  <include\n+      package=".email_notification"\n+      zcml:condition="have plone-5"\n+      />\n+  <include\n+      package=".email_send"\n+      zcml:condition="have plone-5"\n+      />\n+  <include\n+      package=".tiles"\n+      zcml:condition="installed plone.tiles"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/content/configure.zcml b/src/plone/restapi/services/content/configure.zcml\nindex f3cbde147..c18e6a0fb 100644\n--- a/src/plone/restapi/services/content/configure.zcml\n+++ b/src/plone/restapi/services/content/configure.zcml\n@@ -1,136 +1,137 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <plone:service\n-    method="GET"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".get.ContentGet"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".get.ContentGet"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="zope2.View"\n+      />\n \n   <plone:service\n-    method="GET"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".get.ContentGet"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".get.ContentGet"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="zope2.View"\n+      />\n \n   <plone:service\n-    method="PATCH"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".update.ContentPatch"\n-    permission="cmf.ModifyPortalContent"\n-    />\n+      method="PATCH"\n+      factory=".update.ContentPatch"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n   <plone:service\n-    method="PATCH"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".update.ContentPatch"\n-    permission="cmf.ModifyPortalContent"\n-    />\n+      method="PATCH"\n+      factory=".update.ContentPatch"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="cmf.ModifyPortalContent"\n+      />\n \n   <plone:service\n-    method="POST"\n-    for="Products.CMFCore.interfaces.IFolderish"\n-    factory=".add.FolderPost"\n-    permission="cmf.AddPortalContent"\n-    />\n+      method="POST"\n+      factory=".add.FolderPost"\n+      for="Products.CMFCore.interfaces.IFolderish"\n+      permission="cmf.AddPortalContent"\n+      />\n \n   <plone:service\n-    method="DELETE"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".delete.ContentDelete"\n-    permission="zope2.DeleteObjects"\n-    />\n+      method="DELETE"\n+      factory=".delete.ContentDelete"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="zope2.DeleteObjects"\n+      />\n \n   <plone:service\n-    method="GET"\n-    name="@sharing"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".sharing.SharingGet"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".sharing.SharingGet"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="zope2.View"\n+      name="@sharing"\n+      />\n \n   <plone:service\n-    method="GET"\n-    name="@sharing"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".sharing.SharingGet"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".sharing.SharingGet"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="zope2.View"\n+      name="@sharing"\n+      />\n \n   <plone:service\n-    method="POST"\n-    name="@sharing"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".sharing.SharingPost"\n-    permission="zope2.View"\n-    />\n+      method="POST"\n+      factory=".sharing.SharingPost"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="zope2.View"\n+      name="@sharing"\n+      />\n \n   <plone:service\n-    method="POST"\n-    name="@sharing"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".sharing.SharingPost"\n-    permission="zope2.View"\n-    />\n+      method="POST"\n+      factory=".sharing.SharingPost"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="zope2.View"\n+      name="@sharing"\n+      />\n \n   <plone:service\n-    method="OPTIONS"\n-    name="@tus-upload"\n-    for="Products.CMFCore.interfaces.IFolderish"\n-    factory=".tus.UploadOptions"\n-    permission="cmf.AddPortalContent"\n-    />\n+      method="OPTIONS"\n+      factory=".tus.UploadOptions"\n+      for="Products.CMFCore.interfaces.IFolderish"\n+      permission="cmf.AddPortalContent"\n+      name="@tus-upload"\n+      />\n \n   <plone:service\n-    method="POST"\n-    name="@tus-upload"\n-    for="Products.CMFCore.interfaces.IFolderish"\n-    factory=".tus.UploadPost"\n-    permission="cmf.AddPortalContent"\n-    />\n+      method="POST"\n+      factory=".tus.UploadPost"\n+      for="Products.CMFCore.interfaces.IFolderish"\n+      permission="cmf.AddPortalContent"\n+      name="@tus-upload"\n+      />\n \n   <plone:service\n-    method="POST"\n-    name="@tus-replace"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".tus.UploadPost"\n-    permission="cmf.ModifyPortalContent"\n-    />\n+      method="POST"\n+      factory=".tus.UploadPost"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="cmf.ModifyPortalContent"\n+      name="@tus-replace"\n+      />\n \n   <plone:service\n-    method="HEAD"\n-    name="@tus-upload"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".tus.UploadHead"\n-    permission="zope2.View"\n-    />\n+      method="HEAD"\n+      factory=".tus.UploadHead"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="zope2.View"\n+      name="@tus-upload"\n+      />\n \n   <plone:service\n-    method="HEAD"\n-    name="@tus-upload"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".tus.UploadHead"\n-    permission="cmf.AddPortalContent"\n-    />\n+      method="HEAD"\n+      factory=".tus.UploadHead"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="cmf.AddPortalContent"\n+      name="@tus-upload"\n+      />\n \n   <plone:service\n-    method="PATCH"\n-    name="@tus-upload"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".tus.UploadPatch"\n-    permission="zope2.View"\n-    />\n+      method="PATCH"\n+      factory=".tus.UploadPatch"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="zope2.View"\n+      name="@tus-upload"\n+      />\n \n   <plone:service\n-    method="PATCH"\n-    name="@tus-upload"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".tus.UploadPatch"\n-    permission="cmf.AddPortalContent"\n-    />\n+      method="PATCH"\n+      factory=".tus.UploadPatch"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="cmf.AddPortalContent"\n+      name="@tus-upload"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/contextnavigation/configure.zcml b/src/plone/restapi/services/contextnavigation/configure.zcml\nindex a96724229..b03b08579 100644\n--- a/src/plone/restapi/services/contextnavigation/configure.zcml\n+++ b/src/plone/restapi/services/contextnavigation/configure.zcml\n@@ -1,16 +1,19 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n-<adapter factory=".get.ContextNavigation" name="contextnavigation"/>\n+  <adapter\n+      factory=".get.ContextNavigation"\n+      name="contextnavigation"\n+      />\n \n   <plone:service\n-    method="GET"\n-    for="zope.interface.Interface"\n-    factory=".get.ContextNavigationGet"\n-    name="@contextnavigation"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".get.ContextNavigationGet"\n+      for="zope.interface.Interface"\n+      permission="zope2.View"\n+      name="@contextnavigation"\n+      />\n \n </configure>\n-\ndiff --git a/src/plone/restapi/services/controlpanels/configure.zcml b/src/plone/restapi/services/controlpanels/configure.zcml\nindex db3cf356c..fa746bcd8 100644\n--- a/src/plone/restapi/services/controlpanels/configure.zcml\n+++ b/src/plone/restapi/services/controlpanels/configure.zcml\n@@ -1,105 +1,120 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <include\n-    zcml:condition="not-installed plone.app.controlpanel"\n-    package="Products.CMFPlone.controlpanel"\n-    file="permissions.zcml" />\n+      package="Products.CMFPlone.controlpanel"\n+      file="permissions.zcml"\n+      zcml:condition="not-installed plone.app.controlpanel"\n+      />\n \n   <include\n-    zcml:condition="installed plone.app.controlpanel"\n-    package="plone.app.controlpanel"\n-    file="permissions.zcml" />\n+      package="plone.app.controlpanel"\n+      file="permissions.zcml"\n+      zcml:condition="installed plone.app.controlpanel"\n+      />\n \n   <plone:service\n-    method="POST"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".add.ControlpanelsAdd"\n-    name="@controlpanels"\n-    permission="plone.app.controlpanel.Overview"\n-    />\n+      method="POST"\n+      factory=".add.ControlpanelsAdd"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="plone.app.controlpanel.Overview"\n+      name="@controlpanels"\n+      />\n \n   <plone:service\n-    method="GET"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".get.ControlpanelsGet"\n-    name="@controlpanels"\n-    permission="plone.app.controlpanel.Overview"\n-    />\n+      method="GET"\n+      factory=".get.ControlpanelsGet"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="plone.app.controlpanel.Overview"\n+      name="@controlpanels"\n+      />\n \n   <plone:service\n-    method="PATCH"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".update.ControlpanelsUpdate"\n-    name="@controlpanels"\n-    permission="plone.app.controlpanel.Overview"\n-    />\n+      method="PATCH"\n+      factory=".update.ControlpanelsUpdate"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="plone.app.controlpanel.Overview"\n+      name="@controlpanels"\n+      />\n \n   <plone:service\n-    method="DELETE"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".delete.ControlpanelsDelete"\n-    name="@controlpanels"\n-    permission="plone.app.controlpanel.Overview"\n-    />\n+      method="DELETE"\n+      factory=".delete.ControlpanelsDelete"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="plone.app.controlpanel.Overview"\n+      name="@controlpanels"\n+      />\n \n   <!-- Dexterity Types Controlpanel -->\n   <adapter\n-    factory="plone.restapi.controlpanels.types.DexterityTypesControlpanel"\n-    provides="plone.restapi.controlpanels.interfaces.IDexterityTypesControlpanel"\n-    name="dexterity-types" />\n+      factory="plone.restapi.controlpanels.types.DexterityTypesControlpanel"\n+      provides="plone.restapi.controlpanels.interfaces.IDexterityTypesControlpanel"\n+      name="dexterity-types"\n+      />\n \n   <configure zcml:condition="have plone-5">\n \n     <!-- General -->\n     <adapter\n-      factory="plone.restapi.controlpanels.registry.DateTimeControlpanel"\n-      name="date-and-time" />\n+        factory="plone.restapi.controlpanels.registry.DateTimeControlpanel"\n+        name="date-and-time"\n+        />\n \n     <adapter\n-      factory="plone.restapi.controlpanels.registry.LanguageControlpanel"\n-      name="language" />\n+        factory="plone.restapi.controlpanels.registry.LanguageControlpanel"\n+        name="language"\n+        />\n \n     <adapter\n-      factory="plone.restapi.controlpanels.registry.MailControlpanel"\n-      name="mail" />\n+        factory="plone.restapi.controlpanels.registry.MailControlpanel"\n+        name="mail"\n+        />\n \n     <adapter\n-      factory="plone.restapi.controlpanels.registry.NavigationControlpanel"\n-      name="navigation" />\n+        factory="plone.restapi.controlpanels.registry.NavigationControlpanel"\n+        name="navigation"\n+        />\n \n     <adapter\n-      factory="plone.restapi.controlpanels.registry.SiteControlpanel"\n-      name="site" />\n+        factory="plone.restapi.controlpanels.registry.SiteControlpanel"\n+        name="site"\n+        />\n \n     <adapter\n-      factory="plone.restapi.controlpanels.registry.SearchControlpanel"\n-      name="search" />\n+        factory="plone.restapi.controlpanels.registry.SearchControlpanel"\n+        name="search"\n+        />\n \n     <adapter\n-      factory="plone.restapi.controlpanels.registry.SocialMediaControlpanel"\n-      name="socialmedia" />\n+        factory="plone.restapi.controlpanels.registry.SocialMediaControlpanel"\n+        name="socialmedia"\n+        />\n \n \n     <!-- Content -->\n     <adapter\n-      factory="plone.restapi.controlpanels.registry.EditingControlpanel"\n-      name="editing" />\n+        factory="plone.restapi.controlpanels.registry.EditingControlpanel"\n+        name="editing"\n+        />\n \n     <adapter\n-      factory="plone.restapi.controlpanels.registry.ImagingControlpanel"\n-      name="imaging" />\n+        factory="plone.restapi.controlpanels.registry.ImagingControlpanel"\n+        name="imaging"\n+        />\n \n     <adapter\n-      factory="plone.restapi.controlpanels.registry.MarkupControlpanel"\n-      name="markup" />\n+        factory="plone.restapi.controlpanels.registry.MarkupControlpanel"\n+        name="markup"\n+        />\n \n     <!-- Security -->\n     <adapter\n-      factory="plone.restapi.controlpanels.registry.SecurityControlpanel"\n-      name="security" />\n+        factory="plone.restapi.controlpanels.registry.SecurityControlpanel"\n+        name="security"\n+        />\n \n   </configure>\n \ndiff --git a/src/plone/restapi/services/copymove/configure.zcml b/src/plone/restapi/services/copymove/configure.zcml\nindex 423bb04ef..0be606aca 100644\n--- a/src/plone/restapi/services/copymove/configure.zcml\n+++ b/src/plone/restapi/services/copymove/configure.zcml\n@@ -1,22 +1,23 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <plone:service\n-    method="POST"\n-    name="@copy"\n-    for="Products.CMFCore.interfaces.IFolderish"\n-    factory=".copymove.Copy"\n-    permission="zope2.View"\n-    />\n+      method="POST"\n+      factory=".copymove.Copy"\n+      for="Products.CMFCore.interfaces.IFolderish"\n+      permission="zope2.View"\n+      name="@copy"\n+      />\n \n   <plone:service\n-    method="POST"\n-    name="@move"\n-    for="Products.CMFCore.interfaces.IFolderish"\n-    factory=".copymove.Move"\n-    permission="zope2.View"\n-    />\n+      method="POST"\n+      factory=".copymove.Move"\n+      for="Products.CMFCore.interfaces.IFolderish"\n+      permission="zope2.View"\n+      name="@move"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/database/configure.zcml b/src/plone/restapi/services/database/configure.zcml\nindex 26ecf5619..a4477cc3b 100644\n--- a/src/plone/restapi/services/database/configure.zcml\n+++ b/src/plone/restapi/services/database/configure.zcml\n@@ -1,24 +1,27 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <include\n-    zcml:condition="not-installed plone.app.controlpanel"\n-    package="Products.CMFPlone.controlpanel"\n-    file="permissions.zcml" />\n+      package="Products.CMFPlone.controlpanel"\n+      file="permissions.zcml"\n+      zcml:condition="not-installed plone.app.controlpanel"\n+      />\n \n   <include\n-    zcml:condition="installed plone.app.controlpanel"\n-    package="plone.app.controlpanel"\n-    file="permissions.zcml" />\n+      package="plone.app.controlpanel"\n+      file="permissions.zcml"\n+      zcml:condition="installed plone.app.controlpanel"\n+      />\n \n   <plone:service\n-    method="GET"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".get.DatabaseGet"\n-    name="@database"\n-    permission="plone.app.controlpanel.Overview"\n-    />\n+      method="GET"\n+      factory=".get.DatabaseGet"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="plone.app.controlpanel.Overview"\n+      name="@database"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/discussion/configure.zcml b/src/plone/restapi/services/discussion/configure.zcml\nindex 2b7ab5247..9b2b446a6 100644\n--- a/src/plone/restapi/services/discussion/configure.zcml\n+++ b/src/plone/restapi/services/discussion/configure.zcml\n@@ -1,40 +1,44 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n-  <include package="plone.app.discussion" file="permissions.zcml" />\n+  <include\n+      package="plone.app.discussion"\n+      file="permissions.zcml"\n+      />\n \n   <plone:service\n-    method="GET"\n-    name="@comments"\n-    for="*"\n-    factory=".conversation.CommentsGet"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".conversation.CommentsGet"\n+      for="*"\n+      permission="zope2.View"\n+      name="@comments"\n+      />\n \n   <plone:service\n-    method="POST"\n-    name="@comments"\n-    for="*"\n-    factory=".conversation.CommentsAdd"\n-    permission="zope2.View"\n-    />\n+      method="POST"\n+      factory=".conversation.CommentsAdd"\n+      for="*"\n+      permission="zope2.View"\n+      name="@comments"\n+      />\n \n   <plone:service\n-    method="PATCH"\n-    name="@comments"\n-    for="*"\n-    factory=".conversation.CommentsUpdate"\n-    permission="zope2.View"\n-    />\n+      method="PATCH"\n+      factory=".conversation.CommentsUpdate"\n+      for="*"\n+      permission="zope2.View"\n+      name="@comments"\n+      />\n \n   <plone:service\n-    method="DELETE"\n-    name="@comments"\n-    for="*"\n-    factory=".conversation.CommentsDelete"\n-    permission="zope2.View"\n-    />\n+      method="DELETE"\n+      factory=".conversation.CommentsDelete"\n+      for="*"\n+      permission="zope2.View"\n+      name="@comments"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/email_notification/configure.zcml b/src/plone/restapi/services/email_notification/configure.zcml\nindex 23a81ffec..bd4f072db 100644\n--- a/src/plone/restapi/services/email_notification/configure.zcml\n+++ b/src/plone/restapi/services/email_notification/configure.zcml\n@@ -1,14 +1,15 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n-    <plone:service\n+  <plone:service\n       method="POST"\n-      name="@email-notification"\n-      for="Products.CMFCore.interfaces.ISiteRoot"\n       factory=".post.EmailNotificationPost"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n       permission="zope2.View"\n-    />\n+      name="@email-notification"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/email_send/configure.zcml b/src/plone/restapi/services/email_send/configure.zcml\nindex c5cd11efa..2dab024db 100644\n--- a/src/plone/restapi/services/email_send/configure.zcml\n+++ b/src/plone/restapi/services/email_send/configure.zcml\n@@ -1,14 +1,15 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n-    <plone:service\n+  <plone:service\n       method="POST"\n-      name="@email-send"\n-      for="Products.CMFCore.interfaces.ISiteRoot"\n       factory=".post.EmailSendPost"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n       permission="zope2.View"\n-    />\n+      name="@email-send"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/groups/configure.zcml b/src/plone/restapi/services/groups/configure.zcml\nindex d0e8dd0ba..491f2f9a4 100644\n--- a/src/plone/restapi/services/groups/configure.zcml\n+++ b/src/plone/restapi/services/groups/configure.zcml\n@@ -1,38 +1,39 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <plone:service\n-    method="GET"\n-    name="@groups"\n-    for="Products.CMFCore.interfaces.ISiteRoot"\n-    factory=".get.GroupsGet"\n-    permission="cmf.ManagePortal"\n-    />\n+      method="GET"\n+      factory=".get.GroupsGet"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      permission="cmf.ManagePortal"\n+      name="@groups"\n+      />\n \n   <plone:service\n-    method="PATCH"\n-    name="@groups"\n-    for="Products.CMFCore.interfaces.ISiteRoot"\n-    factory=".update.GroupsPatch"\n-    permission="cmf.ManagePortal"\n-    />\n+      method="PATCH"\n+      factory=".update.GroupsPatch"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      permission="cmf.ManagePortal"\n+      name="@groups"\n+      />\n \n   <plone:service\n-    method="POST"\n-    name="@groups"\n-    for="Products.CMFCore.interfaces.ISiteRoot"\n-    factory=".add.GroupsPost"\n-    permission="cmf.ManagePortal"\n-    />\n+      method="POST"\n+      factory=".add.GroupsPost"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      permission="cmf.ManagePortal"\n+      name="@groups"\n+      />\n \n   <plone:service\n-    method="DELETE"\n-    name="@groups"\n-    for="Products.CMFCore.interfaces.ISiteRoot"\n-    factory=".delete.GroupsDelete"\n-    permission="cmf.ManagePortal"\n-    />\n+      method="DELETE"\n+      factory=".delete.GroupsDelete"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      permission="cmf.ManagePortal"\n+      name="@groups"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/history/configure.zcml b/src/plone/restapi/services/history/configure.zcml\nindex 7230e6a99..1bea2f2d5 100644\n--- a/src/plone/restapi/services/history/configure.zcml\n+++ b/src/plone/restapi/services/history/configure.zcml\n@@ -1,24 +1,25 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n-    \n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n+\n   <include package="Products.CMFEditions" />\n \n   <plone:service\n-    method="GET"\n-    name="@history"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".get.HistoryGet"\n-    permission="CMFEditions.AccessPreviousVersions"\n-    />\n+      method="GET"\n+      factory=".get.HistoryGet"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="CMFEditions.AccessPreviousVersions"\n+      name="@history"\n+      />\n \n   <plone:service\n-    method="PATCH"\n-    name="@history"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".patch.HistoryPatch"\n-    permission="CMFEditions.RevertToPreviousVersions"\n-    />\n+      method="PATCH"\n+      factory=".patch.HistoryPatch"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="CMFEditions.RevertToPreviousVersions"\n+      name="@history"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/multilingual/configure.zcml b/src/plone/restapi/services/multilingual/configure.zcml\nindex c1af65957..b304117f6 100644\n--- a/src/plone/restapi/services/multilingual/configure.zcml\n+++ b/src/plone/restapi/services/multilingual/configure.zcml\n@@ -1,42 +1,49 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n-    <include package="plone.app.multilingual" file="permissions.zcml"/>\n+  <include\n+      package="plone.app.multilingual"\n+      file="permissions.zcml"\n+      />\n \n-    <adapter factory=".pam.Translations" name="translations"/>\n+  <adapter\n+      factory=".pam.Translations"\n+      name="translations"\n+      />\n \n-    <plone:service\n+  <plone:service\n       method="GET"\n-      name="@translations"\n-      for="Products.CMFCore.interfaces.IContentish"\n       factory=".pam.TranslationInfo"\n+      for="Products.CMFCore.interfaces.IContentish"\n       permission="zope2.View"\n+      name="@translations"\n       />\n \n-    <plone:service\n+  <plone:service\n       method="POST"\n-      name="@translations"\n-      for="Products.CMFCore.interfaces.IContentish"\n       factory=".pam.LinkTranslations"\n+      for="Products.CMFCore.interfaces.IContentish"\n       permission="plone.app.multilingual.ManageTranslations"\n-    />\n+      name="@translations"\n+      />\n \n-    <plone:service\n+  <plone:service\n       method="DELETE"\n-      name="@translations"\n-      for="Products.CMFCore.interfaces.IContentish"\n       factory=".pam.UnlinkTranslations"\n+      for="Products.CMFCore.interfaces.IContentish"\n       permission="plone.app.multilingual.ManageTranslations"\n-    />\n+      name="@translations"\n+      />\n \n   <plone:service\n-    method="GET"\n-    name="@translation-locator"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".locator.TranslationLocator"\n-    permission="plone.app.multilingual.ManageTranslations"\n-  />\n+      method="GET"\n+      factory=".locator.TranslationLocator"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="plone.app.multilingual.ManageTranslations"\n+      name="@translation-locator"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/navigation/configure.zcml b/src/plone/restapi/services/navigation/configure.zcml\nindex 090900cd8..f1de8f2d6 100644\n--- a/src/plone/restapi/services/navigation/configure.zcml\n+++ b/src/plone/restapi/services/navigation/configure.zcml\n@@ -1,15 +1,19 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n-  <adapter factory=".get.Navigation" name="navigation"/>\n+  <adapter\n+      factory=".get.Navigation"\n+      name="navigation"\n+      />\n \n   <plone:service\n-    method="GET"\n-    for="zope.interface.Interface"\n-    factory=".get.NavigationGet"\n-    name="@navigation"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".get.NavigationGet"\n+      for="zope.interface.Interface"\n+      permission="zope2.View"\n+      name="@navigation"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/principals/configure.zcml b/src/plone/restapi/services/principals/configure.zcml\nindex 4cbb75ea0..d45f188bb 100644\n--- a/src/plone/restapi/services/principals/configure.zcml\n+++ b/src/plone/restapi/services/principals/configure.zcml\n@@ -1,14 +1,15 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <plone:service\n-    method="GET"\n-    name="@principals"\n-    for="Products.CMFCore.interfaces.ISiteRoot"\n-    factory=".get.PrincipalsGet"\n-    permission="cmf.ManagePortal"\n-    />\n+      method="GET"\n+      factory=".get.PrincipalsGet"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      permission="cmf.ManagePortal"\n+      name="@principals"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/querysources/configure.zcml b/src/plone/restapi/services/querysources/configure.zcml\nindex 3cea0d0bd..e44dfab15 100644\n--- a/src/plone/restapi/services/querysources/configure.zcml\n+++ b/src/plone/restapi/services/querysources/configure.zcml\n@@ -1,23 +1,24 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n   <plone:service\n-    method="GET"\n-    accept="application/json"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".get.QuerySourcesGet"\n-    name="@querysources"\n-    permission="plone.restapi.vocabularies"\n-    />\n+      method="GET"\n+      accept="application/json"\n+      factory=".get.QuerySourcesGet"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="plone.restapi.vocabularies"\n+      name="@querysources"\n+      />\n \n   <plone:service\n-    method="GET"\n-    accept="application/json"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".get.QuerySourcesGet"\n-    name="@querysources"\n-    permission="plone.restapi.vocabularies"\n-    />\n+      method="GET"\n+      accept="application/json"\n+      factory=".get.QuerySourcesGet"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="plone.restapi.vocabularies"\n+      name="@querysources"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/querystring/configure.zcml b/src/plone/restapi/services/querystring/configure.zcml\nindex 3e250414d..7088090b0 100644\n--- a/src/plone/restapi/services/querystring/configure.zcml\n+++ b/src/plone/restapi/services/querystring/configure.zcml\n@@ -1,13 +1,14 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n   <plone:service\n-    method="GET"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".get.QuerystringGet"\n-    name="@querystring"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".get.QuerystringGet"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="zope2.View"\n+      name="@querystring"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/querystringsearch/configure.zcml b/src/plone/restapi/services/querystringsearch/configure.zcml\nindex 4abeedb3b..9a7ad2059 100644\n--- a/src/plone/restapi/services/querystringsearch/configure.zcml\n+++ b/src/plone/restapi/services/querystringsearch/configure.zcml\n@@ -1,20 +1,21 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n   <plone:service\n-    method="POST"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".get.QuerystringSearchPost"\n-    name="@querystring-search"\n-    permission="zope2.View"\n-    />\n+      method="POST"\n+      factory=".get.QuerystringSearchPost"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="zope2.View"\n+      name="@querystring-search"\n+      />\n \n   <plone:service\n-    method="POST"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".get.QuerystringSearchPost"\n-    name="@querystring-search"\n-    permission="zope2.View"\n-    />\n+      method="POST"\n+      factory=".get.QuerystringSearchPost"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="zope2.View"\n+      name="@querystring-search"\n+      />\n </configure>\ndiff --git a/src/plone/restapi/services/registry/configure.zcml b/src/plone/restapi/services/registry/configure.zcml\nindex 9495efe68..115325272 100644\n--- a/src/plone/restapi/services/registry/configure.zcml\n+++ b/src/plone/restapi/services/registry/configure.zcml\n@@ -1,21 +1,22 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n   <plone:service\n-    method="GET"\n-    for="Products.CMFCore.interfaces.ISiteRoot"\n-    factory=".get.RegistryGet"\n-    name="@registry"\n-    permission="cmf.ManagePortal"\n-    />\n+      method="GET"\n+      factory=".get.RegistryGet"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      permission="cmf.ManagePortal"\n+      name="@registry"\n+      />\n \n   <plone:service\n-    method="PATCH"\n-    for="Products.CMFCore.interfaces.ISiteRoot"\n-    factory=".update.RegistryUpdate"\n-    name="@registry"\n-    permission="cmf.ManagePortal"\n-    />\n+      method="PATCH"\n+      factory=".update.RegistryUpdate"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      permission="cmf.ManagePortal"\n+      name="@registry"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/roles/configure.zcml b/src/plone/restapi/services/roles/configure.zcml\nindex caf01b178..cec643c32 100644\n--- a/src/plone/restapi/services/roles/configure.zcml\n+++ b/src/plone/restapi/services/roles/configure.zcml\n@@ -1,13 +1,14 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n   <plone:service\n-    method="GET"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".get.RolesGet"\n-    name="@roles"\n-    permission="cmf.ManagePortal"\n-    />\n+      method="GET"\n+      factory=".get.RolesGet"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="cmf.ManagePortal"\n+      name="@roles"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/search/configure.zcml b/src/plone/restapi/services/search/configure.zcml\nindex 2c2cab710..e436c00a2 100644\n--- a/src/plone/restapi/services/search/configure.zcml\n+++ b/src/plone/restapi/services/search/configure.zcml\n@@ -1,13 +1,14 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n   <plone:service\n-    method="GET"\n-    for="zope.interface.Interface"\n-    factory=".get.SearchGet"\n-    name="@search"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".get.SearchGet"\n+      for="zope.interface.Interface"\n+      permission="zope2.View"\n+      name="@search"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/sources/configure.zcml b/src/plone/restapi/services/sources/configure.zcml\nindex 429dbfd95..13fc66a16 100644\n--- a/src/plone/restapi/services/sources/configure.zcml\n+++ b/src/plone/restapi/services/sources/configure.zcml\n@@ -1,14 +1,15 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n   <plone:service\n-    method="GET"\n-    accept="application/json"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".get.SourcesGet"\n-    name="@sources"\n-    permission="plone.restapi.vocabularies"\n-    />\n+      method="GET"\n+      accept="application/json"\n+      factory=".get.SourcesGet"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="plone.restapi.vocabularies"\n+      name="@sources"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/system/configure.zcml b/src/plone/restapi/services/system/configure.zcml\nindex a72e24f50..bbf190001 100644\n--- a/src/plone/restapi/services/system/configure.zcml\n+++ b/src/plone/restapi/services/system/configure.zcml\n@@ -1,13 +1,14 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n   <plone:service\n-    method="GET"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".get.SystemGet"\n-    name="@system"\n-    permission="plone.app.controlpanel.Overview"\n-    />\n+      method="GET"\n+      factory=".get.SystemGet"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="plone.app.controlpanel.Overview"\n+      name="@system"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/tiles/configure.zcml b/src/plone/restapi/services/tiles/configure.zcml\nindex 2750955f0..d65165e83 100644\n--- a/src/plone/restapi/services/tiles/configure.zcml\n+++ b/src/plone/restapi/services/tiles/configure.zcml\n@@ -1,13 +1,14 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n   <plone:service\n-    method="GET"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".get.TilesGet"\n-    name="@tiles"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".get.TilesGet"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="zope2.View"\n+      name="@tiles"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/types/configure.zcml b/src/plone/restapi/services/types/configure.zcml\nindex e3cb7301b..9255ac76f 100644\n--- a/src/plone/restapi/services/types/configure.zcml\n+++ b/src/plone/restapi/services/types/configure.zcml\n@@ -1,49 +1,53 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n   <plone:service\n-    method="GET"\n-    accept="application/json,application/schema+json"\n-    for="*"\n-    factory=".get.TypesGet"\n-    name="@types"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      accept="application/json,application/schema+json"\n+      factory=".get.TypesGet"\n+      for="*"\n+      permission="zope2.View"\n+      name="@types"\n+      />\n \n   <plone:service\n-    method="PATCH"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".update.TypesUpdate"\n-    name="@types"\n-    permission="plone.app.controlpanel.Overview"\n-    />\n+      method="PATCH"\n+      factory=".update.TypesUpdate"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="plone.app.controlpanel.Overview"\n+      name="@types"\n+      />\n \n   <plone:service\n-    method="POST"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".add.TypesPost"\n-    name="@types"\n-    permission="plone.app.controlpanel.Overview"\n-    />\n+      method="POST"\n+      factory=".add.TypesPost"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="plone.app.controlpanel.Overview"\n+      name="@types"\n+      />\n \n   <plone:service\n-    method="DELETE"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".delete.TypesDelete"\n-    name="@types"\n-    permission="plone.app.controlpanel.Overview"\n-    />\n+      method="DELETE"\n+      factory=".delete.TypesDelete"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="plone.app.controlpanel.Overview"\n+      name="@types"\n+      />\n \n   <plone:service\n-    method="PUT"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".put.TypesPut"\n-    name="@types"\n-    permission="plone.app.controlpanel.Overview"\n-    />\n-\n-\n-  <adapter factory=".get.TypesInfo" name="types"/>\n+      method="PUT"\n+      factory=".put.TypesPut"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="plone.app.controlpanel.Overview"\n+      name="@types"\n+      />\n+\n+\n+  <adapter\n+      factory=".get.TypesInfo"\n+      name="types"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/users/configure.zcml b/src/plone/restapi/services/users/configure.zcml\nindex ad07d1a5c..e215828a5 100644\n--- a/src/plone/restapi/services/users/configure.zcml\n+++ b/src/plone/restapi/services/users/configure.zcml\n@@ -1,38 +1,39 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <plone:service\n-    method="GET"\n-    name="@users"\n-    for="Products.CMFCore.interfaces.ISiteRoot"\n-    factory=".get.UsersGet"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".get.UsersGet"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      permission="zope2.View"\n+      name="@users"\n+      />\n \n   <plone:service\n-    method="PATCH"\n-    name="@users"\n-    for="Products.CMFCore.interfaces.ISiteRoot"\n-    factory=".update.UsersPatch"\n-    permission="zope2.View"\n-    />\n+      method="PATCH"\n+      factory=".update.UsersPatch"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      permission="zope2.View"\n+      name="@users"\n+      />\n \n   <plone:service\n-    method="POST"\n-    name="@users"\n-    for="Products.CMFCore.interfaces.ISiteRoot"\n-    factory=".add.UsersPost"\n-    permission="zope2.View"\n-    />\n+      method="POST"\n+      factory=".add.UsersPost"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      permission="zope2.View"\n+      name="@users"\n+      />\n \n   <plone:service\n-    method="DELETE"\n-    name="@users"\n-    for="Products.CMFCore.interfaces.ISiteRoot"\n-    factory=".delete.UsersDelete"\n-    permission="cmf.ManagePortal"\n-    />\n+      method="DELETE"\n+      factory=".delete.UsersDelete"\n+      for="Products.CMFCore.interfaces.ISiteRoot"\n+      permission="cmf.ManagePortal"\n+      name="@users"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/vocabularies/configure.zcml b/src/plone/restapi/services/vocabularies/configure.zcml\nindex a25d8daa4..14956d953 100644\n--- a/src/plone/restapi/services/vocabularies/configure.zcml\n+++ b/src/plone/restapi/services/vocabularies/configure.zcml\n@@ -1,23 +1,24 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n-    xmlns:plone="http://namespaces.plone.org/plone">\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    >\n \n   <plone:service\n-    method="GET"\n-    accept="application/json"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".get.VocabulariesGet"\n-    name="@vocabularies"\n-    permission="plone.restapi.vocabularies"\n-    />\n+      method="GET"\n+      accept="application/json"\n+      factory=".get.VocabulariesGet"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="plone.restapi.vocabularies"\n+      name="@vocabularies"\n+      />\n \n   <plone:service\n-    method="GET"\n-    accept="application/json"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".get.VocabulariesGet"\n-    name="@vocabularies"\n-    permission="plone.restapi.vocabularies"\n-    />\n+      method="GET"\n+      accept="application/json"\n+      factory=".get.VocabulariesGet"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="plone.restapi.vocabularies"\n+      name="@vocabularies"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/workflow/configure.zcml b/src/plone/restapi/services/workflow/configure.zcml\nindex 6f77abefe..29cb0163b 100644\n--- a/src/plone/restapi/services/workflow/configure.zcml\n+++ b/src/plone/restapi/services/workflow/configure.zcml\n@@ -1,32 +1,36 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:plone="http://namespaces.plone.org/plone"\n-    xmlns:zcml="http://namespaces.zope.org/zcml">\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    >\n \n   <plone:service\n-    method="GET"\n-    name="@workflow"\n-    for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-    factory=".info.WorkflowInfoService"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".info.WorkflowInfoService"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      permission="zope2.View"\n+      name="@workflow"\n+      />\n \n   <plone:service\n-    method="GET"\n-    name="@workflow"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".info.WorkflowInfoService"\n-    permission="zope2.View"\n-    />\n+      method="GET"\n+      factory=".info.WorkflowInfoService"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="zope2.View"\n+      name="@workflow"\n+      />\n \n   <plone:service\n-    method="POST"\n-    name="@workflow"\n-    for="Products.CMFCore.interfaces.IContentish"\n-    factory=".transition.WorkflowTransition"\n-    permission="zope2.View"\n-    />\n+      method="POST"\n+      factory=".transition.WorkflowTransition"\n+      for="Products.CMFCore.interfaces.IContentish"\n+      permission="zope2.View"\n+      name="@workflow"\n+      />\n \n-  <adapter factory=".info.WorkflowInfo" name="workflow"/>\n+  <adapter\n+      factory=".info.WorkflowInfo"\n+      name="workflow"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/testing.zcml b/src/plone/restapi/testing.zcml\nindex a453ed219..ca719afcd 100644\n--- a/src/plone/restapi/testing.zcml\n+++ b/src/plone/restapi/testing.zcml\n@@ -1,29 +1,34 @@\n <configure\n-  xmlns="http://namespaces.zope.org/zope"\n-  xmlns:browser="http://namespaces.zope.org/browser"\n-  xmlns:plone="http://namespaces.plone.org/plone"\n-  xmlns:zcml="http://namespaces.zope.org/zcml"\n-  i18n_domain="plone.app.contenttypes">\n+    xmlns="http://namespaces.zope.org/zope"\n+    xmlns:browser="http://namespaces.zope.org/browser"\n+    xmlns:plone="http://namespaces.plone.org/plone"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n+    i18n_domain="plone.app.contenttypes"\n+    >\n \n   <utility\n       provides="zope.schema.interfaces.IVocabularyFactory"\n+      name="plone.restapi.testing.context_vocabulary"\n       component=".tests.dxtypes.vocabularyRequireingContextFactory"\n-      name="plone.restapi.testing.context_vocabulary" />\n+      />\n \n-  <include package="plone.behavior" file="meta.zcml"/>\n+  <include\n+      package="plone.behavior"\n+      file="meta.zcml"\n+      />\n   <include package="plone.rfc822" />\n-\t<plone:behavior\n-\t    title="Test Behavior"\n-\t    description="Schema-only behavior using attributes"\n-\t    provides=".tests.dxtypes.ITestBehavior"\n-\t    for="plone.dexterity.interfaces.IDexterityContent"\n-\t    />\n+  <plone:behavior\n+      title="Test Behavior"\n+      description="Schema-only behavior using attributes"\n+      provides=".tests.dxtypes.ITestBehavior"\n+      for="plone.dexterity.interfaces.IDexterityContent"\n+      />\n \n-\t<plone:behavior\n-\t    title="Test Annotations Behavior"\n-\t    description="Schema-only behavior using annotations"\n-\t    provides=".tests.dxtypes.ITestAnnotationsBehavior"\n-\t    factory="plone.behavior.AnnotationStorage"\n-\t    />\n+  <plone:behavior\n+      title="Test Annotations Behavior"\n+      description="Schema-only behavior using annotations"\n+      factory="plone.behavior.AnnotationStorage"\n+      provides=".tests.dxtypes.ITestAnnotationsBehavior"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/tests/test_services_types.py b/src/plone/restapi/tests/test_services_types.py\nindex 2177d6db5..257659bbb 100644\n--- a/src/plone/restapi/tests/test_services_types.py\n+++ b/src/plone/restapi/tests/test_services_types.py\n@@ -210,6 +210,7 @@ def test_types_document_patch_properties(self):\n                 }\n             },\n         )\n+        self.sleep_python2_plone52(0.5)\n         # PATCH returns no content\n         self.assertEqual(response.status_code, 204)\n \n@@ -272,7 +273,7 @@ def test_types_document_patch_one_field(self):\n                 "required": False,\n             },\n         )\n-        self.sleep_python2_plone52()\n+        self.sleep_python2_plone52(0.5)\n         self.assertEqual(response.status_code, 204)\n \n         response = self.api_session.get("/@types/Document/author_email")\ndiff --git a/src/plone/restapi/types/configure.zcml b/src/plone/restapi/types/configure.zcml\nindex 85187c844..53d706ef8 100644\n--- a/src/plone/restapi/types/configure.zcml\n+++ b/src/plone/restapi/types/configure.zcml\n@@ -1,35 +1,37 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:zcml="http://namespaces.zope.org/zcml"\n-    i18n_domain="plone.restapi">\n+    i18n_domain="plone.restapi"\n+    >\n \n-    <adapter factory=".adapters.DefaultJsonSchemaProvider" />\n-    <adapter factory=".adapters.BytesLineJsonSchemaProvider" />\n-    <adapter factory=".adapters.TextLineJsonSchemaProvider" />\n-    <adapter factory=".adapters.TextJsonSchemaProvider" />\n-    <adapter factory=".adapters.ASCIIJsonSchemaProvider" />\n-    <adapter factory=".adapters.ASCIILineJsonSchemaProvider" />\n-    <adapter factory=".adapters.EmailJsonSchemaProvider" />\n-    <adapter factory=".adapters.PasswordJsonSchemaProvider" />\n-    <adapter factory=".adapters.URIJsonSchemaProvider" />\n-    <adapter factory=".adapters.FloatJsonSchemaProvider" />\n-    <adapter factory=".adapters.DecimalJsonSchemaProvider" />\n-    <adapter factory=".adapters.IntegerJsonSchemaProvider" />\n-    <adapter factory=".adapters.BoolJsonSchemaProvider" />\n-    <adapter factory=".adapters.CollectionJsonSchemaProvider" />\n-    <adapter factory=".adapters.ListJsonSchemaProvider" />\n-    <adapter\n-        zcml:condition="installed z3c.relationfield"\n-        factory=".z3crelationadapter.ChoiceslessRelationListSchemaProvider"\n-        name="IRelatedItems.relatedItems" />\n-    <adapter factory=".adapters.SetJsonSchemaProvider" />\n-    <adapter factory=".adapters.TupleJsonSchemaProvider" />\n-    <adapter factory=".adapters.ChoiceJsonSchemaProvider" />\n-    <adapter factory=".adapters.ObjectJsonSchemaProvider" />\n-    <adapter factory=".adapters.DictJsonSchemaProvider" />\n-    <adapter factory=".adapters.RichTextJsonSchemaProvider" />\n-    <adapter factory=".adapters.DateJsonSchemaProvider" />\n-    <adapter factory=".adapters.DatetimeJsonSchemaProvider" />\n-    <adapter factory=".adapters.JSONFieldSchemaProvider" />\n+  <adapter factory=".adapters.DefaultJsonSchemaProvider" />\n+  <adapter factory=".adapters.BytesLineJsonSchemaProvider" />\n+  <adapter factory=".adapters.TextLineJsonSchemaProvider" />\n+  <adapter factory=".adapters.TextJsonSchemaProvider" />\n+  <adapter factory=".adapters.ASCIIJsonSchemaProvider" />\n+  <adapter factory=".adapters.ASCIILineJsonSchemaProvider" />\n+  <adapter factory=".adapters.EmailJsonSchemaProvider" />\n+  <adapter factory=".adapters.PasswordJsonSchemaProvider" />\n+  <adapter factory=".adapters.URIJsonSchemaProvider" />\n+  <adapter factory=".adapters.FloatJsonSchemaProvider" />\n+  <adapter factory=".adapters.DecimalJsonSchemaProvider" />\n+  <adapter factory=".adapters.IntegerJsonSchemaProvider" />\n+  <adapter factory=".adapters.BoolJsonSchemaProvider" />\n+  <adapter factory=".adapters.CollectionJsonSchemaProvider" />\n+  <adapter factory=".adapters.ListJsonSchemaProvider" />\n+  <adapter\n+      factory=".z3crelationadapter.ChoiceslessRelationListSchemaProvider"\n+      name="IRelatedItems.relatedItems"\n+      zcml:condition="installed z3c.relationfield"\n+      />\n+  <adapter factory=".adapters.SetJsonSchemaProvider" />\n+  <adapter factory=".adapters.TupleJsonSchemaProvider" />\n+  <adapter factory=".adapters.ChoiceJsonSchemaProvider" />\n+  <adapter factory=".adapters.ObjectJsonSchemaProvider" />\n+  <adapter factory=".adapters.DictJsonSchemaProvider" />\n+  <adapter factory=".adapters.RichTextJsonSchemaProvider" />\n+  <adapter factory=".adapters.DateJsonSchemaProvider" />\n+  <adapter factory=".adapters.DatetimeJsonSchemaProvider" />\n+  <adapter factory=".adapters.JSONFieldSchemaProvider" />\n \n </configure>\ndiff --git a/src/plone/restapi/upgrades/configure.zcml b/src/plone/restapi/upgrades/configure.zcml\nindex d96c1b37a..66bb67b0d 100644\n--- a/src/plone/restapi/upgrades/configure.zcml\n+++ b/src/plone/restapi/upgrades/configure.zcml\n@@ -2,70 +2,71 @@\n     xmlns="http://namespaces.zope.org/zope"\n     xmlns:browser="http://namespaces.zope.org/browser"\n     xmlns:genericsetup="http://namespaces.zope.org/genericsetup"\n-    i18n_domain="plone.restapi">\n+    i18n_domain="plone.restapi"\n+    >\n \n-    <!-- Upgrade to fix ordering, call manually via this browser-view if necessary -->\n-    <browser:page\n-        for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n-        name="plone-restapi-upgrade-fix-ordering"\n-        class=".ordering.FixOrderingView"\n-        permission="cmf.ManagePortal"\n-        />\n+  <!-- Upgrade to fix ordering, call manually via this browser-view if necessary -->\n+  <browser:page\n+      name="plone-restapi-upgrade-fix-ordering"\n+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"\n+      class=".ordering.FixOrderingView"\n+      permission="cmf.ManagePortal"\n+      />\n \n-    <!-- 0001 -> 0002 -->\n-    <genericsetup:upgradeStep\n-        title="Assign \'plone.restapi: Use REST API\' permission to Anonymous"\n-        description=""\n-        source="0001"\n-        destination="0002"\n-        handler="plone.restapi.upgrades.to0002.assign_use_api_permission"\n-        profile="plone.restapi:default"\n-        />\n+  <!-- 0001 -> 0002 -->\n+  <genericsetup:upgradeStep\n+      title="Assign \'plone.restapi: Use REST API\' permission to Anonymous"\n+      description=""\n+      profile="plone.restapi:default"\n+      source="0001"\n+      destination="0002"\n+      handler="plone.restapi.upgrades.to0002.assign_use_api_permission"\n+      />\n \n-    <genericsetup:registerProfile\n-        name="0002"\n-        title="plone.restapi.upgrades.0002"\n-        description=""\n-        directory="profiles/0002"\n-        for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n-        provides="Products.GenericSetup.interfaces.EXTENSION"\n-        />\n+  <genericsetup:registerProfile\n+      name="0002"\n+      title="plone.restapi.upgrades.0002"\n+      description=""\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      directory="profiles/0002"\n+      />\n \n-    <!-- 0002 -> 0003 -->\n-    <genericsetup:upgradeStep\n-        title="Install PAS plugin in Zope root"\n-        description=""\n-        source="0002"\n-        destination="0003"\n-        handler="plone.restapi.upgrades.to0003.install_pas_plugin_in_zope_root"\n-        profile="plone.restapi:default"\n-        />\n+  <!-- 0002 -> 0003 -->\n+  <genericsetup:upgradeStep\n+      title="Install PAS plugin in Zope root"\n+      description=""\n+      profile="plone.restapi:default"\n+      source="0002"\n+      destination="0003"\n+      handler="plone.restapi.upgrades.to0003.install_pas_plugin_in_zope_root"\n+      />\n \n-    <genericsetup:registerProfile\n-        name="0004"\n-        title="plone.restapi.upgrades.0004"\n-        description=""\n-        directory="profiles/0004"\n-        for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n-        provides="Products.GenericSetup.interfaces.EXTENSION"\n-        />\n+  <genericsetup:registerProfile\n+      name="0004"\n+      title="plone.restapi.upgrades.0004"\n+      description=""\n+      provides="Products.GenericSetup.interfaces.EXTENSION"\n+      for="Products.CMFPlone.interfaces.IMigratingPloneSiteRoot"\n+      directory="profiles/0004"\n+      />\n \n-    <genericsetup:upgradeStep\n-        title="Rename tiles and tiles_layout fields from Tiles behavior to blocks"\n-        description=""\n-        source="0004"\n-        destination="0005"\n-        handler="plone.restapi.upgrades.to0005.rename_tiles_to_blocks"\n-        profile="plone.restapi:default"\n-        />\n+  <genericsetup:upgradeStep\n+      title="Rename tiles and tiles_layout fields from Tiles behavior to blocks"\n+      description=""\n+      profile="plone.restapi:default"\n+      source="0004"\n+      destination="0005"\n+      handler="plone.restapi.upgrades.to0005.rename_tiles_to_blocks"\n+      />\n \n-    <genericsetup:upgradeStep\n-        title="Rename iface name to the short name in blocks"\n-        description=""\n-        source="0005"\n-        destination="0006"\n-        handler="plone.restapi.upgrades.to0006.rename_iface_to_name_in_blocks_behavior"\n-        profile="plone.restapi:default"\n-        />\n+  <genericsetup:upgradeStep\n+      title="Rename iface name to the short name in blocks"\n+      description=""\n+      profile="plone.restapi:default"\n+      source="0005"\n+      destination="0006"\n+      handler="plone.restapi.upgrades.to0006.rename_iface_to_name_in_blocks_behavior"\n+      />\n \n </configure>\n'

