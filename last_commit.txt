Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2023-03-07T22:23:57-08:00
Author: Alec Mitchell (alecpm) <alecpm@gmail.com>
Commit: https://github.com/plone/plone.portlet.collection/commit/39f3f90e130229fe083090a00a0af1f9daa41c11

Fix issue with using random.sample on catalog results when `exclude_context` is not selected.

Files changed:
M plone/portlet/collection/collection.py

b'diff --git a/plone/portlet/collection/collection.py b/plone/portlet/collection/collection.py\nindex 60eac21..a78f6fe 100644\n--- a/plone/portlet/collection/collection.py\n+++ b/plone/portlet/collection/collection.py\n@@ -272,9 +272,11 @@ def _random_results(self):\n             limit = self.data.limit and min(len(results), self.data.limit) or 1\n \n             if exclude_context:\n-                results = [\n+                results = tuple(\n                     brain for brain in results if brain.getPath() != context_path\n-                ]\n+                )\n+            else:\n+                results = tuple(results)\n             if len(results) < limit:\n                 limit = len(results)\n             results = random.sample(results, limit)\n'

Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2023-06-18T22:36:26-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.portlet.collection/commit/760324167734803308fc654d533b66657edbed60

changelog

Files changed:
A news/36.bugfix

b'diff --git a/news/36.bugfix b/news/36.bugfix\nnew file mode 100644\nindex 0000000..9af22ea\n--- /dev/null\n+++ b/news/36.bugfix\n@@ -0,0 +1 @@\n+Fix TypeError with "Select random items" option. @alecpm\n'

Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2023-06-18T22:38:16-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.portlet.collection/commit/3e00b5db281b965e4939fbb8aed199b49930ba01

Merge pull request #36 from plone/random-py3-fix

Fix issue with using random selection

Files changed:
A news/36.bugfix
M plone/portlet/collection/collection.py

b'diff --git a/news/36.bugfix b/news/36.bugfix\nnew file mode 100644\nindex 0000000..9af22ea\n--- /dev/null\n+++ b/news/36.bugfix\n@@ -0,0 +1 @@\n+Fix TypeError with "Select random items" option. @alecpm\ndiff --git a/plone/portlet/collection/collection.py b/plone/portlet/collection/collection.py\nindex c6f8123..f84a199 100644\n--- a/plone/portlet/collection/collection.py\n+++ b/plone/portlet/collection/collection.py\n@@ -255,9 +255,11 @@ def _random_results(self):\n             limit = self.data.limit and min(len(results), self.data.limit) or 1\n \n             if exclude_context:\n-                results = [\n+                results = tuple(\n                     brain for brain in results if brain.getPath() != context_path\n-                ]\n+                )\n+            else:\n+                results = tuple(results)\n             if len(results) < limit:\n                 limit = len(results)\n             results = random.sample(results, limit)\n'

