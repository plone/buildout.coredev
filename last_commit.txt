Repository: plone.restapi


Branch: refs/heads/main
Date: 2024-05-16T11:06:01-07:00
Author: Mauro Amico (mamico) <mauro.amico@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/15ac486ef5fd2fb8d1b678fc237e02fbe7650027

add cache rules for @site and @navroot (#1779)

* add cache rules for @site and @navroot

* fix zcml

* changelog

Files changed:
A news/1779.feature
M .gitignore
M src/plone/restapi/services/navroot/configure.zcml
M src/plone/restapi/services/site/configure.zcml

b'diff --git a/.gitignore b/.gitignore\nindex c8eac2e33f..ec8f4c6a69 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -26,6 +26,7 @@ docs/.DS_Store\n /local\n /venv\n /.mr.developer.cfg\n+/.python-version\n *.mo\n docs/_build\n docs/plone.restapi.http-examples\ndiff --git a/news/1779.feature b/news/1779.feature\nnew file mode 100644\nindex 0000000000..da3e9b8984\n--- /dev/null\n+++ b/news/1779.feature\n@@ -0,0 +1 @@\n+add cache rules for `@site` and `@navroot`. @mamico\ndiff --git a/src/plone/restapi/services/navroot/configure.zcml b/src/plone/restapi/services/navroot/configure.zcml\nindex a9a8451388..b7728aa13b 100644\n--- a/src/plone/restapi/services/navroot/configure.zcml\n+++ b/src/plone/restapi/services/navroot/configure.zcml\n@@ -13,11 +13,15 @@\n       name="@navroot"\n       />\n \n-\n   <adapter\n       factory=".get.Navroot"\n       name="navroot"\n       />\n \n+  <cache:ruleset\n+      for=".get.NavrootGet"\n+      ruleset="plone.content.dynamic"\n+      zcml:condition="have plone-app-caching-3"\n+      />\n \n </configure>\ndiff --git a/src/plone/restapi/services/site/configure.zcml b/src/plone/restapi/services/site/configure.zcml\nindex 76bc963b44..24ed968654 100644\n--- a/src/plone/restapi/services/site/configure.zcml\n+++ b/src/plone/restapi/services/site/configure.zcml\n@@ -1,6 +1,8 @@\n <configure\n     xmlns="http://namespaces.zope.org/zope"\n+    xmlns:cache="http://namespaces.zope.org/cache"\n     xmlns:plone="http://namespaces.plone.org/plone"\n+    xmlns:zcml="http://namespaces.zope.org/zcml"\n     >\n \n   <plone:service\n@@ -11,4 +13,10 @@\n       name="@site"\n       />\n \n+  <cache:ruleset\n+      for=".get.SiteGet"\n+      ruleset="plone.content.dynamic"\n+      zcml:condition="have plone-app-caching-3"\n+      />\n+\n </configure>\n'

