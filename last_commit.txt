Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2022-03-15T13:51:45+01:00
Author: Godefroid Chapelle (gotcha) <gotcha@bubblenet.be>
Commit: https://github.com/plone/Products.ATContentTypes/commit/3436e32612b13855fb8c0063f794bd786b7f162d

Fix test

after PortalTransforms uses lxml html method to serialize
(instead of xml method).

Files changed:
M Products/ATContentTypes/tests/test_atdocument.py

b'diff --git a/Products/ATContentTypes/tests/test_atdocument.py b/Products/ATContentTypes/tests/test_atdocument.py\nindex de5b68f0..8e9abc7b 100644\n--- a/Products/ATContentTypes/tests/test_atdocument.py\n+++ b/Products/ATContentTypes/tests/test_atdocument.py\n@@ -95,21 +95,15 @@ def test_x_safe_html(self):\n         doc = self._ATCT\n         mimetypes = (\n             (\'text/html\', \'<p>test</p>\'),\n-            # MTR doens\'t know about text/stx, and transforming\n+            # MTR does not know about text/stx, and transforming\n             # doubles the tags. Yuck.\n-            (\'text/structured\', \'<p><p>test</p></p>\\n\'),\n+            (\'text/structured\', \'<p></p><p>test</p>\\n\'),\n         )\n         for mimetype, expected in mimetypes:\n             # scrub html is removing unallowed tags\n             text = "<p>test</p><script>I\'m a nasty boy<p>nested</p></script>"\n             doc.setText(text, mimetype=mimetype)\n             txt = doc.getText()\n-            # fix for lxml based safe HTML cleaner\n-            # nested p-tags are not allowed and therefore removed\n-            # put expected string to mimetypes tuple above and remove condition\n-            # once PLIP 1441 is merged.\n-            if \'<p/>\' in txt:\n-                expected = \'<p/><p>test</p>\\n\'\n             self.assertEqual(txt, expected, (txt, expected, mimetype))\n \n     def test_get_size(self):\n'

Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2022-03-15T17:08:53+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.ATContentTypes/commit/9a4e80e3adaf5b6fe2e4218c412c3f30c4faf4bf

Merge pull request #68 from plone/do_not_autoclose_tags

Fix test after PortalTransforms uses lxml html method to serialize (instead of xml method).

Files changed:
M Products/ATContentTypes/tests/test_atdocument.py

b'diff --git a/Products/ATContentTypes/tests/test_atdocument.py b/Products/ATContentTypes/tests/test_atdocument.py\nindex de5b68f0..8e9abc7b 100644\n--- a/Products/ATContentTypes/tests/test_atdocument.py\n+++ b/Products/ATContentTypes/tests/test_atdocument.py\n@@ -95,21 +95,15 @@ def test_x_safe_html(self):\n         doc = self._ATCT\n         mimetypes = (\n             (\'text/html\', \'<p>test</p>\'),\n-            # MTR doens\'t know about text/stx, and transforming\n+            # MTR does not know about text/stx, and transforming\n             # doubles the tags. Yuck.\n-            (\'text/structured\', \'<p><p>test</p></p>\\n\'),\n+            (\'text/structured\', \'<p></p><p>test</p>\\n\'),\n         )\n         for mimetype, expected in mimetypes:\n             # scrub html is removing unallowed tags\n             text = "<p>test</p><script>I\'m a nasty boy<p>nested</p></script>"\n             doc.setText(text, mimetype=mimetype)\n             txt = doc.getText()\n-            # fix for lxml based safe HTML cleaner\n-            # nested p-tags are not allowed and therefore removed\n-            # put expected string to mimetypes tuple above and remove condition\n-            # once PLIP 1441 is merged.\n-            if \'<p/>\' in txt:\n-                expected = \'<p/><p>test</p>\\n\'\n             self.assertEqual(txt, expected, (txt, expected, mimetype))\n \n     def test_get_size(self):\n'

