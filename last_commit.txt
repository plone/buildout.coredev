Repository: plone.app.content


Branch: refs/heads/master
Date: 2024-07-26T09:42:52+02:00
Author: Manuel Reinhardt (reinhardt) <reinhardt@syslab.com>
Commit: https://github.com/plone/plone.app.content/commit/8edb2080004db641ac206a423b00344d0dad97b7

getVocabulary: Call scrub_html on the end result instead of individual items

This saves a lot of runtime for large vocabularies like Keywords.

Files changed:
A news/287.bugfix
M plone/app/content/browser/vocabulary.py

b'diff --git a/news/287.bugfix b/news/287.bugfix\nnew file mode 100644\nindex 0000000..37f8cac\n--- /dev/null\n+++ b/news/287.bugfix\n@@ -0,0 +1 @@\n+getVocabulary: Speed improvement for large vocabularies\ndiff --git a/plone/app/content/browser/vocabulary.py b/plone/app/content/browser/vocabulary.py\nindex 4b707cf..7419e80 100644\n--- a/plone/app/content/browser/vocabulary.py\n+++ b/plone/app/content/browser/vocabulary.py\n@@ -261,10 +261,8 @@ def __call__(self):\n         else:\n             items = [\n                 {\n-                    "id": unescape(transform.scrub_html(item.value)),\n-                    "text": (\n-                        unescape(transform.scrub_html(item.title)) if item.title else ""\n-                    ),\n+                    "id": item.value,\n+                    "text": (item.title if item.title else ""),\n                 }\n                 for item in results\n             ]\n@@ -272,7 +270,9 @@ def __call__(self):\n         if total == 0:\n             total = len(items)\n \n-        return json_dumps({"results": items, "total": total})\n+        return unescape(\n+            transform.scrub_html(json_dumps({"results": items, "total": total}))\n+        )\n \n     def parsed_query(\n         self,\n'

Repository: plone.app.content


Branch: refs/heads/master
Date: 2024-07-30T17:07:14+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.content/commit/b1e76e2c2e0bc178771335fbf54f0ff550515b27

Merge pull request #287 from plone/getVocabulary-speed

getVocabulary: Call scrub_html on the end result

Files changed:
A news/287.bugfix
M plone/app/content/browser/vocabulary.py

b'diff --git a/news/287.bugfix b/news/287.bugfix\nnew file mode 100644\nindex 0000000..37f8cac\n--- /dev/null\n+++ b/news/287.bugfix\n@@ -0,0 +1 @@\n+getVocabulary: Speed improvement for large vocabularies\ndiff --git a/plone/app/content/browser/vocabulary.py b/plone/app/content/browser/vocabulary.py\nindex 4b707cf..7419e80 100644\n--- a/plone/app/content/browser/vocabulary.py\n+++ b/plone/app/content/browser/vocabulary.py\n@@ -261,10 +261,8 @@ def __call__(self):\n         else:\n             items = [\n                 {\n-                    "id": unescape(transform.scrub_html(item.value)),\n-                    "text": (\n-                        unescape(transform.scrub_html(item.title)) if item.title else ""\n-                    ),\n+                    "id": item.value,\n+                    "text": (item.title if item.title else ""),\n                 }\n                 for item in results\n             ]\n@@ -272,7 +270,9 @@ def __call__(self):\n         if total == 0:\n             total = len(items)\n \n-        return json_dumps({"results": items, "total": total})\n+        return unescape(\n+            transform.scrub_html(json_dumps({"results": items, "total": total}))\n+        )\n \n     def parsed_query(\n         self,\n'

