Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2024-09-14T20:19:16+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/plone.schemaeditor/commit/6af1b41a0062ddfcaf368e63625a97a8a5700810

Configuring with plone/meta

Files changed:
A dependabot.yml
A news/+meta.internal
M .editorconfig
M .flake8
M .github/workflows/meta.yml
M .gitignore
M .meta.toml
M .pre-commit-config.yaml
M pyproject.toml
M tox.ini

b'diff --git a/.editorconfig b/.editorconfig\nindex 919b411..5b3c112 100644\n--- a/.editorconfig\n+++ b/.editorconfig\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n #\n # EditorConfig Configuration file, for more details see:\n@@ -13,7 +13,8 @@\n root = true\n \n \n-[*]  # For All Files\n+[*]\n+# Default settings for all files.\n # Unix-style newlines with a newline ending every file\n end_of_line = lf\n insert_final_newline = true\n@@ -29,13 +30,15 @@ max_line_length = off\n # 4 space indentation\n indent_size = 4\n \n-[*.{yml,zpt,pt,dtml,zcml}]\n+[*.{yml,zpt,pt,dtml,zcml,html,xml}]\n # 2 space indentation\n indent_size = 2\n \n-[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss,html}]  # Frontend development\n+[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss}]\n+# Frontend development\n # 2 space indentation\n indent_size = 2\n+max_line_length = 80\n \n [{Makefile,.gitmodules}]\n # Tab indentation (no size specified, but view as 4 spaces)\ndiff --git a/.flake8 b/.flake8\nindex 7ef4f64..38918f4 100644\n--- a/.flake8\n+++ b/.flake8\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [flake8]\n doctests = 1\ndiff --git a/.github/workflows/meta.yml b/.github/workflows/meta.yml\nindex a7f25e0..c9848bc 100644\n--- a/.github/workflows/meta.yml\n+++ b/.github/workflows/meta.yml\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n name: Meta\n on:\n@@ -13,6 +13,16 @@ on:\n       - main\n   workflow_dispatch:\n \n+##\n+# To set environment variables for all jobs, add in .meta.toml:\n+# [github]\n+# env = """\n+#     debug: 1\n+#     image-name: \'org/image\'\n+#     image-tag: \'latest\'\n+# """\n+##\n+\n jobs:\n   qa:\n     uses: plone/meta/.github/workflows/qa.yml@main\n@@ -22,7 +32,44 @@ jobs:\n     uses: plone/meta/.github/workflows/coverage.yml@main\n   dependencies:\n     uses: plone/meta/.github/workflows/dependencies.yml@main\n-  release-ready:\n+  release_ready:\n     uses: plone/meta/.github/workflows/release_ready.yml@main\n   circular:\n     uses: plone/meta/.github/workflows/circular.yml@main\n+\n+##\n+# To modify the list of default jobs being created add in .meta.toml:\n+# [github]\n+# jobs = [\n+#    "qa",\n+#    "test",\n+#    "coverage",\n+#    "dependencies",\n+#    "release_ready",\n+#    "circular",\n+#    ]\n+##\n+\n+##\n+# To request that some OS level dependencies get installed\n+# when running tests/coverage jobs, add in .meta.toml:\n+# [github]\n+# os_dependencies = "git libxml2 libxslt"\n+##\n+\n+##\n+# To test against a specific matrix of python versions\n+# when running tests jobs, add in .meta.toml:\n+# [github]\n+# py_versions = "[\'3.12\', \'3.11\']"\n+##\n+\n+\n+##\n+# Specify additional jobs in .meta.toml:\n+#  [github]\n+#  extra_lines = """\n+#  another:\n+#    uses: org/repo/.github/workflows/file.yml@main\n+#  """\n+##\ndiff --git a/.gitignore b/.gitignore\nindex 81594fd..486392f 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -1,14 +1,18 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n # python related\n *.egg-info\n *.pyc\n *.pyo\n \n+# translation related\n+*.mo\n+\n # tools related\n build/\n .coverage\n+.*project\n coverage.xml\n dist/\n docs/_build\n@@ -31,6 +35,7 @@ lib64\n parts/\n pyvenv.cfg\n var/\n+local.cfg\n \n # mxdev\n /instance/\ndiff --git a/.meta.toml b/.meta.toml\nindex 4ca2970..7470324 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -1,6 +1,6 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [meta]\n template = "default"\n-commit-id = "cfffba8c"\n+commit-id = "5d22fbf8"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex d37b416..1460326 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n ci:\n     autofix_prs: false\n@@ -75,6 +75,16 @@ repos:\n     hooks:\n     -   id: i18ndude\n \n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pre_commit]\n+#  i18ndude_extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\n+\n+\n ##\n # Add extra configuration options in .meta.toml:\n #  [pre_commit]\ndiff --git a/dependabot.yml b/dependabot.yml\nnew file mode 100644\nindex 0000000..bbd3ab0\n--- /dev/null\n+++ b/dependabot.yml\n@@ -0,0 +1,11 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/main/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+version: 2\n+updates:\n+\n+  - package-ecosystem: "github-actions"\n+    directory: "/"\n+    schedule:\n+      # Check for updates to GitHub Actions every week\n+      interval: "weekly"\ndiff --git a/news/+meta.internal b/news/+meta.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/+meta.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex e442bd0..66b2322 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,6 +1,9 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n+[build-system]\n+requires = ["setuptools>=68.2"]\n+\n [tool.towncrier]\n directory = "news/"\n filename = "CHANGES.rst"\n@@ -68,7 +71,7 @@ target-version = ["py38"]\n ##\n \n [tool.codespell]\n-ignore-words-list = "discreet,"\n+ignore-words-list = "discreet,assertin,"\n skip = "*.po,"\n ##\n # Add extra configuration options in .meta.toml:\n@@ -116,6 +119,7 @@ Zope = [\n   \'Products.CMFCore\', \'Products.CMFDynamicViewFTI\',\n ]\n python-dateutil = [\'dateutil\']\n+pytest-plone = [\'pytest\', \'zope.pytestlayer\', \'plone.testing\', \'plone.app.testing\']\n \n ##\n # Add extra configuration options in .meta.toml:\n@@ -125,19 +129,20 @@ python-dateutil = [\'dateutil\']\n #    "gitpython = [\'git\']",\n #    "pygithub = [\'github\']",\n #  ]\n-#  """\n ##\n \n [tool.check-manifest]\n ignore = [\n     ".editorconfig",\n+    ".flake8",\n     ".meta.toml",\n     ".pre-commit-config.yaml",\n-    "tox.ini",\n-    ".flake8",\n+    "dependabot.yml",\n     "mx.ini",\n+    "tox.ini",\n \n ]\n+\n ##\n # Add extra configuration options in .meta.toml:\n #  [pyproject]\n@@ -145,6 +150,11 @@ ignore = [\n #      "*.map.js",\n #      "*.pyc",\n #  """\n+#  check_manifest_extra_lines = """\n+#  ignore-bad-ideas = [\n+#      "some/test/file/PKG-INFO",\n+#  ]\n+#  """\n ##\n \n \ndiff --git a/tox.ini b/tox.ini\nindex 21a648b..ee3baeb 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [tox]\n # We need 4.4.0 for constrain_package_deps.\n@@ -32,6 +32,21 @@ commands =\n     echo "Unrecognized environment name {envname}"\n     false\n \n+##\n+# Add extra configuration options in .meta.toml:\n+#  [tox]\n+#  testenv_options = """\n+#  basepython = /usr/bin/python3.8\n+#  """\n+##\n+\n+[testenv:init]\n+description = Prepare environment\n+skip_install = true\n+commands =\n+    echo "Initial setup complete"\n+\n+\n [testenv:format]\n description = automatically reformat code\n skip_install = true\n@@ -56,9 +71,9 @@ description = check if the package defines all its dependencies\n skip_install = true\n deps =\n     build\n-    z3c.dependencychecker==2.11\n+    z3c.dependencychecker==2.14.3\n commands =\n-    python -m build --sdist --no-isolation\n+    python -m build --sdist\n     dependencychecker\n \n [testenv:dependencies-graph]\n@@ -86,16 +101,26 @@ set_env =\n #  test_environment_variables = """\n #      PIP_EXTRA_INDEX_URL=https://my-pypi.my-server.com/\n #  """\n+#\n+# Set constrain_package_deps .meta.toml:\n+#  [tox]\n+#  constrain_package_deps = "false"\n ##\n deps =\n     zope.testrunner\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+\n ##\n+# Specify additional deps in .meta.toml:\n+#  [tox]\n+#  test_deps_additional = "-esources/plonegovbr.portal_base[test]"\n+#\n # Specify a custom constraints file in .meta.toml:\n #  [tox]\n #  constraints_file = "https://my-server.com/constraints.txt"\n ##\n commands =\n+    rfbrowser init\n     zope-testrunner --all --test-path={toxinidir} -s plone.schemaeditor {posargs}\n extras =\n     test\n@@ -128,10 +153,13 @@ deps =\n     coverage\n     zope.testrunner\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+\n commands =\n+    rfbrowser init\n     coverage run --branch --source plone.schemaeditor {envbindir}/zope-testrunner --quiet --all --test-path={toxinidir} -s plone.schemaeditor {posargs}\n     coverage report -m --format markdown\n     coverage xml\n+    coverage html\n extras =\n     test\n \n@@ -144,18 +172,22 @@ deps =\n     build\n     towncrier\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+\n commands =\n     # fake version to not have to install the package\n     # we build the change log as news entries might break\n     # the README that is displayed on PyPI\n     towncrier build --version=100.0.0 --yes\n-    python -m build --sdist --no-isolation\n+    python -m build --sdist\n     twine check dist/*\n \n [testenv:circular]\n description = ensure there are no cyclic dependencies\n use_develop = true\n skip_install = false\n+# Here we must always constrain the package deps to what is already installed,\n+# otherwise we simply get the latest from PyPI, which may not work.\n+constrain_package_deps = true\n set_env =\n \n ##\n@@ -171,6 +203,7 @@ deps =\n     pipdeptree\n     pipforester\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+\n commands =\n     # Generate the full dependency tree\n     sh -c \'pipdeptree -j > forest.json\'\n'

Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2024-09-14T20:24:55+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/plone.schemaeditor/commit/af173a22de36ce795289ae951af30f17096e5f47

Update imports for fixtures

Files changed:
M plone/schemaeditor/testing.py

b'diff --git a/plone/schemaeditor/testing.py b/plone/schemaeditor/testing.py\nindex 55bb7cf..fac6896 100644\n--- a/plone/schemaeditor/testing.py\n+++ b/plone/schemaeditor/testing.py\n@@ -4,7 +4,7 @@\n from plone.app.testing import FunctionalTesting\n from plone.app.testing import PLONE_FIXTURE\n from plone.app.testing import PloneSandboxLayer\n-from plone.testing import z2\n+from plone.testing.zope import WSGI_SERVER_FIXTURE\n \n \n class PloneSchemaeditorRobotLayer(PloneSandboxLayer):\n@@ -20,7 +20,7 @@ class PloneSchemaeditorRobotLayer(PloneSandboxLayer):\n     bases=(\n         FIXTURE,\n         AUTOLOGIN_LIBRARY_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ),\n     name="ACCEPTANCE",\n )\n'

Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2024-09-14T20:25:35+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/plone.schemaeditor/commit/8c19d46662a2628e6eb1a9b98dac37390fbab214

port robot tests

Files changed:
M plone/schemaeditor/tests/robot/test_fields.robot

b'diff --git a/plone/schemaeditor/tests/robot/test_fields.robot b/plone/schemaeditor/tests/robot/test_fields.robot\nindex ed13c2b..db4c6bb 100644\n--- a/plone/schemaeditor/tests/robot/test_fields.robot\n+++ b/plone/schemaeditor/tests/robot/test_fields.robot\n@@ -1,213 +1,251 @@\n *** Settings ***\n \n-Resource  plone/app/robotframework/keywords.robot\n-Resource  plone/app/robotframework/saucelabs.robot\n-Resource  plone/app/robotframework/selenium.robot\n+Resource    plone/app/robotframework/browser.robot\n \n-Library  Remote  ${PLONE_URL}/RobotRemote\n+Library    Remote    ${PLONE_URL}/RobotRemote\n \n-Test Setup  Run Keywords  Plone test setup\n-Test Teardown  Run keywords  Plone test teardown\n+Test Setup    Run Keywords    Plone test setup\n+Test Teardown    Run keywords    Plone test teardown\n \n-*** Variables ***\n-${SELENIUM_TIMEOUT}  20\n \n *** Test Cases ***\n \n-Add a content type\n-\n-    Go to dexterity types configuration\n-    Click Overlay Button  Add New Content Type\xe2\x80\xa6\n-    Input text for sure  form-widgets-title  New style Article\n-    Set Focus to Element  form-widgets-id\n-    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-id  new_style_article\n-    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n-    Wait overlay is closed\n-    Wait until page contains  New style Article\n-\n-\n-Add a choice field with a named vocabulary\n-\n-    Go to dexterity types configuration\n-    Add content type  Curriculum vitae  curriculum_vitae\n-    Click Link  Add new field\xe2\x80\xa6\n-    Input text for sure  form-widgets-title  Languages\n-    Set Focus to Element  form-widgets-__name__\n-    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  languages\n-    Input text for sure  form-widgets-description  Spoken languages\n-    Wait until keyword succeeds  10  1  Select From List By Label  form-widgets-factory  Multiple Choice\n-    Wait until keyword succeeds  10  1  Click button  css=.modal-footer #form-buttons-add\n-    Wait overlay is closed\n-    Wait until page contains element  css=div[data-field_id="languages"] a.fieldSettings\n-\n-    Open field settings  languages\n-    Select from list by value  form-widgets-vocabularyName  plone.app.vocabularies.AvailableContentLanguages\n-    Wait For Then Click Element  css=.modal-footer #form-buttons-save\n-    Wait overlay is closed\n-    Page should contain  Fran\xc3\xa7ais\n-\n-\n-Add a choice field with vocabulary values\n-\n-    Go to dexterity types configuration\n-    Add content type  My page  my_page\n-    Add field  Hobbies  hobbies  Multiple Choice\n-    Open field settings  hobbies\n-    Input text  form-widgets-values  Chess\\nSoccer\\nBaseball\\nVideo games\n-    Wait For Then Click Element  css=.modal-footer #form-buttons-save\n-    Wait overlay is closed\n-    Wait until page contains element  form-widgets-hobbies-3\n-\n-#fail on jenkins\n-#We get an error if we try to select vocabulary name and vocabulary values\n-\n-#    Go to dexterity types configuration\n-#    Add content type  My other page  my_other_page\n-#    Add field  Hobbies  hobbies  Multiple Choice\n-#    Open field settings  hobbies\n-#    Input text  form-widgets-values  Chess\\nSoccer\\nBaseball\\nVideo games\n-#    Select from list by value  form-widgets-vocabularyName  plone.app.vocabularies.AvailableContentLanguages\n-#    Click Button  Save\n-#    Wait until page contains element  css=#formfield-form-widgets-vocabularyName.error\n-#\n-\n-\n-Add accented field\n-\n-    Go to dexterity types configuration\n-    Add content type  Person  person\n-    Click Link  Add new field\xe2\x80\xa6\n-    Input text for sure  form-widgets-title  Pr\xc3\xa9nom\n-    Set Focus to Element  form-widgets-__name__\n-    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  prenom\n-\n-\n-Add a fieldSet and move a field into this fieldset\n-\n-    Go to dexterity types configuration\n-    Add content type  Contact info  contact_info\n-    Add field  Address  address  Text\n-    Add fieldset  Personal information  personal_information\n-\n-#    Mouse Down  xpath=//*[@data-field_id="address"][1]\n-#    Mouse Over  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="1"]\n-#    Mouse Up  xpath=//*[@data-fieldset_drag_id="1"][1]\n-#    Wait Until Keyword Succeeds  10  1  Element should not be visible  css=.fieldPreview[data-field_id="address"]\n-#    Click Element  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="1"]\n-#    Wait Until Keyword Succeeds  10  1  Element should be visible  css=.fieldPreview[data-field_id="address"]\n-\n-\n-Add a fieldSet and add a field into this fieldset\n-\n-    Go to dexterity types configuration\n-    Add content type  Contact info  contact_info\n-    Add fieldset  Personal information  personal_information\n-    Click Element  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="1"]\n-    Add field  Address  address  Text\n-    Click Element  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="0"]\n-    Wait Until Keyword Succeeds  10  1  Element should not be visible  css=.fieldPreview[data-field_id="address"]\n-    Click Element  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="1"]\n-    Wait Until Keyword Succeeds  10  1  Element should be visible  css=.fieldPreview[data-field_id="address"]\n-\n-\n-#Add a fieldSet and add a field into this fieldset\n-#\n-#    Set Window Size  1200  1200\n-#    Go to dexterity types configuration\n-#    Add content type  Contact info  contact_info\n-#    Click Overlay Button  Add new fieldset\xe2\x80\xa6\n-#    Input text for sure  form-widgets-label  Personal information\n-#    Set Focus to Element  form-widgets-__name__\n-#    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  personal_information\n-#    Click button  css=.modal-footer #form-buttons-add\n-#    Wait overlay is closed\n-#    Wait until page contains  Personal information\n-#\n-#    Click Element  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="1"]\n-#    Add field  Address  address  Text\n-#    Click Element  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="1"]\n-#    Wait until page contains element  css=div[data-field_id="address"]\n-\n-\n-Delete field\n-    Go to dexterity types configuration\n-    Add content type  Somebody  somebody\n-    Add field  Phone  phone  Text line (String)\n-    Wait For Element  css=#fieldset-0 #formfield-form-widgets-phone\n-    Click link  css=div.fieldControls .schemaeditor-delete-field\n-    Handle alert\n-    Wait Until Keyword Succeeds  10  1  Page Should Not Contain Element  css=#formfield-form-widgets-phone\n-    # Make sure it actually got deleted\n-    Go to  ${PLONE_URL}/@@dexterity-types/somebody/@@fields\n-    Wait Until Keyword Succeeds  10  1  Page Should Not Contain Element  css=#formfield-form-widgets-phone\n-\n-\n-#~ Reorder field\n-    #~ Log in as site owner\n-    #~ Add content type\n-    #~ Add field  Lastname  lastname  Text line (String)\n-    #~ Wait until page contains element  css=#fieldset-0 #formfield-form-widgets-lastname\n-    #~ Add field  Firstname  firstname  Text line (String)\n-    #~ Wait until page contains element  css=#fieldset-0 #formfield-form-widgets-firstname\n-\n-    #~ /html/body/div/div[2]/div/div[2]/div[2]/div/div/form/fieldset/div[3]/div/span\n-    #~ Mouse Down  xpath=//div[@data-field_id=\'phone\']/div/span[@class=\'draghandle\']\n-    #~ Mouse Over    xpath=//div[@data-field_id=\'firstname\']\n-    #~ Mouse Out   xpath=//div[@data-field_id=\'phone\']/div/span[@class=\'draghandle\']\n+Scenario: Add a content type\n+\n+    Given a site owner\n+     When I go to dexterity types configuration\n+      and I add a new Content Type    New style Article    new_style_article\n+     Then the overlay is closed\n+      and the new Content Type is created    New style Article\n+\n+\n+Scenario: Add a choice field with a named vocabulary\n+\n+    Given a site owner\n+     When I go to dexterity types configuration\n+      and I add a new Content Type    Curriculum vitae    curriculum_vitae\n+      and I go to fields configuration    curriculum_vitae\n+      and I add a new field    Languages    languages    Multiple Choice\n+     Then the overlay is closed\n+      and the new Field is created    languages\n+\n+     When I configure the language field\n+     Then the overlay is closed\n+      and I see the list of portal languages\n+\n+Scenario: Add a choice field with vocabulary values\n+\n+    Given a site owner\n+     When I go to dexterity types configuration\n+      and I add a new Content Type    My page    my_page\n+      and I go to fields configuration    my_page\n+      and I add a new field    Hobbies    hobbies    Multiple Choice\n+     Then the overlay is closed\n+      and the new Field is created    hobbies\n+\n+     When I configure the hobbies field\n+     Then the overlay is closed\n+      and I see the list of hobbies\n+\n+Scenario: Try to add a choice field with a named vocabulary and vocabulary values\n+\n+    Given a site owner\n+     When I go to dexterity types configuration\n+      and I add a new Content Type    My other page    my_other_page\n+      and I go to fields configuration    my_other_page\n+      and I add a new field    Hobbies    hobbies    Multiple Choice\n+      and I configure the hobbies field with wrong values\n+     Then I see an errormessage in the dialog\n+\n+Scenario: Add accented field\n+\n+    Given a site owner\n+     When I go to dexterity types configuration\n+      and I add a new Content Type    Person    person\n+      and I go to fields configuration    person\n+      and I add a new field    Pr\xc3\xa9nom    prenom    Text line (String)\n+     Then the overlay is closed\n+      and the new Field is created    prenom\n+\n+Scenario: Add a fieldSet and move a field into this fieldset\n+\n+    Given a site owner\n+    When I go to dexterity types configuration\n+     and I add a new Content Type    Contact info    contact_info\n+     and I go to fields configuration    contact_info\n+     and I add a new field    Address    address    Text\n+     and I add a new fieldset    Personal information    personal_information\n+    Then the overlay is closed\n+     and the new fieldset is created    Personal information\n+\n+Scenario: Add a fieldSet and add a field into this fieldset\n+\n+    Given a site owner\n+    When I go to dexterity types configuration\n+     and I add a new Content Type    Contact info    contact_info\n+     and I go to fields configuration    contact_info\n+     and I add a new fieldset    Personal information    personal_information\n+     and I got to fieldset    Personal information\n+     and I add a new field    Address    address    Text\n+    Then the field is added to fieldset    Personal information    Address\n+\n+Scenario: Delete field\n+\n+    Given a site owner\n+    When I go to dexterity types configuration\n+     and I add a new Content Type    Somebody    somebody\n+     and I go to fields configuration    somebody\n+     and I add a new field    Phone    phone    Text line (String)\n+    Then the overlay is closed\n+     and the new Field is created    phone\n+\n+    When I delete field    phone\n+    Then the field is removed    phone\n \n \n *** Keywords ***\n \n-Wait overlay is closed\n-    Wait until keyword succeeds  8  1  Page should not contain element  css=div.modal-wrapper\n-\n-Go to dexterity types configuration\n-    Enable autologin as  Manager\n-    Go to  ${PLONE_URL}/@@dexterity-types\n-\n-Add content type\n-    [Arguments]    ${title}    ${id}\n-    [Documentation]    Add a dexterity content type\n-\n-    Click Overlay Button  Add New Content Type\xe2\x80\xa6\n-    Input text for sure  form-widgets-title  ${title}\n-    Set Focus to Element  form-widgets-id\n-    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-id  ${id}\n-    # Far too often, the overlay is not closed after clicking the add-button.\n-    # Maybe some sleep helps.  Never nice to do, but better than having developers lose sleep.\n-    Sleep  0.1\n-    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n-    Wait overlay is closed\n-    Wait until page contains  ${title}\n-    Go to  ${PLONE_URL}/@@dexterity-types/${id}/@@fields\n-    Wait until page contains  Fields\n-\n-Add field\n-    [Arguments]    ${field_title}    ${field_id}    ${field_type}\n-    [Documentation]    Add field in current dexterity content type\n+# Given\n+\n+a site owner\n+\n+    Enable autologin as    Manager\n+\n+# When\n+\n+I go to dexterity types configuration\n+\n+    Go to    ${PLONE_URL}/@@dexterity-types\n+\n+I go to fields configuration\n+    [Arguments]    ${CONTENT_TYPE_ID}\n+\n+    Click    //a[contains(@class, "contenttype-${CONTENT_TYPE_ID}")]\n+    Click    //a[contains(@href,"/${CONTENT_TYPE_ID}/@@fields")]\n+\n+I got to fieldset\n+    [Arguments]    ${FIELD_LABEL}\n+\n+    Click    //nav[@class="autotoc-nav"]/a[contains(text(),"${FIELD_LABEL}")]\n+\n \n-    Click Link  Add new field\xe2\x80\xa6\n-    Input text for sure  form-widgets-title  ${field_title}\n-    Set Focus to Element  form-widgets-__name__\n-    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  ${field_id}\n-    Select from list by label  form-widgets-factory  ${field_type}\n-    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n-    Wait overlay is closed\n+I add a new Content Type\n+    [Arguments]    ${CONTENT_TYPE_NAME}    ${CONTENT_TYPE_ID}\n+    [Documentation]    Add a new dexterity content type\n \n-Add fieldset\n-    [Arguments]    ${fieldset_title}    ${fieldset_id}\n+    Click    //article[@id="content"]//button[contains(text(),\'Add New Content Type\xe2\x80\xa6\')]\n+    Type Text    //input[@name="form.widgets.title"]    ${CONTENT_TYPE_NAME}\n+    Focus    //input[@name="form.widgets.id"]\n+    Get Text    //input[@name="form.widgets.id"]    should be    ${CONTENT_TYPE_ID}\n+    Click    //div[contains(@class,"modal-footer")]//button[@id="form-buttons-add"]\n+\n+I add a new field\n+    [Arguments]    ${FIELD_LABEL}     ${FIELD_ID}     ${FIELD_TYPE}\n+    [Documentation]    Add field in current dexterity content type\n+\n+    Click    //a[@id="add-field"]\n+    Type Text    //input[@name="form.widgets.title"]    ${FIELD_LABEL}\n+    Focus    //input[@name="form.widgets.__name__"]\n+    Get Text    //input[@name="form.widgets.__name__"]    should be    ${FIELD_ID}\n+    Get Property   //input[@name="form.widgets.__name__"]    value    should be     ${FIELD_ID}\n+    Get Text    //input[@name="form.widgets.__name__"]    should be    ${FIELD_ID}\n+    Type Text    //textarea[@name="form.widgets.description"]    my description of the field\n+    Select Options By    //select[@name="form.widgets.factory:list"]    label    ${FIELD_TYPE}\n+    Click    //div[contains(@class,"modal-footer")]//button[@id="form-buttons-add"]\n+\n+I add a new fieldset\n+    [Arguments]    ${FIELDSET_LABEL}    ${FIELDSET_ID}\n     [Documentation]    Add fieldset in current dexterity content type\n \n-    Click Link  Add new fieldset\xe2\x80\xa6\n-    Input text for sure  form-widgets-label  ${fieldset_title}\n-    Set Focus to Element  form-widgets-__name__\n-    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  ${fieldset_id}\n-    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n-    Wait overlay is closed\n-    Wait until page contains  ${fieldset_title}\n-\n-Open field settings\n-    [Arguments]    ${field_id}\n-    ${locator}  Set Variable  //div[@data-field_id=\'${field_id}\']//a[contains(@class, \'fieldSettings pat-plone-modal\')]\n-    Wait For Element  xpath=${locator}\n-    Click Overlay Link  xpath=${locator}\n+    Click    //a[@id="add-fieldset"]\n+    Type Text    //input[@name="form.widgets.label"]    ${FIELDSET_LABEL}\n+    Focus    //input[@name="form.widgets.__name__"]\n+    Get Property   //input[@name="form.widgets.__name__"]    value    should be     ${FIELDSET_ID}\n+    Get Text    //input[@name="form.widgets.__name__"]    should be    ${FIELDSET_ID}\n+    Click    //div[contains(@class,"modal-footer")]//button[@id="form-buttons-add"]\n+\n+I configure the language field\n+\n+    Click    //div[@data-field_id="languages"]//a[contains(text(),\'Settings\xe2\x80\xa6\')]\n+    Select Options By    //select[@name="form.widgets.vocabularyName:list"]    value    plone.app.vocabularies.AvailableContentLanguages\n+    Click    //div[contains(@class,"modal-footer")]//button[@id="form-buttons-save"]\n+\n+I configure the hobbies field\n+\n+    Click    //div[@data-field_id="hobbies"]//a[contains(text(),\'Settings\xe2\x80\xa6\')]\n+    Type Text    //textarea[@name="form.widgets.values"]    Chess    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Type Text    //textarea[@name="form.widgets.values"]    Soccer    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Type Text    //textarea[@name="form.widgets.values"]    Baseball    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Type Text    //textarea[@name="form.widgets.values"]    Video games    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Click    //div[contains(@class,"modal-footer")]//button[@id="form-buttons-save"]\n+\n+I configure the hobbies field with wrong values\n+\n+    Click    //div[@data-field_id="hobbies"]//a[contains(text(),\'Settings\xe2\x80\xa6\')]\n+    Type Text    //textarea[@name="form.widgets.values"]    Chess    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Type Text    //textarea[@name="form.widgets.values"]    Soccer    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Type Text    //textarea[@name="form.widgets.values"]    Baseball    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Type Text    //textarea[@name="form.widgets.values"]    Video games    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Select Options By    //select[@name="form.widgets.vocabularyName:list"]    value    plone.app.vocabularies.AvailableContentLanguages\n+    Click    //div[contains(@class,"modal-footer")]//button[@id="form-buttons-save"]\n+\n+I delete field\n+    [Arguments]    ${FIELD_ID}\n+\n+    Handle Future Dialogs    action=accept\n+    Click    //div[@data-field_id="${FIELD_ID}"]//a[@title="Delete field"]\n+\n+# Then\n+\n+the overlay is closed\n+\n+    Get Element Count    //div[contains(@class,"modal-wrapper")]    should be    0\n+\n+the new Content Type is created\n+    [Arguments]        ${CONTENT_TYPE_NAME}\n+\n+    Get Text    //div[@class="crud-form"]/form/table    contains    ${CONTENT_TYPE_NAME}\n+\n+the new Field is created\n+    [Arguments]        ${FIELD_ID}\n+\n+    Get Text    //*[@id="global_statusmessage"]    contains    Field added successfully.\n+    Get Element Count    //div[@data-field_id="${FIELD_ID}"]//a[contains(text(),\'Settings\xe2\x80\xa6\')]    should be    1\n+\n+I see the list of portal languages\n+\n+    Get Element Count    //select[@name="form.widgets.languages:list"]/option    greater than    0\n+\n+I see the list of hobbies\n+\n+    Get Element Count    //select[@name="form.widgets.hobbies:list"]/option    greater than    0\n+\n+I see an errormessage in the dialog\n+\n+    Get Text    //div[contains(@class,"modal-body")]//div[contains(@class,"statusmessage")]    contains    There were some errors.\n+    Get Text    //div[@id="formfield-form-widgets-vocabularyName"]//div[@class="invalid-feedback"]    contains    You can not set a vocabulary name AND vocabulary values. Please clear values field or set no value here.\n+\n+the new fieldset is created\n+    [Arguments]    ${FIELDSET_LABEL}\n+\n+    Get Text    //*[@id="global_statusmessage"]    contains    Fieldset added successfully.\n+    Get Element Count    //form[@id="form"]/fieldset/legend[contains(text(),"${FIELDSET_LABEL}")]    should be    1\n+\n+the field is added to fieldset\n+    [Arguments]    ${FIELDSET_LABEL}    ${FIELD_LABEL}\n+\n+    Get Text    //*[@id="global_statusmessage"]    contains    Field added successfully.\n+    Get Element Count    //form[@id="form"]/fieldset/legend[contains(text(),"${FIELDSET_LABEL}")]/following-sibling::div[@data-field_id="address"]    should be    1\n+\n+the field is removed\n+    [Arguments]    ${FIELD_ID}\n+\n+    Get Element Count    //div[@data-field_id="${FIELD_ID}"]    should be    0\n'

Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2024-09-14T20:26:18+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/plone.schemaeditor/commit/5cac848244324614ed0d7b58c8ac06b12266158f

add news

Files changed:
A news/117.tests

b'diff --git a/news/117.tests b/news/117.tests\nnew file mode 100644\nindex 0000000..c34ba22\n--- /dev/null\n+++ b/news/117.tests\n@@ -0,0 +1 @@\n+port robot tests to use the browser library [@1letter]\n\\ No newline at end of file\n'

Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2024-10-18T15:48:19+02:00
Author: Peter Mathis (petschki) <petschki@users.noreply.github.com>
Commit: https://github.com/plone/plone.schemaeditor/commit/b4e7d3c8c5dec16dd9214813c22a59380c93608f

Merge pull request #118 from plone/port-robot-tests

port robot tests

Files changed:
A dependabot.yml
A news/+meta.internal
A news/117.tests
M .editorconfig
M .flake8
M .github/workflows/meta.yml
M .gitignore
M .meta.toml
M .pre-commit-config.yaml
M plone/schemaeditor/testing.py
M plone/schemaeditor/tests/robot/test_fields.robot
M pyproject.toml
M tox.ini

b'diff --git a/.editorconfig b/.editorconfig\nindex 919b411..5b3c112 100644\n--- a/.editorconfig\n+++ b/.editorconfig\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n #\n # EditorConfig Configuration file, for more details see:\n@@ -13,7 +13,8 @@\n root = true\n \n \n-[*]  # For All Files\n+[*]\n+# Default settings for all files.\n # Unix-style newlines with a newline ending every file\n end_of_line = lf\n insert_final_newline = true\n@@ -29,13 +30,15 @@ max_line_length = off\n # 4 space indentation\n indent_size = 4\n \n-[*.{yml,zpt,pt,dtml,zcml}]\n+[*.{yml,zpt,pt,dtml,zcml,html,xml}]\n # 2 space indentation\n indent_size = 2\n \n-[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss,html}]  # Frontend development\n+[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss}]\n+# Frontend development\n # 2 space indentation\n indent_size = 2\n+max_line_length = 80\n \n [{Makefile,.gitmodules}]\n # Tab indentation (no size specified, but view as 4 spaces)\ndiff --git a/.flake8 b/.flake8\nindex 7ef4f64..38918f4 100644\n--- a/.flake8\n+++ b/.flake8\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [flake8]\n doctests = 1\ndiff --git a/.github/workflows/meta.yml b/.github/workflows/meta.yml\nindex a7f25e0..c9848bc 100644\n--- a/.github/workflows/meta.yml\n+++ b/.github/workflows/meta.yml\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n name: Meta\n on:\n@@ -13,6 +13,16 @@ on:\n       - main\n   workflow_dispatch:\n \n+##\n+# To set environment variables for all jobs, add in .meta.toml:\n+# [github]\n+# env = """\n+#     debug: 1\n+#     image-name: \'org/image\'\n+#     image-tag: \'latest\'\n+# """\n+##\n+\n jobs:\n   qa:\n     uses: plone/meta/.github/workflows/qa.yml@main\n@@ -22,7 +32,44 @@ jobs:\n     uses: plone/meta/.github/workflows/coverage.yml@main\n   dependencies:\n     uses: plone/meta/.github/workflows/dependencies.yml@main\n-  release-ready:\n+  release_ready:\n     uses: plone/meta/.github/workflows/release_ready.yml@main\n   circular:\n     uses: plone/meta/.github/workflows/circular.yml@main\n+\n+##\n+# To modify the list of default jobs being created add in .meta.toml:\n+# [github]\n+# jobs = [\n+#    "qa",\n+#    "test",\n+#    "coverage",\n+#    "dependencies",\n+#    "release_ready",\n+#    "circular",\n+#    ]\n+##\n+\n+##\n+# To request that some OS level dependencies get installed\n+# when running tests/coverage jobs, add in .meta.toml:\n+# [github]\n+# os_dependencies = "git libxml2 libxslt"\n+##\n+\n+##\n+# To test against a specific matrix of python versions\n+# when running tests jobs, add in .meta.toml:\n+# [github]\n+# py_versions = "[\'3.12\', \'3.11\']"\n+##\n+\n+\n+##\n+# Specify additional jobs in .meta.toml:\n+#  [github]\n+#  extra_lines = """\n+#  another:\n+#    uses: org/repo/.github/workflows/file.yml@main\n+#  """\n+##\ndiff --git a/.gitignore b/.gitignore\nindex 81594fd..486392f 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -1,14 +1,18 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n # python related\n *.egg-info\n *.pyc\n *.pyo\n \n+# translation related\n+*.mo\n+\n # tools related\n build/\n .coverage\n+.*project\n coverage.xml\n dist/\n docs/_build\n@@ -31,6 +35,7 @@ lib64\n parts/\n pyvenv.cfg\n var/\n+local.cfg\n \n # mxdev\n /instance/\ndiff --git a/.meta.toml b/.meta.toml\nindex 4ca2970..7470324 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -1,6 +1,6 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [meta]\n template = "default"\n-commit-id = "cfffba8c"\n+commit-id = "5d22fbf8"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex e6f1ee7..f70417d 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n ci:\n     autofix_prs: false\n@@ -75,6 +75,16 @@ repos:\n     hooks:\n     -   id: i18ndude\n \n+\n+##\n+# Add extra configuration options in .meta.toml:\n+#  [pre_commit]\n+#  i18ndude_extra_lines = """\n+#  _your own configuration lines_\n+#  """\n+##\n+\n+\n ##\n # Add extra configuration options in .meta.toml:\n #  [pre_commit]\ndiff --git a/dependabot.yml b/dependabot.yml\nnew file mode 100644\nindex 0000000..bbd3ab0\n--- /dev/null\n+++ b/dependabot.yml\n@@ -0,0 +1,11 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/main/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+version: 2\n+updates:\n+\n+  - package-ecosystem: "github-actions"\n+    directory: "/"\n+    schedule:\n+      # Check for updates to GitHub Actions every week\n+      interval: "weekly"\ndiff --git a/news/+meta.internal b/news/+meta.internal\nnew file mode 100644\nindex 0000000..c08f539\n--- /dev/null\n+++ b/news/+meta.internal\n@@ -0,0 +1,2 @@\n+Update configuration files.\n+[plone devs]\ndiff --git a/news/117.tests b/news/117.tests\nnew file mode 100644\nindex 0000000..c34ba22\n--- /dev/null\n+++ b/news/117.tests\n@@ -0,0 +1 @@\n+port robot tests to use the browser library [@1letter]\n\\ No newline at end of file\ndiff --git a/plone/schemaeditor/testing.py b/plone/schemaeditor/testing.py\nindex 55bb7cf..fac6896 100644\n--- a/plone/schemaeditor/testing.py\n+++ b/plone/schemaeditor/testing.py\n@@ -4,7 +4,7 @@\n from plone.app.testing import FunctionalTesting\n from plone.app.testing import PLONE_FIXTURE\n from plone.app.testing import PloneSandboxLayer\n-from plone.testing import z2\n+from plone.testing.zope import WSGI_SERVER_FIXTURE\n \n \n class PloneSchemaeditorRobotLayer(PloneSandboxLayer):\n@@ -20,7 +20,7 @@ class PloneSchemaeditorRobotLayer(PloneSandboxLayer):\n     bases=(\n         FIXTURE,\n         AUTOLOGIN_LIBRARY_FIXTURE,\n-        z2.ZSERVER_FIXTURE,\n+        WSGI_SERVER_FIXTURE,\n     ),\n     name="ACCEPTANCE",\n )\ndiff --git a/plone/schemaeditor/tests/robot/test_fields.robot b/plone/schemaeditor/tests/robot/test_fields.robot\nindex ed13c2b..db4c6bb 100644\n--- a/plone/schemaeditor/tests/robot/test_fields.robot\n+++ b/plone/schemaeditor/tests/robot/test_fields.robot\n@@ -1,213 +1,251 @@\n *** Settings ***\n \n-Resource  plone/app/robotframework/keywords.robot\n-Resource  plone/app/robotframework/saucelabs.robot\n-Resource  plone/app/robotframework/selenium.robot\n+Resource    plone/app/robotframework/browser.robot\n \n-Library  Remote  ${PLONE_URL}/RobotRemote\n+Library    Remote    ${PLONE_URL}/RobotRemote\n \n-Test Setup  Run Keywords  Plone test setup\n-Test Teardown  Run keywords  Plone test teardown\n+Test Setup    Run Keywords    Plone test setup\n+Test Teardown    Run keywords    Plone test teardown\n \n-*** Variables ***\n-${SELENIUM_TIMEOUT}  20\n \n *** Test Cases ***\n \n-Add a content type\n-\n-    Go to dexterity types configuration\n-    Click Overlay Button  Add New Content Type\xe2\x80\xa6\n-    Input text for sure  form-widgets-title  New style Article\n-    Set Focus to Element  form-widgets-id\n-    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-id  new_style_article\n-    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n-    Wait overlay is closed\n-    Wait until page contains  New style Article\n-\n-\n-Add a choice field with a named vocabulary\n-\n-    Go to dexterity types configuration\n-    Add content type  Curriculum vitae  curriculum_vitae\n-    Click Link  Add new field\xe2\x80\xa6\n-    Input text for sure  form-widgets-title  Languages\n-    Set Focus to Element  form-widgets-__name__\n-    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  languages\n-    Input text for sure  form-widgets-description  Spoken languages\n-    Wait until keyword succeeds  10  1  Select From List By Label  form-widgets-factory  Multiple Choice\n-    Wait until keyword succeeds  10  1  Click button  css=.modal-footer #form-buttons-add\n-    Wait overlay is closed\n-    Wait until page contains element  css=div[data-field_id="languages"] a.fieldSettings\n-\n-    Open field settings  languages\n-    Select from list by value  form-widgets-vocabularyName  plone.app.vocabularies.AvailableContentLanguages\n-    Wait For Then Click Element  css=.modal-footer #form-buttons-save\n-    Wait overlay is closed\n-    Page should contain  Fran\xc3\xa7ais\n-\n-\n-Add a choice field with vocabulary values\n-\n-    Go to dexterity types configuration\n-    Add content type  My page  my_page\n-    Add field  Hobbies  hobbies  Multiple Choice\n-    Open field settings  hobbies\n-    Input text  form-widgets-values  Chess\\nSoccer\\nBaseball\\nVideo games\n-    Wait For Then Click Element  css=.modal-footer #form-buttons-save\n-    Wait overlay is closed\n-    Wait until page contains element  form-widgets-hobbies-3\n-\n-#fail on jenkins\n-#We get an error if we try to select vocabulary name and vocabulary values\n-\n-#    Go to dexterity types configuration\n-#    Add content type  My other page  my_other_page\n-#    Add field  Hobbies  hobbies  Multiple Choice\n-#    Open field settings  hobbies\n-#    Input text  form-widgets-values  Chess\\nSoccer\\nBaseball\\nVideo games\n-#    Select from list by value  form-widgets-vocabularyName  plone.app.vocabularies.AvailableContentLanguages\n-#    Click Button  Save\n-#    Wait until page contains element  css=#formfield-form-widgets-vocabularyName.error\n-#\n-\n-\n-Add accented field\n-\n-    Go to dexterity types configuration\n-    Add content type  Person  person\n-    Click Link  Add new field\xe2\x80\xa6\n-    Input text for sure  form-widgets-title  Pr\xc3\xa9nom\n-    Set Focus to Element  form-widgets-__name__\n-    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  prenom\n-\n-\n-Add a fieldSet and move a field into this fieldset\n-\n-    Go to dexterity types configuration\n-    Add content type  Contact info  contact_info\n-    Add field  Address  address  Text\n-    Add fieldset  Personal information  personal_information\n-\n-#    Mouse Down  xpath=//*[@data-field_id="address"][1]\n-#    Mouse Over  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="1"]\n-#    Mouse Up  xpath=//*[@data-fieldset_drag_id="1"][1]\n-#    Wait Until Keyword Succeeds  10  1  Element should not be visible  css=.fieldPreview[data-field_id="address"]\n-#    Click Element  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="1"]\n-#    Wait Until Keyword Succeeds  10  1  Element should be visible  css=.fieldPreview[data-field_id="address"]\n-\n-\n-Add a fieldSet and add a field into this fieldset\n-\n-    Go to dexterity types configuration\n-    Add content type  Contact info  contact_info\n-    Add fieldset  Personal information  personal_information\n-    Click Element  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="1"]\n-    Add field  Address  address  Text\n-    Click Element  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="0"]\n-    Wait Until Keyword Succeeds  10  1  Element should not be visible  css=.fieldPreview[data-field_id="address"]\n-    Click Element  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="1"]\n-    Wait Until Keyword Succeeds  10  1  Element should be visible  css=.fieldPreview[data-field_id="address"]\n-\n-\n-#Add a fieldSet and add a field into this fieldset\n-#\n-#    Set Window Size  1200  1200\n-#    Go to dexterity types configuration\n-#    Add content type  Contact info  contact_info\n-#    Click Overlay Button  Add new fieldset\xe2\x80\xa6\n-#    Input text for sure  form-widgets-label  Personal information\n-#    Set Focus to Element  form-widgets-__name__\n-#    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  personal_information\n-#    Click button  css=.modal-footer #form-buttons-add\n-#    Wait overlay is closed\n-#    Wait until page contains  Personal information\n-#\n-#    Click Element  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="1"]\n-#    Add field  Address  address  Text\n-#    Click Element  xpath=//form//nav[@class="autotoc-nav"]/a[@data-fieldset_drag_id="1"]\n-#    Wait until page contains element  css=div[data-field_id="address"]\n-\n-\n-Delete field\n-    Go to dexterity types configuration\n-    Add content type  Somebody  somebody\n-    Add field  Phone  phone  Text line (String)\n-    Wait For Element  css=#fieldset-0 #formfield-form-widgets-phone\n-    Click link  css=div.fieldControls .schemaeditor-delete-field\n-    Handle alert\n-    Wait Until Keyword Succeeds  10  1  Page Should Not Contain Element  css=#formfield-form-widgets-phone\n-    # Make sure it actually got deleted\n-    Go to  ${PLONE_URL}/@@dexterity-types/somebody/@@fields\n-    Wait Until Keyword Succeeds  10  1  Page Should Not Contain Element  css=#formfield-form-widgets-phone\n-\n-\n-#~ Reorder field\n-    #~ Log in as site owner\n-    #~ Add content type\n-    #~ Add field  Lastname  lastname  Text line (String)\n-    #~ Wait until page contains element  css=#fieldset-0 #formfield-form-widgets-lastname\n-    #~ Add field  Firstname  firstname  Text line (String)\n-    #~ Wait until page contains element  css=#fieldset-0 #formfield-form-widgets-firstname\n-\n-    #~ /html/body/div/div[2]/div/div[2]/div[2]/div/div/form/fieldset/div[3]/div/span\n-    #~ Mouse Down  xpath=//div[@data-field_id=\'phone\']/div/span[@class=\'draghandle\']\n-    #~ Mouse Over    xpath=//div[@data-field_id=\'firstname\']\n-    #~ Mouse Out   xpath=//div[@data-field_id=\'phone\']/div/span[@class=\'draghandle\']\n+Scenario: Add a content type\n+\n+    Given a site owner\n+     When I go to dexterity types configuration\n+      and I add a new Content Type    New style Article    new_style_article\n+     Then the overlay is closed\n+      and the new Content Type is created    New style Article\n+\n+\n+Scenario: Add a choice field with a named vocabulary\n+\n+    Given a site owner\n+     When I go to dexterity types configuration\n+      and I add a new Content Type    Curriculum vitae    curriculum_vitae\n+      and I go to fields configuration    curriculum_vitae\n+      and I add a new field    Languages    languages    Multiple Choice\n+     Then the overlay is closed\n+      and the new Field is created    languages\n+\n+     When I configure the language field\n+     Then the overlay is closed\n+      and I see the list of portal languages\n+\n+Scenario: Add a choice field with vocabulary values\n+\n+    Given a site owner\n+     When I go to dexterity types configuration\n+      and I add a new Content Type    My page    my_page\n+      and I go to fields configuration    my_page\n+      and I add a new field    Hobbies    hobbies    Multiple Choice\n+     Then the overlay is closed\n+      and the new Field is created    hobbies\n+\n+     When I configure the hobbies field\n+     Then the overlay is closed\n+      and I see the list of hobbies\n+\n+Scenario: Try to add a choice field with a named vocabulary and vocabulary values\n+\n+    Given a site owner\n+     When I go to dexterity types configuration\n+      and I add a new Content Type    My other page    my_other_page\n+      and I go to fields configuration    my_other_page\n+      and I add a new field    Hobbies    hobbies    Multiple Choice\n+      and I configure the hobbies field with wrong values\n+     Then I see an errormessage in the dialog\n+\n+Scenario: Add accented field\n+\n+    Given a site owner\n+     When I go to dexterity types configuration\n+      and I add a new Content Type    Person    person\n+      and I go to fields configuration    person\n+      and I add a new field    Pr\xc3\xa9nom    prenom    Text line (String)\n+     Then the overlay is closed\n+      and the new Field is created    prenom\n+\n+Scenario: Add a fieldSet and move a field into this fieldset\n+\n+    Given a site owner\n+    When I go to dexterity types configuration\n+     and I add a new Content Type    Contact info    contact_info\n+     and I go to fields configuration    contact_info\n+     and I add a new field    Address    address    Text\n+     and I add a new fieldset    Personal information    personal_information\n+    Then the overlay is closed\n+     and the new fieldset is created    Personal information\n+\n+Scenario: Add a fieldSet and add a field into this fieldset\n+\n+    Given a site owner\n+    When I go to dexterity types configuration\n+     and I add a new Content Type    Contact info    contact_info\n+     and I go to fields configuration    contact_info\n+     and I add a new fieldset    Personal information    personal_information\n+     and I got to fieldset    Personal information\n+     and I add a new field    Address    address    Text\n+    Then the field is added to fieldset    Personal information    Address\n+\n+Scenario: Delete field\n+\n+    Given a site owner\n+    When I go to dexterity types configuration\n+     and I add a new Content Type    Somebody    somebody\n+     and I go to fields configuration    somebody\n+     and I add a new field    Phone    phone    Text line (String)\n+    Then the overlay is closed\n+     and the new Field is created    phone\n+\n+    When I delete field    phone\n+    Then the field is removed    phone\n \n \n *** Keywords ***\n \n-Wait overlay is closed\n-    Wait until keyword succeeds  8  1  Page should not contain element  css=div.modal-wrapper\n-\n-Go to dexterity types configuration\n-    Enable autologin as  Manager\n-    Go to  ${PLONE_URL}/@@dexterity-types\n-\n-Add content type\n-    [Arguments]    ${title}    ${id}\n-    [Documentation]    Add a dexterity content type\n-\n-    Click Overlay Button  Add New Content Type\xe2\x80\xa6\n-    Input text for sure  form-widgets-title  ${title}\n-    Set Focus to Element  form-widgets-id\n-    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-id  ${id}\n-    # Far too often, the overlay is not closed after clicking the add-button.\n-    # Maybe some sleep helps.  Never nice to do, but better than having developers lose sleep.\n-    Sleep  0.1\n-    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n-    Wait overlay is closed\n-    Wait until page contains  ${title}\n-    Go to  ${PLONE_URL}/@@dexterity-types/${id}/@@fields\n-    Wait until page contains  Fields\n-\n-Add field\n-    [Arguments]    ${field_title}    ${field_id}    ${field_type}\n-    [Documentation]    Add field in current dexterity content type\n+# Given\n+\n+a site owner\n+\n+    Enable autologin as    Manager\n+\n+# When\n+\n+I go to dexterity types configuration\n+\n+    Go to    ${PLONE_URL}/@@dexterity-types\n+\n+I go to fields configuration\n+    [Arguments]    ${CONTENT_TYPE_ID}\n+\n+    Click    //a[contains(@class, "contenttype-${CONTENT_TYPE_ID}")]\n+    Click    //a[contains(@href,"/${CONTENT_TYPE_ID}/@@fields")]\n+\n+I got to fieldset\n+    [Arguments]    ${FIELD_LABEL}\n+\n+    Click    //nav[@class="autotoc-nav"]/a[contains(text(),"${FIELD_LABEL}")]\n+\n \n-    Click Link  Add new field\xe2\x80\xa6\n-    Input text for sure  form-widgets-title  ${field_title}\n-    Set Focus to Element  form-widgets-__name__\n-    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  ${field_id}\n-    Select from list by label  form-widgets-factory  ${field_type}\n-    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n-    Wait overlay is closed\n+I add a new Content Type\n+    [Arguments]    ${CONTENT_TYPE_NAME}    ${CONTENT_TYPE_ID}\n+    [Documentation]    Add a new dexterity content type\n \n-Add fieldset\n-    [Arguments]    ${fieldset_title}    ${fieldset_id}\n+    Click    //article[@id="content"]//button[contains(text(),\'Add New Content Type\xe2\x80\xa6\')]\n+    Type Text    //input[@name="form.widgets.title"]    ${CONTENT_TYPE_NAME}\n+    Focus    //input[@name="form.widgets.id"]\n+    Get Text    //input[@name="form.widgets.id"]    should be    ${CONTENT_TYPE_ID}\n+    Click    //div[contains(@class,"modal-footer")]//button[@id="form-buttons-add"]\n+\n+I add a new field\n+    [Arguments]    ${FIELD_LABEL}     ${FIELD_ID}     ${FIELD_TYPE}\n+    [Documentation]    Add field in current dexterity content type\n+\n+    Click    //a[@id="add-field"]\n+    Type Text    //input[@name="form.widgets.title"]    ${FIELD_LABEL}\n+    Focus    //input[@name="form.widgets.__name__"]\n+    Get Text    //input[@name="form.widgets.__name__"]    should be    ${FIELD_ID}\n+    Get Property   //input[@name="form.widgets.__name__"]    value    should be     ${FIELD_ID}\n+    Get Text    //input[@name="form.widgets.__name__"]    should be    ${FIELD_ID}\n+    Type Text    //textarea[@name="form.widgets.description"]    my description of the field\n+    Select Options By    //select[@name="form.widgets.factory:list"]    label    ${FIELD_TYPE}\n+    Click    //div[contains(@class,"modal-footer")]//button[@id="form-buttons-add"]\n+\n+I add a new fieldset\n+    [Arguments]    ${FIELDSET_LABEL}    ${FIELDSET_ID}\n     [Documentation]    Add fieldset in current dexterity content type\n \n-    Click Link  Add new fieldset\xe2\x80\xa6\n-    Input text for sure  form-widgets-label  ${fieldset_title}\n-    Set Focus to Element  form-widgets-__name__\n-    Wait until keyword succeeds  10  1  Textfield Value Should Be  form-widgets-__name__  ${fieldset_id}\n-    Wait For Then Click Element  css=.modal-footer #form-buttons-add\n-    Wait overlay is closed\n-    Wait until page contains  ${fieldset_title}\n-\n-Open field settings\n-    [Arguments]    ${field_id}\n-    ${locator}  Set Variable  //div[@data-field_id=\'${field_id}\']//a[contains(@class, \'fieldSettings pat-plone-modal\')]\n-    Wait For Element  xpath=${locator}\n-    Click Overlay Link  xpath=${locator}\n+    Click    //a[@id="add-fieldset"]\n+    Type Text    //input[@name="form.widgets.label"]    ${FIELDSET_LABEL}\n+    Focus    //input[@name="form.widgets.__name__"]\n+    Get Property   //input[@name="form.widgets.__name__"]    value    should be     ${FIELDSET_ID}\n+    Get Text    //input[@name="form.widgets.__name__"]    should be    ${FIELDSET_ID}\n+    Click    //div[contains(@class,"modal-footer")]//button[@id="form-buttons-add"]\n+\n+I configure the language field\n+\n+    Click    //div[@data-field_id="languages"]//a[contains(text(),\'Settings\xe2\x80\xa6\')]\n+    Select Options By    //select[@name="form.widgets.vocabularyName:list"]    value    plone.app.vocabularies.AvailableContentLanguages\n+    Click    //div[contains(@class,"modal-footer")]//button[@id="form-buttons-save"]\n+\n+I configure the hobbies field\n+\n+    Click    //div[@data-field_id="hobbies"]//a[contains(text(),\'Settings\xe2\x80\xa6\')]\n+    Type Text    //textarea[@name="form.widgets.values"]    Chess    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Type Text    //textarea[@name="form.widgets.values"]    Soccer    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Type Text    //textarea[@name="form.widgets.values"]    Baseball    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Type Text    //textarea[@name="form.widgets.values"]    Video games    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Click    //div[contains(@class,"modal-footer")]//button[@id="form-buttons-save"]\n+\n+I configure the hobbies field with wrong values\n+\n+    Click    //div[@data-field_id="hobbies"]//a[contains(text(),\'Settings\xe2\x80\xa6\')]\n+    Type Text    //textarea[@name="form.widgets.values"]    Chess    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Type Text    //textarea[@name="form.widgets.values"]    Soccer    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Type Text    //textarea[@name="form.widgets.values"]    Baseball    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Type Text    //textarea[@name="form.widgets.values"]    Video games    clear=False\n+    Press Keys    //textarea[@name="form.widgets.values"]    Enter\n+    Select Options By    //select[@name="form.widgets.vocabularyName:list"]    value    plone.app.vocabularies.AvailableContentLanguages\n+    Click    //div[contains(@class,"modal-footer")]//button[@id="form-buttons-save"]\n+\n+I delete field\n+    [Arguments]    ${FIELD_ID}\n+\n+    Handle Future Dialogs    action=accept\n+    Click    //div[@data-field_id="${FIELD_ID}"]//a[@title="Delete field"]\n+\n+# Then\n+\n+the overlay is closed\n+\n+    Get Element Count    //div[contains(@class,"modal-wrapper")]    should be    0\n+\n+the new Content Type is created\n+    [Arguments]        ${CONTENT_TYPE_NAME}\n+\n+    Get Text    //div[@class="crud-form"]/form/table    contains    ${CONTENT_TYPE_NAME}\n+\n+the new Field is created\n+    [Arguments]        ${FIELD_ID}\n+\n+    Get Text    //*[@id="global_statusmessage"]    contains    Field added successfully.\n+    Get Element Count    //div[@data-field_id="${FIELD_ID}"]//a[contains(text(),\'Settings\xe2\x80\xa6\')]    should be    1\n+\n+I see the list of portal languages\n+\n+    Get Element Count    //select[@name="form.widgets.languages:list"]/option    greater than    0\n+\n+I see the list of hobbies\n+\n+    Get Element Count    //select[@name="form.widgets.hobbies:list"]/option    greater than    0\n+\n+I see an errormessage in the dialog\n+\n+    Get Text    //div[contains(@class,"modal-body")]//div[contains(@class,"statusmessage")]    contains    There were some errors.\n+    Get Text    //div[@id="formfield-form-widgets-vocabularyName"]//div[@class="invalid-feedback"]    contains    You can not set a vocabulary name AND vocabulary values. Please clear values field or set no value here.\n+\n+the new fieldset is created\n+    [Arguments]    ${FIELDSET_LABEL}\n+\n+    Get Text    //*[@id="global_statusmessage"]    contains    Fieldset added successfully.\n+    Get Element Count    //form[@id="form"]/fieldset/legend[contains(text(),"${FIELDSET_LABEL}")]    should be    1\n+\n+the field is added to fieldset\n+    [Arguments]    ${FIELDSET_LABEL}    ${FIELD_LABEL}\n+\n+    Get Text    //*[@id="global_statusmessage"]    contains    Field added successfully.\n+    Get Element Count    //form[@id="form"]/fieldset/legend[contains(text(),"${FIELDSET_LABEL}")]/following-sibling::div[@data-field_id="address"]    should be    1\n+\n+the field is removed\n+    [Arguments]    ${FIELD_ID}\n+\n+    Get Element Count    //div[@data-field_id="${FIELD_ID}"]    should be    0\ndiff --git a/pyproject.toml b/pyproject.toml\nindex e442bd0..66b2322 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,6 +1,9 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n+[build-system]\n+requires = ["setuptools>=68.2"]\n+\n [tool.towncrier]\n directory = "news/"\n filename = "CHANGES.rst"\n@@ -68,7 +71,7 @@ target-version = ["py38"]\n ##\n \n [tool.codespell]\n-ignore-words-list = "discreet,"\n+ignore-words-list = "discreet,assertin,"\n skip = "*.po,"\n ##\n # Add extra configuration options in .meta.toml:\n@@ -116,6 +119,7 @@ Zope = [\n   \'Products.CMFCore\', \'Products.CMFDynamicViewFTI\',\n ]\n python-dateutil = [\'dateutil\']\n+pytest-plone = [\'pytest\', \'zope.pytestlayer\', \'plone.testing\', \'plone.app.testing\']\n \n ##\n # Add extra configuration options in .meta.toml:\n@@ -125,19 +129,20 @@ python-dateutil = [\'dateutil\']\n #    "gitpython = [\'git\']",\n #    "pygithub = [\'github\']",\n #  ]\n-#  """\n ##\n \n [tool.check-manifest]\n ignore = [\n     ".editorconfig",\n+    ".flake8",\n     ".meta.toml",\n     ".pre-commit-config.yaml",\n-    "tox.ini",\n-    ".flake8",\n+    "dependabot.yml",\n     "mx.ini",\n+    "tox.ini",\n \n ]\n+\n ##\n # Add extra configuration options in .meta.toml:\n #  [pyproject]\n@@ -145,6 +150,11 @@ ignore = [\n #      "*.map.js",\n #      "*.pyc",\n #  """\n+#  check_manifest_extra_lines = """\n+#  ignore-bad-ideas = [\n+#      "some/test/file/PKG-INFO",\n+#  ]\n+#  """\n ##\n \n \ndiff --git a/tox.ini b/tox.ini\nindex 21a648b..ee3baeb 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [tox]\n # We need 4.4.0 for constrain_package_deps.\n@@ -32,6 +32,21 @@ commands =\n     echo "Unrecognized environment name {envname}"\n     false\n \n+##\n+# Add extra configuration options in .meta.toml:\n+#  [tox]\n+#  testenv_options = """\n+#  basepython = /usr/bin/python3.8\n+#  """\n+##\n+\n+[testenv:init]\n+description = Prepare environment\n+skip_install = true\n+commands =\n+    echo "Initial setup complete"\n+\n+\n [testenv:format]\n description = automatically reformat code\n skip_install = true\n@@ -56,9 +71,9 @@ description = check if the package defines all its dependencies\n skip_install = true\n deps =\n     build\n-    z3c.dependencychecker==2.11\n+    z3c.dependencychecker==2.14.3\n commands =\n-    python -m build --sdist --no-isolation\n+    python -m build --sdist\n     dependencychecker\n \n [testenv:dependencies-graph]\n@@ -86,16 +101,26 @@ set_env =\n #  test_environment_variables = """\n #      PIP_EXTRA_INDEX_URL=https://my-pypi.my-server.com/\n #  """\n+#\n+# Set constrain_package_deps .meta.toml:\n+#  [tox]\n+#  constrain_package_deps = "false"\n ##\n deps =\n     zope.testrunner\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+\n ##\n+# Specify additional deps in .meta.toml:\n+#  [tox]\n+#  test_deps_additional = "-esources/plonegovbr.portal_base[test]"\n+#\n # Specify a custom constraints file in .meta.toml:\n #  [tox]\n #  constraints_file = "https://my-server.com/constraints.txt"\n ##\n commands =\n+    rfbrowser init\n     zope-testrunner --all --test-path={toxinidir} -s plone.schemaeditor {posargs}\n extras =\n     test\n@@ -128,10 +153,13 @@ deps =\n     coverage\n     zope.testrunner\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+\n commands =\n+    rfbrowser init\n     coverage run --branch --source plone.schemaeditor {envbindir}/zope-testrunner --quiet --all --test-path={toxinidir} -s plone.schemaeditor {posargs}\n     coverage report -m --format markdown\n     coverage xml\n+    coverage html\n extras =\n     test\n \n@@ -144,18 +172,22 @@ deps =\n     build\n     towncrier\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+\n commands =\n     # fake version to not have to install the package\n     # we build the change log as news entries might break\n     # the README that is displayed on PyPI\n     towncrier build --version=100.0.0 --yes\n-    python -m build --sdist --no-isolation\n+    python -m build --sdist\n     twine check dist/*\n \n [testenv:circular]\n description = ensure there are no cyclic dependencies\n use_develop = true\n skip_install = false\n+# Here we must always constrain the package deps to what is already installed,\n+# otherwise we simply get the latest from PyPI, which may not work.\n+constrain_package_deps = true\n set_env =\n \n ##\n@@ -171,6 +203,7 @@ deps =\n     pipdeptree\n     pipforester\n     -c https://dist.plone.org/release/6.0-dev/constraints.txt\n+\n commands =\n     # Generate the full dependency tree\n     sh -c \'pipdeptree -j > forest.json\'\n'

