Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2023-04-28T19:03:26+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/1278adbbd1dc1a57421572656facde40bd0082e2

use plone.base

Files changed:
M plone/app/dexterity/behaviors/configure.zcml

b'diff --git a/plone/app/dexterity/behaviors/configure.zcml b/plone/app/dexterity/behaviors/configure.zcml\nindex d2eae5ae..c28738fe 100644\n--- a/plone/app/dexterity/behaviors/configure.zcml\n+++ b/plone/app/dexterity/behaviors/configure.zcml\n@@ -82,7 +82,7 @@\n       name="plone.navigationroot"\n       title="Navigation root"\n       description="Make all items of this type a navigation root"\n-      provides="plone.app.layout.navigation.interfaces.INavigationRoot"\n+      provides="plone.base.interfaces.INavigationRoot"\n       />\n \n   <!-- Exclude from navigation -->\n'

Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2023-04-28T19:04:49+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/6b241c4704325ccec35ef4ae3beffcd295a8eaa1

move nextprevious provider interface to here

Files changed:
M plone/app/dexterity/behaviors/nextprevious.py
M plone/app/dexterity/tests/test_nextprevious.py

b'diff --git a/plone/app/dexterity/behaviors/nextprevious.py b/plone/app/dexterity/behaviors/nextprevious.py\nindex 0304a1d0..ccfb3604 100644\n--- a/plone/app/dexterity/behaviors/nextprevious.py\n+++ b/plone/app/dexterity/behaviors/nextprevious.py\n@@ -1,7 +1,6 @@\n from AccessControl import getSecurityManager\n from Acquisition import aq_base\n from plone.app.dexterity import _\n-from plone.app.layout.nextprevious.interfaces import INextPreviousProvider\n from plone.autoform import directives\n from plone.autoform.interfaces import IFormFieldProvider\n from plone.registry.interfaces import IRegistry\n@@ -121,6 +120,31 @@ def getData(self, obj):\n         )\n \n \n+class INextPreviousProvider(Interface):\n+    """A folderish component capable of describing the next and previous\n+    item relative to a particular id.\n+    """\n+\n+    enabled = schema.Bool(title="True if next/previous behaviour is enabled")\n+\n+    def getNextItem(obj):\n+        """Returns information about next item in the container relative to\n+        the given object.\n+\n+        This is a dict with the following keys:\n+\n+            - id, the id of the object\n+            - url, the url of the object\n+            - title, the title of the object\n+            - description, a description of the object\n+            - portal_type, the object\'s portal type\n+        """\n+\n+    def getPreviousItem(obj):\n+        """Returns the previous item in the container relative to the given\n+        object\n+        """\n+\n @implementer(INextPreviousProvider)\n @adapter(INextPreviousToggle)\n class NextPreviousToggle(NextPreviousBase):\ndiff --git a/plone/app/dexterity/tests/test_nextprevious.py b/plone/app/dexterity/tests/test_nextprevious.py\nindex 6ec7ae1b..f56954b3 100644\n--- a/plone/app/dexterity/tests/test_nextprevious.py\n+++ b/plone/app/dexterity/tests/test_nextprevious.py\n@@ -1,5 +1,5 @@\n+from ..behaviors.nextprevious import INextPreviousProvider\n from plone.app.dexterity.testing import DEXTERITY_INTEGRATION_TESTING\n-from plone.app.layout.nextprevious.interfaces import INextPreviousProvider\n from plone.app.testing import login\n from plone.app.testing import logout\n from plone.app.testing import setRoles\n'

Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2023-04-28T19:14:07+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/d05a1ed37bcdcaf9510e93f72b69c3e1e0c76a9d

fix circular dependency -&gt; Move defaultpage warning to plone.app.layout

Files changed:
M plone/app/dexterity/browser/configure.zcml
D plone/app/dexterity/browser/default_page_warning.pt

b'diff --git a/plone/app/dexterity/browser/configure.zcml b/plone/app/dexterity/browser/configure.zcml\nindex db6783d8..1f07a56e 100644\n--- a/plone/app/dexterity/browser/configure.zcml\n+++ b/plone/app/dexterity/browser/configure.zcml\n@@ -38,15 +38,6 @@\n       permission="zope2.View"\n       />\n \n-  <!-- warning when editing default pages -->\n-  <browser:viewlet\n-      name="plone.app.dexterity.defaultpagewarning"\n-      view="plone.dexterity.interfaces.IDexterityEditForm"\n-      manager="plone.app.layout.viewlets.interfaces.IGlobalStatusMessage"\n-      template="default_page_warning.pt"\n-      permission="cmf.ModifyPortalContent"\n-      />\n-\n   <!-- Control panel -->\n \n   <browser:page\ndiff --git a/plone/app/dexterity/browser/default_page_warning.pt b/plone/app/dexterity/browser/default_page_warning.pt\ndeleted file mode 100644\nindex 0abe135a..00000000\n--- a/plone/app/dexterity/browser/default_page_warning.pt\n+++ /dev/null\n@@ -1,19 +0,0 @@\n-<tal:info xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-          i18n:domain="plone"\n->\n-  <div class="alert alert-info"\n-       role="alert"\n-       tal:condition="context/@@plone_context_state/is_default_page|nothing"\n-  >\n-    <span i18n:translate="label_edit_default_view_container">\n-      You are editing the default view of a container. If you wanted to edit the container itself,\n-      <a href=""\n-         tal:attributes="\n-           href string:${context/aq_inner/aq_parent/absolute_url}/edit;\n-         "\n-         i18n:name="go_here"\n-         i18n:translate="label_edit_default_view_container_go_here"\n-      >go here</a>.\n-    </span>\n-  </div>\n-</tal:info>\n'

Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2023-04-28T19:15:47+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/4fe618b326cf953ed5d9b7f7e821ebec2bbfb4e8

document changes

Files changed:
A news/fix-circular-dep-palayout.bugfix

b'diff --git a/news/fix-circular-dep-palayout.bugfix b/news/fix-circular-dep-palayout.bugfix\nnew file mode 100644\nindex 00000000..9a561523\n--- /dev/null\n+++ b/news/fix-circular-dep-palayout.bugfix\n@@ -0,0 +1,5 @@\n+Fix transitive circular dependency on `plone.app.layout`.\n+Use moved imports in `plone.base`.\n+Move `plone.app.layout.nextprevious.interfaces.INextPreviousProvider` to `.behaviors.nextprevious`.\n+Move defaultpage warning viewlet to `plone.app.layout`.\n+[@jensens]\n\\ No newline at end of file\n'

Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2023-04-28T17:29:08Z
Author: pre-commit-ci[bot] (pre-commit-ci[bot]) <66853113+pre-commit-ci[bot]@users.noreply.github.com>
Commit: https://github.com/plone/plone.app.dexterity/commit/314d23181bde2f073336e38a2f625f30395f0bb3

[pre-commit.ci] auto fixes from pre-commit.com hooks

for more information, see https://pre-commit.ci

Files changed:
M plone/app/dexterity/behaviors/nextprevious.py

b'diff --git a/plone/app/dexterity/behaviors/nextprevious.py b/plone/app/dexterity/behaviors/nextprevious.py\nindex ccfb360..f3f86b3 100644\n--- a/plone/app/dexterity/behaviors/nextprevious.py\n+++ b/plone/app/dexterity/behaviors/nextprevious.py\n@@ -145,6 +145,7 @@ def getPreviousItem(obj):\n         object\n         """\n \n+\n @implementer(INextPreviousProvider)\n @adapter(INextPreviousToggle)\n class NextPreviousToggle(NextPreviousBase):\n'

Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2023-05-17T16:36:07+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/ee5d814b77fa030cb6368bba594c0104656f9692

Merge branch 'master' into fix-circular-dep-palayout

Files changed:
M .pre-commit-config.yaml
M CHANGES.rst
M setup.py
D news/363.feature

b'diff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex fdafec1..f9cdf5c 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -6,7 +6,7 @@ ci:\n \n repos:\n -   repo: https://github.com/asottile/pyupgrade\n-    rev: v3.3.1\n+    rev: v3.3.2\n     hooks:\n     -   id: pyupgrade\n         args: [--py38-plus]\n@@ -19,7 +19,7 @@ repos:\n     hooks:\n     -   id: black\n -   repo: https://github.com/collective/zpretty\n-    rev: 3.0.3\n+    rev: 3.0.4\n     hooks:\n     -   id: zpretty\n -   repo: https://github.com/PyCQA/flake8\ndiff --git a/CHANGES.rst b/CHANGES.rst\nindex eff271a..747d890 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -8,6 +8,15 @@ Changelog\n \n .. towncrier release notes start\n \n+3.1.0 (2023-05-08)\n+------------------\n+\n+New features:\n+\n+\n+- Content types control panel: Show behavior name and interface. @ksuess, @stevepiercy (#363)\n+\n+\n 3.0.5 (2023-04-14)\n ------------------\n \ndiff --git a/news/363.feature b/news/363.feature\ndeleted file mode 100644\nindex fe7697f..0000000\n--- a/news/363.feature\n+++ /dev/null\n@@ -1 +0,0 @@\n-Content types control panel: Show behavior name and interface. @ksuess, @stevepiercy\n\\ No newline at end of file\ndiff --git a/setup.py b/setup.py\nindex a05d592..16a0875 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -2,7 +2,7 @@\n from setuptools import setup\n \n \n-version = "3.0.6.dev0"\n+version = "3.1.1.dev0"\n \n short_description = (\n     "Dexterity is a content type framework for CMF  applications, "\n'

Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2023-05-18T10:23:05+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/3999d8617ae826c60aac8b6d4432c04617d00ab2

Merge pull request #367 from plone/fix-circular-dep-palayout

Fix circular dependency on plone.app.layout

Files changed:
A news/fix-circular-dep-palayout.bugfix
M plone/app/dexterity/behaviors/configure.zcml
M plone/app/dexterity/behaviors/nextprevious.py
M plone/app/dexterity/browser/configure.zcml
M plone/app/dexterity/tests/test_nextprevious.py
D plone/app/dexterity/browser/default_page_warning.pt

b'diff --git a/news/fix-circular-dep-palayout.bugfix b/news/fix-circular-dep-palayout.bugfix\nnew file mode 100644\nindex 00000000..9a561523\n--- /dev/null\n+++ b/news/fix-circular-dep-palayout.bugfix\n@@ -0,0 +1,5 @@\n+Fix transitive circular dependency on `plone.app.layout`.\n+Use moved imports in `plone.base`.\n+Move `plone.app.layout.nextprevious.interfaces.INextPreviousProvider` to `.behaviors.nextprevious`.\n+Move defaultpage warning viewlet to `plone.app.layout`.\n+[@jensens]\n\\ No newline at end of file\ndiff --git a/plone/app/dexterity/behaviors/configure.zcml b/plone/app/dexterity/behaviors/configure.zcml\nindex d2eae5ae..c28738fe 100644\n--- a/plone/app/dexterity/behaviors/configure.zcml\n+++ b/plone/app/dexterity/behaviors/configure.zcml\n@@ -82,7 +82,7 @@\n       name="plone.navigationroot"\n       title="Navigation root"\n       description="Make all items of this type a navigation root"\n-      provides="plone.app.layout.navigation.interfaces.INavigationRoot"\n+      provides="plone.base.interfaces.INavigationRoot"\n       />\n \n   <!-- Exclude from navigation -->\ndiff --git a/plone/app/dexterity/behaviors/nextprevious.py b/plone/app/dexterity/behaviors/nextprevious.py\nindex 0304a1d0..f3f86b36 100644\n--- a/plone/app/dexterity/behaviors/nextprevious.py\n+++ b/plone/app/dexterity/behaviors/nextprevious.py\n@@ -1,7 +1,6 @@\n from AccessControl import getSecurityManager\n from Acquisition import aq_base\n from plone.app.dexterity import _\n-from plone.app.layout.nextprevious.interfaces import INextPreviousProvider\n from plone.autoform import directives\n from plone.autoform.interfaces import IFormFieldProvider\n from plone.registry.interfaces import IRegistry\n@@ -121,6 +120,32 @@ def getData(self, obj):\n         )\n \n \n+class INextPreviousProvider(Interface):\n+    """A folderish component capable of describing the next and previous\n+    item relative to a particular id.\n+    """\n+\n+    enabled = schema.Bool(title="True if next/previous behaviour is enabled")\n+\n+    def getNextItem(obj):\n+        """Returns information about next item in the container relative to\n+        the given object.\n+\n+        This is a dict with the following keys:\n+\n+            - id, the id of the object\n+            - url, the url of the object\n+            - title, the title of the object\n+            - description, a description of the object\n+            - portal_type, the object\'s portal type\n+        """\n+\n+    def getPreviousItem(obj):\n+        """Returns the previous item in the container relative to the given\n+        object\n+        """\n+\n+\n @implementer(INextPreviousProvider)\n @adapter(INextPreviousToggle)\n class NextPreviousToggle(NextPreviousBase):\ndiff --git a/plone/app/dexterity/browser/configure.zcml b/plone/app/dexterity/browser/configure.zcml\nindex db6783d8..1f07a56e 100644\n--- a/plone/app/dexterity/browser/configure.zcml\n+++ b/plone/app/dexterity/browser/configure.zcml\n@@ -38,15 +38,6 @@\n       permission="zope2.View"\n       />\n \n-  <!-- warning when editing default pages -->\n-  <browser:viewlet\n-      name="plone.app.dexterity.defaultpagewarning"\n-      view="plone.dexterity.interfaces.IDexterityEditForm"\n-      manager="plone.app.layout.viewlets.interfaces.IGlobalStatusMessage"\n-      template="default_page_warning.pt"\n-      permission="cmf.ModifyPortalContent"\n-      />\n-\n   <!-- Control panel -->\n \n   <browser:page\ndiff --git a/plone/app/dexterity/browser/default_page_warning.pt b/plone/app/dexterity/browser/default_page_warning.pt\ndeleted file mode 100644\nindex 0abe135a..00000000\n--- a/plone/app/dexterity/browser/default_page_warning.pt\n+++ /dev/null\n@@ -1,19 +0,0 @@\n-<tal:info xmlns:i18n="http://xml.zope.org/namespaces/i18n"\n-          i18n:domain="plone"\n->\n-  <div class="alert alert-info"\n-       role="alert"\n-       tal:condition="context/@@plone_context_state/is_default_page|nothing"\n-  >\n-    <span i18n:translate="label_edit_default_view_container">\n-      You are editing the default view of a container. If you wanted to edit the container itself,\n-      <a href=""\n-         tal:attributes="\n-           href string:${context/aq_inner/aq_parent/absolute_url}/edit;\n-         "\n-         i18n:name="go_here"\n-         i18n:translate="label_edit_default_view_container_go_here"\n-      >go here</a>.\n-    </span>\n-  </div>\n-</tal:info>\ndiff --git a/plone/app/dexterity/tests/test_nextprevious.py b/plone/app/dexterity/tests/test_nextprevious.py\nindex 6ec7ae1b..f56954b3 100644\n--- a/plone/app/dexterity/tests/test_nextprevious.py\n+++ b/plone/app/dexterity/tests/test_nextprevious.py\n@@ -1,5 +1,5 @@\n+from ..behaviors.nextprevious import INextPreviousProvider\n from plone.app.dexterity.testing import DEXTERITY_INTEGRATION_TESTING\n-from plone.app.layout.nextprevious.interfaces import INextPreviousProvider\n from plone.app.testing import login\n from plone.app.testing import logout\n from plone.app.testing import setRoles\n'

