Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2024-03-14T21:25:17+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/c52dd4ec423f06e851830687c8e446cc14387451

Add support for the "accept" attribute on file inputs.

If the widget's field - if there is one - has the "accept" attribute set (the
`NamedImage` field has `image/*` set by default) then this is rendered as an
`accept` attribute on the file input.

This would restrict the allowed file types before uploading while still being
checked on the server side.

Fixes: https://github.com/plone/plone.formwidget.namedfile/issues/66
Depends on:
- https://github.com/plone/plone.namedfile/pull/158
- https://github.com/plone/plone.formwidget.namedfile/pull/67

Files changed:
A news/198.feature
M plone/app/z3cform/templates/file_input.pt
M plone/app/z3cform/templates/image_input.pt
M setup.py

b'diff --git a/news/198.feature b/news/198.feature\nnew file mode 100644\nindex 00000000..1d722dc4\n--- /dev/null\n+++ b/news/198.feature\n@@ -0,0 +1,14 @@\n+Add support for the "accept" attribute on file inputs.\n+\n+If the widget\'s field - if there is one - has the "accept" attribute set (the\n+`NamedImage` field has `image/*` set by default) then this is rendered as an\n+`accept` attribute on the file input.\n+\n+This would restrict the allowed file types before uploading while still being\n+checked on the server side.\n+\n+Fixes: https://github.com/plone/plone.formwidget.namedfile/issues/66\n+Depends on:\n+- https://github.com/plone/plone.namedfile/pull/158\n+- https://github.com/plone/plone.formwidget.namedfile/pull/67\n+[thet]\ndiff --git a/plone/app/z3cform/templates/file_input.pt b/plone/app/z3cform/templates/file_input.pt\nindex 14bd91a5..5df43142 100644\n--- a/plone/app/z3cform/templates/file_input.pt\n+++ b/plone/app/z3cform/templates/file_input.pt\n@@ -90,6 +90,7 @@\n \n   <input class="form-control ${python:view.error and \'is-invalid\' or \'\'}"\n          id="${view/id}-input"\n+         accept="${view/accept}"\n          disabled="${view/disabled}"\n          maxlength="${view/maxlength}"\n          name="${view/name}"\ndiff --git a/plone/app/z3cform/templates/image_input.pt b/plone/app/z3cform/templates/image_input.pt\nindex 3820e377..82546b5b 100644\n--- a/plone/app/z3cform/templates/image_input.pt\n+++ b/plone/app/z3cform/templates/image_input.pt\n@@ -94,6 +94,7 @@\n \n   <input class="form-control ${python:view.error and \'is-invalid\' or \'\'}"\n          id="${view/id}-input"\n+         accept="${view/accept}"\n          disabled="${view/disabled}"\n          maxlength="${view/maxlength}"\n          name="${view/name}"\ndiff --git a/setup.py b/setup.py\nindex 4ead065a..1af931c4 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -62,6 +62,7 @@\n         "plone.app.textfield>=1.3.6",\n         "plone.base",\n         "plone.app.contentlisting",\n+        "plone.formwidget.namedfile>3.0.3",\n         "plone.i18n",\n         "plone.protect",\n         "plone.registry",\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2024-03-14T23:02:39+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/c6e1d78a2ee4b27f0bc3dea87873122511ca31ed

file input: Show accepted media types.

Files changed:
M plone/app/z3cform/templates/file_input.pt
M plone/app/z3cform/templates/image_input.pt

b'diff --git a/plone/app/z3cform/templates/file_input.pt b/plone/app/z3cform/templates/file_input.pt\nindex 5df4314..6a4fa65 100644\n--- a/plone/app/z3cform/templates/file_input.pt\n+++ b/plone/app/z3cform/templates/file_input.pt\n@@ -98,6 +98,13 @@\n          size="${view/size}"\n          type="file"\n   />\n+  <div class="form-text"\n+       tal:condition="view/accept"\n+       i18n:translate="namedfile_accepted_types"\n+  >\n+      Allowed types:\n+    <tal:i18n i18n:name="accepted_types">${view/accept}</tal:i18n>.\n+  </div>\n \n   <script type="text/javascript"\n           tal:condition="python:allow_nochange and action != \'replace\'"\ndiff --git a/plone/app/z3cform/templates/image_input.pt b/plone/app/z3cform/templates/image_input.pt\nindex 82546b5..15a900b 100644\n--- a/plone/app/z3cform/templates/image_input.pt\n+++ b/plone/app/z3cform/templates/image_input.pt\n@@ -102,6 +102,13 @@\n          size="${view/size}"\n          type="file"\n   />\n+  <div class="form-text"\n+       tal:condition="view/accept"\n+       i18n:translate="namedfile_accepted_types"\n+  >\n+      Allowed types:\n+    <tal:i18n i18n:name="accepted_types">${view/accept}</tal:i18n>.\n+  </div>\n \n   <script type="text/javascript"\n           tal:condition="python:allow_nochange and action != \'replace\'"\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2024-03-15T12:41:28+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/f7236d3580717edae7562e89f8a7b6a43ddf258e

Update plone/app/z3cform/templates/image_input.pt

Co-authored-by: Maurits van Rees &lt;maurits@vanrees.org&gt;

Files changed:
M plone/app/z3cform/templates/image_input.pt

b'diff --git a/plone/app/z3cform/templates/image_input.pt b/plone/app/z3cform/templates/image_input.pt\nindex 15a900b..7da7d43 100644\n--- a/plone/app/z3cform/templates/image_input.pt\n+++ b/plone/app/z3cform/templates/image_input.pt\n@@ -103,7 +103,7 @@\n          type="file"\n   />\n   <div class="form-text"\n-       tal:condition="view/accept"\n+       tal:condition="view/accept|nothing"\n        i18n:translate="namedfile_accepted_types"\n   >\n       Allowed types:\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2024-03-15T12:41:38+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/5d6d0e7e02b3a8af4697c4e2228718358263a632

Update plone/app/z3cform/templates/image_input.pt

Co-authored-by: Maurits van Rees &lt;maurits@vanrees.org&gt;

Files changed:
M plone/app/z3cform/templates/image_input.pt

b'diff --git a/plone/app/z3cform/templates/image_input.pt b/plone/app/z3cform/templates/image_input.pt\nindex 7da7d43..c4dd38e 100644\n--- a/plone/app/z3cform/templates/image_input.pt\n+++ b/plone/app/z3cform/templates/image_input.pt\n@@ -94,7 +94,7 @@\n \n   <input class="form-control ${python:view.error and \'is-invalid\' or \'\'}"\n          id="${view/id}-input"\n-         accept="${view/accept}"\n+         accept="${view/accept|nothing}"\n          disabled="${view/disabled}"\n          maxlength="${view/maxlength}"\n          name="${view/name}"\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2024-03-15T12:41:47+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/e4b11e6a2bc1366645fa33fa444054e741627d82

Update plone/app/z3cform/templates/file_input.pt

Co-authored-by: Maurits van Rees &lt;maurits@vanrees.org&gt;

Files changed:
M plone/app/z3cform/templates/file_input.pt

b'diff --git a/plone/app/z3cform/templates/file_input.pt b/plone/app/z3cform/templates/file_input.pt\nindex 6a4fa65..107eb45 100644\n--- a/plone/app/z3cform/templates/file_input.pt\n+++ b/plone/app/z3cform/templates/file_input.pt\n@@ -99,7 +99,7 @@\n          type="file"\n   />\n   <div class="form-text"\n-       tal:condition="view/accept"\n+       tal:condition="view/accept|nothing"\n        i18n:translate="namedfile_accepted_types"\n   >\n       Allowed types:\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2024-03-15T12:41:54+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/b45fb3084a9de158323ba5e2eb2625338cec62d3

Update plone/app/z3cform/templates/file_input.pt

Co-authored-by: Maurits van Rees &lt;maurits@vanrees.org&gt;

Files changed:
M plone/app/z3cform/templates/file_input.pt

b'diff --git a/plone/app/z3cform/templates/file_input.pt b/plone/app/z3cform/templates/file_input.pt\nindex 107eb45..03fc55e 100644\n--- a/plone/app/z3cform/templates/file_input.pt\n+++ b/plone/app/z3cform/templates/file_input.pt\n@@ -90,7 +90,7 @@\n \n   <input class="form-control ${python:view.error and \'is-invalid\' or \'\'}"\n          id="${view/id}-input"\n-         accept="${view/accept}"\n+         accept="${view/accept|nothing}"\n          disabled="${view/disabled}"\n          maxlength="${view/maxlength}"\n          name="${view/name}"\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2024-03-15T14:33:28+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.z3cform/commit/dc8eaac6c98bd2b9a1f26f08945471b31884e7fd

Depend on the just released plone.formwidget.namedfile 3.1.0.

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex 1af931c..7d0c2b2 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -62,7 +62,7 @@\n         "plone.app.textfield>=1.3.6",\n         "plone.base",\n         "plone.app.contentlisting",\n-        "plone.formwidget.namedfile>3.0.3",\n+        "plone.formwidget.namedfile>=3.1.0",\n         "plone.i18n",\n         "plone.protect",\n         "plone.registry",\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2024-03-15T14:45:09+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.z3cform/commit/4262f253641b5d231210ecb2589b0d4a42755684

Configuring with plone/meta

Files changed:
A dependabot.yml
M .editorconfig
M .flake8
M .github/workflows/meta.yml
M .gitignore
M .meta.toml
M .pre-commit-config.yaml
M pyproject.toml
M tox.ini

b'diff --git a/.editorconfig b/.editorconfig\nindex 919b4116..5b3c112c 100644\n--- a/.editorconfig\n+++ b/.editorconfig\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n #\n # EditorConfig Configuration file, for more details see:\n@@ -13,7 +13,8 @@\n root = true\n \n \n-[*]  # For All Files\n+[*]\n+# Default settings for all files.\n # Unix-style newlines with a newline ending every file\n end_of_line = lf\n insert_final_newline = true\n@@ -29,13 +30,15 @@ max_line_length = off\n # 4 space indentation\n indent_size = 4\n \n-[*.{yml,zpt,pt,dtml,zcml}]\n+[*.{yml,zpt,pt,dtml,zcml,html,xml}]\n # 2 space indentation\n indent_size = 2\n \n-[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss,html}]  # Frontend development\n+[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss}]\n+# Frontend development\n # 2 space indentation\n indent_size = 2\n+max_line_length = 80\n \n [{Makefile,.gitmodules}]\n # Tab indentation (no size specified, but view as 4 spaces)\ndiff --git a/.flake8 b/.flake8\nindex 7ef4f64d..38918f42 100644\n--- a/.flake8\n+++ b/.flake8\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [flake8]\n doctests = 1\ndiff --git a/.github/workflows/meta.yml b/.github/workflows/meta.yml\nindex 39a164d7..b8edec02 100644\n--- a/.github/workflows/meta.yml\n+++ b/.github/workflows/meta.yml\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n name: Meta\n on:\ndiff --git a/.gitignore b/.gitignore\nindex 624e015d..fc71f6a7 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n # python related\n *.egg-info\n@@ -12,6 +12,7 @@\n # tools related\n build/\n .coverage\n+.*project\n coverage.xml\n dist/\n docs/_build\n@@ -34,6 +35,7 @@ lib64\n parts/\n pyvenv.cfg\n var/\n+local.cfg\n \n # mxdev\n /instance/\ndiff --git a/.meta.toml b/.meta.toml\nindex 1d9674a0..ebc7f357 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -1,9 +1,9 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [meta]\n template = "default"\n-commit-id = "b3ba013b"\n+commit-id = "d85a300a"\n \n [pyproject]\n dependencies_ignores = "[\'lxml\', \'plone.app.vocabularies\']"\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex 7a6a09ca..f857b483 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n ci:\n     autofix_prs: false\ndiff --git a/dependabot.yml b/dependabot.yml\nnew file mode 100644\nindex 00000000..bbd3ab05\n--- /dev/null\n+++ b/dependabot.yml\n@@ -0,0 +1,11 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/main/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+version: 2\n+updates:\n+\n+  - package-ecosystem: "github-actions"\n+    directory: "/"\n+    schedule:\n+      # Check for updates to GitHub Actions every week\n+      interval: "weekly"\ndiff --git a/pyproject.toml b/pyproject.toml\nindex c86ac0f1..e7eb782d 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,6 +1,9 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n+[build-system]\n+requires = ["setuptools>=68.2"]\n+\n [tool.towncrier]\n directory = "news/"\n filename = "CHANGES.rst"\n@@ -126,19 +129,20 @@ ignore-packages = [\'lxml\', \'plone.app.vocabularies\']\n #    "gitpython = [\'git\']",\n #    "pygithub = [\'github\']",\n #  ]\n-#  """\n ##\n \n [tool.check-manifest]\n ignore = [\n     ".editorconfig",\n+    ".flake8",\n     ".meta.toml",\n     ".pre-commit-config.yaml",\n-    "tox.ini",\n-    ".flake8",\n+    "dependabot.yml",\n     "mx.ini",\n+    "tox.ini",\n \n ]\n+\n ##\n # Add extra configuration options in .meta.toml:\n #  [pyproject]\n@@ -146,6 +150,11 @@ ignore = [\n #      "*.map.js",\n #      "*.pyc",\n #  """\n+#  check_manifest_extra_lines = """\n+#  ignore-bad-ideas = [\n+#      "some/test/file/PKG-INFO",\n+#  ]\n+#  """\n ##\n \n \ndiff --git a/tox.ini b/tox.ini\nindex ca59fa00..cbcd1bc5 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [tox]\n # We need 4.4.0 for constrain_package_deps.\n@@ -32,6 +32,14 @@ commands =\n     echo "Unrecognized environment name {envname}"\n     false\n \n+##\n+# Add extra configuration options in .meta.toml:\n+#  [tox]\n+#  testenv_options = """\n+#  basepython = /usr/bin/python3.8\n+#  """\n+##\n+\n [testenv:init]\n description = Prepare environment\n skip_install = true\n@@ -63,9 +71,9 @@ description = check if the package defines all its dependencies\n skip_install = true\n deps =\n     build\n-    z3c.dependencychecker==2.11\n+    z3c.dependencychecker==2.14.3\n commands =\n-    python -m build --sdist --no-isolation\n+    python -m build --sdist\n     dependencychecker\n \n [testenv:dependencies-graph]\n@@ -101,7 +109,7 @@ set_env =\n deps =\n     zope.testrunner\n     -c https://dist.plone.org/release/6.1-dev/constraints.txt\n-    \n+\n ##\n # Specify additional deps in .meta.toml:\n #  [tox]\n@@ -144,11 +152,12 @@ deps =\n     coverage\n     zope.testrunner\n     -c https://dist.plone.org/release/6.1-dev/constraints.txt\n-    \n+\n commands =\n     coverage run --branch --source plone.app.z3cform {envbindir}/zope-testrunner --quiet --all --test-path={toxinidir} -s plone.app.z3cform {posargs}\n     coverage report -m --format markdown\n     coverage xml\n+    coverage html\n extras =\n     test\n \n@@ -161,19 +170,22 @@ deps =\n     build\n     towncrier\n     -c https://dist.plone.org/release/6.1-dev/constraints.txt\n-    \n+\n commands =\n     # fake version to not have to install the package\n     # we build the change log as news entries might break\n     # the README that is displayed on PyPI\n     towncrier build --version=100.0.0 --yes\n-    python -m build --sdist --no-isolation\n+    python -m build --sdist\n     twine check dist/*\n \n [testenv:circular]\n description = ensure there are no cyclic dependencies\n use_develop = true\n skip_install = false\n+# Here we must always constrain the package deps to what is already installed,\n+# otherwise we simply get the latest from PyPI, which may not work.\n+constrain_package_deps = true\n set_env =\n \n ##\n@@ -189,7 +201,7 @@ deps =\n     pipdeptree\n     pipforester\n     -c https://dist.plone.org/release/6.1-dev/constraints.txt\n-    \n+\n commands =\n     # Generate the full dependency tree\n     sh -c \'pipdeptree -j > forest.json\'\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2024-03-15T14:50:51+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.z3cform/commit/8b5d2aa9ce945a4e2648441915b2cecd870b97fc

dependencychecker: ignore plone.formwidget.namedfile.

z3c.dependencychecker says this dependency is not needed, but it is wrong:
it is used in widgets.zcml.

Files changed:
M .meta.toml
M pyproject.toml

b'diff --git a/.meta.toml b/.meta.toml\nindex ebc7f35..339bf51 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -6,7 +6,7 @@ template = "default"\n commit-id = "d85a300a"\n \n [pyproject]\n-dependencies_ignores = "[\'lxml\', \'plone.app.vocabularies\']"\n+dependencies_ignores = "[\'lxml\', \'plone.app.vocabularies\', \'plone.formwidget.namedfile\']"\n codespell_ignores = "iterms"\n \n [gitignore]\ndiff --git a/pyproject.toml b/pyproject.toml\nindex e7eb782..52b472e 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -119,7 +119,7 @@ Zope = [\n   \'Products.CMFCore\', \'Products.CMFDynamicViewFTI\',\n ]\n python-dateutil = [\'dateutil\']\n-ignore-packages = [\'lxml\', \'plone.app.vocabularies\']\n+ignore-packages = [\'lxml\', \'plone.app.vocabularies\', \'plone.formwidget.namedfile\']\n \n ##\n # Add extra configuration options in .meta.toml:\n'

Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2024-03-15T16:37:34+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/f081ed7107290d4b64b334a3afa0066856039c8a

Merge pull request #200 from plone/allowed_content_types

Add support for accept attribute on file input.

Files changed:
A dependabot.yml
A news/198.feature
M .editorconfig
M .flake8
M .github/workflows/meta.yml
M .gitignore
M .meta.toml
M .pre-commit-config.yaml
M plone/app/z3cform/templates/file_input.pt
M plone/app/z3cform/templates/image_input.pt
M pyproject.toml
M setup.py
M tox.ini

b'diff --git a/.editorconfig b/.editorconfig\nindex 919b4116..5b3c112c 100644\n--- a/.editorconfig\n+++ b/.editorconfig\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n #\n # EditorConfig Configuration file, for more details see:\n@@ -13,7 +13,8 @@\n root = true\n \n \n-[*]  # For All Files\n+[*]\n+# Default settings for all files.\n # Unix-style newlines with a newline ending every file\n end_of_line = lf\n insert_final_newline = true\n@@ -29,13 +30,15 @@ max_line_length = off\n # 4 space indentation\n indent_size = 4\n \n-[*.{yml,zpt,pt,dtml,zcml}]\n+[*.{yml,zpt,pt,dtml,zcml,html,xml}]\n # 2 space indentation\n indent_size = 2\n \n-[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss,html}]  # Frontend development\n+[*.{json,jsonl,js,jsx,ts,tsx,css,less,scss}]\n+# Frontend development\n # 2 space indentation\n indent_size = 2\n+max_line_length = 80\n \n [{Makefile,.gitmodules}]\n # Tab indentation (no size specified, but view as 4 spaces)\ndiff --git a/.flake8 b/.flake8\nindex 7ef4f64d..38918f42 100644\n--- a/.flake8\n+++ b/.flake8\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [flake8]\n doctests = 1\ndiff --git a/.github/workflows/meta.yml b/.github/workflows/meta.yml\nindex 39a164d7..b8edec02 100644\n--- a/.github/workflows/meta.yml\n+++ b/.github/workflows/meta.yml\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n name: Meta\n on:\ndiff --git a/.gitignore b/.gitignore\nindex 624e015d..fc71f6a7 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n # python related\n *.egg-info\n@@ -12,6 +12,7 @@\n # tools related\n build/\n .coverage\n+.*project\n coverage.xml\n dist/\n docs/_build\n@@ -34,6 +35,7 @@ lib64\n parts/\n pyvenv.cfg\n var/\n+local.cfg\n \n # mxdev\n /instance/\ndiff --git a/.meta.toml b/.meta.toml\nindex 1d9674a0..339bf517 100644\n--- a/.meta.toml\n+++ b/.meta.toml\n@@ -1,12 +1,12 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [meta]\n template = "default"\n-commit-id = "b3ba013b"\n+commit-id = "d85a300a"\n \n [pyproject]\n-dependencies_ignores = "[\'lxml\', \'plone.app.vocabularies\']"\n+dependencies_ignores = "[\'lxml\', \'plone.app.vocabularies\', \'plone.formwidget.namedfile\']"\n codespell_ignores = "iterms"\n \n [gitignore]\ndiff --git a/.pre-commit-config.yaml b/.pre-commit-config.yaml\nindex 7a6a09ca..f857b483 100644\n--- a/.pre-commit-config.yaml\n+++ b/.pre-commit-config.yaml\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n ci:\n     autofix_prs: false\ndiff --git a/dependabot.yml b/dependabot.yml\nnew file mode 100644\nindex 00000000..bbd3ab05\n--- /dev/null\n+++ b/dependabot.yml\n@@ -0,0 +1,11 @@\n+# Generated from:\n+# https://github.com/plone/meta/tree/main/config/default\n+# See the inline comments on how to expand/tweak this configuration file\n+version: 2\n+updates:\n+\n+  - package-ecosystem: "github-actions"\n+    directory: "/"\n+    schedule:\n+      # Check for updates to GitHub Actions every week\n+      interval: "weekly"\ndiff --git a/news/198.feature b/news/198.feature\nnew file mode 100644\nindex 00000000..1d722dc4\n--- /dev/null\n+++ b/news/198.feature\n@@ -0,0 +1,14 @@\n+Add support for the "accept" attribute on file inputs.\n+\n+If the widget\'s field - if there is one - has the "accept" attribute set (the\n+`NamedImage` field has `image/*` set by default) then this is rendered as an\n+`accept` attribute on the file input.\n+\n+This would restrict the allowed file types before uploading while still being\n+checked on the server side.\n+\n+Fixes: https://github.com/plone/plone.formwidget.namedfile/issues/66\n+Depends on:\n+- https://github.com/plone/plone.namedfile/pull/158\n+- https://github.com/plone/plone.formwidget.namedfile/pull/67\n+[thet]\ndiff --git a/plone/app/z3cform/templates/file_input.pt b/plone/app/z3cform/templates/file_input.pt\nindex 14bd91a5..03fc55e0 100644\n--- a/plone/app/z3cform/templates/file_input.pt\n+++ b/plone/app/z3cform/templates/file_input.pt\n@@ -90,6 +90,7 @@\n \n   <input class="form-control ${python:view.error and \'is-invalid\' or \'\'}"\n          id="${view/id}-input"\n+         accept="${view/accept|nothing}"\n          disabled="${view/disabled}"\n          maxlength="${view/maxlength}"\n          name="${view/name}"\n@@ -97,6 +98,13 @@\n          size="${view/size}"\n          type="file"\n   />\n+  <div class="form-text"\n+       tal:condition="view/accept|nothing"\n+       i18n:translate="namedfile_accepted_types"\n+  >\n+      Allowed types:\n+    <tal:i18n i18n:name="accepted_types">${view/accept}</tal:i18n>.\n+  </div>\n \n   <script type="text/javascript"\n           tal:condition="python:allow_nochange and action != \'replace\'"\ndiff --git a/plone/app/z3cform/templates/image_input.pt b/plone/app/z3cform/templates/image_input.pt\nindex 3820e377..c4dd38e7 100644\n--- a/plone/app/z3cform/templates/image_input.pt\n+++ b/plone/app/z3cform/templates/image_input.pt\n@@ -94,6 +94,7 @@\n \n   <input class="form-control ${python:view.error and \'is-invalid\' or \'\'}"\n          id="${view/id}-input"\n+         accept="${view/accept|nothing}"\n          disabled="${view/disabled}"\n          maxlength="${view/maxlength}"\n          name="${view/name}"\n@@ -101,6 +102,13 @@\n          size="${view/size}"\n          type="file"\n   />\n+  <div class="form-text"\n+       tal:condition="view/accept|nothing"\n+       i18n:translate="namedfile_accepted_types"\n+  >\n+      Allowed types:\n+    <tal:i18n i18n:name="accepted_types">${view/accept}</tal:i18n>.\n+  </div>\n \n   <script type="text/javascript"\n           tal:condition="python:allow_nochange and action != \'replace\'"\ndiff --git a/pyproject.toml b/pyproject.toml\nindex c86ac0f1..52b472e6 100644\n--- a/pyproject.toml\n+++ b/pyproject.toml\n@@ -1,6 +1,9 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n+[build-system]\n+requires = ["setuptools>=68.2"]\n+\n [tool.towncrier]\n directory = "news/"\n filename = "CHANGES.rst"\n@@ -116,7 +119,7 @@ Zope = [\n   \'Products.CMFCore\', \'Products.CMFDynamicViewFTI\',\n ]\n python-dateutil = [\'dateutil\']\n-ignore-packages = [\'lxml\', \'plone.app.vocabularies\']\n+ignore-packages = [\'lxml\', \'plone.app.vocabularies\', \'plone.formwidget.namedfile\']\n \n ##\n # Add extra configuration options in .meta.toml:\n@@ -126,19 +129,20 @@ ignore-packages = [\'lxml\', \'plone.app.vocabularies\']\n #    "gitpython = [\'git\']",\n #    "pygithub = [\'github\']",\n #  ]\n-#  """\n ##\n \n [tool.check-manifest]\n ignore = [\n     ".editorconfig",\n+    ".flake8",\n     ".meta.toml",\n     ".pre-commit-config.yaml",\n-    "tox.ini",\n-    ".flake8",\n+    "dependabot.yml",\n     "mx.ini",\n+    "tox.ini",\n \n ]\n+\n ##\n # Add extra configuration options in .meta.toml:\n #  [pyproject]\n@@ -146,6 +150,11 @@ ignore = [\n #      "*.map.js",\n #      "*.pyc",\n #  """\n+#  check_manifest_extra_lines = """\n+#  ignore-bad-ideas = [\n+#      "some/test/file/PKG-INFO",\n+#  ]\n+#  """\n ##\n \n \ndiff --git a/setup.py b/setup.py\nindex 4ead065a..7d0c2b23 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -62,6 +62,7 @@\n         "plone.app.textfield>=1.3.6",\n         "plone.base",\n         "plone.app.contentlisting",\n+        "plone.formwidget.namedfile>=3.1.0",\n         "plone.i18n",\n         "plone.protect",\n         "plone.registry",\ndiff --git a/tox.ini b/tox.ini\nindex ca59fa00..cbcd1bc5 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -1,5 +1,5 @@\n # Generated from:\n-# https://github.com/plone/meta/tree/master/config/default\n+# https://github.com/plone/meta/tree/main/config/default\n # See the inline comments on how to expand/tweak this configuration file\n [tox]\n # We need 4.4.0 for constrain_package_deps.\n@@ -32,6 +32,14 @@ commands =\n     echo "Unrecognized environment name {envname}"\n     false\n \n+##\n+# Add extra configuration options in .meta.toml:\n+#  [tox]\n+#  testenv_options = """\n+#  basepython = /usr/bin/python3.8\n+#  """\n+##\n+\n [testenv:init]\n description = Prepare environment\n skip_install = true\n@@ -63,9 +71,9 @@ description = check if the package defines all its dependencies\n skip_install = true\n deps =\n     build\n-    z3c.dependencychecker==2.11\n+    z3c.dependencychecker==2.14.3\n commands =\n-    python -m build --sdist --no-isolation\n+    python -m build --sdist\n     dependencychecker\n \n [testenv:dependencies-graph]\n@@ -101,7 +109,7 @@ set_env =\n deps =\n     zope.testrunner\n     -c https://dist.plone.org/release/6.1-dev/constraints.txt\n-    \n+\n ##\n # Specify additional deps in .meta.toml:\n #  [tox]\n@@ -144,11 +152,12 @@ deps =\n     coverage\n     zope.testrunner\n     -c https://dist.plone.org/release/6.1-dev/constraints.txt\n-    \n+\n commands =\n     coverage run --branch --source plone.app.z3cform {envbindir}/zope-testrunner --quiet --all --test-path={toxinidir} -s plone.app.z3cform {posargs}\n     coverage report -m --format markdown\n     coverage xml\n+    coverage html\n extras =\n     test\n \n@@ -161,19 +170,22 @@ deps =\n     build\n     towncrier\n     -c https://dist.plone.org/release/6.1-dev/constraints.txt\n-    \n+\n commands =\n     # fake version to not have to install the package\n     # we build the change log as news entries might break\n     # the README that is displayed on PyPI\n     towncrier build --version=100.0.0 --yes\n-    python -m build --sdist --no-isolation\n+    python -m build --sdist\n     twine check dist/*\n \n [testenv:circular]\n description = ensure there are no cyclic dependencies\n use_develop = true\n skip_install = false\n+# Here we must always constrain the package deps to what is already installed,\n+# otherwise we simply get the latest from PyPI, which may not work.\n+constrain_package_deps = true\n set_env =\n \n ##\n@@ -189,7 +201,7 @@ deps =\n     pipdeptree\n     pipforester\n     -c https://dist.plone.org/release/6.1-dev/constraints.txt\n-    \n+\n commands =\n     # Generate the full dependency tree\n     sh -c \'pipdeptree -j > forest.json\'\n'

