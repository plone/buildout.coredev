Repository: Products.CMFFormController


Branch: refs/heads/master
Date: 2020-09-09T21:55:21+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFFormController/commit/2dbe093d094cdbb4fa5725816313af3fd1637968

Fixed deprecation warning for module imp.

Files changed:
M Products/CMFFormController/ControllerPythonScript.py
M Products/CMFFormController/ControllerValidator.py
M news/3130.bugfix

b'diff --git a/Products/CMFFormController/ControllerPythonScript.py b/Products/CMFFormController/ControllerPythonScript.py\nindex ec3c805..e9bfc7e 100644\n--- a/Products/CMFFormController/ControllerPythonScript.py\n+++ b/Products/CMFFormController/ControllerPythonScript.py\n@@ -37,10 +37,18 @@\n import os\n import re\n \n+\n # Track the Python bytecode version\n-import imp\n-Python_magic = imp.get_magic()\n-del imp\n+# This does not seem used anymore, but that is what I think in version 1.0-alpha already,\n+# so it might be magically found when accessed by code in Products.PythonScripts.\n+try:\n+    from importlib.util import MAGIC_NUMBER\n+    Python_magic = MAGIC_NUMBER\n+except ImportError:\n+    # Python 2\n+    import imp\n+    Python_magic = imp.get_magic()\n+    del imp\n \n # This should only be incremented to force recompilation.\n Script_magic = 3\ndiff --git a/Products/CMFFormController/ControllerValidator.py b/Products/CMFFormController/ControllerValidator.py\nindex b1e7a1d..e2fb86c 100644\n--- a/Products/CMFFormController/ControllerValidator.py\n+++ b/Products/CMFFormController/ControllerValidator.py\n@@ -33,10 +33,18 @@\n import AccessControl\n import os\n \n+\n # Track the Python bytecode version\n-import imp\n-Python_magic = imp.get_magic()\n-del imp\n+# This does not seem used anymore, but that is what I think in version 1.0-alpha already,\n+# so it might be magically found when accessed by code in Products.PythonScripts.\n+try:\n+    from importlib.util import MAGIC_NUMBER\n+    Python_magic = MAGIC_NUMBER\n+except ImportError:\n+    # Python 2\n+    import imp\n+    Python_magic = imp.get_magic()\n+    del imp\n \n # This should only be incremented to force recompilation.\n Script_magic = 3\ndiff --git a/news/3130.bugfix b/news/3130.bugfix\nindex 2311e20..e10f580 100644\n--- a/news/3130.bugfix\n+++ b/news/3130.bugfix\n@@ -1,4 +1,5 @@\n Removed security declaration for nonexistent method ``ZPythonScriptHTML_changePrefs``.\n This method was removed from ``Products.PythonScripts`` in version 4.2, from October 2018.\n Added ``Products.PythonScripts>=4.2`` as dependency.\n+Fixed deprecation warning for module ``imp``.\n [maurits]\n'

Repository: Products.CMFFormController


Branch: refs/heads/master
Date: 2020-09-09T21:57:15+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFFormController/commit/5f975d1a2c1803400fde1321a5ff842fcf2e7744

Fixed invalid escape sequence

Files changed:
M Products/CMFFormController/ControllerPythonScript.py
M Products/CMFFormController/Script.py
M news/3130.bugfix

b"diff --git a/Products/CMFFormController/ControllerPythonScript.py b/Products/CMFFormController/ControllerPythonScript.py\nindex e9bfc7e..825dc63 100644\n--- a/Products/CMFFormController/ControllerPythonScript.py\n+++ b/Products/CMFFormController/ControllerPythonScript.py\n@@ -65,8 +65,8 @@\n _marker = []  # Create a new marker object\n \n \n-_first_indent = re.compile('(?m)^ *(?! |$)')\n-_nonempty_line = re.compile('(?m)^(.*\\S.*)$')\n+_first_indent = re.compile(r'(?m)^ *(?! |$)')\n+_nonempty_line = re.compile(r'(?m)^(.*\\S.*)$')\n \n # ###########################################################################\n # Product registration and Add support\ndiff --git a/Products/CMFFormController/Script.py b/Products/CMFFormController/Script.py\nindex 8a0b26b..8482013 100644\n--- a/Products/CMFFormController/Script.py\n+++ b/Products/CMFFormController/Script.py\n@@ -37,8 +37,8 @@\n                     'subpath': 'name_subpath',\n                     'state': 'name_state'}\n \n-_first_indent = re.compile('(?m)^ *(?! |$)')\n-_nonempty_line = re.compile('(?m)^(.*\\S.*)$')\n+_first_indent = re.compile(r'(?m)^ *(?! |$)')\n+_nonempty_line = re.compile(r'(?m)^(.*\\S.*)$')\n \n \n class NameAssignments(BaseNameAssignments):\ndiff --git a/news/3130.bugfix b/news/3130.bugfix\nindex e10f580..5fc0caf 100644\n--- a/news/3130.bugfix\n+++ b/news/3130.bugfix\n@@ -2,4 +2,5 @@ Removed security declaration for nonexistent method ``ZPythonScriptHTML_changePr\n This method was removed from ``Products.PythonScripts`` in version 4.2, from October 2018.\n Added ``Products.PythonScripts>=4.2`` as dependency.\n Fixed deprecation warning for module ``imp``.\n+Fixed invalid escape sequence.\n [maurits]\n"

Repository: Products.CMFFormController


Branch: refs/heads/master
Date: 2020-09-10T12:48:32+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFFormController/commit/b0e3822ea82a1bfb92aa4b4e1cd7ccaba06cd160

Merge pull request #25 from plone/maurits/fix-warnings-2

Fix warnings for module 'imp' and regular expressions

Files changed:
M Products/CMFFormController/ControllerPythonScript.py
M Products/CMFFormController/ControllerValidator.py
M Products/CMFFormController/Script.py
M news/3130.bugfix

b"diff --git a/Products/CMFFormController/ControllerPythonScript.py b/Products/CMFFormController/ControllerPythonScript.py\nindex ec3c805..825dc63 100644\n--- a/Products/CMFFormController/ControllerPythonScript.py\n+++ b/Products/CMFFormController/ControllerPythonScript.py\n@@ -37,10 +37,18 @@\n import os\n import re\n \n+\n # Track the Python bytecode version\n-import imp\n-Python_magic = imp.get_magic()\n-del imp\n+# This does not seem used anymore, but that is what I think in version 1.0-alpha already,\n+# so it might be magically found when accessed by code in Products.PythonScripts.\n+try:\n+    from importlib.util import MAGIC_NUMBER\n+    Python_magic = MAGIC_NUMBER\n+except ImportError:\n+    # Python 2\n+    import imp\n+    Python_magic = imp.get_magic()\n+    del imp\n \n # This should only be incremented to force recompilation.\n Script_magic = 3\n@@ -57,8 +65,8 @@\n _marker = []  # Create a new marker object\n \n \n-_first_indent = re.compile('(?m)^ *(?! |$)')\n-_nonempty_line = re.compile('(?m)^(.*\\S.*)$')\n+_first_indent = re.compile(r'(?m)^ *(?! |$)')\n+_nonempty_line = re.compile(r'(?m)^(.*\\S.*)$')\n \n # ###########################################################################\n # Product registration and Add support\ndiff --git a/Products/CMFFormController/ControllerValidator.py b/Products/CMFFormController/ControllerValidator.py\nindex b1e7a1d..e2fb86c 100644\n--- a/Products/CMFFormController/ControllerValidator.py\n+++ b/Products/CMFFormController/ControllerValidator.py\n@@ -33,10 +33,18 @@\n import AccessControl\n import os\n \n+\n # Track the Python bytecode version\n-import imp\n-Python_magic = imp.get_magic()\n-del imp\n+# This does not seem used anymore, but that is what I think in version 1.0-alpha already,\n+# so it might be magically found when accessed by code in Products.PythonScripts.\n+try:\n+    from importlib.util import MAGIC_NUMBER\n+    Python_magic = MAGIC_NUMBER\n+except ImportError:\n+    # Python 2\n+    import imp\n+    Python_magic = imp.get_magic()\n+    del imp\n \n # This should only be incremented to force recompilation.\n Script_magic = 3\ndiff --git a/Products/CMFFormController/Script.py b/Products/CMFFormController/Script.py\nindex 8a0b26b..8482013 100644\n--- a/Products/CMFFormController/Script.py\n+++ b/Products/CMFFormController/Script.py\n@@ -37,8 +37,8 @@\n                     'subpath': 'name_subpath',\n                     'state': 'name_state'}\n \n-_first_indent = re.compile('(?m)^ *(?! |$)')\n-_nonempty_line = re.compile('(?m)^(.*\\S.*)$')\n+_first_indent = re.compile(r'(?m)^ *(?! |$)')\n+_nonempty_line = re.compile(r'(?m)^(.*\\S.*)$')\n \n \n class NameAssignments(BaseNameAssignments):\ndiff --git a/news/3130.bugfix b/news/3130.bugfix\nindex 2311e20..5fc0caf 100644\n--- a/news/3130.bugfix\n+++ b/news/3130.bugfix\n@@ -1,4 +1,6 @@\n Removed security declaration for nonexistent method ``ZPythonScriptHTML_changePrefs``.\n This method was removed from ``Products.PythonScripts`` in version 4.2, from October 2018.\n Added ``Products.PythonScripts>=4.2`` as dependency.\n+Fixed deprecation warning for module ``imp``.\n+Fixed invalid escape sequence.\n [maurits]\n"

