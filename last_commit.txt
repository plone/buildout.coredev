Repository: mockup


Branch: refs/heads/master
Date: 2020-06-24T15:50:28+02:00
Author: Vincent Fretin (vincentfretin) <vincent.fretin@gmail.com>
Commit: https://github.com/plone/mockup/commit/5fde80900cd057ba009e24b14afd0309984e5161

fix previous fix for moment date to handle the patMoment instance used for date columns in folder contents

Files changed:
M mockup/patterns/moment/pattern.js

b'diff --git a/mockup/patterns/moment/pattern.js b/mockup/patterns/moment/pattern.js\nindex e0afdc124..9b1e60b6b 100644\n--- a/mockup/patterns/moment/pattern.js\n+++ b/mockup/patterns/moment/pattern.js\n@@ -89,7 +89,7 @@ define([\n ], function($, Base, Registry, i18n, moment) {\n   var currentLanguage = (new i18n()).currentLanguage;\n   var localeLoaded = false;\n-  var elementsToRender = [];\n+  var patMomentInstances = [];\n \n   // From https://github.com/moment/moment/blob/3147fbc/src/test/moment/format.js#L463-L468\n   var MOMENT_LOCALES =\n@@ -126,14 +126,11 @@ define([\n \n     require([\'moment-url/\' + lang], function() {\n       localeLoaded = true;\n-      for (var i = 0; i < elementsToRender.length; i++) {\n-        var $el = elementsToRender[i];\n-        // $el.data("pattern-moment") needs to be undefined for initBasePattern\n-        // to run again the init (see patternslib/src/core/base.js)\n-        $el.removeData("pattern-moment");\n-        Registry.scan($el, [\'moment\']);\n+      for (var i = 0; i < patMomentInstances.length; i++) {\n+        var patMoment = patMomentInstances[i];\n+        patMoment.init();\n       }\n-      elementsToRender = [];\n+      patMomentInstances = [];\n     });\n   }\n \n@@ -188,7 +185,7 @@ define([\n       if (!localeLoaded) {\n         // The locale has not finished to load yet, we will execute the init\n         // again once the locale is loaded.\n-        elementsToRender.push(self.$el);\n+        patMomentInstances.push(self);\n         return;\n       }\n       if (self.options.selector) {\n'

