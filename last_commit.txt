Repository: plone.api


Branch: refs/heads/master
Date: 2020-09-02T14:52:42+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.api/commit/a44f949c333a7c134f779150a97f6e1768e82669

Fixed deprecation warning for CMFPlone.interfaces.ILanguageSchema.

Files changed:
A news/3130.bugfix
M src/plone/api/portal.py

b'diff --git a/news/3130.bugfix b/news/3130.bugfix\nnew file mode 100644\nindex 0000000..9d05367\n--- /dev/null\n+++ b/news/3130.bugfix\n@@ -0,0 +1,2 @@\n+Fixed deprecation warning for ``CMFPlone.interfaces.ILanguageSchema``.\n+[maurits]\ndiff --git a/src/plone/api/portal.py b/src/plone/api/portal.py\nindex 19bff2b..f8e91f0 100644\n--- a/src/plone/api/portal.py\n+++ b/src/plone/api/portal.py\n@@ -402,16 +402,21 @@ def get_default_language():\n     :Example: :ref:`portal_get_default_language_example`\n     """\n     try:\n-        from Products.CMFPlone.interfaces import ILanguageSchema\n-    except ImportError:\n-        portal = get()\n-        return portal.portal_properties.site_properties.getProperty(\n-            \'default_language\', None,\n-        )\n-    else:\n-        registry = getUtility(IRegistry)\n-        settings = registry.forInterface(ILanguageSchema, prefix=\'plone\')\n-        return settings.default_language\n+        # Plone 5.2+\n+        from plone.i18n.interfaces import ILanguageSchema\n+    except ImportError:  # pragma: no cover\n+        try:\n+            # Plone 5.0/5.1\n+            from Products.CMFPlone.interfaces import ILanguageSchema\n+        except ImportError:\n+            # Plone 4.3\n+            portal = get()\n+            return portal.portal_properties.site_properties.getProperty(\n+                \'default_language\', None,\n+            )\n+    registry = getUtility(IRegistry)\n+    settings = registry.forInterface(ILanguageSchema, prefix=\'plone\')\n+    return settings.default_language\n \n \n def get_current_language(context=None):\n'

Repository: plone.api


Branch: refs/heads/master
Date: 2020-09-02T18:08:51+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.api/commit/6b30d03515e06f7c5d9488447bb314bcb670645f

Merge pull request #441 from plone/maurits/fix-warnings

Fixed deprecation warning for CMFPlone.interfaces.ILanguageSchema.

Files changed:
A news/3130.bugfix
M src/plone/api/portal.py

b'diff --git a/news/3130.bugfix b/news/3130.bugfix\nnew file mode 100644\nindex 0000000..9d05367\n--- /dev/null\n+++ b/news/3130.bugfix\n@@ -0,0 +1,2 @@\n+Fixed deprecation warning for ``CMFPlone.interfaces.ILanguageSchema``.\n+[maurits]\ndiff --git a/src/plone/api/portal.py b/src/plone/api/portal.py\nindex 19bff2b..f8e91f0 100644\n--- a/src/plone/api/portal.py\n+++ b/src/plone/api/portal.py\n@@ -402,16 +402,21 @@ def get_default_language():\n     :Example: :ref:`portal_get_default_language_example`\n     """\n     try:\n-        from Products.CMFPlone.interfaces import ILanguageSchema\n-    except ImportError:\n-        portal = get()\n-        return portal.portal_properties.site_properties.getProperty(\n-            \'default_language\', None,\n-        )\n-    else:\n-        registry = getUtility(IRegistry)\n-        settings = registry.forInterface(ILanguageSchema, prefix=\'plone\')\n-        return settings.default_language\n+        # Plone 5.2+\n+        from plone.i18n.interfaces import ILanguageSchema\n+    except ImportError:  # pragma: no cover\n+        try:\n+            # Plone 5.0/5.1\n+            from Products.CMFPlone.interfaces import ILanguageSchema\n+        except ImportError:\n+            # Plone 4.3\n+            portal = get()\n+            return portal.portal_properties.site_properties.getProperty(\n+                \'default_language\', None,\n+            )\n+    registry = getUtility(IRegistry)\n+    settings = registry.forInterface(ILanguageSchema, prefix=\'plone\')\n+    return settings.default_language\n \n \n def get_current_language(context=None):\n'

