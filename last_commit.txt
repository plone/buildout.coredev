Repository: plone.restapi


Branch: refs/heads/master
Date: 2023-08-18T16:04:22-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.restapi/commit/ed070e0769c4ac3efda05448db8846f61dae255c

unregister handler even if test fails (#1680)

* unregister handler even if test fails

* changelog

Files changed:
A news/1680.internal
M src/plone/restapi/tests/test_content_utils.py

b'diff --git a/news/1680.internal b/news/1680.internal\nnew file mode 100644\nindex 000000000..a6b2e232e\n--- /dev/null\n+++ b/news/1680.internal\n@@ -0,0 +1 @@\n+Fix test cleanup. @davisagli\ndiff --git a/src/plone/restapi/tests/test_content_utils.py b/src/plone/restapi/tests/test_content_utils.py\nindex 055522a86..c9911335c 100644\n--- a/src/plone/restapi/tests/test_content_utils.py\n+++ b/src/plone/restapi/tests/test_content_utils.py\n@@ -92,9 +92,10 @@ def move_object(event):\n \n         sm.registerHandler(move_object, (IObjectAddedEvent,))\n \n-        obj = create(self.folder, "Document", "my-document")\n-        notify(ObjectCreatedEvent(obj))\n-        obj = add(self.folder, obj)\n-        self.assertEqual(aq_parent(obj), self.portal)\n-\n-        sm.unregisterHandler(move_object, (IObjectAddedEvent,))\n+        try:\n+            obj = create(self.folder, "Document", "my-document")\n+            notify(ObjectCreatedEvent(obj))\n+            obj = add(self.folder, obj)\n+            self.assertEqual(aq_parent(obj), self.portal)\n+        finally:\n+            sm.unregisterHandler(move_object, (IObjectAddedEvent,))\n'

