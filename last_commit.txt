Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-11-25T08:36:26+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.restapi/commit/9a3a96b488944d48ce20911a569e98b5bd45333a

prepare restapi to work without unused meta_type index

Files changed:
A news/2024.bugfix
M src/plone/restapi/tests/test_search.py
M src/plone/restapi/tests/test_serializer_summary.py

b'diff --git a/news/2024.bugfix b/news/2024.bugfix\nnew file mode 100644\nindex 000000000..3231dc98d\n--- /dev/null\n+++ b/news/2024.bugfix\n@@ -0,0 +1,2 @@\n+Do not test if there is a `meta_type` index. It is unused ballast.\n+[jensens]\ndiff --git a/src/plone/restapi/tests/test_search.py b/src/plone/restapi/tests/test_search.py\nindex 56c4b2fea..859349d4f 100644\n--- a/src/plone/restapi/tests/test_search.py\n+++ b/src/plone/restapi/tests/test_search.py\n@@ -238,7 +238,7 @@ def test_full_metadata_retrieval(self):\n         response = self.api_session.get("/@search", params=query)\n \n         first_item = response.json()["items"][0]\n-        self.assertDictContainsSubset(\n+        self.assertLessEqual(\n             {\n                 u"@id": self.portal_url + u"/folder/doc",\n                 u"Creator": u"test_user_1_",\n@@ -267,15 +267,14 @@ def test_full_metadata_retrieval(self):\n                 u"last_comment_date": None,\n                 u"listCreators": [u"test_user_1_"],\n                 u"location": None,\n-                u"meta_type": u"Dexterity Item",\n                 u"portal_type": u"DXTestDocument",\n                 u"review_state": u"private",\n                 u"start": u"1950-01-01T00:00:00+00:00",\n                 u"sync_uid": None,\n                 u"title": u"Lorem Ipsum",\n                 u"total_comments": 0,\n-            },\n-            first_item,\n+            }.items(),\n+            first_item.items(),\n         )\n         # This value changed in Plone 5.2\n         # (Dexterity gained support for getObjSize)\ndiff --git a/src/plone/restapi/tests/test_serializer_summary.py b/src/plone/restapi/tests/test_serializer_summary.py\nindex f8884e7d8..60c440d12 100644\n--- a/src/plone/restapi/tests/test_serializer_summary.py\n+++ b/src/plone/restapi/tests/test_serializer_summary.py\n@@ -142,7 +142,7 @@ def test_brain_summary_includes_all_metadata_fields(self):\n             summary["mime_type"] = u"text/plain"\n \n         self.maxDiff = None\n-        self.assertDictEqual(\n+        self.assertLessEqual(\n             {\n                 "@id": u"http://nohost/plone/doc1",\n                 "@type": u"DXTestDocument",\n@@ -178,7 +178,6 @@ def test_brain_summary_includes_all_metadata_fields(self):\n                 "last_comment_date": None,\n                 "listCreators": [u"test_user_1_"],\n                 "location": None,\n-                "meta_type": u"Dexterity Item",\n                 "mime_type": u"text/plain",\n                 "modified": u"2017-01-21T01:14:48+00:00",\n                 "portal_type": u"DXTestDocument",\n@@ -187,8 +186,8 @@ def test_brain_summary_includes_all_metadata_fields(self):\n                 "sync_uid": None,\n                 "title": u"Lorem Ipsum",\n                 "total_comments": 0,\n-            },\n-            summary,\n+            }.items(),\n+            summary.items(),\n         )\n \n     def test_dx_type_summary(self):\n'

Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-11-26T17:24:58+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.restapi/commit/2ce87724c1c5ecb5a58102c3bfeac470ded02e01

Merge pull request #1024 from plone/remove-meta_type

Prepare to work without unused meta_type index

Files changed:
A news/2024.bugfix
M src/plone/restapi/tests/test_search.py
M src/plone/restapi/tests/test_serializer_summary.py

b'diff --git a/news/2024.bugfix b/news/2024.bugfix\nnew file mode 100644\nindex 000000000..3231dc98d\n--- /dev/null\n+++ b/news/2024.bugfix\n@@ -0,0 +1,2 @@\n+Do not test if there is a `meta_type` index. It is unused ballast.\n+[jensens]\ndiff --git a/src/plone/restapi/tests/test_search.py b/src/plone/restapi/tests/test_search.py\nindex 56c4b2fea..859349d4f 100644\n--- a/src/plone/restapi/tests/test_search.py\n+++ b/src/plone/restapi/tests/test_search.py\n@@ -238,7 +238,7 @@ def test_full_metadata_retrieval(self):\n         response = self.api_session.get("/@search", params=query)\n \n         first_item = response.json()["items"][0]\n-        self.assertDictContainsSubset(\n+        self.assertLessEqual(\n             {\n                 u"@id": self.portal_url + u"/folder/doc",\n                 u"Creator": u"test_user_1_",\n@@ -267,15 +267,14 @@ def test_full_metadata_retrieval(self):\n                 u"last_comment_date": None,\n                 u"listCreators": [u"test_user_1_"],\n                 u"location": None,\n-                u"meta_type": u"Dexterity Item",\n                 u"portal_type": u"DXTestDocument",\n                 u"review_state": u"private",\n                 u"start": u"1950-01-01T00:00:00+00:00",\n                 u"sync_uid": None,\n                 u"title": u"Lorem Ipsum",\n                 u"total_comments": 0,\n-            },\n-            first_item,\n+            }.items(),\n+            first_item.items(),\n         )\n         # This value changed in Plone 5.2\n         # (Dexterity gained support for getObjSize)\ndiff --git a/src/plone/restapi/tests/test_serializer_summary.py b/src/plone/restapi/tests/test_serializer_summary.py\nindex f8884e7d8..60c440d12 100644\n--- a/src/plone/restapi/tests/test_serializer_summary.py\n+++ b/src/plone/restapi/tests/test_serializer_summary.py\n@@ -142,7 +142,7 @@ def test_brain_summary_includes_all_metadata_fields(self):\n             summary["mime_type"] = u"text/plain"\n \n         self.maxDiff = None\n-        self.assertDictEqual(\n+        self.assertLessEqual(\n             {\n                 "@id": u"http://nohost/plone/doc1",\n                 "@type": u"DXTestDocument",\n@@ -178,7 +178,6 @@ def test_brain_summary_includes_all_metadata_fields(self):\n                 "last_comment_date": None,\n                 "listCreators": [u"test_user_1_"],\n                 "location": None,\n-                "meta_type": u"Dexterity Item",\n                 "mime_type": u"text/plain",\n                 "modified": u"2017-01-21T01:14:48+00:00",\n                 "portal_type": u"DXTestDocument",\n@@ -187,8 +186,8 @@ def test_brain_summary_includes_all_metadata_fields(self):\n                 "sync_uid": None,\n                 "title": u"Lorem Ipsum",\n                 "total_comments": 0,\n-            },\n-            summary,\n+            }.items(),\n+            summary.items(),\n         )\n \n     def test_dx_type_summary(self):\n'

