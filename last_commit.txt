Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2016-10-25T15:34:46-05:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/1e9ed05976589628677aef7d9f1e8ac3c7c73b24

Remove jquery.cookie from stub_js_modules.
Remove jquery.cookie from plone-logged-in bundle's stub_js_modules.
The toolbar, which has a dependency on jquery.cookie, was moved from the plone bundle to plone-logged-in in CMPlone 5.1a2.

Files changed:
M CHANGES.rst
M plone/app/upgrade/v51/betas.py
M plone/app/upgrade/v51/configure.zcml
M plone/app/upgrade/v51/profiles/to_beta1/registry.xml

diff --git a/CHANGES.rst b/CHANGES.rst
index 485acf4..ac8d9ce 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -11,6 +11,11 @@ Breaking changes:
 
 New features:
 
+- Remove jquery.cookie from plone-logged-in bundle's stub_js_modules.
+  The toolbar, which has a dependency on jquery.cookie,
+  was moved from the plone bundle to plone-logged-in in CMPlone 5.1a2.
+  [thet]
+
 - Products.MimetypesRegistry has no longer a skins layer, remove it.
   [jensens]
 
diff --git a/plone/app/upgrade/v51/betas.py b/plone/app/upgrade/v51/betas.py
index d17b02c..4a9af90 100644
--- a/plone/app/upgrade/v51/betas.py
+++ b/plone/app/upgrade/v51/betas.py
@@ -52,3 +52,21 @@ def remove_leftover_skin_layers(context):
     """Products.MimetypesRegistry no longer has a skin layer, remove it.
     """
     cleanUpSkinsTool(context)
+
+
+def remove_jquery_cookie_from_stub_js_modules(context):
+    """Remove jquery.cookie from plone-logged-in bundle's stub_js_modules.
+    The toolbar, which has a dependency on jquery.cookie, was moved from the
+    plone bundle to plone-logged-in in CMPlone 5.1a2.
+    """
+    registry = getUtility(IRegistry)
+
+    import pdb
+    pdb.set_trace()
+
+    reg_key = 'plone.bundles/plone-logged-in.stub_js_modules'
+
+    value = registry.get(reg_key, [])
+    if 'jquery.cookie' in value:
+        value.remove('jquery.cookie')
+        registry[reg_key] = value
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index 6e2dcc9..ffbbb88 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -63,6 +63,16 @@ Add new Mockup 2.4.0 relateditems resource url.
            handler=".betas.remove_leftover_skin_layers"
            />
 
+      <gs:upgradeStep
+           title="Remove jquery.cookie from plone-logged-in stub_js_modules"
+           description="
+Remove jquery.cookie from plone-logged-in bundle's stub_js_modules.
+The toolbar, which has a dependency on jquery.cookie,
+was moved from the plone bundle to plone-logged-in in CMPlone 5.1a2.
+           "
+           handler=".betas.remove_jquery_cookie_from_stub_js_modules"
+           />
+
     </gs:upgradeSteps>
 
 </configure>
diff --git a/plone/app/upgrade/v51/profiles/to_beta1/registry.xml b/plone/app/upgrade/v51/profiles/to_beta1/registry.xml
index 9593804..ed87881 100644
--- a/plone/app/upgrade/v51/profiles/to_beta1/registry.xml
+++ b/plone/app/upgrade/v51/profiles/to_beta1/registry.xml
@@ -17,4 +17,5 @@
   <!-- Add sort_on field to search controlpanel -->
   <records interface="Products.CMFPlone.interfaces.ISearchSchema"
            prefix="plone" />
+
 </registry>


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2016-10-25T20:39:08-05:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/ebd91ef9620163bf62f9fd4004265fc9250702b9

forgot pdb

Files changed:
M plone/app/upgrade/v51/betas.py

diff --git a/plone/app/upgrade/v51/betas.py b/plone/app/upgrade/v51/betas.py
index 4a9af90..4fdecdc 100644
--- a/plone/app/upgrade/v51/betas.py
+++ b/plone/app/upgrade/v51/betas.py
@@ -60,12 +60,7 @@ def remove_jquery_cookie_from_stub_js_modules(context):
     plone bundle to plone-logged-in in CMPlone 5.1a2.
     """
     registry = getUtility(IRegistry)
-
-    import pdb
-    pdb.set_trace()
-
     reg_key = 'plone.bundles/plone-logged-in.stub_js_modules'
-
     value = registry.get(reg_key, [])
     if 'jquery.cookie' in value:
         value.remove('jquery.cookie')


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2016-10-26T15:16:41+02:00
Author: agitator (agitator) <hpeter@agitator.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/f4dd789cf978497e8058b017c40bbfb6d9038833

Merge pull request #93 from plone/thet-jcookiefix

Remove jquery.cookie from stub_js_modules.

Files changed:
M CHANGES.rst
M plone/app/upgrade/v51/betas.py
M plone/app/upgrade/v51/configure.zcml
M plone/app/upgrade/v51/profiles/to_beta1/registry.xml

diff --git a/CHANGES.rst b/CHANGES.rst
index 485acf4..ac8d9ce 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -11,6 +11,11 @@ Breaking changes:
 
 New features:
 
+- Remove jquery.cookie from plone-logged-in bundle's stub_js_modules.
+  The toolbar, which has a dependency on jquery.cookie,
+  was moved from the plone bundle to plone-logged-in in CMPlone 5.1a2.
+  [thet]
+
 - Products.MimetypesRegistry has no longer a skins layer, remove it.
   [jensens]
 
diff --git a/plone/app/upgrade/v51/betas.py b/plone/app/upgrade/v51/betas.py
index d17b02c..4fdecdc 100644
--- a/plone/app/upgrade/v51/betas.py
+++ b/plone/app/upgrade/v51/betas.py
@@ -52,3 +52,16 @@ def remove_leftover_skin_layers(context):
     """Products.MimetypesRegistry no longer has a skin layer, remove it.
     """
     cleanUpSkinsTool(context)
+
+
+def remove_jquery_cookie_from_stub_js_modules(context):
+    """Remove jquery.cookie from plone-logged-in bundle's stub_js_modules.
+    The toolbar, which has a dependency on jquery.cookie, was moved from the
+    plone bundle to plone-logged-in in CMPlone 5.1a2.
+    """
+    registry = getUtility(IRegistry)
+    reg_key = 'plone.bundles/plone-logged-in.stub_js_modules'
+    value = registry.get(reg_key, [])
+    if 'jquery.cookie' in value:
+        value.remove('jquery.cookie')
+        registry[reg_key] = value
diff --git a/plone/app/upgrade/v51/configure.zcml b/plone/app/upgrade/v51/configure.zcml
index 6e2dcc9..ffbbb88 100644
--- a/plone/app/upgrade/v51/configure.zcml
+++ b/plone/app/upgrade/v51/configure.zcml
@@ -63,6 +63,16 @@ Add new Mockup 2.4.0 relateditems resource url.
            handler=".betas.remove_leftover_skin_layers"
            />
 
+      <gs:upgradeStep
+           title="Remove jquery.cookie from plone-logged-in stub_js_modules"
+           description="
+Remove jquery.cookie from plone-logged-in bundle's stub_js_modules.
+The toolbar, which has a dependency on jquery.cookie,
+was moved from the plone bundle to plone-logged-in in CMPlone 5.1a2.
+           "
+           handler=".betas.remove_jquery_cookie_from_stub_js_modules"
+           />
+
     </gs:upgradeSteps>
 
 </configure>
diff --git a/plone/app/upgrade/v51/profiles/to_beta1/registry.xml b/plone/app/upgrade/v51/profiles/to_beta1/registry.xml
index 9593804..ed87881 100644
--- a/plone/app/upgrade/v51/profiles/to_beta1/registry.xml
+++ b/plone/app/upgrade/v51/profiles/to_beta1/registry.xml
@@ -17,4 +17,5 @@
   <!-- Add sort_on field to search controlpanel -->
   <records interface="Products.CMFPlone.interfaces.ISearchSchema"
            prefix="plone" />
+
 </registry>


