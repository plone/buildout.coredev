Repository: plone.app.layout


Branch: refs/heads/3.x
Date: 2022-08-01T15:54:29+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.layout/commit/4cbba24cecd4b1f108cbd54f48e15081be94c2c9

fix test, the Title in the portal is set through the registry

Files changed:
M plone/app/layout/globals/tests/test_portal.py

b'diff --git a/plone/app/layout/globals/tests/test_portal.py b/plone/app/layout/globals/tests/test_portal.py\nindex 3b8e4fa2..ec38af09 100644\n--- a/plone/app/layout/globals/tests/test_portal.py\n+++ b/plone/app/layout/globals/tests/test_portal.py\n@@ -67,7 +67,9 @@ def test_navigation_root_path(self):\n         self.assertEqual(view.navigation_root_path(), getNavigationRoot(self.folder))\n \n     def test_navigation_root_title(self):\n-        self.portal.Title = "Portal title"\n+        registry = getUtility(IRegistry)\n+        self.site_settings = registry.forInterface(ISiteSchema, prefix="plone")\n+        self.site_settings.site_title = "Portal title"\n         self.assertEqual(self.view.navigation_root_title(), "Portal title")\n         members = self.portal["Members"]\n         # mark a folder "between" self.folder and self.portal with\n'

Repository: plone.app.layout


Branch: refs/heads/3.x
Date: 2022-08-01T15:55:09+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.layout/commit/fa43a5ef8a42d36dc7e38e8e25f9989f17d5fbe7

get the title from the registry in case the navigation root is the portal object

Files changed:
M plone/app/layout/globals/portal.py

b'diff --git a/plone/app/layout/globals/portal.py b/plone/app/layout/globals/portal.py\nindex 321c7b68..b21d0ab7 100644\n--- a/plone/app/layout/globals/portal.py\n+++ b/plone/app/layout/globals/portal.py\n@@ -11,6 +11,7 @@\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.interfaces import ISearchSchema\n from Products.CMFPlone.interfaces import ISiteSchema\n+from Products.CMFPlone.interfaces import IPloneSiteRoot\n from Products.Five.browser import BrowserView\n from zope.component import getUtility\n from zope.component import providedBy\n@@ -53,6 +54,10 @@ def navigation_root(self):\n \n     @memoize\n     def navigation_root_title(self):\n+        navigation_root = self.navigation_root()\n+        if IPloneSiteRoot.providedBy(navigation_root):\n+            return self.portal_title()\n+\n         title = self.navigation_root().Title\n         if callable(title):\n             return title()\n'

Repository: plone.app.layout


Branch: refs/heads/3.x
Date: 2022-08-01T15:55:12+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.layout/commit/03167d27d63bbe73a144717c8a2891e1d110193e

changelog

Files changed:
A news/317.bugfix

b'diff --git a/news/317.bugfix b/news/317.bugfix\nnew file mode 100644\nindex 00000000..d58b0b42\n--- /dev/null\n+++ b/news/317.bugfix\n@@ -0,0 +1,2 @@\n+get the title of the navigation root from the registry when the navigation root object is the portal object\n+[erral]\n'

Repository: plone.app.layout


Branch: refs/heads/3.x
Date: 2022-08-01T17:50:21+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.layout/commit/461eef6f0e4db0a069540235d3da4b5f086fb79f

Unicode value

Files changed:
M plone/app/layout/globals/tests/test_portal.py

b'diff --git a/plone/app/layout/globals/tests/test_portal.py b/plone/app/layout/globals/tests/test_portal.py\nindex ec38af09..021708d4 100644\n--- a/plone/app/layout/globals/tests/test_portal.py\n+++ b/plone/app/layout/globals/tests/test_portal.py\n@@ -69,7 +69,7 @@ def test_navigation_root_path(self):\n     def test_navigation_root_title(self):\n         registry = getUtility(IRegistry)\n         self.site_settings = registry.forInterface(ISiteSchema, prefix="plone")\n-        self.site_settings.site_title = "Portal title"\n+        self.site_settings.site_title = u"Portal title"\n         self.assertEqual(self.view.navigation_root_title(), "Portal title")\n         members = self.portal["Members"]\n         # mark a folder "between" self.folder and self.portal with\n'

Repository: plone.app.layout


Branch: refs/heads/3.x
Date: 2022-08-17T16:31:46+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.layout/commit/6b3397236c195eb9820eb49583027230dc8ee5f1

Merge pull request #318 from plone/erral-issue-317-branch-3.x

get the title from the registry in case the navigation root is the portal object [Plone 5.2]

Files changed:
A news/317.bugfix
M plone/app/layout/globals/portal.py
M plone/app/layout/globals/tests/test_portal.py

b'diff --git a/news/317.bugfix b/news/317.bugfix\nnew file mode 100644\nindex 00000000..d58b0b42\n--- /dev/null\n+++ b/news/317.bugfix\n@@ -0,0 +1,2 @@\n+get the title of the navigation root from the registry when the navigation root object is the portal object\n+[erral]\ndiff --git a/plone/app/layout/globals/portal.py b/plone/app/layout/globals/portal.py\nindex 321c7b68..b21d0ab7 100644\n--- a/plone/app/layout/globals/portal.py\n+++ b/plone/app/layout/globals/portal.py\n@@ -11,6 +11,7 @@\n from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.interfaces import ISearchSchema\n from Products.CMFPlone.interfaces import ISiteSchema\n+from Products.CMFPlone.interfaces import IPloneSiteRoot\n from Products.Five.browser import BrowserView\n from zope.component import getUtility\n from zope.component import providedBy\n@@ -53,6 +54,10 @@ def navigation_root(self):\n \n     @memoize\n     def navigation_root_title(self):\n+        navigation_root = self.navigation_root()\n+        if IPloneSiteRoot.providedBy(navigation_root):\n+            return self.portal_title()\n+\n         title = self.navigation_root().Title\n         if callable(title):\n             return title()\ndiff --git a/plone/app/layout/globals/tests/test_portal.py b/plone/app/layout/globals/tests/test_portal.py\nindex 3b8e4fa2..021708d4 100644\n--- a/plone/app/layout/globals/tests/test_portal.py\n+++ b/plone/app/layout/globals/tests/test_portal.py\n@@ -67,7 +67,9 @@ def test_navigation_root_path(self):\n         self.assertEqual(view.navigation_root_path(), getNavigationRoot(self.folder))\n \n     def test_navigation_root_title(self):\n-        self.portal.Title = "Portal title"\n+        registry = getUtility(IRegistry)\n+        self.site_settings = registry.forInterface(ISiteSchema, prefix="plone")\n+        self.site_settings.site_title = u"Portal title"\n         self.assertEqual(self.view.navigation_root_title(), "Portal title")\n         members = self.portal["Members"]\n         # mark a folder "between" self.folder and self.portal with\n'

