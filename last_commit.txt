Repository: plone.namedfile


Branch: refs/heads/master
Date: 2020-04-05T23:13:31+02:00
Author: Timo Stollenwerk (tisto) <stollenwerk@kitconcept.com>
Commit: https://github.com/plone/plone.namedfile/commit/7c405305d47a4a7a3ca440093b36df5e7a04fa3c

Fix unclosed file error.

Files changed:
M plone/namedfile/scaling.py

b"diff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py\nindex e2838d0..02e348c 100644\n--- a/plone/namedfile/scaling.py\n+++ b/plone/namedfile/scaling.py\n@@ -271,6 +271,12 @@ def __call__(\n             data, contentType=mimetype, filename=orig_value.filename,\n         )\n         value.fieldname = fieldname\n+\n+        # make sure the file is closed to avoid error:\n+        # ZODB-5.5.1-py3.7.egg/ZODB/blob.py:339: ResourceWarning:\n+        # unclosed file <_io.FileIO ... mode='rb' closefd=True>\n+        orig_data.close()\n+\n         return value, format_, dimensions\n \n \n"

Repository: plone.namedfile


Branch: refs/heads/master
Date: 2020-04-08T13:02:36+02:00
Author: Timo Stollenwerk (tisto) <stollenwerk@kitconcept.com>
Commit: https://github.com/plone/plone.namedfile/commit/b703b4776a323972e843e16a1413724e813a2892

Close file only if it is a BlobFile.

Files changed:
M plone/namedfile/scaling.py

b"diff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py\nindex 02e348c..45c53b6 100644\n--- a/plone/namedfile/scaling.py\n+++ b/plone/namedfile/scaling.py\n@@ -20,6 +20,7 @@\n from Products.Five import BrowserView\n from xml.sax.saxutils import quoteattr\n from zExceptions import Unauthorized\n+from ZODB.blob import BlobFile\n from ZODB.POSException import ConflictError\n from zope.component import queryUtility\n from zope.deprecation import deprecate\n@@ -275,7 +276,8 @@ def __call__(\n         # make sure the file is closed to avoid error:\n         # ZODB-5.5.1-py3.7.egg/ZODB/blob.py:339: ResourceWarning:\n         # unclosed file <_io.FileIO ... mode='rb' closefd=True>\n-        orig_data.close()\n+        if isinstance(orig_data, BlobFile):\n+            orig_data.close()\n \n         return value, format_, dimensions\n \n"

Repository: plone.namedfile


Branch: refs/heads/master
Date: 2020-04-08T13:42:16+02:00
Author: Timo Stollenwerk (tisto) <stollenwerk@kitconcept.com>
Commit: https://github.com/plone/plone.namedfile/commit/78419b2531c75a595f117cd0cbdbd47f7cb46875

Add changelog entry for #89

Files changed:
A news/89.bugfix

b'diff --git a/news/89.bugfix b/news/89.bugfix\nnew file mode 100644\nindex 0000000..f98f93d\n--- /dev/null\n+++ b/news/89.bugfix\n@@ -0,0 +1 @@\n+Close BlobFile in DefaultImageScalingFactory. [timo]\n'

Repository: plone.namedfile


Branch: refs/heads/master
Date: 2020-04-14T03:30:12+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.namedfile/commit/7071e036d8c3ac43a1d748692c1320948d17f1a0

Merge pull request #88 from plone/fix-unclosed-file-error

Fix unclosed file error

Files changed:
A news/89.bugfix
M plone/namedfile/scaling.py

b"diff --git a/news/89.bugfix b/news/89.bugfix\nnew file mode 100644\nindex 0000000..f98f93d\n--- /dev/null\n+++ b/news/89.bugfix\n@@ -0,0 +1 @@\n+Close BlobFile in DefaultImageScalingFactory. [timo]\ndiff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py\nindex e2838d0..45c53b6 100644\n--- a/plone/namedfile/scaling.py\n+++ b/plone/namedfile/scaling.py\n@@ -20,6 +20,7 @@\n from Products.Five import BrowserView\n from xml.sax.saxutils import quoteattr\n from zExceptions import Unauthorized\n+from ZODB.blob import BlobFile\n from ZODB.POSException import ConflictError\n from zope.component import queryUtility\n from zope.deprecation import deprecate\n@@ -271,6 +272,13 @@ def __call__(\n             data, contentType=mimetype, filename=orig_value.filename,\n         )\n         value.fieldname = fieldname\n+\n+        # make sure the file is closed to avoid error:\n+        # ZODB-5.5.1-py3.7.egg/ZODB/blob.py:339: ResourceWarning:\n+        # unclosed file <_io.FileIO ... mode='rb' closefd=True>\n+        if isinstance(orig_data, BlobFile):\n+            orig_data.close()\n+\n         return value, format_, dimensions\n \n \n"

