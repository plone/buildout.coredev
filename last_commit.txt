Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-01-25T12:41:53+01:00
Author: Víctor Fernández de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/0b0fcda69fc89a8ff4f743fdda815b5981a0dc4b

add nav_title attribute to breadcrumbs (#1050)

* add nav_title attribute to breadcrumbs

* Fix documentation tests

Files changed:
A news/1049.feature
M src/plone/restapi/services/breadcrumbs/get.py
M src/plone/restapi/tests/http-examples/breadcrumbs.resp
M src/plone/restapi/tests/http-examples/expansion_expanded.resp
M src/plone/restapi/tests/http-examples/expansion_expanded_full.resp
M src/plone/restapi/tests/test_expansion.py
M src/plone/restapi/tests/test_services_breadcrumbs.py

b'diff --git a/news/1049.feature b/news/1049.feature\nnew file mode 100644\nindex 000000000..85fcd6188\n--- /dev/null\n+++ b/news/1049.feature\n@@ -0,0 +1,2 @@\n+- Add nav_title attribute to breadcrumbs endpoint\n+  [sneridagh]\ndiff --git a/src/plone/restapi/services/breadcrumbs/get.py b/src/plone/restapi/services/breadcrumbs/get.py\nindex ab11ca3e4..b14b4ab40 100644\n--- a/src/plone/restapi/services/breadcrumbs/get.py\n+++ b/src/plone/restapi/services/breadcrumbs/get.py\n@@ -28,7 +28,14 @@ def __call__(self, expand=False):\n         )\n         items = []\n         for crumb in breadcrumbs_view.breadcrumbs():\n-            items.append({"title": crumb["Title"], "@id": crumb["absolute_url"]})\n+\n+            items.append(\n+                {\n+                    "title": crumb["Title"],\n+                    "@id": crumb["absolute_url"],\n+                    "nav_title": crumb.get("nav_title", None),\n+                }\n+            )\n \n         result["breadcrumbs"]["items"] = items\n         return result\ndiff --git a/src/plone/restapi/tests/http-examples/breadcrumbs.resp b/src/plone/restapi/tests/http-examples/breadcrumbs.resp\nindex 78aebf256..0c7a43274 100644\n--- a/src/plone/restapi/tests/http-examples/breadcrumbs.resp\n+++ b/src/plone/restapi/tests/http-examples/breadcrumbs.resp\n@@ -6,6 +6,7 @@ Content-Type: application/json\n   "items": [\n     {\n       "@id": "http://localhost:55001/plone/front-page", \n+      "nav_title": null, \n       "title": "Welcome to Plone"\n     }\n   ]\ndiff --git a/src/plone/restapi/tests/http-examples/expansion_expanded.resp b/src/plone/restapi/tests/http-examples/expansion_expanded.resp\nindex f9599d91b..f033dbb51 100644\n--- a/src/plone/restapi/tests/http-examples/expansion_expanded.resp\n+++ b/src/plone/restapi/tests/http-examples/expansion_expanded.resp\n@@ -11,6 +11,7 @@ Content-Type: application/json\n       "items": [\n         {\n           "@id": "http://localhost:55001/plone/front-page", \n+          "nav_title": null, \n           "title": "Welcome to Plone"\n         }\n       ]\ndiff --git a/src/plone/restapi/tests/http-examples/expansion_expanded_full.resp b/src/plone/restapi/tests/http-examples/expansion_expanded_full.resp\nindex c56156878..9a61a99c7 100644\n--- a/src/plone/restapi/tests/http-examples/expansion_expanded_full.resp\n+++ b/src/plone/restapi/tests/http-examples/expansion_expanded_full.resp\n@@ -111,6 +111,7 @@ Content-Type: application/json\n       "items": [\n         {\n           "@id": "http://localhost:55001/plone/front-page", \n+          "nav_title": null, \n           "title": "Welcome to Plone"\n         }\n       ]\ndiff --git a/src/plone/restapi/tests/test_expansion.py b/src/plone/restapi/tests/test_expansion.py\nindex 9dbeda39f..cc3bdc156 100644\n--- a/src/plone/restapi/tests/test_expansion.py\n+++ b/src/plone/restapi/tests/test_expansion.py\n@@ -215,7 +215,13 @@ def test_breadcrumbs_expanded(self):\n         response = self.api_session.get("/folder", params={"expand": "breadcrumbs"})\n         self.assertEqual(response.status_code, 200)\n         self.assertEqual(\n-            [{u"title": u"Some Folder", u"@id": self.portal_url + u"/folder"}],\n+            [\n+                {\n+                    u"title": u"Some Folder",\n+                    u"@id": self.portal_url + u"/folder",\n+                    u"nav_title": None,\n+                }\n+            ],\n             response.json()["@components"]["breadcrumbs"]["items"],\n         )\n \ndiff --git a/src/plone/restapi/tests/test_services_breadcrumbs.py b/src/plone/restapi/tests/test_services_breadcrumbs.py\nindex 820919338..b41339d50 100644\n--- a/src/plone/restapi/tests/test_services_breadcrumbs.py\n+++ b/src/plone/restapi/tests/test_services_breadcrumbs.py\n@@ -45,10 +45,15 @@ def test_breadcrumbs(self):\n             {\n                 "@id": self.portal_url + u"/folder/doc1/@breadcrumbs",\n                 "items": [\n-                    {u"@id": self.portal_url + u"/folder", u"title": u"Some Folder"},\n+                    {\n+                        u"@id": self.portal_url + u"/folder",\n+                        u"title": u"Some Folder",\n+                        u"nav_title": None,\n+                    },\n                     {\n                         u"@id": self.portal_url + u"/folder/doc1",\n                         u"title": u"A document",\n+                        u"nav_title": None,\n                     },\n                 ],\n             },\n'

