Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2020-09-21T17:27:25+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.upgrade/commit/6c698f79c369ad35be4fd5bb39ce67a3b104925a

fix edge case, where relations are missing i.e. from_attribute in catalog.

Files changed:
A news/244.bugfix
M plone/app/upgrade/v52/betas.py

b'diff --git a/news/244.bugfix b/news/244.bugfix\nnew file mode 100644\nindex 00000000..1f9e3066\n--- /dev/null\n+++ b/news/244.bugfix\n@@ -0,0 +1,2 @@\n+Fixes a rare case in v52/betas while migration of relations: Missing attributes on cataloged relations are safely ignored.\n+[jensens]\n\\ No newline at end of file\ndiff --git a/plone/app/upgrade/v52/betas.py b/plone/app/upgrade/v52/betas.py\nindex 0f613dc2..bc1b81c8 100644\n--- a/plone/app/upgrade/v52/betas.py\n+++ b/plone/app/upgrade/v52/betas.py\n@@ -94,7 +94,13 @@ def remove_interface_indexes_from_relations_catalog():\n         except KeyError:\n             intids.register(rel)\n             added_rel_intids += 1\n-        catalog.unindex(rel)\n+        try:\n+            catalog.unindex(rel)\n+        except KeyError:\n+            logger.warning("Broken relation ignored due to impossible unindex")\n+            # there are rare cases with broken relations where the attributes\n+            # are not complete, those can be ignored\n+            continue\n         try:\n             catalog.index(rel)\n         except IntIdMissingError:\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2020-09-21T22:03:28+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.app.upgrade/commit/58b3b6e00bfc21c4c86d04f8e4089224c6e1265a

Merge pull request #244 from plone/jensens-fix-relationmigration

fix edge case, where relations attributes are missing in catalog

Files changed:
A news/244.bugfix
M plone/app/upgrade/v52/betas.py

b'diff --git a/news/244.bugfix b/news/244.bugfix\nnew file mode 100644\nindex 00000000..1f9e3066\n--- /dev/null\n+++ b/news/244.bugfix\n@@ -0,0 +1,2 @@\n+Fixes a rare case in v52/betas while migration of relations: Missing attributes on cataloged relations are safely ignored.\n+[jensens]\n\\ No newline at end of file\ndiff --git a/plone/app/upgrade/v52/betas.py b/plone/app/upgrade/v52/betas.py\nindex 0f613dc2..bc1b81c8 100644\n--- a/plone/app/upgrade/v52/betas.py\n+++ b/plone/app/upgrade/v52/betas.py\n@@ -94,7 +94,13 @@ def remove_interface_indexes_from_relations_catalog():\n         except KeyError:\n             intids.register(rel)\n             added_rel_intids += 1\n-        catalog.unindex(rel)\n+        try:\n+            catalog.unindex(rel)\n+        except KeyError:\n+            logger.warning("Broken relation ignored due to impossible unindex")\n+            # there are rare cases with broken relations where the attributes\n+            # are not complete, those can be ignored\n+            continue\n         try:\n             catalog.index(rel)\n         except IntIdMissingError:\n'

