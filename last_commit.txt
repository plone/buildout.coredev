Repository: plone.app.contentlisting


Branch: refs/heads/2.x
Date: 2022-08-06T20:45:42+02:00
Author: Mikel Larreategi (erral) <mlarreategi@codesyntax.com>
Commit: https://github.com/plone/plone.app.contentlisting/commit/b7e986c120a8c216a14bee024094c8272cd4ff82

build the mime-type icon with absolute url

Files changed:
A news/44.bugfix
M plone/app/contentlisting/contentlisting.py

b"diff --git a/news/44.bugfix b/news/44.bugfix\nnew file mode 100644\nindex 0000000..d55a0dd\n--- /dev/null\n+++ b/news/44.bugfix\n@@ -0,0 +1,2 @@\n+Build the mime-type icon url with an absolute url. Fixes #44\n+[erral]\ndiff --git a/plone/app/contentlisting/contentlisting.py b/plone/app/contentlisting/contentlisting.py\nindex 2dc6588..778b260 100644\n--- a/plone/app/contentlisting/contentlisting.py\n+++ b/plone/app/contentlisting/contentlisting.py\n@@ -3,7 +3,7 @@\n from Acquisition import aq_base\n from plone.app.contentlisting.interfaces import IContentListing\n from plone.app.contentlisting.interfaces import IContentListingObject\n-from plone.app.layout.navigation.root import getNavigationRoot\n+from plone.app.layout.navigation.root import getNavigationRootObject\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n@@ -164,7 +164,9 @@ def isVisibleInNav(self):\n \n     def MimeTypeIcon(self):\n         mimeicon = None\n-        navroot = getNavigationRoot(self._brain)\n+        portal_url_object = getToolByName(self._brain, 'portal_url')\n+        portal = portal_url_object.getPortalObject()\n+        navroot = getNavigationRootObject(self._brain, portal)\n         contenttype = aq_base(\n             getattr(self._brain, 'mime_type', None),\n         )\n@@ -176,7 +178,7 @@ def MimeTypeIcon(self):\n             ctype = mtt.lookup(contenttype)\n             if ctype:\n                 mimeicon = os.path.join(\n-                    navroot,\n+                    navroot.absolute_url(),\n                     guess_icon_path(ctype[0]),\n                 )\n \n"

Repository: plone.app.contentlisting


Branch: refs/heads/2.x
Date: 2022-08-13T17:16:39+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contentlisting/commit/1280e88d443ba826a159c05ecd92623db96825cb

Merge pull request #45 from plone/erral-issue-44-branch-2.x

build the mime-type icon with absolute url

Files changed:
A news/44.bugfix
M plone/app/contentlisting/contentlisting.py

b"diff --git a/news/44.bugfix b/news/44.bugfix\nnew file mode 100644\nindex 0000000..d55a0dd\n--- /dev/null\n+++ b/news/44.bugfix\n@@ -0,0 +1,2 @@\n+Build the mime-type icon url with an absolute url. Fixes #44\n+[erral]\ndiff --git a/plone/app/contentlisting/contentlisting.py b/plone/app/contentlisting/contentlisting.py\nindex 2dc6588..778b260 100644\n--- a/plone/app/contentlisting/contentlisting.py\n+++ b/plone/app/contentlisting/contentlisting.py\n@@ -3,7 +3,7 @@\n from Acquisition import aq_base\n from plone.app.contentlisting.interfaces import IContentListing\n from plone.app.contentlisting.interfaces import IContentListingObject\n-from plone.app.layout.navigation.root import getNavigationRoot\n+from plone.app.layout.navigation.root import getNavigationRootObject\n from plone.i18n.normalizer.interfaces import IIDNormalizer\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n@@ -164,7 +164,9 @@ def isVisibleInNav(self):\n \n     def MimeTypeIcon(self):\n         mimeicon = None\n-        navroot = getNavigationRoot(self._brain)\n+        portal_url_object = getToolByName(self._brain, 'portal_url')\n+        portal = portal_url_object.getPortalObject()\n+        navroot = getNavigationRootObject(self._brain, portal)\n         contenttype = aq_base(\n             getattr(self._brain, 'mime_type', None),\n         )\n@@ -176,7 +178,7 @@ def MimeTypeIcon(self):\n             ctype = mtt.lookup(contenttype)\n             if ctype:\n                 mimeicon = os.path.join(\n-                    navroot,\n+                    navroot.absolute_url(),\n                     guess_icon_path(ctype[0]),\n                 )\n \n"

