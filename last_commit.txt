Repository: plone.volto


Branch: refs/heads/main
Date: 2024-06-18T17:38:12+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.volto/commit/2f42bc45f92784adfa79977544cbb2e7f7b3598f

Do not fail on startup when the requests library is missing.

Conditionally load the views to migrate to Volto: only when the ``requests`` library is available.
We don't want to make this a hard dependency.
If you need the migration views, you should include the ``requests`` package yourself.
Fixes https://github.com/plone/plone.volto/issues/152

Files changed:
A news/152.bugfix
M src/plone/volto/browser/configure.zcml

b'diff --git a/news/152.bugfix b/news/152.bugfix\nnew file mode 100644\nindex 0000000..34dc4e5\n--- /dev/null\n+++ b/news/152.bugfix\n@@ -0,0 +1,5 @@\n+Do not fail on startup when the ``requests`` library is missing.\n+Conditionally load the views to migrate to Volto: only when the ``requests`` library is available.\n+We don\'t want to make this a hard dependency.\n+If you need the migration views, you should include the ``requests`` package yourself.\n+[maurits]\ndiff --git a/src/plone/volto/browser/configure.zcml b/src/plone/volto/browser/configure.zcml\nindex 78ce7e6..ccebe58 100644\n--- a/src/plone/volto/browser/configure.zcml\n+++ b/src/plone/volto/browser/configure.zcml\n@@ -32,23 +32,25 @@\n       zcml:condition="have plone-5"\n       />\n \n-  <browser:page\n-      name="migrate_richtext"\n-      for="zope.interface.Interface"\n-      class=".migrate_richtext.MigrateRichTextToVoltoBlocks"\n-      template="migrate_richtext.pt"\n-      permission="cmf.ManagePortal"\n-      zcml:condition="have plone-60"\n-      />\n+  <configure zcml:condition="installed requests">\n+    <browser:page\n+        name="migrate_richtext"\n+        for="zope.interface.Interface"\n+        class=".migrate_richtext.MigrateRichTextToVoltoBlocks"\n+        template="migrate_richtext.pt"\n+        permission="cmf.ManagePortal"\n+        zcml:condition="have plone-60"\n+        />\n \n-  <browser:page\n-      name="migrate_to_volto"\n-      for="zope.interface.Interface"\n-      class=".migrate_to_volto.MigrateToVolto"\n-      template="migrate_to_volto.pt"\n-      permission="cmf.ManagePortal"\n-      zcml:condition="have plone-60"\n-      />\n+    <browser:page\n+        name="migrate_to_volto"\n+        for="zope.interface.Interface"\n+        class=".migrate_to_volto.MigrateToVolto"\n+        template="migrate_to_volto.pt"\n+        permission="cmf.ManagePortal"\n+        zcml:condition="have plone-60"\n+        />\n+  </configure>\n \n   <browser:viewlet\n       name="voltobackendwarning"\n'

Repository: plone.volto


Branch: refs/heads/main
Date: 2024-06-18T15:08:17-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.volto/commit/7df9f28766beac1a70d1c00f6b2057ed31d05b4f

Merge pull request #154 from plone/maurits-conditional-requests

Do not fail on startup when the requests library is missing.

Files changed:
A news/152.bugfix
M src/plone/volto/browser/configure.zcml

b'diff --git a/news/152.bugfix b/news/152.bugfix\nnew file mode 100644\nindex 0000000..34dc4e5\n--- /dev/null\n+++ b/news/152.bugfix\n@@ -0,0 +1,5 @@\n+Do not fail on startup when the ``requests`` library is missing.\n+Conditionally load the views to migrate to Volto: only when the ``requests`` library is available.\n+We don\'t want to make this a hard dependency.\n+If you need the migration views, you should include the ``requests`` package yourself.\n+[maurits]\ndiff --git a/src/plone/volto/browser/configure.zcml b/src/plone/volto/browser/configure.zcml\nindex 78ce7e6..ccebe58 100644\n--- a/src/plone/volto/browser/configure.zcml\n+++ b/src/plone/volto/browser/configure.zcml\n@@ -32,23 +32,25 @@\n       zcml:condition="have plone-5"\n       />\n \n-  <browser:page\n-      name="migrate_richtext"\n-      for="zope.interface.Interface"\n-      class=".migrate_richtext.MigrateRichTextToVoltoBlocks"\n-      template="migrate_richtext.pt"\n-      permission="cmf.ManagePortal"\n-      zcml:condition="have plone-60"\n-      />\n+  <configure zcml:condition="installed requests">\n+    <browser:page\n+        name="migrate_richtext"\n+        for="zope.interface.Interface"\n+        class=".migrate_richtext.MigrateRichTextToVoltoBlocks"\n+        template="migrate_richtext.pt"\n+        permission="cmf.ManagePortal"\n+        zcml:condition="have plone-60"\n+        />\n \n-  <browser:page\n-      name="migrate_to_volto"\n-      for="zope.interface.Interface"\n-      class=".migrate_to_volto.MigrateToVolto"\n-      template="migrate_to_volto.pt"\n-      permission="cmf.ManagePortal"\n-      zcml:condition="have plone-60"\n-      />\n+    <browser:page\n+        name="migrate_to_volto"\n+        for="zope.interface.Interface"\n+        class=".migrate_to_volto.MigrateToVolto"\n+        template="migrate_to_volto.pt"\n+        permission="cmf.ManagePortal"\n+        zcml:condition="have plone-60"\n+        />\n+  </configure>\n \n   <browser:viewlet\n       name="voltobackendwarning"\n'

