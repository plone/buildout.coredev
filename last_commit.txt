Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2020-09-24T21:38:58+02:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/4dbed04891ed3e152b06d901ba591eead54ea594

Fix issue with @@search view when filtering by creation date

Files changed:
A news/3007.bugfix
M Products/CMFPlone/browser/search.py

b"diff --git a/Products/CMFPlone/browser/search.py b/Products/CMFPlone/browser/search.py\nindex 984a907821..b4abbca2df 100644\n--- a/Products/CMFPlone/browser/search.py\n+++ b/Products/CMFPlone/browser/search.py\n@@ -13,6 +13,7 @@\n from zope.component import queryUtility\n from zope.i18nmessageid import MessageFactory\n from zope.publisher.browser import BrowserView\n+from ZPublisher.HTTPRequest import record\n from ZTUtils import make_query\n \n import json\n@@ -121,6 +122,11 @@ def _filter_query(self, query):\n                 # created not a mapping\n                 del query['created']\n \n+        # https://github.com/plone/Products.CMFPlone/issues/3007\n+        # If 'created' exists and is of type 'record', then cast it as dict\n+        if 'created' in query and isinstance(query['created'], record):\n+            query['created'] = dict(query['created'])\n+\n         # respect `types_not_searched` setting\n         types = query.get('portal_type', [])\n         if 'query' in types:\ndiff --git a/news/3007.bugfix b/news/3007.bugfix\nnew file mode 100644\nindex 0000000000..a451e1cb14\n--- /dev/null\n+++ b/news/3007.bugfix\n@@ -0,0 +1,2 @@\n+Fix issue with @@search view when filtering by creation date\n+[frapell]\n"

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2020-09-24T22:54:46+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/6f9973962f5b840f0b22623627d26c95d4a48565

Merge pull request #3012 from plone/frapell-search-record

Fix advanced search issue #3007

Files changed:
A news/3007.bugfix
M Products/CMFPlone/browser/search.py

b"diff --git a/Products/CMFPlone/browser/search.py b/Products/CMFPlone/browser/search.py\nindex 984a907821..b4abbca2df 100644\n--- a/Products/CMFPlone/browser/search.py\n+++ b/Products/CMFPlone/browser/search.py\n@@ -13,6 +13,7 @@\n from zope.component import queryUtility\n from zope.i18nmessageid import MessageFactory\n from zope.publisher.browser import BrowserView\n+from ZPublisher.HTTPRequest import record\n from ZTUtils import make_query\n \n import json\n@@ -121,6 +122,11 @@ def _filter_query(self, query):\n                 # created not a mapping\n                 del query['created']\n \n+        # https://github.com/plone/Products.CMFPlone/issues/3007\n+        # If 'created' exists and is of type 'record', then cast it as dict\n+        if 'created' in query and isinstance(query['created'], record):\n+            query['created'] = dict(query['created'])\n+\n         # respect `types_not_searched` setting\n         types = query.get('portal_type', [])\n         if 'query' in types:\ndiff --git a/news/3007.bugfix b/news/3007.bugfix\nnew file mode 100644\nindex 0000000000..a451e1cb14\n--- /dev/null\n+++ b/news/3007.bugfix\n@@ -0,0 +1,2 @@\n+Fix issue with @@search view when filtering by creation date\n+[frapell]\n"

