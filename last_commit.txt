Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-05-20T22:23:46+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/18e4285585309b05731c76bfd57d173694fc4101

fixes #3962

Files changed:
A news/3962.bugfix
M Products/CMFPlone/controlpanel/browser/error_log_form.py
M setup.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/error_log_form.py b/Products/CMFPlone/controlpanel/browser/error_log_form.py\nindex b91169ff4c..a7886668ee 100644\n--- a/Products/CMFPlone/controlpanel/browser/error_log_form.py\n+++ b/Products/CMFPlone/controlpanel/browser/error_log_form.py\n@@ -1,14 +1,14 @@\n from DateTime import DateTime\n from plone.base import PloneMessageFactory as _\n+from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.utils import safe_nativestring\n from Products.Five import BrowserView\n \n-import plone.api as api\n-\n \n class ErrorLogUpdate(BrowserView):\n     def __call__(self):\n-        member = api.user.get_current()\n+        portal_membership = getToolByName("portal_membership")\n+        member = portal_membership.getAuthenticatedMember()\n \n         if getattr(self.request, "form.button.search", None) is not None:\n             search = self.request.form.get("search_entry")\ndiff --git a/news/3962.bugfix b/news/3962.bugfix\nnew file mode 100644\nindex 0000000000..d49decfcd7\n--- /dev/null\n+++ b/news/3962.bugfix\n@@ -0,0 +1 @@\n+Products.CMFPlone  must not depend on plone.api [@jensens]\ndiff --git a/setup.py b/setup.py\nindex 23eda3836d..52f7d51108 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -53,7 +53,6 @@\n         "borg.localrole",\n         "five.customerize",\n         "lxml",\n-        "plone.api >= 1.4.4",\n         "plone.app.content",\n         "plone.app.contentlisting",\n         "plone.app.contentmenu >= 2.0.1",\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-05-23T10:27:05+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/a66c685025f0e0d2c2d2be3a2c98817eacdda6b6

Update Products/CMFPlone/controlpanel/browser/error_log_form.py

Files changed:
M Products/CMFPlone/controlpanel/browser/error_log_form.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/error_log_form.py b/Products/CMFPlone/controlpanel/browser/error_log_form.py\nindex a7886668ee..9c61401dcf 100644\n--- a/Products/CMFPlone/controlpanel/browser/error_log_form.py\n+++ b/Products/CMFPlone/controlpanel/browser/error_log_form.py\n@@ -7,7 +7,7 @@\n \n class ErrorLogUpdate(BrowserView):\n     def __call__(self):\n-        portal_membership = getToolByName("portal_membership")\n+        portal_membership = getToolByName(self.context, "portal_membership")\n         member = portal_membership.getAuthenticatedMember()\n \n         if getattr(self.request, "form.button.search", None) is not None:\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-05-23T11:50:13+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/83440c49c7eee64bb13520bcbd2b5bc89406a4e8

Merge pull request #3963 from plone/fix-3962

fixes #3962

Files changed:
A news/3962.bugfix
M Products/CMFPlone/controlpanel/browser/error_log_form.py
M setup.py

b'diff --git a/Products/CMFPlone/controlpanel/browser/error_log_form.py b/Products/CMFPlone/controlpanel/browser/error_log_form.py\nindex b91169ff4c..9c61401dcf 100644\n--- a/Products/CMFPlone/controlpanel/browser/error_log_form.py\n+++ b/Products/CMFPlone/controlpanel/browser/error_log_form.py\n@@ -1,14 +1,14 @@\n from DateTime import DateTime\n from plone.base import PloneMessageFactory as _\n+from Products.CMFCore.utils import getToolByName\n from Products.CMFPlone.utils import safe_nativestring\n from Products.Five import BrowserView\n \n-import plone.api as api\n-\n \n class ErrorLogUpdate(BrowserView):\n     def __call__(self):\n-        member = api.user.get_current()\n+        portal_membership = getToolByName(self.context, "portal_membership")\n+        member = portal_membership.getAuthenticatedMember()\n \n         if getattr(self.request, "form.button.search", None) is not None:\n             search = self.request.form.get("search_entry")\ndiff --git a/news/3962.bugfix b/news/3962.bugfix\nnew file mode 100644\nindex 0000000000..d49decfcd7\n--- /dev/null\n+++ b/news/3962.bugfix\n@@ -0,0 +1 @@\n+Products.CMFPlone  must not depend on plone.api [@jensens]\ndiff --git a/setup.py b/setup.py\nindex 23eda3836d..52f7d51108 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -53,7 +53,6 @@\n         "borg.localrole",\n         "five.customerize",\n         "lxml",\n-        "plone.api >= 1.4.4",\n         "plone.app.content",\n         "plone.app.contentlisting",\n         "plone.app.contentmenu >= 2.0.1",\n'

