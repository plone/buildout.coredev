Repository: plone.restapi


Branch: refs/heads/main
Date: 2024-10-18T09:30:52-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.restapi/commit/d6815a4f9326cc547c2fee4080a4c4070b72c3c8

Add a way to check for backend support of version-dependent features via the site service (#1826)

* Add a way to check for backend support of version-dependent features via the site service

* lint &amp; changelog

Files changed:
A news/1826.feature
M src/plone/restapi/services/site/get.py
M src/plone/restapi/tests/http-examples/site_get.resp

b'diff --git a/news/1826.feature b/news/1826.feature\nnew file mode 100644\nindex 000000000..3f21fa89a\n--- /dev/null\n+++ b/news/1826.feature\n@@ -0,0 +1 @@\n+Site service: Indicate whether the site supports filtering URL aliases by date. @davisagli\ndiff --git a/src/plone/restapi/services/site/get.py b/src/plone/restapi/services/site/get.py\nindex 43840a8b8..4ab0a9801 100644\n--- a/src/plone/restapi/services/site/get.py\n+++ b/src/plone/restapi/services/site/get.py\n@@ -10,6 +10,7 @@\n from Products.CMFPlone.interfaces import IImagingSchema\n from Products.CMFPlone.interfaces import ISiteSchema\n from Products.CMFPlone.utils import getSiteLogo\n+from Products.CMFPlone.controlpanel.browser.redirects import RedirectionSet\n from zope.component import adapter\n from zope.component import getMultiAdapter\n from zope.component import getUtility\n@@ -49,6 +50,7 @@ def __call__(self, expand=False):\n                 "plone.default_language": language_settings.default_language,\n                 "plone.available_languages": language_settings.available_languages,\n                 "plone.portal_timezone": self.plone_timezone(),\n+                "features": self.features(),\n             }\n         )\n \n@@ -73,6 +75,18 @@ def plone_timezone(self):\n \n         return portal_timezone\n \n+    def features(self):\n+        """Indicates which features are supported by this site.\n+\n+        This can be used by a client to check for version-dependent features.\n+        """\n+        result = {\n+            "filter_aliases_by_date": hasattr(\n+                RedirectionSet, "supports_date_range_filtering"\n+            ),\n+        }\n+        return result\n+\n \n class SiteGet(Service):\n     def reply(self):\ndiff --git a/src/plone/restapi/tests/http-examples/site_get.resp b/src/plone/restapi/tests/http-examples/site_get.resp\nindex 28a4c1167..43a502cc1 100644\n--- a/src/plone/restapi/tests/http-examples/site_get.resp\n+++ b/src/plone/restapi/tests/http-examples/site_get.resp\n@@ -3,6 +3,9 @@ Content-Type: application/json\n \n {\n     "@id": "http://localhost:55001/plone/@site",\n+    "features": {\n+        "filter_aliases_by_date": false\n+    },\n     "plone.allowed_sizes": [\n         "huge 1600:65536",\n         "great 1200:65536",\n'

