Repository: icalendar


Branch: refs/heads/master
Date: 2020-03-18T20:04:09+01:00
Author: Kamil Mankowski (kam193) (kam193) <kam193@wp.pl>
Commit: https://github.com/collective/icalendar/commit/9b26e188f120d3f9ae5e1d4aed833b4795852ffb

Default type vText when converting vRecur to ical

Use default type when converting recurence definition
to ical string.

Files changed:
M CHANGES.rst
M docs/credits.rst
M src/icalendar/prop.py
M src/icalendar/tests/test_unit_prop.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex 7fbaa93..4e62e5e 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -15,6 +15,7 @@ New features:\n Bug fixes:\n \n - Fixed a docs issue related to building on Read the Docs [davidfischer]\n+- Use ``vText`` as default type, when convert recurrence definition to ical string. [kam193] \n \n \n 4.0.4 (2019-11-25)\ndiff --git a/docs/credits.rst b/docs/credits.rst\nindex d1ee2a9..420af8d 100644\n--- a/docs/credits.rst\n+++ b/docs/credits.rst\n@@ -55,6 +55,7 @@ icalendar contributors\n - Andreas Ruppen <andreas.ruppen@gmail.com>\n - Clive Stevens <clivest2@gmail.com>\n - Dalton Durst <github@daltondur.st>\n+- Kamil Ma\xc5\x84kowski <kam193@wp.pl>\n \n Find out who contributed::\n \ndiff --git a/src/icalendar/prop.py b/src/icalendar/prop.py\nindex 23fab24..2c6ae85 100644\n--- a/src/icalendar/prop.py\n+++ b/src/icalendar/prop.py\n@@ -673,7 +673,7 @@ def __init__(self, *args, **kwargs):\n     def to_ical(self):\n         result = []\n         for key, vals in self.sorted_items():\n-            typ = self.types[key]\n+            typ = self.types.get(key, vText)\n             if not isinstance(vals, SEQUENCE_TYPES):\n                 vals = [vals]\n             vals = b','.join(typ(val).to_ical() for val in vals)\ndiff --git a/src/icalendar/tests/test_unit_prop.py b/src/icalendar/tests/test_unit_prop.py\nindex cc9ea53..a9ee27a 100644\n--- a/src/icalendar/tests/test_unit_prop.py\n+++ b/src/icalendar/tests/test_unit_prop.py\n@@ -332,6 +332,11 @@ def test_prop_vRecur(self):\n         # and some errors\n         self.assertRaises(ValueError, vRecur.from_ical, 'BYDAY=12')\n \n+        # when key is not RFC-compliant, parse it as vText\n+        r = vRecur.from_ical('FREQ=MONTHLY;BYOTHER=TEXT;BYEASTER=-3')\n+        self.assertEqual(vRecur(r).to_ical(),\n+                         b'FREQ=MONTHLY;BYEASTER=-3;BYOTHER=TEXT')\n+\n     def test_prop_vText(self):\n         from ..prop import vText\n \n"

Repository: icalendar


Branch: refs/heads/master
Date: 2020-03-18T20:04:09+01:00
Author: Kamil Mankowski (kam193) (kam193) <kam193@wp.pl>
Commit: https://github.com/collective/icalendar/commit/3fc1007e60de9b01ec34c55a63a99447e615acb4

Update changelog

Files changed:
M CHANGES.rst

b'diff --git a/CHANGES.rst b/CHANGES.rst\nindex 4e62e5e..560ebae 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -16,6 +16,7 @@ Bug fixes:\n \n - Fixed a docs issue related to building on Read the Docs [davidfischer]\n - Use ``vText`` as default type, when convert recurrence definition to ical string. [kam193] \n+- Enable CI for Python 3.7 and more reduce Hypothesis iteration due to CI timeout. [kam193]\n \n \n 4.0.4 (2019-11-25)\n'

Repository: icalendar


Branch: refs/heads/master
Date: 2020-04-08T11:06:34+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/collective/icalendar/commit/c5f5602b203cfa10dda18aa7dff4a24aa1a1756f

Merge pull request #299 from kam193/master

Default type vText when converting vRecur to ical

Files changed:
M CHANGES.rst
M docs/credits.rst
M src/icalendar/prop.py
M src/icalendar/tests/test_unit_prop.py

b"diff --git a/CHANGES.rst b/CHANGES.rst\nindex a19b433..6e9d594 100644\n--- a/CHANGES.rst\n+++ b/CHANGES.rst\n@@ -23,6 +23,8 @@ Bug fixes:\n Bug fixes:\n \n - Fixed a docs issue related to building on Read the Docs [davidfischer]\n+- Use ``vText`` as default type, when convert recurrence definition to ical string. [kam193] \n+- Enable CI for Python 3.7 and more reduce Hypothesis iteration due to CI timeout. [kam193]\n \n \n 4.0.4 (2019-11-25)\ndiff --git a/docs/credits.rst b/docs/credits.rst\nindex d1ee2a9..420af8d 100644\n--- a/docs/credits.rst\n+++ b/docs/credits.rst\n@@ -55,6 +55,7 @@ icalendar contributors\n - Andreas Ruppen <andreas.ruppen@gmail.com>\n - Clive Stevens <clivest2@gmail.com>\n - Dalton Durst <github@daltondur.st>\n+- Kamil Ma\xc5\x84kowski <kam193@wp.pl>\n \n Find out who contributed::\n \ndiff --git a/src/icalendar/prop.py b/src/icalendar/prop.py\nindex 23fab24..2c6ae85 100644\n--- a/src/icalendar/prop.py\n+++ b/src/icalendar/prop.py\n@@ -673,7 +673,7 @@ def __init__(self, *args, **kwargs):\n     def to_ical(self):\n         result = []\n         for key, vals in self.sorted_items():\n-            typ = self.types[key]\n+            typ = self.types.get(key, vText)\n             if not isinstance(vals, SEQUENCE_TYPES):\n                 vals = [vals]\n             vals = b','.join(typ(val).to_ical() for val in vals)\ndiff --git a/src/icalendar/tests/test_unit_prop.py b/src/icalendar/tests/test_unit_prop.py\nindex cc9ea53..a9ee27a 100644\n--- a/src/icalendar/tests/test_unit_prop.py\n+++ b/src/icalendar/tests/test_unit_prop.py\n@@ -332,6 +332,11 @@ def test_prop_vRecur(self):\n         # and some errors\n         self.assertRaises(ValueError, vRecur.from_ical, 'BYDAY=12')\n \n+        # when key is not RFC-compliant, parse it as vText\n+        r = vRecur.from_ical('FREQ=MONTHLY;BYOTHER=TEXT;BYEASTER=-3')\n+        self.assertEqual(vRecur(r).to_ical(),\n+                         b'FREQ=MONTHLY;BYEASTER=-3;BYOTHER=TEXT')\n+\n     def test_prop_vText(self):\n         from ..prop import vText\n \n"

