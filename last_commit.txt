Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-10-21T16:18:44+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/ecaae78fe7efde6eabb9183e89045efb0348c164

Make tinymce text filling more robust

Files changed:
M Products/CMFPlone/tests/robot/keywords.robot
M Products/CMFPlone/tests/robot/test_contentbrowser.robot
M Products/CMFPlone/tests/robot/test_controlpanel_filter.robot
M Products/CMFPlone/tests/robot/test_linkintegrity.robot
M Products/CMFPlone/tests/robot/test_tinymce.robot

b'diff --git a/Products/CMFPlone/tests/robot/keywords.robot b/Products/CMFPlone/tests/robot/keywords.robot\nindex e4edab3877..f4bb2d383e 100644\n--- a/Products/CMFPlone/tests/robot/keywords.robot\n+++ b/Products/CMFPlone/tests/robot/keywords.robot\n@@ -70,20 +70,38 @@ Remove line from textarea\n \n \n Fill text to tinymce editor\n-    [Arguments]    ${attr_name}    ${input}\n+    [Arguments]    ${text}\n \n-    Wait For Condition    Attribute    //body    class    contains    patterns-loaded\n+    Wait For Condition    Classes    //body    contains    patterns-loaded\n \n-    Sleep    1\n+    ${old} =    Set Selector Prefix    //div[contains(@class, "tox-edit-area")]//iframe >>>\n+    Wait for Condition    Element States    //body    contains    visible\n+    Type Text    //body    ${text}\n+    Wait for Condition    Text    //body   !=    ""\n+    Set Selector Prefix    ${old}\n \n-    Evaluate JavaScript    //textarea[@name="${attr_name}"]\n-    ...    (elem, text) => {\n-    ...        const tiny = window.tinymce.get(elem.getAttribute("id"));\n-    ...        tiny.setContent(\'${input}\');\n-    ...    }\n-    ...    all_elements=False\n+Fill source code to tinymce editor\n+    [Arguments]    ${source_code}\n \n-    Wait for Condition    Text    //div[contains(@class, \'tox-edit-area\')]//iframe >>> body   !=    ""\n+    Wait For Condition    Classes    //body    contains    patterns-loaded\n+    Wait For Condition    Element States    //div[contains(@class,"tox-tinymce") and @role="application"]    contains    visible\n+    Wait for Condition    Element States    //div[contains(@class, "tox-edit-area")]//iframe >>> body    contains    visible\n+\n+    # Click the View menu button\n+    Click    //span[contains(@class,"tox-mbtn__select-label") and contains(text(),"View")]/parent::button\n+    Wait for Condition    Element States    //div[@class="tox-collection__group"]    contains    visible\n+\n+    # Click the Source code menu button\n+    Click    //div[@class="tox-collection__item-label" and contains(text(),"Source code")]/parent::div\n+\n+    # Open dialog for source code insert\n+    ${textarea}=    Get Element    //textarea[@class="tox-textarea"]\n+    Wait for Condition    Element States    ${textarea}    contains    visible\n+    Type Text    ${textarea}    ${source_code}\n+    # Save\n+    Click    //button[@class="tox-button" and contains(text(),"Save")]\n+\n+    Wait for Condition    Text    //div[contains(@class, "tox-edit-area")]//iframe >>> body   !=    ""\n \n \n Pause\ndiff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nindex 2025e9af4f..b7b935166d 100644\n--- a/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -155,7 +155,7 @@ I select two related item images via contentbrowser\n \n I set an internal link via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>Susi Sorglos and John Doe</p>\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n     Evaluate JavaScript   //div[contains(@class, \'tox-edit-area\')]//iframe\n     ...    (elem, args) => {\n     ...        const iframe_document = elem.contentDocument;\n@@ -176,7 +176,7 @@ I set an internal link via contentbrowser\n \n I set an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>Susi Sorglos and John Doe</p>\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n     Click    //button[@aria-label=\'Insert/edit image\']\n     Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\n@@ -187,7 +187,7 @@ I set an image via contentbrowser\n \n I upload an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>Susi Sorglos and John Doe</p>\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n     Click    //button[@aria-label="Insert/edit image"]\n     Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\n@@ -201,7 +201,7 @@ I upload an image via contentbrowser\n \n I search and select an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>Susi Sorglos and John Doe</p>\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n     Click    //button[@aria-label="Insert/edit image"]\n     Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\ndiff --git a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\nindex 9d48ebb955..5dbabd3aee 100644\n--- a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\n+++ b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\n@@ -87,7 +87,7 @@ the \'h1\' tag is filtered out when a document is saved\n     ...    title=Document 1\n     ...    type=Document\n     Go To    ${PLONE_URL}/doc1/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>heading</p><p>Spanish Inquisition</p>\n+    Fill text to tinymce editor    heading\\nSpanish Inquisition\n     Mark text heading as h1 in tinymce editor\n     I save the form\n     Get Text    //body    contains    Spanish Inquisition\n@@ -101,7 +101,7 @@ the \'h1\' tag is stripped when a document is saved\n     ...    title=Document 1\n     ...    type=Document\n     Go To  ${PLONE_URL}/doc1/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>heading</p><p>Spanish Inquisition</p>\n+    Fill text to tinymce editor    heading\\nSpanish Inquisition\n     Mark text heading as h1 in tinymce editor\n     I save the form\n     Get Text    //body    contains    Spanish Inquisition\n@@ -116,7 +116,7 @@ the \'${tag}\' tag is preserved when a document is saved\n     ...    title=Document 1\n     ...    type=Document\n     Go To    ${PLONE_URL}/doc1/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <${tag}>lorem ipsum</${tag}><p>Spanish Inquisition</p>\n+    Fill source code to tinymce editor    <${tag}>lorem ipsum</${tag}><p>Spanish Inquisition</p>\n     I save the form\n     Get Text    //body    contains    Spanish Inquisition\n     Get Element Count    //div[@id=\'content-core\']//${tag}    should be    1    message=the ${tag} tag should have been preserved\n@@ -129,7 +129,7 @@ the \'${attribute}\' attribute is preserved when a document is saved\n     ...    title=Document 1\n     ...    type=Document\n     Go To    ${PLONE_URL}/doc1/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <span ${attribute}="foo">lorem ipsum</span><p>Spanish Inquisition</p>\n+    Fill source code to tinymce editor    <span ${attribute}="foo">lorem ipsum</span><p>Spanish Inquisition</p>\n     I save the form\n     Get Text    //body    contains    Spanish Inquisition\n     Get Element Count    //span[@${attribute}]    should be    1    message=the ${attribute} tag should have been preserved\ndiff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex 7a3db39c17..79d30dc4ad 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -57,7 +57,7 @@ a page to edit\n # When\n I add a link in rich text\n     Go To    ${PLONE_URL}/bar/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>foo</p>\n+    Fill text to tinymce editor    foo\n     Mark text foo in tinymce editor\n     Click    //button[@aria-label="Insert/edit link"]\n     Click    //div[contains(@class,"linkModal")]//div[contains(@class,"content-browser-selected-items-wrapper")]//button[contains(@class,"btn-primary")]\n@@ -70,7 +70,7 @@ I add a link in rich text\n I remove link to page\n     Go To    ${PLONE_URL}/bar\n     Click    //*[@id="contentview-edit"]//a\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    foo\n+    Fill text to tinymce editor    foo\n     Mark text foo in tinymce editor\n     Click    //button[@aria-label="Remove link"]\n     Click    //button[@name="form.buttons.save"]\ndiff --git a/Products/CMFPlone/tests/robot/test_tinymce.robot b/Products/CMFPlone/tests/robot/test_tinymce.robot\nindex 5a126857d6..31c8e01bbf 100644\n--- a/Products/CMFPlone/tests/robot/test_tinymce.robot\n+++ b/Products/CMFPlone/tests/robot/test_tinymce.robot\n@@ -43,7 +43,7 @@ an uploaded image\n     Create content  type=Image  title=an-image\n \n text inserted into wysiwyg\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>Susi Sorglos and John Doe</p>\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n \n insert link\n     Evaluate JavaScript   //div[contains(@class, \'tox-edit-area\')]//iframe\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-10-21T16:19:06+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/9aa44ab98f07d6e8b8118784e84195eef7eb5255

rename News File, use the right issue id

Files changed:
A news/3813.feature
D news/3980.feature

b'diff --git a/news/3980.feature b/news/3813.feature\nsimilarity index 100%\nrename from news/3980.feature\nrename to news/3813.feature\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-10-21T19:16:18+02:00
Author: 1letter (1letter) <1letter@gmx.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/9a6f14439111ed15208ae095abe8eed60e4bafad

Merge pull request #4035 from plone/robottest-tiny-improvement

robottests: tinymce improvement

Files changed:
A news/3813.feature
M Products/CMFPlone/tests/robot/keywords.robot
M Products/CMFPlone/tests/robot/test_contentbrowser.robot
M Products/CMFPlone/tests/robot/test_controlpanel_filter.robot
M Products/CMFPlone/tests/robot/test_linkintegrity.robot
M Products/CMFPlone/tests/robot/test_tinymce.robot
D news/3980.feature

b'diff --git a/Products/CMFPlone/tests/robot/keywords.robot b/Products/CMFPlone/tests/robot/keywords.robot\nindex e4edab3877..f4bb2d383e 100644\n--- a/Products/CMFPlone/tests/robot/keywords.robot\n+++ b/Products/CMFPlone/tests/robot/keywords.robot\n@@ -70,20 +70,38 @@ Remove line from textarea\n \n \n Fill text to tinymce editor\n-    [Arguments]    ${attr_name}    ${input}\n+    [Arguments]    ${text}\n \n-    Wait For Condition    Attribute    //body    class    contains    patterns-loaded\n+    Wait For Condition    Classes    //body    contains    patterns-loaded\n \n-    Sleep    1\n+    ${old} =    Set Selector Prefix    //div[contains(@class, "tox-edit-area")]//iframe >>>\n+    Wait for Condition    Element States    //body    contains    visible\n+    Type Text    //body    ${text}\n+    Wait for Condition    Text    //body   !=    ""\n+    Set Selector Prefix    ${old}\n \n-    Evaluate JavaScript    //textarea[@name="${attr_name}"]\n-    ...    (elem, text) => {\n-    ...        const tiny = window.tinymce.get(elem.getAttribute("id"));\n-    ...        tiny.setContent(\'${input}\');\n-    ...    }\n-    ...    all_elements=False\n+Fill source code to tinymce editor\n+    [Arguments]    ${source_code}\n \n-    Wait for Condition    Text    //div[contains(@class, \'tox-edit-area\')]//iframe >>> body   !=    ""\n+    Wait For Condition    Classes    //body    contains    patterns-loaded\n+    Wait For Condition    Element States    //div[contains(@class,"tox-tinymce") and @role="application"]    contains    visible\n+    Wait for Condition    Element States    //div[contains(@class, "tox-edit-area")]//iframe >>> body    contains    visible\n+\n+    # Click the View menu button\n+    Click    //span[contains(@class,"tox-mbtn__select-label") and contains(text(),"View")]/parent::button\n+    Wait for Condition    Element States    //div[@class="tox-collection__group"]    contains    visible\n+\n+    # Click the Source code menu button\n+    Click    //div[@class="tox-collection__item-label" and contains(text(),"Source code")]/parent::div\n+\n+    # Open dialog for source code insert\n+    ${textarea}=    Get Element    //textarea[@class="tox-textarea"]\n+    Wait for Condition    Element States    ${textarea}    contains    visible\n+    Type Text    ${textarea}    ${source_code}\n+    # Save\n+    Click    //button[@class="tox-button" and contains(text(),"Save")]\n+\n+    Wait for Condition    Text    //div[contains(@class, "tox-edit-area")]//iframe >>> body   !=    ""\n \n \n Pause\ndiff --git a/Products/CMFPlone/tests/robot/test_contentbrowser.robot b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\nindex 2025e9af4f..b7b935166d 100644\n--- a/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n+++ b/Products/CMFPlone/tests/robot/test_contentbrowser.robot\n@@ -155,7 +155,7 @@ I select two related item images via contentbrowser\n \n I set an internal link via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>Susi Sorglos and John Doe</p>\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n     Evaluate JavaScript   //div[contains(@class, \'tox-edit-area\')]//iframe\n     ...    (elem, args) => {\n     ...        const iframe_document = elem.contentDocument;\n@@ -176,7 +176,7 @@ I set an internal link via contentbrowser\n \n I set an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>Susi Sorglos and John Doe</p>\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n     Click    //button[@aria-label=\'Insert/edit image\']\n     Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\n@@ -187,7 +187,7 @@ I set an image via contentbrowser\n \n I upload an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>Susi Sorglos and John Doe</p>\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n     Click    //button[@aria-label="Insert/edit image"]\n     Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\n@@ -201,7 +201,7 @@ I upload an image via contentbrowser\n \n I search and select an image via contentbrowser\n     Go to  ${PLONE_URL}/${DOCUMENT_ID}/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>Susi Sorglos and John Doe</p>\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n     Click    //button[@aria-label="Insert/edit image"]\n     Click    css=.linkModal .content-browser-selected-items-wrapper button.btn-primary\n     Click item in column    1    3\ndiff --git a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\nindex 9d48ebb955..5dbabd3aee 100644\n--- a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\n+++ b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot\n@@ -87,7 +87,7 @@ the \'h1\' tag is filtered out when a document is saved\n     ...    title=Document 1\n     ...    type=Document\n     Go To    ${PLONE_URL}/doc1/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>heading</p><p>Spanish Inquisition</p>\n+    Fill text to tinymce editor    heading\\nSpanish Inquisition\n     Mark text heading as h1 in tinymce editor\n     I save the form\n     Get Text    //body    contains    Spanish Inquisition\n@@ -101,7 +101,7 @@ the \'h1\' tag is stripped when a document is saved\n     ...    title=Document 1\n     ...    type=Document\n     Go To  ${PLONE_URL}/doc1/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>heading</p><p>Spanish Inquisition</p>\n+    Fill text to tinymce editor    heading\\nSpanish Inquisition\n     Mark text heading as h1 in tinymce editor\n     I save the form\n     Get Text    //body    contains    Spanish Inquisition\n@@ -116,7 +116,7 @@ the \'${tag}\' tag is preserved when a document is saved\n     ...    title=Document 1\n     ...    type=Document\n     Go To    ${PLONE_URL}/doc1/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <${tag}>lorem ipsum</${tag}><p>Spanish Inquisition</p>\n+    Fill source code to tinymce editor    <${tag}>lorem ipsum</${tag}><p>Spanish Inquisition</p>\n     I save the form\n     Get Text    //body    contains    Spanish Inquisition\n     Get Element Count    //div[@id=\'content-core\']//${tag}    should be    1    message=the ${tag} tag should have been preserved\n@@ -129,7 +129,7 @@ the \'${attribute}\' attribute is preserved when a document is saved\n     ...    title=Document 1\n     ...    type=Document\n     Go To    ${PLONE_URL}/doc1/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <span ${attribute}="foo">lorem ipsum</span><p>Spanish Inquisition</p>\n+    Fill source code to tinymce editor    <span ${attribute}="foo">lorem ipsum</span><p>Spanish Inquisition</p>\n     I save the form\n     Get Text    //body    contains    Spanish Inquisition\n     Get Element Count    //span[@${attribute}]    should be    1    message=the ${attribute} tag should have been preserved\ndiff --git a/Products/CMFPlone/tests/robot/test_linkintegrity.robot b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\nindex 7a3db39c17..79d30dc4ad 100644\n--- a/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n+++ b/Products/CMFPlone/tests/robot/test_linkintegrity.robot\n@@ -57,7 +57,7 @@ a page to edit\n # When\n I add a link in rich text\n     Go To    ${PLONE_URL}/bar/edit\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>foo</p>\n+    Fill text to tinymce editor    foo\n     Mark text foo in tinymce editor\n     Click    //button[@aria-label="Insert/edit link"]\n     Click    //div[contains(@class,"linkModal")]//div[contains(@class,"content-browser-selected-items-wrapper")]//button[contains(@class,"btn-primary")]\n@@ -70,7 +70,7 @@ I add a link in rich text\n I remove link to page\n     Go To    ${PLONE_URL}/bar\n     Click    //*[@id="contentview-edit"]//a\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    foo\n+    Fill text to tinymce editor    foo\n     Mark text foo in tinymce editor\n     Click    //button[@aria-label="Remove link"]\n     Click    //button[@name="form.buttons.save"]\ndiff --git a/Products/CMFPlone/tests/robot/test_tinymce.robot b/Products/CMFPlone/tests/robot/test_tinymce.robot\nindex 5a126857d6..31c8e01bbf 100644\n--- a/Products/CMFPlone/tests/robot/test_tinymce.robot\n+++ b/Products/CMFPlone/tests/robot/test_tinymce.robot\n@@ -43,7 +43,7 @@ an uploaded image\n     Create content  type=Image  title=an-image\n \n text inserted into wysiwyg\n-    Fill text to tinymce editor    form.widgets.IRichTextBehavior.text    <p>Susi Sorglos and John Doe</p>\n+    Fill text to tinymce editor    Susi Sorglos and John Doe\n \n insert link\n     Evaluate JavaScript   //div[contains(@class, \'tox-edit-area\')]//iframe\ndiff --git a/news/3980.feature b/news/3813.feature\nsimilarity index 100%\nrename from news/3980.feature\nrename to news/3813.feature\n'

