Repository: Products.CMFPlacefulWorkflow


Branch: refs/heads/master
Date: 2020-08-22T10:46:06+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlacefulWorkflow/commit/846adab8964f877d1ad4a2b2bafd2084af278787

Fix deprecation warning at startup for setDefaultRoles.

```
DeprecationWarning: setDefaultRoles is deprecated. Please use addPermission from AccessControl.Permission.
```

In CMFCore it is deprecated by zope.deferredimport.

Files changed:
A news/34.bugfix
M Products/CMFPlacefulWorkflow/permissions.py

b'diff --git a/Products/CMFPlacefulWorkflow/permissions.py b/Products/CMFPlacefulWorkflow/permissions.py\nindex df4c2aa..e078073 100644\n--- a/Products/CMFPlacefulWorkflow/permissions.py\n+++ b/Products/CMFPlacefulWorkflow/permissions.py\n@@ -2,7 +2,8 @@\n """ Zope 2 permissions\n """\n \n-from Products.CMFCore.permissions import setDefaultRoles\n+from AccessControl.Permission import addPermission\n+\n \n ManageWorkflowPolicies = \'CMFPlacefulWorkflow: Manage workflow policies\'\n-setDefaultRoles(ManageWorkflowPolicies, (\'Manager\', \'Site Administrator\'))\n+addPermission(ManageWorkflowPolicies, (\'Manager\', \'Site Administrator\'))\ndiff --git a/news/34.bugfix b/news/34.bugfix\nnew file mode 100644\nindex 0000000..2dc956c\n--- /dev/null\n+++ b/news/34.bugfix\n@@ -0,0 +1,2 @@\n+Fix deprecation warning at startup for setDefaultRoles.\n+[maurits]\n'

Repository: Products.CMFPlacefulWorkflow


Branch: refs/heads/master
Date: 2020-08-24T11:20:08+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlacefulWorkflow/commit/a4413ae9c0ab29249fbbd08d6f9e4725fe6392b4

Fix possible UnicodeDecodeError getting the long description.

Files changed:
M setup.py

b'diff --git a/setup.py b/setup.py\nindex fe885f8..ff4874e 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -2,12 +2,34 @@\n \n version = \'2.0.3.dev0\'\n \n+\n+def read(filename):\n+    with open(filename) as myfile:\n+        try:\n+            return myfile.read()\n+        except UnicodeDecodeError:\n+            # Happens on one Jenkins node on Python 3.6,\n+            # so maybe it happens for users too.\n+            pass\n+    # Opening and reading as text failed, so retry opening as bytes.\n+    with open(filename, "rb") as myfile:\n+        contents = myfile.read()\n+        return contents.decode("utf-8")\n+\n+\n+long_description = "\\n".join(\n+    [\n+        read("README.rst"),\n+        read("CHANGES.rst"),\n+    ]\n+)\n+\n+\n setup(\n     name=\'Products.CMFPlacefulWorkflow\',\n     version=version,\n     description="Workflow policies for Plone",\n-    long_description=(open("README.rst").read() + "\\n" +\n-                      open("CHANGES.rst").read()),\n+    long_description=long_description,\n     classifiers=[\n         "Development Status :: 5 - Production/Stable",\n         "Framework :: Plone",\n'

Repository: Products.CMFPlacefulWorkflow


Branch: refs/heads/master
Date: 2020-08-24T18:06:01+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlacefulWorkflow/commit/eda6670f50436d2dea426a389563df1223760978

Put long_description in setup.cfg.

I hope this fixes a UnicodeDecodeError on Python 3.6 on some machines,
without needing special code in setup.py.

Files changed:
M setup.cfg
M setup.py

b'diff --git a/setup.cfg b/setup.cfg\nindex 06aa277..a6c51c7 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,3 +1,6 @@\n+[metadata]\n+long_description = file: README.rst, CHANGES.rst\n+\n [zest.releaser]\n create-wheel = yes\n \ndiff --git a/setup.py b/setup.py\nindex ff4874e..2da3f1b 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -3,33 +3,12 @@\n version = \'2.0.3.dev0\'\n \n \n-def read(filename):\n-    with open(filename) as myfile:\n-        try:\n-            return myfile.read()\n-        except UnicodeDecodeError:\n-            # Happens on one Jenkins node on Python 3.6,\n-            # so maybe it happens for users too.\n-            pass\n-    # Opening and reading as text failed, so retry opening as bytes.\n-    with open(filename, "rb") as myfile:\n-        contents = myfile.read()\n-        return contents.decode("utf-8")\n-\n-\n-long_description = "\\n".join(\n-    [\n-        read("README.rst"),\n-        read("CHANGES.rst"),\n-    ]\n-)\n-\n-\n setup(\n     name=\'Products.CMFPlacefulWorkflow\',\n     version=version,\n     description="Workflow policies for Plone",\n-    long_description=long_description,\n+    # Note: long_description is in setup.cfg\n+    # to avoid needing workarounds for UnicodeDecodeErrors.\n     classifiers=[\n         "Development Status :: 5 - Production/Stable",\n         "Framework :: Plone",\n'

Repository: Products.CMFPlacefulWorkflow


Branch: refs/heads/master
Date: 2020-08-24T22:09:12+02:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/Products.CMFPlacefulWorkflow/commit/ed89ee5d710ac87c0ea997e47295d1ed6b175e96

Merge pull request #34 from plone/maurits/fix-startup-warnings

Fix deprecation warning at startup for setDefaultRoles.

Files changed:
A news/34.bugfix
M Products/CMFPlacefulWorkflow/permissions.py
M setup.cfg
M setup.py

b'diff --git a/Products/CMFPlacefulWorkflow/permissions.py b/Products/CMFPlacefulWorkflow/permissions.py\nindex df4c2aa..e078073 100644\n--- a/Products/CMFPlacefulWorkflow/permissions.py\n+++ b/Products/CMFPlacefulWorkflow/permissions.py\n@@ -2,7 +2,8 @@\n """ Zope 2 permissions\n """\n \n-from Products.CMFCore.permissions import setDefaultRoles\n+from AccessControl.Permission import addPermission\n+\n \n ManageWorkflowPolicies = \'CMFPlacefulWorkflow: Manage workflow policies\'\n-setDefaultRoles(ManageWorkflowPolicies, (\'Manager\', \'Site Administrator\'))\n+addPermission(ManageWorkflowPolicies, (\'Manager\', \'Site Administrator\'))\ndiff --git a/news/34.bugfix b/news/34.bugfix\nnew file mode 100644\nindex 0000000..2dc956c\n--- /dev/null\n+++ b/news/34.bugfix\n@@ -0,0 +1,2 @@\n+Fix deprecation warning at startup for setDefaultRoles.\n+[maurits]\ndiff --git a/setup.cfg b/setup.cfg\nindex 06aa277..a6c51c7 100644\n--- a/setup.cfg\n+++ b/setup.cfg\n@@ -1,3 +1,6 @@\n+[metadata]\n+long_description = file: README.rst, CHANGES.rst\n+\n [zest.releaser]\n create-wheel = yes\n \ndiff --git a/setup.py b/setup.py\nindex fe885f8..2da3f1b 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -2,12 +2,13 @@\n \n version = \'2.0.3.dev0\'\n \n+\n setup(\n     name=\'Products.CMFPlacefulWorkflow\',\n     version=version,\n     description="Workflow policies for Plone",\n-    long_description=(open("README.rst").read() + "\\n" +\n-                      open("CHANGES.rst").read()),\n+    # Note: long_description is in setup.cfg\n+    # to avoid needing workarounds for UnicodeDecodeErrors.\n     classifiers=[\n         "Development Status :: 5 - Production/Stable",\n         "Framework :: Plone",\n'

