Repository: plone.app.versioningbehavior


Branch: refs/heads/master
Date: 2020-08-22T18:19:03+02:00
Author: Roel Bruggink (jaroel) <roel@jaroel.nl>
Commit: https://github.com/plone/plone.app.versioningbehavior/commit/a3c7ea1996e06c5eb6ea4cbca6368fe49bc8b3e0

Check if we have portal_repository when creating the initial version.

We don't have the required tooling ready when adding a Plone Site object

Files changed:
M plone/app/versioningbehavior/subscribers.py

b'diff --git a/plone/app/versioningbehavior/subscribers.py b/plone/app/versioningbehavior/subscribers.py\nindex fa195f0..9108b27 100644\n--- a/plone/app/versioningbehavior/subscribers.py\n+++ b/plone/app/versioningbehavior/subscribers.py\n@@ -70,7 +70,11 @@ def create_initial_version_after_adding(context, event):\n     version. If a changeNote was entered it\'s used as comment.\n     """\n \n-    pr = getToolByName(context, \'portal_repository\')\n+    pr = getToolByName(context, \'portal_repository\', None)\n+    if pr is None:\n+        # This happens when adding a Plone Site with versioning.\n+        # The required tooling is not yet available.\n+        return\n     if not pr.isVersionable(context):\n         # object is not versionable\n         return\n'

Repository: plone.app.versioningbehavior


Branch: refs/heads/master
Date: 2021-02-10T12:21:29+01:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.versioningbehavior/commit/8dfc69f9620fb1143cda406f284d95710f9df574

Improve docs

Files changed:
A news/53.bugfix
M plone/app/versioningbehavior/subscribers.py

b"diff --git a/news/53.bugfix b/news/53.bugfix\nnew file mode 100644\nindex 0000000..21774c8\n--- /dev/null\n+++ b/news/53.bugfix\n@@ -0,0 +1 @@\n+Do not break if the portal_repository tool cannot be found\ndiff --git a/plone/app/versioningbehavior/subscribers.py b/plone/app/versioningbehavior/subscribers.py\nindex 9108b27..11859e7 100644\n--- a/plone/app/versioningbehavior/subscribers.py\n+++ b/plone/app/versioningbehavior/subscribers.py\n@@ -72,9 +72,10 @@ def create_initial_version_after_adding(context, event):\n \n     pr = getToolByName(context, 'portal_repository', None)\n     if pr is None:\n-        # This happens when adding a Plone Site with versioning.\n-        # The required tooling is not yet available.\n+        # This can happen, e.g., when adding a Plone Site with versioning\n+        # and portal_repository is not yet created\n         return\n+\n     if not pr.isVersionable(context):\n         # object is not versionable\n         return\n"

Repository: plone.app.versioningbehavior


Branch: refs/heads/master
Date: 2021-02-10T15:29:06+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.versioningbehavior/commit/a7561c8692f366702ae047881b5a82d0f877cf6f

Merge pull request #54 from plone/dx-siteroot

 Check if we have the portal_repository tool before creating a version

Files changed:
A news/53.bugfix
M plone/app/versioningbehavior/subscribers.py

b'diff --git a/news/53.bugfix b/news/53.bugfix\nnew file mode 100644\nindex 0000000..21774c8\n--- /dev/null\n+++ b/news/53.bugfix\n@@ -0,0 +1 @@\n+Do not break if the portal_repository tool cannot be found\ndiff --git a/plone/app/versioningbehavior/subscribers.py b/plone/app/versioningbehavior/subscribers.py\nindex fa195f0..11859e7 100644\n--- a/plone/app/versioningbehavior/subscribers.py\n+++ b/plone/app/versioningbehavior/subscribers.py\n@@ -70,7 +70,12 @@ def create_initial_version_after_adding(context, event):\n     version. If a changeNote was entered it\'s used as comment.\n     """\n \n-    pr = getToolByName(context, \'portal_repository\')\n+    pr = getToolByName(context, \'portal_repository\', None)\n+    if pr is None:\n+        # This can happen, e.g., when adding a Plone Site with versioning\n+        # and portal_repository is not yet created\n+        return\n+\n     if not pr.isVersionable(context):\n         # object is not versionable\n         return\n'

