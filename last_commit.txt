Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2024-02-21T15:34:22+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/10eed4b9e3d3dea95ca525fb3fdff54cffd9daad

Update TinyMCE format icon names for alignment styles.

Coming from Plone 5.2, you will have 'alignleft', which needs to be 'align-left', etc.

Files changed:
M news/3095.bugfix
M plone/app/upgrade/v60/final.py

b'diff --git a/news/3095.bugfix b/news/3095.bugfix\nindex d78152cd..5a402d8e 100644\n--- a/news/3095.bugfix\n+++ b/news/3095.bugfix\n@@ -1,2 +1,2 @@\n Update TinyMCE format icon names.\n-[petschki]\n+[petschki, maurits]\ndiff --git a/plone/app/upgrade/v60/final.py b/plone/app/upgrade/v60/final.py\nindex 512544c5..2b1c475d 100644\n--- a/plone/app/upgrade/v60/final.py\n+++ b/plone/app/upgrade/v60/final.py\n@@ -208,21 +208,36 @@ def fix_syndication_settings(context):\n             del registry.records[key]\n \n \n-def fix_tinymce_format_iconnames(context):\n-    """Fix \'strike-through\' and \'sourcecode\'.\n-\n-    See https://github.com/plone/Products.CMFPlone/issues/3905\n-    """\n+def _replace_values_in_record(record_name, *replacements):\n+    """Take the values of a registry record and replace some of them."""\n     registry = getUtility(IRegistry)\n-    record = registry.records.get("plone.inline_styles")\n+    record = registry.records.get(record_name)\n     if record is None:\n         return\n     values = record.value\n-    replacements = [\n-        ("Strikethrough|strikethrough|strikethrough", "Strikethrough|strikethrough|strike-through"),\n-        ("Code|code|code", "Code|code|sourcecode")\n-    ]\n     for _old, _new in replacements:\n         if _old in values:\n             values[values.index(_old)] = _new\n     record.value = values\n+\n+\n+def fix_tinymce_format_iconnames(context):\n+    """Fix various TinyMCE formats to have the correct icon name.\n+\n+    See https://github.com/plone/Products.CMFPlone/issues/3905\n+    """\n+    _replace_values_in_record(\n+        "plone.inline_styles",\n+        (\n+            "Strikethrough|strikethrough|strikethrough",\n+            "Strikethrough|strikethrough|strike-through",\n+        ),\n+        ("Code|code|code", "Code|code|sourcecode"),\n+    )\n+    _replace_values_in_record(\n+        "plone.alignment_styles",\n+        ("Left|alignleft|alignleft", "Left|alignleft|align-left"),\n+        ("Center|aligncenter|aligncenter", "Center|aligncenter|align-center"),\n+        ("Right|alignright|alignright", "Right|alignright|align-right"),\n+        ("Justify|alignjustify|alignjustify", "Justify|alignjustify|align-justify"),\n+    )\n'

Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2024-02-21T17:55:42+01:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.app.upgrade/commit/d0d3d4c7d06fb99c646da7134a7a8d847e34d4a0

Merge pull request #322 from plone/maurits-alignment-styles-icon-fix

Update TinyMCE format icon names for alignment styles.

Files changed:
M news/3095.bugfix
M plone/app/upgrade/v60/final.py

b'diff --git a/news/3095.bugfix b/news/3095.bugfix\nindex d78152cd..5a402d8e 100644\n--- a/news/3095.bugfix\n+++ b/news/3095.bugfix\n@@ -1,2 +1,2 @@\n Update TinyMCE format icon names.\n-[petschki]\n+[petschki, maurits]\ndiff --git a/plone/app/upgrade/v60/final.py b/plone/app/upgrade/v60/final.py\nindex 512544c5..2b1c475d 100644\n--- a/plone/app/upgrade/v60/final.py\n+++ b/plone/app/upgrade/v60/final.py\n@@ -208,21 +208,36 @@ def fix_syndication_settings(context):\n             del registry.records[key]\n \n \n-def fix_tinymce_format_iconnames(context):\n-    """Fix \'strike-through\' and \'sourcecode\'.\n-\n-    See https://github.com/plone/Products.CMFPlone/issues/3905\n-    """\n+def _replace_values_in_record(record_name, *replacements):\n+    """Take the values of a registry record and replace some of them."""\n     registry = getUtility(IRegistry)\n-    record = registry.records.get("plone.inline_styles")\n+    record = registry.records.get(record_name)\n     if record is None:\n         return\n     values = record.value\n-    replacements = [\n-        ("Strikethrough|strikethrough|strikethrough", "Strikethrough|strikethrough|strike-through"),\n-        ("Code|code|code", "Code|code|sourcecode")\n-    ]\n     for _old, _new in replacements:\n         if _old in values:\n             values[values.index(_old)] = _new\n     record.value = values\n+\n+\n+def fix_tinymce_format_iconnames(context):\n+    """Fix various TinyMCE formats to have the correct icon name.\n+\n+    See https://github.com/plone/Products.CMFPlone/issues/3905\n+    """\n+    _replace_values_in_record(\n+        "plone.inline_styles",\n+        (\n+            "Strikethrough|strikethrough|strikethrough",\n+            "Strikethrough|strikethrough|strike-through",\n+        ),\n+        ("Code|code|code", "Code|code|sourcecode"),\n+    )\n+    _replace_values_in_record(\n+        "plone.alignment_styles",\n+        ("Left|alignleft|alignleft", "Left|alignleft|align-left"),\n+        ("Center|aligncenter|aligncenter", "Center|aligncenter|align-center"),\n+        ("Right|alignright|alignright", "Right|alignright|align-right"),\n+        ("Justify|alignjustify|alignjustify", "Justify|alignjustify|align-justify"),\n+    )\n'

