Repository: plone.supermodel


Branch: refs/heads/master
Date: 2020-11-16T11:51:50+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.supermodel/commit/ee8f4bd2b76d4a114854c1cf3fe2bf9359b78b5c

For increased security, in the xml parser do not resolve entities, and remove processing instructions.

See https://github.com/plone/Products.CMFPlone/issues/3209

Files changed:
A news/3209.bugfix
M plone/supermodel/parser.py

b'diff --git a/news/3209.bugfix b/news/3209.bugfix\nnew file mode 100644\nindex 0000000..88803f6\n--- /dev/null\n+++ b/news/3209.bugfix\n@@ -0,0 +1,2 @@\n+For increased security, in the xml parser do not resolve entities, and remove processing instructions.\n+[maurits]\ndiff --git a/plone/supermodel/parser.py b/plone/supermodel/parser.py\nindex 13a1088..8a5c55d 100644\n--- a/plone/supermodel/parser.py\n+++ b/plone/supermodel/parser.py\n@@ -80,7 +80,11 @@ def parse(source, policy=u""):\n \n \n def _parse(source, policy):\n-    tree = etree.parse(source)\n+    # Some safety measures.\n+    # We do not want to load entities, especially file:/// entities.\n+    # Also discard processing instructions.\n+    parser = etree.XMLParser(resolve_entities=False, remove_pis=True)\n+    tree = etree.parse(source, parser=parser)\n     root = tree.getroot()\n \n     parseinfo.i18n_domain = root.attrib.get(\n'

Repository: plone.supermodel


Branch: refs/heads/master
Date: 2020-11-16T21:17:51+01:00
Author: Maurits van Rees (mauritsvanrees) <m.van.rees@zestsoftware.nl>
Commit: https://github.com/plone/plone.supermodel/commit/e7a0469378b7877cfbff6562f20539de1017c8c4

Merge pull request #40 from plone/maurits/cmfplone-issue-3209-lxml

In the xml parser do not resolve entities, and remove processing instructions.

Files changed:
A news/3209.bugfix
M plone/supermodel/parser.py

b'diff --git a/news/3209.bugfix b/news/3209.bugfix\nnew file mode 100644\nindex 0000000..88803f6\n--- /dev/null\n+++ b/news/3209.bugfix\n@@ -0,0 +1,2 @@\n+For increased security, in the xml parser do not resolve entities, and remove processing instructions.\n+[maurits]\ndiff --git a/plone/supermodel/parser.py b/plone/supermodel/parser.py\nindex 13a1088..8a5c55d 100644\n--- a/plone/supermodel/parser.py\n+++ b/plone/supermodel/parser.py\n@@ -80,7 +80,11 @@ def parse(source, policy=u""):\n \n \n def _parse(source, policy):\n-    tree = etree.parse(source)\n+    # Some safety measures.\n+    # We do not want to load entities, especially file:/// entities.\n+    # Also discard processing instructions.\n+    parser = etree.XMLParser(resolve_entities=False, remove_pis=True)\n+    tree = etree.parse(source, parser=parser)\n     root = tree.getroot()\n \n     parseinfo.i18n_domain = root.attrib.get(\n'

