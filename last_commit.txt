Repository: plone.volto


Branch: refs/heads/main
Date: 2023-05-31T13:37:18+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.volto/commit/fbddc06c906aa2516cc8e859113ad3c66a30db98

Let the migration-form @@migrate_to_volto transform richtext to slate-blocks by default.

Files changed:
A news/122.bugfix
M src/plone/volto/browser/migrate_to_volto.py
M src/plone/volto/tests/test_migrate_to_volto.py

b'diff --git a/news/122.bugfix b/news/122.bugfix\nnew file mode 100644\nindex 00000000..ac9c9290\n--- /dev/null\n+++ b/news/122.bugfix\n@@ -0,0 +1,2 @@\n+Let the migration-form @@migrate_to_volto transform richtext to slate-blocks by default.\n+[pbauer]\n\\ No newline at end of file\ndiff --git a/src/plone/volto/browser/migrate_to_volto.py b/src/plone/volto/browser/migrate_to_volto.py\nindex e356816f..8eba43b2 100644\n--- a/src/plone/volto/browser/migrate_to_volto.py\n+++ b/src/plone/volto/browser/migrate_to_volto.py\n@@ -40,8 +40,8 @@ def __call__(self):\n         self.migrate_folders = request.get("migrate_folders", True)\n         self.migrate_default_pages = request.get("migrate_default_pages", True)\n         self.purge_richtext = request.get("purge_richtext", True)\n-        # We still use draftjs at the moment\n-        self.slate = request.get("slate", False)\n+        # We can still use outdated draftjs by setting slate to False on the request\n+        self.slate = request.get("slate", True)\n \n         if not self.request.form.get("form.submitted", False):\n             return self.index()\ndiff --git a/src/plone/volto/tests/test_migrate_to_volto.py b/src/plone/volto/tests/test_migrate_to_volto.py\nindex e72af5a0..0fe7fe5a 100644\n--- a/src/plone/volto/tests/test_migrate_to_volto.py\n+++ b/src/plone/volto/tests/test_migrate_to_volto.py\n@@ -330,7 +330,6 @@ def test_richtext_is_migrated(self):\n \n         view = self.portal.restrictedTraverse("@@migrate_to_volto")\n         self.request.form["form.submitted"] = True\n-        self.request.form["slate"] = True\n         view()\n \n         doc = self.portal["doc"]\n'

Repository: plone.volto


Branch: refs/heads/main
Date: 2023-06-02T16:13:52+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.volto/commit/7c0ba3336907288895c52028b7a87ffea81d06cc

Merge pull request #123 from plone/slate_is_default

Files changed:
A news/122.bugfix
M src/plone/volto/browser/migrate_to_volto.py
M src/plone/volto/tests/test_migrate_to_volto.py

b'diff --git a/news/122.bugfix b/news/122.bugfix\nnew file mode 100644\nindex 00000000..ac9c9290\n--- /dev/null\n+++ b/news/122.bugfix\n@@ -0,0 +1,2 @@\n+Let the migration-form @@migrate_to_volto transform richtext to slate-blocks by default.\n+[pbauer]\n\\ No newline at end of file\ndiff --git a/src/plone/volto/browser/migrate_to_volto.py b/src/plone/volto/browser/migrate_to_volto.py\nindex e356816f..8eba43b2 100644\n--- a/src/plone/volto/browser/migrate_to_volto.py\n+++ b/src/plone/volto/browser/migrate_to_volto.py\n@@ -40,8 +40,8 @@ def __call__(self):\n         self.migrate_folders = request.get("migrate_folders", True)\n         self.migrate_default_pages = request.get("migrate_default_pages", True)\n         self.purge_richtext = request.get("purge_richtext", True)\n-        # We still use draftjs at the moment\n-        self.slate = request.get("slate", False)\n+        # We can still use outdated draftjs by setting slate to False on the request\n+        self.slate = request.get("slate", True)\n \n         if not self.request.form.get("form.submitted", False):\n             return self.index()\ndiff --git a/src/plone/volto/tests/test_migrate_to_volto.py b/src/plone/volto/tests/test_migrate_to_volto.py\nindex e72af5a0..0fe7fe5a 100644\n--- a/src/plone/volto/tests/test_migrate_to_volto.py\n+++ b/src/plone/volto/tests/test_migrate_to_volto.py\n@@ -330,7 +330,6 @@ def test_richtext_is_migrated(self):\n \n         view = self.portal.restrictedTraverse("@@migrate_to_volto")\n         self.request.form["form.submitted"] = True\n-        self.request.form["slate"] = True\n         view()\n \n         doc = self.portal["doc"]\n'

