Repository: plone.restapi


Branch: refs/heads/main
Date: 2024-04-29T17:13:06-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.restapi/commit/3cf4a1b112b77a30d0a59f9899574444c24673fc

Users service: fix edge case where a userid is returned by search but isn't an actual user (#1775)

* fix edge case where a userid is returned by search but isn't an actual user

* changelog

Files changed:
A news/1775.bugfix
M src/plone/restapi/services/users/get.py

b"diff --git a/news/1775.bugfix b/news/1775.bugfix\nnew file mode 100644\nindex 0000000000..f0b3cd0e47\n--- /dev/null\n+++ b/news/1775.bugfix\n@@ -0,0 +1 @@\n+Users service: Fixed edge case AttributeError if a user is enumerated but doesn't actually exist. @davisagli\ndiff --git a/src/plone/restapi/services/users/get.py b/src/plone/restapi/services/users/get.py\nindex e900b7de6f..235639c785 100644\n--- a/src/plone/restapi/services/users/get.py\n+++ b/src/plone/restapi/services/users/get.py\n@@ -115,7 +115,9 @@ def _principal_search_results(\n         principals = []\n         for principal_info in search_for_principal(hunter, self.search_term):\n             principal_id = principal_info[id_key]\n-            principals.append(get_principal_by_id(principal_id))\n+            principal = get_principal_by_id(principal_id)\n+            if principal is not None:\n+                principals.append(principal)\n \n         return principals\n \n"

