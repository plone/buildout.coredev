Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2024-04-30T17:01:47+02:00
Author: ale-rt (ale-rt) <alessandro.pisa@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/4baf4b3aa5759bab6277bd3d49bd7bb7e0f4cba7

Support using the file template on objects that have no file attributes.

Closes #688

Files changed:
A news/688.bugfix
M plone/app/contenttypes/browser/templates/file.pt

b'diff --git a/news/688.bugfix b/news/688.bugfix\nnew file mode 100644\nindex 000000000..5279988e1\n--- /dev/null\n+++ b/news/688.bugfix\n@@ -0,0 +1 @@\n+Support using the file template on objects that have no file attributes. [ale-rt]\ndiff --git a/plone/app/contenttypes/browser/templates/file.pt b/plone/app/contenttypes/browser/templates/file.pt\nindex 845af29c4..6da3fc036 100644\n--- a/plone/app/contenttypes/browser/templates/file.pt\n+++ b/plone/app/contenttypes/browser/templates/file.pt\n@@ -12,75 +12,88 @@\n     <metal:content-core fill-slot="content-core">\n       <metal:block define-macro="content-core"\n                    tal:define="\n-                     content_type python: context.file.contentType;\n-                     filename python: context.file.filename;\n-                     mimetype_icon python: \'mimetype-\' + content_type;\n-                     download_url python: \'{}/@@download/file/{}\'.format(context.absolute_url(), filename);\n+                     file python:context.file;\n                    "\n+                   tal:on-error="nothing"\n       >\n \n-        <section class="section section-main">\n+        <tal:has_file condition="python:file">\n+          <tal:block tal:define="\n+                       content_type context/file/contentType;\n+                       filename python: file.filename;\n+                       mimetype_icon python: \'mimetype-\' + content_type;\n+                       download_url python: \'{}/@@download/file/{}\'.format(context.absolute_url(), filename);\n+                     ">\n+            <section class="section section-main">\n \n-          <div tal:condition="python: not view.is_videotype() and not view.is_audiotype()">\n-            <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n-          </div>\n+              <div tal:condition="python: not view.is_videotype() and not view.is_audiotype()">\n+                <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n+              </div>\n \n-          <video class="w-100 mb-3"\n-                 controls="controls"\n-                 tal:condition="python: view.is_videotype()"\n-          >\n-            <source src="${python:download_url}"\n-                    type="${python:content_type}"\n-            />\n-            <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n-            <div class="small text-muted"\n-                 i18n:translate="embedded_video_not_supported"\n-            >Sorry, your browser doesn\'t support embedded videos.</div>\n-          </video>\n+              <video class="w-100 mb-3"\n+                     controls="controls"\n+                     tal:condition="python: view.is_videotype()"\n+              >\n+                <source src="${python:download_url}"\n+                        type="${python:content_type}"\n+                />\n+                <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n+                <div class="small text-muted"\n+                     i18n:translate="embedded_video_not_supported"\n+                >Sorry, your browser doesn\'t support embedded videos.</div>\n+              </video>\n \n-          <audio class="w-100 mb-3"\n-                 controls="controls"\n-                 tal:condition="python:view.is_audiotype()"\n-          >\n-            <source tal:attributes="\n-                      src python: download_url;\n-                      type python: content_type;\n-                    " />\n-            <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n-            <div class="small text-muted"\n-                 i18n:translate="embedded_audio_not_supported"\n-            >Sorry, your browser doesn\'t support embedded audio.</div>\n-          </audio>\n+              <audio class="w-100 mb-3"\n+                     controls="controls"\n+                     tal:condition="python:view.is_audiotype()"\n+              >\n+                <source tal:attributes="\n+                          src python: download_url;\n+                          type python: content_type;\n+                        " />\n+                <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n+                <div class="small text-muted"\n+                     i18n:translate="embedded_audio_not_supported"\n+                >Sorry, your browser doesn\'t support embedded audio.</div>\n+              </audio>\n \n-          <div class="h5 mb-2">\n-            <a href="${python:download_url}"\n-               tal:content="python: filename"\n-            >Filename</a>\n-          </div>\n+              <div class="h5 mb-2">\n+                <a href="${python:download_url}"\n+                   tal:content="python: filename"\n+                >Filename</a>\n+              </div>\n \n-          <div class="metadata d-flex justify-content-center text-muted small">\n-            <div class="px-2">\n-              <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-inline\', tag_alt=content_type)" />\n-              <span tal:replace="python: content_type">image/jpeg</span>\n-            </div>\n-            <div class="px-2">\n-              <tal:icon tal:replace="structure python:icons.tag(\'file-binary\', tag_class=\'icon-inline\', tag_alt=\'Size\')" />\n-              <span tal:define="\n-                      size python: view.human_readable_size();\n-                    "\n-                    tal:content="python: size"\n-              >1000 kB</span>\n-            </div>\n-          </div>\n+              <div class="metadata d-flex justify-content-center text-muted small">\n+                <div class="px-2">\n+                  <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-inline\', tag_alt=content_type)" />\n+                  <span tal:replace="python: content_type">image/jpeg</span>\n+                </div>\n+                <div class="px-2">\n+                  <tal:icon tal:replace="structure python:icons.tag(\'file-binary\', tag_class=\'icon-inline\', tag_alt=\'Size\')" />\n+                  <span tal:define="\n+                          size python: view.human_readable_size();\n+                        "\n+                        tal:content="python: size"\n+                  >1000 kB</span>\n+                </div>\n+              </div>\n \n-        </section>\n+            </section>\n \n-        <section class="section section-actions">\n-          <a class="btn btn-primary download"\n-             href="${python:download_url}"\n-             i18n:translate=""\n-          >Download</a>\n-        </section>\n+            <section class="section section-actions">\n+              <a class="btn btn-primary download"\n+                 href="${python:download_url}"\n+                 i18n:translate=""\n+              >Download</a>\n+            </section>\n+          </tal:block>\n+        </tal:has_file>\n+\n+        <tal:has_file condition="python:not file">\n+          <p i18n:translate="">\n+            There is no file uploaded.\n+          </p>\n+        </tal:has_file>\n \n       </metal:block>\n     </metal:content-core>\n'

Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2024-05-02T18:02:44+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/4bf7c7bfc2c861f5bf7b201574e8cae0e7dea571

Merge pull request #689 from plone/688-bugfix

Support using the file template on objects that have no file attributes.

Files changed:
A news/688.bugfix
M plone/app/contenttypes/browser/templates/file.pt

b'diff --git a/news/688.bugfix b/news/688.bugfix\nnew file mode 100644\nindex 000000000..5279988e1\n--- /dev/null\n+++ b/news/688.bugfix\n@@ -0,0 +1 @@\n+Support using the file template on objects that have no file attributes. [ale-rt]\ndiff --git a/plone/app/contenttypes/browser/templates/file.pt b/plone/app/contenttypes/browser/templates/file.pt\nindex 845af29c4..6da3fc036 100644\n--- a/plone/app/contenttypes/browser/templates/file.pt\n+++ b/plone/app/contenttypes/browser/templates/file.pt\n@@ -12,75 +12,88 @@\n     <metal:content-core fill-slot="content-core">\n       <metal:block define-macro="content-core"\n                    tal:define="\n-                     content_type python: context.file.contentType;\n-                     filename python: context.file.filename;\n-                     mimetype_icon python: \'mimetype-\' + content_type;\n-                     download_url python: \'{}/@@download/file/{}\'.format(context.absolute_url(), filename);\n+                     file python:context.file;\n                    "\n+                   tal:on-error="nothing"\n       >\n \n-        <section class="section section-main">\n+        <tal:has_file condition="python:file">\n+          <tal:block tal:define="\n+                       content_type context/file/contentType;\n+                       filename python: file.filename;\n+                       mimetype_icon python: \'mimetype-\' + content_type;\n+                       download_url python: \'{}/@@download/file/{}\'.format(context.absolute_url(), filename);\n+                     ">\n+            <section class="section section-main">\n \n-          <div tal:condition="python: not view.is_videotype() and not view.is_audiotype()">\n-            <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n-          </div>\n+              <div tal:condition="python: not view.is_videotype() and not view.is_audiotype()">\n+                <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n+              </div>\n \n-          <video class="w-100 mb-3"\n-                 controls="controls"\n-                 tal:condition="python: view.is_videotype()"\n-          >\n-            <source src="${python:download_url}"\n-                    type="${python:content_type}"\n-            />\n-            <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n-            <div class="small text-muted"\n-                 i18n:translate="embedded_video_not_supported"\n-            >Sorry, your browser doesn\'t support embedded videos.</div>\n-          </video>\n+              <video class="w-100 mb-3"\n+                     controls="controls"\n+                     tal:condition="python: view.is_videotype()"\n+              >\n+                <source src="${python:download_url}"\n+                        type="${python:content_type}"\n+                />\n+                <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n+                <div class="small text-muted"\n+                     i18n:translate="embedded_video_not_supported"\n+                >Sorry, your browser doesn\'t support embedded videos.</div>\n+              </video>\n \n-          <audio class="w-100 mb-3"\n-                 controls="controls"\n-                 tal:condition="python:view.is_audiotype()"\n-          >\n-            <source tal:attributes="\n-                      src python: download_url;\n-                      type python: content_type;\n-                    " />\n-            <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n-            <div class="small text-muted"\n-                 i18n:translate="embedded_audio_not_supported"\n-            >Sorry, your browser doesn\'t support embedded audio.</div>\n-          </audio>\n+              <audio class="w-100 mb-3"\n+                     controls="controls"\n+                     tal:condition="python:view.is_audiotype()"\n+              >\n+                <source tal:attributes="\n+                          src python: download_url;\n+                          type python: content_type;\n+                        " />\n+                <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-x4 mb-2\')" />\n+                <div class="small text-muted"\n+                     i18n:translate="embedded_audio_not_supported"\n+                >Sorry, your browser doesn\'t support embedded audio.</div>\n+              </audio>\n \n-          <div class="h5 mb-2">\n-            <a href="${python:download_url}"\n-               tal:content="python: filename"\n-            >Filename</a>\n-          </div>\n+              <div class="h5 mb-2">\n+                <a href="${python:download_url}"\n+                   tal:content="python: filename"\n+                >Filename</a>\n+              </div>\n \n-          <div class="metadata d-flex justify-content-center text-muted small">\n-            <div class="px-2">\n-              <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-inline\', tag_alt=content_type)" />\n-              <span tal:replace="python: content_type">image/jpeg</span>\n-            </div>\n-            <div class="px-2">\n-              <tal:icon tal:replace="structure python:icons.tag(\'file-binary\', tag_class=\'icon-inline\', tag_alt=\'Size\')" />\n-              <span tal:define="\n-                      size python: view.human_readable_size();\n-                    "\n-                    tal:content="python: size"\n-              >1000 kB</span>\n-            </div>\n-          </div>\n+              <div class="metadata d-flex justify-content-center text-muted small">\n+                <div class="px-2">\n+                  <tal:icon tal:replace="structure python:icons.tag(mimetype_icon, tag_class=\'icon-inline\', tag_alt=content_type)" />\n+                  <span tal:replace="python: content_type">image/jpeg</span>\n+                </div>\n+                <div class="px-2">\n+                  <tal:icon tal:replace="structure python:icons.tag(\'file-binary\', tag_class=\'icon-inline\', tag_alt=\'Size\')" />\n+                  <span tal:define="\n+                          size python: view.human_readable_size();\n+                        "\n+                        tal:content="python: size"\n+                  >1000 kB</span>\n+                </div>\n+              </div>\n \n-        </section>\n+            </section>\n \n-        <section class="section section-actions">\n-          <a class="btn btn-primary download"\n-             href="${python:download_url}"\n-             i18n:translate=""\n-          >Download</a>\n-        </section>\n+            <section class="section section-actions">\n+              <a class="btn btn-primary download"\n+                 href="${python:download_url}"\n+                 i18n:translate=""\n+              >Download</a>\n+            </section>\n+          </tal:block>\n+        </tal:has_file>\n+\n+        <tal:has_file condition="python:not file">\n+          <p i18n:translate="">\n+            There is no file uploaded.\n+          </p>\n+        </tal:has_file>\n \n       </metal:block>\n     </metal:content-core>\n'

