Repository: plone.api


Branch: refs/heads/master
Date: 2023-12-05T11:51:36-03:00
Author: Érico Andrei (ericof) <ericof@gmail.com>
Commit: https://github.com/plone/plone.api/commit/ba7327f412440c23bcbe5c6dc56eea4e581ad225

Fix 'api.portal.translate' usage with country-specific language codes (Fixes #524)

Files changed:
A news/524.bugfix
M src/plone/api/portal.py
M src/plone/api/tests/test_portal.py

b'diff --git a/news/524.bugfix b/news/524.bugfix\nnew file mode 100644\nindex 00000000..4e116b33\n--- /dev/null\n+++ b/news/524.bugfix\n@@ -0,0 +1 @@\n+Fix `api.portal.translate` usage with country-specific language codes [@ericof]\ndiff --git a/src/plone/api/portal.py b/src/plone/api/portal.py\nindex adef18d9..31c32632 100644\n--- a/src/plone/api/portal.py\n+++ b/src/plone/api/portal.py\n@@ -19,7 +19,7 @@\n from zope.interface.interfaces import IInterface\n \n import datetime as dtime\n-\n+import re\n \n logger = getLogger("plone.api.portal")\n \n@@ -419,6 +419,8 @@ def translate(msgid, domain="plone", lang=None):\n     :Example: :ref:`portal-translate-example`\n     """\n     translation_service = get_tool("translation_service")\n+    if lang and re.match(r"\\D{2}-\\D{2}", lang):\n+        lang = f"{lang[:2]}_{lang[-2:].upper()}"\n     query = {\n         "msgid": msgid,\n         "domain": domain,\ndiff --git a/src/plone/api/tests/test_portal.py b/src/plone/api/tests/test_portal.py\nindex 83f19886..a467ba1a 100644\n--- a/src/plone/api/tests/test_portal.py\n+++ b/src/plone/api/tests/test_portal.py\n@@ -886,3 +886,20 @@ def test_translate(self):\n             ),\n             "Avril",\n         )\n+\n+    def test_translate_with_country_codes(self):\n+        """Test translation."""\n+        self.assertEqual(\n+            portal.translate(\n+                "Page",\n+                lang="pt-br",\n+            ),\n+            "P\xc3\xa1gina",\n+        )\n+        self.assertEqual(\n+            portal.translate(\n+                "Page",\n+                lang="pt_BR",\n+            ),\n+            "P\xc3\xa1gina",\n+        )\n'

Repository: plone.api


Branch: refs/heads/master
Date: 2023-12-05T12:41:43-03:00
Author: Érico Andrei (ericof) <ericof@gmail.com>
Commit: https://github.com/plone/plone.api/commit/3feed99ed1599ac64d3bf1212de2a6befe21af5b

Fix isort

Files changed:
M src/plone/api/portal.py

b'diff --git a/src/plone/api/portal.py b/src/plone/api/portal.py\nindex 31c32632..1aec4997 100644\n--- a/src/plone/api/portal.py\n+++ b/src/plone/api/portal.py\n@@ -21,6 +21,7 @@\n import datetime as dtime\n import re\n \n+\n logger = getLogger("plone.api.portal")\n \n try:\n'

Repository: plone.api


Branch: refs/heads/master
Date: 2023-12-05T18:55:07+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.api/commit/91825e34bd2703256a397efa6dc07ddd7d93d910

Merge pull request #525 from plone/issue-524-translate

Fix 'api.portal.translate' usage with country-specific language codes

Files changed:
A news/524.bugfix
M src/plone/api/portal.py
M src/plone/api/tests/test_portal.py

b'diff --git a/news/524.bugfix b/news/524.bugfix\nnew file mode 100644\nindex 00000000..4e116b33\n--- /dev/null\n+++ b/news/524.bugfix\n@@ -0,0 +1 @@\n+Fix `api.portal.translate` usage with country-specific language codes [@ericof]\ndiff --git a/src/plone/api/portal.py b/src/plone/api/portal.py\nindex adef18d9..1aec4997 100644\n--- a/src/plone/api/portal.py\n+++ b/src/plone/api/portal.py\n@@ -19,6 +19,7 @@\n from zope.interface.interfaces import IInterface\n \n import datetime as dtime\n+import re\n \n \n logger = getLogger("plone.api.portal")\n@@ -419,6 +420,8 @@ def translate(msgid, domain="plone", lang=None):\n     :Example: :ref:`portal-translate-example`\n     """\n     translation_service = get_tool("translation_service")\n+    if lang and re.match(r"\\D{2}-\\D{2}", lang):\n+        lang = f"{lang[:2]}_{lang[-2:].upper()}"\n     query = {\n         "msgid": msgid,\n         "domain": domain,\ndiff --git a/src/plone/api/tests/test_portal.py b/src/plone/api/tests/test_portal.py\nindex 83f19886..a467ba1a 100644\n--- a/src/plone/api/tests/test_portal.py\n+++ b/src/plone/api/tests/test_portal.py\n@@ -886,3 +886,20 @@ def test_translate(self):\n             ),\n             "Avril",\n         )\n+\n+    def test_translate_with_country_codes(self):\n+        """Test translation."""\n+        self.assertEqual(\n+            portal.translate(\n+                "Page",\n+                lang="pt-br",\n+            ),\n+            "P\xc3\xa1gina",\n+        )\n+        self.assertEqual(\n+            portal.translate(\n+                "Page",\n+                lang="pt_BR",\n+            ),\n+            "P\xc3\xa1gina",\n+        )\n'

