Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-03-05T14:41:06-05:00
Author: Eric Wohnlich (ewohnlich) <eric.wohnlich@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/b84a746393cbac164be77b0c1223d4145405d2e7

move condition to parent element

Files changed:
M Products/CMFPlone/browser/templates/search.pt

b'diff --git a/Products/CMFPlone/browser/templates/search.pt b/Products/CMFPlone/browser/templates/search.pt\nindex 2c707bb178..3e0d611acf 100644\n--- a/Products/CMFPlone/browser/templates/search.pt\n+++ b/Products/CMFPlone/browser/templates/search.pt\n@@ -294,10 +294,10 @@\n \n                       <a href="${python:(item_url + \'/view\') if item_type in use_view_action else item_url}"\n                           class="state-${item/review_state}"\n+                          tal:condition="python: show_images and hasIcon"\n                           tal:define="item_url item/getURL;\n                                     item_type item/PortalType">\n                           <img class="thumb-icon"\n-                            tal:condition="python: show_images and hasIcon"\n                             tal:replace="structure python: image_scale.tag(item, \'image\', scale=search_image_scale, css_class=\'thumb-icon\')">\n                       </a>\n \n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-03-05T14:44:01-05:00
Author: Eric Wohnlich (ewohnlich) <eric.wohnlich@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/971c52d6639027d21266eeb64c8f22b77251e985

Create 3919.bugfix

Files changed:
A news/3919.bugfix

b'diff --git a/news/3919.bugfix b/news/3919.bugfix\nnew file mode 100644\nindex 0000000000..83035bd297\n--- /dev/null\n+++ b/news/3919.bugfix\n@@ -0,0 +1 @@\n+Fixes case where empty links would be present in the search results for content that does not have an icon.\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-03-05T21:39:01-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/933399c7add00ebf0f4985184e12852d96143453

Update news/3919.bugfix

Files changed:
M news/3919.bugfix

b'diff --git a/news/3919.bugfix b/news/3919.bugfix\nindex 83035bd297..01ed927b33 100644\n--- a/news/3919.bugfix\n+++ b/news/3919.bugfix\n@@ -1 +1 @@\n-Fixes case where empty links would be present in the search results for content that does not have an icon.\n+Fixes case where empty links would be present in the search results for content that does not have an icon. @ewohnlich \n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-03-05T21:40:29-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/69fed80afe7888e17a8c8844898a45a990f082a3

Merge branch 'master' into issue-3919

Files changed:
A news/3916.bugfix
M Products/CMFPlone/CatalogTool.py
M Products/CMFPlone/tests/testCatalogTool.py

b'diff --git a/Products/CMFPlone/CatalogTool.py b/Products/CMFPlone/CatalogTool.py\nindex af4e31610d..1b45f330a1 100644\n--- a/Products/CMFPlone/CatalogTool.py\n+++ b/Products/CMFPlone/CatalogTool.py\n@@ -20,6 +20,7 @@\n from plone.i18n.normalizer.base import mapUnicode\n from plone.indexer import indexer\n from plone.indexer.interfaces import IIndexableObject\n+from plone.namedfile.interfaces import IImage\n from Products.CMFCore.CatalogTool import _mergedLocalRoles\n from Products.CMFCore.CatalogTool import CatalogTool as BaseTool\n from Products.CMFCore.indexing import processQueue\n@@ -234,7 +235,8 @@ def getIcon(obj):\n     when obj is an image or has a lead image\n     or has an image field with name \'image\': true else false\n     """\n-    return bool(getattr(obj.aq_base, "image", False))\n+    img_field = getattr(obj.aq_base, "image", False)\n+    return bool(IImage.providedBy(img_field))\n \n \n @indexer(Interface)\ndiff --git a/Products/CMFPlone/tests/testCatalogTool.py b/Products/CMFPlone/tests/testCatalogTool.py\nindex 9b7aa62f69..2c8e3c2772 100644\n--- a/Products/CMFPlone/tests/testCatalogTool.py\n+++ b/Products/CMFPlone/tests/testCatalogTool.py\n@@ -10,6 +10,7 @@\n from plone.indexer.wrapper import IndexableObjectWrapper\n from plone.uuid.interfaces import IAttributeUUID\n from plone.uuid.interfaces import IUUID\n+from plone.namedfile.file import NamedImage\n from Products.CMFCore.indexing import processQueue\n from Products.CMFCore.permissions import AccessInactivePortalContent\n from Products.CMFPlone.CatalogTool import CatalogTool\n@@ -1414,6 +1415,21 @@ def test_uuid(self):\n         self.assertTrue(wrapped.UID)\n         self.assertTrue(uuid == wrapped.UID)\n \n+    def test_getIcon(self):\n+        from Products.CMFPlone.CatalogTool import getIcon\n+\n+        get_icon = getIcon.callable\n+        self.assertFalse(get_icon(self.folder))\n+        # Create an item inside the test folder\n+        self.folder.invokeFactory("Image", "image", title="Image")\n+        # Do not get the "image" content item\n+        self.assertFalse(get_icon(self.folder))\n+        # Return False if item doesn\'t have an image\n+        self.assertFalse(get_icon(self.folder.image))\n+        self.folder.image.image=NamedImage(dummy.Image())\n+        # Item has a proper image, return True\n+        self.assertTrue(get_icon(self.folder.image))\n+\n \n class TestObjectProvidedIndexExtender(unittest.TestCase):\n     def _index(self, object):\ndiff --git a/news/3916.bugfix b/news/3916.bugfix\nnew file mode 100644\nindex 0000000000..04a84477ea\n--- /dev/null\n+++ b/news/3916.bugfix\n@@ -0,0 +1,2 @@\n+When indexing for `getIcon`, check that the returned `image` is an instance of `plone.namedfile.interfaces.IImage`\n+[frapell]\n'

Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2024-03-21T00:10:09+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/6c8dbe9dcd26a8cc1fabe768640bf732dccc02c1

Merge pull request #3920 from plone/issue-3919

move condition to parent element

Files changed:
A news/3919.bugfix
M Products/CMFPlone/browser/templates/search.pt

b'diff --git a/Products/CMFPlone/browser/templates/search.pt b/Products/CMFPlone/browser/templates/search.pt\nindex 2c707bb178..3e0d611acf 100644\n--- a/Products/CMFPlone/browser/templates/search.pt\n+++ b/Products/CMFPlone/browser/templates/search.pt\n@@ -294,10 +294,10 @@\n \n                       <a href="${python:(item_url + \'/view\') if item_type in use_view_action else item_url}"\n                           class="state-${item/review_state}"\n+                          tal:condition="python: show_images and hasIcon"\n                           tal:define="item_url item/getURL;\n                                     item_type item/PortalType">\n                           <img class="thumb-icon"\n-                            tal:condition="python: show_images and hasIcon"\n                             tal:replace="structure python: image_scale.tag(item, \'image\', scale=search_image_scale, css_class=\'thumb-icon\')">\n                       </a>\n \ndiff --git a/news/3919.bugfix b/news/3919.bugfix\nnew file mode 100644\nindex 0000000000..01ed927b33\n--- /dev/null\n+++ b/news/3919.bugfix\n@@ -0,0 +1 @@\n+Fixes case where empty links would be present in the search results for content that does not have an icon. @ewohnlich \n'

