Repository: plone.formwidget.namedfile


Branch: refs/heads/master
Date: 2016-01-29T11:51:42+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.formwidget.namedfile/commit/59d0d85c774177957ea05ca4b5cd21535a3102f4

Replace deprecated zope.testing.doctestunit import with doctest module from stdlib.

Files changed:
M CHANGES.rst
M plone/formwidget/namedfile/tests.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6a1b38f..6ad0bd7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -11,6 +11,12 @@ New:
 
 - Add Finnish translations [petri]
 
+Fixes:
+
+- Replace deprecated ``zope.testing.doctestunit`` import with ``doctest``
+  module from stdlib.
+  [thet]
+
 
 1.0.13 (2015-03-21)
 -------------------
diff --git a/plone/formwidget/namedfile/tests.py b/plone/formwidget/namedfile/tests.py
index 52afc61..8e7938a 100644
--- a/plone/formwidget/namedfile/tests.py
+++ b/plone/formwidget/namedfile/tests.py
@@ -1,12 +1,11 @@
 from z3c.form import testing
-from zope.testing.doctestunit import DocFileSuite
 import doctest
 import unittest
 
 
 def test_suite():
     return unittest.TestSuite((
-        DocFileSuite(
+        doctest.DocFileSuite(
             'widget.rst',
             setUp=testing.setUp,
             tearDown=testing.tearDown,


Repository: plone.formwidget.namedfile


Branch: refs/heads/master
Date: 2016-01-29T11:52:23+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.formwidget.namedfile/commit/8c2e75e8a08dabbd2b4fdc59476e9c0db0988e84

utf-8 headers, _ instead MessageFactory

Files changed:
M plone/__init__.py
M plone/formwidget/__init__.py
M plone/formwidget/namedfile/__init__.py
M plone/formwidget/namedfile/converter.py
M plone/formwidget/namedfile/interfaces.py
M plone/formwidget/namedfile/tests.py
M plone/formwidget/namedfile/validator.py
M plone/formwidget/namedfile/widget.py
M setup.py

diff --git a/plone/__init__.py b/plone/__init__.py
index f48ad10..68c04af 100644
--- a/plone/__init__.py
+++ b/plone/__init__.py
@@ -1,6 +1,2 @@
-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
-try:
-    __import__('pkg_resources').declare_namespace(__name__)
-except ImportError:
-    from pkgutil import extend_path
-    __path__ = extend_path(__path__, __name__)
+# -*- coding: utf-8 -*-
+__import__('pkg_resources').declare_namespace(__name__)
diff --git a/plone/formwidget/__init__.py b/plone/formwidget/__init__.py
index f48ad10..68c04af 100644
--- a/plone/formwidget/__init__.py
+++ b/plone/formwidget/__init__.py
@@ -1,6 +1,2 @@
-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
-try:
-    __import__('pkg_resources').declare_namespace(__name__)
-except ImportError:
-    from pkgutil import extend_path
-    __path__ = extend_path(__path__, __name__)
+# -*- coding: utf-8 -*-
+__import__('pkg_resources').declare_namespace(__name__)
diff --git a/plone/formwidget/namedfile/__init__.py b/plone/formwidget/namedfile/__init__.py
index 99b3379..a1c3d2e 100644
--- a/plone/formwidget/namedfile/__init__.py
+++ b/plone/formwidget/namedfile/__init__.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from plone.formwidget.namedfile.widget import NamedFileFieldWidget  # noqa
 from plone.formwidget.namedfile.widget import NamedFileWidget  # noqa
 from plone.formwidget.namedfile.widget import NamedImageFieldWidget  # noqa
diff --git a/plone/formwidget/namedfile/converter.py b/plone/formwidget/namedfile/converter.py
index 7070eb1..28dd4d4 100644
--- a/plone/formwidget/namedfile/converter.py
+++ b/plone/formwidget/namedfile/converter.py
@@ -1,4 +1,4 @@
-from ZPublisher.HTTPRequest import FileUpload
+# -*- coding: utf-8 -*-
 from plone.formwidget.namedfile.interfaces import INamedFileWidget
 from plone.formwidget.namedfile.interfaces import INamedImageWidget
 from plone.namedfile.file import NamedFile
@@ -9,6 +9,7 @@
 from z3c.form.converter import BaseDataConverter
 from zope.component import adapts
 from zope.schema.interfaces import IASCII
+from ZPublisher.HTTPRequest import FileUpload
 import base64
 
 
diff --git a/plone/formwidget/namedfile/interfaces.py b/plone/formwidget/namedfile/interfaces.py
index 5d982df..e19b339 100644
--- a/plone/formwidget/namedfile/interfaces.py
+++ b/plone/formwidget/namedfile/interfaces.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from z3c.form.interfaces import IFileWidget
 from zope import schema
 
diff --git a/plone/formwidget/namedfile/tests.py b/plone/formwidget/namedfile/tests.py
index 8e7938a..366e9af 100644
--- a/plone/formwidget/namedfile/tests.py
+++ b/plone/formwidget/namedfile/tests.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from z3c.form import testing
 import doctest
 import unittest
diff --git a/plone/formwidget/namedfile/validator.py b/plone/formwidget/namedfile/validator.py
index c5ce8a4..c1a19a8 100644
--- a/plone/formwidget/namedfile/validator.py
+++ b/plone/formwidget/namedfile/validator.py
@@ -1,4 +1,5 @@
-from plone.formwidget.namedfile import MessageFactory as _
+# -*- coding: utf-8 -*-
+from plone.formwidget.namedfile import _
 from plone.namedfile.interfaces import INamedField
 from z3c.form import validator
 from zope.schema import ValidationError
diff --git a/plone/formwidget/namedfile/widget.py b/plone/formwidget/namedfile/widget.py
index 05854bb..5153c14 100644
--- a/plone/formwidget/namedfile/widget.py
+++ b/plone/formwidget/namedfile/widget.py
@@ -1,9 +1,6 @@
-from Acquisition import Explicit
+# -*- coding: utf-8 -*-
 from Acquisition import aq_inner
-from Products.CMFCore.utils import getToolByName
-from Products.Five.browser import BrowserView
-from Products.MimetypesRegistry.common import MimeTypeException
-from ZPublisher.HTTPRequest import FileUpload
+from Acquisition import Explicit
 from plone.formwidget.namedfile.converter import b64decode_file
 from plone.formwidget.namedfile.interfaces import INamedFileWidget
 from plone.formwidget.namedfile.interfaces import INamedImageWidget
@@ -16,6 +13,9 @@
 from plone.namedfile.utils import safe_basename
 from plone.namedfile.utils import set_headers
 from plone.namedfile.utils import stream_data
+from Products.CMFCore.utils import getToolByName
+from Products.Five.browser import BrowserView
+from Products.MimetypesRegistry.common import MimeTypeException
 from z3c.form.browser import file
 from z3c.form.interfaces import IDataManager
 from z3c.form.interfaces import IFieldWidget
@@ -32,6 +32,7 @@
 from zope.publisher.interfaces import NotFound
 from zope.schema.interfaces import IASCII
 from zope.size import byteDisplay
+from ZPublisher.HTTPRequest import FileUpload
 import urllib
 
 try:
diff --git a/setup.py b/setup.py
index 0b12f3d..5461aa6 100644
--- a/setup.py
+++ b/setup.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from setuptools import setup
 from setuptools import find_packages
 


Repository: plone.formwidget.namedfile


Branch: refs/heads/master
Date: 2016-01-29T11:52:23+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.formwidget.namedfile/commit/43f39cfff75b94cbd5bf4690ef296d7554d3bb73

Specify doctest encoding and make doctest more robust against formating changes.

Files changed:
M CHANGES.rst
M plone/formwidget/namedfile/tests.py
M plone/formwidget/namedfile/widget.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 6ad0bd7..c7f010a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -9,12 +9,15 @@ New:
   See https://github.com/plone/plone.formwidget.namedfile/pull/18
   [staeff] 
 
-- Add Finnish translations [petri]
+- Add Finnish translations.
+  [petri]
 
 Fixes:
 
-- Replace deprecated ``zope.testing.doctestunit`` import with ``doctest``
-  module from stdlib.
+- Specify doctest encoding and make doctest more robust against formating changes.
+  [thet]
+
+- Replace deprecated ``zope.testing.doctestunit`` import with ``doctest`` module from stdlib.
   [thet]
 
 
diff --git a/plone/formwidget/namedfile/tests.py b/plone/formwidget/namedfile/tests.py
index 366e9af..b0e3e3b 100644
--- a/plone/formwidget/namedfile/tests.py
+++ b/plone/formwidget/namedfile/tests.py
@@ -11,5 +11,6 @@ def test_suite():
             setUp=testing.setUp,
             tearDown=testing.tearDown,
             optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS,
+            encoding='utf-8'
         ),
     ))
diff --git a/plone/formwidget/namedfile/widget.rst b/plone/formwidget/namedfile/widget.rst
index 24c806b..0bcb6dc 100644
--- a/plone/formwidget/namedfile/widget.rst
+++ b/plone/formwidget/namedfile/widget.rst
@@ -243,72 +243,20 @@ characters::
 
   >>> file_widget.update()
   >>> print(file_widget.render())
-  <span class="named-file-widget required namedfile-field"
-        id="widget.id.file">
-      <span>
-          <a href="http://127.0.0.1/++widget++widget.name.file/@@download/data_%E6%B7%B1.txt">data_深.txt</a>
-          <span class="discreet"> &mdash;
-              text/plain,
-              1 KB
-          </span>
-      </span>
-      <div style="padding-top: 1em;">
-          <input type="radio" value="nochange"
-                 class="noborder" checked="checked"
-                 name="widget.name.file.action"
-                 onclick="document.getElementById('widget.id.file-input').disabled=true"
-                 id="widget.id.file-nochange" />
-          <label for="widget.id.file-nochange">Keep existing file</label>
-  <BLANKLINE>
-          <br />
-          <input type="radio" value="replace" class="noborder"
-                 name="widget.name.file.action"
-                 onclick="document.getElementById('widget.id.file-input').disabled=false"
-                 id="widget.id.file-replace" />
-          <label for="widget.id.file-replace">Replace with new file</label>
-      </div>
-      <div style="padding-left: 1.5em; padding-top: 0.5em;">
-          <input type="file" id="widget.id.file-input"
-                 name="widget.name.file" />
-          <script type="text/javascript">document.getElementById('widget.id.file-input').disabled=true;</script>
-      </div>
-  </span>
-  <BLANKLINE>
+  <... class="named-file-widget required namedfile-field" id="widget.id.file">...
+  <a href="http://127.0.0.1/++widget++widget.name.file/@@download/data_%E6%B7%B1.txt">data_深.txt</a>...
+  <input type="radio"... id="widget.id.file-nochange"...
+  <input type="radio"... id="widget.id.file-replace"...
+  <input type="file"... id="widget.id.file-input"...
 
   >>> image_widget.update()
   >>> print(image_widget.render())
-  <span class="named-image-widget required namedimage-field"
-        id="widget.id.image">
-      <span>
-          <img src="http://127.0.0.1/++widget++widget.name.image/@@download/faux.png"
-               width="-1" /><br />
-          <a href="http://127.0.0.1/++widget++widget.name.image/@@download/faux.png">faux.png</a>
-          <span class="discreet"> &mdash;
-              1 KB
-          </span>
-      </span>
-      <div style="padding-top: 1em;">
-          <input type="radio" value="nochange"
-                 class="noborder" checked="checked"
-                 name="widget.name.image.action"
-                 onclick="document.getElementById('widget.id.image-input').disabled=true"
-                 id="widget.id.image-nochange" />
-          <label for="widget.id.image-nochange">Keep existing image</label>
-  <BLANKLINE>
-          <br />
-          <input type="radio" value="replace" class="noborder"
-                 name="widget.name.image.action"
-                 onclick="document.getElementById('widget.id.image-input').disabled=false"
-                 id="widget.id.image-replace" />
-          <label for="widget.id.image-replace">Replace with new image</label>
-      </div>
-      <div style="padding-left: 1.5em; padding-top: 0.5em;">
-          <input type="file" id="widget.id.image-input"
-                 name="widget.name.image" />
-          <script type="text/javascript">document.getElementById('widget.id.image-input').disabled=true;</script>
-      </div>
-  </span>
-  <BLANKLINE>
+  <... class="named-image-widget required namedimage-field" id="widget.id.image">...
+  <img src="http://127.0.0.1/++widget++widget.name.image/@@download/faux.png" width="-1" />...
+  <a href="http://127.0.0.1/++widget++widget.name.image/@@download/faux.png">faux.png</a>...
+  <input type="radio"... id="widget.id.image-nochange"...
+  <input type="radio"... id="widget.id.image-replace"...
+  <input type="file"... id="widget.id.image-input"...
 
 (the image height and width are taken from the NamedImage instance, and here
 default to -1 since we didn't upload a real image)
@@ -338,71 +286,19 @@ empty, the behaviour is the same as before::
 If the widgets are rendered again, the newly uploaded files will be shown::
 
   >>> print(file_widget.render())
-  <span class="named-file-widget required namedfile-field"
-        id="widget.id.file">
-      <span>
-          <a href="http://127.0.0.1/++widget++widget.name.file/@@download/test2.txt">test2.txt</a>
-          <span class="discreet"> &mdash;
-              0 KB
-          </span>
-      </span>
-      <div style="padding-top: 1em;">
-          <input type="radio" value="nochange"
-                 class="noborder" checked="checked"
-                 name="widget.name.file.action"
-                 onclick="document.getElementById('widget.id.file-input').disabled=true"
-                 id="widget.id.file-nochange" />
-          <label for="widget.id.file-nochange">Keep existing file</label>
-  <BLANKLINE>
-          <br />
-          <input type="radio" value="replace" class="noborder"
-                 name="widget.name.file.action"
-                 onclick="document.getElementById('widget.id.file-input').disabled=false"
-                 id="widget.id.file-replace" />
-          <label for="widget.id.file-replace">Replace with new file</label>
-      </div>
-      <div style="padding-left: 1.5em; padding-top: 0.5em;">
-          <input type="file" id="widget.id.file-input"
-                 name="widget.name.file" />
-          <script type="text/javascript">document.getElementById('widget.id.file-input').disabled=true;</script>
-      </div>
-  </span>
-  <BLANKLINE>
-
+  <... class="named-file-widget required namedfile-field" id="widget.id.file">...
+  <a href="http://127.0.0.1/++widget++widget.name.file/@@download/test2.txt">test2.txt</a>...
+  <input type="radio"... id="widget.id.file-nochange"...
+  <input type="radio"... id="widget.id.file-replace"...
+  <input type="file"... id="widget.id.file-input"...
 
   >>> print(image_widget.render())
-  <span class="named-image-widget required namedimage-field"
-        id="widget.id.image">
-      <span>
-          <img src="http://127.0.0.1/++widget++widget.name.image/@@download/faux2.png"
-               width="128" /><br />
-          <a href="http://127.0.0.1/++widget++widget.name.image/@@download/faux2.png">faux2.png</a>
-          <span class="discreet"> &mdash;
-              0 KB
-          </span>
-      </span>
-      <div style="padding-top: 1em;">
-          <input type="radio" value="nochange"
-                 class="noborder" checked="checked"
-                 name="widget.name.image.action"
-                 onclick="document.getElementById('widget.id.image-input').disabled=true"
-                 id="widget.id.image-nochange" />
-          <label for="widget.id.image-nochange">Keep existing image</label>
-  <BLANKLINE>
-          <br />
-          <input type="radio" value="replace" class="noborder"
-                 name="widget.name.image.action"
-                 onclick="document.getElementById('widget.id.image-input').disabled=false"
-                 id="widget.id.image-replace" />
-          <label for="widget.id.image-replace">Replace with new image</label>
-      </div>
-      <div style="padding-left: 1.5em; padding-top: 0.5em;">
-          <input type="file" id="widget.id.image-input"
-                 name="widget.name.image" />
-          <script type="text/javascript">document.getElementById('widget.id.image-input').disabled=true;</script>
-      </div>
-  </span>
-  <BLANKLINE>
+  <... class="named-image-widget required namedimage-field" id="widget.id.image">...
+  <img src="http://127.0.0.1/++widget++widget.name.image/@@download/faux2.png" width="128" />...
+  <a href="http://127.0.0.1/++widget++widget.name.image/@@download/faux2.png">faux2.png</a>...
+  <input type="radio"... id="widget.id.image-nochange"...
+  <input type="radio"... id="widget.id.image-replace"...
+  <input type="file"... id="widget.id.image-input"...
 
 However, if we provide the '.action' field, we get back the value currently
 stored in the field::


Repository: plone.formwidget.namedfile


Branch: refs/heads/master
Date: 2016-01-29T16:38:01+01:00
Author: Johannes Raggam (thet) <thetetet@gmail.com>
Commit: https://github.com/plone/plone.formwidget.namedfile/commit/d51364c23292af2f9474c10ba55f991b11d541ef

Merge pull request #17 from plone/thet-zope4

Zope4

Files changed:
M CHANGES.rst
M plone/__init__.py
M plone/formwidget/__init__.py
M plone/formwidget/namedfile/__init__.py
M plone/formwidget/namedfile/converter.py
M plone/formwidget/namedfile/interfaces.py
M plone/formwidget/namedfile/tests.py
M plone/formwidget/namedfile/validator.py
M plone/formwidget/namedfile/widget.py
M plone/formwidget/namedfile/widget.rst
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6a1b38f..c7f010a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -9,7 +9,16 @@ New:
   See https://github.com/plone/plone.formwidget.namedfile/pull/18
   [staeff] 
 
-- Add Finnish translations [petri]
+- Add Finnish translations.
+  [petri]
+
+Fixes:
+
+- Specify doctest encoding and make doctest more robust against formating changes.
+  [thet]
+
+- Replace deprecated ``zope.testing.doctestunit`` import with ``doctest`` module from stdlib.
+  [thet]
 
 
 1.0.13 (2015-03-21)
diff --git a/plone/__init__.py b/plone/__init__.py
index f48ad10..68c04af 100644
--- a/plone/__init__.py
+++ b/plone/__init__.py
@@ -1,6 +1,2 @@
-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
-try:
-    __import__('pkg_resources').declare_namespace(__name__)
-except ImportError:
-    from pkgutil import extend_path
-    __path__ = extend_path(__path__, __name__)
+# -*- coding: utf-8 -*-
+__import__('pkg_resources').declare_namespace(__name__)
diff --git a/plone/formwidget/__init__.py b/plone/formwidget/__init__.py
index f48ad10..68c04af 100644
--- a/plone/formwidget/__init__.py
+++ b/plone/formwidget/__init__.py
@@ -1,6 +1,2 @@
-# See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
-try:
-    __import__('pkg_resources').declare_namespace(__name__)
-except ImportError:
-    from pkgutil import extend_path
-    __path__ = extend_path(__path__, __name__)
+# -*- coding: utf-8 -*-
+__import__('pkg_resources').declare_namespace(__name__)
diff --git a/plone/formwidget/namedfile/__init__.py b/plone/formwidget/namedfile/__init__.py
index 99b3379..a1c3d2e 100644
--- a/plone/formwidget/namedfile/__init__.py
+++ b/plone/formwidget/namedfile/__init__.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from plone.formwidget.namedfile.widget import NamedFileFieldWidget  # noqa
 from plone.formwidget.namedfile.widget import NamedFileWidget  # noqa
 from plone.formwidget.namedfile.widget import NamedImageFieldWidget  # noqa
diff --git a/plone/formwidget/namedfile/converter.py b/plone/formwidget/namedfile/converter.py
index 7070eb1..28dd4d4 100644
--- a/plone/formwidget/namedfile/converter.py
+++ b/plone/formwidget/namedfile/converter.py
@@ -1,4 +1,4 @@
-from ZPublisher.HTTPRequest import FileUpload
+# -*- coding: utf-8 -*-
 from plone.formwidget.namedfile.interfaces import INamedFileWidget
 from plone.formwidget.namedfile.interfaces import INamedImageWidget
 from plone.namedfile.file import NamedFile
@@ -9,6 +9,7 @@
 from z3c.form.converter import BaseDataConverter
 from zope.component import adapts
 from zope.schema.interfaces import IASCII
+from ZPublisher.HTTPRequest import FileUpload
 import base64
 
 
diff --git a/plone/formwidget/namedfile/interfaces.py b/plone/formwidget/namedfile/interfaces.py
index 5d982df..e19b339 100644
--- a/plone/formwidget/namedfile/interfaces.py
+++ b/plone/formwidget/namedfile/interfaces.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from z3c.form.interfaces import IFileWidget
 from zope import schema
 
diff --git a/plone/formwidget/namedfile/tests.py b/plone/formwidget/namedfile/tests.py
index 52afc61..b0e3e3b 100644
--- a/plone/formwidget/namedfile/tests.py
+++ b/plone/formwidget/namedfile/tests.py
@@ -1,15 +1,16 @@
+# -*- coding: utf-8 -*-
 from z3c.form import testing
-from zope.testing.doctestunit import DocFileSuite
 import doctest
 import unittest
 
 
 def test_suite():
     return unittest.TestSuite((
-        DocFileSuite(
+        doctest.DocFileSuite(
             'widget.rst',
             setUp=testing.setUp,
             tearDown=testing.tearDown,
             optionflags=doctest.NORMALIZE_WHITESPACE | doctest.ELLIPSIS,
+            encoding='utf-8'
         ),
     ))
diff --git a/plone/formwidget/namedfile/validator.py b/plone/formwidget/namedfile/validator.py
index c5ce8a4..c1a19a8 100644
--- a/plone/formwidget/namedfile/validator.py
+++ b/plone/formwidget/namedfile/validator.py
@@ -1,4 +1,5 @@
-from plone.formwidget.namedfile import MessageFactory as _
+# -*- coding: utf-8 -*-
+from plone.formwidget.namedfile import _
 from plone.namedfile.interfaces import INamedField
 from z3c.form import validator
 from zope.schema import ValidationError
diff --git a/plone/formwidget/namedfile/widget.py b/plone/formwidget/namedfile/widget.py
index 05854bb..5153c14 100644
--- a/plone/formwidget/namedfile/widget.py
+++ b/plone/formwidget/namedfile/widget.py
@@ -1,9 +1,6 @@
-from Acquisition import Explicit
+# -*- coding: utf-8 -*-
 from Acquisition import aq_inner
-from Products.CMFCore.utils import getToolByName
-from Products.Five.browser import BrowserView
-from Products.MimetypesRegistry.common import MimeTypeException
-from ZPublisher.HTTPRequest import FileUpload
+from Acquisition import Explicit
 from plone.formwidget.namedfile.converter import b64decode_file
 from plone.formwidget.namedfile.interfaces import INamedFileWidget
 from plone.formwidget.namedfile.interfaces import INamedImageWidget
@@ -16,6 +13,9 @@
 from plone.namedfile.utils import safe_basename
 from plone.namedfile.utils import set_headers
 from plone.namedfile.utils import stream_data
+from Products.CMFCore.utils import getToolByName
+from Products.Five.browser import BrowserView
+from Products.MimetypesRegistry.common import MimeTypeException
 from z3c.form.browser import file
 from z3c.form.interfaces import IDataManager
 from z3c.form.interfaces import IFieldWidget
@@ -32,6 +32,7 @@
 from zope.publisher.interfaces import NotFound
 from zope.schema.interfaces import IASCII
 from zope.size import byteDisplay
+from ZPublisher.HTTPRequest import FileUpload
 import urllib
 
 try:
diff --git a/plone/formwidget/namedfile/widget.rst b/plone/formwidget/namedfile/widget.rst
index 24c806b..0bcb6dc 100644
--- a/plone/formwidget/namedfile/widget.rst
+++ b/plone/formwidget/namedfile/widget.rst
@@ -243,72 +243,20 @@ characters::
 
   >>> file_widget.update()
   >>> print(file_widget.render())
-  <span class="named-file-widget required namedfile-field"
-        id="widget.id.file">
-      <span>
-          <a href="http://127.0.0.1/++widget++widget.name.file/@@download/data_%E6%B7%B1.txt">data_深.txt</a>
-          <span class="discreet"> &mdash;
-              text/plain,
-              1 KB
-          </span>
-      </span>
-      <div style="padding-top: 1em;">
-          <input type="radio" value="nochange"
-                 class="noborder" checked="checked"
-                 name="widget.name.file.action"
-                 onclick="document.getElementById('widget.id.file-input').disabled=true"
-                 id="widget.id.file-nochange" />
-          <label for="widget.id.file-nochange">Keep existing file</label>
-  <BLANKLINE>
-          <br />
-          <input type="radio" value="replace" class="noborder"
-                 name="widget.name.file.action"
-                 onclick="document.getElementById('widget.id.file-input').disabled=false"
-                 id="widget.id.file-replace" />
-          <label for="widget.id.file-replace">Replace with new file</label>
-      </div>
-      <div style="padding-left: 1.5em; padding-top: 0.5em;">
-          <input type="file" id="widget.id.file-input"
-                 name="widget.name.file" />
-          <script type="text/javascript">document.getElementById('widget.id.file-input').disabled=true;</script>
-      </div>
-  </span>
-  <BLANKLINE>
+  <... class="named-file-widget required namedfile-field" id="widget.id.file">...
+  <a href="http://127.0.0.1/++widget++widget.name.file/@@download/data_%E6%B7%B1.txt">data_深.txt</a>...
+  <input type="radio"... id="widget.id.file-nochange"...
+  <input type="radio"... id="widget.id.file-replace"...
+  <input type="file"... id="widget.id.file-input"...
 
   >>> image_widget.update()
   >>> print(image_widget.render())
-  <span class="named-image-widget required namedimage-field"
-        id="widget.id.image">
-      <span>
-          <img src="http://127.0.0.1/++widget++widget.name.image/@@download/faux.png"
-               width="-1" /><br />
-          <a href="http://127.0.0.1/++widget++widget.name.image/@@download/faux.png">faux.png</a>
-          <span class="discreet"> &mdash;
-              1 KB
-          </span>
-      </span>
-      <div style="padding-top: 1em;">
-          <input type="radio" value="nochange"
-                 class="noborder" checked="checked"
-                 name="widget.name.image.action"
-                 onclick="document.getElementById('widget.id.image-input').disabled=true"
-                 id="widget.id.image-nochange" />
-          <label for="widget.id.image-nochange">Keep existing image</label>
-  <BLANKLINE>
-          <br />
-          <input type="radio" value="replace" class="noborder"
-                 name="widget.name.image.action"
-                 onclick="document.getElementById('widget.id.image-input').disabled=false"
-                 id="widget.id.image-replace" />
-          <label for="widget.id.image-replace">Replace with new image</label>
-      </div>
-      <div style="padding-left: 1.5em; padding-top: 0.5em;">
-          <input type="file" id="widget.id.image-input"
-                 name="widget.name.image" />
-          <script type="text/javascript">document.getElementById('widget.id.image-input').disabled=true;</script>
-      </div>
-  </span>
-  <BLANKLINE>
+  <... class="named-image-widget required namedimage-field" id="widget.id.image">...
+  <img src="http://127.0.0.1/++widget++widget.name.image/@@download/faux.png" width="-1" />...
+  <a href="http://127.0.0.1/++widget++widget.name.image/@@download/faux.png">faux.png</a>...
+  <input type="radio"... id="widget.id.image-nochange"...
+  <input type="radio"... id="widget.id.image-replace"...
+  <input type="file"... id="widget.id.image-input"...
 
 (the image height and width are taken from the NamedImage instance, and here
 default to -1 since we didn't upload a real image)
@@ -338,71 +286,19 @@ empty, the behaviour is the same as before::
 If the widgets are rendered again, the newly uploaded files will be shown::
 
   >>> print(file_widget.render())
-  <span class="named-file-widget required namedfile-field"
-        id="widget.id.file">
-      <span>
-          <a href="http://127.0.0.1/++widget++widget.name.file/@@download/test2.txt">test2.txt</a>
-          <span class="discreet"> &mdash;
-              0 KB
-          </span>
-      </span>
-      <div style="padding-top: 1em;">
-          <input type="radio" value="nochange"
-                 class="noborder" checked="checked"
-                 name="widget.name.file.action"
-                 onclick="document.getElementById('widget.id.file-input').disabled=true"
-                 id="widget.id.file-nochange" />
-          <label for="widget.id.file-nochange">Keep existing file</label>
-  <BLANKLINE>
-          <br />
-          <input type="radio" value="replace" class="noborder"
-                 name="widget.name.file.action"
-                 onclick="document.getElementById('widget.id.file-input').disabled=false"
-                 id="widget.id.file-replace" />
-          <label for="widget.id.file-replace">Replace with new file</label>
-      </div>
-      <div style="padding-left: 1.5em; padding-top: 0.5em;">
-          <input type="file" id="widget.id.file-input"
-                 name="widget.name.file" />
-          <script type="text/javascript">document.getElementById('widget.id.file-input').disabled=true;</script>
-      </div>
-  </span>
-  <BLANKLINE>
-
+  <... class="named-file-widget required namedfile-field" id="widget.id.file">...
+  <a href="http://127.0.0.1/++widget++widget.name.file/@@download/test2.txt">test2.txt</a>...
+  <input type="radio"... id="widget.id.file-nochange"...
+  <input type="radio"... id="widget.id.file-replace"...
+  <input type="file"... id="widget.id.file-input"...
 
   >>> print(image_widget.render())
-  <span class="named-image-widget required namedimage-field"
-        id="widget.id.image">
-      <span>
-          <img src="http://127.0.0.1/++widget++widget.name.image/@@download/faux2.png"
-               width="128" /><br />
-          <a href="http://127.0.0.1/++widget++widget.name.image/@@download/faux2.png">faux2.png</a>
-          <span class="discreet"> &mdash;
-              0 KB
-          </span>
-      </span>
-      <div style="padding-top: 1em;">
-          <input type="radio" value="nochange"
-                 class="noborder" checked="checked"
-                 name="widget.name.image.action"
-                 onclick="document.getElementById('widget.id.image-input').disabled=true"
-                 id="widget.id.image-nochange" />
-          <label for="widget.id.image-nochange">Keep existing image</label>
-  <BLANKLINE>
-          <br />
-          <input type="radio" value="replace" class="noborder"
-                 name="widget.name.image.action"
-                 onclick="document.getElementById('widget.id.image-input').disabled=false"
-                 id="widget.id.image-replace" />
-          <label for="widget.id.image-replace">Replace with new image</label>
-      </div>
-      <div style="padding-left: 1.5em; padding-top: 0.5em;">
-          <input type="file" id="widget.id.image-input"
-                 name="widget.name.image" />
-          <script type="text/javascript">document.getElementById('widget.id.image-input').disabled=true;</script>
-      </div>
-  </span>
-  <BLANKLINE>
+  <... class="named-image-widget required namedimage-field" id="widget.id.image">...
+  <img src="http://127.0.0.1/++widget++widget.name.image/@@download/faux2.png" width="128" />...
+  <a href="http://127.0.0.1/++widget++widget.name.image/@@download/faux2.png">faux2.png</a>...
+  <input type="radio"... id="widget.id.image-nochange"...
+  <input type="radio"... id="widget.id.image-replace"...
+  <input type="file"... id="widget.id.image-input"...
 
 However, if we provide the '.action' field, we get back the value currently
 stored in the field::
diff --git a/setup.py b/setup.py
index 0b12f3d..5461aa6 100644
--- a/setup.py
+++ b/setup.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from setuptools import setup
 from setuptools import find_packages
 


