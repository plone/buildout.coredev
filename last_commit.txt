Repository: plone.restapi


Branch: refs/heads/master
Date: 2021-03-22T15:23:56+01:00
Author: Víctor Fernández de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/7567859c8eb6103d01b75b784752b3ae0587aa8b

@contextnavigation endpoint does not honor nav_title index (#1093)

Files changed:
A news/1092.bugfix
M src/plone/restapi/services/contextnavigation/get.py

b'diff --git a/news/1092.bugfix b/news/1092.bugfix\nnew file mode 100644\nindex 000000000..cc2531311\n--- /dev/null\n+++ b/news/1092.bugfix\n@@ -0,0 +1,2 @@\n+@contextnavigation endpoint does not honor nav_title index\n+[sneridagh]\ndiff --git a/src/plone/restapi/services/contextnavigation/get.py b/src/plone/restapi/services/contextnavigation/get.py\nindex e90ea8007..d2929cf86 100644\n--- a/src/plone/restapi/services/contextnavigation/get.py\n+++ b/src/plone/restapi/services/contextnavigation/get.py\n@@ -735,6 +735,12 @@ def subtreeFilter(self, node):\n         else:\n             return True\n \n+    def decoratorFactory(self, node):\n+        new_node = SitemapNavtreeStrategy.decoratorFactory(self, node)\n+        if getattr(new_node["item"], "nav_title", False):\n+            new_node["nav_title"] = new_node["item"].nav_title\n+        return new_node\n+\n     # def nodeFilter(self, node):\n     #     exclude = getattr(node["item"], "exclude_from_nav", False)\n     #     return not exclude\n'

