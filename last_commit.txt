Repository: plone.restapi


Branch: refs/heads/main
Date: 2024-09-03T19:18:12-07:00
Author: Alessandro Ceglie (sauzher) <sauzher@gmail.com>
Commit: https://github.com/plone/plone.restapi/commit/aec08ce8f9d787694142a76b16f3147fef5d628c

fix #1802 and #1803 (#1804)

* fix #1802 and #1803

* changelog

* accepted stevepiercy suggestion on changelog

Files changed:
A news/1802.bugfix
M src/plone/restapi/pas/add_plugin.zpt
M src/plone/restapi/pas/config.zpt

b'diff --git a/news/1802.bugfix b/news/1802.bugfix\nnew file mode 100644\nindex 000000000..347ab28a2\n--- /dev/null\n+++ b/news/1802.bugfix\n@@ -0,0 +1 @@\n+Fixed implementation of the `jwt_auth` plugin. It now can be added, and its properties, `use_keyring` and `store_tokens`, can be updated. @sauzher\ndiff --git a/src/plone/restapi/pas/add_plugin.zpt b/src/plone/restapi/pas/add_plugin.zpt\nindex b7e8c3636..74ef44710 100644\n--- a/src/plone/restapi/pas/add_plugin.zpt\n+++ b/src/plone/restapi/pas/add_plugin.zpt\n@@ -14,7 +14,7 @@\n       <div class="form-group row">\n         <label for="id_" class="form-label col-sm-3 col-md-2">Id</label>\n         <div class="col-sm-9 col-md-10">\n-          <input id="id_" name="id" class="form-control" type="text" tal:attributes="value request/id|string:jwt_auth" />\n+          <input id="id_" name="id_" class="form-control" type="text" tal:attributes="value request/id_|string:jwt_auth" />\n         </div>\n       </div>\n \ndiff --git a/src/plone/restapi/pas/config.zpt b/src/plone/restapi/pas/config.zpt\nindex bfe372989..ecb3859a8 100644\n--- a/src/plone/restapi/pas/config.zpt\n+++ b/src/plone/restapi/pas/config.zpt\n@@ -10,19 +10,19 @@\n   <form action="manage_updateConfig" method="post">\n     <div class="form-group">\n       <label class="form-label" for="token_timeout">Token Validity Timeout (in seconds)</label>\n-      <input type="text"       \n+      <input type="text"\n              name="token_timeout"\n              class="form-control"\n              tal:attributes="value context/token_timeout|nothing"/>\n       <small class="form-text text-muted">After this, the token is invalid and the user must login again. Set to 0 for the token to remain valid indefinitely.</small>\n     </div>\n-    \n+\n     <div class="form-group">\n       <div class="form-check">\n-        <input class="form-check-input" \n-               type="checkbox" value="" \n-               name="use_keyring" \n-               id="use_keyring" \n+        <input class="form-check-input"\n+               type="checkbox" value="True"\n+               name="use_keyring"\n+               id="use_keyring"\n                tal:attributes="checked python: context.use_keyring and \'checked\'">\n         <label class="form-check-label" for="use_keyring">Use Keyring</label>\n         <small class="form-text text-muted">If enabled, tokens are signed with a secret from Plone\'s keyring. If you want tokens that remain valid indefinitely you should disable this.</small>\n@@ -31,10 +31,10 @@\n \n     <div class="form-group">\n       <div class="form-check">\n-        <input class="form-check-input" \n-               type="checkbox" value="" \n-               name="store_tokens" \n-               id="store_tokens" \n+        <input class="form-check-input"\n+               type="checkbox" value="True"\n+               name="store_tokens"\n+               id="store_tokens"\n                tal:attributes="checked python: context.store_tokens and \'checked\'">\n         <label class="form-check-label" for="store_tokens">Store tokens</label>\n         <small class="form-text text-muted">By default tokens are not stored on the server and thus can\'t be invalidated. If enabled, tokens that don\'t expire can be invalidated.</small>\n'

