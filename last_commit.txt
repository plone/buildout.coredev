Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2020-07-24T03:00:04+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/7e16f71ac90737ce733da6d735a54f000c7decee

Control panel configlets: first check visibility, then check condition.

Visibility is cheaper to check.
Also fixes https://github.com/plone/Products.CMFPlone/issues/3154.

Files changed:
A news/3154.bugfix
M Products/CMFPlone/PloneControlPanel.py

b"diff --git a/Products/CMFPlone/PloneControlPanel.py b/Products/CMFPlone/PloneControlPanel.py\nindex 9e97d7c58b..e5b05f12b9 100644\n--- a/Products/CMFPlone/PloneControlPanel.py\n+++ b/Products/CMFPlone/PloneControlPanel.py\n@@ -131,8 +131,7 @@ def enumConfiglets(self, group=None):\n             for permission in a.permissions:\n                 if _checkPermission(permission, portal):\n                     verified = 1\n-            if verified and a.category == group and a.testCondition(context) \\\n-                    and a.visible:\n+            if verified and a.category == group and a.visible and a.testCondition(context):\n                 res.append(a.getAction(context))\n         # Translate the title for sorting\n         if getattr(self, 'REQUEST', None) is not None:\ndiff --git a/news/3154.bugfix b/news/3154.bugfix\nnew file mode 100644\nindex 0000000000..e87830ab60\n--- /dev/null\n+++ b/news/3154.bugfix\n@@ -0,0 +1,4 @@\n+Control panel configlets: first check visibility, then check condition.\n+Visibility is cheaper to check.\n+Also fixes `bug 3154 <https://github.com/plone/Products.CMFPlone/issues/3154>`_.\n+[maurits]\n"

Repository: Products.CMFPlone


Branch: refs/heads/5.2.x
Date: 2020-07-24T16:01:32+02:00
Author: Fred van Dijk (fredvd) <fredvd@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/086a0ae0680710f8447d129f9e560dbccc33635c

Merge pull request #3155 from plone/maurits/issue-3154-configlet-condition-check

Control panel configlets: first check visibility, then check condition.

Files changed:
A news/3154.bugfix
M Products/CMFPlone/PloneControlPanel.py

b"diff --git a/Products/CMFPlone/PloneControlPanel.py b/Products/CMFPlone/PloneControlPanel.py\nindex 9e97d7c58b..e5b05f12b9 100644\n--- a/Products/CMFPlone/PloneControlPanel.py\n+++ b/Products/CMFPlone/PloneControlPanel.py\n@@ -131,8 +131,7 @@ def enumConfiglets(self, group=None):\n             for permission in a.permissions:\n                 if _checkPermission(permission, portal):\n                     verified = 1\n-            if verified and a.category == group and a.testCondition(context) \\\n-                    and a.visible:\n+            if verified and a.category == group and a.visible and a.testCondition(context):\n                 res.append(a.getAction(context))\n         # Translate the title for sorting\n         if getattr(self, 'REQUEST', None) is not None:\ndiff --git a/news/3154.bugfix b/news/3154.bugfix\nnew file mode 100644\nindex 0000000000..e87830ab60\n--- /dev/null\n+++ b/news/3154.bugfix\n@@ -0,0 +1,4 @@\n+Control panel configlets: first check visibility, then check condition.\n+Visibility is cheaper to check.\n+Also fixes `bug 3154 <https://github.com/plone/Products.CMFPlone/issues/3154>`_.\n+[maurits]\n"

