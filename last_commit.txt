Repository: plone.restapi


Branch: refs/heads/master
Date: 2020-06-29T09:29:23+02:00
Author: Gauthier Bastien (gbastien) <g.bastien@imio.be>
Commit: https://github.com/plone/plone.restapi/commit/9fec2b94bcbbed8071a2cdc5ced2a8908fbe6606

Removed useless management of metadata_fields in SearchHandler/LazyCatalogResultSerializer (#972)

* Removed useless management of metadata_fields in SearchHandler/LazyCatalogResultSerializer since it is handled in DefaultJSONSummarySerializer, see #970

* black

* Clean

Files changed:
A news/970.bugfix
M setup.py
M src/plone/restapi/search/handler.py
M src/plone/restapi/serializer/catalog.py

b'diff --git a/news/970.bugfix b/news/970.bugfix\nnew file mode 100644\nindex 000000000..1f6446b3f\n--- /dev/null\n+++ b/news/970.bugfix\n@@ -0,0 +1 @@\n+Removed useless management of metadata_fields in SearchHandler/LazyCatalogResultSerializer since it is handled in DefaultJSONSummarySerializer. [gbastien]\ndiff --git a/setup.py b/setup.py\nindex c194a0623..0619886be 100644\n--- a/setup.py\n+++ b/setup.py\n@@ -1,6 +1,7 @@\n from setuptools import setup, find_packages\n \n import sys\n+\n version = "7.0.0a5.dev0"\n \n \ndiff --git a/src/plone/restapi/search/handler.py b/src/plone/restapi/search/handler.py\nindex a1d969b9f..032435003 100644\n--- a/src/plone/restapi/search/handler.py\n+++ b/src/plone/restapi/search/handler.py\n@@ -74,16 +74,12 @@ def search(self, query=None):\n         else:\n             fullobjects = False\n \n-        metadata_fields = query.pop("metadata_fields", [])\n-        if not isinstance(metadata_fields, list):\n-            metadata_fields = [metadata_fields]\n-\n         self._constrain_query_by_path(query)\n         query = self._parse_query(query)\n \n         lazy_resultset = self.catalog.searchResults(query)\n         results = getMultiAdapter((lazy_resultset, self.request), ISerializeToJson)(\n-            metadata_fields=metadata_fields, fullobjects=fullobjects\n+            fullobjects=fullobjects\n         )\n \n         return results\ndiff --git a/src/plone/restapi/serializer/catalog.py b/src/plone/restapi/serializer/catalog.py\nindex 1e151b4ed..075352570 100644\n--- a/src/plone/restapi/serializer/catalog.py\n+++ b/src/plone/restapi/serializer/catalog.py\n@@ -28,7 +28,7 @@ def __init__(self, lazy_resultset, request):\n         self.lazy_resultset = lazy_resultset\n         self.request = request\n \n-    def __call__(self, metadata_fields=(), fullobjects=False):\n+    def __call__(self, fullobjects=False):\n         batch = HypermediaBatch(self.request, self.lazy_resultset)\n \n         results = {}\n'

