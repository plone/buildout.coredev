Repository: plone.rest


Branch: refs/heads/main
Date: 2023-10-26T11:26:16-07:00
Author: Dylan Jay (djay) <software@pretaweb.com>
Commit: https://github.com/plone/plone.rest/commit/ca5bee89636cf3e5da350500cadec19b383fd01c

fix for weird requests with media types with extra /

Files changed:
M src/plone/rest/negotiation.py

b'diff --git a/src/plone/rest/negotiation.py b/src/plone/rest/negotiation.py\nindex 63f2f31..3b23eb4 100644\n--- a/src/plone/rest/negotiation.py\n+++ b/src/plone/rest/negotiation.py\n@@ -11,7 +11,7 @@ def parse_accept_header(accept):\n     for media_range in accept.split(","):\n         media_type = media_range.split(";")[0].strip()\n         if "/" in media_type:\n-            type_, subtype = media_type.split("/")\n+            type_, subtype = media_type.split("/", 1)\n             media_types.append((type_, subtype))\n     return media_types\n \n'

Repository: plone.rest


Branch: refs/heads/main
Date: 2023-10-26T11:26:16-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.rest/commit/c7115e6451a286a3b60abd6464cdcc27d2241def

add test

Files changed:
M src/plone/rest/tests/test_negotiation.py

b'diff --git a/src/plone/rest/tests/test_negotiation.py b/src/plone/rest/tests/test_negotiation.py\nindex 3978b88..75385a3 100644\n--- a/src/plone/rest/tests/test_negotiation.py\n+++ b/src/plone/rest/tests/test_negotiation.py\n@@ -56,6 +56,9 @@ def test_parse_all_media_types_accept_header(self):\n     def test_parse_invalid_accept_header(self):\n         self.assertEqual([], parse_accept_header("invalid"))\n \n+    def test_parse_mimetype_with_extra_slash(self):\n+        self.assertEqual([("application", "x/y")], parse_accept_header("application/x/y"))\n+\n \n class TestServiceRegistry(unittest.TestCase):\n     def test_register_media_type(self):\n'

Repository: plone.rest


Branch: refs/heads/main
Date: 2023-10-26T11:26:16-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.rest/commit/dc7eccf5c5be11fc8c1b0eb91ca5a20c1c98fe90

black

Files changed:
M src/plone/rest/tests/test_negotiation.py

b'diff --git a/src/plone/rest/tests/test_negotiation.py b/src/plone/rest/tests/test_negotiation.py\nindex 75385a3..22502db 100644\n--- a/src/plone/rest/tests/test_negotiation.py\n+++ b/src/plone/rest/tests/test_negotiation.py\n@@ -57,7 +57,9 @@ def test_parse_invalid_accept_header(self):\n         self.assertEqual([], parse_accept_header("invalid"))\n \n     def test_parse_mimetype_with_extra_slash(self):\n-        self.assertEqual([("application", "x/y")], parse_accept_header("application/x/y"))\n+        self.assertEqual(\n+            [("application", "x/y")], parse_accept_header("application/x/y")\n+        )\n \n \n class TestServiceRegistry(unittest.TestCase):\n'

Repository: plone.rest


Branch: refs/heads/main
Date: 2023-10-26T11:26:16-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.rest/commit/7daa91762767e8e5d3e969339450e72a3440a440

changelog

Files changed:
A news/153.bugfix

b'diff --git a/news/153.bugfix b/news/153.bugfix\nnew file mode 100644\nindex 0000000..152666d\n--- /dev/null\n+++ b/news/153.bugfix\n@@ -0,0 +1 @@\n+Fix parsing mimetypes in Accept header with an extra slash. @djay\n'

Repository: plone.rest


Branch: refs/heads/main
Date: 2023-10-26T13:25:38-07:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.rest/commit/9eca0d2d67e785763bd70496ce9d5d3e05a9ce3d

Merge pull request #153 from plone/fix_bad_media_type

fix for weird requests with media types with extra /

Files changed:
A news/153.bugfix
M src/plone/rest/negotiation.py
M src/plone/rest/tests/test_negotiation.py

b'diff --git a/news/153.bugfix b/news/153.bugfix\nnew file mode 100644\nindex 0000000..152666d\n--- /dev/null\n+++ b/news/153.bugfix\n@@ -0,0 +1 @@\n+Fix parsing mimetypes in Accept header with an extra slash. @djay\ndiff --git a/src/plone/rest/negotiation.py b/src/plone/rest/negotiation.py\nindex 63f2f31..3b23eb4 100644\n--- a/src/plone/rest/negotiation.py\n+++ b/src/plone/rest/negotiation.py\n@@ -11,7 +11,7 @@ def parse_accept_header(accept):\n     for media_range in accept.split(","):\n         media_type = media_range.split(";")[0].strip()\n         if "/" in media_type:\n-            type_, subtype = media_type.split("/")\n+            type_, subtype = media_type.split("/", 1)\n             media_types.append((type_, subtype))\n     return media_types\n \ndiff --git a/src/plone/rest/tests/test_negotiation.py b/src/plone/rest/tests/test_negotiation.py\nindex 3978b88..22502db 100644\n--- a/src/plone/rest/tests/test_negotiation.py\n+++ b/src/plone/rest/tests/test_negotiation.py\n@@ -56,6 +56,11 @@ def test_parse_all_media_types_accept_header(self):\n     def test_parse_invalid_accept_header(self):\n         self.assertEqual([], parse_accept_header("invalid"))\n \n+    def test_parse_mimetype_with_extra_slash(self):\n+        self.assertEqual(\n+            [("application", "x/y")], parse_accept_header("application/x/y")\n+        )\n+\n \n class TestServiceRegistry(unittest.TestCase):\n     def test_register_media_type(self):\n'

