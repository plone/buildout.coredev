Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2020-09-16T21:25:38+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.portlet.collection/commit/937d93705f442e364a8f1512d53300fc41486e9f

Removed fallback import of is_default_page.

No longer needed since Plone 5.0.

Files changed:
A news/3130.bugfix
M plone/portlet/collection/collection.py

b'diff --git a/news/3130.bugfix b/news/3130.bugfix\nnew file mode 100644\nindex 0000000..3eea45a\n--- /dev/null\n+++ b/news/3130.bugfix\n@@ -0,0 +1,2 @@\n+Removed fallback import of is_default_page.\n+[maurits]\ndiff --git a/plone/portlet/collection/collection.py b/plone/portlet/collection/collection.py\nindex 26cb346..2243674 100644\n--- a/plone/portlet/collection/collection.py\n+++ b/plone/portlet/collection/collection.py\n@@ -12,6 +12,7 @@\n from plone.portlets.interfaces import IPortletDataProvider\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n+from Products.CMFPlone.defaultpage import is_default_page\n from Products.CMFPlone.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path\n@@ -23,10 +24,6 @@\n import os\n import random\n \n-try:\n-    from Products.CMFPlone.defaultpage import is_default_page\n-except ImportError:\n-    from plone.app.layout.navigation.defaultpage import isDefaultPage as is_default_page  # noqa\n \n COLLECTIONS = []\n \n'

Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2020-09-16T21:27:07+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.portlet.collection/commit/154ad33ecaad91aae91ce7bc5bf15b7831c68303

Tests: import plone.testing.zope instead of z2 when possible.

Files changed:
M plone/portlet/collection/tests/functional.txt

b"diff --git a/plone/portlet/collection/tests/functional.txt b/plone/portlet/collection/tests/functional.txt\nindex 21c9b37..37095e8 100644\n--- a/plone/portlet/collection/tests/functional.txt\n+++ b/plone/portlet/collection/tests/functional.txt\n@@ -14,7 +14,10 @@ Set up testbrowser::\n     >>> from plone.app.testing import login\n     >>> login(layer['portal'], 'admin')\n     >>> app = layer['app']\n-    >>> from plone.testing.z2 import Browser\n+    >>> try:\n+    ...     from plone.testing.zope import Browser\n+    ... except ImportError:\n+    ...     from plone.testing.z2 import Browser\n     >>> browser = Browser(app)\n     >>> browser.handleErrors = False\n     >>> browser.addHeader('Authorization', 'Basic admin:secret')\n"

Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2020-09-16T21:29:48+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.portlet.collection/commit/b0da7a261b15b1ccf20712e5d9e9d9f50becc0c9

Fixed DeprecationWarning: invalid escape sequence in tests.

Files changed:
M news/3130.bugfix
M plone/portlet/collection/tests/functional.txt

b'diff --git a/news/3130.bugfix b/news/3130.bugfix\nindex 3eea45a..d965b62 100644\n--- a/news/3130.bugfix\n+++ b/news/3130.bugfix\n@@ -1,2 +1,3 @@\n Removed fallback import of is_default_page.\n+Fixed various DeprecationWarnings.\n [maurits]\ndiff --git a/plone/portlet/collection/tests/functional.txt b/plone/portlet/collection/tests/functional.txt\nindex 37095e8..cc2b775 100644\n--- a/plone/portlet/collection/tests/functional.txt\n+++ b/plone/portlet/collection/tests/functional.txt\n@@ -58,7 +58,7 @@ Use the \'Add portlet\' select box to add a collection portlet.\n     >>> add_portlet_select.getControl(value=val).selected = True\n     >>> leftcolumn_form.submit()\n     >>> import re  # \'\\s\' is white space, \'+\' is at least one, \'*\' is zero or more matches.\n-    >>> re.search(\'<h1\\s+class="documentFirstHeading"\\s*>\\s*Add Collection Portlet\\s*</h1>\', browser.contents) is not None\n+    >>> re.search(r\'<h1\\s+class="documentFirstHeading"\\s*>\\s*Add Collection Portlet\\s*</h1>\', browser.contents) is not None\n     True\n \n Use your new collection for testing. It should already be available at the root\n@@ -113,7 +113,7 @@ Now test what happens if we toggle the "show more link" option.\n \n     >>> browser.open(portal_url + \'/@@manage-portlets\')\n     >>> browser.getLink(url="http://nohost/plone/++contextportlets++plone.leftcolumn/test-collection/edit?referer=http%3A//nohost/plone/%40%40manage-portlets").click()\n-    >>> re.search(\'<h1\\s+class="documentFirstHeading"\\s*>\\s*Edit Collection Portlet\\s*</h1>\', browser.contents) is not None\n+    >>> re.search(r\'<h1\\s+class="documentFirstHeading"\\s*>\\s*Edit Collection Portlet\\s*</h1>\', browser.contents) is not None\n     True\n     >>> browser.getControl(label="Show more... link").selected = False\n     >>> browser.getControl(\'Save\').click()\n@@ -133,7 +133,7 @@ Now test what happens if we toggle the "show dates" option.\n \n     >>> browser.open(portal_url + \'/@@manage-portlets\')\n     >>> browser.getLink(url="http://nohost/plone/++contextportlets++plone.leftcolumn/test-collection/edit?referer=http%3A//nohost/plone/%40%40manage-portlets").click()\n-    >>> re.search(\'<h1\\s+class="documentFirstHeading"\\s*>\\s*Edit Collection Portlet\\s*</h1>\', browser.contents) is not None\n+    >>> re.search(r\'<h1\\s+class="documentFirstHeading"\\s*>\\s*Edit Collection Portlet\\s*</h1>\', browser.contents) is not None\n     True\n     >>> browser.getControl("Show dates").selected = True\n     >>> browser.getControl("Save").click()\n@@ -148,5 +148,5 @@ Make sure the dates show up::\n \n     >>> from DateTime import DateTime\n     >>> cur_year = DateTime().year()\n-    >>> re.search(\'<span class="portletItemDetails">.*{}.*</span>\'.format(cur_year), browser.contents) is not None\n+    >>> re.search(r\'<span class="portletItemDetails">.*{}.*</span>\'.format(cur_year), browser.contents) is not None\n     True\n'

Repository: plone.portlet.collection


Branch: refs/heads/master
Date: 2020-09-16T23:59:33+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.portlet.collection/commit/1eba2a093e498debf76b32b1af633d7e24e7aa55

Merge pull request #23 from plone/maurits/fix-warnings-2

Fix various warnings

Files changed:
A news/3130.bugfix
M plone/portlet/collection/collection.py
M plone/portlet/collection/tests/functional.txt

b'diff --git a/news/3130.bugfix b/news/3130.bugfix\nnew file mode 100644\nindex 0000000..d965b62\n--- /dev/null\n+++ b/news/3130.bugfix\n@@ -0,0 +1,3 @@\n+Removed fallback import of is_default_page.\n+Fixed various DeprecationWarnings.\n+[maurits]\ndiff --git a/plone/portlet/collection/collection.py b/plone/portlet/collection/collection.py\nindex 26cb346..2243674 100644\n--- a/plone/portlet/collection/collection.py\n+++ b/plone/portlet/collection/collection.py\n@@ -12,6 +12,7 @@\n from plone.portlets.interfaces import IPortletDataProvider\n from plone.registry.interfaces import IRegistry\n from Products.CMFCore.utils import getToolByName\n+from Products.CMFPlone.defaultpage import is_default_page\n from Products.CMFPlone.interfaces.controlpanel import ISiteSchema\n from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile\n from Products.MimetypesRegistry.MimeTypeItem import guess_icon_path\n@@ -23,10 +24,6 @@\n import os\n import random\n \n-try:\n-    from Products.CMFPlone.defaultpage import is_default_page\n-except ImportError:\n-    from plone.app.layout.navigation.defaultpage import isDefaultPage as is_default_page  # noqa\n \n COLLECTIONS = []\n \ndiff --git a/plone/portlet/collection/tests/functional.txt b/plone/portlet/collection/tests/functional.txt\nindex 21c9b37..cc2b775 100644\n--- a/plone/portlet/collection/tests/functional.txt\n+++ b/plone/portlet/collection/tests/functional.txt\n@@ -14,7 +14,10 @@ Set up testbrowser::\n     >>> from plone.app.testing import login\n     >>> login(layer[\'portal\'], \'admin\')\n     >>> app = layer[\'app\']\n-    >>> from plone.testing.z2 import Browser\n+    >>> try:\n+    ...     from plone.testing.zope import Browser\n+    ... except ImportError:\n+    ...     from plone.testing.z2 import Browser\n     >>> browser = Browser(app)\n     >>> browser.handleErrors = False\n     >>> browser.addHeader(\'Authorization\', \'Basic admin:secret\')\n@@ -55,7 +58,7 @@ Use the \'Add portlet\' select box to add a collection portlet.\n     >>> add_portlet_select.getControl(value=val).selected = True\n     >>> leftcolumn_form.submit()\n     >>> import re  # \'\\s\' is white space, \'+\' is at least one, \'*\' is zero or more matches.\n-    >>> re.search(\'<h1\\s+class="documentFirstHeading"\\s*>\\s*Add Collection Portlet\\s*</h1>\', browser.contents) is not None\n+    >>> re.search(r\'<h1\\s+class="documentFirstHeading"\\s*>\\s*Add Collection Portlet\\s*</h1>\', browser.contents) is not None\n     True\n \n Use your new collection for testing. It should already be available at the root\n@@ -110,7 +113,7 @@ Now test what happens if we toggle the "show more link" option.\n \n     >>> browser.open(portal_url + \'/@@manage-portlets\')\n     >>> browser.getLink(url="http://nohost/plone/++contextportlets++plone.leftcolumn/test-collection/edit?referer=http%3A//nohost/plone/%40%40manage-portlets").click()\n-    >>> re.search(\'<h1\\s+class="documentFirstHeading"\\s*>\\s*Edit Collection Portlet\\s*</h1>\', browser.contents) is not None\n+    >>> re.search(r\'<h1\\s+class="documentFirstHeading"\\s*>\\s*Edit Collection Portlet\\s*</h1>\', browser.contents) is not None\n     True\n     >>> browser.getControl(label="Show more... link").selected = False\n     >>> browser.getControl(\'Save\').click()\n@@ -130,7 +133,7 @@ Now test what happens if we toggle the "show dates" option.\n \n     >>> browser.open(portal_url + \'/@@manage-portlets\')\n     >>> browser.getLink(url="http://nohost/plone/++contextportlets++plone.leftcolumn/test-collection/edit?referer=http%3A//nohost/plone/%40%40manage-portlets").click()\n-    >>> re.search(\'<h1\\s+class="documentFirstHeading"\\s*>\\s*Edit Collection Portlet\\s*</h1>\', browser.contents) is not None\n+    >>> re.search(r\'<h1\\s+class="documentFirstHeading"\\s*>\\s*Edit Collection Portlet\\s*</h1>\', browser.contents) is not None\n     True\n     >>> browser.getControl("Show dates").selected = True\n     >>> browser.getControl("Save").click()\n@@ -145,5 +148,5 @@ Make sure the dates show up::\n \n     >>> from DateTime import DateTime\n     >>> cur_year = DateTime().year()\n-    >>> re.search(\'<span class="portletItemDetails">.*{}.*</span>\'.format(cur_year), browser.contents) is not None\n+    >>> re.search(r\'<span class="portletItemDetails">.*{}.*</span>\'.format(cur_year), browser.contents) is not None\n     True\n'

