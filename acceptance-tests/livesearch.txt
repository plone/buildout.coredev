*** Settings ***
Resource  plone.txt

Suite setup  Log in  admin  admin

Test setup  

*** Test cases ***

Create Document
    [Tags]  livesearch
    Click Link  css=#plone-contentmenu-factories a#document
    Input Text  title  A livesearch test page
    Click Button  Save

Create Folder
    [Tags]  livesearch
    Click Link  css=li#portaltab-index_html a
    Click Link  Folder
    Input Text  title  A livesearch test folder
    Click Button  Save

Create Sub Document 1
    [Tags]  livesearch
    Click Link  css=li#portaltab-a-livesearch-test-folder a
    Click Link  css=#plone-contentmenu-factories a#document
    Input Text  title  A livesearch test page 1
    Click Button  Save

Create Sub Document 2
    [Tags]  livesearch
    Click Link  css=li#portaltab-a-livesearch-test-folder a
    Click Link  css=#plone-contentmenu-factories a#document
    Input Text  title  A livesearch test page 2
    Click Button  Save

Livesearch For pages
    [Tags]  livesearch
    Click Link  Home
    Count Livesearch Items For  livesearch test page  4

Livesearch For folder
    [Tags]  livesearch
    Click Link  Home
    Count Livesearch Items For  livesearch test folder  2

Livesearch Within folder
    [Tags]  livesearch
    Click Link  A livesearch test folder
    Select Checkbox  css=input#searchbox_currentfolder_only
    Count Livesearch Items For  livesearch test page  3

Delete Document
    [Tags]  livesearch
    Click Link  A livesearch test page
    Element Should Not Be Visible  css=a#delete
    Click Link  css=dl#plone-contentmenu-actions dt.actionMenuHeader a  don't wait
    Element Should Be Visible  css=a#delete
    Click Overlay Link  Delete
    Page Should Contain  Do you really want to delete this item?
    Click Button  css=form#delete_confirmation input.destructive

Delete Folder
    [Tags]  livesearch
    Click Link  A livesearch test folder
    Element Should Not Be Visible  css=a#delete
    Click Link  css=dl#plone-contentmenu-actions dt.actionMenuHeader a  don't wait
    Element Should Be Visible  css=a#delete
    Click Overlay Link  Delete
    Page Should Contain  Do you really want to delete this folder and all its contents?
    Click Button  css=form#delete_confirmation input.destructive

*** Keywords ***

Count Livesearch Items For
    [Arguments]  ${string}  ${count}
    Focus  css=input#searchGadget
    Input Text  css=input#searchGadget  ${string}
    Key Down  css=input#searchGadget  e
    Key Up  css=input#searchGadget  e
    Wait until keyword succeeds  10s  1s  Element Should Be Visible  css=div#LSResult
    Wait until keyword succeeds  10s  1s  Xpath Should Match X Times  //div[@id = 'LSResult']/descendant::li  ${count}
    Focus  css=input#searchbox_currentfolder_only
    Wait until keyword succeeds  10s  1s  Element Should Not Be Visible  css=div#LSResult

Goto homepage
    Goto homepage
